Pattern_ID,Pattern_Name,Category,Instance_Count,Complexity,Priority,PostgreSQL_Syntax,Snowflake_Syntax,Key_Files_Affected,Sample_Locations
1,Date Subtraction for Day Calculation,Date/Time Operations,10,Low,HIGH,"(end_date - start_date)","DATEDIFF(DAY, start_date, end_date)","stg_instruments.sql, stg_trades.sql, date_utils.sql, int_irr_calculations.sql, int_valuation_enriched.sql","stg_instruments.sql:14, stg_trades.sql:26"
2,Extract Month from Date,Date/Time Operations,35,Low,HIGH,"extract(month from date_column)","MONTH(date_column)","stg_benchmarks.sql, stg_cashflows.sql, stg_dates.sql, stg_portfolios.sql, stg_trades.sql, stg_valuations.sql, int_trade_enriched.sql, fact_cashflow_waterfall.sql, fact_trade_activity.sql, report_ic_dashboard.sql, report_portfolio_overview.sql","date_utils.sql:7-10, stg_benchmarks.sql:11-14, stg_cashflows.sql:15-18, stg_portfolios.sql:14-17, stg_trades.sql:20-23"
3,Extract Year from Date,Date/Time Operations,8,Low,HIGH,"extract(year from date_column)","YEAR(date_column)","date_utils.sql, stg_cashflows.sql, stg_dates.sql, fact_cashflow_waterfall.sql, report_portfolio_overview.sql","date_utils.sql:19-20, stg_cashflows.sql:21, stg_dates.sql:13, fact_cashflow_waterfall.sql:33"
4,Date Truncation to Month,Date/Time Operations,4,Low,HIGH,"date_trunc('month', date_column)","DATE_TRUNC('MONTH', date_column)","stg_dates.sql, fact_trade_activity.sql, report_lp_quarterly.sql","stg_dates.sql:10, fact_trade_activity.sql:51, fact_trade_activity.sql:54"
5,Date Truncation to Quarter,Date/Time Operations,4,Low,HIGH,"date_trunc('quarter', date_column)","DATE_TRUNC('QUARTER', date_column)","stg_dates.sql, report_lp_quarterly.sql","stg_dates.sql:11, report_lp_quarterly.sql:12, report_lp_quarterly.sql:22, report_lp_quarterly.sql:40"
6,Fiscal Quarter Calculation,Business Logic Aggregation,10,Medium,HIGH,"CASE WHEN extract(month from date_col) BETWEEN 1 AND 3 THEN 'Q3' ... END","CASE WHEN MONTH(date_col) BETWEEN 1 AND 3 THEN 'Q3' ... END or use UDF","date_utils.sql, stg_benchmarks.sql, stg_cashflows.sql, stg_portfolios.sql, stg_trades.sql, stg_valuations.sql, int_trade_enriched.sql, fact_cashflow_waterfall.sql, fact_trade_activity.sql, report_ic_dashboard.sql, report_portfolio_overview.sql","date_utils.sql:5-12 (macro), stg_benchmarks.sql:10-15, stg_cashflows.sql:14-19"
7,Fiscal Year Calculation,Business Logic Aggregation,2,Medium,HIGH,"CASE WHEN extract(month from date_col) >= 7 THEN extract(year from date_col) + 1 ELSE extract(year from date_col) END","CASE WHEN MONTH(date_col) >= 7 THEN YEAR(date_col) + 1 ELSE YEAR(date_col) END or use UDF","date_utils.sql, report_portfolio_overview.sql","date_utils.sql:16-22 (macro), report_portfolio_overview.sql:25-29"
8,Row Number with WHERE filter for Deduplication,Window Function Patterns,6,Medium,MEDIUM,"SELECT * FROM (SELECT *, ROW_NUMBER() OVER (...) AS rn FROM table) sub WHERE rn = 1","SELECT * FROM table QUALIFY ROW_NUMBER() OVER (...) = 1","int_cashflow_enriched.sql, int_trade_enriched.sql, int_valuation_enriched.sql, report_daily_pnl.sql, report_ic_dashboard.sql","int_cashflow_enriched.sql:7-30, int_trade_enriched.sql:5-42, int_valuation_enriched.sql:6-25"
9,Correlated Subquery for Maximum Value,Subquery Patterns,3,Medium,MEDIUM,"WHERE col = (SELECT MAX(col) FROM table t2 WHERE t2.partition_col = t1.partition_col)","WHERE col = MAX(col) OVER (PARTITION BY partition_col)","int_irr_calculations.sql, report_lp_quarterly.sql, report_portfolio_overview.sql","int_irr_calculations.sql:33-38, report_lp_quarterly.sql:39-45, report_portfolio_overview.sql:31-36"
10,Type Casting,Type Operations,45,Low,LOW,"CAST(column AS type)","CAST(column AS type) -- compatible","stg_benchmarks.sql, stg_cashflows.sql, stg_dates.sql, stg_instruments.sql, stg_positions.sql, stg_portfolios.sql, stg_trades.sql, stg_valuations.sql, and throughout intermediate/marts models","stg_benchmarks.sql:4-8, stg_trades.sql:9-14 (extensive use)"
11,Unnecessary DISTINCT on Unique Key,Query Optimization,8,Low,MEDIUM,"SELECT DISTINCT col1, col2 FROM table (where col1 is primary key)","SELECT col1, col2 FROM table (remove DISTINCT)","stg_benchmarks.sql, stg_cashflows.sql, stg_counterparties.sql, stg_fund_structures.sql, stg_instruments.sql, stg_portfolios.sql, stg_positions.sql, stg_valuations.sql","stg_benchmarks.sql:1, stg_cashflows.sql:3, stg_counterparties.sql:1, stg_fund_structures.sql:1, stg_instruments.sql:2, stg_portfolios.sql:4, stg_positions.sql:4, stg_valuations.sql:2"
12,Multiple Identical Window Function Partitions,Window Function Optimization,8,Medium,MEDIUM,"LAG(col) OVER (PARTITION BY p_col ORDER BY o_col) computed multiple times","Store result in intermediate CTE or consolidate into single window computation","int_fund_nav.sql, int_irr_calculations.sql, int_valuation_enriched.sql, int_daily_positions.sql, int_benchmark_returns.sql","int_fund_nav.sql:54-70, int_valuation_enriched.sql:30-46, int_daily_positions.sql:64-82, int_benchmark_returns.sql:27-58"
