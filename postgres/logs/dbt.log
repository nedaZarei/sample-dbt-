[0m19:21:23.242536 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a1211c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b1cf910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b1cf730>]}


============================== 19:21:23.246591 | c444e427-14f7-41ec-9293-df6dc20aecc8 ==============================
[0m19:21:23.246591 [info ] [MainThread]: Running with dbt=1.11.0-b3
[0m19:21:23.247095 [debug] [MainThread]: running dbt with arguments {'debug': 'False', 'target_path': 'None', 'quiet': 'False', 'partial_parse': 'True', 'invocation_command': 'dbt ls --select tag:pipeline_a --profiles-dir . --project-dir .', 'no_print': 'None', 'static_parser': 'True', 'log_format': 'default', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'empty': 'None', 'version_check': 'True', 'warn_error': 'None', 'profiles_dir': '.', 'printer_width': '80', 'send_anonymous_usage_stats': 'True', 'log_cache_events': 'False', 'write_json': 'True', 'indirect_selection': 'eager', 'fail_fast': 'False', 'use_colors': 'True', 'introspect': 'True', 'log_path': 'logs', 'cache_selected_only': 'False', 'use_experimental_parser': 'False'}
[0m19:21:23.469936 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'c444e427-14f7-41ec-9293-df6dc20aecc8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10aa485b0>]}
[0m19:21:23.545366 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'c444e427-14f7-41ec-9293-df6dc20aecc8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10aaa1550>]}
[0m19:21:23.547212 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m19:21:23.657802 [debug] [MainThread]: checksum: e63134dccc1251cfb572caf0e4aa952f030c125ee3634f3bf2c0a2e1bb6ae349, vars: {}, profile: , target: , version: 1.11.0b3
[0m19:21:23.904232 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 3 files changed.
[0m19:21:23.905647 [debug] [MainThread]: Partial parsing: updated file: bain_capital_analytics://models/staging/stg_positions.sql
[0m19:21:23.906599 [debug] [MainThread]: Partial parsing: updated file: bain_capital_analytics://models/staging/_staging.yml
[0m19:21:23.907727 [info ] [MainThread]: Unable to do partial parsing because an error occurred. Switching to full reparse.
[0m19:21:23.912355 [debug] [MainThread]: Partial parsing exception processing file bain_capital_analytics://models/marts/_marts.yml
[0m19:21:23.912783 [debug] [MainThread]: PP exception info: {'code': 'if child_test.attached_node:', 'location': 'line 920 in remove_tests', 'traceback': 'Traceback (most recent call last):\n  File "/Users/nedazarei/Library/Python/3.9/lib/python/site-packages/dbt/parser/manifest.py", line 548, in safe_update_project_parser_files_partially\n    project_parser_files = self.partial_parser.get_parsing_files()\n  File "/Users/nedazarei/Library/Python/3.9/lib/python/site-packages/dbt/parser/partial.py", line 188, in get_parsing_files\n    self.change_schema_file(file_id)\n  File "/Users/nedazarei/Library/Python/3.9/lib/python/site-packages/dbt/parser/partial.py", line 642, in change_schema_file\n    self.handle_schema_file_changes(saved_schema_file, saved_yaml_dict, new_yaml_dict)\n  File "/Users/nedazarei/Library/Python/3.9/lib/python/site-packages/dbt/parser/partial.py", line 679, in handle_schema_file_changes\n    self.delete_schema_mssa_links(schema_file, dict_key, elem)\n  File "/Users/nedazarei/Library/Python/3.9/lib/python/site-packages/dbt/parser/partial.py", line 852, in delete_schema_mssa_links\n    self._delete_schema_mssa_links(schema_file, dict_key, elem, elem_unique_ids)\n  File "/Users/nedazarei/Library/Python/3.9/lib/python/site-packages/dbt/parser/partial.py", line 905, in _delete_schema_mssa_links\n    self.remove_tests(schema_file, dict_key, elem["name"])\n  File "/Users/nedazarei/Library/Python/3.9/lib/python/site-packages/dbt/parser/partial.py", line 920, in remove_tests\n    if child_test.attached_node:\nAttributeError: \'SingularTestNode\' object has no attribute \'attached_node\'\n', 'exception': "AttributeError: 'SingularTestNode' object has no attribute 'attached_node'", 'parse_file_type': 'schema'}
[0m19:21:23.913149 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': 'c444e427-14f7-41ec-9293-df6dc20aecc8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108b20340>]}
[0m19:21:25.423031 [warn ] [MainThread]: [[33mWARNING[0m][MissingArgumentsPropertyInGenericTestDeprecation]: Deprecated
functionality
Found top-level arguments to test `relationships` defined on 'stg_positions' in
package 'bain_capital_analytics' (models/staging/_staging.yml). Arguments to
generic tests should be nested under the `arguments` property.
[0m19:21:25.423752 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': 'c444e427-14f7-41ec-9293-df6dc20aecc8', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c8b8dc0>]}
[0m19:21:25.637726 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'c444e427-14f7-41ec-9293-df6dc20aecc8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ca5f130>]}
[0m19:21:25.816785 [debug] [MainThread]: Wrote artifact WritableManifest to ./target/manifest.json
[0m19:21:25.819145 [debug] [MainThread]: Wrote artifact SemanticManifest to ./target/semantic_manifest.json
[0m19:21:25.841036 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'c444e427-14f7-41ec-9293-df6dc20aecc8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c91d2e0>]}
[0m19:21:25.841568 [info ] [MainThread]: Found 28 models, 53 data tests, 10 seeds, 569 macros
[0m19:21:25.841889 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c444e427-14f7-41ec-9293-df6dc20aecc8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a3a46a0>]}
[0m19:21:25.842738 [info ] [MainThread]: bain_capital_analytics.marts.fact_portfolio_summary
[0m19:21:25.843042 [info ] [MainThread]: bain_capital_analytics.marts.report_portfolio_overview
[0m19:21:25.843292 [info ] [MainThread]: bain_capital_analytics.staging.stg_portfolios
[0m19:21:25.843536 [info ] [MainThread]: bain_capital_analytics.staging.stg_positions
[0m19:21:25.843784 [info ] [MainThread]: bain_capital_analytics.marts.not_null_fact_portfolio_summary_portfolio_id
[0m19:21:25.844026 [info ] [MainThread]: bain_capital_analytics.marts.not_null_fact_portfolio_summary_position_date
[0m19:21:25.844266 [info ] [MainThread]: bain_capital_analytics.marts.not_null_report_portfolio_overview_portfolio_id
[0m19:21:25.844507 [info ] [MainThread]: bain_capital_analytics.staging.not_null_stg_portfolios_fund_id
[0m19:21:25.844752 [info ] [MainThread]: bain_capital_analytics.staging.not_null_stg_portfolios_portfolio_id
[0m19:21:25.844991 [info ] [MainThread]: bain_capital_analytics.staging.not_null_stg_positions_portfolio_id
[0m19:21:25.845227 [info ] [MainThread]: bain_capital_analytics.staging.not_null_stg_positions_position_id
[0m19:21:25.845468 [info ] [MainThread]: bain_capital_analytics.staging.relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_
[0m19:21:25.845713 [info ] [MainThread]: bain_capital_analytics.staging.unique_stg_portfolios_portfolio_id
[0m19:21:25.845949 [info ] [MainThread]: bain_capital_analytics.staging.unique_stg_positions_position_id
[0m19:21:25.846416 [warn ] [MainThread]: [[33mWARNING[0m][DeprecationsSummary]: Deprecated functionality
Summary of encountered deprecations:
- MissingArgumentsPropertyInGenericTestDeprecation: 1 occurrence
To see all deprecation instances instead of just the first occurrence of each,
run command again with the `--show-all-deprecations` flag. You may also need to
run with `--no-partial-parse` as some deprecations are only encountered during
parsing.
[0m19:21:25.849593 [debug] [MainThread]: Resource report: {"command_name": "list", "command_success": true, "command_wall_clock_time": 2.688935, "process_in_blocks": "0", "process_kernel_time": 0.3512, "process_mem_max_rss": "134184960", "process_out_blocks": "0", "process_user_time": 3.708952}
[0m19:21:25.849963 [debug] [MainThread]: Command `dbt ls` succeeded at 19:21:25.849887 after 2.69 seconds
[0m19:21:25.850313 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a1211c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c9cb880>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c91d1c0>]}
[0m19:21:25.850630 [debug] [MainThread]: Flushing usage events
[0m19:21:27.702751 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m19:21:29.313532 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a7fd1c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b8ab910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b8ab730>]}


============================== 19:21:29.317065 | 7c074ebb-b878-4b2e-b907-ab4d7e41e36d ==============================
[0m19:21:29.317065 [info ] [MainThread]: Running with dbt=1.11.0-b3
[0m19:21:29.317562 [debug] [MainThread]: running dbt with arguments {'cache_selected_only': 'False', 'use_colors': 'True', 'fail_fast': 'False', 'introspect': 'True', 'invocation_command': 'dbt ls --select tag:pipeline_b --profiles-dir . --project-dir .', 'indirect_selection': 'eager', 'warn_error': 'None', 'profiles_dir': '.', 'printer_width': '80', 'send_anonymous_usage_stats': 'True', 'debug': 'False', 'version_check': 'True', 'no_print': 'None', 'log_cache_events': 'False', 'log_path': 'logs', 'empty': 'None', 'write_json': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'static_parser': 'True', 'use_experimental_parser': 'False', 'quiet': 'False', 'target_path': 'None', 'log_format': 'default', 'partial_parse': 'True'}
[0m19:21:29.513895 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '7c074ebb-b878-4b2e-b907-ab4d7e41e36d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1090c5e20>]}
[0m19:21:29.589142 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '7c074ebb-b878-4b2e-b907-ab4d7e41e36d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b818460>]}
[0m19:21:29.590381 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m19:21:29.694042 [debug] [MainThread]: checksum: e63134dccc1251cfb572caf0e4aa952f030c125ee3634f3bf2c0a2e1bb6ae349, vars: {}, profile: , target: , version: 1.11.0b3
[0m19:21:29.920187 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m19:21:29.920630 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m19:21:29.983941 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '7c074ebb-b878-4b2e-b907-ab4d7e41e36d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ca0ce80>]}
[0m19:21:30.109721 [debug] [MainThread]: Wrote artifact WritableManifest to ./target/manifest.json
[0m19:21:30.111578 [debug] [MainThread]: Wrote artifact SemanticManifest to ./target/semantic_manifest.json
[0m19:21:30.128029 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '7c074ebb-b878-4b2e-b907-ab4d7e41e36d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c9f72e0>]}
[0m19:21:30.128522 [info ] [MainThread]: Found 28 models, 53 data tests, 10 seeds, 569 macros
[0m19:21:30.128830 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '7c074ebb-b878-4b2e-b907-ab4d7e41e36d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ca972b0>]}
[0m19:21:30.129687 [info ] [MainThread]: bain_capital_analytics.marts.fact_portfolio_pnl
[0m19:21:30.129973 [info ] [MainThread]: bain_capital_analytics.marts.fact_trade_activity
[0m19:21:30.130220 [info ] [MainThread]: bain_capital_analytics.intermediate.int_daily_positions
[0m19:21:30.130456 [info ] [MainThread]: bain_capital_analytics.intermediate.int_trade_enriched
[0m19:21:30.130698 [info ] [MainThread]: bain_capital_analytics.marts.report_daily_pnl
[0m19:21:30.130934 [info ] [MainThread]: bain_capital_analytics.staging.stg_benchmarks
[0m19:21:30.131159 [info ] [MainThread]: bain_capital_analytics.staging.stg_counterparties
[0m19:21:30.131385 [info ] [MainThread]: bain_capital_analytics.staging.stg_dates
[0m19:21:30.131612 [info ] [MainThread]: bain_capital_analytics.staging.stg_instruments
[0m19:21:30.131837 [info ] [MainThread]: bain_capital_analytics.staging.stg_portfolios
[0m19:21:30.132061 [info ] [MainThread]: bain_capital_analytics.staging.stg_positions
[0m19:21:30.132303 [info ] [MainThread]: bain_capital_analytics.staging.stg_trades
[0m19:21:30.132538 [info ] [MainThread]: bain_capital_analytics.assert_pnl_balanced
[0m19:21:30.132771 [info ] [MainThread]: bain_capital_analytics.marts.not_null_fact_portfolio_pnl_pnl_date
[0m19:21:30.132999 [info ] [MainThread]: bain_capital_analytics.marts.not_null_fact_portfolio_pnl_portfolio_id
[0m19:21:30.133228 [info ] [MainThread]: bain_capital_analytics.marts.not_null_fact_trade_activity_trade_id
[0m19:21:30.133453 [info ] [MainThread]: bain_capital_analytics.intermediate.not_null_int_daily_positions_position_id
[0m19:21:30.133676 [info ] [MainThread]: bain_capital_analytics.intermediate.not_null_int_trade_enriched_trade_id
[0m19:21:30.133906 [info ] [MainThread]: bain_capital_analytics.marts.not_null_report_daily_pnl_portfolio_id
[0m19:21:30.134133 [info ] [MainThread]: bain_capital_analytics.staging.not_null_stg_benchmarks_benchmark_date
[0m19:21:30.134358 [info ] [MainThread]: bain_capital_analytics.staging.not_null_stg_benchmarks_benchmark_id
[0m19:21:30.134583 [info ] [MainThread]: bain_capital_analytics.staging.not_null_stg_counterparties_counterparty_id
[0m19:21:30.134812 [info ] [MainThread]: bain_capital_analytics.staging.not_null_stg_dates_date_day
[0m19:21:30.135039 [info ] [MainThread]: bain_capital_analytics.staging.not_null_stg_instruments_instrument_id
[0m19:21:30.135261 [info ] [MainThread]: bain_capital_analytics.staging.not_null_stg_portfolios_fund_id
[0m19:21:30.135489 [info ] [MainThread]: bain_capital_analytics.staging.not_null_stg_portfolios_portfolio_id
[0m19:21:30.135716 [info ] [MainThread]: bain_capital_analytics.staging.not_null_stg_positions_portfolio_id
[0m19:21:30.135947 [info ] [MainThread]: bain_capital_analytics.staging.not_null_stg_positions_position_id
[0m19:21:30.136171 [info ] [MainThread]: bain_capital_analytics.staging.not_null_stg_trades_instrument_id
[0m19:21:30.136397 [info ] [MainThread]: bain_capital_analytics.staging.not_null_stg_trades_portfolio_id
[0m19:21:30.136624 [info ] [MainThread]: bain_capital_analytics.staging.not_null_stg_trades_trade_id
[0m19:21:30.136852 [info ] [MainThread]: bain_capital_analytics.staging.relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_
[0m19:21:30.137077 [info ] [MainThread]: bain_capital_analytics.marts.unique_fact_trade_activity_trade_id
[0m19:21:30.137300 [info ] [MainThread]: bain_capital_analytics.intermediate.unique_int_trade_enriched_trade_id
[0m19:21:30.137525 [info ] [MainThread]: bain_capital_analytics.staging.unique_stg_counterparties_counterparty_id
[0m19:21:30.137755 [info ] [MainThread]: bain_capital_analytics.staging.unique_stg_dates_date_day
[0m19:21:30.137982 [info ] [MainThread]: bain_capital_analytics.staging.unique_stg_instruments_instrument_id
[0m19:21:30.138213 [info ] [MainThread]: bain_capital_analytics.staging.unique_stg_portfolios_portfolio_id
[0m19:21:30.138434 [info ] [MainThread]: bain_capital_analytics.staging.unique_stg_positions_position_id
[0m19:21:30.138657 [info ] [MainThread]: bain_capital_analytics.staging.unique_stg_trades_trade_id
[0m19:21:30.141110 [debug] [MainThread]: Resource report: {"command_name": "list", "command_success": true, "command_wall_clock_time": 0.90243644, "process_in_blocks": "0", "process_kernel_time": 0.258069, "process_mem_max_rss": "119275520", "process_out_blocks": "0", "process_user_time": 2.00189}
[0m19:21:30.141514 [debug] [MainThread]: Command `dbt ls` succeeded at 19:21:30.141432 after 0.90 seconds
[0m19:21:30.141847 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a7fd1c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ca366a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109d08b20>]}
[0m19:21:30.142162 [debug] [MainThread]: Flushing usage events
[0m19:21:31.796608 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m19:21:33.428511 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c6411c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d6ef910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d6ef730>]}


============================== 19:21:33.432205 | 923074f5-96a1-45ac-b527-b65a2e46e3c9 ==============================
[0m19:21:33.432205 [info ] [MainThread]: Running with dbt=1.11.0-b3
[0m19:21:33.432734 [debug] [MainThread]: running dbt with arguments {'introspect': 'True', 'invocation_command': 'dbt ls --select tag:pipeline_c --profiles-dir . --project-dir .', 'target_path': 'None', 'log_format': 'default', 'profiles_dir': '.', 'use_colors': 'True', 'version_check': 'True', 'warn_error': 'None', 'printer_width': '80', 'fail_fast': 'False', 'log_cache_events': 'False', 'send_anonymous_usage_stats': 'True', 'debug': 'False', 'static_parser': 'True', 'log_path': 'logs', 'empty': 'None', 'partial_parse': 'True', 'write_json': 'True', 'use_experimental_parser': 'False', 'quiet': 'False', 'no_print': 'None', 'indirect_selection': 'eager', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'cache_selected_only': 'False'}
[0m19:21:33.627566 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '923074f5-96a1-45ac-b527-b65a2e46e3c9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10af09e20>]}
[0m19:21:33.702044 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '923074f5-96a1-45ac-b527-b65a2e46e3c9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d65b460>]}
[0m19:21:33.702968 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m19:21:33.805795 [debug] [MainThread]: checksum: e63134dccc1251cfb572caf0e4aa952f030c125ee3634f3bf2c0a2e1bb6ae349, vars: {}, profile: , target: , version: 1.11.0b3
[0m19:21:34.024020 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m19:21:34.024537 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m19:21:34.088202 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '923074f5-96a1-45ac-b527-b65a2e46e3c9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e850e80>]}
[0m19:21:34.215634 [debug] [MainThread]: Wrote artifact WritableManifest to ./target/manifest.json
[0m19:21:34.217467 [debug] [MainThread]: Wrote artifact SemanticManifest to ./target/semantic_manifest.json
[0m19:21:34.233991 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '923074f5-96a1-45ac-b527-b65a2e46e3c9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e83c2e0>]}
[0m19:21:34.234523 [info ] [MainThread]: Found 28 models, 53 data tests, 10 seeds, 569 macros
[0m19:21:34.234840 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '923074f5-96a1-45ac-b527-b65a2e46e3c9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e8db2b0>]}
[0m19:21:34.235756 [info ] [MainThread]: bain_capital_analytics.marts.fact_cashflow_waterfall
[0m19:21:34.236048 [info ] [MainThread]: bain_capital_analytics.marts.fact_fund_performance
[0m19:21:34.236295 [info ] [MainThread]: bain_capital_analytics.marts.fact_portfolio_attribution
[0m19:21:34.236534 [info ] [MainThread]: bain_capital_analytics.intermediate.int_benchmark_returns
[0m19:21:34.236772 [info ] [MainThread]: bain_capital_analytics.intermediate.int_cashflow_enriched
[0m19:21:34.237003 [info ] [MainThread]: bain_capital_analytics.intermediate.int_fund_nav
[0m19:21:34.237229 [info ] [MainThread]: bain_capital_analytics.intermediate.int_irr_calculations
[0m19:21:34.237455 [info ] [MainThread]: bain_capital_analytics.intermediate.int_portfolio_attribution
[0m19:21:34.237687 [info ] [MainThread]: bain_capital_analytics.intermediate.int_valuation_enriched
[0m19:21:34.237917 [info ] [MainThread]: bain_capital_analytics.marts.report_ic_dashboard
[0m19:21:34.238146 [info ] [MainThread]: bain_capital_analytics.marts.report_lp_quarterly
[0m19:21:34.238372 [info ] [MainThread]: bain_capital_analytics.staging.stg_benchmarks
[0m19:21:34.238604 [info ] [MainThread]: bain_capital_analytics.staging.stg_cashflows
[0m19:21:34.238828 [info ] [MainThread]: bain_capital_analytics.staging.stg_dates
[0m19:21:34.239057 [info ] [MainThread]: bain_capital_analytics.staging.stg_fund_structures
[0m19:21:34.239287 [info ] [MainThread]: bain_capital_analytics.staging.stg_instruments
[0m19:21:34.239511 [info ] [MainThread]: bain_capital_analytics.staging.stg_portfolios
[0m19:21:34.239741 [info ] [MainThread]: bain_capital_analytics.staging.stg_positions
[0m19:21:34.240109 [info ] [MainThread]: bain_capital_analytics.staging.stg_valuations
[0m19:21:34.240390 [info ] [MainThread]: bain_capital_analytics.marts.not_null_fact_cashflow_waterfall_cashflow_id
[0m19:21:34.240645 [info ] [MainThread]: bain_capital_analytics.marts.not_null_fact_fund_performance_fund_id
[0m19:21:34.240889 [info ] [MainThread]: bain_capital_analytics.marts.not_null_fact_portfolio_attribution_portfolio_id
[0m19:21:34.241131 [info ] [MainThread]: bain_capital_analytics.intermediate.not_null_int_benchmark_returns_benchmark_id
[0m19:21:34.241371 [info ] [MainThread]: bain_capital_analytics.intermediate.not_null_int_cashflow_enriched_cashflow_id
[0m19:21:34.241609 [info ] [MainThread]: bain_capital_analytics.intermediate.not_null_int_fund_nav_fund_id
[0m19:21:34.241841 [info ] [MainThread]: bain_capital_analytics.intermediate.not_null_int_irr_calculations_fund_id
[0m19:21:34.242084 [info ] [MainThread]: bain_capital_analytics.intermediate.not_null_int_irr_calculations_portfolio_id
[0m19:21:34.242319 [info ] [MainThread]: bain_capital_analytics.intermediate.not_null_int_portfolio_attribution_portfolio_id
[0m19:21:34.242556 [info ] [MainThread]: bain_capital_analytics.intermediate.not_null_int_valuation_enriched_valuation_id
[0m19:21:34.242792 [info ] [MainThread]: bain_capital_analytics.marts.not_null_report_ic_dashboard_fund_id
[0m19:21:34.243025 [info ] [MainThread]: bain_capital_analytics.marts.not_null_report_lp_quarterly_fund_id
[0m19:21:34.243256 [info ] [MainThread]: bain_capital_analytics.staging.not_null_stg_benchmarks_benchmark_date
[0m19:21:34.243492 [info ] [MainThread]: bain_capital_analytics.staging.not_null_stg_benchmarks_benchmark_id
[0m19:21:34.243727 [info ] [MainThread]: bain_capital_analytics.staging.not_null_stg_cashflows_cashflow_id
[0m19:21:34.243961 [info ] [MainThread]: bain_capital_analytics.staging.not_null_stg_cashflows_fund_id
[0m19:21:34.244204 [info ] [MainThread]: bain_capital_analytics.staging.not_null_stg_cashflows_portfolio_id
[0m19:21:34.244434 [info ] [MainThread]: bain_capital_analytics.staging.not_null_stg_dates_date_day
[0m19:21:34.244663 [info ] [MainThread]: bain_capital_analytics.staging.not_null_stg_fund_structures_fund_id
[0m19:21:34.244897 [info ] [MainThread]: bain_capital_analytics.staging.not_null_stg_instruments_instrument_id
[0m19:21:34.245132 [info ] [MainThread]: bain_capital_analytics.staging.not_null_stg_portfolios_fund_id
[0m19:21:34.245366 [info ] [MainThread]: bain_capital_analytics.staging.not_null_stg_portfolios_portfolio_id
[0m19:21:34.245596 [info ] [MainThread]: bain_capital_analytics.staging.not_null_stg_positions_portfolio_id
[0m19:21:34.245830 [info ] [MainThread]: bain_capital_analytics.staging.not_null_stg_positions_position_id
[0m19:21:34.246065 [info ] [MainThread]: bain_capital_analytics.staging.not_null_stg_valuations_portfolio_id
[0m19:21:34.246296 [info ] [MainThread]: bain_capital_analytics.staging.not_null_stg_valuations_valuation_id
[0m19:21:34.246528 [info ] [MainThread]: bain_capital_analytics.staging.relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_
[0m19:21:34.246761 [info ] [MainThread]: bain_capital_analytics.intermediate.unique_int_cashflow_enriched_cashflow_id
[0m19:21:34.246997 [info ] [MainThread]: bain_capital_analytics.staging.unique_stg_cashflows_cashflow_id
[0m19:21:34.247229 [info ] [MainThread]: bain_capital_analytics.staging.unique_stg_dates_date_day
[0m19:21:34.247475 [info ] [MainThread]: bain_capital_analytics.staging.unique_stg_fund_structures_fund_id
[0m19:21:34.247706 [info ] [MainThread]: bain_capital_analytics.staging.unique_stg_instruments_instrument_id
[0m19:21:34.247938 [info ] [MainThread]: bain_capital_analytics.staging.unique_stg_portfolios_portfolio_id
[0m19:21:34.248169 [info ] [MainThread]: bain_capital_analytics.staging.unique_stg_positions_position_id
[0m19:21:34.248400 [info ] [MainThread]: bain_capital_analytics.staging.unique_stg_valuations_valuation_id
[0m19:21:34.250959 [debug] [MainThread]: Resource report: {"command_name": "list", "command_success": true, "command_wall_clock_time": 0.90056056, "process_in_blocks": "0", "process_kernel_time": 0.233083, "process_mem_max_rss": "119422976", "process_out_blocks": "0", "process_user_time": 2.015986}
[0m19:21:34.251326 [debug] [MainThread]: Command `dbt ls` succeeded at 19:21:34.251248 after 0.90 seconds
[0m19:21:34.251670 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c6411c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e87a6a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10bb4cb20>]}
[0m19:21:34.251993 [debug] [MainThread]: Flushing usage events
[0m19:21:35.791694 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m19:24:02.063704 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a64d190>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b6fa820>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b6fa640>]}


============================== 19:24:02.068373 | a0a55c85-4ef5-4988-8f96-afef9afc9d67 ==============================
[0m19:24:02.068373 [info ] [MainThread]: Running with dbt=1.11.0-b3
[0m19:24:02.068910 [debug] [MainThread]: running dbt with arguments {'introspect': 'True', 'cache_selected_only': 'False', 'use_experimental_parser': 'False', 'debug': 'False', 'invocation_command': 'dbt build --select tag:pipeline_a --profiles-dir . --project-dir .', 'log_path': 'logs', 'warn_error': 'None', 'use_colors': 'True', 'write_json': 'True', 'profiles_dir': '.', 'log_format': 'default', 'indirect_selection': 'eager', 'no_print': 'None', 'partial_parse': 'True', 'quiet': 'False', 'version_check': 'True', 'static_parser': 'True', 'fail_fast': 'False', 'log_cache_events': 'False', 'target_path': 'None', 'send_anonymous_usage_stats': 'True', 'printer_width': '80', 'empty': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])'}
[0m19:24:02.296218 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'a0a55c85-4ef5-4988-8f96-afef9afc9d67', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108efc310>]}
[0m19:24:02.371820 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'a0a55c85-4ef5-4988-8f96-afef9afc9d67', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b643250>]}
[0m19:24:02.373498 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m19:24:02.481804 [debug] [MainThread]: checksum: e63134dccc1251cfb572caf0e4aa952f030c125ee3634f3bf2c0a2e1bb6ae349, vars: {}, profile: , target: , version: 1.11.0b3
[0m19:24:02.724530 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m19:24:02.725078 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m19:24:02.790316 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'a0a55c85-4ef5-4988-8f96-afef9afc9d67', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c858130>]}
[0m19:24:02.917478 [debug] [MainThread]: Wrote artifact WritableManifest to ./target/manifest.json
[0m19:24:02.919737 [debug] [MainThread]: Wrote artifact SemanticManifest to ./target/semantic_manifest.json
[0m19:24:02.957157 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'a0a55c85-4ef5-4988-8f96-afef9afc9d67', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c84aa60>]}
[0m19:24:02.957897 [info ] [MainThread]: Found 28 models, 53 data tests, 10 seeds, 569 macros
[0m19:24:02.960693 [info ] [MainThread]: 
[0m19:24:02.961067 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m19:24:02.961352 [info ] [MainThread]: 
[0m19:24:02.961837 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m19:24:02.965931 [debug] [ThreadPool]: Acquiring new postgres connection 'list_bain_analytics'
[0m19:24:03.025171 [debug] [ThreadPool]: Using postgres connection "list_bain_analytics"
[0m19:24:03.025577 [debug] [ThreadPool]: On list_bain_analytics: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "connection_name": "list_bain_analytics"} */

    select distinct nspname from pg_namespace
  
[0m19:24:03.025850 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m19:24:03.073398 [debug] [ThreadPool]: SQL status: SELECT 5 in 0.047 seconds
[0m19:24:03.074924 [debug] [ThreadPool]: On list_bain_analytics: Close
[0m19:24:03.078452 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_bain_analytics, now list_bain_analytics_public)
[0m19:24:03.078942 [debug] [ThreadPool]: Acquiring new postgres connection 'list_bain_analytics_public_raw'
[0m19:24:03.085172 [debug] [ThreadPool]: Using postgres connection "list_bain_analytics_public"
[0m19:24:03.087809 [debug] [ThreadPool]: Using postgres connection "list_bain_analytics_public_raw"
[0m19:24:03.088130 [debug] [ThreadPool]: On list_bain_analytics_public: BEGIN
[0m19:24:03.088396 [debug] [ThreadPool]: On list_bain_analytics_public_raw: BEGIN
[0m19:24:03.088650 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:24:03.088901 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m19:24:03.101330 [debug] [ThreadPool]: SQL status: BEGIN in 0.013 seconds
[0m19:24:03.101918 [debug] [ThreadPool]: Using postgres connection "list_bain_analytics_public"
[0m19:24:03.102228 [debug] [ThreadPool]: On list_bain_analytics_public: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "connection_name": "list_bain_analytics_public"} */
select
      'bain_analytics' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'bain_analytics' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'bain_analytics' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m19:24:03.102546 [debug] [ThreadPool]: SQL status: BEGIN in 0.014 seconds
[0m19:24:03.102920 [debug] [ThreadPool]: Using postgres connection "list_bain_analytics_public_raw"
[0m19:24:03.103250 [debug] [ThreadPool]: On list_bain_analytics_public_raw: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "connection_name": "list_bain_analytics_public_raw"} */
select
      'bain_analytics' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_raw'
    union all
    select
      'bain_analytics' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_raw'
    union all
    select
      'bain_analytics' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_raw'
  
[0m19:24:03.107055 [debug] [ThreadPool]: SQL status: SELECT 10 in 0.003 seconds
[0m19:24:03.107394 [debug] [ThreadPool]: SQL status: SELECT 28 in 0.004 seconds
[0m19:24:03.108833 [debug] [ThreadPool]: On list_bain_analytics_public_raw: ROLLBACK
[0m19:24:03.110194 [debug] [ThreadPool]: On list_bain_analytics_public: ROLLBACK
[0m19:24:03.110866 [debug] [ThreadPool]: On list_bain_analytics_public: Close
[0m19:24:03.111178 [debug] [ThreadPool]: On list_bain_analytics_public_raw: Close
[0m19:24:03.122192 [debug] [MainThread]: Using postgres connection "master"
[0m19:24:03.122501 [debug] [MainThread]: On master: BEGIN
[0m19:24:03.122757 [debug] [MainThread]: Opening a new connection, currently in state init
[0m19:24:03.132088 [debug] [MainThread]: SQL status: BEGIN in 0.009 seconds
[0m19:24:03.132390 [debug] [MainThread]: Using postgres connection "master"
[0m19:24:03.132714 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "connection_name": "master"} */
select distinct
        dependent_namespace.nspname as dependent_schema,
        dependent_class.relname as dependent_name,
        referenced_namespace.nspname as referenced_schema,
        referenced_class.relname as referenced_name

    -- Query for views: views are entries in pg_class with an entry in pg_rewrite, but we avoid
    -- a seq scan on pg_rewrite by leveraging the fact there is an "internal" row in pg_depend for
    -- the view...
    from pg_class as dependent_class
    join pg_namespace as dependent_namespace on dependent_namespace.oid = dependent_class.relnamespace
    join pg_depend as dependent_depend on dependent_depend.refobjid = dependent_class.oid
        and dependent_depend.classid = 'pg_rewrite'::regclass
        and dependent_depend.refclassid = 'pg_class'::regclass
        and dependent_depend.deptype = 'i'

    -- ... and via pg_depend (that has a row per column, hence the need for "distinct" above, and
    -- making sure to exclude the internal row to avoid a view appearing to depend on itself)...
    join pg_depend as joining_depend on joining_depend.objid = dependent_depend.objid
        and joining_depend.classid = 'pg_rewrite'::regclass
        and joining_depend.refclassid = 'pg_class'::regclass
        and joining_depend.refobjid != dependent_depend.refobjid

    -- ... we can find the tables they query from in pg_class, but excluding system tables. Note we
    -- don't need need to exclude _dependent_ system tables, because they only query from other
    -- system tables, and so are automatically excluded by excluding _referenced_ system tables
    join pg_class as referenced_class on referenced_class.oid = joining_depend.refobjid
    join pg_namespace as referenced_namespace on referenced_namespace.oid = referenced_class.relnamespace
        and referenced_namespace.nspname != 'information_schema'
        and referenced_namespace.nspname not like 'pg\_%'

    order by
        dependent_schema, dependent_name, referenced_schema, referenced_name;
[0m19:24:03.137873 [debug] [MainThread]: SQL status: SELECT 64 in 0.005 seconds
[0m19:24:03.148008 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a0a55c85-4ef5-4988-8f96-afef9afc9d67', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c9b85b0>]}
[0m19:24:03.148484 [debug] [MainThread]: On master: ROLLBACK
[0m19:24:03.149065 [debug] [MainThread]: Using postgres connection "master"
[0m19:24:03.149362 [debug] [MainThread]: On master: BEGIN
[0m19:24:03.150220 [debug] [MainThread]: SQL status: BEGIN in 0.001 seconds
[0m19:24:03.150492 [debug] [MainThread]: On master: COMMIT
[0m19:24:03.150744 [debug] [MainThread]: Using postgres connection "master"
[0m19:24:03.150983 [debug] [MainThread]: On master: COMMIT
[0m19:24:03.151497 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m19:24:03.151794 [debug] [MainThread]: On master: Close
[0m19:24:03.155252 [debug] [Thread-1  ]: Began running node model.bain_capital_analytics.stg_portfolios
[0m19:24:03.155627 [debug] [Thread-2  ]: Began running node model.bain_capital_analytics.stg_positions
[0m19:24:03.156133 [info ] [Thread-1  ]: 1 of 14 START sql view model public.stg_portfolios ............................. [RUN]
[0m19:24:03.156605 [info ] [Thread-2  ]: 2 of 14 START sql view model public.stg_positions .............................. [RUN]
[0m19:24:03.157036 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_bain_analytics_public, now model.bain_capital_analytics.stg_portfolios)
[0m19:24:03.157438 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly list_bain_analytics_public_raw, now model.bain_capital_analytics.stg_positions)
[0m19:24:03.157776 [debug] [Thread-1  ]: Began compiling node model.bain_capital_analytics.stg_portfolios
[0m19:24:03.158078 [debug] [Thread-2  ]: Began compiling node model.bain_capital_analytics.stg_positions
[0m19:24:03.167803 [debug] [Thread-2  ]: Writing injected SQL for node "model.bain_capital_analytics.stg_positions"
[0m19:24:03.169696 [debug] [Thread-1  ]: Writing injected SQL for node "model.bain_capital_analytics.stg_portfolios"
[0m19:24:03.171267 [debug] [Thread-1  ]: Began executing node model.bain_capital_analytics.stg_portfolios
[0m19:24:03.184369 [debug] [Thread-2  ]: Began executing node model.bain_capital_analytics.stg_positions
[0m19:24:03.214769 [debug] [Thread-1  ]: Writing runtime sql for node "model.bain_capital_analytics.stg_portfolios"
[0m19:24:03.216233 [debug] [Thread-2  ]: Writing runtime sql for node "model.bain_capital_analytics.stg_positions"
[0m19:24:03.217188 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.stg_positions"
[0m19:24:03.217589 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.stg_portfolios"
[0m19:24:03.217928 [debug] [Thread-2  ]: On model.bain_capital_analytics.stg_positions: BEGIN
[0m19:24:03.218237 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_portfolios: BEGIN
[0m19:24:03.218537 [debug] [Thread-2  ]: Opening a new connection, currently in state closed
[0m19:24:03.218815 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m19:24:03.230089 [debug] [Thread-1  ]: SQL status: BEGIN in 0.011 seconds
[0m19:24:03.230481 [debug] [Thread-2  ]: SQL status: BEGIN in 0.012 seconds
[0m19:24:03.230800 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.stg_portfolios"
[0m19:24:03.231113 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.stg_positions"
[0m19:24:03.231464 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_portfolios: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_portfolios"} */

  create view "bain_analytics"."public"."stg_portfolios__dbt_tmp"
    
    
  as (
    -- Anti-pattern: unnecessary DISTINCT when source data is already unique
-- Anti-pattern: casting in every model instead of once upstream

select distinct
    cast(portfolio_id as varchar(10)) as portfolio_id,
    cast(portfolio_name as varchar(100)) as portfolio_name,
    cast(strategy as varchar(50)) as strategy,
    cast(inception_date as date) as inception_date,
    cast(fund_id as varchar(10)) as fund_id,
    cast(manager_name as varchar(100)) as manager_name,
    cast(is_active as boolean) as is_active,
    -- Anti-pattern: duplicated fiscal quarter logic (repeated in many models)
    case
        when extract(month from cast(inception_date as date)) between 1 and 3 then 'Q3'
        when extract(month from cast(inception_date as date)) between 4 and 6 then 'Q4'
        when extract(month from cast(inception_date as date)) between 7 and 9 then 'Q1'
        when extract(month from cast(inception_date as date)) between 10 and 12 then 'Q2'
    end as inception_fiscal_quarter
from "bain_analytics"."public_raw"."raw_portfolios"
where cast(is_active as boolean) = true
  );
[0m19:24:03.231827 [debug] [Thread-2  ]: On model.bain_capital_analytics.stg_positions: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_positions"} */

  create view "bain_analytics"."public"."stg_positions__dbt_tmp"
    
    
  as (
    -- Anti-pattern: unnecessary DISTINCT
-- Anti-pattern: no filtering or partitioning strategy

select distinct
    position_id,
    portfolio_id,
    instrument_id,
    cast(position_date as date) as position_date,
    cast(quantity as numeric(18,4)) as quantity,
    cast(market_value as numeric(18,2)) as market_value,
    cast(cost_basis as numeric(18,2)) as cost_basis,
    currency,
    -- Anti-pattern: computed column that could be done downstream
    cast(market_value as numeric(18,2)) - cast(cost_basis as numeric(18,2)) as unrealized_gain_loss,
    case
        when cast(cost_basis as numeric(18,2)) != 0
        then (cast(market_value as numeric(18,2)) - cast(cost_basis as numeric(18,2))) / abs(cast(cost_basis as numeric(18,2)))
        else 0
    end as unrealized_return_pct
from "bain_analytics"."public_raw"."raw_positions"
  );
[0m19:24:03.236208 [debug] [Thread-2  ]: SQL status: CREATE VIEW in 0.004 seconds
[0m19:24:03.236573 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.004 seconds
[0m19:24:03.242926 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.stg_positions"
[0m19:24:03.246072 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.stg_portfolios"
[0m19:24:03.246410 [debug] [Thread-2  ]: On model.bain_capital_analytics.stg_positions: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_positions"} */
alter table "bain_analytics"."public"."stg_positions" rename to "stg_positions__dbt_backup"
[0m19:24:03.246747 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_portfolios: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_portfolios"} */
alter table "bain_analytics"."public"."stg_portfolios" rename to "stg_portfolios__dbt_backup"
[0m19:24:03.247825 [debug] [Thread-2  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m19:24:03.248147 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m19:24:03.250955 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.stg_positions"
[0m19:24:03.254340 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.stg_portfolios"
[0m19:24:03.254660 [debug] [Thread-2  ]: On model.bain_capital_analytics.stg_positions: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_positions"} */
alter table "bain_analytics"."public"."stg_positions__dbt_tmp" rename to "stg_positions"
[0m19:24:03.254966 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_portfolios: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_portfolios"} */
alter table "bain_analytics"."public"."stg_portfolios__dbt_tmp" rename to "stg_portfolios"
[0m19:24:03.255839 [debug] [Thread-2  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m19:24:03.256164 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m19:24:03.272123 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_portfolios: COMMIT
[0m19:24:03.272487 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.stg_portfolios"
[0m19:24:03.273814 [debug] [Thread-2  ]: On model.bain_capital_analytics.stg_positions: COMMIT
[0m19:24:03.274122 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_portfolios: COMMIT
[0m19:24:03.274447 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.stg_positions"
[0m19:24:03.274779 [debug] [Thread-2  ]: On model.bain_capital_analytics.stg_positions: COMMIT
[0m19:24:03.276273 [debug] [Thread-1  ]: SQL status: COMMIT in 0.002 seconds
[0m19:24:03.276580 [debug] [Thread-2  ]: SQL status: COMMIT in 0.002 seconds
[0m19:24:03.282213 [debug] [Thread-1  ]: Applying DROP to: "bain_analytics"."public"."stg_portfolios__dbt_backup"
[0m19:24:03.284467 [debug] [Thread-2  ]: Applying DROP to: "bain_analytics"."public"."stg_positions__dbt_backup"
[0m19:24:03.287879 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.stg_portfolios"
[0m19:24:03.288345 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.stg_positions"
[0m19:24:03.288656 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_portfolios: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_portfolios"} */
drop view if exists "bain_analytics"."public"."stg_portfolios__dbt_backup" cascade
[0m19:24:03.288964 [debug] [Thread-2  ]: On model.bain_capital_analytics.stg_positions: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_positions"} */
drop view if exists "bain_analytics"."public"."stg_positions__dbt_backup" cascade
[0m19:24:04.293095 [debug] [Thread-1  ]: Postgres adapter: Postgres error: deadlock detected
DETAIL:  Process 4072 waits for AccessExclusiveLock on object 16509 of class 2618 of database 16384; blocked by process 4073.
Process 4073 waits for AccessExclusiveLock on object 16500 of class 2618 of database 16384; blocked by process 4072.
HINT:  See server log for query details.

[0m19:24:04.294392 [debug] [Thread-1  ]: Postgres adapter: Error running SQL: macro drop_relation
[0m19:24:04.294911 [debug] [Thread-1  ]: Postgres adapter: Rolling back transaction.
[0m19:24:04.295487 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_portfolios: Close
[0m19:24:04.303425 [debug] [Thread-2  ]: SQL status: DROP VIEW in 1.014 seconds
[0m19:24:04.306723 [debug] [Thread-2  ]: On model.bain_capital_analytics.stg_positions: Close
[0m19:24:04.313288 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a0a55c85-4ef5-4988-8f96-afef9afc9d67', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10cf025b0>]}
[0m19:24:04.314090 [info ] [Thread-2  ]: 2 of 14 OK created sql view model public.stg_positions ......................... [[32mCREATE VIEW[0m in 1.15s]
[0m19:24:04.315551 [debug] [Thread-2  ]: Finished running node model.bain_capital_analytics.stg_positions
[0m19:24:04.316239 [debug] [Thread-4  ]: Began running node test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c
[0m19:24:04.316627 [debug] [Thread-3  ]: Began running node test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1
[0m19:24:04.316975 [info ] [Thread-4  ]: 3 of 14 START test not_null_stg_positions_portfolio_id ......................... [RUN]
[0m19:24:04.317950 [debug] [Thread-2  ]: Began running node test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f
[0m19:24:04.318266 [info ] [Thread-3  ]: 4 of 14 START test not_null_stg_positions_position_id .......................... [RUN]
[0m19:24:04.318744 [debug] [Thread-4  ]: Acquiring new postgres connection 'test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c'
[0m19:24:04.319097 [info ] [Thread-2  ]: 5 of 14 START test unique_stg_positions_position_id ............................ [RUN]
[0m19:24:04.319527 [debug] [Thread-3  ]: Acquiring new postgres connection 'test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1'
[0m19:24:04.319916 [debug] [Thread-4  ]: Began compiling node test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c
[0m19:24:04.320273 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly model.bain_capital_analytics.stg_positions, now test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f)
[0m19:24:04.323585 [debug] [Thread-3  ]: Began compiling node test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1
[0m19:24:04.334786 [debug] [Thread-4  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c"
[0m19:24:04.335184 [debug] [Thread-2  ]: Began compiling node test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f
[0m19:24:04.344575 [debug] [Thread-3  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1"
[0m19:24:04.350366 [debug] [Thread-2  ]: Writing injected SQL for node "test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f"
[0m19:24:04.351111 [debug] [Thread-4  ]: Began executing node test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c
[0m19:24:04.357439 [debug] [Thread-3  ]: Began executing node test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1
[0m19:24:04.373144 [debug] [Thread-4  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c"
[0m19:24:04.373592 [debug] [Thread-2  ]: Began executing node test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f
[0m19:24:04.384032 [debug] [Thread-3  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1"
[0m19:24:04.389662 [debug] [Thread-2  ]: Writing runtime sql for node "test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f"
[0m19:24:04.393452 [debug] [Thread-4  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c"
[0m19:24:04.393960 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c: BEGIN
[0m19:24:04.394380 [debug] [Thread-3  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1"
[0m19:24:04.394737 [debug] [Thread-2  ]: Using postgres connection "test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f"
[0m19:24:04.395063 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m19:24:04.395759 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1: BEGIN
[0m19:24:04.396114 [debug] [Thread-2  ]: On test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f: BEGIN
[0m19:24:04.396624 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m19:24:04.396973 [debug] [Thread-2  ]: Opening a new connection, currently in state closed
[0m19:24:04.400519 [debug] [Thread-1  ]: Database Error in model stg_portfolios (models/staging/stg_portfolios.sql)
  deadlock detected
  DETAIL:  Process 4072 waits for AccessExclusiveLock on object 16509 of class 2618 of database 16384; blocked by process 4073.
  Process 4073 waits for AccessExclusiveLock on object 16500 of class 2618 of database 16384; blocked by process 4072.
  HINT:  See server log for query details.
  compiled code at target/run/bain_capital_analytics/models/staging/stg_portfolios.sql
[0m19:24:04.401016 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a0a55c85-4ef5-4988-8f96-afef9afc9d67', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10cf36df0>]}
[0m19:24:04.401600 [error] [Thread-1  ]: 1 of 14 ERROR creating sql view model public.stg_portfolios .................... [[31mERROR[0m in 1.24s]
[0m19:24:04.402091 [debug] [Thread-1  ]: Finished running node model.bain_capital_analytics.stg_portfolios
[0m19:24:04.402527 [debug] [Thread-7  ]: Marking all children of 'model.bain_capital_analytics.stg_portfolios' to be skipped because of status 'error'.  Reason: Database Error in model stg_portfolios (models/staging/stg_portfolios.sql)
  deadlock detected
  DETAIL:  Process 4072 waits for AccessExclusiveLock on object 16509 of class 2618 of database 16384; blocked by process 4073.
  Process 4073 waits for AccessExclusiveLock on object 16500 of class 2618 of database 16384; blocked by process 4072.
  HINT:  See server log for query details.
  compiled code at target/run/bain_capital_analytics/models/staging/stg_portfolios.sql.
[0m19:24:04.403163 [debug] [Thread-1  ]: Began running node test.bain_capital_analytics.not_null_stg_portfolios_fund_id.70b04d82bd
[0m19:24:04.403496 [info ] [Thread-1  ]: 6 of 14 SKIP test not_null_stg_portfolios_fund_id .............................. [[33mSKIP[0m]
[0m19:24:04.403827 [debug] [Thread-1  ]: Finished running node test.bain_capital_analytics.not_null_stg_portfolios_fund_id.70b04d82bd
[0m19:24:04.404140 [debug] [Thread-1  ]: Began running node test.bain_capital_analytics.not_null_stg_portfolios_portfolio_id.7126a480ec
[0m19:24:04.404417 [debug] [Thread-7  ]: Marking all children of 'test.bain_capital_analytics.not_null_stg_portfolios_fund_id.70b04d82bd' to be skipped because of status 'skipped'. 
[0m19:24:04.404722 [info ] [Thread-1  ]: 7 of 14 SKIP test not_null_stg_portfolios_portfolio_id ......................... [[33mSKIP[0m]
[0m19:24:04.405388 [debug] [Thread-1  ]: Finished running node test.bain_capital_analytics.not_null_stg_portfolios_portfolio_id.7126a480ec
[0m19:24:04.405872 [debug] [Thread-4  ]: SQL status: BEGIN in 0.011 seconds
[0m19:24:04.406305 [debug] [Thread-1  ]: Began running node test.bain_capital_analytics.relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_.2823f12709
[0m19:24:04.406651 [debug] [Thread-7  ]: Marking all children of 'test.bain_capital_analytics.not_null_stg_portfolios_portfolio_id.7126a480ec' to be skipped because of status 'skipped'. 
[0m19:24:04.407039 [debug] [Thread-4  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c"
[0m19:24:04.407596 [info ] [Thread-1  ]: 8 of 14 SKIP test relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_  [[33mSKIP[0m]
[0m19:24:04.408196 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select portfolio_id
from "bain_analytics"."public"."stg_positions"
where portfolio_id is null



  
  
      
    ) dbt_internal_test
[0m19:24:04.408572 [debug] [Thread-1  ]: Finished running node test.bain_capital_analytics.relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_.2823f12709
[0m19:24:04.408986 [debug] [Thread-1  ]: Began running node test.bain_capital_analytics.unique_stg_portfolios_portfolio_id.aa125b6658
[0m19:24:04.409582 [debug] [Thread-7  ]: Marking all children of 'test.bain_capital_analytics.relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_.2823f12709' to be skipped because of status 'skipped'. 
[0m19:24:04.409329 [info ] [Thread-1  ]: 9 of 14 SKIP test unique_stg_portfolios_portfolio_id ........................... [[33mSKIP[0m]
[0m19:24:04.410189 [debug] [Thread-1  ]: Finished running node test.bain_capital_analytics.unique_stg_portfolios_portfolio_id.aa125b6658
[0m19:24:04.410507 [debug] [Thread-7  ]: Marking all children of 'test.bain_capital_analytics.unique_stg_portfolios_portfolio_id.aa125b6658' to be skipped because of status 'skipped'. 
[0m19:24:04.410893 [debug] [Thread-4  ]: SQL status: SELECT 1 in 0.002 seconds
[0m19:24:04.411199 [debug] [Thread-2  ]: SQL status: BEGIN in 0.014 seconds
[0m19:24:04.411581 [debug] [Thread-3  ]: SQL status: BEGIN in 0.015 seconds
[0m19:24:04.414373 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c: ROLLBACK
[0m19:24:04.414723 [debug] [Thread-2  ]: Using postgres connection "test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f"
[0m19:24:04.415045 [debug] [Thread-3  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1"
[0m19:24:04.415401 [debug] [Thread-2  ]: On test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

select
    position_id as unique_field,
    count(*) as n_records

from "bain_analytics"."public"."stg_positions"
where position_id is not null
group by position_id
having count(*) > 1



  
  
      
    ) dbt_internal_test
[0m19:24:04.415736 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select position_id
from "bain_analytics"."public"."stg_positions"
where position_id is null



  
  
      
    ) dbt_internal_test
[0m19:24:04.416046 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c: Close
[0m19:24:04.416595 [info ] [Thread-4  ]: 3 of 14 PASS not_null_stg_positions_portfolio_id ............................... [[32mPASS[0m in 0.10s]
[0m19:24:04.417044 [debug] [Thread-4  ]: Finished running node test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c
[0m19:24:04.419223 [debug] [Thread-3  ]: SQL status: SELECT 1 in 0.003 seconds
[0m19:24:04.419583 [debug] [Thread-2  ]: SQL status: SELECT 1 in 0.003 seconds
[0m19:24:04.421581 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1: ROLLBACK
[0m19:24:04.422860 [debug] [Thread-2  ]: On test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f: ROLLBACK
[0m19:24:04.424188 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1: Close
[0m19:24:04.424593 [debug] [Thread-2  ]: On test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f: Close
[0m19:24:04.425187 [info ] [Thread-3  ]: 4 of 14 PASS not_null_stg_positions_position_id ................................ [[32mPASS[0m in 0.11s]
[0m19:24:04.425684 [debug] [Thread-3  ]: Finished running node test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1
[0m19:24:04.426170 [info ] [Thread-2  ]: 5 of 14 PASS unique_stg_positions_position_id .................................. [[32mPASS[0m in 0.11s]
[0m19:24:04.426769 [debug] [Thread-2  ]: Finished running node test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f
[0m19:24:04.427366 [debug] [Thread-1  ]: Began running node model.bain_capital_analytics.fact_portfolio_summary
[0m19:24:04.427734 [info ] [Thread-1  ]: 10 of 14 SKIP relation public.fact_portfolio_summary ........................... [[33mSKIP[0m]
[0m19:24:04.428122 [debug] [Thread-1  ]: Finished running node model.bain_capital_analytics.fact_portfolio_summary
[0m19:24:04.428412 [debug] [Thread-7  ]: Marking all children of 'model.bain_capital_analytics.fact_portfolio_summary' to be skipped because of status 'skipped'. 
[0m19:24:04.428898 [debug] [Thread-3  ]: Began running node test.bain_capital_analytics.not_null_fact_portfolio_summary_portfolio_id.98891ba523
[0m19:24:04.429271 [debug] [Thread-2  ]: Began running node test.bain_capital_analytics.not_null_fact_portfolio_summary_position_date.f6861b4961
[0m19:24:04.429596 [info ] [Thread-3  ]: 11 of 14 SKIP test not_null_fact_portfolio_summary_portfolio_id ................ [[33mSKIP[0m]
[0m19:24:04.429983 [info ] [Thread-2  ]: 12 of 14 SKIP test not_null_fact_portfolio_summary_position_date ............... [[33mSKIP[0m]
[0m19:24:04.430337 [debug] [Thread-3  ]: Finished running node test.bain_capital_analytics.not_null_fact_portfolio_summary_portfolio_id.98891ba523
[0m19:24:04.430651 [debug] [Thread-2  ]: Finished running node test.bain_capital_analytics.not_null_fact_portfolio_summary_position_date.f6861b4961
[0m19:24:04.430938 [debug] [Thread-7  ]: Marking all children of 'test.bain_capital_analytics.not_null_fact_portfolio_summary_portfolio_id.98891ba523' to be skipped because of status 'skipped'. 
[0m19:24:04.431274 [debug] [Thread-7  ]: Marking all children of 'test.bain_capital_analytics.not_null_fact_portfolio_summary_position_date.f6861b4961' to be skipped because of status 'skipped'. 
[0m19:24:04.431752 [debug] [Thread-1  ]: Began running node model.bain_capital_analytics.report_portfolio_overview
[0m19:24:04.432116 [info ] [Thread-1  ]: 13 of 14 SKIP relation public.report_portfolio_overview ........................ [[33mSKIP[0m]
[0m19:24:04.432459 [debug] [Thread-1  ]: Finished running node model.bain_capital_analytics.report_portfolio_overview
[0m19:24:04.432742 [debug] [Thread-7  ]: Marking all children of 'model.bain_capital_analytics.report_portfolio_overview' to be skipped because of status 'skipped'. 
[0m19:24:04.433147 [debug] [Thread-3  ]: Began running node test.bain_capital_analytics.not_null_report_portfolio_overview_portfolio_id.4930122a4f
[0m19:24:04.433549 [info ] [Thread-3  ]: 14 of 14 SKIP test not_null_report_portfolio_overview_portfolio_id ............. [[33mSKIP[0m]
[0m19:24:04.433925 [debug] [Thread-3  ]: Finished running node test.bain_capital_analytics.not_null_report_portfolio_overview_portfolio_id.4930122a4f
[0m19:24:04.434225 [debug] [Thread-7  ]: Marking all children of 'test.bain_capital_analytics.not_null_report_portfolio_overview_portfolio_id.4930122a4f' to be skipped because of status 'skipped'. 
[0m19:24:04.435091 [debug] [MainThread]: Using postgres connection "master"
[0m19:24:04.435358 [debug] [MainThread]: On master: BEGIN
[0m19:24:04.435592 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m19:24:04.447097 [debug] [MainThread]: SQL status: BEGIN in 0.011 seconds
[0m19:24:04.447389 [debug] [MainThread]: On master: COMMIT
[0m19:24:04.447651 [debug] [MainThread]: Using postgres connection "master"
[0m19:24:04.447888 [debug] [MainThread]: On master: COMMIT
[0m19:24:04.448476 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m19:24:04.448730 [debug] [MainThread]: On master: Close
[0m19:24:04.449053 [debug] [MainThread]: Connection 'master' was properly closed.
[0m19:24:04.449294 [debug] [MainThread]: Connection 'model.bain_capital_analytics.stg_portfolios' was properly closed.
[0m19:24:04.449519 [debug] [MainThread]: Connection 'test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f' was properly closed.
[0m19:24:04.449741 [debug] [MainThread]: Connection 'test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c' was properly closed.
[0m19:24:04.449959 [debug] [MainThread]: Connection 'test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1' was properly closed.
[0m19:24:04.450259 [info ] [MainThread]: 
[0m19:24:04.450530 [info ] [MainThread]: Finished running 10 data tests, 4 view models in 0 hours 0 minutes and 1.49 seconds (1.49s).
[0m19:24:04.451687 [debug] [MainThread]: Command end result
[0m19:24:04.526349 [debug] [MainThread]: Wrote artifact WritableManifest to ./target/manifest.json
[0m19:24:04.528284 [debug] [MainThread]: Wrote artifact SemanticManifest to ./target/semantic_manifest.json
[0m19:24:04.534672 [debug] [MainThread]: Wrote artifact RunExecutionResult to ./target/run_results.json
[0m19:24:04.534996 [info ] [MainThread]: 
[0m19:24:04.535331 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m19:24:04.535619 [info ] [MainThread]: 
[0m19:24:04.535957 [error] [MainThread]: [31mFailure in model stg_portfolios (models/staging/stg_portfolios.sql)[0m
[0m19:24:04.536281 [error] [MainThread]:   Database Error in model stg_portfolios (models/staging/stg_portfolios.sql)
  deadlock detected
  DETAIL:  Process 4072 waits for AccessExclusiveLock on object 16509 of class 2618 of database 16384; blocked by process 4073.
  Process 4073 waits for AccessExclusiveLock on object 16500 of class 2618 of database 16384; blocked by process 4072.
  HINT:  See server log for query details.
  compiled code at target/run/bain_capital_analytics/models/staging/stg_portfolios.sql
[0m19:24:04.536548 [info ] [MainThread]: 
[0m19:24:04.536845 [info ] [MainThread]:   compiled code at target/compiled/bain_capital_analytics/models/staging/stg_portfolios.sql
[0m19:24:04.537108 [info ] [MainThread]: 
[0m19:24:04.537396 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=1 SKIP=9 NO-OP=0 TOTAL=14
[0m19:24:04.540054 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": false, "command_wall_clock_time": 2.5609393, "process_in_blocks": "0", "process_kernel_time": 0.365414, "process_mem_max_rss": "137871360", "process_out_blocks": "0", "process_user_time": 2.509916}
[0m19:24:04.540414 [debug] [MainThread]: Command `dbt build` failed at 19:24:04.540343 after 2.56 seconds
[0m19:24:04.540922 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a64d190>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ca11eb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ca11f10>]}
[0m19:24:04.541264 [debug] [MainThread]: Flushing usage events
[0m19:24:06.302847 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m19:24:07.922833 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a9c2160>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ba6e730>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ba6e550>]}


============================== 19:24:07.926542 | 51f63fcd-b352-49c5-ac4e-b31e07bcdf23 ==============================
[0m19:24:07.926542 [info ] [MainThread]: Running with dbt=1.11.0-b3
[0m19:24:07.927054 [debug] [MainThread]: running dbt with arguments {'quiet': 'False', 'introspect': 'True', 'cache_selected_only': 'False', 'write_json': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'version_check': 'True', 'debug': 'False', 'target_path': 'None', 'use_experimental_parser': 'False', 'empty': 'False', 'warn_error': 'None', 'static_parser': 'True', 'log_cache_events': 'False', 'invocation_command': 'dbt build --select tag:pipeline_b --profiles-dir . --project-dir .', 'profiles_dir': '.', 'partial_parse': 'True', 'printer_width': '80', 'no_print': 'None', 'send_anonymous_usage_stats': 'True', 'use_colors': 'True', 'indirect_selection': 'eager', 'log_format': 'default', 'fail_fast': 'False', 'log_path': 'logs'}
[0m19:24:08.121349 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '51f63fcd-b352-49c5-ac4e-b31e07bcdf23', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c189190>]}
[0m19:24:08.197529 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '51f63fcd-b352-49c5-ac4e-b31e07bcdf23', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c024c10>]}
[0m19:24:08.198696 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m19:24:08.301752 [debug] [MainThread]: checksum: e63134dccc1251cfb572caf0e4aa952f030c125ee3634f3bf2c0a2e1bb6ae349, vars: {}, profile: , target: , version: 1.11.0b3
[0m19:24:08.516173 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m19:24:08.516616 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m19:24:08.579262 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '51f63fcd-b352-49c5-ac4e-b31e07bcdf23', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10cbcd130>]}
[0m19:24:08.705239 [debug] [MainThread]: Wrote artifact WritableManifest to ./target/manifest.json
[0m19:24:08.706987 [debug] [MainThread]: Wrote artifact SemanticManifest to ./target/semantic_manifest.json
[0m19:24:08.736447 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '51f63fcd-b352-49c5-ac4e-b31e07bcdf23', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10cb88520>]}
[0m19:24:08.736963 [info ] [MainThread]: Found 28 models, 53 data tests, 10 seeds, 569 macros
[0m19:24:08.740195 [info ] [MainThread]: 
[0m19:24:08.740503 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m19:24:08.740813 [info ] [MainThread]: 
[0m19:24:08.741330 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m19:24:08.745773 [debug] [ThreadPool]: Acquiring new postgres connection 'list_bain_analytics'
[0m19:24:08.792792 [debug] [ThreadPool]: Using postgres connection "list_bain_analytics"
[0m19:24:08.793266 [debug] [ThreadPool]: On list_bain_analytics: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "connection_name": "list_bain_analytics"} */

    select distinct nspname from pg_namespace
  
[0m19:24:08.793543 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m19:24:08.827727 [debug] [ThreadPool]: SQL status: SELECT 5 in 0.034 seconds
[0m19:24:08.829119 [debug] [ThreadPool]: On list_bain_analytics: Close
[0m19:24:08.832660 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_bain_analytics, now list_bain_analytics_public_raw)
[0m19:24:08.833164 [debug] [ThreadPool]: Acquiring new postgres connection 'list_bain_analytics_public'
[0m19:24:08.839190 [debug] [ThreadPool]: Using postgres connection "list_bain_analytics_public_raw"
[0m19:24:08.841847 [debug] [ThreadPool]: Using postgres connection "list_bain_analytics_public"
[0m19:24:08.842180 [debug] [ThreadPool]: On list_bain_analytics_public_raw: BEGIN
[0m19:24:08.842453 [debug] [ThreadPool]: On list_bain_analytics_public: BEGIN
[0m19:24:08.842718 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:24:08.842965 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m19:24:08.855836 [debug] [ThreadPool]: SQL status: BEGIN in 0.013 seconds
[0m19:24:08.856133 [debug] [ThreadPool]: Using postgres connection "list_bain_analytics_public_raw"
[0m19:24:08.856414 [debug] [ThreadPool]: On list_bain_analytics_public_raw: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "connection_name": "list_bain_analytics_public_raw"} */
select
      'bain_analytics' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_raw'
    union all
    select
      'bain_analytics' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_raw'
    union all
    select
      'bain_analytics' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_raw'
  
[0m19:24:08.857868 [debug] [ThreadPool]: SQL status: BEGIN in 0.015 seconds
[0m19:24:08.858143 [debug] [ThreadPool]: Using postgres connection "list_bain_analytics_public"
[0m19:24:08.858415 [debug] [ThreadPool]: On list_bain_analytics_public: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "connection_name": "list_bain_analytics_public"} */
select
      'bain_analytics' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'bain_analytics' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'bain_analytics' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m19:24:08.861787 [debug] [ThreadPool]: SQL status: SELECT 10 in 0.005 seconds
[0m19:24:08.862973 [debug] [ThreadPool]: On list_bain_analytics_public_raw: ROLLBACK
[0m19:24:08.863254 [debug] [ThreadPool]: SQL status: SELECT 21 in 0.005 seconds
[0m19:24:08.864423 [debug] [ThreadPool]: On list_bain_analytics_public: ROLLBACK
[0m19:24:08.864682 [debug] [ThreadPool]: On list_bain_analytics_public_raw: Close
[0m19:24:08.866166 [debug] [ThreadPool]: On list_bain_analytics_public: Close
[0m19:24:08.874508 [debug] [MainThread]: Using postgres connection "master"
[0m19:24:08.874795 [debug] [MainThread]: On master: BEGIN
[0m19:24:08.875036 [debug] [MainThread]: Opening a new connection, currently in state init
[0m19:24:08.885652 [debug] [MainThread]: SQL status: BEGIN in 0.011 seconds
[0m19:24:08.886050 [debug] [MainThread]: Using postgres connection "master"
[0m19:24:08.886390 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "connection_name": "master"} */
select distinct
        dependent_namespace.nspname as dependent_schema,
        dependent_class.relname as dependent_name,
        referenced_namespace.nspname as referenced_schema,
        referenced_class.relname as referenced_name

    -- Query for views: views are entries in pg_class with an entry in pg_rewrite, but we avoid
    -- a seq scan on pg_rewrite by leveraging the fact there is an "internal" row in pg_depend for
    -- the view...
    from pg_class as dependent_class
    join pg_namespace as dependent_namespace on dependent_namespace.oid = dependent_class.relnamespace
    join pg_depend as dependent_depend on dependent_depend.refobjid = dependent_class.oid
        and dependent_depend.classid = 'pg_rewrite'::regclass
        and dependent_depend.refclassid = 'pg_class'::regclass
        and dependent_depend.deptype = 'i'

    -- ... and via pg_depend (that has a row per column, hence the need for "distinct" above, and
    -- making sure to exclude the internal row to avoid a view appearing to depend on itself)...
    join pg_depend as joining_depend on joining_depend.objid = dependent_depend.objid
        and joining_depend.classid = 'pg_rewrite'::regclass
        and joining_depend.refclassid = 'pg_class'::regclass
        and joining_depend.refobjid != dependent_depend.refobjid

    -- ... we can find the tables they query from in pg_class, but excluding system tables. Note we
    -- don't need need to exclude _dependent_ system tables, because they only query from other
    -- system tables, and so are automatically excluded by excluding _referenced_ system tables
    join pg_class as referenced_class on referenced_class.oid = joining_depend.refobjid
    join pg_namespace as referenced_namespace on referenced_namespace.oid = referenced_class.relnamespace
        and referenced_namespace.nspname != 'information_schema'
        and referenced_namespace.nspname not like 'pg\_%'

    order by
        dependent_schema, dependent_name, referenced_schema, referenced_name;
[0m19:24:08.892732 [debug] [MainThread]: SQL status: SELECT 43 in 0.006 seconds
[0m19:24:08.899921 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '51f63fcd-b352-49c5-ac4e-b31e07bcdf23', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10cd54760>]}
[0m19:24:08.901219 [debug] [MainThread]: On master: ROLLBACK
[0m19:24:08.901894 [debug] [MainThread]: Using postgres connection "master"
[0m19:24:08.902199 [debug] [MainThread]: On master: BEGIN
[0m19:24:08.903079 [debug] [MainThread]: SQL status: BEGIN in 0.001 seconds
[0m19:24:08.905347 [debug] [MainThread]: On master: COMMIT
[0m19:24:08.905918 [debug] [MainThread]: Using postgres connection "master"
[0m19:24:08.906195 [debug] [MainThread]: On master: COMMIT
[0m19:24:08.906728 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m19:24:08.907107 [debug] [MainThread]: On master: Close
[0m19:24:08.909671 [debug] [Thread-1  ]: Began running node model.bain_capital_analytics.stg_benchmarks
[0m19:24:08.910051 [debug] [Thread-2  ]: Began running node model.bain_capital_analytics.stg_counterparties
[0m19:24:08.910541 [info ] [Thread-1  ]: 1 of 40 START sql view model public.stg_benchmarks ............................. [RUN]
[0m19:24:08.910917 [debug] [Thread-3  ]: Began running node model.bain_capital_analytics.stg_dates
[0m19:24:08.911308 [info ] [Thread-2  ]: 2 of 40 START sql view model public.stg_counterparties ......................... [RUN]
[0m19:24:08.911669 [debug] [Thread-4  ]: Began running node model.bain_capital_analytics.stg_instruments
[0m19:24:08.912090 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_bain_analytics_public_raw, now model.bain_capital_analytics.stg_benchmarks)
[0m19:24:08.912515 [info ] [Thread-3  ]: 3 of 40 START sql view model public.stg_dates .................................. [RUN]
[0m19:24:08.912883 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly list_bain_analytics_public, now model.bain_capital_analytics.stg_counterparties)
[0m19:24:08.913276 [info ] [Thread-4  ]: 4 of 40 START sql view model public.stg_instruments ............................ [RUN]
[0m19:24:08.913610 [debug] [Thread-1  ]: Began compiling node model.bain_capital_analytics.stg_benchmarks
[0m19:24:08.913994 [debug] [Thread-3  ]: Acquiring new postgres connection 'model.bain_capital_analytics.stg_dates'
[0m19:24:08.914298 [debug] [Thread-2  ]: Began compiling node model.bain_capital_analytics.stg_counterparties
[0m19:24:08.914664 [debug] [Thread-4  ]: Acquiring new postgres connection 'model.bain_capital_analytics.stg_instruments'
[0m19:24:08.922746 [debug] [Thread-1  ]: Writing injected SQL for node "model.bain_capital_analytics.stg_benchmarks"
[0m19:24:08.923083 [debug] [Thread-3  ]: Began compiling node model.bain_capital_analytics.stg_dates
[0m19:24:08.925900 [debug] [Thread-2  ]: Writing injected SQL for node "model.bain_capital_analytics.stg_counterparties"
[0m19:24:08.926264 [debug] [Thread-4  ]: Began compiling node model.bain_capital_analytics.stg_instruments
[0m19:24:08.929938 [debug] [Thread-3  ]: Writing injected SQL for node "model.bain_capital_analytics.stg_dates"
[0m19:24:08.932605 [debug] [Thread-4  ]: Writing injected SQL for node "model.bain_capital_analytics.stg_instruments"
[0m19:24:08.932956 [debug] [Thread-1  ]: Began executing node model.bain_capital_analytics.stg_benchmarks
[0m19:24:08.933408 [debug] [Thread-2  ]: Began executing node model.bain_capital_analytics.stg_counterparties
[0m19:24:08.958085 [debug] [Thread-3  ]: Began executing node model.bain_capital_analytics.stg_dates
[0m19:24:08.979205 [debug] [Thread-1  ]: Writing runtime sql for node "model.bain_capital_analytics.stg_benchmarks"
[0m19:24:08.979606 [debug] [Thread-4  ]: Began executing node model.bain_capital_analytics.stg_instruments
[0m19:24:08.981524 [debug] [Thread-2  ]: Writing runtime sql for node "model.bain_capital_analytics.stg_counterparties"
[0m19:24:08.982313 [debug] [Thread-3  ]: Writing runtime sql for node "model.bain_capital_analytics.stg_dates"
[0m19:24:08.985836 [debug] [Thread-4  ]: Writing runtime sql for node "model.bain_capital_analytics.stg_instruments"
[0m19:24:08.986500 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.stg_counterparties"
[0m19:24:08.986868 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.stg_benchmarks"
[0m19:24:08.987209 [debug] [Thread-2  ]: On model.bain_capital_analytics.stg_counterparties: BEGIN
[0m19:24:08.987574 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_benchmarks: BEGIN
[0m19:24:08.987924 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.stg_instruments"
[0m19:24:08.988237 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.stg_dates"
[0m19:24:08.988521 [debug] [Thread-2  ]: Opening a new connection, currently in state closed
[0m19:24:08.988824 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m19:24:08.989121 [debug] [Thread-4  ]: On model.bain_capital_analytics.stg_instruments: BEGIN
[0m19:24:08.989417 [debug] [Thread-3  ]: On model.bain_capital_analytics.stg_dates: BEGIN
[0m19:24:08.989998 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m19:24:08.990302 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m19:24:09.006634 [debug] [Thread-3  ]: SQL status: BEGIN in 0.016 seconds
[0m19:24:09.006975 [debug] [Thread-2  ]: SQL status: BEGIN in 0.018 seconds
[0m19:24:09.007294 [debug] [Thread-1  ]: SQL status: BEGIN in 0.018 seconds
[0m19:24:09.007638 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.stg_dates"
[0m19:24:09.007925 [debug] [Thread-4  ]: SQL status: BEGIN in 0.018 seconds
[0m19:24:09.008222 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.stg_counterparties"
[0m19:24:09.008518 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.stg_benchmarks"
[0m19:24:09.008840 [debug] [Thread-3  ]: On model.bain_capital_analytics.stg_dates: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_dates"} */

  create view "bain_analytics"."public"."stg_dates__dbt_tmp"
    
    
  as (
    select
    cast(date_day as date) as date_day,
    cast(is_business_day as boolean) as is_business_day,
    cast(is_month_end as boolean) as is_month_end,
    cast(is_quarter_end as boolean) as is_quarter_end,
    cast(is_year_end as boolean) as is_year_end,
    fiscal_quarter,
    fiscal_year,
    -- Anti-pattern: PostgreSQL-specific date_trunc
    date_trunc('month', cast(date_day as date)) as month_start,
    date_trunc('quarter', cast(date_day as date)) as quarter_start,
    extract(month from cast(date_day as date)) as calendar_month,
    extract(year from cast(date_day as date)) as calendar_year
from "bain_analytics"."public_raw"."raw_dates"
  );
[0m19:24:09.009161 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.stg_instruments"
[0m19:24:09.009469 [debug] [Thread-2  ]: On model.bain_capital_analytics.stg_counterparties: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_counterparties"} */

  create view "bain_analytics"."public"."stg_counterparties__dbt_tmp"
    
    
  as (
    select distinct
    counterparty_id,
    counterparty_name,
    counterparty_type,
    country,
    credit_rating,
    cast(is_active as boolean) as is_active
from "bain_analytics"."public_raw"."raw_counterparties"
where cast(is_active as boolean) = true
  );
[0m19:24:09.009811 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_benchmarks: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_benchmarks"} */

  create view "bain_analytics"."public"."stg_benchmarks__dbt_tmp"
    
    
  as (
    select distinct
    benchmark_id,
    benchmark_name,
    cast(benchmark_date as date) as benchmark_date,
    cast(return_daily as numeric(18,8)) as return_daily,
    cast(return_mtd as numeric(18,8)) as return_mtd,
    cast(return_ytd as numeric(18,8)) as return_ytd,
    cast(benchmark_level as numeric(18,4)) as benchmark_level,
    -- Anti-pattern: duplicated fiscal quarter logic
    case
        when extract(month from cast(benchmark_date as date)) between 1 and 3 then 'Q3'
        when extract(month from cast(benchmark_date as date)) between 4 and 6 then 'Q4'
        when extract(month from cast(benchmark_date as date)) between 7 and 9 then 'Q1'
        when extract(month from cast(benchmark_date as date)) between 10 and 12 then 'Q2'
    end as benchmark_fiscal_quarter
from "bain_analytics"."public_raw"."raw_benchmarks"
  );
[0m19:24:09.010215 [debug] [Thread-4  ]: On model.bain_capital_analytics.stg_instruments: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_instruments"} */

  create view "bain_analytics"."public"."stg_instruments__dbt_tmp"
    
    
  as (
    -- Anti-pattern: unnecessary DISTINCT
select distinct
    instrument_id,
    instrument_name,
    instrument_type,
    sector,
    currency,
    exchange,
    issuer,
    cast(maturity_date as date) as maturity_date,
    -- Anti-pattern: PostgreSQL-specific date subtraction
    case
        when maturity_date is not null
        then cast(maturity_date as date) - current_date
        else null
    end as days_to_maturity,
    case
        when instrument_type in ('equity', 'futures') then 'liquid'
        when instrument_type in ('corporate_bond', 'government_bond', 'sovereign_bond', 'leveraged_loan') then 'semi_liquid'
        when instrument_type in ('private_equity', 'venture_capital', 'real_estate', 'real_estate_debt', 'infrastructure') then 'illiquid'
        else 'other'
    end as liquidity_class
from "bain_analytics"."public_raw"."raw_instruments"
  );
[0m19:24:09.013290 [debug] [Thread-3  ]: SQL status: CREATE VIEW in 0.003 seconds
[0m19:24:09.019228 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.stg_dates"
[0m19:24:09.019572 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.009 seconds
[0m19:24:09.019858 [debug] [Thread-4  ]: SQL status: CREATE VIEW in 0.009 seconds
[0m19:24:09.020133 [debug] [Thread-2  ]: SQL status: CREATE VIEW in 0.010 seconds
[0m19:24:09.020412 [debug] [Thread-3  ]: On model.bain_capital_analytics.stg_dates: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_dates"} */
alter table "bain_analytics"."public"."stg_dates" rename to "stg_dates__dbt_backup"
[0m19:24:09.023397 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.stg_benchmarks"
[0m19:24:09.026367 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.stg_instruments"
[0m19:24:09.029172 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.stg_counterparties"
[0m19:24:09.029539 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_benchmarks: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_benchmarks"} */
alter table "bain_analytics"."public"."stg_benchmarks" rename to "stg_benchmarks__dbt_backup"
[0m19:24:09.029863 [debug] [Thread-4  ]: On model.bain_capital_analytics.stg_instruments: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_instruments"} */
alter table "bain_analytics"."public"."stg_instruments" rename to "stg_instruments__dbt_backup"
[0m19:24:09.030165 [debug] [Thread-2  ]: On model.bain_capital_analytics.stg_counterparties: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_counterparties"} */
alter table "bain_analytics"."public"."stg_counterparties" rename to "stg_counterparties__dbt_backup"
[0m19:24:09.030657 [debug] [Thread-3  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m19:24:09.033753 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.stg_dates"
[0m19:24:09.034059 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.004 seconds
[0m19:24:09.034334 [debug] [Thread-2  ]: SQL status: ALTER TABLE in 0.004 seconds
[0m19:24:09.034596 [debug] [Thread-4  ]: SQL status: ALTER TABLE in 0.004 seconds
[0m19:24:09.034874 [debug] [Thread-3  ]: On model.bain_capital_analytics.stg_dates: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_dates"} */
alter table "bain_analytics"."public"."stg_dates__dbt_tmp" rename to "stg_dates"
[0m19:24:09.037531 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.stg_benchmarks"
[0m19:24:09.040074 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.stg_counterparties"
[0m19:24:09.042647 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.stg_instruments"
[0m19:24:09.042999 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_benchmarks: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_benchmarks"} */
alter table "bain_analytics"."public"."stg_benchmarks__dbt_tmp" rename to "stg_benchmarks"
[0m19:24:09.043313 [debug] [Thread-2  ]: On model.bain_capital_analytics.stg_counterparties: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_counterparties"} */
alter table "bain_analytics"."public"."stg_counterparties__dbt_tmp" rename to "stg_counterparties"
[0m19:24:09.043615 [debug] [Thread-4  ]: On model.bain_capital_analytics.stg_instruments: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_instruments"} */
alter table "bain_analytics"."public"."stg_instruments__dbt_tmp" rename to "stg_instruments"
[0m19:24:09.044215 [debug] [Thread-3  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m19:24:09.051419 [debug] [Thread-2  ]: SQL status: ALTER TABLE in 0.007 seconds
[0m19:24:09.057504 [debug] [Thread-4  ]: SQL status: ALTER TABLE in 0.013 seconds
[0m19:24:09.058612 [debug] [Thread-3  ]: On model.bain_capital_analytics.stg_dates: COMMIT
[0m19:24:09.058917 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.015 seconds
[0m19:24:09.059945 [debug] [Thread-2  ]: On model.bain_capital_analytics.stg_counterparties: COMMIT
[0m19:24:09.061037 [debug] [Thread-4  ]: On model.bain_capital_analytics.stg_instruments: COMMIT
[0m19:24:09.061356 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.stg_dates"
[0m19:24:09.062320 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_benchmarks: COMMIT
[0m19:24:09.062631 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.stg_counterparties"
[0m19:24:09.062924 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.stg_instruments"
[0m19:24:09.063208 [debug] [Thread-3  ]: On model.bain_capital_analytics.stg_dates: COMMIT
[0m19:24:09.063504 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.stg_benchmarks"
[0m19:24:09.063789 [debug] [Thread-2  ]: On model.bain_capital_analytics.stg_counterparties: COMMIT
[0m19:24:09.064073 [debug] [Thread-4  ]: On model.bain_capital_analytics.stg_instruments: COMMIT
[0m19:24:09.064396 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_benchmarks: COMMIT
[0m19:24:09.067178 [debug] [Thread-3  ]: SQL status: COMMIT in 0.003 seconds
[0m19:24:09.072544 [debug] [Thread-3  ]: Applying DROP to: "bain_analytics"."public"."stg_dates__dbt_backup"
[0m19:24:09.072885 [debug] [Thread-2  ]: SQL status: COMMIT in 0.008 seconds
[0m19:24:09.073199 [debug] [Thread-4  ]: SQL status: COMMIT in 0.008 seconds
[0m19:24:09.073473 [debug] [Thread-1  ]: SQL status: COMMIT in 0.009 seconds
[0m19:24:09.077028 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.stg_dates"
[0m19:24:09.120431 [debug] [Thread-2  ]: Applying DROP to: "bain_analytics"."public"."stg_counterparties__dbt_backup"
[0m19:24:09.123018 [debug] [Thread-4  ]: Applying DROP to: "bain_analytics"."public"."stg_instruments__dbt_backup"
[0m19:24:09.125410 [debug] [Thread-1  ]: Applying DROP to: "bain_analytics"."public"."stg_benchmarks__dbt_backup"
[0m19:24:09.125803 [debug] [Thread-3  ]: On model.bain_capital_analytics.stg_dates: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_dates"} */
drop view if exists "bain_analytics"."public"."stg_dates__dbt_backup" cascade
[0m19:24:09.126354 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.stg_counterparties"
[0m19:24:09.126896 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.stg_instruments"
[0m19:24:09.127521 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.stg_benchmarks"
[0m19:24:09.127931 [debug] [Thread-2  ]: On model.bain_capital_analytics.stg_counterparties: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_counterparties"} */
drop view if exists "bain_analytics"."public"."stg_counterparties__dbt_backup" cascade
[0m19:24:09.128258 [debug] [Thread-4  ]: On model.bain_capital_analytics.stg_instruments: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_instruments"} */
drop view if exists "bain_analytics"."public"."stg_instruments__dbt_backup" cascade
[0m19:24:09.128568 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_benchmarks: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_benchmarks"} */
drop view if exists "bain_analytics"."public"."stg_benchmarks__dbt_backup" cascade
[0m19:24:09.134870 [debug] [Thread-3  ]: SQL status: DROP VIEW in 0.007 seconds
[0m19:24:09.137054 [debug] [Thread-3  ]: On model.bain_capital_analytics.stg_dates: Close
[0m19:24:09.137380 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.008 seconds
[0m19:24:09.139014 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_benchmarks: Close
[0m19:24:09.139340 [debug] [Thread-4  ]: SQL status: DROP VIEW in 0.010 seconds
[0m19:24:09.139669 [debug] [Thread-2  ]: SQL status: DROP VIEW in 0.011 seconds
[0m19:24:09.142343 [debug] [Thread-4  ]: On model.bain_capital_analytics.stg_instruments: Close
[0m19:24:09.143466 [debug] [Thread-2  ]: On model.bain_capital_analytics.stg_counterparties: Close
[0m19:24:09.144139 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '51f63fcd-b352-49c5-ac4e-b31e07bcdf23', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d346550>]}
[0m19:24:09.144432 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '51f63fcd-b352-49c5-ac4e-b31e07bcdf23', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d277df0>]}
[0m19:24:09.144779 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '51f63fcd-b352-49c5-ac4e-b31e07bcdf23', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d352a00>]}
[0m19:24:09.145226 [info ] [Thread-1  ]: 1 of 40 OK created sql view model public.stg_benchmarks ........................ [[32mCREATE VIEW[0m in 0.23s]
[0m19:24:09.145518 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '51f63fcd-b352-49c5-ac4e-b31e07bcdf23', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d288dc0>]}
[0m19:24:09.145987 [info ] [Thread-3  ]: 3 of 40 OK created sql view model public.stg_dates ............................. [[32mCREATE VIEW[0m in 0.22s]
[0m19:24:09.146466 [info ] [Thread-4  ]: 4 of 40 OK created sql view model public.stg_instruments ....................... [[32mCREATE VIEW[0m in 0.23s]
[0m19:24:09.146928 [debug] [Thread-1  ]: Finished running node model.bain_capital_analytics.stg_benchmarks
[0m19:24:09.147375 [info ] [Thread-2  ]: 2 of 40 OK created sql view model public.stg_counterparties .................... [[32mCREATE VIEW[0m in 0.23s]
[0m19:24:09.147813 [debug] [Thread-3  ]: Finished running node model.bain_capital_analytics.stg_dates
[0m19:24:09.148219 [debug] [Thread-4  ]: Finished running node model.bain_capital_analytics.stg_instruments
[0m19:24:09.148553 [debug] [Thread-1  ]: Began running node model.bain_capital_analytics.stg_portfolios
[0m19:24:09.149086 [debug] [Thread-2  ]: Finished running node model.bain_capital_analytics.stg_counterparties
[0m19:24:09.149547 [debug] [Thread-3  ]: Began running node model.bain_capital_analytics.stg_positions
[0m19:24:09.149941 [debug] [Thread-4  ]: Began running node model.bain_capital_analytics.stg_trades
[0m19:24:09.150445 [info ] [Thread-1  ]: 5 of 40 START sql view model public.stg_portfolios ............................. [RUN]
[0m19:24:09.150856 [debug] [Thread-2  ]: Began running node test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_date.d5c8f88f3e
[0m19:24:09.151277 [info ] [Thread-3  ]: 6 of 40 START sql view model public.stg_positions .............................. [RUN]
[0m19:24:09.151740 [info ] [Thread-4  ]: 7 of 40 START sql view model public.stg_trades ................................. [RUN]
[0m19:24:09.152124 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.bain_capital_analytics.stg_benchmarks, now model.bain_capital_analytics.stg_portfolios)
[0m19:24:09.152454 [info ] [Thread-2  ]: 8 of 40 START test not_null_stg_benchmarks_benchmark_date ...................... [RUN]
[0m19:24:09.152790 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly model.bain_capital_analytics.stg_dates, now model.bain_capital_analytics.stg_positions)
[0m19:24:09.153108 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly model.bain_capital_analytics.stg_instruments, now model.bain_capital_analytics.stg_trades)
[0m19:24:09.153417 [debug] [Thread-1  ]: Began compiling node model.bain_capital_analytics.stg_portfolios
[0m19:24:09.153733 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly model.bain_capital_analytics.stg_counterparties, now test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_date.d5c8f88f3e)
[0m19:24:09.154036 [debug] [Thread-3  ]: Began compiling node model.bain_capital_analytics.stg_positions
[0m19:24:09.154319 [debug] [Thread-4  ]: Began compiling node model.bain_capital_analytics.stg_trades
[0m19:24:09.157388 [debug] [Thread-1  ]: Writing injected SQL for node "model.bain_capital_analytics.stg_portfolios"
[0m19:24:09.157706 [debug] [Thread-2  ]: Began compiling node test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_date.d5c8f88f3e
[0m19:24:09.160288 [debug] [Thread-3  ]: Writing injected SQL for node "model.bain_capital_analytics.stg_positions"
[0m19:24:09.163983 [debug] [Thread-4  ]: Writing injected SQL for node "model.bain_capital_analytics.stg_trades"
[0m19:24:09.174022 [debug] [Thread-2  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_date.d5c8f88f3e"
[0m19:24:09.174738 [debug] [Thread-1  ]: Began executing node model.bain_capital_analytics.stg_portfolios
[0m19:24:09.179875 [debug] [Thread-1  ]: Applying DROP to: "bain_analytics"."public"."stg_portfolios__dbt_backup"
[0m19:24:09.180205 [debug] [Thread-3  ]: Began executing node model.bain_capital_analytics.stg_positions
[0m19:24:09.180524 [debug] [Thread-4  ]: Began executing node model.bain_capital_analytics.stg_trades
[0m19:24:09.181007 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.stg_portfolios"
[0m19:24:09.181322 [debug] [Thread-2  ]: Began executing node test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_date.d5c8f88f3e
[0m19:24:09.184582 [debug] [Thread-3  ]: Writing runtime sql for node "model.bain_capital_analytics.stg_positions"
[0m19:24:09.188582 [debug] [Thread-4  ]: Writing runtime sql for node "model.bain_capital_analytics.stg_trades"
[0m19:24:09.188919 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_portfolios: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_portfolios"} */
drop view if exists "bain_analytics"."public"."stg_portfolios__dbt_backup" cascade
[0m19:24:09.204253 [debug] [Thread-2  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_date.d5c8f88f3e"
[0m19:24:09.204710 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m19:24:09.205412 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.stg_trades"
[0m19:24:09.205742 [debug] [Thread-4  ]: On model.bain_capital_analytics.stg_trades: BEGIN
[0m19:24:09.206093 [debug] [Thread-2  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_date.d5c8f88f3e"
[0m19:24:09.206440 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.stg_positions"
[0m19:24:09.206726 [debug] [Thread-4  ]: Opening a new connection, currently in state closed
[0m19:24:09.207035 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_date.d5c8f88f3e: BEGIN
[0m19:24:09.207423 [debug] [Thread-3  ]: On model.bain_capital_analytics.stg_positions: BEGIN
[0m19:24:09.207848 [debug] [Thread-2  ]: Opening a new connection, currently in state closed
[0m19:24:09.208142 [debug] [Thread-3  ]: Opening a new connection, currently in state closed
[0m19:24:09.220244 [debug] [Thread-3  ]: SQL status: BEGIN in 0.012 seconds
[0m19:24:09.220573 [debug] [Thread-4  ]: SQL status: BEGIN in 0.014 seconds
[0m19:24:09.220864 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.stg_positions"
[0m19:24:09.221139 [debug] [Thread-2  ]: SQL status: BEGIN in 0.013 seconds
[0m19:24:09.221433 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.stg_trades"
[0m19:24:09.221761 [debug] [Thread-3  ]: On model.bain_capital_analytics.stg_positions: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_positions"} */

  create view "bain_analytics"."public"."stg_positions__dbt_tmp"
    
    
  as (
    -- Anti-pattern: unnecessary DISTINCT
-- Anti-pattern: no filtering or partitioning strategy

select distinct
    position_id,
    portfolio_id,
    instrument_id,
    cast(position_date as date) as position_date,
    cast(quantity as numeric(18,4)) as quantity,
    cast(market_value as numeric(18,2)) as market_value,
    cast(cost_basis as numeric(18,2)) as cost_basis,
    currency,
    -- Anti-pattern: computed column that could be done downstream
    cast(market_value as numeric(18,2)) - cast(cost_basis as numeric(18,2)) as unrealized_gain_loss,
    case
        when cast(cost_basis as numeric(18,2)) != 0
        then (cast(market_value as numeric(18,2)) - cast(cost_basis as numeric(18,2))) / abs(cast(cost_basis as numeric(18,2)))
        else 0
    end as unrealized_return_pct
from "bain_analytics"."public_raw"."raw_positions"
  );
[0m19:24:09.222088 [debug] [Thread-2  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_date.d5c8f88f3e"
[0m19:24:09.222426 [debug] [Thread-4  ]: On model.bain_capital_analytics.stg_trades: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_trades"} */

  create view "bain_analytics"."public"."stg_trades__dbt_tmp"
    
    
  as (
    -- Anti-pattern: unnecessary DISTINCT on already-unique trade_id
-- Anti-pattern: heavy casting repeated everywhere

select distinct
    trade_id,
    portfolio_id,
    instrument_id,
    counterparty_id,
    cast(trade_date as date) as trade_date,
    cast(settlement_date as date) as settlement_date,
    trade_type,
    cast(quantity as numeric(18,4)) as quantity,
    cast(price as numeric(18,6)) as price,
    cast(notional_amount as numeric(18,2)) as notional_amount,
    cast(commission as numeric(18,2)) as commission,
    currency,
    status,
    -- Anti-pattern: duplicated fiscal quarter logic
    case
        when extract(month from cast(trade_date as date)) between 1 and 3 then 'Q3'
        when extract(month from cast(trade_date as date)) between 4 and 6 then 'Q4'
        when extract(month from cast(trade_date as date)) between 7 and 9 then 'Q1'
        when extract(month from cast(trade_date as date)) between 10 and 12 then 'Q2'
    end as trade_fiscal_quarter,
    -- Anti-pattern: PostgreSQL-specific date arithmetic
    cast(settlement_date as date) - cast(trade_date as date) as settlement_days
from "bain_analytics"."public_raw"."raw_trades"
where status = 'settled'
  );
[0m19:24:09.222839 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_date.d5c8f88f3e: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_date.d5c8f88f3e"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select benchmark_date
from "bain_analytics"."public"."stg_benchmarks"
where benchmark_date is null



  
  
      
    ) dbt_internal_test
[0m19:24:09.225382 [debug] [Thread-2  ]: SQL status: SELECT 1 in 0.002 seconds
[0m19:24:09.228185 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_date.d5c8f88f3e: ROLLBACK
[0m19:24:09.228523 [debug] [Thread-4  ]: SQL status: CREATE VIEW in 0.005 seconds
[0m19:24:09.228840 [debug] [Thread-3  ]: SQL status: CREATE VIEW in 0.006 seconds
[0m19:24:09.229153 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.024 seconds
[0m19:24:09.229437 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_date.d5c8f88f3e: Close
[0m19:24:09.232695 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.stg_trades"
[0m19:24:09.235584 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.stg_positions"
[0m19:24:09.236663 [debug] [Thread-1  ]: Writing runtime sql for node "model.bain_capital_analytics.stg_portfolios"
[0m19:24:09.237177 [info ] [Thread-2  ]: 8 of 40 PASS not_null_stg_benchmarks_benchmark_date ............................ [[32mPASS[0m in 0.08s]
[0m19:24:09.237509 [debug] [Thread-4  ]: On model.bain_capital_analytics.stg_trades: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_trades"} */
alter table "bain_analytics"."public"."stg_trades" rename to "stg_trades__dbt_backup"
[0m19:24:09.237818 [debug] [Thread-3  ]: On model.bain_capital_analytics.stg_positions: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_positions"} */
alter table "bain_analytics"."public"."stg_positions" rename to "stg_positions__dbt_backup"
[0m19:24:09.238329 [debug] [Thread-2  ]: Finished running node test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_date.d5c8f88f3e
[0m19:24:09.238776 [debug] [Thread-2  ]: Began running node test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_id.ec87e4ee58
[0m19:24:09.239172 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.stg_portfolios"
[0m19:24:09.239723 [debug] [Thread-4  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m19:24:09.239483 [info ] [Thread-2  ]: 9 of 40 START test not_null_stg_benchmarks_benchmark_id ........................ [RUN]
[0m19:24:09.240114 [debug] [Thread-3  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m19:24:09.240392 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_portfolios: BEGIN
[0m19:24:09.243004 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.stg_trades"
[0m19:24:09.243348 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_date.d5c8f88f3e, now test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_id.ec87e4ee58)
[0m19:24:09.245949 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.stg_positions"
[0m19:24:09.246301 [debug] [Thread-4  ]: On model.bain_capital_analytics.stg_trades: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_trades"} */
alter table "bain_analytics"."public"."stg_trades__dbt_tmp" rename to "stg_trades"
[0m19:24:09.246614 [debug] [Thread-2  ]: Began compiling node test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_id.ec87e4ee58
[0m19:24:09.246916 [debug] [Thread-1  ]: SQL status: BEGIN in 0.001 seconds
[0m19:24:09.247192 [debug] [Thread-3  ]: On model.bain_capital_analytics.stg_positions: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_positions"} */
alter table "bain_analytics"."public"."stg_positions__dbt_tmp" rename to "stg_positions"
[0m19:24:09.251668 [debug] [Thread-2  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_id.ec87e4ee58"
[0m19:24:09.251986 [debug] [Thread-4  ]: SQL status: ALTER TABLE in 0.004 seconds
[0m19:24:09.252264 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.stg_portfolios"
[0m19:24:09.253352 [debug] [Thread-4  ]: On model.bain_capital_analytics.stg_trades: COMMIT
[0m19:24:09.253673 [debug] [Thread-3  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m19:24:09.254000 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_portfolios: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_portfolios"} */

  create view "bain_analytics"."public"."stg_portfolios__dbt_tmp"
    
    
  as (
    -- Anti-pattern: unnecessary DISTINCT when source data is already unique
-- Anti-pattern: casting in every model instead of once upstream

select distinct
    cast(portfolio_id as varchar(10)) as portfolio_id,
    cast(portfolio_name as varchar(100)) as portfolio_name,
    cast(strategy as varchar(50)) as strategy,
    cast(inception_date as date) as inception_date,
    cast(fund_id as varchar(10)) as fund_id,
    cast(manager_name as varchar(100)) as manager_name,
    cast(is_active as boolean) as is_active,
    -- Anti-pattern: duplicated fiscal quarter logic (repeated in many models)
    case
        when extract(month from cast(inception_date as date)) between 1 and 3 then 'Q3'
        when extract(month from cast(inception_date as date)) between 4 and 6 then 'Q4'
        when extract(month from cast(inception_date as date)) between 7 and 9 then 'Q1'
        when extract(month from cast(inception_date as date)) between 10 and 12 then 'Q2'
    end as inception_fiscal_quarter
from "bain_analytics"."public_raw"."raw_portfolios"
where cast(is_active as boolean) = true
  );
[0m19:24:09.254389 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.stg_trades"
[0m19:24:09.254729 [debug] [Thread-2  ]: Began executing node test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_id.ec87e4ee58
[0m19:24:09.255702 [debug] [Thread-3  ]: On model.bain_capital_analytics.stg_positions: COMMIT
[0m19:24:09.256046 [debug] [Thread-4  ]: On model.bain_capital_analytics.stg_trades: COMMIT
[0m19:24:09.258366 [debug] [Thread-2  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_id.ec87e4ee58"
[0m19:24:09.258690 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.stg_positions"
[0m19:24:09.259076 [debug] [Thread-3  ]: On model.bain_capital_analytics.stg_positions: COMMIT
[0m19:24:09.259468 [debug] [Thread-2  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_id.ec87e4ee58"
[0m19:24:09.259769 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_id.ec87e4ee58: BEGIN
[0m19:24:09.260048 [debug] [Thread-2  ]: Opening a new connection, currently in state closed
[0m19:24:09.260335 [debug] [Thread-4  ]: SQL status: COMMIT in 0.001 seconds
[0m19:24:09.260688 [debug] [Thread-3  ]: SQL status: COMMIT in 0.001 seconds
[0m19:24:09.260988 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.005 seconds
[0m19:24:09.263245 [debug] [Thread-4  ]: Applying DROP to: "bain_analytics"."public"."stg_trades__dbt_backup"
[0m19:24:09.265440 [debug] [Thread-3  ]: Applying DROP to: "bain_analytics"."public"."stg_positions__dbt_backup"
[0m19:24:09.268201 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.stg_portfolios"
[0m19:24:09.268688 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.stg_trades"
[0m19:24:09.269160 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.stg_positions"
[0m19:24:09.269452 [debug] [Thread-2  ]: SQL status: BEGIN in 0.009 seconds
[0m19:24:09.269748 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_portfolios: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_portfolios"} */
alter table "bain_analytics"."public"."stg_portfolios" rename to "stg_portfolios__dbt_backup"
[0m19:24:09.270050 [debug] [Thread-4  ]: On model.bain_capital_analytics.stg_trades: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_trades"} */
drop view if exists "bain_analytics"."public"."stg_trades__dbt_backup" cascade
[0m19:24:09.270350 [debug] [Thread-3  ]: On model.bain_capital_analytics.stg_positions: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_positions"} */
drop view if exists "bain_analytics"."public"."stg_positions__dbt_backup" cascade
[0m19:24:09.270643 [debug] [Thread-2  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_id.ec87e4ee58"
[0m19:24:09.271053 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_id.ec87e4ee58: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_id.ec87e4ee58"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select benchmark_id
from "bain_analytics"."public"."stg_benchmarks"
where benchmark_id is null



  
  
      
    ) dbt_internal_test
[0m19:24:09.271761 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m19:24:09.274940 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.stg_portfolios"
[0m19:24:09.275261 [debug] [Thread-3  ]: SQL status: DROP VIEW in 0.004 seconds
[0m19:24:09.275549 [debug] [Thread-2  ]: SQL status: SELECT 1 in 0.004 seconds
[0m19:24:09.275833 [debug] [Thread-4  ]: SQL status: DROP VIEW in 0.005 seconds
[0m19:24:09.276133 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_portfolios: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_portfolios"} */
alter table "bain_analytics"."public"."stg_portfolios__dbt_tmp" rename to "stg_portfolios"
[0m19:24:09.277195 [debug] [Thread-3  ]: On model.bain_capital_analytics.stg_positions: Close
[0m19:24:09.278356 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_id.ec87e4ee58: ROLLBACK
[0m19:24:09.279337 [debug] [Thread-4  ]: On model.bain_capital_analytics.stg_trades: Close
[0m19:24:09.279879 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '51f63fcd-b352-49c5-ac4e-b31e07bcdf23', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d45beb0>]}
[0m19:24:09.280356 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '51f63fcd-b352-49c5-ac4e-b31e07bcdf23', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d2d9400>]}
[0m19:24:09.280737 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_id.ec87e4ee58: Close
[0m19:24:09.281018 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m19:24:09.281435 [info ] [Thread-3  ]: 6 of 40 OK created sql view model public.stg_positions ......................... [[32mCREATE VIEW[0m in 0.13s]
[0m19:24:09.281929 [info ] [Thread-4  ]: 7 of 40 OK created sql view model public.stg_trades ............................ [[32mCREATE VIEW[0m in 0.13s]
[0m19:24:09.282432 [info ] [Thread-2  ]: 9 of 40 PASS not_null_stg_benchmarks_benchmark_id .............................. [[32mPASS[0m in 0.04s]
[0m19:24:09.283443 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_portfolios: COMMIT
[0m19:24:09.283881 [debug] [Thread-3  ]: Finished running node model.bain_capital_analytics.stg_positions
[0m19:24:09.284289 [debug] [Thread-4  ]: Finished running node model.bain_capital_analytics.stg_trades
[0m19:24:09.284693 [debug] [Thread-2  ]: Finished running node test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_id.ec87e4ee58
[0m19:24:09.284993 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.stg_portfolios"
[0m19:24:09.285317 [debug] [Thread-3  ]: Began running node test.bain_capital_analytics.not_null_stg_dates_date_day.f3ec4da188
[0m19:24:09.285707 [debug] [Thread-4  ]: Began running node test.bain_capital_analytics.unique_stg_dates_date_day.e062be8e28
[0m19:24:09.286197 [debug] [Thread-2  ]: Began running node test.bain_capital_analytics.not_null_stg_instruments_instrument_id.18bdfd2ebe
[0m19:24:09.286634 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_portfolios: COMMIT
[0m19:24:09.286955 [info ] [Thread-3  ]: 10 of 40 START test not_null_stg_dates_date_day ................................ [RUN]
[0m19:24:09.287281 [info ] [Thread-4  ]: 11 of 40 START test unique_stg_dates_date_day .................................. [RUN]
[0m19:24:09.287595 [info ] [Thread-2  ]: 12 of 40 START test not_null_stg_instruments_instrument_id ..................... [RUN]
[0m19:24:09.287984 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly model.bain_capital_analytics.stg_positions, now test.bain_capital_analytics.not_null_stg_dates_date_day.f3ec4da188)
[0m19:24:09.288312 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly model.bain_capital_analytics.stg_trades, now test.bain_capital_analytics.unique_stg_dates_date_day.e062be8e28)
[0m19:24:09.288634 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_id.ec87e4ee58, now test.bain_capital_analytics.not_null_stg_instruments_instrument_id.18bdfd2ebe)
[0m19:24:09.288939 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m19:24:09.289219 [debug] [Thread-3  ]: Began compiling node test.bain_capital_analytics.not_null_stg_dates_date_day.f3ec4da188
[0m19:24:09.289509 [debug] [Thread-4  ]: Began compiling node test.bain_capital_analytics.unique_stg_dates_date_day.e062be8e28
[0m19:24:09.289793 [debug] [Thread-2  ]: Began compiling node test.bain_capital_analytics.not_null_stg_instruments_instrument_id.18bdfd2ebe
[0m19:24:09.292176 [debug] [Thread-1  ]: Applying DROP to: "bain_analytics"."public"."stg_portfolios__dbt_backup"
[0m19:24:09.295659 [debug] [Thread-3  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_stg_dates_date_day.f3ec4da188"
[0m19:24:09.300767 [debug] [Thread-4  ]: Writing injected SQL for node "test.bain_capital_analytics.unique_stg_dates_date_day.e062be8e28"
[0m19:24:09.304080 [debug] [Thread-2  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_stg_instruments_instrument_id.18bdfd2ebe"
[0m19:24:09.304567 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.stg_portfolios"
[0m19:24:09.305088 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_portfolios: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_portfolios"} */
drop view if exists "bain_analytics"."public"."stg_portfolios__dbt_backup" cascade
[0m19:24:09.305563 [debug] [Thread-2  ]: Began executing node test.bain_capital_analytics.not_null_stg_instruments_instrument_id.18bdfd2ebe
[0m19:24:09.305869 [debug] [Thread-4  ]: Began executing node test.bain_capital_analytics.unique_stg_dates_date_day.e062be8e28
[0m19:24:09.306170 [debug] [Thread-3  ]: Began executing node test.bain_capital_analytics.not_null_stg_dates_date_day.f3ec4da188
[0m19:24:09.308446 [debug] [Thread-2  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_stg_instruments_instrument_id.18bdfd2ebe"
[0m19:24:09.308766 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.003 seconds
[0m19:24:09.311764 [debug] [Thread-4  ]: Writing runtime sql for node "test.bain_capital_analytics.unique_stg_dates_date_day.e062be8e28"
[0m19:24:09.313875 [debug] [Thread-3  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_stg_dates_date_day.f3ec4da188"
[0m19:24:09.315014 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_portfolios: Close
[0m19:24:09.315548 [debug] [Thread-2  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_instruments_instrument_id.18bdfd2ebe"
[0m19:24:09.315952 [debug] [Thread-4  ]: Using postgres connection "test.bain_capital_analytics.unique_stg_dates_date_day.e062be8e28"
[0m19:24:09.316252 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_stg_instruments_instrument_id.18bdfd2ebe: BEGIN
[0m19:24:09.316550 [debug] [Thread-3  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_dates_date_day.f3ec4da188"
[0m19:24:09.316982 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '51f63fcd-b352-49c5-ac4e-b31e07bcdf23', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d31cdf0>]}
[0m19:24:09.317293 [debug] [Thread-4  ]: On test.bain_capital_analytics.unique_stg_dates_date_day.e062be8e28: BEGIN
[0m19:24:09.317577 [debug] [Thread-2  ]: Opening a new connection, currently in state closed
[0m19:24:09.317867 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_stg_dates_date_day.f3ec4da188: BEGIN
[0m19:24:09.318241 [debug] [Thread-4  ]: Opening a new connection, currently in state closed
[0m19:24:09.318670 [info ] [Thread-1  ]: 5 of 40 OK created sql view model public.stg_portfolios ........................ [[32mCREATE VIEW[0m in 0.16s]
[0m19:24:09.319098 [debug] [Thread-3  ]: Opening a new connection, currently in state closed
[0m19:24:09.319644 [debug] [Thread-1  ]: Finished running node model.bain_capital_analytics.stg_portfolios
[0m19:24:09.320121 [debug] [Thread-1  ]: Began running node test.bain_capital_analytics.unique_stg_instruments_instrument_id.0e70adcd34
[0m19:24:09.320534 [info ] [Thread-1  ]: 13 of 40 START test unique_stg_instruments_instrument_id ....................... [RUN]
[0m19:24:09.321024 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.bain_capital_analytics.stg_portfolios, now test.bain_capital_analytics.unique_stg_instruments_instrument_id.0e70adcd34)
[0m19:24:09.321332 [debug] [Thread-1  ]: Began compiling node test.bain_capital_analytics.unique_stg_instruments_instrument_id.0e70adcd34
[0m19:24:09.325025 [debug] [Thread-1  ]: Writing injected SQL for node "test.bain_capital_analytics.unique_stg_instruments_instrument_id.0e70adcd34"
[0m19:24:09.325537 [debug] [Thread-1  ]: Began executing node test.bain_capital_analytics.unique_stg_instruments_instrument_id.0e70adcd34
[0m19:24:09.327717 [debug] [Thread-1  ]: Writing runtime sql for node "test.bain_capital_analytics.unique_stg_instruments_instrument_id.0e70adcd34"
[0m19:24:09.328197 [debug] [Thread-1  ]: Using postgres connection "test.bain_capital_analytics.unique_stg_instruments_instrument_id.0e70adcd34"
[0m19:24:09.328491 [debug] [Thread-1  ]: On test.bain_capital_analytics.unique_stg_instruments_instrument_id.0e70adcd34: BEGIN
[0m19:24:09.328764 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m19:24:09.330520 [debug] [Thread-3  ]: SQL status: BEGIN in 0.011 seconds
[0m19:24:09.330836 [debug] [Thread-2  ]: SQL status: BEGIN in 0.013 seconds
[0m19:24:09.331113 [debug] [Thread-4  ]: SQL status: BEGIN in 0.013 seconds
[0m19:24:09.331382 [debug] [Thread-3  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_dates_date_day.f3ec4da188"
[0m19:24:09.331687 [debug] [Thread-2  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_instruments_instrument_id.18bdfd2ebe"
[0m19:24:09.331992 [debug] [Thread-4  ]: Using postgres connection "test.bain_capital_analytics.unique_stg_dates_date_day.e062be8e28"
[0m19:24:09.332293 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_stg_dates_date_day.f3ec4da188: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_stg_dates_date_day.f3ec4da188"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select date_day
from "bain_analytics"."public"."stg_dates"
where date_day is null



  
  
      
    ) dbt_internal_test
[0m19:24:09.332623 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_stg_instruments_instrument_id.18bdfd2ebe: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_stg_instruments_instrument_id.18bdfd2ebe"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select instrument_id
from "bain_analytics"."public"."stg_instruments"
where instrument_id is null



  
  
      
    ) dbt_internal_test
[0m19:24:09.332951 [debug] [Thread-4  ]: On test.bain_capital_analytics.unique_stg_dates_date_day.e062be8e28: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.unique_stg_dates_date_day.e062be8e28"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

select
    date_day as unique_field,
    count(*) as n_records

from "bain_analytics"."public"."stg_dates"
where date_day is not null
group by date_day
having count(*) > 1



  
  
      
    ) dbt_internal_test
[0m19:24:09.334955 [debug] [Thread-3  ]: SQL status: SELECT 1 in 0.002 seconds
[0m19:24:09.335267 [debug] [Thread-4  ]: SQL status: SELECT 1 in 0.002 seconds
[0m19:24:09.335573 [debug] [Thread-2  ]: SQL status: SELECT 1 in 0.002 seconds
[0m19:24:09.336725 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_stg_dates_date_day.f3ec4da188: ROLLBACK
[0m19:24:09.337790 [debug] [Thread-4  ]: On test.bain_capital_analytics.unique_stg_dates_date_day.e062be8e28: ROLLBACK
[0m19:24:09.338102 [debug] [Thread-1  ]: SQL status: BEGIN in 0.009 seconds
[0m19:24:09.339088 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_stg_instruments_instrument_id.18bdfd2ebe: ROLLBACK
[0m19:24:09.339451 [debug] [Thread-1  ]: Using postgres connection "test.bain_capital_analytics.unique_stg_instruments_instrument_id.0e70adcd34"
[0m19:24:09.339744 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_stg_dates_date_day.f3ec4da188: Close
[0m19:24:09.340026 [debug] [Thread-4  ]: On test.bain_capital_analytics.unique_stg_dates_date_day.e062be8e28: Close
[0m19:24:09.340354 [debug] [Thread-1  ]: On test.bain_capital_analytics.unique_stg_instruments_instrument_id.0e70adcd34: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.unique_stg_instruments_instrument_id.0e70adcd34"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

select
    instrument_id as unique_field,
    count(*) as n_records

from "bain_analytics"."public"."stg_instruments"
where instrument_id is not null
group by instrument_id
having count(*) > 1



  
  
      
    ) dbt_internal_test
[0m19:24:09.340697 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_stg_instruments_instrument_id.18bdfd2ebe: Close
[0m19:24:09.341139 [info ] [Thread-3  ]: 10 of 40 PASS not_null_stg_dates_date_day ...................................... [[32mPASS[0m in 0.05s]
[0m19:24:09.341627 [info ] [Thread-4  ]: 11 of 40 PASS unique_stg_dates_date_day ........................................ [[32mPASS[0m in 0.05s]
[0m19:24:09.342081 [info ] [Thread-2  ]: 12 of 40 PASS not_null_stg_instruments_instrument_id ........................... [[32mPASS[0m in 0.05s]
[0m19:24:09.342513 [debug] [Thread-3  ]: Finished running node test.bain_capital_analytics.not_null_stg_dates_date_day.f3ec4da188
[0m19:24:09.342918 [debug] [Thread-4  ]: Finished running node test.bain_capital_analytics.unique_stg_dates_date_day.e062be8e28
[0m19:24:09.343317 [debug] [Thread-2  ]: Finished running node test.bain_capital_analytics.not_null_stg_instruments_instrument_id.18bdfd2ebe
[0m19:24:09.343638 [debug] [Thread-3  ]: Began running node test.bain_capital_analytics.not_null_stg_counterparties_counterparty_id.4754302940
[0m19:24:09.343945 [debug] [Thread-1  ]: SQL status: SELECT 1 in 0.002 seconds
[0m19:24:09.344246 [debug] [Thread-4  ]: Began running node test.bain_capital_analytics.unique_stg_counterparties_counterparty_id.d712ebd057
[0m19:24:09.344628 [debug] [Thread-2  ]: Began running node test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c
[0m19:24:09.344988 [info ] [Thread-3  ]: 14 of 40 START test not_null_stg_counterparties_counterparty_id ................ [RUN]
[0m19:24:09.346036 [debug] [Thread-1  ]: On test.bain_capital_analytics.unique_stg_instruments_instrument_id.0e70adcd34: ROLLBACK
[0m19:24:09.346346 [info ] [Thread-4  ]: 15 of 40 START test unique_stg_counterparties_counterparty_id .................. [RUN]
[0m19:24:09.346669 [info ] [Thread-2  ]: 16 of 40 START test not_null_stg_positions_portfolio_id ........................ [RUN]
[0m19:24:09.347025 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.not_null_stg_dates_date_day.f3ec4da188, now test.bain_capital_analytics.not_null_stg_counterparties_counterparty_id.4754302940)
[0m19:24:09.347385 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.unique_stg_dates_date_day.e062be8e28, now test.bain_capital_analytics.unique_stg_counterparties_counterparty_id.d712ebd057)
[0m19:24:09.347730 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.not_null_stg_instruments_instrument_id.18bdfd2ebe, now test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c)
[0m19:24:09.348029 [debug] [Thread-1  ]: On test.bain_capital_analytics.unique_stg_instruments_instrument_id.0e70adcd34: Close
[0m19:24:09.348324 [debug] [Thread-3  ]: Began compiling node test.bain_capital_analytics.not_null_stg_counterparties_counterparty_id.4754302940
[0m19:24:09.348611 [debug] [Thread-4  ]: Began compiling node test.bain_capital_analytics.unique_stg_counterparties_counterparty_id.d712ebd057
[0m19:24:09.348896 [debug] [Thread-2  ]: Began compiling node test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c
[0m19:24:09.349323 [info ] [Thread-1  ]: 13 of 40 PASS unique_stg_instruments_instrument_id ............................. [[32mPASS[0m in 0.03s]
[0m19:24:09.352979 [debug] [Thread-3  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_stg_counterparties_counterparty_id.4754302940"
[0m19:24:09.356250 [debug] [Thread-4  ]: Writing injected SQL for node "test.bain_capital_analytics.unique_stg_counterparties_counterparty_id.d712ebd057"
[0m19:24:09.360923 [debug] [Thread-2  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c"
[0m19:24:09.361403 [debug] [Thread-1  ]: Finished running node test.bain_capital_analytics.unique_stg_instruments_instrument_id.0e70adcd34
[0m19:24:09.361972 [debug] [Thread-1  ]: Began running node test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1
[0m19:24:09.362357 [info ] [Thread-1  ]: 17 of 40 START test not_null_stg_positions_position_id ......................... [RUN]
[0m19:24:09.362691 [debug] [Thread-3  ]: Began executing node test.bain_capital_analytics.not_null_stg_counterparties_counterparty_id.4754302940
[0m19:24:09.363077 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.unique_stg_instruments_instrument_id.0e70adcd34, now test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1)
[0m19:24:09.363398 [debug] [Thread-2  ]: Began executing node test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c
[0m19:24:09.363676 [debug] [Thread-4  ]: Began executing node test.bain_capital_analytics.unique_stg_counterparties_counterparty_id.d712ebd057
[0m19:24:09.365856 [debug] [Thread-3  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_stg_counterparties_counterparty_id.4754302940"
[0m19:24:09.366188 [debug] [Thread-1  ]: Began compiling node test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1
[0m19:24:09.368318 [debug] [Thread-2  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c"
[0m19:24:09.370469 [debug] [Thread-4  ]: Writing runtime sql for node "test.bain_capital_analytics.unique_stg_counterparties_counterparty_id.d712ebd057"
[0m19:24:09.373806 [debug] [Thread-1  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1"
[0m19:24:09.374540 [debug] [Thread-3  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_counterparties_counterparty_id.4754302940"
[0m19:24:09.374895 [debug] [Thread-2  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c"
[0m19:24:09.375211 [debug] [Thread-4  ]: Using postgres connection "test.bain_capital_analytics.unique_stg_counterparties_counterparty_id.d712ebd057"
[0m19:24:09.375495 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_stg_counterparties_counterparty_id.4754302940: BEGIN
[0m19:24:09.375766 [debug] [Thread-1  ]: Began executing node test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1
[0m19:24:09.376058 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c: BEGIN
[0m19:24:09.376341 [debug] [Thread-4  ]: On test.bain_capital_analytics.unique_stg_counterparties_counterparty_id.d712ebd057: BEGIN
[0m19:24:09.376617 [debug] [Thread-3  ]: Opening a new connection, currently in state closed
[0m19:24:09.379338 [debug] [Thread-1  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1"
[0m19:24:09.379634 [debug] [Thread-2  ]: Opening a new connection, currently in state closed
[0m19:24:09.379916 [debug] [Thread-4  ]: Opening a new connection, currently in state closed
[0m19:24:09.380596 [debug] [Thread-1  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1"
[0m19:24:09.380886 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1: BEGIN
[0m19:24:09.381151 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m19:24:09.394709 [debug] [Thread-3  ]: SQL status: BEGIN in 0.018 seconds
[0m19:24:09.395039 [debug] [Thread-1  ]: SQL status: BEGIN in 0.014 seconds
[0m19:24:09.395332 [debug] [Thread-2  ]: SQL status: BEGIN in 0.016 seconds
[0m19:24:09.395606 [debug] [Thread-4  ]: SQL status: BEGIN in 0.016 seconds
[0m19:24:09.395882 [debug] [Thread-3  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_counterparties_counterparty_id.4754302940"
[0m19:24:09.396174 [debug] [Thread-1  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1"
[0m19:24:09.396462 [debug] [Thread-2  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c"
[0m19:24:09.396748 [debug] [Thread-4  ]: Using postgres connection "test.bain_capital_analytics.unique_stg_counterparties_counterparty_id.d712ebd057"
[0m19:24:09.397053 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_stg_counterparties_counterparty_id.4754302940: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_stg_counterparties_counterparty_id.4754302940"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select counterparty_id
from "bain_analytics"."public"."stg_counterparties"
where counterparty_id is null



  
  
      
    ) dbt_internal_test
[0m19:24:09.397377 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select position_id
from "bain_analytics"."public"."stg_positions"
where position_id is null



  
  
      
    ) dbt_internal_test
[0m19:24:09.397698 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select portfolio_id
from "bain_analytics"."public"."stg_positions"
where portfolio_id is null



  
  
      
    ) dbt_internal_test
[0m19:24:09.398038 [debug] [Thread-4  ]: On test.bain_capital_analytics.unique_stg_counterparties_counterparty_id.d712ebd057: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.unique_stg_counterparties_counterparty_id.d712ebd057"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

select
    counterparty_id as unique_field,
    count(*) as n_records

from "bain_analytics"."public"."stg_counterparties"
where counterparty_id is not null
group by counterparty_id
having count(*) > 1



  
  
      
    ) dbt_internal_test
[0m19:24:09.400398 [debug] [Thread-3  ]: SQL status: SELECT 1 in 0.002 seconds
[0m19:24:09.401633 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_stg_counterparties_counterparty_id.4754302940: ROLLBACK
[0m19:24:09.401990 [debug] [Thread-4  ]: SQL status: SELECT 1 in 0.004 seconds
[0m19:24:09.402342 [debug] [Thread-2  ]: SQL status: SELECT 1 in 0.004 seconds
[0m19:24:09.402649 [debug] [Thread-1  ]: SQL status: SELECT 1 in 0.004 seconds
[0m19:24:09.402957 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_stg_counterparties_counterparty_id.4754302940: Close
[0m19:24:09.404024 [debug] [Thread-4  ]: On test.bain_capital_analytics.unique_stg_counterparties_counterparty_id.d712ebd057: ROLLBACK
[0m19:24:09.405040 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c: ROLLBACK
[0m19:24:09.406025 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1: ROLLBACK
[0m19:24:09.406532 [info ] [Thread-3  ]: 14 of 40 PASS not_null_stg_counterparties_counterparty_id ...................... [[32mPASS[0m in 0.06s]
[0m19:24:09.407096 [debug] [Thread-3  ]: Finished running node test.bain_capital_analytics.not_null_stg_counterparties_counterparty_id.4754302940
[0m19:24:09.407440 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1: Close
[0m19:24:09.407710 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c: Close
[0m19:24:09.408016 [debug] [Thread-3  ]: Began running node test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f
[0m19:24:09.408290 [debug] [Thread-4  ]: On test.bain_capital_analytics.unique_stg_counterparties_counterparty_id.d712ebd057: Close
[0m19:24:09.408782 [info ] [Thread-1  ]: 17 of 40 PASS not_null_stg_positions_position_id ............................... [[32mPASS[0m in 0.05s]
[0m19:24:09.409215 [info ] [Thread-2  ]: 16 of 40 PASS not_null_stg_positions_portfolio_id .............................. [[32mPASS[0m in 0.06s]
[0m19:24:09.409548 [info ] [Thread-3  ]: 18 of 40 START test unique_stg_positions_position_id ........................... [RUN]
[0m19:24:09.409992 [info ] [Thread-4  ]: 15 of 40 PASS unique_stg_counterparties_counterparty_id ........................ [[32mPASS[0m in 0.06s]
[0m19:24:09.410404 [debug] [Thread-1  ]: Finished running node test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1
[0m19:24:09.410805 [debug] [Thread-2  ]: Finished running node test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c
[0m19:24:09.411126 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.not_null_stg_counterparties_counterparty_id.4754302940, now test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f)
[0m19:24:09.411540 [debug] [Thread-4  ]: Finished running node test.bain_capital_analytics.unique_stg_counterparties_counterparty_id.d712ebd057
[0m19:24:09.411851 [debug] [Thread-1  ]: Began running node test.bain_capital_analytics.not_null_stg_trades_instrument_id.15cdc65a72
[0m19:24:09.412225 [debug] [Thread-2  ]: Began running node test.bain_capital_analytics.not_null_stg_trades_portfolio_id.2becbd2a0b
[0m19:24:09.412571 [debug] [Thread-3  ]: Began compiling node test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f
[0m19:24:09.412900 [debug] [Thread-4  ]: Began running node test.bain_capital_analytics.not_null_stg_trades_trade_id.f81937320b
[0m19:24:09.413240 [info ] [Thread-1  ]: 19 of 40 START test not_null_stg_trades_instrument_id .......................... [RUN]
[0m19:24:09.413580 [info ] [Thread-2  ]: 20 of 40 START test not_null_stg_trades_portfolio_id ........................... [RUN]
[0m19:24:09.417494 [debug] [Thread-3  ]: Writing injected SQL for node "test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f"
[0m19:24:09.417832 [info ] [Thread-4  ]: 21 of 40 START test not_null_stg_trades_trade_id ............................... [RUN]
[0m19:24:09.418185 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1, now test.bain_capital_analytics.not_null_stg_trades_instrument_id.15cdc65a72)
[0m19:24:09.418512 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c, now test.bain_capital_analytics.not_null_stg_trades_portfolio_id.2becbd2a0b)
[0m19:24:09.418922 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.unique_stg_counterparties_counterparty_id.d712ebd057, now test.bain_capital_analytics.not_null_stg_trades_trade_id.f81937320b)
[0m19:24:09.419244 [debug] [Thread-1  ]: Began compiling node test.bain_capital_analytics.not_null_stg_trades_instrument_id.15cdc65a72
[0m19:24:09.419545 [debug] [Thread-2  ]: Began compiling node test.bain_capital_analytics.not_null_stg_trades_portfolio_id.2becbd2a0b
[0m19:24:09.419882 [debug] [Thread-4  ]: Began compiling node test.bain_capital_analytics.not_null_stg_trades_trade_id.f81937320b
[0m19:24:09.423420 [debug] [Thread-1  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_stg_trades_instrument_id.15cdc65a72"
[0m19:24:09.423752 [debug] [Thread-3  ]: Began executing node test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f
[0m19:24:09.427997 [debug] [Thread-2  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_stg_trades_portfolio_id.2becbd2a0b"
[0m19:24:09.431521 [debug] [Thread-4  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_stg_trades_trade_id.f81937320b"
[0m19:24:09.434042 [debug] [Thread-3  ]: Writing runtime sql for node "test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f"
[0m19:24:09.434755 [debug] [Thread-2  ]: Began executing node test.bain_capital_analytics.not_null_stg_trades_portfolio_id.2becbd2a0b
[0m19:24:09.437995 [debug] [Thread-2  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_stg_trades_portfolio_id.2becbd2a0b"
[0m19:24:09.438446 [debug] [Thread-1  ]: Began executing node test.bain_capital_analytics.not_null_stg_trades_instrument_id.15cdc65a72
[0m19:24:09.438829 [debug] [Thread-4  ]: Began executing node test.bain_capital_analytics.not_null_stg_trades_trade_id.f81937320b
[0m19:24:09.441361 [debug] [Thread-1  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_stg_trades_instrument_id.15cdc65a72"
[0m19:24:09.441845 [debug] [Thread-3  ]: Using postgres connection "test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f"
[0m19:24:09.444148 [debug] [Thread-4  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_stg_trades_trade_id.f81937320b"
[0m19:24:09.444505 [debug] [Thread-2  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_trades_portfolio_id.2becbd2a0b"
[0m19:24:09.444995 [debug] [Thread-3  ]: On test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f: BEGIN
[0m19:24:09.445532 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_stg_trades_portfolio_id.2becbd2a0b: BEGIN
[0m19:24:09.445898 [debug] [Thread-1  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_trades_instrument_id.15cdc65a72"
[0m19:24:09.446244 [debug] [Thread-3  ]: Opening a new connection, currently in state closed
[0m19:24:09.446566 [debug] [Thread-2  ]: Opening a new connection, currently in state closed
[0m19:24:09.446910 [debug] [Thread-4  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_trades_trade_id.f81937320b"
[0m19:24:09.447194 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_stg_trades_instrument_id.15cdc65a72: BEGIN
[0m19:24:09.447691 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_stg_trades_trade_id.f81937320b: BEGIN
[0m19:24:09.447990 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m19:24:09.448307 [debug] [Thread-4  ]: Opening a new connection, currently in state closed
[0m19:24:09.465529 [debug] [Thread-3  ]: SQL status: BEGIN in 0.019 seconds
[0m19:24:09.465983 [debug] [Thread-4  ]: SQL status: BEGIN in 0.018 seconds
[0m19:24:09.466298 [debug] [Thread-1  ]: SQL status: BEGIN in 0.018 seconds
[0m19:24:09.466584 [debug] [Thread-2  ]: SQL status: BEGIN in 0.020 seconds
[0m19:24:09.466873 [debug] [Thread-3  ]: Using postgres connection "test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f"
[0m19:24:09.467181 [debug] [Thread-4  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_trades_trade_id.f81937320b"
[0m19:24:09.467470 [debug] [Thread-1  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_trades_instrument_id.15cdc65a72"
[0m19:24:09.467758 [debug] [Thread-2  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_trades_portfolio_id.2becbd2a0b"
[0m19:24:09.468068 [debug] [Thread-3  ]: On test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

select
    position_id as unique_field,
    count(*) as n_records

from "bain_analytics"."public"."stg_positions"
where position_id is not null
group by position_id
having count(*) > 1



  
  
      
    ) dbt_internal_test
[0m19:24:09.468388 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_stg_trades_trade_id.f81937320b: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_stg_trades_trade_id.f81937320b"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select trade_id
from "bain_analytics"."public"."stg_trades"
where trade_id is null



  
  
      
    ) dbt_internal_test
[0m19:24:09.468704 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_stg_trades_instrument_id.15cdc65a72: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_stg_trades_instrument_id.15cdc65a72"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select instrument_id
from "bain_analytics"."public"."stg_trades"
where instrument_id is null



  
  
      
    ) dbt_internal_test
[0m19:24:09.469017 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_stg_trades_portfolio_id.2becbd2a0b: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_stg_trades_portfolio_id.2becbd2a0b"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select portfolio_id
from "bain_analytics"."public"."stg_trades"
where portfolio_id is null



  
  
      
    ) dbt_internal_test
[0m19:24:09.472270 [debug] [Thread-1  ]: SQL status: SELECT 1 in 0.003 seconds
[0m19:24:09.472739 [debug] [Thread-3  ]: SQL status: SELECT 1 in 0.003 seconds
[0m19:24:09.473017 [debug] [Thread-2  ]: SQL status: SELECT 1 in 0.003 seconds
[0m19:24:09.473283 [debug] [Thread-4  ]: SQL status: SELECT 1 in 0.004 seconds
[0m19:24:09.474833 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_stg_trades_instrument_id.15cdc65a72: ROLLBACK
[0m19:24:09.475979 [debug] [Thread-3  ]: On test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f: ROLLBACK
[0m19:24:09.477015 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_stg_trades_portfolio_id.2becbd2a0b: ROLLBACK
[0m19:24:09.478016 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_stg_trades_trade_id.f81937320b: ROLLBACK
[0m19:24:09.479162 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_stg_trades_instrument_id.15cdc65a72: Close
[0m19:24:09.479465 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_stg_trades_portfolio_id.2becbd2a0b: Close
[0m19:24:09.479730 [debug] [Thread-3  ]: On test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f: Close
[0m19:24:09.479988 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_stg_trades_trade_id.f81937320b: Close
[0m19:24:09.480488 [info ] [Thread-1  ]: 19 of 40 PASS not_null_stg_trades_instrument_id ................................ [[32mPASS[0m in 0.06s]
[0m19:24:09.481002 [info ] [Thread-2  ]: 20 of 40 PASS not_null_stg_trades_portfolio_id ................................. [[32mPASS[0m in 0.06s]
[0m19:24:09.481458 [info ] [Thread-3  ]: 18 of 40 PASS unique_stg_positions_position_id ................................. [[32mPASS[0m in 0.07s]
[0m19:24:09.481909 [info ] [Thread-4  ]: 21 of 40 PASS not_null_stg_trades_trade_id ..................................... [[32mPASS[0m in 0.06s]
[0m19:24:09.482349 [debug] [Thread-1  ]: Finished running node test.bain_capital_analytics.not_null_stg_trades_instrument_id.15cdc65a72
[0m19:24:09.482758 [debug] [Thread-2  ]: Finished running node test.bain_capital_analytics.not_null_stg_trades_portfolio_id.2becbd2a0b
[0m19:24:09.483157 [debug] [Thread-3  ]: Finished running node test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f
[0m19:24:09.483551 [debug] [Thread-4  ]: Finished running node test.bain_capital_analytics.not_null_stg_trades_trade_id.f81937320b
[0m19:24:09.483878 [debug] [Thread-1  ]: Began running node test.bain_capital_analytics.unique_stg_trades_trade_id.f973ed6ffd
[0m19:24:09.484276 [debug] [Thread-2  ]: Began running node test.bain_capital_analytics.not_null_stg_portfolios_fund_id.70b04d82bd
[0m19:24:09.484610 [debug] [Thread-3  ]: Began running node test.bain_capital_analytics.not_null_stg_portfolios_portfolio_id.7126a480ec
[0m19:24:09.484981 [debug] [Thread-4  ]: Began running node test.bain_capital_analytics.relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_.2823f12709
[0m19:24:09.485368 [info ] [Thread-1  ]: 22 of 40 START test unique_stg_trades_trade_id ................................. [RUN]
[0m19:24:09.485704 [info ] [Thread-2  ]: 23 of 40 START test not_null_stg_portfolios_fund_id ............................ [RUN]
[0m19:24:09.486023 [info ] [Thread-3  ]: 24 of 40 START test not_null_stg_portfolios_portfolio_id ....................... [RUN]
[0m19:24:09.486351 [info ] [Thread-4  ]: 25 of 40 START test relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_  [RUN]
[0m19:24:09.486703 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.not_null_stg_trades_instrument_id.15cdc65a72, now test.bain_capital_analytics.unique_stg_trades_trade_id.f973ed6ffd)
[0m19:24:09.487031 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.not_null_stg_trades_portfolio_id.2becbd2a0b, now test.bain_capital_analytics.not_null_stg_portfolios_fund_id.70b04d82bd)
[0m19:24:09.487350 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f, now test.bain_capital_analytics.not_null_stg_portfolios_portfolio_id.7126a480ec)
[0m19:24:09.487673 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.not_null_stg_trades_trade_id.f81937320b, now test.bain_capital_analytics.relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_.2823f12709)
[0m19:24:09.487985 [debug] [Thread-1  ]: Began compiling node test.bain_capital_analytics.unique_stg_trades_trade_id.f973ed6ffd
[0m19:24:09.488273 [debug] [Thread-2  ]: Began compiling node test.bain_capital_analytics.not_null_stg_portfolios_fund_id.70b04d82bd
[0m19:24:09.488558 [debug] [Thread-3  ]: Began compiling node test.bain_capital_analytics.not_null_stg_portfolios_portfolio_id.7126a480ec
[0m19:24:09.488848 [debug] [Thread-4  ]: Began compiling node test.bain_capital_analytics.relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_.2823f12709
[0m19:24:09.492824 [debug] [Thread-1  ]: Writing injected SQL for node "test.bain_capital_analytics.unique_stg_trades_trade_id.f973ed6ffd"
[0m19:24:09.496242 [debug] [Thread-2  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_stg_portfolios_fund_id.70b04d82bd"
[0m19:24:09.499519 [debug] [Thread-3  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_stg_portfolios_portfolio_id.7126a480ec"
[0m19:24:09.507590 [debug] [Thread-4  ]: Writing injected SQL for node "test.bain_capital_analytics.relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_.2823f12709"
[0m19:24:09.508389 [debug] [Thread-2  ]: Began executing node test.bain_capital_analytics.not_null_stg_portfolios_fund_id.70b04d82bd
[0m19:24:09.510739 [debug] [Thread-2  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_stg_portfolios_fund_id.70b04d82bd"
[0m19:24:09.511089 [debug] [Thread-4  ]: Began executing node test.bain_capital_analytics.relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_.2823f12709
[0m19:24:09.511421 [debug] [Thread-3  ]: Began executing node test.bain_capital_analytics.not_null_stg_portfolios_portfolio_id.7126a480ec
[0m19:24:09.511741 [debug] [Thread-1  ]: Began executing node test.bain_capital_analytics.unique_stg_trades_trade_id.f973ed6ffd
[0m19:24:09.513957 [debug] [Thread-4  ]: Writing runtime sql for node "test.bain_capital_analytics.relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_.2823f12709"
[0m19:24:09.516093 [debug] [Thread-3  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_stg_portfolios_portfolio_id.7126a480ec"
[0m19:24:09.518361 [debug] [Thread-1  ]: Writing runtime sql for node "test.bain_capital_analytics.unique_stg_trades_trade_id.f973ed6ffd"
[0m19:24:09.518744 [debug] [Thread-2  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_portfolios_fund_id.70b04d82bd"
[0m19:24:09.519267 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_stg_portfolios_fund_id.70b04d82bd: BEGIN
[0m19:24:09.519604 [debug] [Thread-2  ]: Opening a new connection, currently in state closed
[0m19:24:09.520218 [debug] [Thread-4  ]: Using postgres connection "test.bain_capital_analytics.relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_.2823f12709"
[0m19:24:09.520568 [debug] [Thread-3  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_portfolios_portfolio_id.7126a480ec"
[0m19:24:09.520877 [debug] [Thread-1  ]: Using postgres connection "test.bain_capital_analytics.unique_stg_trades_trade_id.f973ed6ffd"
[0m19:24:09.521157 [debug] [Thread-4  ]: On test.bain_capital_analytics.relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_.2823f12709: BEGIN
[0m19:24:09.521483 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_stg_portfolios_portfolio_id.7126a480ec: BEGIN
[0m19:24:09.521824 [debug] [Thread-1  ]: On test.bain_capital_analytics.unique_stg_trades_trade_id.f973ed6ffd: BEGIN
[0m19:24:09.522123 [debug] [Thread-4  ]: Opening a new connection, currently in state closed
[0m19:24:09.522407 [debug] [Thread-3  ]: Opening a new connection, currently in state closed
[0m19:24:09.522697 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m19:24:09.530706 [debug] [Thread-2  ]: SQL status: BEGIN in 0.011 seconds
[0m19:24:09.531004 [debug] [Thread-2  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_portfolios_fund_id.70b04d82bd"
[0m19:24:09.531303 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_stg_portfolios_fund_id.70b04d82bd: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_stg_portfolios_fund_id.70b04d82bd"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select fund_id
from "bain_analytics"."public"."stg_portfolios"
where fund_id is null



  
  
      
    ) dbt_internal_test
[0m19:24:09.534299 [debug] [Thread-2  ]: SQL status: SELECT 1 in 0.003 seconds
[0m19:24:09.535507 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_stg_portfolios_fund_id.70b04d82bd: ROLLBACK
[0m19:24:09.535855 [debug] [Thread-4  ]: SQL status: BEGIN in 0.014 seconds
[0m19:24:09.536176 [debug] [Thread-1  ]: SQL status: BEGIN in 0.013 seconds
[0m19:24:09.536452 [debug] [Thread-3  ]: SQL status: BEGIN in 0.014 seconds
[0m19:24:09.536744 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_stg_portfolios_fund_id.70b04d82bd: Close
[0m19:24:09.537039 [debug] [Thread-4  ]: Using postgres connection "test.bain_capital_analytics.relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_.2823f12709"
[0m19:24:09.537344 [debug] [Thread-1  ]: Using postgres connection "test.bain_capital_analytics.unique_stg_trades_trade_id.f973ed6ffd"
[0m19:24:09.537635 [debug] [Thread-3  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_portfolios_portfolio_id.7126a480ec"
[0m19:24:09.538139 [info ] [Thread-2  ]: 23 of 40 PASS not_null_stg_portfolios_fund_id .................................. [[32mPASS[0m in 0.05s]
[0m19:24:09.538498 [debug] [Thread-4  ]: On test.bain_capital_analytics.relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_.2823f12709: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_.2823f12709"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

with child as (
    select portfolio_id as from_field
    from "bain_analytics"."public"."stg_positions"
    where portfolio_id is not null
),

parent as (
    select portfolio_id as to_field
    from "bain_analytics"."public"."stg_portfolios"
)

select
    from_field

from child
left join parent
    on child.from_field = parent.to_field

where parent.to_field is null



  
  
      
    ) dbt_internal_test
[0m19:24:09.538838 [debug] [Thread-1  ]: On test.bain_capital_analytics.unique_stg_trades_trade_id.f973ed6ffd: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.unique_stg_trades_trade_id.f973ed6ffd"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

select
    trade_id as unique_field,
    count(*) as n_records

from "bain_analytics"."public"."stg_trades"
where trade_id is not null
group by trade_id
having count(*) > 1



  
  
      
    ) dbt_internal_test
[0m19:24:09.539160 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_stg_portfolios_portfolio_id.7126a480ec: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_stg_portfolios_portfolio_id.7126a480ec"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select portfolio_id
from "bain_analytics"."public"."stg_portfolios"
where portfolio_id is null



  
  
      
    ) dbt_internal_test
[0m19:24:09.539599 [debug] [Thread-2  ]: Finished running node test.bain_capital_analytics.not_null_stg_portfolios_fund_id.70b04d82bd
[0m19:24:09.540036 [debug] [Thread-2  ]: Began running node test.bain_capital_analytics.unique_stg_portfolios_portfolio_id.aa125b6658
[0m19:24:09.540420 [info ] [Thread-2  ]: 26 of 40 START test unique_stg_portfolios_portfolio_id ......................... [RUN]
[0m19:24:09.540838 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.not_null_stg_portfolios_fund_id.70b04d82bd, now test.bain_capital_analytics.unique_stg_portfolios_portfolio_id.aa125b6658)
[0m19:24:09.541144 [debug] [Thread-2  ]: Began compiling node test.bain_capital_analytics.unique_stg_portfolios_portfolio_id.aa125b6658
[0m19:24:09.545584 [debug] [Thread-2  ]: Writing injected SQL for node "test.bain_capital_analytics.unique_stg_portfolios_portfolio_id.aa125b6658"
[0m19:24:09.545945 [debug] [Thread-1  ]: SQL status: SELECT 1 in 0.006 seconds
[0m19:24:09.546220 [debug] [Thread-3  ]: SQL status: SELECT 1 in 0.006 seconds
[0m19:24:09.546494 [debug] [Thread-4  ]: SQL status: SELECT 1 in 0.007 seconds
[0m19:24:09.547709 [debug] [Thread-1  ]: On test.bain_capital_analytics.unique_stg_trades_trade_id.f973ed6ffd: ROLLBACK
[0m19:24:09.548737 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_stg_portfolios_portfolio_id.7126a480ec: ROLLBACK
[0m19:24:09.549913 [debug] [Thread-4  ]: On test.bain_capital_analytics.relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_.2823f12709: ROLLBACK
[0m19:24:09.550276 [debug] [Thread-2  ]: Began executing node test.bain_capital_analytics.unique_stg_portfolios_portfolio_id.aa125b6658
[0m19:24:09.552681 [debug] [Thread-2  ]: Writing runtime sql for node "test.bain_capital_analytics.unique_stg_portfolios_portfolio_id.aa125b6658"
[0m19:24:09.552992 [debug] [Thread-1  ]: On test.bain_capital_analytics.unique_stg_trades_trade_id.f973ed6ffd: Close
[0m19:24:09.553261 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_stg_portfolios_portfolio_id.7126a480ec: Close
[0m19:24:09.553524 [debug] [Thread-4  ]: On test.bain_capital_analytics.relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_.2823f12709: Close
[0m19:24:09.554038 [info ] [Thread-1  ]: 22 of 40 PASS unique_stg_trades_trade_id ....................................... [[32mPASS[0m in 0.07s]
[0m19:24:09.554525 [info ] [Thread-3  ]: 24 of 40 PASS not_null_stg_portfolios_portfolio_id ............................. [[32mPASS[0m in 0.07s]
[0m19:24:09.555003 [info ] [Thread-4  ]: 25 of 40 PASS relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_  [[32mPASS[0m in 0.07s]
[0m19:24:09.555436 [debug] [Thread-1  ]: Finished running node test.bain_capital_analytics.unique_stg_trades_trade_id.f973ed6ffd
[0m19:24:09.555750 [debug] [Thread-2  ]: Using postgres connection "test.bain_capital_analytics.unique_stg_portfolios_portfolio_id.aa125b6658"
[0m19:24:09.556149 [debug] [Thread-3  ]: Finished running node test.bain_capital_analytics.not_null_stg_portfolios_portfolio_id.7126a480ec
[0m19:24:09.556561 [debug] [Thread-4  ]: Finished running node test.bain_capital_analytics.relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_.2823f12709
[0m19:24:09.556893 [debug] [Thread-2  ]: On test.bain_capital_analytics.unique_stg_portfolios_portfolio_id.aa125b6658: BEGIN
[0m19:24:09.557371 [debug] [Thread-2  ]: Opening a new connection, currently in state closed
[0m19:24:09.566741 [debug] [Thread-2  ]: SQL status: BEGIN in 0.009 seconds
[0m19:24:09.567054 [debug] [Thread-2  ]: Using postgres connection "test.bain_capital_analytics.unique_stg_portfolios_portfolio_id.aa125b6658"
[0m19:24:09.567370 [debug] [Thread-2  ]: On test.bain_capital_analytics.unique_stg_portfolios_portfolio_id.aa125b6658: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.unique_stg_portfolios_portfolio_id.aa125b6658"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

select
    portfolio_id as unique_field,
    count(*) as n_records

from "bain_analytics"."public"."stg_portfolios"
where portfolio_id is not null
group by portfolio_id
having count(*) > 1



  
  
      
    ) dbt_internal_test
[0m19:24:09.571461 [debug] [Thread-2  ]: SQL status: SELECT 1 in 0.004 seconds
[0m19:24:09.572537 [debug] [Thread-2  ]: On test.bain_capital_analytics.unique_stg_portfolios_portfolio_id.aa125b6658: ROLLBACK
[0m19:24:09.573166 [debug] [Thread-2  ]: On test.bain_capital_analytics.unique_stg_portfolios_portfolio_id.aa125b6658: Close
[0m19:24:09.573620 [info ] [Thread-2  ]: 26 of 40 PASS unique_stg_portfolios_portfolio_id ............................... [[32mPASS[0m in 0.03s]
[0m19:24:09.574177 [debug] [Thread-2  ]: Finished running node test.bain_capital_analytics.unique_stg_portfolios_portfolio_id.aa125b6658
[0m19:24:09.575081 [debug] [Thread-1  ]: Began running node model.bain_capital_analytics.fact_trade_activity
[0m19:24:09.575495 [debug] [Thread-3  ]: Began running node model.bain_capital_analytics.int_daily_positions
[0m19:24:09.575927 [info ] [Thread-1  ]: 27 of 40 START sql view model public.fact_trade_activity ....................... [RUN]
[0m19:24:09.576317 [debug] [Thread-4  ]: Began running node model.bain_capital_analytics.int_trade_enriched
[0m19:24:09.576770 [info ] [Thread-3  ]: 28 of 40 START sql view model public.int_daily_positions ....................... [RUN]
[0m19:24:09.577212 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.unique_stg_trades_trade_id.f973ed6ffd, now model.bain_capital_analytics.fact_trade_activity)
[0m19:24:09.577639 [info ] [Thread-4  ]: 29 of 40 START sql view model public.int_trade_enriched ........................ [RUN]
[0m19:24:09.578000 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.not_null_stg_portfolios_portfolio_id.7126a480ec, now model.bain_capital_analytics.int_daily_positions)
[0m19:24:09.578318 [debug] [Thread-1  ]: Began compiling node model.bain_capital_analytics.fact_trade_activity
[0m19:24:09.578632 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_.2823f12709, now model.bain_capital_analytics.int_trade_enriched)
[0m19:24:09.578941 [debug] [Thread-3  ]: Began compiling node model.bain_capital_analytics.int_daily_positions
[0m19:24:09.582847 [debug] [Thread-1  ]: Writing injected SQL for node "model.bain_capital_analytics.fact_trade_activity"
[0m19:24:09.583196 [debug] [Thread-4  ]: Began compiling node model.bain_capital_analytics.int_trade_enriched
[0m19:24:09.586562 [debug] [Thread-3  ]: Writing injected SQL for node "model.bain_capital_analytics.int_daily_positions"
[0m19:24:09.590038 [debug] [Thread-4  ]: Writing injected SQL for node "model.bain_capital_analytics.int_trade_enriched"
[0m19:24:09.590918 [debug] [Thread-1  ]: Began executing node model.bain_capital_analytics.fact_trade_activity
[0m19:24:09.594387 [debug] [Thread-1  ]: Writing runtime sql for node "model.bain_capital_analytics.fact_trade_activity"
[0m19:24:09.594740 [debug] [Thread-3  ]: Began executing node model.bain_capital_analytics.int_daily_positions
[0m19:24:09.641209 [debug] [Thread-4  ]: Began executing node model.bain_capital_analytics.int_trade_enriched
[0m19:24:09.643433 [debug] [Thread-3  ]: Writing runtime sql for node "model.bain_capital_analytics.int_daily_positions"
[0m19:24:09.646684 [debug] [Thread-4  ]: Writing runtime sql for node "model.bain_capital_analytics.int_trade_enriched"
[0m19:24:09.647268 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.fact_trade_activity"
[0m19:24:09.647599 [debug] [Thread-1  ]: On model.bain_capital_analytics.fact_trade_activity: BEGIN
[0m19:24:09.647888 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m19:24:09.648393 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.int_daily_positions"
[0m19:24:09.648734 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.int_trade_enriched"
[0m19:24:09.649028 [debug] [Thread-3  ]: On model.bain_capital_analytics.int_daily_positions: BEGIN
[0m19:24:09.649334 [debug] [Thread-4  ]: On model.bain_capital_analytics.int_trade_enriched: BEGIN
[0m19:24:09.649649 [debug] [Thread-3  ]: Opening a new connection, currently in state closed
[0m19:24:09.649977 [debug] [Thread-4  ]: Opening a new connection, currently in state closed
[0m19:24:09.660060 [debug] [Thread-1  ]: SQL status: BEGIN in 0.012 seconds
[0m19:24:09.660368 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.fact_trade_activity"
[0m19:24:09.660822 [debug] [Thread-1  ]: On model.bain_capital_analytics.fact_trade_activity: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.fact_trade_activity"} */

  create view "bain_analytics"."public"."fact_trade_activity__dbt_tmp"
    
    
  as (
    -- Pipeline B: FACT table - Trade activity detail
-- Anti-pattern: repeats the SAME 3-table join as fact_portfolio_pnl and int_trade_enriched
-- Anti-pattern: could use int_trade_enriched but re-does everything

select
    t.trade_id,
    t.portfolio_id,
    t.instrument_id,
    t.counterparty_id,
    t.trade_date,
    t.settlement_date,
    t.trade_type,
    t.quantity,
    t.price,
    t.notional_amount,
    t.commission,
    t.currency,
    t.settlement_days,
    -- Anti-pattern: re-joining instruments (done in int_trade_enriched)
    i.instrument_name,
    i.instrument_type,
    i.sector,
    i.liquidity_class,
    -- Anti-pattern: re-joining counterparties (done in int_trade_enriched)
    c.counterparty_name,
    c.counterparty_type,
    c.credit_rating,
    -- Anti-pattern: re-joining portfolios (done in int_trade_enriched)
    p.portfolio_name,
    p.strategy,
    p.fund_id,
    p.manager_name,
    -- Anti-pattern: re-joining dates
    d.fiscal_quarter,
    d.fiscal_year,
    d.is_month_end,
    -- Anti-pattern: duplicated fiscal quarter logic
    case
        when extract(month from t.trade_date) between 1 and 3 then 'Q3'
        when extract(month from t.trade_date) between 4 and 6 then 'Q4'
        when extract(month from t.trade_date) between 7 and 9 then 'Q1'
        when extract(month from t.trade_date) between 10 and 12 then 'Q2'
    end as computed_fiscal_quarter,
    -- Anti-pattern: window functions recomputed (already in int_trade_enriched)
    sum(t.notional_amount) over (
        partition by t.portfolio_id
        order by t.trade_date
        rows between unbounded preceding and current row
    ) as running_notional,
    count(*) over (
        partition by t.portfolio_id, date_trunc('month', t.trade_date)
    ) as monthly_trade_count,
    sum(t.commission) over (
        partition by t.portfolio_id, date_trunc('month', t.trade_date)
    ) as monthly_commissions
from "bain_analytics"."public"."stg_trades" t
inner join "bain_analytics"."public"."stg_instruments" i
    on t.instrument_id = i.instrument_id
inner join "bain_analytics"."public"."stg_counterparties" c
    on t.counterparty_id = c.counterparty_id
inner join "bain_analytics"."public"."stg_portfolios" p
    on t.portfolio_id = p.portfolio_id
inner join "bain_analytics"."public"."stg_dates" d
    on t.trade_date = d.date_day
  );
[0m19:24:09.661323 [debug] [Thread-4  ]: SQL status: BEGIN in 0.011 seconds
[0m19:24:09.661638 [debug] [Thread-3  ]: SQL status: BEGIN in 0.012 seconds
[0m19:24:09.661952 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.int_trade_enriched"
[0m19:24:09.662256 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.int_daily_positions"
[0m19:24:09.662637 [debug] [Thread-4  ]: On model.bain_capital_analytics.int_trade_enriched: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.int_trade_enriched"} */

  create view "bain_analytics"."public"."int_trade_enriched__dbt_tmp"
    
    
  as (
    -- Pipeline B: Enriched trade data with instrument and counterparty details
-- Anti-pattern: subquery for dedup instead of QUALIFY (Snowflake)
-- Anti-pattern: heavy join that will be repeated in multiple downstream models

with latest_trades as (
    -- Anti-pattern: subquery to filter row_number instead of QUALIFY
    select *
    from (
        select
            t.*,
            i.instrument_name,
            i.instrument_type,
            i.sector,
            i.liquidity_class,
            c.counterparty_name,
            c.counterparty_type,
            c.credit_rating,
            p.portfolio_name,
            p.strategy,
            p.manager_name,
            -- Anti-pattern: duplicated fiscal quarter logic AGAIN
            case
                when extract(month from t.trade_date) between 1 and 3 then 'Q3'
                when extract(month from t.trade_date) between 4 and 6 then 'Q4'
                when extract(month from t.trade_date) between 7 and 9 then 'Q1'
                when extract(month from t.trade_date) between 10 and 12 then 'Q2'
            end as fiscal_quarter,
            row_number() over (
                partition by t.portfolio_id, t.instrument_id, t.trade_date
                order by t.trade_id desc
            ) as rn
        from "bain_analytics"."public"."stg_trades" t
        -- Anti-pattern: these 3 joins are repeated in fact_portfolio_pnl and fact_trade_activity
        inner join "bain_analytics"."public"."stg_instruments" i
            on t.instrument_id = i.instrument_id
        inner join "bain_analytics"."public"."stg_counterparties" c
            on t.counterparty_id = c.counterparty_id
        inner join "bain_analytics"."public"."stg_portfolios" p
            on t.portfolio_id = p.portfolio_id
    ) sub
    where rn = 1
)

select
    trade_id,
    portfolio_id,
    portfolio_name,
    strategy,
    manager_name,
    instrument_id,
    instrument_name,
    instrument_type,
    sector,
    liquidity_class,
    counterparty_id,
    counterparty_name,
    counterparty_type,
    credit_rating,
    trade_date,
    settlement_date,
    trade_type,
    quantity,
    price,
    notional_amount,
    commission,
    currency,
    fiscal_quarter,
    settlement_days,
    -- Anti-pattern: running total computed here AND again in downstream models
    sum(notional_amount) over (
        partition by portfolio_id
        order by trade_date
        rows between unbounded preceding and current row
    ) as cumulative_notional
from latest_trades
  );
[0m19:24:09.663104 [debug] [Thread-3  ]: On model.bain_capital_analytics.int_daily_positions: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.int_daily_positions"} */

  create view "bain_analytics"."public"."int_daily_positions__dbt_tmp"
    
    
  as (
    -- Pipeline B: Daily position snapshots with PnL calculations
-- Anti-pattern: deep CTE nesting
-- Anti-pattern: repeated joins to same dimension tables

with position_base as (
    select
        pos.position_id,
        pos.portfolio_id,
        pos.instrument_id,
        pos.position_date,
        pos.quantity,
        pos.market_value,
        pos.cost_basis,
        pos.unrealized_gain_loss,
        pos.unrealized_return_pct,
        pos.currency
    from "bain_analytics"."public"."stg_positions" pos
),

-- Anti-pattern: CTE level 2 - join instruments (same join as int_trade_enriched)
position_with_instruments as (
    select
        pb.*,
        i.instrument_name,
        i.instrument_type,
        i.sector,
        i.liquidity_class
    from position_base pb
    inner join "bain_analytics"."public"."stg_instruments" i
        on pb.instrument_id = i.instrument_id
),

-- Anti-pattern: CTE level 3 - join portfolios (same join as int_trade_enriched)
position_with_portfolio as (
    select
        pwi.*,
        p.portfolio_name,
        p.strategy,
        p.fund_id
    from position_with_instruments pwi
    inner join "bain_analytics"."public"."stg_portfolios" p
        on pwi.portfolio_id = p.portfolio_id
),

-- Anti-pattern: CTE level 4 - join dates
position_with_dates as (
    select
        pwp.*,
        d.is_business_day,
        d.is_month_end,
        d.is_quarter_end,
        d.fiscal_quarter,
        d.fiscal_year
    from position_with_portfolio pwp
    inner join "bain_analytics"."public"."stg_dates" d
        on pwp.position_date = d.date_day
),

-- Anti-pattern: CTE level 5 - compute window functions
position_with_analytics as (
    select
        pwd.*,
        -- Anti-pattern: multiple window functions on same partition
        lag(pwd.market_value) over (
            partition by pwd.portfolio_id, pwd.instrument_id
            order by pwd.position_date
        ) as prev_market_value,
        pwd.market_value - coalesce(
            lag(pwd.market_value) over (
                partition by pwd.portfolio_id, pwd.instrument_id
                order by pwd.position_date
            ), pwd.cost_basis
        ) as daily_pnl,
        sum(pwd.market_value) over (
            partition by pwd.portfolio_id, pwd.position_date
        ) as portfolio_total_mv,
        case
            when sum(pwd.market_value) over (partition by pwd.portfolio_id, pwd.position_date) != 0
            then pwd.market_value / sum(pwd.market_value) over (partition by pwd.portfolio_id, pwd.position_date)
            else 0
        end as weight_in_portfolio
    from position_with_dates pwd
)

select * from position_with_analytics
  );
[0m19:24:09.669767 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.009 seconds
[0m19:24:09.672592 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.fact_trade_activity"
[0m19:24:09.672905 [debug] [Thread-4  ]: SQL status: CREATE VIEW in 0.009 seconds
[0m19:24:09.673179 [debug] [Thread-3  ]: SQL status: CREATE VIEW in 0.010 seconds
[0m19:24:09.673459 [debug] [Thread-1  ]: On model.bain_capital_analytics.fact_trade_activity: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.fact_trade_activity"} */
alter table "bain_analytics"."public"."fact_trade_activity__dbt_tmp" rename to "fact_trade_activity"
[0m19:24:09.676153 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.int_trade_enriched"
[0m19:24:09.678748 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.int_daily_positions"
[0m19:24:09.679098 [debug] [Thread-4  ]: On model.bain_capital_analytics.int_trade_enriched: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.int_trade_enriched"} */
alter table "bain_analytics"."public"."int_trade_enriched__dbt_tmp" rename to "int_trade_enriched"
[0m19:24:09.679413 [debug] [Thread-3  ]: On model.bain_capital_analytics.int_daily_positions: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.int_daily_positions"} */
alter table "bain_analytics"."public"."int_daily_positions__dbt_tmp" rename to "int_daily_positions"
[0m19:24:09.679991 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m19:24:09.680920 [debug] [Thread-1  ]: On model.bain_capital_analytics.fact_trade_activity: COMMIT
[0m19:24:09.681230 [debug] [Thread-4  ]: SQL status: ALTER TABLE in 0.002 seconds
[0m19:24:09.681514 [debug] [Thread-3  ]: SQL status: ALTER TABLE in 0.002 seconds
[0m19:24:09.681790 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.fact_trade_activity"
[0m19:24:09.682692 [debug] [Thread-4  ]: On model.bain_capital_analytics.int_trade_enriched: COMMIT
[0m19:24:09.683614 [debug] [Thread-3  ]: On model.bain_capital_analytics.int_daily_positions: COMMIT
[0m19:24:09.683919 [debug] [Thread-1  ]: On model.bain_capital_analytics.fact_trade_activity: COMMIT
[0m19:24:09.684221 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.int_trade_enriched"
[0m19:24:09.684511 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.int_daily_positions"
[0m19:24:09.684827 [debug] [Thread-4  ]: On model.bain_capital_analytics.int_trade_enriched: COMMIT
[0m19:24:09.685116 [debug] [Thread-3  ]: On model.bain_capital_analytics.int_daily_positions: COMMIT
[0m19:24:09.685667 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m19:24:09.688636 [debug] [Thread-1  ]: Applying DROP to: "bain_analytics"."public"."fact_trade_activity__dbt_backup"
[0m19:24:09.688944 [debug] [Thread-4  ]: SQL status: COMMIT in 0.004 seconds
[0m19:24:09.689217 [debug] [Thread-3  ]: SQL status: COMMIT in 0.004 seconds
[0m19:24:09.689644 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.fact_trade_activity"
[0m19:24:09.691846 [debug] [Thread-4  ]: Applying DROP to: "bain_analytics"."public"."int_trade_enriched__dbt_backup"
[0m19:24:09.694048 [debug] [Thread-3  ]: Applying DROP to: "bain_analytics"."public"."int_daily_positions__dbt_backup"
[0m19:24:09.694378 [debug] [Thread-1  ]: On model.bain_capital_analytics.fact_trade_activity: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.fact_trade_activity"} */
drop view if exists "bain_analytics"."public"."fact_trade_activity__dbt_backup" cascade
[0m19:24:09.694863 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.int_trade_enriched"
[0m19:24:09.695325 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.int_daily_positions"
[0m19:24:09.695673 [debug] [Thread-4  ]: On model.bain_capital_analytics.int_trade_enriched: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.int_trade_enriched"} */
drop view if exists "bain_analytics"."public"."int_trade_enriched__dbt_backup" cascade
[0m19:24:09.695985 [debug] [Thread-3  ]: On model.bain_capital_analytics.int_daily_positions: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.int_daily_positions"} */
drop view if exists "bain_analytics"."public"."int_daily_positions__dbt_backup" cascade
[0m19:24:09.696297 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.001 seconds
[0m19:24:09.697400 [debug] [Thread-1  ]: On model.bain_capital_analytics.fact_trade_activity: Close
[0m19:24:09.697717 [debug] [Thread-4  ]: SQL status: DROP VIEW in 0.001 seconds
[0m19:24:09.697998 [debug] [Thread-3  ]: SQL status: DROP VIEW in 0.001 seconds
[0m19:24:09.698475 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '51f63fcd-b352-49c5-ac4e-b31e07bcdf23', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d6c89d0>]}
[0m19:24:09.699392 [debug] [Thread-4  ]: On model.bain_capital_analytics.int_trade_enriched: Close
[0m19:24:09.700294 [debug] [Thread-3  ]: On model.bain_capital_analytics.int_daily_positions: Close
[0m19:24:09.700825 [info ] [Thread-1  ]: 27 of 40 OK created sql view model public.fact_trade_activity .................. [[32mCREATE VIEW[0m in 0.12s]
[0m19:24:09.701279 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '51f63fcd-b352-49c5-ac4e-b31e07bcdf23', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d22b7f0>]}
[0m19:24:09.701845 [debug] [Thread-1  ]: Finished running node model.bain_capital_analytics.fact_trade_activity
[0m19:24:09.702135 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '51f63fcd-b352-49c5-ac4e-b31e07bcdf23', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d649640>]}
[0m19:24:09.702624 [info ] [Thread-4  ]: 29 of 40 OK created sql view model public.int_trade_enriched ................... [[32mCREATE VIEW[0m in 0.12s]
[0m19:24:09.703216 [info ] [Thread-3  ]: 28 of 40 OK created sql view model public.int_daily_positions .................. [[32mCREATE VIEW[0m in 0.12s]
[0m19:24:09.703751 [debug] [Thread-4  ]: Finished running node model.bain_capital_analytics.int_trade_enriched
[0m19:24:09.704061 [debug] [Thread-2  ]: Began running node test.bain_capital_analytics.not_null_fact_trade_activity_trade_id.6ec5fc5e45
[0m19:24:09.704373 [debug] [Thread-1  ]: Began running node test.bain_capital_analytics.unique_fact_trade_activity_trade_id.e03d2f9a00
[0m19:24:09.704775 [debug] [Thread-3  ]: Finished running node model.bain_capital_analytics.int_daily_positions
[0m19:24:09.705214 [info ] [Thread-2  ]: 30 of 40 START test not_null_fact_trade_activity_trade_id ...................... [RUN]
[0m19:24:09.705566 [debug] [Thread-4  ]: Began running node test.bain_capital_analytics.not_null_int_trade_enriched_trade_id.020f969dc8
[0m19:24:09.705851 [info ] [Thread-1  ]: 31 of 40 START test unique_fact_trade_activity_trade_id ........................ [RUN]
[0m19:24:09.706190 [debug] [Thread-3  ]: Began running node test.bain_capital_analytics.unique_int_trade_enriched_trade_id.9cdb3dc82a
[0m19:24:09.706566 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.unique_stg_portfolios_portfolio_id.aa125b6658, now test.bain_capital_analytics.not_null_fact_trade_activity_trade_id.6ec5fc5e45)
[0m19:24:09.706933 [info ] [Thread-4  ]: 32 of 40 START test not_null_int_trade_enriched_trade_id ....................... [RUN]
[0m19:24:09.707262 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.bain_capital_analytics.fact_trade_activity, now test.bain_capital_analytics.unique_fact_trade_activity_trade_id.e03d2f9a00)
[0m19:24:09.707685 [info ] [Thread-3  ]: 33 of 40 START test unique_int_trade_enriched_trade_id ......................... [RUN]
[0m19:24:09.708019 [debug] [Thread-2  ]: Began compiling node test.bain_capital_analytics.not_null_fact_trade_activity_trade_id.6ec5fc5e45
[0m19:24:09.708359 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly model.bain_capital_analytics.int_trade_enriched, now test.bain_capital_analytics.not_null_int_trade_enriched_trade_id.020f969dc8)
[0m19:24:09.708670 [debug] [Thread-1  ]: Began compiling node test.bain_capital_analytics.unique_fact_trade_activity_trade_id.e03d2f9a00
[0m19:24:09.708984 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly model.bain_capital_analytics.int_daily_positions, now test.bain_capital_analytics.unique_int_trade_enriched_trade_id.9cdb3dc82a)
[0m19:24:09.712800 [debug] [Thread-2  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_fact_trade_activity_trade_id.6ec5fc5e45"
[0m19:24:09.713140 [debug] [Thread-4  ]: Began compiling node test.bain_capital_analytics.not_null_int_trade_enriched_trade_id.020f969dc8
[0m19:24:09.716443 [debug] [Thread-1  ]: Writing injected SQL for node "test.bain_capital_analytics.unique_fact_trade_activity_trade_id.e03d2f9a00"
[0m19:24:09.716774 [debug] [Thread-3  ]: Began compiling node test.bain_capital_analytics.unique_int_trade_enriched_trade_id.9cdb3dc82a
[0m19:24:09.720110 [debug] [Thread-4  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_int_trade_enriched_trade_id.020f969dc8"
[0m19:24:09.724863 [debug] [Thread-3  ]: Writing injected SQL for node "test.bain_capital_analytics.unique_int_trade_enriched_trade_id.9cdb3dc82a"
[0m19:24:09.725231 [debug] [Thread-2  ]: Began executing node test.bain_capital_analytics.not_null_fact_trade_activity_trade_id.6ec5fc5e45
[0m19:24:09.727583 [debug] [Thread-2  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_fact_trade_activity_trade_id.6ec5fc5e45"
[0m19:24:09.728044 [debug] [Thread-4  ]: Began executing node test.bain_capital_analytics.not_null_int_trade_enriched_trade_id.020f969dc8
[0m19:24:09.730332 [debug] [Thread-4  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_int_trade_enriched_trade_id.020f969dc8"
[0m19:24:09.730669 [debug] [Thread-1  ]: Began executing node test.bain_capital_analytics.unique_fact_trade_activity_trade_id.e03d2f9a00
[0m19:24:09.731050 [debug] [Thread-3  ]: Began executing node test.bain_capital_analytics.unique_int_trade_enriched_trade_id.9cdb3dc82a
[0m19:24:09.733339 [debug] [Thread-1  ]: Writing runtime sql for node "test.bain_capital_analytics.unique_fact_trade_activity_trade_id.e03d2f9a00"
[0m19:24:09.733724 [debug] [Thread-2  ]: Using postgres connection "test.bain_capital_analytics.not_null_fact_trade_activity_trade_id.6ec5fc5e45"
[0m19:24:09.735863 [debug] [Thread-3  ]: Writing runtime sql for node "test.bain_capital_analytics.unique_int_trade_enriched_trade_id.9cdb3dc82a"
[0m19:24:09.736352 [debug] [Thread-4  ]: Using postgres connection "test.bain_capital_analytics.not_null_int_trade_enriched_trade_id.020f969dc8"
[0m19:24:09.736668 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_fact_trade_activity_trade_id.6ec5fc5e45: BEGIN
[0m19:24:09.737081 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_int_trade_enriched_trade_id.020f969dc8: BEGIN
[0m19:24:09.737424 [debug] [Thread-1  ]: Using postgres connection "test.bain_capital_analytics.unique_fact_trade_activity_trade_id.e03d2f9a00"
[0m19:24:09.737716 [debug] [Thread-2  ]: Opening a new connection, currently in state closed
[0m19:24:09.738029 [debug] [Thread-4  ]: Opening a new connection, currently in state closed
[0m19:24:09.738362 [debug] [Thread-3  ]: Using postgres connection "test.bain_capital_analytics.unique_int_trade_enriched_trade_id.9cdb3dc82a"
[0m19:24:09.738669 [debug] [Thread-1  ]: On test.bain_capital_analytics.unique_fact_trade_activity_trade_id.e03d2f9a00: BEGIN
[0m19:24:09.739197 [debug] [Thread-3  ]: On test.bain_capital_analytics.unique_int_trade_enriched_trade_id.9cdb3dc82a: BEGIN
[0m19:24:09.739500 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m19:24:09.739797 [debug] [Thread-3  ]: Opening a new connection, currently in state closed
[0m19:24:09.751811 [debug] [Thread-4  ]: SQL status: BEGIN in 0.014 seconds
[0m19:24:09.752257 [debug] [Thread-4  ]: Using postgres connection "test.bain_capital_analytics.not_null_int_trade_enriched_trade_id.020f969dc8"
[0m19:24:09.752656 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_int_trade_enriched_trade_id.020f969dc8: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_int_trade_enriched_trade_id.020f969dc8"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select trade_id
from "bain_analytics"."public"."int_trade_enriched"
where trade_id is null



  
  
      
    ) dbt_internal_test
[0m19:24:09.753028 [debug] [Thread-2  ]: SQL status: BEGIN in 0.015 seconds
[0m19:24:09.753331 [debug] [Thread-1  ]: SQL status: BEGIN in 0.014 seconds
[0m19:24:09.753653 [debug] [Thread-3  ]: SQL status: BEGIN in 0.014 seconds
[0m19:24:09.753993 [debug] [Thread-2  ]: Using postgres connection "test.bain_capital_analytics.not_null_fact_trade_activity_trade_id.6ec5fc5e45"
[0m19:24:09.754293 [debug] [Thread-1  ]: Using postgres connection "test.bain_capital_analytics.unique_fact_trade_activity_trade_id.e03d2f9a00"
[0m19:24:09.754581 [debug] [Thread-3  ]: Using postgres connection "test.bain_capital_analytics.unique_int_trade_enriched_trade_id.9cdb3dc82a"
[0m19:24:09.754884 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_fact_trade_activity_trade_id.6ec5fc5e45: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_fact_trade_activity_trade_id.6ec5fc5e45"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select trade_id
from "bain_analytics"."public"."fact_trade_activity"
where trade_id is null



  
  
      
    ) dbt_internal_test
[0m19:24:09.755216 [debug] [Thread-1  ]: On test.bain_capital_analytics.unique_fact_trade_activity_trade_id.e03d2f9a00: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.unique_fact_trade_activity_trade_id.e03d2f9a00"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

select
    trade_id as unique_field,
    count(*) as n_records

from "bain_analytics"."public"."fact_trade_activity"
where trade_id is not null
group by trade_id
having count(*) > 1



  
  
      
    ) dbt_internal_test
[0m19:24:09.755540 [debug] [Thread-3  ]: On test.bain_capital_analytics.unique_int_trade_enriched_trade_id.9cdb3dc82a: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.unique_int_trade_enriched_trade_id.9cdb3dc82a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

select
    trade_id as unique_field,
    count(*) as n_records

from "bain_analytics"."public"."int_trade_enriched"
where trade_id is not null
group by trade_id
having count(*) > 1



  
  
      
    ) dbt_internal_test
[0m19:24:09.759670 [debug] [Thread-4  ]: SQL status: SELECT 1 in 0.006 seconds
[0m19:24:09.761203 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_int_trade_enriched_trade_id.020f969dc8: ROLLBACK
[0m19:24:09.762226 [debug] [Thread-1  ]: SQL status: SELECT 1 in 0.006 seconds
[0m19:24:09.762594 [debug] [Thread-2  ]: SQL status: SELECT 1 in 0.007 seconds
[0m19:24:09.763678 [debug] [Thread-1  ]: On test.bain_capital_analytics.unique_fact_trade_activity_trade_id.e03d2f9a00: ROLLBACK
[0m19:24:09.763979 [debug] [Thread-3  ]: SQL status: SELECT 1 in 0.008 seconds
[0m19:24:09.764260 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_int_trade_enriched_trade_id.020f969dc8: Close
[0m19:24:09.765273 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_fact_trade_activity_trade_id.6ec5fc5e45: ROLLBACK
[0m19:24:09.766455 [debug] [Thread-3  ]: On test.bain_capital_analytics.unique_int_trade_enriched_trade_id.9cdb3dc82a: ROLLBACK
[0m19:24:09.766799 [debug] [Thread-1  ]: On test.bain_capital_analytics.unique_fact_trade_activity_trade_id.e03d2f9a00: Close
[0m19:24:09.767374 [info ] [Thread-4  ]: 32 of 40 PASS not_null_int_trade_enriched_trade_id ............................. [[32mPASS[0m in 0.06s]
[0m19:24:09.767710 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_fact_trade_activity_trade_id.6ec5fc5e45: Close
[0m19:24:09.768213 [info ] [Thread-1  ]: 31 of 40 PASS unique_fact_trade_activity_trade_id .............................. [[32mPASS[0m in 0.06s]
[0m19:24:09.768556 [debug] [Thread-3  ]: On test.bain_capital_analytics.unique_int_trade_enriched_trade_id.9cdb3dc82a: Close
[0m19:24:09.769019 [debug] [Thread-4  ]: Finished running node test.bain_capital_analytics.not_null_int_trade_enriched_trade_id.020f969dc8
[0m19:24:09.769488 [debug] [Thread-1  ]: Finished running node test.bain_capital_analytics.unique_fact_trade_activity_trade_id.e03d2f9a00
[0m19:24:09.769894 [info ] [Thread-2  ]: 30 of 40 PASS not_null_fact_trade_activity_trade_id ............................ [[32mPASS[0m in 0.06s]
[0m19:24:09.770297 [debug] [Thread-4  ]: Began running node test.bain_capital_analytics.not_null_int_daily_positions_position_id.198d23a5e6
[0m19:24:09.770720 [info ] [Thread-3  ]: 33 of 40 PASS unique_int_trade_enriched_trade_id ............................... [[32mPASS[0m in 0.06s]
[0m19:24:09.771309 [debug] [Thread-2  ]: Finished running node test.bain_capital_analytics.not_null_fact_trade_activity_trade_id.6ec5fc5e45
[0m19:24:09.771664 [info ] [Thread-4  ]: 34 of 40 START test not_null_int_daily_positions_position_id ................... [RUN]
[0m19:24:09.772119 [debug] [Thread-3  ]: Finished running node test.bain_capital_analytics.unique_int_trade_enriched_trade_id.9cdb3dc82a
[0m19:24:09.772553 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.not_null_int_trade_enriched_trade_id.020f969dc8, now test.bain_capital_analytics.not_null_int_daily_positions_position_id.198d23a5e6)
[0m19:24:09.772942 [debug] [Thread-4  ]: Began compiling node test.bain_capital_analytics.not_null_int_daily_positions_position_id.198d23a5e6
[0m19:24:09.778755 [debug] [Thread-4  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_int_daily_positions_position_id.198d23a5e6"
[0m19:24:09.779446 [debug] [Thread-4  ]: Began executing node test.bain_capital_analytics.not_null_int_daily_positions_position_id.198d23a5e6
[0m19:24:09.781750 [debug] [Thread-4  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_int_daily_positions_position_id.198d23a5e6"
[0m19:24:09.782281 [debug] [Thread-4  ]: Using postgres connection "test.bain_capital_analytics.not_null_int_daily_positions_position_id.198d23a5e6"
[0m19:24:09.782584 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_int_daily_positions_position_id.198d23a5e6: BEGIN
[0m19:24:09.782875 [debug] [Thread-4  ]: Opening a new connection, currently in state closed
[0m19:24:09.790762 [debug] [Thread-4  ]: SQL status: BEGIN in 0.008 seconds
[0m19:24:09.791098 [debug] [Thread-4  ]: Using postgres connection "test.bain_capital_analytics.not_null_int_daily_positions_position_id.198d23a5e6"
[0m19:24:09.791470 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_int_daily_positions_position_id.198d23a5e6: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_int_daily_positions_position_id.198d23a5e6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select position_id
from "bain_analytics"."public"."int_daily_positions"
where position_id is null



  
  
      
    ) dbt_internal_test
[0m19:24:09.796224 [debug] [Thread-4  ]: SQL status: SELECT 1 in 0.004 seconds
[0m19:24:09.797506 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_int_daily_positions_position_id.198d23a5e6: ROLLBACK
[0m19:24:09.798131 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_int_daily_positions_position_id.198d23a5e6: Close
[0m19:24:09.798738 [info ] [Thread-4  ]: 34 of 40 PASS not_null_int_daily_positions_position_id ......................... [[32mPASS[0m in 0.03s]
[0m19:24:09.799240 [debug] [Thread-4  ]: Finished running node test.bain_capital_analytics.not_null_int_daily_positions_position_id.198d23a5e6
[0m19:24:09.799917 [debug] [Thread-1  ]: Began running node model.bain_capital_analytics.fact_portfolio_pnl
[0m19:24:09.800377 [info ] [Thread-1  ]: 35 of 40 START sql view model public.fact_portfolio_pnl ........................ [RUN]
[0m19:24:09.800756 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.unique_fact_trade_activity_trade_id.e03d2f9a00, now model.bain_capital_analytics.fact_portfolio_pnl)
[0m19:24:09.801065 [debug] [Thread-1  ]: Began compiling node model.bain_capital_analytics.fact_portfolio_pnl
[0m19:24:09.805024 [debug] [Thread-1  ]: Writing injected SQL for node "model.bain_capital_analytics.fact_portfolio_pnl"
[0m19:24:09.805655 [debug] [Thread-1  ]: Began executing node model.bain_capital_analytics.fact_portfolio_pnl
[0m19:24:09.809047 [debug] [Thread-1  ]: Writing runtime sql for node "model.bain_capital_analytics.fact_portfolio_pnl"
[0m19:24:09.809632 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.fact_portfolio_pnl"
[0m19:24:09.809938 [debug] [Thread-1  ]: On model.bain_capital_analytics.fact_portfolio_pnl: BEGIN
[0m19:24:09.810214 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m19:24:09.818107 [debug] [Thread-1  ]: SQL status: BEGIN in 0.008 seconds
[0m19:24:09.818439 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.fact_portfolio_pnl"
[0m19:24:09.818837 [debug] [Thread-1  ]: On model.bain_capital_analytics.fact_portfolio_pnl: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.fact_portfolio_pnl"} */

  create view "bain_analytics"."public"."fact_portfolio_pnl__dbt_tmp"
    
    
  as (
    -- Pipeline B: FACT table - Portfolio PnL by date
-- Anti-pattern: repeats the same heavy 3-table join as int_trade_enriched
-- Anti-pattern: late aggregation after expensive joins
-- Anti-pattern: materialized as view (should be table/incremental)

with trade_pnl as (
    -- Anti-pattern: re-joining trades to instruments and portfolios
    -- (same join already done in int_trade_enriched)
    select
        t.portfolio_id,
        t.trade_date,
        t.instrument_id,
        t.trade_type,
        t.notional_amount,
        t.commission,
        i.instrument_name,
        i.instrument_type,
        i.sector,
        p.portfolio_name,
        p.strategy,
        p.fund_id,
        d.fiscal_quarter,
        d.fiscal_year,
        d.is_month_end,
        d.is_quarter_end
    from "bain_analytics"."public"."stg_trades" t
    inner join "bain_analytics"."public"."stg_instruments" i
        on t.instrument_id = i.instrument_id
    inner join "bain_analytics"."public"."stg_portfolios" p
        on t.portfolio_id = p.portfolio_id
    inner join "bain_analytics"."public"."stg_dates" d
        on t.trade_date = d.date_day
),

position_pnl as (
    select
        dp.portfolio_id,
        dp.position_date,
        dp.portfolio_name,
        dp.strategy,
        dp.fund_id,
        dp.fiscal_quarter,
        dp.fiscal_year,
        sum(dp.daily_pnl) as position_daily_pnl,
        sum(dp.market_value) as total_market_value,
        count(distinct dp.instrument_id) as num_positions
    from "bain_analytics"."public"."int_daily_positions" dp
    group by
        dp.portfolio_id, dp.position_date, dp.portfolio_name,
        dp.strategy, dp.fund_id, dp.fiscal_quarter, dp.fiscal_year
),

-- Anti-pattern: aggregating trades separately then joining back
trade_activity as (
    select
        portfolio_id,
        trade_date,
        sum(notional_amount) as total_traded_notional,
        sum(commission) as total_commissions,
        count(*) as num_trades
    from trade_pnl
    group by portfolio_id, trade_date
)

select
    pp.portfolio_id,
    pp.portfolio_name,
    pp.strategy,
    pp.fund_id,
    pp.position_date as pnl_date,
    pp.fiscal_quarter,
    pp.fiscal_year,
    pp.position_daily_pnl,
    pp.total_market_value,
    pp.num_positions,
    coalesce(ta.total_traded_notional, 0) as total_traded_notional,
    coalesce(ta.total_commissions, 0) as total_commissions,
    coalesce(ta.num_trades, 0) as num_trades,
    -- Anti-pattern: running total recomputed here (already in int_trade_enriched)
    sum(pp.position_daily_pnl) over (
        partition by pp.portfolio_id
        order by pp.position_date
        rows between unbounded preceding and current row
    ) as cumulative_pnl
from position_pnl pp
left join trade_activity ta
    on pp.portfolio_id = ta.portfolio_id
    and pp.position_date = ta.trade_date
  );
[0m19:24:09.824623 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.005 seconds
[0m19:24:09.827576 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.fact_portfolio_pnl"
[0m19:24:09.827892 [debug] [Thread-1  ]: On model.bain_capital_analytics.fact_portfolio_pnl: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.fact_portfolio_pnl"} */
alter table "bain_analytics"."public"."fact_portfolio_pnl__dbt_tmp" rename to "fact_portfolio_pnl"
[0m19:24:09.828897 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m19:24:09.829860 [debug] [Thread-1  ]: On model.bain_capital_analytics.fact_portfolio_pnl: COMMIT
[0m19:24:09.830176 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.fact_portfolio_pnl"
[0m19:24:09.830454 [debug] [Thread-1  ]: On model.bain_capital_analytics.fact_portfolio_pnl: COMMIT
[0m19:24:09.831529 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m19:24:09.833927 [debug] [Thread-1  ]: Applying DROP to: "bain_analytics"."public"."fact_portfolio_pnl__dbt_backup"
[0m19:24:09.834429 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.fact_portfolio_pnl"
[0m19:24:09.834739 [debug] [Thread-1  ]: On model.bain_capital_analytics.fact_portfolio_pnl: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.fact_portfolio_pnl"} */
drop view if exists "bain_analytics"."public"."fact_portfolio_pnl__dbt_backup" cascade
[0m19:24:09.835376 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.000 seconds
[0m19:24:09.836456 [debug] [Thread-1  ]: On model.bain_capital_analytics.fact_portfolio_pnl: Close
[0m19:24:09.837051 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '51f63fcd-b352-49c5-ac4e-b31e07bcdf23', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d35abb0>]}
[0m19:24:09.837652 [info ] [Thread-1  ]: 35 of 40 OK created sql view model public.fact_portfolio_pnl ................... [[32mCREATE VIEW[0m in 0.04s]
[0m19:24:09.838123 [debug] [Thread-1  ]: Finished running node model.bain_capital_analytics.fact_portfolio_pnl
[0m19:24:09.838849 [debug] [Thread-3  ]: Began running node test.bain_capital_analytics.assert_pnl_balanced
[0m19:24:09.839212 [debug] [Thread-4  ]: Began running node test.bain_capital_analytics.not_null_fact_portfolio_pnl_pnl_date.1a8f6bfde4
[0m19:24:09.839545 [info ] [Thread-3  ]: 36 of 40 START test assert_pnl_balanced ........................................ [RUN]
[0m19:24:09.839952 [debug] [Thread-2  ]: Began running node test.bain_capital_analytics.not_null_fact_portfolio_pnl_portfolio_id.f71baa71b4
[0m19:24:09.840242 [info ] [Thread-4  ]: 37 of 40 START test not_null_fact_portfolio_pnl_pnl_date ....................... [RUN]
[0m19:24:09.840624 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.unique_int_trade_enriched_trade_id.9cdb3dc82a, now test.bain_capital_analytics.assert_pnl_balanced)
[0m19:24:09.841037 [info ] [Thread-2  ]: 38 of 40 START test not_null_fact_portfolio_pnl_portfolio_id ................... [RUN]
[0m19:24:09.841408 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.not_null_int_daily_positions_position_id.198d23a5e6, now test.bain_capital_analytics.not_null_fact_portfolio_pnl_pnl_date.1a8f6bfde4)
[0m19:24:09.841725 [debug] [Thread-3  ]: Began compiling node test.bain_capital_analytics.assert_pnl_balanced
[0m19:24:09.842046 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.not_null_fact_trade_activity_trade_id.6ec5fc5e45, now test.bain_capital_analytics.not_null_fact_portfolio_pnl_portfolio_id.f71baa71b4)
[0m19:24:09.842349 [debug] [Thread-4  ]: Began compiling node test.bain_capital_analytics.not_null_fact_portfolio_pnl_pnl_date.1a8f6bfde4
[0m19:24:09.846928 [debug] [Thread-3  ]: Writing injected SQL for node "test.bain_capital_analytics.assert_pnl_balanced"
[0m19:24:09.847258 [debug] [Thread-2  ]: Began compiling node test.bain_capital_analytics.not_null_fact_portfolio_pnl_portfolio_id.f71baa71b4
[0m19:24:09.850726 [debug] [Thread-4  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_fact_portfolio_pnl_pnl_date.1a8f6bfde4"
[0m19:24:09.854251 [debug] [Thread-2  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_fact_portfolio_pnl_portfolio_id.f71baa71b4"
[0m19:24:09.854786 [debug] [Thread-3  ]: Began executing node test.bain_capital_analytics.assert_pnl_balanced
[0m19:24:09.857026 [debug] [Thread-3  ]: Writing runtime sql for node "test.bain_capital_analytics.assert_pnl_balanced"
[0m19:24:09.857593 [debug] [Thread-4  ]: Began executing node test.bain_capital_analytics.not_null_fact_portfolio_pnl_pnl_date.1a8f6bfde4
[0m19:24:09.857912 [debug] [Thread-2  ]: Began executing node test.bain_capital_analytics.not_null_fact_portfolio_pnl_portfolio_id.f71baa71b4
[0m19:24:09.860165 [debug] [Thread-4  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_fact_portfolio_pnl_pnl_date.1a8f6bfde4"
[0m19:24:09.862425 [debug] [Thread-2  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_fact_portfolio_pnl_portfolio_id.f71baa71b4"
[0m19:24:09.862790 [debug] [Thread-3  ]: Using postgres connection "test.bain_capital_analytics.assert_pnl_balanced"
[0m19:24:09.863223 [debug] [Thread-3  ]: On test.bain_capital_analytics.assert_pnl_balanced: BEGIN
[0m19:24:09.863517 [debug] [Thread-3  ]: Opening a new connection, currently in state closed
[0m19:24:09.864035 [debug] [Thread-2  ]: Using postgres connection "test.bain_capital_analytics.not_null_fact_portfolio_pnl_portfolio_id.f71baa71b4"
[0m19:24:09.864393 [debug] [Thread-4  ]: Using postgres connection "test.bain_capital_analytics.not_null_fact_portfolio_pnl_pnl_date.1a8f6bfde4"
[0m19:24:09.864715 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_fact_portfolio_pnl_portfolio_id.f71baa71b4: BEGIN
[0m19:24:09.865028 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_fact_portfolio_pnl_pnl_date.1a8f6bfde4: BEGIN
[0m19:24:09.865327 [debug] [Thread-2  ]: Opening a new connection, currently in state closed
[0m19:24:09.865618 [debug] [Thread-4  ]: Opening a new connection, currently in state closed
[0m19:24:09.873486 [debug] [Thread-3  ]: SQL status: BEGIN in 0.010 seconds
[0m19:24:09.873833 [debug] [Thread-3  ]: Using postgres connection "test.bain_capital_analytics.assert_pnl_balanced"
[0m19:24:09.874152 [debug] [Thread-3  ]: On test.bain_capital_analytics.assert_pnl_balanced: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.assert_pnl_balanced"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  -- Custom test: Ensure total PnL across all portfolios is reasonable
-- (not wildly negative, which would indicate a data or logic error)

select
    pnl_date,
    sum(position_daily_pnl) as total_daily_pnl
from "bain_analytics"."public"."fact_portfolio_pnl"
group by pnl_date
having sum(position_daily_pnl) < -100000000  -- flag if total daily loss exceeds $100M
  
  
      
    ) dbt_internal_test
[0m19:24:09.874980 [debug] [Thread-2  ]: SQL status: BEGIN in 0.010 seconds
[0m19:24:09.875309 [debug] [Thread-4  ]: SQL status: BEGIN in 0.010 seconds
[0m19:24:09.875624 [debug] [Thread-2  ]: Using postgres connection "test.bain_capital_analytics.not_null_fact_portfolio_pnl_portfolio_id.f71baa71b4"
[0m19:24:09.875939 [debug] [Thread-4  ]: Using postgres connection "test.bain_capital_analytics.not_null_fact_portfolio_pnl_pnl_date.1a8f6bfde4"
[0m19:24:09.876266 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_fact_portfolio_pnl_portfolio_id.f71baa71b4: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_fact_portfolio_pnl_portfolio_id.f71baa71b4"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select portfolio_id
from "bain_analytics"."public"."fact_portfolio_pnl"
where portfolio_id is null



  
  
      
    ) dbt_internal_test
[0m19:24:09.876581 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_fact_portfolio_pnl_pnl_date.1a8f6bfde4: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_fact_portfolio_pnl_pnl_date.1a8f6bfde4"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select pnl_date
from "bain_analytics"."public"."fact_portfolio_pnl"
where pnl_date is null



  
  
      
    ) dbt_internal_test
[0m19:24:09.881113 [debug] [Thread-3  ]: SQL status: SELECT 1 in 0.007 seconds
[0m19:24:09.882441 [debug] [Thread-3  ]: On test.bain_capital_analytics.assert_pnl_balanced: ROLLBACK
[0m19:24:09.882785 [debug] [Thread-2  ]: SQL status: SELECT 1 in 0.006 seconds
[0m19:24:09.883126 [debug] [Thread-4  ]: SQL status: SELECT 1 in 0.006 seconds
[0m19:24:09.884282 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_fact_portfolio_pnl_portfolio_id.f71baa71b4: ROLLBACK
[0m19:24:09.884599 [debug] [Thread-3  ]: On test.bain_capital_analytics.assert_pnl_balanced: Close
[0m19:24:09.885708 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_fact_portfolio_pnl_pnl_date.1a8f6bfde4: ROLLBACK
[0m19:24:09.886297 [info ] [Thread-3  ]: 36 of 40 PASS assert_pnl_balanced .............................................. [[32mPASS[0m in 0.05s]
[0m19:24:09.886623 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_fact_portfolio_pnl_portfolio_id.f71baa71b4: Close
[0m19:24:09.887070 [debug] [Thread-3  ]: Finished running node test.bain_capital_analytics.assert_pnl_balanced
[0m19:24:09.887370 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_fact_portfolio_pnl_pnl_date.1a8f6bfde4: Close
[0m19:24:09.887812 [info ] [Thread-2  ]: 38 of 40 PASS not_null_fact_portfolio_pnl_portfolio_id ......................... [[32mPASS[0m in 0.05s]
[0m19:24:09.888415 [debug] [Thread-2  ]: Finished running node test.bain_capital_analytics.not_null_fact_portfolio_pnl_portfolio_id.f71baa71b4
[0m19:24:09.888878 [info ] [Thread-4  ]: 37 of 40 PASS not_null_fact_portfolio_pnl_pnl_date ............................. [[32mPASS[0m in 0.05s]
[0m19:24:09.889314 [debug] [Thread-4  ]: Finished running node test.bain_capital_analytics.not_null_fact_portfolio_pnl_pnl_date.1a8f6bfde4
[0m19:24:09.889899 [debug] [Thread-1  ]: Began running node model.bain_capital_analytics.report_daily_pnl
[0m19:24:09.890337 [info ] [Thread-1  ]: 39 of 40 START sql view model public.report_daily_pnl .......................... [RUN]
[0m19:24:09.890754 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.bain_capital_analytics.fact_portfolio_pnl, now model.bain_capital_analytics.report_daily_pnl)
[0m19:24:09.891104 [debug] [Thread-1  ]: Began compiling node model.bain_capital_analytics.report_daily_pnl
[0m19:24:09.895776 [debug] [Thread-1  ]: Writing injected SQL for node "model.bain_capital_analytics.report_daily_pnl"
[0m19:24:09.896386 [debug] [Thread-1  ]: Began executing node model.bain_capital_analytics.report_daily_pnl
[0m19:24:09.899788 [debug] [Thread-1  ]: Writing runtime sql for node "model.bain_capital_analytics.report_daily_pnl"
[0m19:24:09.900334 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.report_daily_pnl"
[0m19:24:09.900630 [debug] [Thread-1  ]: On model.bain_capital_analytics.report_daily_pnl: BEGIN
[0m19:24:09.900914 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m19:24:09.908964 [debug] [Thread-1  ]: SQL status: BEGIN in 0.008 seconds
[0m19:24:09.909310 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.report_daily_pnl"
[0m19:24:09.909702 [debug] [Thread-1  ]: On model.bain_capital_analytics.report_daily_pnl: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.report_daily_pnl"} */

  create view "bain_analytics"."public"."report_daily_pnl__dbt_tmp"
    
    
  as (
    -- Pipeline B: REPORT table - Daily PnL report for portfolio managers
-- Anti-pattern: subquery for latest-only instead of QUALIFY
-- Anti-pattern: re-aggregation from fact that's already aggregated

with latest_pnl as (
    select *
    from (
        select
            fpnl.*,
            -- Anti-pattern: subquery dedup instead of QUALIFY
            row_number() over (
                partition by fpnl.portfolio_id
                order by fpnl.pnl_date desc
            ) as rn
        from "bain_analytics"."public"."fact_portfolio_pnl" fpnl
    ) sub
    where rn <= 5  -- last 5 dates per portfolio
),

-- Anti-pattern: re-joining to get benchmark data that should be part of the pipeline
pnl_with_benchmark as (
    select
        lp.*,
        bm.return_mtd as benchmark_return_mtd,
        bm.return_ytd as benchmark_return_ytd,
        bm.benchmark_name
    from latest_pnl lp
    left join "bain_analytics"."public"."stg_benchmarks" bm
        on lp.pnl_date = bm.benchmark_date
        and bm.benchmark_id = 'BM_SP500'
)

select
    portfolio_id,
    portfolio_name,
    strategy,
    pnl_date,
    fiscal_quarter,
    position_daily_pnl,
    cumulative_pnl,
    total_market_value,
    num_positions,
    total_traded_notional,
    total_commissions,
    num_trades,
    benchmark_name,
    benchmark_return_mtd,
    benchmark_return_ytd,
    -- Anti-pattern: computing return inline instead of upstream
    case
        when total_market_value != 0
        then position_daily_pnl / total_market_value
        else 0
    end as daily_return_pct
from pnl_with_benchmark
order by portfolio_id, pnl_date desc
  );
[0m19:24:09.914588 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.004 seconds
[0m19:24:09.917577 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.report_daily_pnl"
[0m19:24:09.917891 [debug] [Thread-1  ]: On model.bain_capital_analytics.report_daily_pnl: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.report_daily_pnl"} */
alter table "bain_analytics"."public"."report_daily_pnl__dbt_tmp" rename to "report_daily_pnl"
[0m19:24:09.918840 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m19:24:09.919870 [debug] [Thread-1  ]: On model.bain_capital_analytics.report_daily_pnl: COMMIT
[0m19:24:09.920202 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.report_daily_pnl"
[0m19:24:09.920490 [debug] [Thread-1  ]: On model.bain_capital_analytics.report_daily_pnl: COMMIT
[0m19:24:09.921560 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m19:24:09.923915 [debug] [Thread-1  ]: Applying DROP to: "bain_analytics"."public"."report_daily_pnl__dbt_backup"
[0m19:24:09.924448 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.report_daily_pnl"
[0m19:24:09.924753 [debug] [Thread-1  ]: On model.bain_capital_analytics.report_daily_pnl: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.report_daily_pnl"} */
drop view if exists "bain_analytics"."public"."report_daily_pnl__dbt_backup" cascade
[0m19:24:09.925356 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.000 seconds
[0m19:24:09.926381 [debug] [Thread-1  ]: On model.bain_capital_analytics.report_daily_pnl: Close
[0m19:24:09.926902 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '51f63fcd-b352-49c5-ac4e-b31e07bcdf23', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d488070>]}
[0m19:24:09.927462 [info ] [Thread-1  ]: 39 of 40 OK created sql view model public.report_daily_pnl ..................... [[32mCREATE VIEW[0m in 0.04s]
[0m19:24:09.927924 [debug] [Thread-1  ]: Finished running node model.bain_capital_analytics.report_daily_pnl
[0m19:24:09.928573 [debug] [Thread-2  ]: Began running node test.bain_capital_analytics.not_null_report_daily_pnl_portfolio_id.37974cbf9b
[0m19:24:09.928925 [info ] [Thread-2  ]: 40 of 40 START test not_null_report_daily_pnl_portfolio_id ..................... [RUN]
[0m19:24:09.929289 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.not_null_fact_portfolio_pnl_portfolio_id.f71baa71b4, now test.bain_capital_analytics.not_null_report_daily_pnl_portfolio_id.37974cbf9b)
[0m19:24:09.929602 [debug] [Thread-2  ]: Began compiling node test.bain_capital_analytics.not_null_report_daily_pnl_portfolio_id.37974cbf9b
[0m19:24:09.933253 [debug] [Thread-2  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_report_daily_pnl_portfolio_id.37974cbf9b"
[0m19:24:09.933898 [debug] [Thread-2  ]: Began executing node test.bain_capital_analytics.not_null_report_daily_pnl_portfolio_id.37974cbf9b
[0m19:24:09.937321 [debug] [Thread-2  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_report_daily_pnl_portfolio_id.37974cbf9b"
[0m19:24:09.937852 [debug] [Thread-2  ]: Using postgres connection "test.bain_capital_analytics.not_null_report_daily_pnl_portfolio_id.37974cbf9b"
[0m19:24:09.938148 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_report_daily_pnl_portfolio_id.37974cbf9b: BEGIN
[0m19:24:09.938426 [debug] [Thread-2  ]: Opening a new connection, currently in state closed
[0m19:24:09.946711 [debug] [Thread-2  ]: SQL status: BEGIN in 0.008 seconds
[0m19:24:09.947033 [debug] [Thread-2  ]: Using postgres connection "test.bain_capital_analytics.not_null_report_daily_pnl_portfolio_id.37974cbf9b"
[0m19:24:09.947329 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_report_daily_pnl_portfolio_id.37974cbf9b: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_report_daily_pnl_portfolio_id.37974cbf9b"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select portfolio_id
from "bain_analytics"."public"."report_daily_pnl"
where portfolio_id is null



  
  
      
    ) dbt_internal_test
[0m19:24:09.956327 [debug] [Thread-2  ]: SQL status: SELECT 1 in 0.009 seconds
[0m19:24:09.957672 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_report_daily_pnl_portfolio_id.37974cbf9b: ROLLBACK
[0m19:24:09.958276 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_report_daily_pnl_portfolio_id.37974cbf9b: Close
[0m19:24:09.958796 [info ] [Thread-2  ]: 40 of 40 PASS not_null_report_daily_pnl_portfolio_id ........................... [[32mPASS[0m in 0.03s]
[0m19:24:09.959263 [debug] [Thread-2  ]: Finished running node test.bain_capital_analytics.not_null_report_daily_pnl_portfolio_id.37974cbf9b
[0m19:24:09.960459 [debug] [MainThread]: Using postgres connection "master"
[0m19:24:09.960729 [debug] [MainThread]: On master: BEGIN
[0m19:24:09.960969 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m19:24:09.969235 [debug] [MainThread]: SQL status: BEGIN in 0.008 seconds
[0m19:24:09.969538 [debug] [MainThread]: On master: COMMIT
[0m19:24:09.969797 [debug] [MainThread]: Using postgres connection "master"
[0m19:24:09.970036 [debug] [MainThread]: On master: COMMIT
[0m19:24:09.970509 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m19:24:09.970767 [debug] [MainThread]: On master: Close
[0m19:24:09.971103 [debug] [MainThread]: Connection 'master' was properly closed.
[0m19:24:09.971343 [debug] [MainThread]: Connection 'model.bain_capital_analytics.report_daily_pnl' was properly closed.
[0m19:24:09.971570 [debug] [MainThread]: Connection 'test.bain_capital_analytics.not_null_report_daily_pnl_portfolio_id.37974cbf9b' was properly closed.
[0m19:24:09.971789 [debug] [MainThread]: Connection 'test.bain_capital_analytics.assert_pnl_balanced' was properly closed.
[0m19:24:09.972011 [debug] [MainThread]: Connection 'test.bain_capital_analytics.not_null_fact_portfolio_pnl_pnl_date.1a8f6bfde4' was properly closed.
[0m19:24:09.972374 [info ] [MainThread]: 
[0m19:24:09.972700 [info ] [MainThread]: Finished running 28 data tests, 12 view models in 0 hours 0 minutes and 1.23 seconds (1.23s).
[0m19:24:09.977227 [debug] [MainThread]: Command end result
[0m19:24:10.019566 [debug] [MainThread]: Wrote artifact WritableManifest to ./target/manifest.json
[0m19:24:10.021285 [debug] [MainThread]: Wrote artifact SemanticManifest to ./target/semantic_manifest.json
[0m19:24:10.028763 [debug] [MainThread]: Wrote artifact RunExecutionResult to ./target/run_results.json
[0m19:24:10.029114 [info ] [MainThread]: 
[0m19:24:10.029454 [info ] [MainThread]: [32mCompleted successfully[0m
[0m19:24:10.029759 [info ] [MainThread]: 
[0m19:24:10.030044 [info ] [MainThread]: Done. PASS=40 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=40
[0m19:24:10.032743 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 2.1868548, "process_in_blocks": "0", "process_kernel_time": 0.329963, "process_mem_max_rss": "142114816", "process_out_blocks": "0", "process_user_time": 3.214798}
[0m19:24:10.033152 [debug] [MainThread]: Command `dbt build` succeeded at 19:24:10.033057 after 2.19 seconds
[0m19:24:10.033505 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a9c2160>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10cb88520>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c1abe20>]}
[0m19:24:10.033841 [debug] [MainThread]: Flushing usage events
[0m19:24:12.111291 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m19:24:13.732012 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c3d51c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d482850>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d482670>]}


============================== 19:24:13.735996 | 8cf7dc50-2df4-42b7-924b-85984f2cad9f ==============================
[0m19:24:13.735996 [info ] [MainThread]: Running with dbt=1.11.0-b3
[0m19:24:13.736504 [debug] [MainThread]: running dbt with arguments {'indirect_selection': 'eager', 'version_check': 'True', 'partial_parse': 'True', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'no_print': 'None', 'log_cache_events': 'False', 'write_json': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'target_path': 'None', 'invocation_command': 'dbt build --select tag:pipeline_c --profiles-dir . --project-dir .', 'empty': 'False', 'use_colors': 'True', 'quiet': 'False', 'printer_width': '80', 'log_format': 'default', 'log_path': 'logs', 'debug': 'False', 'use_experimental_parser': 'False', 'fail_fast': 'False', 'profiles_dir': '.', 'send_anonymous_usage_stats': 'True', 'introspect': 'True'}
[0m19:24:13.934174 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '8cf7dc50-2df4-42b7-924b-85984f2cad9f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c516490>]}
[0m19:24:14.008821 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '8cf7dc50-2df4-42b7-924b-85984f2cad9f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c678280>]}
[0m19:24:14.009787 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m19:24:14.112489 [debug] [MainThread]: checksum: e63134dccc1251cfb572caf0e4aa952f030c125ee3634f3bf2c0a2e1bb6ae349, vars: {}, profile: , target: , version: 1.11.0b3
[0m19:24:14.343224 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m19:24:14.343750 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m19:24:14.407500 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '8cf7dc50-2df4-42b7-924b-85984f2cad9f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e5e0130>]}
[0m19:24:14.534342 [debug] [MainThread]: Wrote artifact WritableManifest to ./target/manifest.json
[0m19:24:14.536189 [debug] [MainThread]: Wrote artifact SemanticManifest to ./target/semantic_manifest.json
[0m19:24:14.564637 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '8cf7dc50-2df4-42b7-924b-85984f2cad9f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e6fa9d0>]}
[0m19:24:14.565133 [info ] [MainThread]: Found 28 models, 53 data tests, 10 seeds, 569 macros
[0m19:24:14.568947 [info ] [MainThread]: 
[0m19:24:14.569255 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m19:24:14.569509 [info ] [MainThread]: 
[0m19:24:14.569914 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m19:24:14.574728 [debug] [ThreadPool]: Acquiring new postgres connection 'list_bain_analytics'
[0m19:24:14.623749 [debug] [ThreadPool]: Using postgres connection "list_bain_analytics"
[0m19:24:14.624347 [debug] [ThreadPool]: On list_bain_analytics: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "connection_name": "list_bain_analytics"} */

    select distinct nspname from pg_namespace
  
[0m19:24:14.624655 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m19:24:14.656474 [debug] [ThreadPool]: SQL status: SELECT 5 in 0.032 seconds
[0m19:24:14.657778 [debug] [ThreadPool]: On list_bain_analytics: Close
[0m19:24:14.661087 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_bain_analytics, now list_bain_analytics_public)
[0m19:24:14.666759 [debug] [ThreadPool]: Using postgres connection "list_bain_analytics_public"
[0m19:24:14.667198 [debug] [ThreadPool]: Acquiring new postgres connection 'list_bain_analytics_public_raw'
[0m19:24:14.667468 [debug] [ThreadPool]: On list_bain_analytics_public: BEGIN
[0m19:24:14.669889 [debug] [ThreadPool]: Using postgres connection "list_bain_analytics_public_raw"
[0m19:24:14.670172 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:24:14.670430 [debug] [ThreadPool]: On list_bain_analytics_public_raw: BEGIN
[0m19:24:14.670790 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m19:24:14.681455 [debug] [ThreadPool]: SQL status: BEGIN in 0.011 seconds
[0m19:24:14.681763 [debug] [ThreadPool]: Using postgres connection "list_bain_analytics_public"
[0m19:24:14.682058 [debug] [ThreadPool]: On list_bain_analytics_public: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "connection_name": "list_bain_analytics_public"} */
select
      'bain_analytics' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'bain_analytics' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'bain_analytics' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m19:24:14.683095 [debug] [ThreadPool]: SQL status: BEGIN in 0.012 seconds
[0m19:24:14.683355 [debug] [ThreadPool]: Using postgres connection "list_bain_analytics_public_raw"
[0m19:24:14.683622 [debug] [ThreadPool]: On list_bain_analytics_public_raw: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "connection_name": "list_bain_analytics_public_raw"} */
select
      'bain_analytics' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_raw'
    union all
    select
      'bain_analytics' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_raw'
    union all
    select
      'bain_analytics' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_raw'
  
[0m19:24:14.687464 [debug] [ThreadPool]: SQL status: SELECT 15 in 0.005 seconds
[0m19:24:14.688682 [debug] [ThreadPool]: On list_bain_analytics_public: ROLLBACK
[0m19:24:14.688964 [debug] [ThreadPool]: SQL status: SELECT 10 in 0.005 seconds
[0m19:24:14.689990 [debug] [ThreadPool]: On list_bain_analytics_public_raw: ROLLBACK
[0m19:24:14.690258 [debug] [ThreadPool]: On list_bain_analytics_public: Close
[0m19:24:14.692301 [debug] [ThreadPool]: On list_bain_analytics_public_raw: Close
[0m19:24:14.699624 [debug] [MainThread]: Using postgres connection "master"
[0m19:24:14.699955 [debug] [MainThread]: On master: BEGIN
[0m19:24:14.700202 [debug] [MainThread]: Opening a new connection, currently in state init
[0m19:24:14.710862 [debug] [MainThread]: SQL status: BEGIN in 0.011 seconds
[0m19:24:14.711272 [debug] [MainThread]: Using postgres connection "master"
[0m19:24:14.711614 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "connection_name": "master"} */
select distinct
        dependent_namespace.nspname as dependent_schema,
        dependent_class.relname as dependent_name,
        referenced_namespace.nspname as referenced_schema,
        referenced_class.relname as referenced_name

    -- Query for views: views are entries in pg_class with an entry in pg_rewrite, but we avoid
    -- a seq scan on pg_rewrite by leveraging the fact there is an "internal" row in pg_depend for
    -- the view...
    from pg_class as dependent_class
    join pg_namespace as dependent_namespace on dependent_namespace.oid = dependent_class.relnamespace
    join pg_depend as dependent_depend on dependent_depend.refobjid = dependent_class.oid
        and dependent_depend.classid = 'pg_rewrite'::regclass
        and dependent_depend.refclassid = 'pg_class'::regclass
        and dependent_depend.deptype = 'i'

    -- ... and via pg_depend (that has a row per column, hence the need for "distinct" above, and
    -- making sure to exclude the internal row to avoid a view appearing to depend on itself)...
    join pg_depend as joining_depend on joining_depend.objid = dependent_depend.objid
        and joining_depend.classid = 'pg_rewrite'::regclass
        and joining_depend.refclassid = 'pg_class'::regclass
        and joining_depend.refobjid != dependent_depend.refobjid

    -- ... we can find the tables they query from in pg_class, but excluding system tables. Note we
    -- don't need need to exclude _dependent_ system tables, because they only query from other
    -- system tables, and so are automatically excluded by excluding _referenced_ system tables
    join pg_class as referenced_class on referenced_class.oid = joining_depend.refobjid
    join pg_namespace as referenced_namespace on referenced_namespace.oid = referenced_class.relnamespace
        and referenced_namespace.nspname != 'information_schema'
        and referenced_namespace.nspname not like 'pg\_%'

    order by
        dependent_schema, dependent_name, referenced_schema, referenced_name;
[0m19:24:14.716155 [debug] [MainThread]: SQL status: SELECT 30 in 0.004 seconds
[0m19:24:14.721678 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '8cf7dc50-2df4-42b7-924b-85984f2cad9f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10eb7bd60>]}
[0m19:24:14.722175 [debug] [MainThread]: On master: ROLLBACK
[0m19:24:14.722895 [debug] [MainThread]: Using postgres connection "master"
[0m19:24:14.723186 [debug] [MainThread]: On master: BEGIN
[0m19:24:14.724188 [debug] [MainThread]: SQL status: BEGIN in 0.001 seconds
[0m19:24:14.724525 [debug] [MainThread]: On master: COMMIT
[0m19:24:14.724807 [debug] [MainThread]: Using postgres connection "master"
[0m19:24:14.725063 [debug] [MainThread]: On master: COMMIT
[0m19:24:14.725648 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m19:24:14.726024 [debug] [MainThread]: On master: Close
[0m19:24:14.728687 [debug] [Thread-1  ]: Began running node model.bain_capital_analytics.stg_benchmarks
[0m19:24:14.729073 [debug] [Thread-2  ]: Began running node model.bain_capital_analytics.stg_cashflows
[0m19:24:14.729537 [info ] [Thread-1  ]: 1 of 54 START sql view model public.stg_benchmarks ............................. [RUN]
[0m19:24:14.729907 [debug] [Thread-3  ]: Began running node model.bain_capital_analytics.stg_dates
[0m19:24:14.730276 [info ] [Thread-2  ]: 2 of 54 START sql view model public.stg_cashflows .............................. [RUN]
[0m19:24:14.730646 [debug] [Thread-4  ]: Began running node model.bain_capital_analytics.stg_fund_structures
[0m19:24:14.731026 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_bain_analytics_public, now model.bain_capital_analytics.stg_benchmarks)
[0m19:24:14.731465 [info ] [Thread-3  ]: 3 of 54 START sql view model public.stg_dates .................................. [RUN]
[0m19:24:14.731896 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly list_bain_analytics_public_raw, now model.bain_capital_analytics.stg_cashflows)
[0m19:24:14.732611 [info ] [Thread-4  ]: 4 of 54 START sql view model public.stg_fund_structures ........................ [RUN]
[0m19:24:14.733100 [debug] [Thread-1  ]: Began compiling node model.bain_capital_analytics.stg_benchmarks
[0m19:24:14.733684 [debug] [Thread-3  ]: Acquiring new postgres connection 'model.bain_capital_analytics.stg_dates'
[0m19:24:14.734009 [debug] [Thread-2  ]: Began compiling node model.bain_capital_analytics.stg_cashflows
[0m19:24:14.734644 [debug] [Thread-4  ]: Acquiring new postgres connection 'model.bain_capital_analytics.stg_fund_structures'
[0m19:24:14.743454 [debug] [Thread-1  ]: Writing injected SQL for node "model.bain_capital_analytics.stg_benchmarks"
[0m19:24:14.743783 [debug] [Thread-3  ]: Began compiling node model.bain_capital_analytics.stg_dates
[0m19:24:14.746416 [debug] [Thread-2  ]: Writing injected SQL for node "model.bain_capital_analytics.stg_cashflows"
[0m19:24:14.746740 [debug] [Thread-4  ]: Began compiling node model.bain_capital_analytics.stg_fund_structures
[0m19:24:14.750467 [debug] [Thread-3  ]: Writing injected SQL for node "model.bain_capital_analytics.stg_dates"
[0m19:24:14.753122 [debug] [Thread-4  ]: Writing injected SQL for node "model.bain_capital_analytics.stg_fund_structures"
[0m19:24:14.753476 [debug] [Thread-1  ]: Began executing node model.bain_capital_analytics.stg_benchmarks
[0m19:24:14.753943 [debug] [Thread-2  ]: Began executing node model.bain_capital_analytics.stg_cashflows
[0m19:24:14.772781 [debug] [Thread-3  ]: Began executing node model.bain_capital_analytics.stg_dates
[0m19:24:14.789598 [debug] [Thread-1  ]: Writing runtime sql for node "model.bain_capital_analytics.stg_benchmarks"
[0m19:24:14.791105 [debug] [Thread-2  ]: Writing runtime sql for node "model.bain_capital_analytics.stg_cashflows"
[0m19:24:14.794568 [debug] [Thread-3  ]: Writing runtime sql for node "model.bain_capital_analytics.stg_dates"
[0m19:24:14.795039 [debug] [Thread-4  ]: Began executing node model.bain_capital_analytics.stg_fund_structures
[0m19:24:14.799416 [debug] [Thread-4  ]: Writing runtime sql for node "model.bain_capital_analytics.stg_fund_structures"
[0m19:24:14.799986 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.stg_dates"
[0m19:24:14.800351 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.stg_cashflows"
[0m19:24:14.800771 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.stg_benchmarks"
[0m19:24:14.801134 [debug] [Thread-3  ]: On model.bain_capital_analytics.stg_dates: BEGIN
[0m19:24:14.801463 [debug] [Thread-2  ]: On model.bain_capital_analytics.stg_cashflows: BEGIN
[0m19:24:14.801834 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.stg_fund_structures"
[0m19:24:14.802146 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_benchmarks: BEGIN
[0m19:24:14.802459 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m19:24:14.802770 [debug] [Thread-2  ]: Opening a new connection, currently in state closed
[0m19:24:14.803083 [debug] [Thread-4  ]: On model.bain_capital_analytics.stg_fund_structures: BEGIN
[0m19:24:14.803395 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m19:24:14.803913 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m19:24:14.816789 [debug] [Thread-2  ]: SQL status: BEGIN in 0.014 seconds
[0m19:24:14.817220 [debug] [Thread-4  ]: SQL status: BEGIN in 0.013 seconds
[0m19:24:14.817565 [debug] [Thread-1  ]: SQL status: BEGIN in 0.014 seconds
[0m19:24:14.817867 [debug] [Thread-3  ]: SQL status: BEGIN in 0.015 seconds
[0m19:24:14.818144 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.stg_cashflows"
[0m19:24:14.818445 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.stg_fund_structures"
[0m19:24:14.818763 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.stg_benchmarks"
[0m19:24:14.819086 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.stg_dates"
[0m19:24:14.819434 [debug] [Thread-2  ]: On model.bain_capital_analytics.stg_cashflows: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_cashflows"} */

  create view "bain_analytics"."public"."stg_cashflows__dbt_tmp"
    
    
  as (
    -- Anti-pattern: unnecessary DISTINCT
-- Anti-pattern: duplicated fiscal quarter logic
select distinct
    cashflow_id,
    fund_id,
    portfolio_id,
    cast(cashflow_date as date) as cashflow_date,
    cashflow_type,
    cast(amount as numeric(18,2)) as amount,
    currency,
    description,
    investor_id,
    -- Anti-pattern: duplicated fiscal quarter logic (same as stg_trades, stg_portfolios)
    case
        when extract(month from cast(cashflow_date as date)) between 1 and 3 then 'Q3'
        when extract(month from cast(cashflow_date as date)) between 4 and 6 then 'Q4'
        when extract(month from cast(cashflow_date as date)) between 7 and 9 then 'Q1'
        when extract(month from cast(cashflow_date as date)) between 10 and 12 then 'Q2'
    end as cashflow_fiscal_quarter,
    -- Anti-pattern: PostgreSQL-specific extract
    extract(year from cast(cashflow_date as date)) as cashflow_year
from "bain_analytics"."public_raw"."raw_cashflows"
  );
[0m19:24:14.819807 [debug] [Thread-4  ]: On model.bain_capital_analytics.stg_fund_structures: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_fund_structures"} */

  create view "bain_analytics"."public"."stg_fund_structures__dbt_tmp"
    
    
  as (
    select distinct
    fund_id,
    fund_name,
    fund_type,
    cast(vintage_year as integer) as vintage_year,
    cast(committed_capital as numeric(18,2)) as committed_capital,
    cast(management_fee_rate as numeric(8,4)) as management_fee_rate,
    cast(carry_rate as numeric(8,4)) as carry_rate,
    cast(hurdle_rate as numeric(8,4)) as hurdle_rate,
    cast(gp_commitment_pct as numeric(8,4)) as gp_commitment_pct,
    fund_currency,
    fund_status
from "bain_analytics"."public_raw"."raw_fund_structures"
  );
[0m19:24:14.820169 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_benchmarks: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_benchmarks"} */

  create view "bain_analytics"."public"."stg_benchmarks__dbt_tmp"
    
    
  as (
    select distinct
    benchmark_id,
    benchmark_name,
    cast(benchmark_date as date) as benchmark_date,
    cast(return_daily as numeric(18,8)) as return_daily,
    cast(return_mtd as numeric(18,8)) as return_mtd,
    cast(return_ytd as numeric(18,8)) as return_ytd,
    cast(benchmark_level as numeric(18,4)) as benchmark_level,
    -- Anti-pattern: duplicated fiscal quarter logic
    case
        when extract(month from cast(benchmark_date as date)) between 1 and 3 then 'Q3'
        when extract(month from cast(benchmark_date as date)) between 4 and 6 then 'Q4'
        when extract(month from cast(benchmark_date as date)) between 7 and 9 then 'Q1'
        when extract(month from cast(benchmark_date as date)) between 10 and 12 then 'Q2'
    end as benchmark_fiscal_quarter
from "bain_analytics"."public_raw"."raw_benchmarks"
  );
[0m19:24:14.820519 [debug] [Thread-3  ]: On model.bain_capital_analytics.stg_dates: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_dates"} */

  create view "bain_analytics"."public"."stg_dates__dbt_tmp"
    
    
  as (
    select
    cast(date_day as date) as date_day,
    cast(is_business_day as boolean) as is_business_day,
    cast(is_month_end as boolean) as is_month_end,
    cast(is_quarter_end as boolean) as is_quarter_end,
    cast(is_year_end as boolean) as is_year_end,
    fiscal_quarter,
    fiscal_year,
    -- Anti-pattern: PostgreSQL-specific date_trunc
    date_trunc('month', cast(date_day as date)) as month_start,
    date_trunc('quarter', cast(date_day as date)) as quarter_start,
    extract(month from cast(date_day as date)) as calendar_month,
    extract(year from cast(date_day as date)) as calendar_year
from "bain_analytics"."public_raw"."raw_dates"
  );
[0m19:24:14.822864 [debug] [Thread-3  ]: SQL status: CREATE VIEW in 0.002 seconds
[0m19:24:14.829698 [debug] [Thread-2  ]: SQL status: CREATE VIEW in 0.009 seconds
[0m19:24:14.830052 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.009 seconds
[0m19:24:14.829466 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.stg_dates"
[0m19:24:14.830460 [debug] [Thread-4  ]: SQL status: CREATE VIEW in 0.010 seconds
[0m19:24:14.833584 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.stg_cashflows"
[0m19:24:14.836476 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.stg_benchmarks"
[0m19:24:14.836803 [debug] [Thread-3  ]: On model.bain_capital_analytics.stg_dates: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_dates"} */
alter table "bain_analytics"."public"."stg_dates" rename to "stg_dates__dbt_backup"
[0m19:24:14.839641 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.stg_fund_structures"
[0m19:24:14.839954 [debug] [Thread-2  ]: On model.bain_capital_analytics.stg_cashflows: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_cashflows"} */
alter table "bain_analytics"."public"."stg_cashflows" rename to "stg_cashflows__dbt_backup"
[0m19:24:14.840267 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_benchmarks: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_benchmarks"} */
alter table "bain_analytics"."public"."stg_benchmarks" rename to "stg_benchmarks__dbt_backup"
[0m19:24:14.840621 [debug] [Thread-4  ]: On model.bain_capital_analytics.stg_fund_structures: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_fund_structures"} */
alter table "bain_analytics"."public"."stg_fund_structures" rename to "stg_fund_structures__dbt_backup"
[0m19:24:14.841379 [debug] [Thread-3  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m19:24:14.841712 [debug] [Thread-2  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m19:24:14.844925 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.stg_dates"
[0m19:24:14.845217 [debug] [Thread-4  ]: SQL status: ALTER TABLE in 0.004 seconds
[0m19:24:14.845526 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.004 seconds
[0m19:24:14.848230 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.stg_cashflows"
[0m19:24:14.848562 [debug] [Thread-3  ]: On model.bain_capital_analytics.stg_dates: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_dates"} */
alter table "bain_analytics"."public"."stg_dates__dbt_tmp" rename to "stg_dates"
[0m19:24:14.851162 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.stg_fund_structures"
[0m19:24:14.853685 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.stg_benchmarks"
[0m19:24:14.854006 [debug] [Thread-2  ]: On model.bain_capital_analytics.stg_cashflows: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_cashflows"} */
alter table "bain_analytics"."public"."stg_cashflows__dbt_tmp" rename to "stg_cashflows"
[0m19:24:14.854358 [debug] [Thread-4  ]: On model.bain_capital_analytics.stg_fund_structures: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_fund_structures"} */
alter table "bain_analytics"."public"."stg_fund_structures__dbt_tmp" rename to "stg_fund_structures"
[0m19:24:14.854677 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_benchmarks: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_benchmarks"} */
alter table "bain_analytics"."public"."stg_benchmarks__dbt_tmp" rename to "stg_benchmarks"
[0m19:24:14.854984 [debug] [Thread-3  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m19:24:14.862293 [debug] [Thread-2  ]: SQL status: ALTER TABLE in 0.007 seconds
[0m19:24:14.862669 [debug] [Thread-4  ]: SQL status: ALTER TABLE in 0.007 seconds
[0m19:24:14.870218 [debug] [Thread-3  ]: On model.bain_capital_analytics.stg_dates: COMMIT
[0m19:24:14.870526 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.015 seconds
[0m19:24:14.871499 [debug] [Thread-2  ]: On model.bain_capital_analytics.stg_cashflows: COMMIT
[0m19:24:14.872471 [debug] [Thread-4  ]: On model.bain_capital_analytics.stg_fund_structures: COMMIT
[0m19:24:14.872787 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.stg_dates"
[0m19:24:14.873733 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_benchmarks: COMMIT
[0m19:24:14.874121 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.stg_cashflows"
[0m19:24:14.874435 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.stg_fund_structures"
[0m19:24:14.874724 [debug] [Thread-3  ]: On model.bain_capital_analytics.stg_dates: COMMIT
[0m19:24:14.875017 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.stg_benchmarks"
[0m19:24:14.875299 [debug] [Thread-2  ]: On model.bain_capital_analytics.stg_cashflows: COMMIT
[0m19:24:14.875595 [debug] [Thread-4  ]: On model.bain_capital_analytics.stg_fund_structures: COMMIT
[0m19:24:14.875928 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_benchmarks: COMMIT
[0m19:24:14.878237 [debug] [Thread-3  ]: SQL status: COMMIT in 0.002 seconds
[0m19:24:14.878551 [debug] [Thread-4  ]: SQL status: COMMIT in 0.002 seconds
[0m19:24:14.878862 [debug] [Thread-1  ]: SQL status: COMMIT in 0.003 seconds
[0m19:24:14.884402 [debug] [Thread-3  ]: Applying DROP to: "bain_analytics"."public"."stg_dates__dbt_backup"
[0m19:24:14.884704 [debug] [Thread-2  ]: SQL status: COMMIT in 0.008 seconds
[0m19:24:14.887663 [debug] [Thread-4  ]: Applying DROP to: "bain_analytics"."public"."stg_fund_structures__dbt_backup"
[0m19:24:14.928285 [debug] [Thread-1  ]: Applying DROP to: "bain_analytics"."public"."stg_benchmarks__dbt_backup"
[0m19:24:14.932163 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.stg_dates"
[0m19:24:14.934506 [debug] [Thread-2  ]: Applying DROP to: "bain_analytics"."public"."stg_cashflows__dbt_backup"
[0m19:24:14.935010 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.stg_fund_structures"
[0m19:24:14.935470 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.stg_benchmarks"
[0m19:24:14.935782 [debug] [Thread-3  ]: On model.bain_capital_analytics.stg_dates: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_dates"} */
drop view if exists "bain_analytics"."public"."stg_dates__dbt_backup" cascade
[0m19:24:14.936240 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.stg_cashflows"
[0m19:24:14.936549 [debug] [Thread-4  ]: On model.bain_capital_analytics.stg_fund_structures: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_fund_structures"} */
drop view if exists "bain_analytics"."public"."stg_fund_structures__dbt_backup" cascade
[0m19:24:14.936848 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_benchmarks: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_benchmarks"} */
drop view if exists "bain_analytics"."public"."stg_benchmarks__dbt_backup" cascade
[0m19:24:14.937275 [debug] [Thread-2  ]: On model.bain_capital_analytics.stg_cashflows: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_cashflows"} */
drop view if exists "bain_analytics"."public"."stg_cashflows__dbt_backup" cascade
[0m19:24:14.941882 [debug] [Thread-2  ]: SQL status: DROP VIEW in 0.004 seconds
[0m19:24:14.942228 [debug] [Thread-4  ]: SQL status: DROP VIEW in 0.005 seconds
[0m19:24:14.944559 [debug] [Thread-2  ]: On model.bain_capital_analytics.stg_cashflows: Close
[0m19:24:14.944932 [debug] [Thread-3  ]: SQL status: DROP VIEW in 0.008 seconds
[0m19:24:14.945973 [debug] [Thread-4  ]: On model.bain_capital_analytics.stg_fund_structures: Close
[0m19:24:14.946296 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.009 seconds
[0m19:24:14.947265 [debug] [Thread-3  ]: On model.bain_capital_analytics.stg_dates: Close
[0m19:24:14.949615 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_benchmarks: Close
[0m19:24:14.950400 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8cf7dc50-2df4-42b7-924b-85984f2cad9f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10be62940>]}
[0m19:24:14.950702 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8cf7dc50-2df4-42b7-924b-85984f2cad9f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ec93910>]}
[0m19:24:14.950961 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8cf7dc50-2df4-42b7-924b-85984f2cad9f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ed53b80>]}
[0m19:24:14.951293 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8cf7dc50-2df4-42b7-924b-85984f2cad9f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ecd1760>]}
[0m19:24:14.951750 [info ] [Thread-2  ]: 2 of 54 OK created sql view model public.stg_cashflows ......................... [[32mCREATE VIEW[0m in 0.22s]
[0m19:24:14.952256 [info ] [Thread-4  ]: 4 of 54 OK created sql view model public.stg_fund_structures ................... [[32mCREATE VIEW[0m in 0.21s]
[0m19:24:14.952733 [info ] [Thread-3  ]: 3 of 54 OK created sql view model public.stg_dates ............................. [[32mCREATE VIEW[0m in 0.22s]
[0m19:24:14.953203 [info ] [Thread-1  ]: 1 of 54 OK created sql view model public.stg_benchmarks ........................ [[32mCREATE VIEW[0m in 0.22s]
[0m19:24:14.953664 [debug] [Thread-2  ]: Finished running node model.bain_capital_analytics.stg_cashflows
[0m19:24:14.954071 [debug] [Thread-4  ]: Finished running node model.bain_capital_analytics.stg_fund_structures
[0m19:24:14.954470 [debug] [Thread-3  ]: Finished running node model.bain_capital_analytics.stg_dates
[0m19:24:14.954865 [debug] [Thread-1  ]: Finished running node model.bain_capital_analytics.stg_benchmarks
[0m19:24:14.955199 [debug] [Thread-2  ]: Began running node model.bain_capital_analytics.stg_instruments
[0m19:24:14.955612 [debug] [Thread-4  ]: Began running node model.bain_capital_analytics.stg_portfolios
[0m19:24:14.956115 [debug] [Thread-3  ]: Began running node model.bain_capital_analytics.stg_positions
[0m19:24:14.956533 [debug] [Thread-1  ]: Began running node model.bain_capital_analytics.stg_valuations
[0m19:24:14.957048 [info ] [Thread-2  ]: 5 of 54 START sql view model public.stg_instruments ............................ [RUN]
[0m19:24:14.957602 [info ] [Thread-4  ]: 6 of 54 START sql view model public.stg_portfolios ............................. [RUN]
[0m19:24:14.958053 [info ] [Thread-3  ]: 7 of 54 START sql view model public.stg_positions .............................. [RUN]
[0m19:24:14.958467 [info ] [Thread-1  ]: 8 of 54 START sql view model public.stg_valuations ............................. [RUN]
[0m19:24:14.958855 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly model.bain_capital_analytics.stg_cashflows, now model.bain_capital_analytics.stg_instruments)
[0m19:24:14.959196 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly model.bain_capital_analytics.stg_fund_structures, now model.bain_capital_analytics.stg_portfolios)
[0m19:24:14.959524 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly model.bain_capital_analytics.stg_dates, now model.bain_capital_analytics.stg_positions)
[0m19:24:14.959848 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.bain_capital_analytics.stg_benchmarks, now model.bain_capital_analytics.stg_valuations)
[0m19:24:14.960157 [debug] [Thread-2  ]: Began compiling node model.bain_capital_analytics.stg_instruments
[0m19:24:14.960455 [debug] [Thread-4  ]: Began compiling node model.bain_capital_analytics.stg_portfolios
[0m19:24:14.960750 [debug] [Thread-3  ]: Began compiling node model.bain_capital_analytics.stg_positions
[0m19:24:14.961036 [debug] [Thread-1  ]: Began compiling node model.bain_capital_analytics.stg_valuations
[0m19:24:14.964081 [debug] [Thread-2  ]: Writing injected SQL for node "model.bain_capital_analytics.stg_instruments"
[0m19:24:14.966742 [debug] [Thread-4  ]: Writing injected SQL for node "model.bain_capital_analytics.stg_portfolios"
[0m19:24:14.969281 [debug] [Thread-3  ]: Writing injected SQL for node "model.bain_capital_analytics.stg_positions"
[0m19:24:14.973137 [debug] [Thread-1  ]: Writing injected SQL for node "model.bain_capital_analytics.stg_valuations"
[0m19:24:14.973968 [debug] [Thread-2  ]: Began executing node model.bain_capital_analytics.stg_instruments
[0m19:24:14.977427 [debug] [Thread-2  ]: Writing runtime sql for node "model.bain_capital_analytics.stg_instruments"
[0m19:24:14.977811 [debug] [Thread-4  ]: Began executing node model.bain_capital_analytics.stg_portfolios
[0m19:24:14.981050 [debug] [Thread-4  ]: Writing runtime sql for node "model.bain_capital_analytics.stg_portfolios"
[0m19:24:14.981413 [debug] [Thread-3  ]: Began executing node model.bain_capital_analytics.stg_positions
[0m19:24:14.981747 [debug] [Thread-1  ]: Began executing node model.bain_capital_analytics.stg_valuations
[0m19:24:14.984961 [debug] [Thread-3  ]: Writing runtime sql for node "model.bain_capital_analytics.stg_positions"
[0m19:24:14.988082 [debug] [Thread-1  ]: Writing runtime sql for node "model.bain_capital_analytics.stg_valuations"
[0m19:24:14.988477 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.stg_instruments"
[0m19:24:14.988902 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.stg_portfolios"
[0m19:24:14.989294 [debug] [Thread-2  ]: On model.bain_capital_analytics.stg_instruments: BEGIN
[0m19:24:14.989639 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.stg_positions"
[0m19:24:14.989921 [debug] [Thread-4  ]: On model.bain_capital_analytics.stg_portfolios: BEGIN
[0m19:24:14.990235 [debug] [Thread-2  ]: Opening a new connection, currently in state closed
[0m19:24:14.990567 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.stg_valuations"
[0m19:24:14.990908 [debug] [Thread-3  ]: On model.bain_capital_analytics.stg_positions: BEGIN
[0m19:24:14.991221 [debug] [Thread-4  ]: Opening a new connection, currently in state closed
[0m19:24:14.991634 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_valuations: BEGIN
[0m19:24:14.991924 [debug] [Thread-3  ]: Opening a new connection, currently in state closed
[0m19:24:14.992293 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m19:24:15.007898 [debug] [Thread-2  ]: SQL status: BEGIN in 0.018 seconds
[0m19:24:15.008237 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.stg_instruments"
[0m19:24:15.008595 [debug] [Thread-2  ]: On model.bain_capital_analytics.stg_instruments: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_instruments"} */

  create view "bain_analytics"."public"."stg_instruments__dbt_tmp"
    
    
  as (
    -- Anti-pattern: unnecessary DISTINCT
select distinct
    instrument_id,
    instrument_name,
    instrument_type,
    sector,
    currency,
    exchange,
    issuer,
    cast(maturity_date as date) as maturity_date,
    -- Anti-pattern: PostgreSQL-specific date subtraction
    case
        when maturity_date is not null
        then cast(maturity_date as date) - current_date
        else null
    end as days_to_maturity,
    case
        when instrument_type in ('equity', 'futures') then 'liquid'
        when instrument_type in ('corporate_bond', 'government_bond', 'sovereign_bond', 'leveraged_loan') then 'semi_liquid'
        when instrument_type in ('private_equity', 'venture_capital', 'real_estate', 'real_estate_debt', 'infrastructure') then 'illiquid'
        else 'other'
    end as liquidity_class
from "bain_analytics"."public_raw"."raw_instruments"
  );
[0m19:24:15.008974 [debug] [Thread-3  ]: SQL status: BEGIN in 0.017 seconds
[0m19:24:15.009254 [debug] [Thread-4  ]: SQL status: BEGIN in 0.018 seconds
[0m19:24:15.009522 [debug] [Thread-1  ]: SQL status: BEGIN in 0.017 seconds
[0m19:24:15.009838 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.stg_positions"
[0m19:24:15.010148 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.stg_portfolios"
[0m19:24:15.010437 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.stg_valuations"
[0m19:24:15.010762 [debug] [Thread-3  ]: On model.bain_capital_analytics.stg_positions: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_positions"} */

  create view "bain_analytics"."public"."stg_positions__dbt_tmp"
    
    
  as (
    -- Anti-pattern: unnecessary DISTINCT
-- Anti-pattern: no filtering or partitioning strategy

select distinct
    position_id,
    portfolio_id,
    instrument_id,
    cast(position_date as date) as position_date,
    cast(quantity as numeric(18,4)) as quantity,
    cast(market_value as numeric(18,2)) as market_value,
    cast(cost_basis as numeric(18,2)) as cost_basis,
    currency,
    -- Anti-pattern: computed column that could be done downstream
    cast(market_value as numeric(18,2)) - cast(cost_basis as numeric(18,2)) as unrealized_gain_loss,
    case
        when cast(cost_basis as numeric(18,2)) != 0
        then (cast(market_value as numeric(18,2)) - cast(cost_basis as numeric(18,2))) / abs(cast(cost_basis as numeric(18,2)))
        else 0
    end as unrealized_return_pct
from "bain_analytics"."public_raw"."raw_positions"
  );
[0m19:24:15.011131 [debug] [Thread-4  ]: On model.bain_capital_analytics.stg_portfolios: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_portfolios"} */

  create view "bain_analytics"."public"."stg_portfolios__dbt_tmp"
    
    
  as (
    -- Anti-pattern: unnecessary DISTINCT when source data is already unique
-- Anti-pattern: casting in every model instead of once upstream

select distinct
    cast(portfolio_id as varchar(10)) as portfolio_id,
    cast(portfolio_name as varchar(100)) as portfolio_name,
    cast(strategy as varchar(50)) as strategy,
    cast(inception_date as date) as inception_date,
    cast(fund_id as varchar(10)) as fund_id,
    cast(manager_name as varchar(100)) as manager_name,
    cast(is_active as boolean) as is_active,
    -- Anti-pattern: duplicated fiscal quarter logic (repeated in many models)
    case
        when extract(month from cast(inception_date as date)) between 1 and 3 then 'Q3'
        when extract(month from cast(inception_date as date)) between 4 and 6 then 'Q4'
        when extract(month from cast(inception_date as date)) between 7 and 9 then 'Q1'
        when extract(month from cast(inception_date as date)) between 10 and 12 then 'Q2'
    end as inception_fiscal_quarter
from "bain_analytics"."public_raw"."raw_portfolios"
where cast(is_active as boolean) = true
  );
[0m19:24:15.011502 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_valuations: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_valuations"} */

  create view "bain_analytics"."public"."stg_valuations__dbt_tmp"
    
    
  as (
    -- Anti-pattern: unnecessary DISTINCT
select distinct
    valuation_id,
    portfolio_id,
    cast(valuation_date as date) as valuation_date,
    cast(gross_asset_value as numeric(18,2)) as gross_asset_value,
    cast(net_asset_value as numeric(18,2)) as net_asset_value,
    cast(total_liabilities as numeric(18,2)) as total_liabilities,
    cast(unrealized_pnl as numeric(18,2)) as unrealized_pnl,
    cast(realized_pnl as numeric(18,2)) as realized_pnl,
    valuation_method,
    -- Anti-pattern: duplicated fiscal quarter logic
    case
        when extract(month from cast(valuation_date as date)) between 1 and 3 then 'Q3'
        when extract(month from cast(valuation_date as date)) between 4 and 6 then 'Q4'
        when extract(month from cast(valuation_date as date)) between 7 and 9 then 'Q1'
        when extract(month from cast(valuation_date as date)) between 10 and 12 then 'Q2'
    end as valuation_fiscal_quarter
from "bain_analytics"."public_raw"."raw_valuations"
  );
[0m19:24:15.014231 [debug] [Thread-2  ]: SQL status: CREATE VIEW in 0.004 seconds
[0m19:24:15.017971 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.stg_instruments"
[0m19:24:15.018287 [debug] [Thread-4  ]: SQL status: CREATE VIEW in 0.006 seconds
[0m19:24:15.018565 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.007 seconds
[0m19:24:15.018829 [debug] [Thread-3  ]: SQL status: CREATE VIEW in 0.007 seconds
[0m19:24:15.019099 [debug] [Thread-2  ]: On model.bain_capital_analytics.stg_instruments: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_instruments"} */
alter table "bain_analytics"."public"."stg_instruments" rename to "stg_instruments__dbt_backup"
[0m19:24:15.022002 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.stg_portfolios"
[0m19:24:15.024851 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.stg_valuations"
[0m19:24:15.027600 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.stg_positions"
[0m19:24:15.027953 [debug] [Thread-4  ]: On model.bain_capital_analytics.stg_portfolios: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_portfolios"} */
alter table "bain_analytics"."public"."stg_portfolios" rename to "stg_portfolios__dbt_backup"
[0m19:24:15.028269 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_valuations: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_valuations"} */
alter table "bain_analytics"."public"."stg_valuations" rename to "stg_valuations__dbt_backup"
[0m19:24:15.028565 [debug] [Thread-3  ]: On model.bain_capital_analytics.stg_positions: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_positions"} */
alter table "bain_analytics"."public"."stg_positions" rename to "stg_positions__dbt_backup"
[0m19:24:15.028888 [debug] [Thread-2  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m19:24:15.031451 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.stg_instruments"
[0m19:24:15.031770 [debug] [Thread-3  ]: SQL status: ALTER TABLE in 0.003 seconds
[0m19:24:15.032059 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.003 seconds
[0m19:24:15.032330 [debug] [Thread-4  ]: SQL status: ALTER TABLE in 0.003 seconds
[0m19:24:15.032617 [debug] [Thread-2  ]: On model.bain_capital_analytics.stg_instruments: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_instruments"} */
alter table "bain_analytics"."public"."stg_instruments__dbt_tmp" rename to "stg_instruments"
[0m19:24:15.035272 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.stg_positions"
[0m19:24:15.038601 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.stg_valuations"
[0m19:24:15.041164 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.stg_portfolios"
[0m19:24:15.041535 [debug] [Thread-3  ]: On model.bain_capital_analytics.stg_positions: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_positions"} */
alter table "bain_analytics"."public"."stg_positions__dbt_tmp" rename to "stg_positions"
[0m19:24:15.041854 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_valuations: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_valuations"} */
alter table "bain_analytics"."public"."stg_valuations__dbt_tmp" rename to "stg_valuations"
[0m19:24:15.042151 [debug] [Thread-4  ]: On model.bain_capital_analytics.stg_portfolios: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_portfolios"} */
alter table "bain_analytics"."public"."stg_portfolios__dbt_tmp" rename to "stg_portfolios"
[0m19:24:15.042541 [debug] [Thread-2  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m19:24:15.043610 [debug] [Thread-2  ]: On model.bain_capital_analytics.stg_instruments: COMMIT
[0m19:24:15.043925 [debug] [Thread-3  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m19:24:15.044204 [debug] [Thread-4  ]: SQL status: ALTER TABLE in 0.002 seconds
[0m19:24:15.044464 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.002 seconds
[0m19:24:15.044734 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.stg_instruments"
[0m19:24:15.045775 [debug] [Thread-3  ]: On model.bain_capital_analytics.stg_positions: COMMIT
[0m19:24:15.046738 [debug] [Thread-4  ]: On model.bain_capital_analytics.stg_portfolios: COMMIT
[0m19:24:15.047703 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_valuations: COMMIT
[0m19:24:15.048011 [debug] [Thread-2  ]: On model.bain_capital_analytics.stg_instruments: COMMIT
[0m19:24:15.048306 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.stg_positions"
[0m19:24:15.048594 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.stg_portfolios"
[0m19:24:15.048894 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.stg_valuations"
[0m19:24:15.049240 [debug] [Thread-3  ]: On model.bain_capital_analytics.stg_positions: COMMIT
[0m19:24:15.049537 [debug] [Thread-4  ]: On model.bain_capital_analytics.stg_portfolios: COMMIT
[0m19:24:15.049818 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_valuations: COMMIT
[0m19:24:15.051308 [debug] [Thread-2  ]: SQL status: COMMIT in 0.002 seconds
[0m19:24:15.053647 [debug] [Thread-2  ]: Applying DROP to: "bain_analytics"."public"."stg_instruments__dbt_backup"
[0m19:24:15.053957 [debug] [Thread-4  ]: SQL status: COMMIT in 0.004 seconds
[0m19:24:15.054403 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.stg_instruments"
[0m19:24:15.054683 [debug] [Thread-1  ]: SQL status: COMMIT in 0.005 seconds
[0m19:24:15.054970 [debug] [Thread-3  ]: SQL status: COMMIT in 0.005 seconds
[0m19:24:15.057166 [debug] [Thread-4  ]: Applying DROP to: "bain_analytics"."public"."stg_portfolios__dbt_backup"
[0m19:24:15.057530 [debug] [Thread-2  ]: On model.bain_capital_analytics.stg_instruments: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_instruments"} */
drop view if exists "bain_analytics"."public"."stg_instruments__dbt_backup" cascade
[0m19:24:15.059774 [debug] [Thread-1  ]: Applying DROP to: "bain_analytics"."public"."stg_valuations__dbt_backup"
[0m19:24:15.062695 [debug] [Thread-3  ]: Applying DROP to: "bain_analytics"."public"."stg_positions__dbt_backup"
[0m19:24:15.063185 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.stg_portfolios"
[0m19:24:15.063689 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.stg_valuations"
[0m19:24:15.064131 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.stg_positions"
[0m19:24:15.064436 [debug] [Thread-4  ]: On model.bain_capital_analytics.stg_portfolios: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_portfolios"} */
drop view if exists "bain_analytics"."public"."stg_portfolios__dbt_backup" cascade
[0m19:24:15.064737 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_valuations: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_valuations"} */
drop view if exists "bain_analytics"."public"."stg_valuations__dbt_backup" cascade
[0m19:24:15.065032 [debug] [Thread-3  ]: On model.bain_capital_analytics.stg_positions: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_positions"} */
drop view if exists "bain_analytics"."public"."stg_positions__dbt_backup" cascade
[0m19:24:15.068926 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.004 seconds
[0m19:24:15.069234 [debug] [Thread-2  ]: SQL status: DROP VIEW in 0.006 seconds
[0m19:24:15.070293 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_valuations: Close
[0m19:24:15.070583 [debug] [Thread-3  ]: SQL status: DROP VIEW in 0.005 seconds
[0m19:24:15.070856 [debug] [Thread-4  ]: SQL status: DROP VIEW in 0.006 seconds
[0m19:24:15.071796 [debug] [Thread-2  ]: On model.bain_capital_analytics.stg_instruments: Close
[0m19:24:15.072779 [debug] [Thread-3  ]: On model.bain_capital_analytics.stg_positions: Close
[0m19:24:15.073237 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8cf7dc50-2df4-42b7-924b-85984f2cad9f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e753f40>]}
[0m19:24:15.074261 [debug] [Thread-4  ]: On model.bain_capital_analytics.stg_portfolios: Close
[0m19:24:15.074722 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8cf7dc50-2df4-42b7-924b-85984f2cad9f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ecf4f40>]}
[0m19:24:15.075135 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8cf7dc50-2df4-42b7-924b-85984f2cad9f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e7edf40>]}
[0m19:24:15.075677 [info ] [Thread-1  ]: 8 of 54 OK created sql view model public.stg_valuations ........................ [[32mCREATE VIEW[0m in 0.11s]
[0m19:24:15.076106 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8cf7dc50-2df4-42b7-924b-85984f2cad9f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10eb88220>]}
[0m19:24:15.076557 [info ] [Thread-2  ]: 5 of 54 OK created sql view model public.stg_instruments ....................... [[32mCREATE VIEW[0m in 0.12s]
[0m19:24:15.077030 [info ] [Thread-3  ]: 7 of 54 OK created sql view model public.stg_positions ......................... [[32mCREATE VIEW[0m in 0.12s]
[0m19:24:15.077482 [debug] [Thread-1  ]: Finished running node model.bain_capital_analytics.stg_valuations
[0m19:24:15.077922 [info ] [Thread-4  ]: 6 of 54 OK created sql view model public.stg_portfolios ........................ [[32mCREATE VIEW[0m in 0.12s]
[0m19:24:15.078365 [debug] [Thread-2  ]: Finished running node model.bain_capital_analytics.stg_instruments
[0m19:24:15.078769 [debug] [Thread-3  ]: Finished running node model.bain_capital_analytics.stg_positions
[0m19:24:15.079103 [debug] [Thread-1  ]: Began running node test.bain_capital_analytics.not_null_stg_cashflows_cashflow_id.4176024898
[0m19:24:15.079614 [debug] [Thread-4  ]: Finished running node model.bain_capital_analytics.stg_portfolios
[0m19:24:15.080080 [debug] [Thread-2  ]: Began running node test.bain_capital_analytics.not_null_stg_cashflows_fund_id.7ff8a45dde
[0m19:24:15.080502 [debug] [Thread-3  ]: Began running node test.bain_capital_analytics.not_null_stg_cashflows_portfolio_id.cbd1d93e57
[0m19:24:15.080927 [info ] [Thread-1  ]: 9 of 54 START test not_null_stg_cashflows_cashflow_id .......................... [RUN]
[0m19:24:15.081410 [debug] [Thread-4  ]: Began running node test.bain_capital_analytics.unique_stg_cashflows_cashflow_id.359e4f4704
[0m19:24:15.081830 [info ] [Thread-2  ]: 10 of 54 START test not_null_stg_cashflows_fund_id ............................. [RUN]
[0m19:24:15.082265 [info ] [Thread-3  ]: 11 of 54 START test not_null_stg_cashflows_portfolio_id ........................ [RUN]
[0m19:24:15.082695 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.bain_capital_analytics.stg_valuations, now test.bain_capital_analytics.not_null_stg_cashflows_cashflow_id.4176024898)
[0m19:24:15.083033 [info ] [Thread-4  ]: 12 of 54 START test unique_stg_cashflows_cashflow_id ........................... [RUN]
[0m19:24:15.083392 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly model.bain_capital_analytics.stg_instruments, now test.bain_capital_analytics.not_null_stg_cashflows_fund_id.7ff8a45dde)
[0m19:24:15.083726 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly model.bain_capital_analytics.stg_positions, now test.bain_capital_analytics.not_null_stg_cashflows_portfolio_id.cbd1d93e57)
[0m19:24:15.084047 [debug] [Thread-1  ]: Began compiling node test.bain_capital_analytics.not_null_stg_cashflows_cashflow_id.4176024898
[0m19:24:15.084355 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly model.bain_capital_analytics.stg_portfolios, now test.bain_capital_analytics.unique_stg_cashflows_cashflow_id.359e4f4704)
[0m19:24:15.084647 [debug] [Thread-2  ]: Began compiling node test.bain_capital_analytics.not_null_stg_cashflows_fund_id.7ff8a45dde
[0m19:24:15.084928 [debug] [Thread-3  ]: Began compiling node test.bain_capital_analytics.not_null_stg_cashflows_portfolio_id.cbd1d93e57
[0m19:24:15.090902 [debug] [Thread-4  ]: Began compiling node test.bain_capital_analytics.unique_stg_cashflows_cashflow_id.359e4f4704
[0m19:24:15.096160 [debug] [Thread-1  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_stg_cashflows_cashflow_id.4176024898"
[0m19:24:15.099588 [debug] [Thread-2  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_stg_cashflows_fund_id.7ff8a45dde"
[0m19:24:15.102885 [debug] [Thread-3  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_stg_cashflows_portfolio_id.cbd1d93e57"
[0m19:24:15.108043 [debug] [Thread-4  ]: Writing injected SQL for node "test.bain_capital_analytics.unique_stg_cashflows_cashflow_id.359e4f4704"
[0m19:24:15.108856 [debug] [Thread-1  ]: Began executing node test.bain_capital_analytics.not_null_stg_cashflows_cashflow_id.4176024898
[0m19:24:15.109182 [debug] [Thread-2  ]: Began executing node test.bain_capital_analytics.not_null_stg_cashflows_fund_id.7ff8a45dde
[0m19:24:15.109477 [debug] [Thread-3  ]: Began executing node test.bain_capital_analytics.not_null_stg_cashflows_portfolio_id.cbd1d93e57
[0m19:24:15.121718 [debug] [Thread-4  ]: Began executing node test.bain_capital_analytics.unique_stg_cashflows_cashflow_id.359e4f4704
[0m19:24:15.125962 [debug] [Thread-1  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_stg_cashflows_cashflow_id.4176024898"
[0m19:24:15.128243 [debug] [Thread-2  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_stg_cashflows_fund_id.7ff8a45dde"
[0m19:24:15.130429 [debug] [Thread-3  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_stg_cashflows_portfolio_id.cbd1d93e57"
[0m19:24:15.132567 [debug] [Thread-4  ]: Writing runtime sql for node "test.bain_capital_analytics.unique_stg_cashflows_cashflow_id.359e4f4704"
[0m19:24:15.133407 [debug] [Thread-1  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_cashflows_cashflow_id.4176024898"
[0m19:24:15.133772 [debug] [Thread-4  ]: Using postgres connection "test.bain_capital_analytics.unique_stg_cashflows_cashflow_id.359e4f4704"
[0m19:24:15.134093 [debug] [Thread-2  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_cashflows_fund_id.7ff8a45dde"
[0m19:24:15.134396 [debug] [Thread-3  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_cashflows_portfolio_id.cbd1d93e57"
[0m19:24:15.134680 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_stg_cashflows_cashflow_id.4176024898: BEGIN
[0m19:24:15.134979 [debug] [Thread-4  ]: On test.bain_capital_analytics.unique_stg_cashflows_cashflow_id.359e4f4704: BEGIN
[0m19:24:15.135267 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_stg_cashflows_fund_id.7ff8a45dde: BEGIN
[0m19:24:15.135624 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_stg_cashflows_portfolio_id.cbd1d93e57: BEGIN
[0m19:24:15.135928 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m19:24:15.136212 [debug] [Thread-4  ]: Opening a new connection, currently in state closed
[0m19:24:15.136496 [debug] [Thread-2  ]: Opening a new connection, currently in state closed
[0m19:24:15.136776 [debug] [Thread-3  ]: Opening a new connection, currently in state closed
[0m19:24:15.154030 [debug] [Thread-3  ]: SQL status: BEGIN in 0.017 seconds
[0m19:24:15.154376 [debug] [Thread-1  ]: SQL status: BEGIN in 0.018 seconds
[0m19:24:15.154691 [debug] [Thread-2  ]: SQL status: BEGIN in 0.018 seconds
[0m19:24:15.154991 [debug] [Thread-3  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_cashflows_portfolio_id.cbd1d93e57"
[0m19:24:15.155269 [debug] [Thread-4  ]: SQL status: BEGIN in 0.019 seconds
[0m19:24:15.155562 [debug] [Thread-1  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_cashflows_cashflow_id.4176024898"
[0m19:24:15.155853 [debug] [Thread-2  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_cashflows_fund_id.7ff8a45dde"
[0m19:24:15.156161 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_stg_cashflows_portfolio_id.cbd1d93e57: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_stg_cashflows_portfolio_id.cbd1d93e57"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select portfolio_id
from "bain_analytics"."public"."stg_cashflows"
where portfolio_id is null



  
  
      
    ) dbt_internal_test
[0m19:24:15.156472 [debug] [Thread-4  ]: Using postgres connection "test.bain_capital_analytics.unique_stg_cashflows_cashflow_id.359e4f4704"
[0m19:24:15.156776 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_stg_cashflows_cashflow_id.4176024898: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_stg_cashflows_cashflow_id.4176024898"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select cashflow_id
from "bain_analytics"."public"."stg_cashflows"
where cashflow_id is null



  
  
      
    ) dbt_internal_test
[0m19:24:15.157096 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_stg_cashflows_fund_id.7ff8a45dde: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_stg_cashflows_fund_id.7ff8a45dde"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select fund_id
from "bain_analytics"."public"."stg_cashflows"
where fund_id is null



  
  
      
    ) dbt_internal_test
[0m19:24:15.157554 [debug] [Thread-4  ]: On test.bain_capital_analytics.unique_stg_cashflows_cashflow_id.359e4f4704: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.unique_stg_cashflows_cashflow_id.359e4f4704"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

select
    cashflow_id as unique_field,
    count(*) as n_records

from "bain_analytics"."public"."stg_cashflows"
where cashflow_id is not null
group by cashflow_id
having count(*) > 1



  
  
      
    ) dbt_internal_test
[0m19:24:15.160500 [debug] [Thread-3  ]: SQL status: SELECT 1 in 0.003 seconds
[0m19:24:15.160809 [debug] [Thread-2  ]: SQL status: SELECT 1 in 0.003 seconds
[0m19:24:15.161084 [debug] [Thread-1  ]: SQL status: SELECT 1 in 0.003 seconds
[0m19:24:15.163920 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_stg_cashflows_portfolio_id.cbd1d93e57: ROLLBACK
[0m19:24:15.164235 [debug] [Thread-4  ]: SQL status: SELECT 1 in 0.006 seconds
[0m19:24:15.165283 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_stg_cashflows_fund_id.7ff8a45dde: ROLLBACK
[0m19:24:15.166295 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_stg_cashflows_cashflow_id.4176024898: ROLLBACK
[0m19:24:15.167450 [debug] [Thread-4  ]: On test.bain_capital_analytics.unique_stg_cashflows_cashflow_id.359e4f4704: ROLLBACK
[0m19:24:15.167775 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_stg_cashflows_portfolio_id.cbd1d93e57: Close
[0m19:24:15.168356 [info ] [Thread-3  ]: 11 of 54 PASS not_null_stg_cashflows_portfolio_id .............................. [[32mPASS[0m in 0.08s]
[0m19:24:15.168698 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_stg_cashflows_fund_id.7ff8a45dde: Close
[0m19:24:15.169122 [debug] [Thread-3  ]: Finished running node test.bain_capital_analytics.not_null_stg_cashflows_portfolio_id.cbd1d93e57
[0m19:24:15.169395 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_stg_cashflows_cashflow_id.4176024898: Close
[0m19:24:15.169681 [debug] [Thread-4  ]: On test.bain_capital_analytics.unique_stg_cashflows_cashflow_id.359e4f4704: Close
[0m19:24:15.170122 [info ] [Thread-2  ]: 10 of 54 PASS not_null_stg_cashflows_fund_id ................................... [[32mPASS[0m in 0.09s]
[0m19:24:15.170472 [debug] [Thread-3  ]: Began running node test.bain_capital_analytics.not_null_stg_fund_structures_fund_id.a284274f31
[0m19:24:15.171014 [info ] [Thread-1  ]: 9 of 54 PASS not_null_stg_cashflows_cashflow_id ................................ [[32mPASS[0m in 0.09s]
[0m19:24:15.171439 [info ] [Thread-4  ]: 12 of 54 PASS unique_stg_cashflows_cashflow_id ................................. [[32mPASS[0m in 0.09s]
[0m19:24:15.171873 [debug] [Thread-2  ]: Finished running node test.bain_capital_analytics.not_null_stg_cashflows_fund_id.7ff8a45dde
[0m19:24:15.172180 [info ] [Thread-3  ]: 13 of 54 START test not_null_stg_fund_structures_fund_id ....................... [RUN]
[0m19:24:15.172597 [debug] [Thread-1  ]: Finished running node test.bain_capital_analytics.not_null_stg_cashflows_cashflow_id.4176024898
[0m19:24:15.172993 [debug] [Thread-4  ]: Finished running node test.bain_capital_analytics.unique_stg_cashflows_cashflow_id.359e4f4704
[0m19:24:15.173313 [debug] [Thread-2  ]: Began running node test.bain_capital_analytics.unique_stg_fund_structures_fund_id.bb9fec42ab
[0m19:24:15.173691 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.not_null_stg_cashflows_portfolio_id.cbd1d93e57, now test.bain_capital_analytics.not_null_stg_fund_structures_fund_id.a284274f31)
[0m19:24:15.174060 [debug] [Thread-1  ]: Began running node test.bain_capital_analytics.not_null_stg_dates_date_day.f3ec4da188
[0m19:24:15.174437 [debug] [Thread-4  ]: Began running node test.bain_capital_analytics.unique_stg_dates_date_day.e062be8e28
[0m19:24:15.174781 [info ] [Thread-2  ]: 14 of 54 START test unique_stg_fund_structures_fund_id ......................... [RUN]
[0m19:24:15.175105 [debug] [Thread-3  ]: Began compiling node test.bain_capital_analytics.not_null_stg_fund_structures_fund_id.a284274f31
[0m19:24:15.175405 [info ] [Thread-1  ]: 15 of 54 START test not_null_stg_dates_date_day ................................ [RUN]
[0m19:24:15.175729 [info ] [Thread-4  ]: 16 of 54 START test unique_stg_dates_date_day .................................. [RUN]
[0m19:24:15.176061 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.not_null_stg_cashflows_fund_id.7ff8a45dde, now test.bain_capital_analytics.unique_stg_fund_structures_fund_id.bb9fec42ab)
[0m19:24:15.179846 [debug] [Thread-3  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_stg_fund_structures_fund_id.a284274f31"
[0m19:24:15.180194 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.not_null_stg_cashflows_cashflow_id.4176024898, now test.bain_capital_analytics.not_null_stg_dates_date_day.f3ec4da188)
[0m19:24:15.180517 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.unique_stg_cashflows_cashflow_id.359e4f4704, now test.bain_capital_analytics.unique_stg_dates_date_day.e062be8e28)
[0m19:24:15.180823 [debug] [Thread-2  ]: Began compiling node test.bain_capital_analytics.unique_stg_fund_structures_fund_id.bb9fec42ab
[0m19:24:15.181186 [debug] [Thread-1  ]: Began compiling node test.bain_capital_analytics.not_null_stg_dates_date_day.f3ec4da188
[0m19:24:15.181509 [debug] [Thread-4  ]: Began compiling node test.bain_capital_analytics.unique_stg_dates_date_day.e062be8e28
[0m19:24:15.184834 [debug] [Thread-2  ]: Writing injected SQL for node "test.bain_capital_analytics.unique_stg_fund_structures_fund_id.bb9fec42ab"
[0m19:24:15.189452 [debug] [Thread-1  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_stg_dates_date_day.f3ec4da188"
[0m19:24:15.189785 [debug] [Thread-3  ]: Began executing node test.bain_capital_analytics.not_null_stg_fund_structures_fund_id.a284274f31
[0m19:24:15.193209 [debug] [Thread-4  ]: Writing injected SQL for node "test.bain_capital_analytics.unique_stg_dates_date_day.e062be8e28"
[0m19:24:15.195804 [debug] [Thread-3  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_stg_fund_structures_fund_id.a284274f31"
[0m19:24:15.196362 [debug] [Thread-1  ]: Began executing node test.bain_capital_analytics.not_null_stg_dates_date_day.f3ec4da188
[0m19:24:15.198554 [debug] [Thread-1  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_stg_dates_date_day.f3ec4da188"
[0m19:24:15.198935 [debug] [Thread-4  ]: Began executing node test.bain_capital_analytics.unique_stg_dates_date_day.e062be8e28
[0m19:24:15.199241 [debug] [Thread-2  ]: Began executing node test.bain_capital_analytics.unique_stg_fund_structures_fund_id.bb9fec42ab
[0m19:24:15.201381 [debug] [Thread-4  ]: Writing runtime sql for node "test.bain_capital_analytics.unique_stg_dates_date_day.e062be8e28"
[0m19:24:15.201724 [debug] [Thread-3  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_fund_structures_fund_id.a284274f31"
[0m19:24:15.203843 [debug] [Thread-2  ]: Writing runtime sql for node "test.bain_capital_analytics.unique_stg_fund_structures_fund_id.bb9fec42ab"
[0m19:24:15.204268 [debug] [Thread-1  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_dates_date_day.f3ec4da188"
[0m19:24:15.204572 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_stg_fund_structures_fund_id.a284274f31: BEGIN
[0m19:24:15.204971 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_stg_dates_date_day.f3ec4da188: BEGIN
[0m19:24:15.205320 [debug] [Thread-4  ]: Using postgres connection "test.bain_capital_analytics.unique_stg_dates_date_day.e062be8e28"
[0m19:24:15.206313 [debug] [Thread-3  ]: Opening a new connection, currently in state closed
[0m19:24:15.206631 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m19:24:15.206977 [debug] [Thread-2  ]: Using postgres connection "test.bain_capital_analytics.unique_stg_fund_structures_fund_id.bb9fec42ab"
[0m19:24:15.207287 [debug] [Thread-4  ]: On test.bain_capital_analytics.unique_stg_dates_date_day.e062be8e28: BEGIN
[0m19:24:15.207816 [debug] [Thread-2  ]: On test.bain_capital_analytics.unique_stg_fund_structures_fund_id.bb9fec42ab: BEGIN
[0m19:24:15.208111 [debug] [Thread-4  ]: Opening a new connection, currently in state closed
[0m19:24:15.208401 [debug] [Thread-2  ]: Opening a new connection, currently in state closed
[0m19:24:15.222310 [debug] [Thread-4  ]: SQL status: BEGIN in 0.014 seconds
[0m19:24:15.222636 [debug] [Thread-3  ]: SQL status: BEGIN in 0.017 seconds
[0m19:24:15.222930 [debug] [Thread-1  ]: SQL status: BEGIN in 0.016 seconds
[0m19:24:15.223219 [debug] [Thread-4  ]: Using postgres connection "test.bain_capital_analytics.unique_stg_dates_date_day.e062be8e28"
[0m19:24:15.223497 [debug] [Thread-2  ]: SQL status: BEGIN in 0.015 seconds
[0m19:24:15.223792 [debug] [Thread-3  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_fund_structures_fund_id.a284274f31"
[0m19:24:15.224149 [debug] [Thread-1  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_dates_date_day.f3ec4da188"
[0m19:24:15.224466 [debug] [Thread-4  ]: On test.bain_capital_analytics.unique_stg_dates_date_day.e062be8e28: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.unique_stg_dates_date_day.e062be8e28"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

select
    date_day as unique_field,
    count(*) as n_records

from "bain_analytics"."public"."stg_dates"
where date_day is not null
group by date_day
having count(*) > 1



  
  
      
    ) dbt_internal_test
[0m19:24:15.224774 [debug] [Thread-2  ]: Using postgres connection "test.bain_capital_analytics.unique_stg_fund_structures_fund_id.bb9fec42ab"
[0m19:24:15.225070 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_stg_fund_structures_fund_id.a284274f31: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_stg_fund_structures_fund_id.a284274f31"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select fund_id
from "bain_analytics"."public"."stg_fund_structures"
where fund_id is null



  
  
      
    ) dbt_internal_test
[0m19:24:15.225387 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_stg_dates_date_day.f3ec4da188: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_stg_dates_date_day.f3ec4da188"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select date_day
from "bain_analytics"."public"."stg_dates"
where date_day is null



  
  
      
    ) dbt_internal_test
[0m19:24:15.225751 [debug] [Thread-2  ]: On test.bain_capital_analytics.unique_stg_fund_structures_fund_id.bb9fec42ab: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.unique_stg_fund_structures_fund_id.bb9fec42ab"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

select
    fund_id as unique_field,
    count(*) as n_records

from "bain_analytics"."public"."stg_fund_structures"
where fund_id is not null
group by fund_id
having count(*) > 1



  
  
      
    ) dbt_internal_test
[0m19:24:15.227598 [debug] [Thread-1  ]: SQL status: SELECT 1 in 0.001 seconds
[0m19:24:15.227901 [debug] [Thread-4  ]: SQL status: SELECT 1 in 0.002 seconds
[0m19:24:15.229115 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_stg_dates_date_day.f3ec4da188: ROLLBACK
[0m19:24:15.229418 [debug] [Thread-3  ]: SQL status: SELECT 1 in 0.003 seconds
[0m19:24:15.229728 [debug] [Thread-2  ]: SQL status: SELECT 1 in 0.004 seconds
[0m19:24:15.230706 [debug] [Thread-4  ]: On test.bain_capital_analytics.unique_stg_dates_date_day.e062be8e28: ROLLBACK
[0m19:24:15.231819 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_stg_fund_structures_fund_id.a284274f31: ROLLBACK
[0m19:24:15.232123 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_stg_dates_date_day.f3ec4da188: Close
[0m19:24:15.233106 [debug] [Thread-2  ]: On test.bain_capital_analytics.unique_stg_fund_structures_fund_id.bb9fec42ab: ROLLBACK
[0m19:24:15.233910 [debug] [Thread-4  ]: On test.bain_capital_analytics.unique_stg_dates_date_day.e062be8e28: Close
[0m19:24:15.233674 [info ] [Thread-1  ]: 15 of 54 PASS not_null_stg_dates_date_day ...................................... [[32mPASS[0m in 0.05s]
[0m19:24:15.234279 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_stg_fund_structures_fund_id.a284274f31: Close
[0m19:24:15.234738 [debug] [Thread-1  ]: Finished running node test.bain_capital_analytics.not_null_stg_dates_date_day.f3ec4da188
[0m19:24:15.235008 [debug] [Thread-2  ]: On test.bain_capital_analytics.unique_stg_fund_structures_fund_id.bb9fec42ab: Close
[0m19:24:15.235401 [info ] [Thread-4  ]: 16 of 54 PASS unique_stg_dates_date_day ........................................ [[32mPASS[0m in 0.05s]
[0m19:24:15.235851 [info ] [Thread-3  ]: 13 of 54 PASS not_null_stg_fund_structures_fund_id ............................. [[32mPASS[0m in 0.06s]
[0m19:24:15.236189 [debug] [Thread-1  ]: Began running node test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_date.d5c8f88f3e
[0m19:24:15.236680 [info ] [Thread-2  ]: 14 of 54 PASS unique_stg_fund_structures_fund_id ............................... [[32mPASS[0m in 0.06s]
[0m19:24:15.237110 [debug] [Thread-4  ]: Finished running node test.bain_capital_analytics.unique_stg_dates_date_day.e062be8e28
[0m19:24:15.237516 [debug] [Thread-3  ]: Finished running node test.bain_capital_analytics.not_null_stg_fund_structures_fund_id.a284274f31
[0m19:24:15.237824 [info ] [Thread-1  ]: 17 of 54 START test not_null_stg_benchmarks_benchmark_date ..................... [RUN]
[0m19:24:15.238248 [debug] [Thread-2  ]: Finished running node test.bain_capital_analytics.unique_stg_fund_structures_fund_id.bb9fec42ab
[0m19:24:15.238570 [debug] [Thread-4  ]: Began running node test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_id.ec87e4ee58
[0m19:24:15.238932 [debug] [Thread-3  ]: Began running node test.bain_capital_analytics.not_null_stg_valuations_portfolio_id.d5af3e5188
[0m19:24:15.239297 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.not_null_stg_dates_date_day.f3ec4da188, now test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_date.d5c8f88f3e)
[0m19:24:15.239642 [debug] [Thread-2  ]: Began running node test.bain_capital_analytics.not_null_stg_valuations_valuation_id.88ca70781d
[0m19:24:15.239960 [info ] [Thread-4  ]: 18 of 54 START test not_null_stg_benchmarks_benchmark_id ....................... [RUN]
[0m19:24:15.240293 [info ] [Thread-3  ]: 19 of 54 START test not_null_stg_valuations_portfolio_id ....................... [RUN]
[0m19:24:15.240666 [debug] [Thread-1  ]: Began compiling node test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_date.d5c8f88f3e
[0m19:24:15.241018 [info ] [Thread-2  ]: 20 of 54 START test not_null_stg_valuations_valuation_id ....................... [RUN]
[0m19:24:15.241368 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.unique_stg_dates_date_day.e062be8e28, now test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_id.ec87e4ee58)
[0m19:24:15.241700 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.not_null_stg_fund_structures_fund_id.a284274f31, now test.bain_capital_analytics.not_null_stg_valuations_portfolio_id.d5af3e5188)
[0m19:24:15.245451 [debug] [Thread-1  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_date.d5c8f88f3e"
[0m19:24:15.245798 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.unique_stg_fund_structures_fund_id.bb9fec42ab, now test.bain_capital_analytics.not_null_stg_valuations_valuation_id.88ca70781d)
[0m19:24:15.246109 [debug] [Thread-4  ]: Began compiling node test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_id.ec87e4ee58
[0m19:24:15.246399 [debug] [Thread-3  ]: Began compiling node test.bain_capital_analytics.not_null_stg_valuations_portfolio_id.d5af3e5188
[0m19:24:15.246750 [debug] [Thread-2  ]: Began compiling node test.bain_capital_analytics.not_null_stg_valuations_valuation_id.88ca70781d
[0m19:24:15.250097 [debug] [Thread-4  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_id.ec87e4ee58"
[0m19:24:15.253372 [debug] [Thread-3  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_stg_valuations_portfolio_id.d5af3e5188"
[0m19:24:15.256857 [debug] [Thread-2  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_stg_valuations_valuation_id.88ca70781d"
[0m19:24:15.257191 [debug] [Thread-1  ]: Began executing node test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_date.d5c8f88f3e
[0m19:24:15.259679 [debug] [Thread-1  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_date.d5c8f88f3e"
[0m19:24:15.260014 [debug] [Thread-4  ]: Began executing node test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_id.ec87e4ee58
[0m19:24:15.263129 [debug] [Thread-4  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_id.ec87e4ee58"
[0m19:24:15.263449 [debug] [Thread-2  ]: Began executing node test.bain_capital_analytics.not_null_stg_valuations_valuation_id.88ca70781d
[0m19:24:15.263826 [debug] [Thread-3  ]: Began executing node test.bain_capital_analytics.not_null_stg_valuations_portfolio_id.d5af3e5188
[0m19:24:15.266045 [debug] [Thread-2  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_stg_valuations_valuation_id.88ca70781d"
[0m19:24:15.268318 [debug] [Thread-3  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_stg_valuations_portfolio_id.d5af3e5188"
[0m19:24:15.268680 [debug] [Thread-1  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_date.d5c8f88f3e"
[0m19:24:15.269057 [debug] [Thread-4  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_id.ec87e4ee58"
[0m19:24:15.269434 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_date.d5c8f88f3e: BEGIN
[0m19:24:15.269800 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_id.ec87e4ee58: BEGIN
[0m19:24:15.270135 [debug] [Thread-3  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_valuations_portfolio_id.d5af3e5188"
[0m19:24:15.270469 [debug] [Thread-2  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_valuations_valuation_id.88ca70781d"
[0m19:24:15.270758 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m19:24:15.271056 [debug] [Thread-4  ]: Opening a new connection, currently in state closed
[0m19:24:15.271358 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_stg_valuations_portfolio_id.d5af3e5188: BEGIN
[0m19:24:15.271655 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_stg_valuations_valuation_id.88ca70781d: BEGIN
[0m19:24:15.272123 [debug] [Thread-3  ]: Opening a new connection, currently in state closed
[0m19:24:15.272410 [debug] [Thread-2  ]: Opening a new connection, currently in state closed
[0m19:24:15.286001 [debug] [Thread-1  ]: SQL status: BEGIN in 0.015 seconds
[0m19:24:15.286327 [debug] [Thread-3  ]: SQL status: BEGIN in 0.014 seconds
[0m19:24:15.286608 [debug] [Thread-4  ]: SQL status: BEGIN in 0.016 seconds
[0m19:24:15.286880 [debug] [Thread-2  ]: SQL status: BEGIN in 0.014 seconds
[0m19:24:15.287154 [debug] [Thread-1  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_date.d5c8f88f3e"
[0m19:24:15.287460 [debug] [Thread-3  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_valuations_portfolio_id.d5af3e5188"
[0m19:24:15.287750 [debug] [Thread-4  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_id.ec87e4ee58"
[0m19:24:15.288037 [debug] [Thread-2  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_valuations_valuation_id.88ca70781d"
[0m19:24:15.288346 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_date.d5c8f88f3e: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_date.d5c8f88f3e"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select benchmark_date
from "bain_analytics"."public"."stg_benchmarks"
where benchmark_date is null



  
  
      
    ) dbt_internal_test
[0m19:24:15.288665 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_stg_valuations_portfolio_id.d5af3e5188: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_stg_valuations_portfolio_id.d5af3e5188"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select portfolio_id
from "bain_analytics"."public"."stg_valuations"
where portfolio_id is null



  
  
      
    ) dbt_internal_test
[0m19:24:15.288994 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_id.ec87e4ee58: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_id.ec87e4ee58"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select benchmark_id
from "bain_analytics"."public"."stg_benchmarks"
where benchmark_id is null



  
  
      
    ) dbt_internal_test
[0m19:24:15.289327 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_stg_valuations_valuation_id.88ca70781d: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_stg_valuations_valuation_id.88ca70781d"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select valuation_id
from "bain_analytics"."public"."stg_valuations"
where valuation_id is null



  
  
      
    ) dbt_internal_test
[0m19:24:15.292215 [debug] [Thread-2  ]: SQL status: SELECT 1 in 0.002 seconds
[0m19:24:15.292527 [debug] [Thread-3  ]: SQL status: SELECT 1 in 0.003 seconds
[0m19:24:15.292807 [debug] [Thread-4  ]: SQL status: SELECT 1 in 0.003 seconds
[0m19:24:15.293082 [debug] [Thread-1  ]: SQL status: SELECT 1 in 0.003 seconds
[0m19:24:15.294211 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_stg_valuations_valuation_id.88ca70781d: ROLLBACK
[0m19:24:15.295211 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_stg_valuations_portfolio_id.d5af3e5188: ROLLBACK
[0m19:24:15.296198 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_id.ec87e4ee58: ROLLBACK
[0m19:24:15.297169 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_date.d5c8f88f3e: ROLLBACK
[0m19:24:15.298197 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_stg_valuations_valuation_id.88ca70781d: Close
[0m19:24:15.298505 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_id.ec87e4ee58: Close
[0m19:24:15.298788 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_date.d5c8f88f3e: Close
[0m19:24:15.299053 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_stg_valuations_portfolio_id.d5af3e5188: Close
[0m19:24:15.299510 [info ] [Thread-2  ]: 20 of 54 PASS not_null_stg_valuations_valuation_id ............................. [[32mPASS[0m in 0.05s]
[0m19:24:15.299970 [info ] [Thread-4  ]: 18 of 54 PASS not_null_stg_benchmarks_benchmark_id ............................. [[32mPASS[0m in 0.06s]
[0m19:24:15.300414 [info ] [Thread-1  ]: 17 of 54 PASS not_null_stg_benchmarks_benchmark_date ........................... [[32mPASS[0m in 0.06s]
[0m19:24:15.300852 [info ] [Thread-3  ]: 19 of 54 PASS not_null_stg_valuations_portfolio_id ............................. [[32mPASS[0m in 0.06s]
[0m19:24:15.301285 [debug] [Thread-2  ]: Finished running node test.bain_capital_analytics.not_null_stg_valuations_valuation_id.88ca70781d
[0m19:24:15.301699 [debug] [Thread-4  ]: Finished running node test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_id.ec87e4ee58
[0m19:24:15.302102 [debug] [Thread-1  ]: Finished running node test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_date.d5c8f88f3e
[0m19:24:15.302500 [debug] [Thread-3  ]: Finished running node test.bain_capital_analytics.not_null_stg_valuations_portfolio_id.d5af3e5188
[0m19:24:15.302825 [debug] [Thread-2  ]: Began running node test.bain_capital_analytics.unique_stg_valuations_valuation_id.fce7eb13b5
[0m19:24:15.303204 [debug] [Thread-4  ]: Began running node test.bain_capital_analytics.not_null_stg_instruments_instrument_id.18bdfd2ebe
[0m19:24:15.303584 [debug] [Thread-1  ]: Began running node test.bain_capital_analytics.unique_stg_instruments_instrument_id.0e70adcd34
[0m19:24:15.303959 [debug] [Thread-3  ]: Began running node test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c
[0m19:24:15.304381 [info ] [Thread-2  ]: 21 of 54 START test unique_stg_valuations_valuation_id ......................... [RUN]
[0m19:24:15.304718 [info ] [Thread-4  ]: 22 of 54 START test not_null_stg_instruments_instrument_id ..................... [RUN]
[0m19:24:15.305040 [info ] [Thread-1  ]: 23 of 54 START test unique_stg_instruments_instrument_id ....................... [RUN]
[0m19:24:15.305359 [info ] [Thread-3  ]: 24 of 54 START test not_null_stg_positions_portfolio_id ........................ [RUN]
[0m19:24:15.305715 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.not_null_stg_valuations_valuation_id.88ca70781d, now test.bain_capital_analytics.unique_stg_valuations_valuation_id.fce7eb13b5)
[0m19:24:15.306045 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_id.ec87e4ee58, now test.bain_capital_analytics.not_null_stg_instruments_instrument_id.18bdfd2ebe)
[0m19:24:15.306371 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_date.d5c8f88f3e, now test.bain_capital_analytics.unique_stg_instruments_instrument_id.0e70adcd34)
[0m19:24:15.306692 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.not_null_stg_valuations_portfolio_id.d5af3e5188, now test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c)
[0m19:24:15.306998 [debug] [Thread-2  ]: Began compiling node test.bain_capital_analytics.unique_stg_valuations_valuation_id.fce7eb13b5
[0m19:24:15.307292 [debug] [Thread-4  ]: Began compiling node test.bain_capital_analytics.not_null_stg_instruments_instrument_id.18bdfd2ebe
[0m19:24:15.307628 [debug] [Thread-1  ]: Began compiling node test.bain_capital_analytics.unique_stg_instruments_instrument_id.0e70adcd34
[0m19:24:15.307919 [debug] [Thread-3  ]: Began compiling node test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c
[0m19:24:15.311652 [debug] [Thread-2  ]: Writing injected SQL for node "test.bain_capital_analytics.unique_stg_valuations_valuation_id.fce7eb13b5"
[0m19:24:15.315005 [debug] [Thread-4  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_stg_instruments_instrument_id.18bdfd2ebe"
[0m19:24:15.318253 [debug] [Thread-1  ]: Writing injected SQL for node "test.bain_capital_analytics.unique_stg_instruments_instrument_id.0e70adcd34"
[0m19:24:15.322546 [debug] [Thread-3  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c"
[0m19:24:15.323247 [debug] [Thread-2  ]: Began executing node test.bain_capital_analytics.unique_stg_valuations_valuation_id.fce7eb13b5
[0m19:24:15.323568 [debug] [Thread-1  ]: Began executing node test.bain_capital_analytics.unique_stg_instruments_instrument_id.0e70adcd34
[0m19:24:15.323869 [debug] [Thread-4  ]: Began executing node test.bain_capital_analytics.not_null_stg_instruments_instrument_id.18bdfd2ebe
[0m19:24:15.326237 [debug] [Thread-2  ]: Writing runtime sql for node "test.bain_capital_analytics.unique_stg_valuations_valuation_id.fce7eb13b5"
[0m19:24:15.328532 [debug] [Thread-1  ]: Writing runtime sql for node "test.bain_capital_analytics.unique_stg_instruments_instrument_id.0e70adcd34"
[0m19:24:15.330719 [debug] [Thread-4  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_stg_instruments_instrument_id.18bdfd2ebe"
[0m19:24:15.331042 [debug] [Thread-3  ]: Began executing node test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c
[0m19:24:15.333495 [debug] [Thread-3  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c"
[0m19:24:15.333929 [debug] [Thread-2  ]: Using postgres connection "test.bain_capital_analytics.unique_stg_valuations_valuation_id.fce7eb13b5"
[0m19:24:15.334245 [debug] [Thread-2  ]: On test.bain_capital_analytics.unique_stg_valuations_valuation_id.fce7eb13b5: BEGIN
[0m19:24:15.334624 [debug] [Thread-2  ]: Opening a new connection, currently in state closed
[0m19:24:15.334965 [debug] [Thread-4  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_instruments_instrument_id.18bdfd2ebe"
[0m19:24:15.335475 [debug] [Thread-3  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c"
[0m19:24:15.335773 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_stg_instruments_instrument_id.18bdfd2ebe: BEGIN
[0m19:24:15.336094 [debug] [Thread-1  ]: Using postgres connection "test.bain_capital_analytics.unique_stg_instruments_instrument_id.0e70adcd34"
[0m19:24:15.336400 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c: BEGIN
[0m19:24:15.336701 [debug] [Thread-4  ]: Opening a new connection, currently in state closed
[0m19:24:15.337009 [debug] [Thread-1  ]: On test.bain_capital_analytics.unique_stg_instruments_instrument_id.0e70adcd34: BEGIN
[0m19:24:15.337297 [debug] [Thread-3  ]: Opening a new connection, currently in state closed
[0m19:24:15.337668 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m19:24:15.346164 [debug] [Thread-2  ]: SQL status: BEGIN in 0.012 seconds
[0m19:24:15.346467 [debug] [Thread-2  ]: Using postgres connection "test.bain_capital_analytics.unique_stg_valuations_valuation_id.fce7eb13b5"
[0m19:24:15.346767 [debug] [Thread-2  ]: On test.bain_capital_analytics.unique_stg_valuations_valuation_id.fce7eb13b5: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.unique_stg_valuations_valuation_id.fce7eb13b5"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

select
    valuation_id as unique_field,
    count(*) as n_records

from "bain_analytics"."public"."stg_valuations"
where valuation_id is not null
group by valuation_id
having count(*) > 1



  
  
      
    ) dbt_internal_test
[0m19:24:15.349137 [debug] [Thread-4  ]: SQL status: BEGIN in 0.012 seconds
[0m19:24:15.349461 [debug] [Thread-1  ]: SQL status: BEGIN in 0.012 seconds
[0m19:24:15.349758 [debug] [Thread-4  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_instruments_instrument_id.18bdfd2ebe"
[0m19:24:15.350040 [debug] [Thread-3  ]: SQL status: BEGIN in 0.013 seconds
[0m19:24:15.350321 [debug] [Thread-1  ]: Using postgres connection "test.bain_capital_analytics.unique_stg_instruments_instrument_id.0e70adcd34"
[0m19:24:15.350632 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_stg_instruments_instrument_id.18bdfd2ebe: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_stg_instruments_instrument_id.18bdfd2ebe"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select instrument_id
from "bain_analytics"."public"."stg_instruments"
where instrument_id is null



  
  
      
    ) dbt_internal_test
[0m19:24:15.350935 [debug] [Thread-3  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c"
[0m19:24:15.351235 [debug] [Thread-2  ]: SQL status: SELECT 1 in 0.004 seconds
[0m19:24:15.351525 [debug] [Thread-1  ]: On test.bain_capital_analytics.unique_stg_instruments_instrument_id.0e70adcd34: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.unique_stg_instruments_instrument_id.0e70adcd34"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

select
    instrument_id as unique_field,
    count(*) as n_records

from "bain_analytics"."public"."stg_instruments"
where instrument_id is not null
group by instrument_id
having count(*) > 1



  
  
      
    ) dbt_internal_test
[0m19:24:15.351892 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select portfolio_id
from "bain_analytics"."public"."stg_positions"
where portfolio_id is null



  
  
      
    ) dbt_internal_test
[0m19:24:15.353113 [debug] [Thread-2  ]: On test.bain_capital_analytics.unique_stg_valuations_valuation_id.fce7eb13b5: ROLLBACK
[0m19:24:15.353964 [debug] [Thread-2  ]: On test.bain_capital_analytics.unique_stg_valuations_valuation_id.fce7eb13b5: Close
[0m19:24:15.354283 [debug] [Thread-4  ]: SQL status: SELECT 1 in 0.002 seconds
[0m19:24:15.354767 [info ] [Thread-2  ]: 21 of 54 PASS unique_stg_valuations_valuation_id ............................... [[32mPASS[0m in 0.05s]
[0m19:24:15.355875 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_stg_instruments_instrument_id.18bdfd2ebe: ROLLBACK
[0m19:24:15.356195 [debug] [Thread-3  ]: SQL status: SELECT 1 in 0.003 seconds
[0m19:24:15.356595 [debug] [Thread-2  ]: Finished running node test.bain_capital_analytics.unique_stg_valuations_valuation_id.fce7eb13b5
[0m19:24:15.356889 [debug] [Thread-1  ]: SQL status: SELECT 1 in 0.003 seconds
[0m19:24:15.358022 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c: ROLLBACK
[0m19:24:15.358334 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_stg_instruments_instrument_id.18bdfd2ebe: Close
[0m19:24:15.358654 [debug] [Thread-2  ]: Began running node test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1
[0m19:24:15.359698 [debug] [Thread-1  ]: On test.bain_capital_analytics.unique_stg_instruments_instrument_id.0e70adcd34: ROLLBACK
[0m19:24:15.360203 [info ] [Thread-4  ]: 22 of 54 PASS not_null_stg_instruments_instrument_id ........................... [[32mPASS[0m in 0.05s]
[0m19:24:15.360506 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c: Close
[0m19:24:15.360797 [info ] [Thread-2  ]: 25 of 54 START test not_null_stg_positions_position_id ......................... [RUN]
[0m19:24:15.361269 [debug] [Thread-4  ]: Finished running node test.bain_capital_analytics.not_null_stg_instruments_instrument_id.18bdfd2ebe
[0m19:24:15.361562 [debug] [Thread-1  ]: On test.bain_capital_analytics.unique_stg_instruments_instrument_id.0e70adcd34: Close
[0m19:24:15.361972 [info ] [Thread-3  ]: 24 of 54 PASS not_null_stg_positions_portfolio_id .............................. [[32mPASS[0m in 0.06s]
[0m19:24:15.362308 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.unique_stg_valuations_valuation_id.fce7eb13b5, now test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1)
[0m19:24:15.362629 [debug] [Thread-4  ]: Began running node test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f
[0m19:24:15.363107 [info ] [Thread-1  ]: 23 of 54 PASS unique_stg_instruments_instrument_id ............................. [[32mPASS[0m in 0.06s]
[0m19:24:15.363537 [debug] [Thread-3  ]: Finished running node test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c
[0m19:24:15.363833 [debug] [Thread-2  ]: Began compiling node test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1
[0m19:24:15.364136 [info ] [Thread-4  ]: 26 of 54 START test unique_stg_positions_position_id ........................... [RUN]
[0m19:24:15.364561 [debug] [Thread-1  ]: Finished running node test.bain_capital_analytics.unique_stg_instruments_instrument_id.0e70adcd34
[0m19:24:15.364883 [debug] [Thread-3  ]: Began running node test.bain_capital_analytics.not_null_stg_portfolios_fund_id.70b04d82bd
[0m19:24:15.369889 [debug] [Thread-2  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1"
[0m19:24:15.370247 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.not_null_stg_instruments_instrument_id.18bdfd2ebe, now test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f)
[0m19:24:15.370583 [debug] [Thread-1  ]: Began running node test.bain_capital_analytics.not_null_stg_portfolios_portfolio_id.7126a480ec
[0m19:24:15.370929 [info ] [Thread-3  ]: 27 of 54 START test not_null_stg_portfolios_fund_id ............................ [RUN]
[0m19:24:15.371305 [debug] [Thread-4  ]: Began compiling node test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f
[0m19:24:15.371632 [info ] [Thread-1  ]: 28 of 54 START test not_null_stg_portfolios_portfolio_id ....................... [RUN]
[0m19:24:15.371996 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c, now test.bain_capital_analytics.not_null_stg_portfolios_fund_id.70b04d82bd)
[0m19:24:15.375506 [debug] [Thread-4  ]: Writing injected SQL for node "test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f"
[0m19:24:15.375863 [debug] [Thread-2  ]: Began executing node test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1
[0m19:24:15.376216 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.unique_stg_instruments_instrument_id.0e70adcd34, now test.bain_capital_analytics.not_null_stg_portfolios_portfolio_id.7126a480ec)
[0m19:24:15.376536 [debug] [Thread-3  ]: Began compiling node test.bain_capital_analytics.not_null_stg_portfolios_fund_id.70b04d82bd
[0m19:24:15.378847 [debug] [Thread-2  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1"
[0m19:24:15.379160 [debug] [Thread-1  ]: Began compiling node test.bain_capital_analytics.not_null_stg_portfolios_portfolio_id.7126a480ec
[0m19:24:15.382506 [debug] [Thread-3  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_stg_portfolios_fund_id.70b04d82bd"
[0m19:24:15.382872 [debug] [Thread-4  ]: Began executing node test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f
[0m19:24:15.386215 [debug] [Thread-1  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_stg_portfolios_portfolio_id.7126a480ec"
[0m19:24:15.388572 [debug] [Thread-4  ]: Writing runtime sql for node "test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f"
[0m19:24:15.389024 [debug] [Thread-2  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1"
[0m19:24:15.389439 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1: BEGIN
[0m19:24:15.389761 [debug] [Thread-2  ]: Opening a new connection, currently in state closed
[0m19:24:15.390147 [debug] [Thread-3  ]: Began executing node test.bain_capital_analytics.not_null_stg_portfolios_fund_id.70b04d82bd
[0m19:24:15.393380 [debug] [Thread-3  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_stg_portfolios_fund_id.70b04d82bd"
[0m19:24:15.393833 [debug] [Thread-4  ]: Using postgres connection "test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f"
[0m19:24:15.394142 [debug] [Thread-4  ]: On test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f: BEGIN
[0m19:24:15.394432 [debug] [Thread-1  ]: Began executing node test.bain_capital_analytics.not_null_stg_portfolios_portfolio_id.7126a480ec
[0m19:24:15.394749 [debug] [Thread-4  ]: Opening a new connection, currently in state closed
[0m19:24:15.443604 [debug] [Thread-3  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_portfolios_fund_id.70b04d82bd"
[0m19:24:15.446076 [debug] [Thread-1  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_stg_portfolios_portfolio_id.7126a480ec"
[0m19:24:15.446465 [debug] [Thread-2  ]: SQL status: BEGIN in 0.057 seconds
[0m19:24:15.446897 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_stg_portfolios_fund_id.70b04d82bd: BEGIN
[0m19:24:15.447343 [debug] [Thread-2  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1"
[0m19:24:15.447659 [debug] [Thread-3  ]: Opening a new connection, currently in state closed
[0m19:24:15.448028 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select position_id
from "bain_analytics"."public"."stg_positions"
where position_id is null



  
  
      
    ) dbt_internal_test
[0m19:24:15.448411 [debug] [Thread-1  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_portfolios_portfolio_id.7126a480ec"
[0m19:24:15.448825 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_stg_portfolios_portfolio_id.7126a480ec: BEGIN
[0m19:24:15.449112 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m19:24:15.451985 [debug] [Thread-2  ]: SQL status: SELECT 1 in 0.003 seconds
[0m19:24:15.453230 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1: ROLLBACK
[0m19:24:15.453850 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1: Close
[0m19:24:15.454338 [info ] [Thread-2  ]: 25 of 54 PASS not_null_stg_positions_position_id ............................... [[32mPASS[0m in 0.09s]
[0m19:24:15.454793 [debug] [Thread-2  ]: Finished running node test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1
[0m19:24:15.455116 [debug] [Thread-2  ]: Began running node test.bain_capital_analytics.relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_.2823f12709
[0m19:24:15.455494 [info ] [Thread-2  ]: 29 of 54 START test relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_  [RUN]
[0m19:24:15.455844 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1, now test.bain_capital_analytics.relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_.2823f12709)
[0m19:24:15.456149 [debug] [Thread-2  ]: Began compiling node test.bain_capital_analytics.relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_.2823f12709
[0m19:24:15.463736 [debug] [Thread-2  ]: Writing injected SQL for node "test.bain_capital_analytics.relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_.2823f12709"
[0m19:24:15.464282 [debug] [Thread-2  ]: Began executing node test.bain_capital_analytics.relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_.2823f12709
[0m19:24:15.464608 [debug] [Thread-4  ]: SQL status: BEGIN in 0.070 seconds
[0m19:24:15.464928 [debug] [Thread-1  ]: SQL status: BEGIN in 0.016 seconds
[0m19:24:15.465200 [debug] [Thread-3  ]: SQL status: BEGIN in 0.018 seconds
[0m19:24:15.467479 [debug] [Thread-2  ]: Writing runtime sql for node "test.bain_capital_analytics.relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_.2823f12709"
[0m19:24:15.467805 [debug] [Thread-4  ]: Using postgres connection "test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f"
[0m19:24:15.468117 [debug] [Thread-1  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_portfolios_portfolio_id.7126a480ec"
[0m19:24:15.468415 [debug] [Thread-3  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_portfolios_fund_id.70b04d82bd"
[0m19:24:15.468794 [debug] [Thread-4  ]: On test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

select
    position_id as unique_field,
    count(*) as n_records

from "bain_analytics"."public"."stg_positions"
where position_id is not null
group by position_id
having count(*) > 1



  
  
      
    ) dbt_internal_test
[0m19:24:15.469130 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_stg_portfolios_portfolio_id.7126a480ec: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_stg_portfolios_portfolio_id.7126a480ec"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select portfolio_id
from "bain_analytics"."public"."stg_portfolios"
where portfolio_id is null



  
  
      
    ) dbt_internal_test
[0m19:24:15.469479 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_stg_portfolios_fund_id.70b04d82bd: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_stg_portfolios_fund_id.70b04d82bd"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select fund_id
from "bain_analytics"."public"."stg_portfolios"
where fund_id is null



  
  
      
    ) dbt_internal_test
[0m19:24:15.469852 [debug] [Thread-2  ]: Using postgres connection "test.bain_capital_analytics.relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_.2823f12709"
[0m19:24:15.470247 [debug] [Thread-2  ]: On test.bain_capital_analytics.relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_.2823f12709: BEGIN
[0m19:24:15.470535 [debug] [Thread-2  ]: Opening a new connection, currently in state closed
[0m19:24:15.472855 [debug] [Thread-1  ]: SQL status: SELECT 1 in 0.003 seconds
[0m19:24:15.473156 [debug] [Thread-3  ]: SQL status: SELECT 1 in 0.003 seconds
[0m19:24:15.474506 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_stg_portfolios_portfolio_id.7126a480ec: ROLLBACK
[0m19:24:15.474848 [debug] [Thread-4  ]: SQL status: SELECT 1 in 0.005 seconds
[0m19:24:15.475986 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_stg_portfolios_fund_id.70b04d82bd: ROLLBACK
[0m19:24:15.477187 [debug] [Thread-4  ]: On test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f: ROLLBACK
[0m19:24:15.477517 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_stg_portfolios_portfolio_id.7126a480ec: Close
[0m19:24:15.478390 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_stg_portfolios_fund_id.70b04d82bd: Close
[0m19:24:15.478127 [info ] [Thread-1  ]: 28 of 54 PASS not_null_stg_portfolios_portfolio_id ............................. [[32mPASS[0m in 0.10s]
[0m19:24:15.478773 [debug] [Thread-4  ]: On test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f: Close
[0m19:24:15.479215 [info ] [Thread-3  ]: 27 of 54 PASS not_null_stg_portfolios_fund_id .................................. [[32mPASS[0m in 0.11s]
[0m19:24:15.479690 [debug] [Thread-1  ]: Finished running node test.bain_capital_analytics.not_null_stg_portfolios_portfolio_id.7126a480ec
[0m19:24:15.480012 [debug] [Thread-2  ]: SQL status: BEGIN in 0.009 seconds
[0m19:24:15.480434 [info ] [Thread-4  ]: 26 of 54 PASS unique_stg_positions_position_id ................................. [[32mPASS[0m in 0.11s]
[0m19:24:15.480861 [debug] [Thread-3  ]: Finished running node test.bain_capital_analytics.not_null_stg_portfolios_fund_id.70b04d82bd
[0m19:24:15.481190 [debug] [Thread-1  ]: Began running node test.bain_capital_analytics.unique_stg_portfolios_portfolio_id.aa125b6658
[0m19:24:15.481562 [debug] [Thread-2  ]: Using postgres connection "test.bain_capital_analytics.relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_.2823f12709"
[0m19:24:15.481987 [debug] [Thread-4  ]: Finished running node test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f
[0m19:24:15.482315 [debug] [Thread-3  ]: Began running node model.bain_capital_analytics.int_benchmark_returns
[0m19:24:15.482665 [info ] [Thread-1  ]: 30 of 54 START test unique_stg_portfolios_portfolio_id ......................... [RUN]
[0m19:24:15.483044 [debug] [Thread-2  ]: On test.bain_capital_analytics.relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_.2823f12709: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_.2823f12709"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

with child as (
    select portfolio_id as from_field
    from "bain_analytics"."public"."stg_positions"
    where portfolio_id is not null
),

parent as (
    select portfolio_id as to_field
    from "bain_analytics"."public"."stg_portfolios"
)

select
    from_field

from child
left join parent
    on child.from_field = parent.to_field

where parent.to_field is null



  
  
      
    ) dbt_internal_test
[0m19:24:15.483565 [info ] [Thread-3  ]: 31 of 54 START sql view model public.int_benchmark_returns ..................... [RUN]
[0m19:24:15.483933 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.not_null_stg_portfolios_portfolio_id.7126a480ec, now test.bain_capital_analytics.unique_stg_portfolios_portfolio_id.aa125b6658)
[0m19:24:15.484315 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.not_null_stg_portfolios_fund_id.70b04d82bd, now model.bain_capital_analytics.int_benchmark_returns)
[0m19:24:15.484630 [debug] [Thread-1  ]: Began compiling node test.bain_capital_analytics.unique_stg_portfolios_portfolio_id.aa125b6658
[0m19:24:15.484914 [debug] [Thread-3  ]: Began compiling node model.bain_capital_analytics.int_benchmark_returns
[0m19:24:15.488738 [debug] [Thread-1  ]: Writing injected SQL for node "test.bain_capital_analytics.unique_stg_portfolios_portfolio_id.aa125b6658"
[0m19:24:15.489092 [debug] [Thread-2  ]: SQL status: SELECT 1 in 0.005 seconds
[0m19:24:15.492124 [debug] [Thread-3  ]: Writing injected SQL for node "model.bain_capital_analytics.int_benchmark_returns"
[0m19:24:15.493361 [debug] [Thread-2  ]: On test.bain_capital_analytics.relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_.2823f12709: ROLLBACK
[0m19:24:15.493862 [debug] [Thread-1  ]: Began executing node test.bain_capital_analytics.unique_stg_portfolios_portfolio_id.aa125b6658
[0m19:24:15.494191 [debug] [Thread-2  ]: On test.bain_capital_analytics.relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_.2823f12709: Close
[0m19:24:15.497644 [debug] [Thread-1  ]: Writing runtime sql for node "test.bain_capital_analytics.unique_stg_portfolios_portfolio_id.aa125b6658"
[0m19:24:15.497954 [debug] [Thread-3  ]: Began executing node model.bain_capital_analytics.int_benchmark_returns
[0m19:24:15.498415 [info ] [Thread-2  ]: 29 of 54 PASS relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_  [[32mPASS[0m in 0.04s]
[0m19:24:15.501633 [debug] [Thread-3  ]: Writing runtime sql for node "model.bain_capital_analytics.int_benchmark_returns"
[0m19:24:15.502103 [debug] [Thread-2  ]: Finished running node test.bain_capital_analytics.relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_.2823f12709
[0m19:24:15.502551 [debug] [Thread-1  ]: Using postgres connection "test.bain_capital_analytics.unique_stg_portfolios_portfolio_id.aa125b6658"
[0m19:24:15.502949 [debug] [Thread-1  ]: On test.bain_capital_analytics.unique_stg_portfolios_portfolio_id.aa125b6658: BEGIN
[0m19:24:15.503241 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m19:24:15.503577 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.int_benchmark_returns"
[0m19:24:15.503977 [debug] [Thread-3  ]: On model.bain_capital_analytics.int_benchmark_returns: BEGIN
[0m19:24:15.504267 [debug] [Thread-3  ]: Opening a new connection, currently in state closed
[0m19:24:15.514358 [debug] [Thread-1  ]: SQL status: BEGIN in 0.011 seconds
[0m19:24:15.514683 [debug] [Thread-3  ]: SQL status: BEGIN in 0.010 seconds
[0m19:24:15.514985 [debug] [Thread-1  ]: Using postgres connection "test.bain_capital_analytics.unique_stg_portfolios_portfolio_id.aa125b6658"
[0m19:24:15.515287 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.int_benchmark_returns"
[0m19:24:15.515596 [debug] [Thread-1  ]: On test.bain_capital_analytics.unique_stg_portfolios_portfolio_id.aa125b6658: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.unique_stg_portfolios_portfolio_id.aa125b6658"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

select
    portfolio_id as unique_field,
    count(*) as n_records

from "bain_analytics"."public"."stg_portfolios"
where portfolio_id is not null
group by portfolio_id
having count(*) > 1



  
  
      
    ) dbt_internal_test
[0m19:24:15.515982 [debug] [Thread-3  ]: On model.bain_capital_analytics.int_benchmark_returns: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.int_benchmark_returns"} */

  create view "bain_analytics"."public"."int_benchmark_returns__dbt_tmp"
    
    
  as (
    -- Pipeline C: Benchmark returns with rolling calculations
-- Anti-pattern: heavy window functions that could be pre-computed

with benchmark_base as (
    select
        b.benchmark_id,
        b.benchmark_name,
        b.benchmark_date,
        b.return_daily,
        b.return_mtd,
        b.return_ytd,
        b.benchmark_level,
        b.benchmark_fiscal_quarter,
        d.fiscal_year,
        d.is_quarter_end,
        d.is_year_end
    from "bain_analytics"."public"."stg_benchmarks" b
    inner join "bain_analytics"."public"."stg_dates" d
        on b.benchmark_date = d.date_day
),

-- Anti-pattern: compute many overlapping windows
benchmark_with_rolling as (
    select
        bb.*,
        -- rolling 3-month return
        exp(sum(ln(1 + bb.return_mtd)) over (
            partition by bb.benchmark_id
            order by bb.benchmark_date
            rows between 2 preceding and current row
        )) - 1 as rolling_3m_return,
        -- rolling 6-month return
        exp(sum(ln(1 + bb.return_mtd)) over (
            partition by bb.benchmark_id
            order by bb.benchmark_date
            rows between 5 preceding and current row
        )) - 1 as rolling_6m_return,
        -- rolling 12-month return
        exp(sum(ln(1 + bb.return_mtd)) over (
            partition by bb.benchmark_id
            order by bb.benchmark_date
            rows between 11 preceding and current row
        )) - 1 as rolling_12m_return,
        -- Anti-pattern: volatility via window (expensive)
        stddev(bb.return_mtd) over (
            partition by bb.benchmark_id
            order by bb.benchmark_date
            rows between 11 preceding and current row
        ) as rolling_12m_volatility,
        avg(bb.return_mtd) over (
            partition by bb.benchmark_id
            order by bb.benchmark_date
            rows between 11 preceding and current row
        ) as rolling_12m_avg_return,
        lag(bb.benchmark_level) over (
            partition by bb.benchmark_id
            order by bb.benchmark_date
        ) as prev_benchmark_level
    from benchmark_base bb
)

select * from benchmark_with_rolling
  );
[0m19:24:15.519836 [debug] [Thread-1  ]: SQL status: SELECT 1 in 0.003 seconds
[0m19:24:15.520938 [debug] [Thread-1  ]: On test.bain_capital_analytics.unique_stg_portfolios_portfolio_id.aa125b6658: ROLLBACK
[0m19:24:15.521546 [debug] [Thread-1  ]: On test.bain_capital_analytics.unique_stg_portfolios_portfolio_id.aa125b6658: Close
[0m19:24:15.521983 [info ] [Thread-1  ]: 30 of 54 PASS unique_stg_portfolios_portfolio_id ............................... [[32mPASS[0m in 0.04s]
[0m19:24:15.522320 [debug] [Thread-3  ]: SQL status: CREATE VIEW in 0.006 seconds
[0m19:24:15.522725 [debug] [Thread-1  ]: Finished running node test.bain_capital_analytics.unique_stg_portfolios_portfolio_id.aa125b6658
[0m19:24:15.525486 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.int_benchmark_returns"
[0m19:24:15.526069 [debug] [Thread-3  ]: On model.bain_capital_analytics.int_benchmark_returns: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.int_benchmark_returns"} */
alter table "bain_analytics"."public"."int_benchmark_returns__dbt_tmp" rename to "int_benchmark_returns"
[0m19:24:15.526458 [debug] [Thread-4  ]: Began running node model.bain_capital_analytics.int_cashflow_enriched
[0m19:24:15.526790 [debug] [Thread-2  ]: Began running node model.bain_capital_analytics.int_fund_nav
[0m19:24:15.527116 [debug] [Thread-1  ]: Began running node model.bain_capital_analytics.int_irr_calculations
[0m19:24:15.527512 [info ] [Thread-4  ]: 32 of 54 START sql view model public.int_cashflow_enriched ..................... [RUN]
[0m19:24:15.527838 [debug] [Thread-3  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m19:24:15.528207 [info ] [Thread-2  ]: 33 of 54 START sql view model public.int_fund_nav .............................. [RUN]
[0m19:24:15.528601 [info ] [Thread-1  ]: 34 of 54 START sql view model public.int_irr_calculations ...................... [RUN]
[0m19:24:15.528981 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f, now model.bain_capital_analytics.int_cashflow_enriched)
[0m19:24:15.530016 [debug] [Thread-3  ]: On model.bain_capital_analytics.int_benchmark_returns: COMMIT
[0m19:24:15.530352 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_.2823f12709, now model.bain_capital_analytics.int_fund_nav)
[0m19:24:15.530769 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.unique_stg_portfolios_portfolio_id.aa125b6658, now model.bain_capital_analytics.int_irr_calculations)
[0m19:24:15.531098 [debug] [Thread-4  ]: Began compiling node model.bain_capital_analytics.int_cashflow_enriched
[0m19:24:15.531416 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.int_benchmark_returns"
[0m19:24:15.531715 [debug] [Thread-2  ]: Began compiling node model.bain_capital_analytics.int_fund_nav
[0m19:24:15.532003 [debug] [Thread-1  ]: Began compiling node model.bain_capital_analytics.int_irr_calculations
[0m19:24:15.535305 [debug] [Thread-4  ]: Writing injected SQL for node "model.bain_capital_analytics.int_cashflow_enriched"
[0m19:24:15.535620 [debug] [Thread-3  ]: On model.bain_capital_analytics.int_benchmark_returns: COMMIT
[0m19:24:15.538719 [debug] [Thread-2  ]: Writing injected SQL for node "model.bain_capital_analytics.int_fund_nav"
[0m19:24:15.543668 [debug] [Thread-1  ]: Writing injected SQL for node "model.bain_capital_analytics.int_irr_calculations"
[0m19:24:15.544391 [debug] [Thread-4  ]: Began executing node model.bain_capital_analytics.int_cashflow_enriched
[0m19:24:15.544710 [debug] [Thread-1  ]: Began executing node model.bain_capital_analytics.int_irr_calculations
[0m19:24:15.544998 [debug] [Thread-2  ]: Began executing node model.bain_capital_analytics.int_fund_nav
[0m19:24:15.548225 [debug] [Thread-4  ]: Writing runtime sql for node "model.bain_capital_analytics.int_cashflow_enriched"
[0m19:24:15.548532 [debug] [Thread-3  ]: SQL status: COMMIT in 0.004 seconds
[0m19:24:15.551635 [debug] [Thread-1  ]: Writing runtime sql for node "model.bain_capital_analytics.int_irr_calculations"
[0m19:24:15.554714 [debug] [Thread-2  ]: Writing runtime sql for node "model.bain_capital_analytics.int_fund_nav"
[0m19:24:15.556981 [debug] [Thread-3  ]: Applying DROP to: "bain_analytics"."public"."int_benchmark_returns__dbt_backup"
[0m19:24:15.557592 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.int_cashflow_enriched"
[0m19:24:15.558266 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.int_benchmark_returns"
[0m19:24:15.558647 [debug] [Thread-4  ]: On model.bain_capital_analytics.int_cashflow_enriched: BEGIN
[0m19:24:15.558994 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.int_fund_nav"
[0m19:24:15.559291 [debug] [Thread-3  ]: On model.bain_capital_analytics.int_benchmark_returns: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.int_benchmark_returns"} */
drop view if exists "bain_analytics"."public"."int_benchmark_returns__dbt_backup" cascade
[0m19:24:15.559604 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.int_irr_calculations"
[0m19:24:15.559905 [debug] [Thread-4  ]: Opening a new connection, currently in state closed
[0m19:24:15.560198 [debug] [Thread-2  ]: On model.bain_capital_analytics.int_fund_nav: BEGIN
[0m19:24:15.560524 [debug] [Thread-1  ]: On model.bain_capital_analytics.int_irr_calculations: BEGIN
[0m19:24:15.560914 [debug] [Thread-2  ]: Opening a new connection, currently in state closed
[0m19:24:15.561200 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m19:24:15.561508 [debug] [Thread-3  ]: SQL status: DROP VIEW in 0.001 seconds
[0m19:24:15.562733 [debug] [Thread-3  ]: On model.bain_capital_analytics.int_benchmark_returns: Close
[0m19:24:15.563217 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8cf7dc50-2df4-42b7-924b-85984f2cad9f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ee251c0>]}
[0m19:24:15.563748 [info ] [Thread-3  ]: 31 of 54 OK created sql view model public.int_benchmark_returns ................ [[32mCREATE VIEW[0m in 0.08s]
[0m19:24:15.564202 [debug] [Thread-3  ]: Finished running node model.bain_capital_analytics.int_benchmark_returns
[0m19:24:15.564525 [debug] [Thread-3  ]: Began running node model.bain_capital_analytics.int_portfolio_attribution
[0m19:24:15.564965 [info ] [Thread-3  ]: 35 of 54 START sql view model public.int_portfolio_attribution ................. [RUN]
[0m19:24:15.565376 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly model.bain_capital_analytics.int_benchmark_returns, now model.bain_capital_analytics.int_portfolio_attribution)
[0m19:24:15.565684 [debug] [Thread-3  ]: Began compiling node model.bain_capital_analytics.int_portfolio_attribution
[0m19:24:15.569881 [debug] [Thread-3  ]: Writing injected SQL for node "model.bain_capital_analytics.int_portfolio_attribution"
[0m19:24:15.570368 [debug] [Thread-3  ]: Began executing node model.bain_capital_analytics.int_portfolio_attribution
[0m19:24:15.573476 [debug] [Thread-3  ]: Writing runtime sql for node "model.bain_capital_analytics.int_portfolio_attribution"
[0m19:24:15.574071 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.int_portfolio_attribution"
[0m19:24:15.574404 [debug] [Thread-3  ]: On model.bain_capital_analytics.int_portfolio_attribution: BEGIN
[0m19:24:15.574691 [debug] [Thread-3  ]: Opening a new connection, currently in state closed
[0m19:24:15.574990 [debug] [Thread-2  ]: SQL status: BEGIN in 0.014 seconds
[0m19:24:15.575294 [debug] [Thread-1  ]: SQL status: BEGIN in 0.014 seconds
[0m19:24:15.575650 [debug] [Thread-4  ]: SQL status: BEGIN in 0.016 seconds
[0m19:24:15.575936 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.int_fund_nav"
[0m19:24:15.576235 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.int_irr_calculations"
[0m19:24:15.576629 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.int_cashflow_enriched"
[0m19:24:15.577043 [debug] [Thread-2  ]: On model.bain_capital_analytics.int_fund_nav: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.int_fund_nav"} */

  create view "bain_analytics"."public"."int_fund_nav__dbt_tmp"
    
    
  as (
    -- Pipeline C: Fund-level NAV calculation from portfolio valuations
-- Anti-pattern: late aggregation - joins everything then aggregates at the end
-- Anti-pattern: repeated joins to fund_structures and portfolios

with portfolio_valuations as (
    select
        v.portfolio_id,
        v.valuation_date,
        v.net_asset_value,
        v.gross_asset_value,
        v.total_liabilities,
        v.unrealized_pnl,
        v.realized_pnl,
        v.valuation_method,
        p.fund_id,
        p.portfolio_name,
        p.strategy,
        -- Anti-pattern: joining fund_structures again (already done in int_cashflow_enriched)
        fs.fund_name,
        fs.fund_type,
        fs.committed_capital,
        fs.management_fee_rate
    from "bain_analytics"."public"."stg_valuations" v
    inner join "bain_analytics"."public"."stg_portfolios" p
        on v.portfolio_id = p.portfolio_id
    inner join "bain_analytics"."public"."stg_fund_structures" fs
        on p.fund_id = fs.fund_id
),

-- Anti-pattern: aggregation happens here at the end after all joins
fund_level_nav as (
    select
        fund_id,
        fund_name,
        fund_type,
        committed_capital,
        management_fee_rate,
        valuation_date,
        sum(net_asset_value) as fund_nav,
        sum(gross_asset_value) as fund_gav,
        sum(total_liabilities) as fund_total_liabilities,
        sum(unrealized_pnl) as fund_unrealized_pnl,
        sum(realized_pnl) as fund_realized_pnl,
        count(distinct portfolio_id) as num_portfolios
    from portfolio_valuations
    group by
        fund_id, fund_name, fund_type, committed_capital,
        management_fee_rate, valuation_date
),

fund_nav_with_changes as (
    select
        fn.*,
        lag(fn.fund_nav) over (
            partition by fn.fund_id order by fn.valuation_date
        ) as prev_fund_nav,
        case
            when lag(fn.fund_nav) over (
                partition by fn.fund_id order by fn.valuation_date
            ) is not null
            and lag(fn.fund_nav) over (
                partition by fn.fund_id order by fn.valuation_date
            ) != 0
            then (fn.fund_nav - lag(fn.fund_nav) over (
                partition by fn.fund_id order by fn.valuation_date
            )) / lag(fn.fund_nav) over (
                partition by fn.fund_id order by fn.valuation_date
            )
            else null
        end as fund_nav_return,
        fn.fund_nav / nullif(fn.committed_capital, 0) as tvpi_gross
    from fund_level_nav fn
)

select * from fund_nav_with_changes
  );
[0m19:24:15.577615 [debug] [Thread-1  ]: On model.bain_capital_analytics.int_irr_calculations: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.int_irr_calculations"} */

  create view "bain_analytics"."public"."int_irr_calculations__dbt_tmp"
    
    
  as (
    -- Pipeline C: Approximate IRR calculation per fund/portfolio
-- Anti-pattern: extremely deep CTE nesting (6 levels)
-- Anti-pattern: PostgreSQL-specific date arithmetic
-- Anti-pattern: complex logic that should be a macro

with cashflow_series as (
    -- CTE level 1: get all cashflows with proper signs
    select
        cf.fund_id,
        cf.portfolio_id,
        cf.cashflow_date,
        cf.cashflow_type,
        case
            when cf.cashflow_type = 'capital_call' then -1 * abs(cf.amount)
            when cf.cashflow_type = 'distribution' then abs(cf.amount)
            when cf.cashflow_type = 'management_fee' then -1 * abs(cf.amount)
            else cf.amount
        end as signed_amount
    from "bain_analytics"."public"."stg_cashflows" cf
),

terminal_values as (
    -- CTE level 2: get latest NAV as terminal cashflow
    select
        v.portfolio_id,
        p.fund_id,
        v.valuation_date as cashflow_date,
        'terminal_value' as cashflow_type,
        v.net_asset_value as signed_amount
    from "bain_analytics"."public"."stg_valuations" v
    inner join "bain_analytics"."public"."stg_portfolios" p
        on v.portfolio_id = p.portfolio_id
    where v.valuation_date = (
        -- Anti-pattern: correlated subquery instead of window function
        select max(v2.valuation_date)
        from "bain_analytics"."public"."stg_valuations" v2
        where v2.portfolio_id = v.portfolio_id
    )
),

all_cashflows as (
    -- CTE level 3: union cashflows and terminal values
    select fund_id, portfolio_id, cashflow_date, cashflow_type, signed_amount
    from cashflow_series
    union all
    select fund_id, portfolio_id, cashflow_date, cashflow_type, signed_amount
    from terminal_values
),

cashflow_with_timing as (
    -- CTE level 4: compute time fractions
    -- Anti-pattern: PostgreSQL date subtraction
    select
        ac.*,
        min(ac.cashflow_date) over (partition by ac.fund_id, ac.portfolio_id) as first_cf_date,
        (ac.cashflow_date - min(ac.cashflow_date) over (partition by ac.fund_id, ac.portfolio_id))::numeric / 365.25 as year_fraction
    from all_cashflows ac
),

-- CTE level 5: compute simple multiples as IRR proxy
portfolio_multiples as (
    select
        fund_id,
        portfolio_id,
        min(cashflow_date) as first_cashflow_date,
        max(cashflow_date) as last_cashflow_date,
        -- Anti-pattern: PostgreSQL date subtraction
        max(cashflow_date) - min(cashflow_date) as investment_days,
        (max(cashflow_date) - min(cashflow_date))::numeric / 365.25 as investment_years,
        sum(case when cashflow_type = 'capital_call' then abs(signed_amount) else 0 end) as total_invested,
        sum(case when cashflow_type = 'distribution' then signed_amount else 0 end) as total_distributed,
        sum(case when cashflow_type = 'terminal_value' then signed_amount else 0 end) as terminal_value,
        sum(signed_amount) as net_cashflow
    from cashflow_with_timing
    group by fund_id, portfolio_id
),

-- CTE level 6: compute IRR approximation
irr_approximation as (
    select
        pm.*,
        case
            when pm.total_invested > 0
            then (pm.total_distributed + pm.terminal_value) / pm.total_invested
            else null
        end as tvpi,
        case
            when pm.total_invested > 0
            then pm.total_distributed / pm.total_invested
            else null
        end as dpi,
        case
            when pm.total_invested > 0
            then pm.terminal_value / pm.total_invested
            else null
        end as rvpi,
        -- Simplified IRR approximation: (TVPI^(1/years)) - 1
        case
            when pm.total_invested > 0 and pm.investment_years > 0
            then power(
                (pm.total_distributed + pm.terminal_value) / pm.total_invested,
                1.0 / pm.investment_years
            ) - 1
            else null
        end as approx_irr
    from portfolio_multiples pm
)

select * from irr_approximation
  );
[0m19:24:15.578162 [debug] [Thread-4  ]: On model.bain_capital_analytics.int_cashflow_enriched: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.int_cashflow_enriched"} */

  create view "bain_analytics"."public"."int_cashflow_enriched__dbt_tmp"
    
    
  as (
    -- Pipeline C: Enriched cashflow data with fund and portfolio details
-- Anti-pattern: subquery for dedup instead of QUALIFY
-- Anti-pattern: joins repeated from other intermediate models

with cashflow_with_details as (
    select *
    from (
        select
            cf.*,
            p.portfolio_name,
            p.strategy,
            p.manager_name,
            fs.fund_name,
            fs.fund_type,
            fs.committed_capital,
            fs.management_fee_rate,
            fs.carry_rate,
            fs.hurdle_rate,
            -- Anti-pattern: subquery filter instead of QUALIFY
            row_number() over (
                partition by cf.cashflow_id
                order by cf.cashflow_date desc
            ) as rn
        from "bain_analytics"."public"."stg_cashflows" cf
        inner join "bain_analytics"."public"."stg_portfolios" p
            on cf.portfolio_id = p.portfolio_id
        inner join "bain_analytics"."public"."stg_fund_structures" fs
            on cf.fund_id = fs.fund_id
    ) sub
    where rn = 1
),

-- Anti-pattern: running totals computed here AND again downstream
cashflow_cumulative as (
    select
        *,
        sum(case when cashflow_type = 'capital_call' then amount else 0 end) over (
            partition by fund_id, portfolio_id
            order by cashflow_date
            rows between unbounded preceding and current row
        ) as cumulative_called,
        sum(case when cashflow_type = 'distribution' then amount else 0 end) over (
            partition by fund_id, portfolio_id
            order by cashflow_date
            rows between unbounded preceding and current row
        ) as cumulative_distributed,
        sum(amount) over (
            partition by fund_id, portfolio_id
            order by cashflow_date
            rows between unbounded preceding and current row
        ) as cumulative_net_cashflow
    from cashflow_with_details
)

select
    cashflow_id,
    fund_id,
    fund_name,
    fund_type,
    portfolio_id,
    portfolio_name,
    strategy,
    manager_name,
    cashflow_date,
    cashflow_type,
    amount,
    currency,
    description,
    investor_id,
    cashflow_fiscal_quarter,
    cashflow_year,
    committed_capital,
    management_fee_rate,
    carry_rate,
    hurdle_rate,
    cumulative_called,
    cumulative_distributed,
    cumulative_net_cashflow,
    case
        when committed_capital > 0
        then cumulative_called / committed_capital
        else 0
    end as pct_called
from cashflow_cumulative
  );
[0m19:24:15.585386 [debug] [Thread-3  ]: SQL status: BEGIN in 0.011 seconds
[0m19:24:15.585704 [debug] [Thread-4  ]: SQL status: CREATE VIEW in 0.007 seconds
[0m19:24:15.585985 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.int_portfolio_attribution"
[0m19:24:15.586280 [debug] [Thread-2  ]: SQL status: CREATE VIEW in 0.008 seconds
[0m19:24:15.589224 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.int_cashflow_enriched"
[0m19:24:15.589535 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.011 seconds
[0m19:24:15.589911 [debug] [Thread-3  ]: On model.bain_capital_analytics.int_portfolio_attribution: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.int_portfolio_attribution"} */

  create view "bain_analytics"."public"."int_portfolio_attribution__dbt_tmp"
    
    
  as (
    -- Pipeline C: Portfolio performance attribution by sector and instrument type
-- Anti-pattern: deep CTE chain, repeated joins, late aggregation
-- Anti-pattern: same position-instrument-portfolio joins as int_daily_positions

with positions_enriched as (
    -- Anti-pattern: repeating the same 3-way join as int_daily_positions
    select
        pos.position_id,
        pos.portfolio_id,
        pos.instrument_id,
        pos.position_date,
        pos.quantity,
        pos.market_value,
        pos.cost_basis,
        pos.unrealized_gain_loss,
        i.instrument_name,
        i.instrument_type,
        i.sector,
        p.portfolio_name,
        p.strategy,
        p.fund_id
    from "bain_analytics"."public"."stg_positions" pos
    inner join "bain_analytics"."public"."stg_instruments" i
        on pos.instrument_id = i.instrument_id
    inner join "bain_analytics"."public"."stg_portfolios" p
        on pos.portfolio_id = p.portfolio_id
),

-- Anti-pattern: compute portfolio totals in a separate CTE instead of a single pass
portfolio_totals as (
    select
        portfolio_id,
        position_date,
        sum(market_value) as total_portfolio_mv,
        sum(unrealized_gain_loss) as total_portfolio_ugl
    from positions_enriched
    group by portfolio_id, position_date
),

-- Anti-pattern: sector aggregation in yet another CTE
sector_attribution as (
    select
        pe.portfolio_id,
        pe.portfolio_name,
        pe.strategy,
        pe.fund_id,
        pe.position_date,
        pe.sector,
        sum(pe.market_value) as sector_mv,
        sum(pe.unrealized_gain_loss) as sector_ugl,
        count(distinct pe.instrument_id) as num_instruments
    from positions_enriched pe
    group by
        pe.portfolio_id, pe.portfolio_name, pe.strategy,
        pe.fund_id, pe.position_date, pe.sector
),

-- Anti-pattern: joining back to get weights instead of computing in one pass
attribution_with_weights as (
    select
        sa.*,
        pt.total_portfolio_mv,
        pt.total_portfolio_ugl,
        case
            when pt.total_portfolio_mv != 0
            then sa.sector_mv / pt.total_portfolio_mv
            else 0
        end as sector_weight,
        case
            when pt.total_portfolio_ugl != 0
            then sa.sector_ugl / pt.total_portfolio_ugl
            else 0
        end as sector_contribution
    from sector_attribution sa
    inner join portfolio_totals pt
        on sa.portfolio_id = pt.portfolio_id
        and sa.position_date = pt.position_date
)

select * from attribution_with_weights
  );
[0m19:24:15.592716 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.int_fund_nav"
[0m19:24:15.593047 [debug] [Thread-4  ]: On model.bain_capital_analytics.int_cashflow_enriched: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.int_cashflow_enriched"} */
alter table "bain_analytics"."public"."int_cashflow_enriched__dbt_tmp" rename to "int_cashflow_enriched"
[0m19:24:15.595578 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.int_irr_calculations"
[0m19:24:15.595935 [debug] [Thread-2  ]: On model.bain_capital_analytics.int_fund_nav: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.int_fund_nav"} */
alter table "bain_analytics"."public"."int_fund_nav__dbt_tmp" rename to "int_fund_nav"
[0m19:24:15.596288 [debug] [Thread-1  ]: On model.bain_capital_analytics.int_irr_calculations: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.int_irr_calculations"} */
alter table "bain_analytics"."public"."int_irr_calculations__dbt_tmp" rename to "int_irr_calculations"
[0m19:24:15.597218 [debug] [Thread-4  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m19:24:15.597511 [debug] [Thread-2  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m19:24:15.598499 [debug] [Thread-4  ]: On model.bain_capital_analytics.int_cashflow_enriched: COMMIT
[0m19:24:15.598785 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.002 seconds
[0m19:24:15.599660 [debug] [Thread-2  ]: On model.bain_capital_analytics.int_fund_nav: COMMIT
[0m19:24:15.599966 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.int_cashflow_enriched"
[0m19:24:15.600852 [debug] [Thread-1  ]: On model.bain_capital_analytics.int_irr_calculations: COMMIT
[0m19:24:15.601147 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.int_fund_nav"
[0m19:24:15.601432 [debug] [Thread-4  ]: On model.bain_capital_analytics.int_cashflow_enriched: COMMIT
[0m19:24:15.601716 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.int_irr_calculations"
[0m19:24:15.601996 [debug] [Thread-2  ]: On model.bain_capital_analytics.int_fund_nav: COMMIT
[0m19:24:15.602306 [debug] [Thread-1  ]: On model.bain_capital_analytics.int_irr_calculations: COMMIT
[0m19:24:15.602609 [debug] [Thread-3  ]: SQL status: CREATE VIEW in 0.007 seconds
[0m19:24:15.605194 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.int_portfolio_attribution"
[0m19:24:15.605502 [debug] [Thread-1  ]: SQL status: COMMIT in 0.003 seconds
[0m19:24:15.605791 [debug] [Thread-2  ]: SQL status: COMMIT in 0.003 seconds
[0m19:24:15.606079 [debug] [Thread-4  ]: SQL status: COMMIT in 0.004 seconds
[0m19:24:15.606361 [debug] [Thread-3  ]: On model.bain_capital_analytics.int_portfolio_attribution: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.int_portfolio_attribution"} */
alter table "bain_analytics"."public"."int_portfolio_attribution__dbt_tmp" rename to "int_portfolio_attribution"
[0m19:24:15.609693 [debug] [Thread-1  ]: Applying DROP to: "bain_analytics"."public"."int_irr_calculations__dbt_backup"
[0m19:24:15.611764 [debug] [Thread-2  ]: Applying DROP to: "bain_analytics"."public"."int_fund_nav__dbt_backup"
[0m19:24:15.613835 [debug] [Thread-4  ]: Applying DROP to: "bain_analytics"."public"."int_cashflow_enriched__dbt_backup"
[0m19:24:15.614382 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.int_irr_calculations"
[0m19:24:15.614816 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.int_fund_nav"
[0m19:24:15.615266 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.int_cashflow_enriched"
[0m19:24:15.615542 [debug] [Thread-3  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m19:24:15.615835 [debug] [Thread-1  ]: On model.bain_capital_analytics.int_irr_calculations: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.int_irr_calculations"} */
drop view if exists "bain_analytics"."public"."int_irr_calculations__dbt_backup" cascade
[0m19:24:15.616137 [debug] [Thread-2  ]: On model.bain_capital_analytics.int_fund_nav: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.int_fund_nav"} */
drop view if exists "bain_analytics"."public"."int_fund_nav__dbt_backup" cascade
[0m19:24:15.616455 [debug] [Thread-4  ]: On model.bain_capital_analytics.int_cashflow_enriched: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.int_cashflow_enriched"} */
drop view if exists "bain_analytics"."public"."int_cashflow_enriched__dbt_backup" cascade
[0m19:24:15.617408 [debug] [Thread-3  ]: On model.bain_capital_analytics.int_portfolio_attribution: COMMIT
[0m19:24:15.617826 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.int_portfolio_attribution"
[0m19:24:15.618115 [debug] [Thread-3  ]: On model.bain_capital_analytics.int_portfolio_attribution: COMMIT
[0m19:24:15.618398 [debug] [Thread-4  ]: SQL status: DROP VIEW in 0.001 seconds
[0m19:24:15.618678 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.001 seconds
[0m19:24:15.618944 [debug] [Thread-2  ]: SQL status: DROP VIEW in 0.001 seconds
[0m19:24:15.619980 [debug] [Thread-4  ]: On model.bain_capital_analytics.int_cashflow_enriched: Close
[0m19:24:15.620287 [debug] [Thread-3  ]: SQL status: COMMIT in 0.001 seconds
[0m19:24:15.621201 [debug] [Thread-1  ]: On model.bain_capital_analytics.int_irr_calculations: Close
[0m19:24:15.622124 [debug] [Thread-2  ]: On model.bain_capital_analytics.int_fund_nav: Close
[0m19:24:15.622623 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8cf7dc50-2df4-42b7-924b-85984f2cad9f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10efb1df0>]}
[0m19:24:15.624808 [debug] [Thread-3  ]: Applying DROP to: "bain_analytics"."public"."int_portfolio_attribution__dbt_backup"
[0m19:24:15.625307 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8cf7dc50-2df4-42b7-924b-85984f2cad9f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ec3ebb0>]}
[0m19:24:15.625734 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8cf7dc50-2df4-42b7-924b-85984f2cad9f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ee20cd0>]}
[0m19:24:15.626352 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.int_portfolio_attribution"
[0m19:24:15.626802 [info ] [Thread-4  ]: 32 of 54 OK created sql view model public.int_cashflow_enriched ................ [[32mCREATE VIEW[0m in 0.09s]
[0m19:24:15.627330 [info ] [Thread-1  ]: 34 of 54 OK created sql view model public.int_irr_calculations ................. [[32mCREATE VIEW[0m in 0.09s]
[0m19:24:15.627789 [info ] [Thread-2  ]: 33 of 54 OK created sql view model public.int_fund_nav ......................... [[32mCREATE VIEW[0m in 0.10s]
[0m19:24:15.628122 [debug] [Thread-3  ]: On model.bain_capital_analytics.int_portfolio_attribution: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.int_portfolio_attribution"} */
drop view if exists "bain_analytics"."public"."int_portfolio_attribution__dbt_backup" cascade
[0m19:24:15.628561 [debug] [Thread-4  ]: Finished running node model.bain_capital_analytics.int_cashflow_enriched
[0m19:24:15.628965 [debug] [Thread-1  ]: Finished running node model.bain_capital_analytics.int_irr_calculations
[0m19:24:15.629357 [debug] [Thread-2  ]: Finished running node model.bain_capital_analytics.int_fund_nav
[0m19:24:15.629720 [debug] [Thread-4  ]: Began running node model.bain_capital_analytics.int_valuation_enriched
[0m19:24:15.630138 [debug] [Thread-1  ]: Began running node test.bain_capital_analytics.not_null_int_benchmark_returns_benchmark_id.fa96f53b44
[0m19:24:15.630618 [debug] [Thread-3  ]: SQL status: DROP VIEW in 0.001 seconds
[0m19:24:15.631092 [info ] [Thread-4  ]: 36 of 54 START sql view model public.int_valuation_enriched .................... [RUN]
[0m19:24:15.631454 [info ] [Thread-1  ]: 37 of 54 START test not_null_int_benchmark_returns_benchmark_id ................ [RUN]
[0m19:24:15.631795 [debug] [Thread-2  ]: Began running node test.bain_capital_analytics.not_null_int_cashflow_enriched_cashflow_id.8460e9066d
[0m19:24:15.632856 [debug] [Thread-3  ]: On model.bain_capital_analytics.int_portfolio_attribution: Close
[0m19:24:15.633237 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly model.bain_capital_analytics.int_cashflow_enriched, now model.bain_capital_analytics.int_valuation_enriched)
[0m19:24:15.633585 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.bain_capital_analytics.int_irr_calculations, now test.bain_capital_analytics.not_null_int_benchmark_returns_benchmark_id.fa96f53b44)
[0m19:24:15.633919 [info ] [Thread-2  ]: 38 of 54 START test not_null_int_cashflow_enriched_cashflow_id ................. [RUN]
[0m19:24:15.634280 [debug] [Thread-4  ]: Began compiling node model.bain_capital_analytics.int_valuation_enriched
[0m19:24:15.634678 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8cf7dc50-2df4-42b7-924b-85984f2cad9f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e7ea940>]}
[0m19:24:15.634972 [debug] [Thread-1  ]: Began compiling node test.bain_capital_analytics.not_null_int_benchmark_returns_benchmark_id.fa96f53b44
[0m19:24:15.635281 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly model.bain_capital_analytics.int_fund_nav, now test.bain_capital_analytics.not_null_int_cashflow_enriched_cashflow_id.8460e9066d)
[0m19:24:15.638502 [debug] [Thread-4  ]: Writing injected SQL for node "model.bain_capital_analytics.int_valuation_enriched"
[0m19:24:15.643395 [debug] [Thread-1  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_int_benchmark_returns_benchmark_id.fa96f53b44"
[0m19:24:15.643829 [info ] [Thread-3  ]: 35 of 54 OK created sql view model public.int_portfolio_attribution ............ [[32mCREATE VIEW[0m in 0.07s]
[0m19:24:15.644169 [debug] [Thread-2  ]: Began compiling node test.bain_capital_analytics.not_null_int_cashflow_enriched_cashflow_id.8460e9066d
[0m19:24:15.644750 [debug] [Thread-3  ]: Finished running node model.bain_capital_analytics.int_portfolio_attribution
[0m19:24:15.648190 [debug] [Thread-2  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_int_cashflow_enriched_cashflow_id.8460e9066d"
[0m19:24:15.648577 [debug] [Thread-3  ]: Began running node test.bain_capital_analytics.unique_int_cashflow_enriched_cashflow_id.6944893c17
[0m19:24:15.649122 [info ] [Thread-3  ]: 39 of 54 START test unique_int_cashflow_enriched_cashflow_id ................... [RUN]
[0m19:24:15.649492 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly model.bain_capital_analytics.int_portfolio_attribution, now test.bain_capital_analytics.unique_int_cashflow_enriched_cashflow_id.6944893c17)
[0m19:24:15.649811 [debug] [Thread-4  ]: Began executing node model.bain_capital_analytics.int_valuation_enriched
[0m19:24:15.650143 [debug] [Thread-3  ]: Began compiling node test.bain_capital_analytics.unique_int_cashflow_enriched_cashflow_id.6944893c17
[0m19:24:15.650427 [debug] [Thread-1  ]: Began executing node test.bain_capital_analytics.not_null_int_benchmark_returns_benchmark_id.fa96f53b44
[0m19:24:15.650735 [debug] [Thread-2  ]: Began executing node test.bain_capital_analytics.not_null_int_cashflow_enriched_cashflow_id.8460e9066d
[0m19:24:15.654015 [debug] [Thread-4  ]: Writing runtime sql for node "model.bain_capital_analytics.int_valuation_enriched"
[0m19:24:15.657318 [debug] [Thread-3  ]: Writing injected SQL for node "test.bain_capital_analytics.unique_int_cashflow_enriched_cashflow_id.6944893c17"
[0m19:24:15.659666 [debug] [Thread-1  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_int_benchmark_returns_benchmark_id.fa96f53b44"
[0m19:24:15.661924 [debug] [Thread-2  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_int_cashflow_enriched_cashflow_id.8460e9066d"
[0m19:24:15.662669 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.int_valuation_enriched"
[0m19:24:15.662990 [debug] [Thread-4  ]: On model.bain_capital_analytics.int_valuation_enriched: BEGIN
[0m19:24:15.663304 [debug] [Thread-3  ]: Began executing node test.bain_capital_analytics.unique_int_cashflow_enriched_cashflow_id.6944893c17
[0m19:24:15.663638 [debug] [Thread-1  ]: Using postgres connection "test.bain_capital_analytics.not_null_int_benchmark_returns_benchmark_id.fa96f53b44"
[0m19:24:15.663933 [debug] [Thread-4  ]: Opening a new connection, currently in state closed
[0m19:24:15.667174 [debug] [Thread-3  ]: Writing runtime sql for node "test.bain_capital_analytics.unique_int_cashflow_enriched_cashflow_id.6944893c17"
[0m19:24:15.667521 [debug] [Thread-2  ]: Using postgres connection "test.bain_capital_analytics.not_null_int_cashflow_enriched_cashflow_id.8460e9066d"
[0m19:24:15.667817 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_int_benchmark_returns_benchmark_id.fa96f53b44: BEGIN
[0m19:24:15.668296 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_int_cashflow_enriched_cashflow_id.8460e9066d: BEGIN
[0m19:24:15.668591 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m19:24:15.668891 [debug] [Thread-2  ]: Opening a new connection, currently in state closed
[0m19:24:15.669223 [debug] [Thread-3  ]: Using postgres connection "test.bain_capital_analytics.unique_int_cashflow_enriched_cashflow_id.6944893c17"
[0m19:24:15.669699 [debug] [Thread-3  ]: On test.bain_capital_analytics.unique_int_cashflow_enriched_cashflow_id.6944893c17: BEGIN
[0m19:24:15.669979 [debug] [Thread-3  ]: Opening a new connection, currently in state closed
[0m19:24:15.686421 [debug] [Thread-3  ]: SQL status: BEGIN in 0.016 seconds
[0m19:24:15.686837 [debug] [Thread-4  ]: SQL status: BEGIN in 0.023 seconds
[0m19:24:15.687153 [debug] [Thread-1  ]: SQL status: BEGIN in 0.019 seconds
[0m19:24:15.687442 [debug] [Thread-2  ]: SQL status: BEGIN in 0.019 seconds
[0m19:24:15.687732 [debug] [Thread-3  ]: Using postgres connection "test.bain_capital_analytics.unique_int_cashflow_enriched_cashflow_id.6944893c17"
[0m19:24:15.688039 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.int_valuation_enriched"
[0m19:24:15.688341 [debug] [Thread-1  ]: Using postgres connection "test.bain_capital_analytics.not_null_int_benchmark_returns_benchmark_id.fa96f53b44"
[0m19:24:15.688629 [debug] [Thread-2  ]: Using postgres connection "test.bain_capital_analytics.not_null_int_cashflow_enriched_cashflow_id.8460e9066d"
[0m19:24:15.688939 [debug] [Thread-3  ]: On test.bain_capital_analytics.unique_int_cashflow_enriched_cashflow_id.6944893c17: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.unique_int_cashflow_enriched_cashflow_id.6944893c17"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

select
    cashflow_id as unique_field,
    count(*) as n_records

from "bain_analytics"."public"."int_cashflow_enriched"
where cashflow_id is not null
group by cashflow_id
having count(*) > 1



  
  
      
    ) dbt_internal_test
[0m19:24:15.689329 [debug] [Thread-4  ]: On model.bain_capital_analytics.int_valuation_enriched: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.int_valuation_enriched"} */

  create view "bain_analytics"."public"."int_valuation_enriched__dbt_tmp"
    
    
  as (
    -- Pipeline C: Enriched valuation data
-- Anti-pattern: subquery for dedup instead of QUALIFY
-- Anti-pattern: repeated portfolio join
-- Anti-pattern: PostgreSQL-specific date functions

with valuation_ranked as (
    select *
    from (
        select
            v.*,
            p.portfolio_name,
            p.strategy,
            p.fund_id,
            p.manager_name,
            -- Anti-pattern: subquery dedup instead of QUALIFY
            row_number() over (
                partition by v.portfolio_id, v.valuation_date
                order by v.valuation_id desc
            ) as rn
        from "bain_analytics"."public"."stg_valuations" v
        inner join "bain_analytics"."public"."stg_portfolios" p
            on v.portfolio_id = p.portfolio_id
    ) sub
    where rn = 1
),

valuation_with_changes as (
    select
        vr.*,
        lag(vr.net_asset_value) over (
            partition by vr.portfolio_id order by vr.valuation_date
        ) as prev_nav,
        case
            when lag(vr.net_asset_value) over (
                partition by vr.portfolio_id order by vr.valuation_date
            ) is not null
            and lag(vr.net_asset_value) over (
                partition by vr.portfolio_id order by vr.valuation_date
            ) != 0
            then (vr.net_asset_value - lag(vr.net_asset_value) over (
                partition by vr.portfolio_id order by vr.valuation_date
            )) / lag(vr.net_asset_value) over (
                partition by vr.portfolio_id order by vr.valuation_date
            )
            else null
        end as nav_return_pct,
        -- Anti-pattern: PostgreSQL date subtraction
        vr.valuation_date - lag(vr.valuation_date) over (
            partition by vr.portfolio_id order by vr.valuation_date
        ) as days_between_valuations
    from valuation_ranked vr
)

select * from valuation_with_changes
  );
[0m19:24:15.689704 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_int_benchmark_returns_benchmark_id.fa96f53b44: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_int_benchmark_returns_benchmark_id.fa96f53b44"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select benchmark_id
from "bain_analytics"."public"."int_benchmark_returns"
where benchmark_id is null



  
  
      
    ) dbt_internal_test
[0m19:24:15.690021 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_int_cashflow_enriched_cashflow_id.8460e9066d: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_int_cashflow_enriched_cashflow_id.8460e9066d"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select cashflow_id
from "bain_analytics"."public"."int_cashflow_enriched"
where cashflow_id is null



  
  
      
    ) dbt_internal_test
[0m19:24:15.695412 [debug] [Thread-1  ]: SQL status: SELECT 1 in 0.005 seconds
[0m19:24:15.696833 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_int_benchmark_returns_benchmark_id.fa96f53b44: ROLLBACK
[0m19:24:15.697183 [debug] [Thread-2  ]: SQL status: SELECT 1 in 0.007 seconds
[0m19:24:15.698365 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_int_cashflow_enriched_cashflow_id.8460e9066d: ROLLBACK
[0m19:24:15.698723 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_int_benchmark_returns_benchmark_id.fa96f53b44: Close
[0m19:24:15.699021 [debug] [Thread-4  ]: SQL status: CREATE VIEW in 0.009 seconds
[0m19:24:15.699297 [debug] [Thread-3  ]: SQL status: SELECT 1 in 0.009 seconds
[0m19:24:15.699859 [info ] [Thread-1  ]: 37 of 54 PASS not_null_int_benchmark_returns_benchmark_id ...................... [[32mPASS[0m in 0.07s]
[0m19:24:15.700185 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_int_cashflow_enriched_cashflow_id.8460e9066d: Close
[0m19:24:15.703273 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.int_valuation_enriched"
[0m19:24:15.704351 [debug] [Thread-3  ]: On test.bain_capital_analytics.unique_int_cashflow_enriched_cashflow_id.6944893c17: ROLLBACK
[0m19:24:15.704800 [debug] [Thread-1  ]: Finished running node test.bain_capital_analytics.not_null_int_benchmark_returns_benchmark_id.fa96f53b44
[0m19:24:15.705252 [info ] [Thread-2  ]: 38 of 54 PASS not_null_int_cashflow_enriched_cashflow_id ....................... [[32mPASS[0m in 0.07s]
[0m19:24:15.705576 [debug] [Thread-4  ]: On model.bain_capital_analytics.int_valuation_enriched: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.int_valuation_enriched"} */
alter table "bain_analytics"."public"."int_valuation_enriched__dbt_tmp" rename to "int_valuation_enriched"
[0m19:24:15.705948 [debug] [Thread-1  ]: Began running node test.bain_capital_analytics.not_null_int_fund_nav_fund_id.ebf0b6cc99
[0m19:24:15.706438 [debug] [Thread-2  ]: Finished running node test.bain_capital_analytics.not_null_int_cashflow_enriched_cashflow_id.8460e9066d
[0m19:24:15.706714 [debug] [Thread-3  ]: On test.bain_capital_analytics.unique_int_cashflow_enriched_cashflow_id.6944893c17: Close
[0m19:24:15.707056 [info ] [Thread-1  ]: 40 of 54 START test not_null_int_fund_nav_fund_id .............................. [RUN]
[0m19:24:15.707428 [debug] [Thread-2  ]: Began running node test.bain_capital_analytics.not_null_int_irr_calculations_fund_id.35702f5be3
[0m19:24:15.707940 [info ] [Thread-3  ]: 39 of 54 PASS unique_int_cashflow_enriched_cashflow_id ......................... [[32mPASS[0m in 0.06s]
[0m19:24:15.708258 [debug] [Thread-4  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m19:24:15.708566 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.not_null_int_benchmark_returns_benchmark_id.fa96f53b44, now test.bain_capital_analytics.not_null_int_fund_nav_fund_id.ebf0b6cc99)
[0m19:24:15.708882 [info ] [Thread-2  ]: 41 of 54 START test not_null_int_irr_calculations_fund_id ...................... [RUN]
[0m19:24:15.709306 [debug] [Thread-3  ]: Finished running node test.bain_capital_analytics.unique_int_cashflow_enriched_cashflow_id.6944893c17
[0m19:24:15.710267 [debug] [Thread-4  ]: On model.bain_capital_analytics.int_valuation_enriched: COMMIT
[0m19:24:15.710572 [debug] [Thread-1  ]: Began compiling node test.bain_capital_analytics.not_null_int_fund_nav_fund_id.ebf0b6cc99
[0m19:24:15.710890 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.not_null_int_cashflow_enriched_cashflow_id.8460e9066d, now test.bain_capital_analytics.not_null_int_irr_calculations_fund_id.35702f5be3)
[0m19:24:15.711220 [debug] [Thread-3  ]: Began running node test.bain_capital_analytics.not_null_int_irr_calculations_portfolio_id.5530046e4d
[0m19:24:15.711573 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.int_valuation_enriched"
[0m19:24:15.715405 [debug] [Thread-1  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_int_fund_nav_fund_id.ebf0b6cc99"
[0m19:24:15.715731 [debug] [Thread-2  ]: Began compiling node test.bain_capital_analytics.not_null_int_irr_calculations_fund_id.35702f5be3
[0m19:24:15.716048 [info ] [Thread-3  ]: 42 of 54 START test not_null_int_irr_calculations_portfolio_id ................. [RUN]
[0m19:24:15.716369 [debug] [Thread-4  ]: On model.bain_capital_analytics.int_valuation_enriched: COMMIT
[0m19:24:15.719990 [debug] [Thread-2  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_int_irr_calculations_fund_id.35702f5be3"
[0m19:24:15.720369 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.unique_int_cashflow_enriched_cashflow_id.6944893c17, now test.bain_capital_analytics.not_null_int_irr_calculations_portfolio_id.5530046e4d)
[0m19:24:15.720848 [debug] [Thread-3  ]: Began compiling node test.bain_capital_analytics.not_null_int_irr_calculations_portfolio_id.5530046e4d
[0m19:24:15.721161 [debug] [Thread-1  ]: Began executing node test.bain_capital_analytics.not_null_int_fund_nav_fund_id.ebf0b6cc99
[0m19:24:15.724479 [debug] [Thread-3  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_int_irr_calculations_portfolio_id.5530046e4d"
[0m19:24:15.724844 [debug] [Thread-4  ]: SQL status: COMMIT in 0.004 seconds
[0m19:24:15.727213 [debug] [Thread-1  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_int_fund_nav_fund_id.ebf0b6cc99"
[0m19:24:15.727562 [debug] [Thread-2  ]: Began executing node test.bain_capital_analytics.not_null_int_irr_calculations_fund_id.35702f5be3
[0m19:24:15.730962 [debug] [Thread-4  ]: Applying DROP to: "bain_analytics"."public"."int_valuation_enriched__dbt_backup"
[0m19:24:15.733424 [debug] [Thread-2  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_int_irr_calculations_fund_id.35702f5be3"
[0m19:24:15.733764 [debug] [Thread-3  ]: Began executing node test.bain_capital_analytics.not_null_int_irr_calculations_portfolio_id.5530046e4d
[0m19:24:15.734249 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.int_valuation_enriched"
[0m19:24:15.734661 [debug] [Thread-1  ]: Using postgres connection "test.bain_capital_analytics.not_null_int_fund_nav_fund_id.ebf0b6cc99"
[0m19:24:15.736858 [debug] [Thread-3  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_int_irr_calculations_portfolio_id.5530046e4d"
[0m19:24:15.737201 [debug] [Thread-4  ]: On model.bain_capital_analytics.int_valuation_enriched: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.int_valuation_enriched"} */
drop view if exists "bain_analytics"."public"."int_valuation_enriched__dbt_backup" cascade
[0m19:24:15.737508 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_int_fund_nav_fund_id.ebf0b6cc99: BEGIN
[0m19:24:15.737901 [debug] [Thread-2  ]: Using postgres connection "test.bain_capital_analytics.not_null_int_irr_calculations_fund_id.35702f5be3"
[0m19:24:15.738241 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m19:24:15.738546 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_int_irr_calculations_fund_id.35702f5be3: BEGIN
[0m19:24:15.738986 [debug] [Thread-4  ]: SQL status: DROP VIEW in 0.001 seconds
[0m19:24:15.739317 [debug] [Thread-3  ]: Using postgres connection "test.bain_capital_analytics.not_null_int_irr_calculations_portfolio_id.5530046e4d"
[0m19:24:15.739605 [debug] [Thread-2  ]: Opening a new connection, currently in state closed
[0m19:24:15.740812 [debug] [Thread-4  ]: On model.bain_capital_analytics.int_valuation_enriched: Close
[0m19:24:15.741125 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_int_irr_calculations_portfolio_id.5530046e4d: BEGIN
[0m19:24:15.741730 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8cf7dc50-2df4-42b7-924b-85984f2cad9f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11408be50>]}
[0m19:24:15.742034 [debug] [Thread-3  ]: Opening a new connection, currently in state closed
[0m19:24:15.742672 [info ] [Thread-4  ]: 36 of 54 OK created sql view model public.int_valuation_enriched ............... [[32mCREATE VIEW[0m in 0.11s]
[0m19:24:15.743131 [debug] [Thread-4  ]: Finished running node model.bain_capital_analytics.int_valuation_enriched
[0m19:24:15.743460 [debug] [Thread-4  ]: Began running node test.bain_capital_analytics.not_null_int_portfolio_attribution_portfolio_id.3e04b7c210
[0m19:24:15.743838 [info ] [Thread-4  ]: 43 of 54 START test not_null_int_portfolio_attribution_portfolio_id ............ [RUN]
[0m19:24:15.744244 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly model.bain_capital_analytics.int_valuation_enriched, now test.bain_capital_analytics.not_null_int_portfolio_attribution_portfolio_id.3e04b7c210)
[0m19:24:15.744545 [debug] [Thread-4  ]: Began compiling node test.bain_capital_analytics.not_null_int_portfolio_attribution_portfolio_id.3e04b7c210
[0m19:24:15.748138 [debug] [Thread-4  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_int_portfolio_attribution_portfolio_id.3e04b7c210"
[0m19:24:15.748663 [debug] [Thread-4  ]: Began executing node test.bain_capital_analytics.not_null_int_portfolio_attribution_portfolio_id.3e04b7c210
[0m19:24:15.750872 [debug] [Thread-4  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_int_portfolio_attribution_portfolio_id.3e04b7c210"
[0m19:24:15.751356 [debug] [Thread-4  ]: Using postgres connection "test.bain_capital_analytics.not_null_int_portfolio_attribution_portfolio_id.3e04b7c210"
[0m19:24:15.751677 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_int_portfolio_attribution_portfolio_id.3e04b7c210: BEGIN
[0m19:24:15.751953 [debug] [Thread-4  ]: Opening a new connection, currently in state closed
[0m19:24:15.752390 [debug] [Thread-1  ]: SQL status: BEGIN in 0.014 seconds
[0m19:24:15.752700 [debug] [Thread-1  ]: Using postgres connection "test.bain_capital_analytics.not_null_int_fund_nav_fund_id.ebf0b6cc99"
[0m19:24:15.753010 [debug] [Thread-2  ]: SQL status: BEGIN in 0.013 seconds
[0m19:24:15.753309 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_int_fund_nav_fund_id.ebf0b6cc99: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_int_fund_nav_fund_id.ebf0b6cc99"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select fund_id
from "bain_analytics"."public"."int_fund_nav"
where fund_id is null



  
  
      
    ) dbt_internal_test
[0m19:24:15.753608 [debug] [Thread-3  ]: SQL status: BEGIN in 0.012 seconds
[0m19:24:15.753895 [debug] [Thread-2  ]: Using postgres connection "test.bain_capital_analytics.not_null_int_irr_calculations_fund_id.35702f5be3"
[0m19:24:15.754226 [debug] [Thread-3  ]: Using postgres connection "test.bain_capital_analytics.not_null_int_irr_calculations_portfolio_id.5530046e4d"
[0m19:24:15.754538 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_int_irr_calculations_fund_id.35702f5be3: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_int_irr_calculations_fund_id.35702f5be3"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select fund_id
from "bain_analytics"."public"."int_irr_calculations"
where fund_id is null



  
  
      
    ) dbt_internal_test
[0m19:24:15.754858 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_int_irr_calculations_portfolio_id.5530046e4d: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_int_irr_calculations_portfolio_id.5530046e4d"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select portfolio_id
from "bain_analytics"."public"."int_irr_calculations"
where portfolio_id is null



  
  
      
    ) dbt_internal_test
[0m19:24:15.759275 [debug] [Thread-1  ]: SQL status: SELECT 1 in 0.005 seconds
[0m19:24:15.760472 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_int_fund_nav_fund_id.ebf0b6cc99: ROLLBACK
[0m19:24:15.760812 [debug] [Thread-3  ]: SQL status: SELECT 1 in 0.006 seconds
[0m19:24:15.761114 [debug] [Thread-2  ]: SQL status: SELECT 1 in 0.006 seconds
[0m19:24:15.761403 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_int_fund_nav_fund_id.ebf0b6cc99: Close
[0m19:24:15.762468 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_int_irr_calculations_portfolio_id.5530046e4d: ROLLBACK
[0m19:24:15.762785 [debug] [Thread-4  ]: SQL status: BEGIN in 0.011 seconds
[0m19:24:15.763828 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_int_irr_calculations_fund_id.35702f5be3: ROLLBACK
[0m19:24:15.764317 [info ] [Thread-1  ]: 40 of 54 PASS not_null_int_fund_nav_fund_id .................................... [[32mPASS[0m in 0.06s]
[0m19:24:15.764675 [debug] [Thread-4  ]: Using postgres connection "test.bain_capital_analytics.not_null_int_portfolio_attribution_portfolio_id.3e04b7c210"
[0m19:24:15.764957 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_int_irr_calculations_portfolio_id.5530046e4d: Close
[0m19:24:15.765410 [debug] [Thread-1  ]: Finished running node test.bain_capital_analytics.not_null_int_fund_nav_fund_id.ebf0b6cc99
[0m19:24:15.765792 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_int_irr_calculations_fund_id.35702f5be3: Close
[0m19:24:15.766101 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_int_portfolio_attribution_portfolio_id.3e04b7c210: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_int_portfolio_attribution_portfolio_id.3e04b7c210"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select portfolio_id
from "bain_analytics"."public"."int_portfolio_attribution"
where portfolio_id is null



  
  
      
    ) dbt_internal_test
[0m19:24:15.766586 [info ] [Thread-3  ]: 42 of 54 PASS not_null_int_irr_calculations_portfolio_id ....................... [[32mPASS[0m in 0.05s]
[0m19:24:15.766937 [debug] [Thread-1  ]: Began running node model.bain_capital_analytics.fact_cashflow_waterfall
[0m19:24:15.767456 [info ] [Thread-2  ]: 41 of 54 PASS not_null_int_irr_calculations_fund_id ............................ [[32mPASS[0m in 0.06s]
[0m19:24:15.767932 [debug] [Thread-3  ]: Finished running node test.bain_capital_analytics.not_null_int_irr_calculations_portfolio_id.5530046e4d
[0m19:24:15.768338 [info ] [Thread-1  ]: 44 of 54 START sql view model public.fact_cashflow_waterfall ................... [RUN]
[0m19:24:15.768764 [debug] [Thread-2  ]: Finished running node test.bain_capital_analytics.not_null_int_irr_calculations_fund_id.35702f5be3
[0m19:24:15.769081 [debug] [Thread-3  ]: Began running node test.bain_capital_analytics.not_null_int_valuation_enriched_valuation_id.048a7ba03a
[0m19:24:15.769448 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.not_null_int_fund_nav_fund_id.ebf0b6cc99, now model.bain_capital_analytics.fact_cashflow_waterfall)
[0m19:24:15.769930 [info ] [Thread-3  ]: 45 of 54 START test not_null_int_valuation_enriched_valuation_id ............... [RUN]
[0m19:24:15.770274 [debug] [Thread-1  ]: Began compiling node model.bain_capital_analytics.fact_cashflow_waterfall
[0m19:24:15.770557 [debug] [Thread-2  ]: Began running node model.bain_capital_analytics.fact_fund_performance
[0m19:24:15.770871 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.not_null_int_irr_calculations_portfolio_id.5530046e4d, now test.bain_capital_analytics.not_null_int_valuation_enriched_valuation_id.048a7ba03a)
[0m19:24:15.775501 [debug] [Thread-1  ]: Writing injected SQL for node "model.bain_capital_analytics.fact_cashflow_waterfall"
[0m19:24:15.775902 [debug] [Thread-4  ]: SQL status: SELECT 1 in 0.008 seconds
[0m19:24:15.776347 [info ] [Thread-2  ]: 46 of 54 START sql view model public.fact_fund_performance ..................... [RUN]
[0m19:24:15.776749 [debug] [Thread-3  ]: Began compiling node test.bain_capital_analytics.not_null_int_valuation_enriched_valuation_id.048a7ba03a
[0m19:24:15.777987 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_int_portfolio_attribution_portfolio_id.3e04b7c210: ROLLBACK
[0m19:24:15.778374 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.not_null_int_irr_calculations_fund_id.35702f5be3, now model.bain_capital_analytics.fact_fund_performance)
[0m19:24:15.782078 [debug] [Thread-3  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_int_valuation_enriched_valuation_id.048a7ba03a"
[0m19:24:15.782505 [debug] [Thread-2  ]: Began compiling node model.bain_capital_analytics.fact_fund_performance
[0m19:24:15.782890 [debug] [Thread-1  ]: Began executing node model.bain_capital_analytics.fact_cashflow_waterfall
[0m19:24:15.786212 [debug] [Thread-2  ]: Writing injected SQL for node "model.bain_capital_analytics.fact_fund_performance"
[0m19:24:15.786533 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_int_portfolio_attribution_portfolio_id.3e04b7c210: Close
[0m19:24:15.790002 [debug] [Thread-1  ]: Writing runtime sql for node "model.bain_capital_analytics.fact_cashflow_waterfall"
[0m19:24:15.790473 [debug] [Thread-3  ]: Began executing node test.bain_capital_analytics.not_null_int_valuation_enriched_valuation_id.048a7ba03a
[0m19:24:15.791115 [info ] [Thread-4  ]: 43 of 54 PASS not_null_int_portfolio_attribution_portfolio_id .................. [[32mPASS[0m in 0.05s]
[0m19:24:15.793618 [debug] [Thread-3  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_int_valuation_enriched_valuation_id.048a7ba03a"
[0m19:24:15.794184 [debug] [Thread-4  ]: Finished running node test.bain_capital_analytics.not_null_int_portfolio_attribution_portfolio_id.3e04b7c210
[0m19:24:15.794519 [debug] [Thread-2  ]: Began executing node model.bain_capital_analytics.fact_fund_performance
[0m19:24:15.794962 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.fact_cashflow_waterfall"
[0m19:24:15.795286 [debug] [Thread-4  ]: Began running node model.bain_capital_analytics.report_lp_quarterly
[0m19:24:15.798665 [debug] [Thread-2  ]: Writing runtime sql for node "model.bain_capital_analytics.fact_fund_performance"
[0m19:24:15.799119 [debug] [Thread-3  ]: Using postgres connection "test.bain_capital_analytics.not_null_int_valuation_enriched_valuation_id.048a7ba03a"
[0m19:24:15.799433 [debug] [Thread-1  ]: On model.bain_capital_analytics.fact_cashflow_waterfall: BEGIN
[0m19:24:15.799862 [info ] [Thread-4  ]: 47 of 54 START sql view model public.report_lp_quarterly ....................... [RUN]
[0m19:24:15.800279 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_int_valuation_enriched_valuation_id.048a7ba03a: BEGIN
[0m19:24:15.800602 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m19:24:15.800981 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.not_null_int_portfolio_attribution_portfolio_id.3e04b7c210, now model.bain_capital_analytics.report_lp_quarterly)
[0m19:24:15.802367 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.fact_fund_performance"
[0m19:24:15.802653 [debug] [Thread-3  ]: Opening a new connection, currently in state closed
[0m19:24:15.803058 [debug] [Thread-4  ]: Began compiling node model.bain_capital_analytics.report_lp_quarterly
[0m19:24:15.803361 [debug] [Thread-2  ]: On model.bain_capital_analytics.fact_fund_performance: BEGIN
[0m19:24:15.807469 [debug] [Thread-4  ]: Writing injected SQL for node "model.bain_capital_analytics.report_lp_quarterly"
[0m19:24:15.808064 [debug] [Thread-2  ]: Opening a new connection, currently in state closed
[0m19:24:15.808913 [debug] [Thread-4  ]: Began executing node model.bain_capital_analytics.report_lp_quarterly
[0m19:24:15.812688 [debug] [Thread-4  ]: Writing runtime sql for node "model.bain_capital_analytics.report_lp_quarterly"
[0m19:24:15.813553 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.report_lp_quarterly"
[0m19:24:15.813936 [debug] [Thread-1  ]: SQL status: BEGIN in 0.013 seconds
[0m19:24:15.814272 [debug] [Thread-3  ]: SQL status: BEGIN in 0.012 seconds
[0m19:24:15.814602 [debug] [Thread-4  ]: On model.bain_capital_analytics.report_lp_quarterly: BEGIN
[0m19:24:15.814922 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.fact_cashflow_waterfall"
[0m19:24:15.815243 [debug] [Thread-3  ]: Using postgres connection "test.bain_capital_analytics.not_null_int_valuation_enriched_valuation_id.048a7ba03a"
[0m19:24:15.815552 [debug] [Thread-4  ]: Opening a new connection, currently in state closed
[0m19:24:15.815992 [debug] [Thread-1  ]: On model.bain_capital_analytics.fact_cashflow_waterfall: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.fact_cashflow_waterfall"} */

  create view "bain_analytics"."public"."fact_cashflow_waterfall__dbt_tmp"
    
    
  as (
    -- Pipeline C: FACT table - Cashflow waterfall for PE/fund reporting
-- Anti-pattern: deep CTEs, repeated joins, late aggregation
-- Anti-pattern: PostgreSQL-specific date functions

with enriched_cashflows as (
    select
        ce.cashflow_id,
        ce.fund_id,
        ce.fund_name,
        ce.fund_type,
        ce.portfolio_id,
        ce.portfolio_name,
        ce.cashflow_date,
        ce.cashflow_type,
        ce.amount,
        ce.investor_id,
        ce.committed_capital,
        ce.management_fee_rate,
        ce.carry_rate,
        ce.hurdle_rate,
        ce.cumulative_called,
        ce.cumulative_distributed,
        ce.cumulative_net_cashflow,
        ce.pct_called,
        -- Anti-pattern: duplicated fiscal quarter logic
        case
            when extract(month from ce.cashflow_date) between 1 and 3 then 'Q3'
            when extract(month from ce.cashflow_date) between 4 and 6 then 'Q4'
            when extract(month from ce.cashflow_date) between 7 and 9 then 'Q1'
            when extract(month from ce.cashflow_date) between 10 and 12 then 'Q2'
        end as fiscal_quarter,
        -- Anti-pattern: PostgreSQL extract
        extract(year from ce.cashflow_date) as calendar_year
    from "bain_analytics"."public"."int_cashflow_enriched" ce
),

-- Anti-pattern: re-joining valuations when int_valuation_enriched already has this
waterfall_with_nav as (
    select
        ecf.*,
        v.net_asset_value,
        v.gross_asset_value,
        v.unrealized_pnl as nav_unrealized_pnl,
        v.realized_pnl as nav_realized_pnl
    from enriched_cashflows ecf
    left join "bain_analytics"."public"."stg_valuations" v
        on ecf.portfolio_id = v.portfolio_id
        and ecf.cashflow_date = v.valuation_date
),

-- Anti-pattern: computing carry/waterfall in a CTE chain instead of a macro
waterfall_calculations as (
    select
        wn.*,
        -- Simplified carry calculation
        case
            when wn.cumulative_distributed > wn.cumulative_called * (1 + wn.hurdle_rate)
            then (wn.cumulative_distributed - wn.cumulative_called * (1 + wn.hurdle_rate)) * wn.carry_rate
            else 0
        end as estimated_carry,
        wn.cumulative_called * wn.management_fee_rate as annual_mgmt_fee,
        case
            when wn.cumulative_called > 0
            then wn.cumulative_distributed / wn.cumulative_called
            else 0
        end as dpi,
        case
            when wn.cumulative_called > 0 and wn.net_asset_value is not null
            then (wn.cumulative_distributed + wn.net_asset_value) / wn.cumulative_called
            else null
        end as tvpi
    from waterfall_with_nav wn
)

select * from waterfall_calculations
  );
[0m19:24:15.816442 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_int_valuation_enriched_valuation_id.048a7ba03a: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_int_valuation_enriched_valuation_id.048a7ba03a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select valuation_id
from "bain_analytics"."public"."int_valuation_enriched"
where valuation_id is null



  
  
      
    ) dbt_internal_test
[0m19:24:15.817014 [debug] [Thread-2  ]: SQL status: BEGIN in 0.009 seconds
[0m19:24:15.817316 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.fact_fund_performance"
[0m19:24:15.817707 [debug] [Thread-2  ]: On model.bain_capital_analytics.fact_fund_performance: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.fact_fund_performance"} */

  create view "bain_analytics"."public"."fact_fund_performance__dbt_tmp"
    
    
  as (
    -- Pipeline C: FACT table - Fund-level performance metrics
-- Anti-pattern: late aggregation - joins everything then aggregates
-- Anti-pattern: re-joins fund_structures (already in int_fund_nav, int_cashflow_enriched)
-- Anti-pattern: materialized as view (should be table)

with fund_nav_data as (
    select
        fn.fund_id,
        fn.fund_name,
        fn.fund_type,
        fn.committed_capital,
        fn.valuation_date,
        fn.fund_nav,
        fn.fund_gav,
        fn.fund_total_liabilities,
        fn.fund_unrealized_pnl,
        fn.fund_realized_pnl,
        fn.fund_nav_return,
        fn.tvpi_gross,
        fn.num_portfolios
    from "bain_analytics"."public"."int_fund_nav" fn
),

fund_cashflows as (
    -- Anti-pattern: re-aggregating cashflows that are already in int_cashflow_enriched
    select
        cf.fund_id,
        cf.cashflow_date,
        sum(case when cf.cashflow_type = 'capital_call' then cf.amount else 0 end) as period_calls,
        sum(case when cf.cashflow_type = 'distribution' then cf.amount else 0 end) as period_distributions,
        sum(case when cf.cashflow_type = 'management_fee' then cf.amount else 0 end) as period_fees,
        sum(cf.amount) as period_net_cashflow
    from "bain_analytics"."public"."stg_cashflows" cf
    group by cf.fund_id, cf.cashflow_date
),

fund_irr as (
    select
        irr.fund_id,
        sum(irr.total_invested) as fund_total_invested,
        sum(irr.total_distributed) as fund_total_distributed,
        sum(irr.terminal_value) as fund_terminal_value,
        -- Anti-pattern: averaging portfolio IRRs as proxy for fund IRR (incorrect but intentional)
        avg(irr.approx_irr) as fund_approx_irr,
        avg(irr.tvpi) as fund_tvpi,
        avg(irr.dpi) as fund_dpi
    from "bain_analytics"."public"."int_irr_calculations" irr
    group by irr.fund_id
),

-- Anti-pattern: joining everything together at the end
combined as (
    select
        fn.fund_id,
        fn.fund_name,
        fn.fund_type,
        fn.committed_capital,
        fn.valuation_date,
        fn.fund_nav,
        fn.fund_gav,
        fn.fund_total_liabilities,
        fn.fund_unrealized_pnl,
        fn.fund_realized_pnl,
        fn.fund_nav_return,
        fn.tvpi_gross,
        fn.num_portfolios,
        coalesce(fc.period_calls, 0) as period_calls,
        coalesce(fc.period_distributions, 0) as period_distributions,
        coalesce(fc.period_fees, 0) as period_fees,
        coalesce(fc.period_net_cashflow, 0) as period_net_cashflow,
        fi.fund_total_invested,
        fi.fund_total_distributed,
        fi.fund_approx_irr,
        fi.fund_tvpi,
        fi.fund_dpi
    from fund_nav_data fn
    left join fund_cashflows fc
        on fn.fund_id = fc.fund_id
        and fn.valuation_date = fc.cashflow_date
    left join fund_irr fi
        on fn.fund_id = fi.fund_id
)

select * from combined
  );
[0m19:24:15.821846 [debug] [Thread-3  ]: SQL status: SELECT 1 in 0.005 seconds
[0m19:24:15.823101 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_int_valuation_enriched_valuation_id.048a7ba03a: ROLLBACK
[0m19:24:15.823439 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.007 seconds
[0m19:24:15.826895 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.fact_cashflow_waterfall"
[0m19:24:15.827380 [debug] [Thread-1  ]: On model.bain_capital_analytics.fact_cashflow_waterfall: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.fact_cashflow_waterfall"} */
alter table "bain_analytics"."public"."fact_cashflow_waterfall__dbt_tmp" rename to "fact_cashflow_waterfall"
[0m19:24:15.827729 [debug] [Thread-2  ]: SQL status: CREATE VIEW in 0.010 seconds
[0m19:24:15.828068 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_int_valuation_enriched_valuation_id.048a7ba03a: Close
[0m19:24:15.828367 [debug] [Thread-4  ]: SQL status: BEGIN in 0.013 seconds
[0m19:24:15.831238 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.fact_fund_performance"
[0m19:24:15.831589 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.003 seconds
[0m19:24:15.831917 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.report_lp_quarterly"
[0m19:24:15.832399 [info ] [Thread-3  ]: 45 of 54 PASS not_null_int_valuation_enriched_valuation_id ..................... [[32mPASS[0m in 0.06s]
[0m19:24:15.832762 [debug] [Thread-2  ]: On model.bain_capital_analytics.fact_fund_performance: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.fact_fund_performance"} */
alter table "bain_analytics"."public"."fact_fund_performance__dbt_tmp" rename to "fact_fund_performance"
[0m19:24:15.833816 [debug] [Thread-1  ]: On model.bain_capital_analytics.fact_cashflow_waterfall: COMMIT
[0m19:24:15.834323 [debug] [Thread-4  ]: On model.bain_capital_analytics.report_lp_quarterly: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.report_lp_quarterly"} */

  create view "bain_analytics"."public"."report_lp_quarterly__dbt_tmp"
    
    
  as (
    -- Pipeline C: REPORT table - LP quarterly reporting
-- Anti-pattern: massive query, duplicated logic, no reuse of intermediates
-- Anti-pattern: PostgreSQL-specific date_trunc
-- Anti-pattern: re-aggregation of data already aggregated upstream

with quarterly_cashflows as (
    -- Anti-pattern: re-aggregating cashflows by quarter (already in int_cashflow_enriched)
    select
        cf.fund_id,
        cf.portfolio_id,
        -- Anti-pattern: PostgreSQL-specific date_trunc
        date_trunc('quarter', cf.cashflow_date) as quarter_start,
        cf.cashflow_fiscal_quarter as fiscal_quarter,
        cf.cashflow_year,
        sum(case when cf.cashflow_type = 'capital_call' then cf.amount else 0 end) as quarter_calls,
        sum(case when cf.cashflow_type = 'distribution' then cf.amount else 0 end) as quarter_distributions,
        sum(case when cf.cashflow_type = 'management_fee' then cf.amount else 0 end) as quarter_fees,
        sum(cf.amount) as quarter_net
    from "bain_analytics"."public"."stg_cashflows" cf
    group by
        cf.fund_id, cf.portfolio_id,
        date_trunc('quarter', cf.cashflow_date),
        cf.cashflow_fiscal_quarter, cf.cashflow_year
),

quarterly_valuations as (
    -- Anti-pattern: re-querying valuations with subquery for quarter-end
    select *
    from (
        select
            v.portfolio_id,
            v.valuation_date,
            v.net_asset_value,
            v.gross_asset_value,
            v.unrealized_pnl,
            v.realized_pnl,
            v.valuation_method,
            -- Anti-pattern: subquery dedup instead of QUALIFY
            row_number() over (
                partition by v.portfolio_id, date_trunc('quarter', v.valuation_date)
                order by v.valuation_date desc
            ) as rn
        from "bain_analytics"."public"."stg_valuations" v
    ) sub
    where rn = 1
),

-- Anti-pattern: re-joining fund structures (done in multiple places)
fund_details as (
    select
        fs.fund_id,
        fs.fund_name,
        fs.fund_type,
        fs.committed_capital,
        fs.management_fee_rate,
        fs.carry_rate,
        fs.hurdle_rate,
        fs.vintage_year,
        fs.gp_commitment_pct
    from "bain_analytics"."public"."stg_fund_structures" fs
),

-- Anti-pattern: joining everything at the end
lp_report as (
    select
        fd.fund_id,
        fd.fund_name,
        fd.fund_type,
        fd.vintage_year,
        fd.committed_capital,
        fd.management_fee_rate,
        fd.carry_rate,
        fd.hurdle_rate,
        fd.gp_commitment_pct,
        qc.portfolio_id,
        p.portfolio_name,
        p.strategy,
        qc.quarter_start,
        qc.fiscal_quarter,
        qc.cashflow_year,
        qc.quarter_calls,
        qc.quarter_distributions,
        qc.quarter_fees,
        qc.quarter_net,
        qv.net_asset_value as quarter_end_nav,
        qv.gross_asset_value as quarter_end_gav,
        qv.unrealized_pnl,
        qv.realized_pnl,
        qv.valuation_method,
        -- Anti-pattern: IRR re-joined from separate calculation
        irr.approx_irr,
        irr.tvpi,
        irr.dpi,
        irr.rvpi
    from quarterly_cashflows qc
    inner join fund_details fd
        on qc.fund_id = fd.fund_id
    inner join "bain_analytics"."public"."stg_portfolios" p
        on qc.portfolio_id = p.portfolio_id
    left join quarterly_valuations qv
        on qc.portfolio_id = qv.portfolio_id
        and date_trunc('quarter', qv.valuation_date) = qc.quarter_start
    left join "bain_analytics"."public"."int_irr_calculations" irr
        on qc.fund_id = irr.fund_id
        and qc.portfolio_id = irr.portfolio_id
)

select
    *,
    -- Anti-pattern: computed columns in final select
    case
        when committed_capital > 0
        then quarter_calls / committed_capital
        else 0
    end as quarterly_drawdown_rate,
    case
        when quarter_end_nav is not null and committed_capital > 0
        then quarter_end_nav / committed_capital
        else null
    end as nav_to_commitment_ratio
from lp_report
order by fund_id, portfolio_id, quarter_start
  );
[0m19:24:15.835040 [debug] [Thread-3  ]: Finished running node test.bain_capital_analytics.not_null_int_valuation_enriched_valuation_id.048a7ba03a
[0m19:24:15.835416 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.fact_cashflow_waterfall"
[0m19:24:15.835872 [debug] [Thread-3  ]: Began running node model.bain_capital_analytics.fact_portfolio_attribution
[0m19:24:15.836250 [debug] [Thread-1  ]: On model.bain_capital_analytics.fact_cashflow_waterfall: COMMIT
[0m19:24:15.836570 [debug] [Thread-2  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m19:24:15.837076 [info ] [Thread-3  ]: 48 of 54 START sql view model public.fact_portfolio_attribution ................ [RUN]
[0m19:24:15.838218 [debug] [Thread-2  ]: On model.bain_capital_analytics.fact_fund_performance: COMMIT
[0m19:24:15.838567 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m19:24:15.838932 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.not_null_int_valuation_enriched_valuation_id.048a7ba03a, now model.bain_capital_analytics.fact_portfolio_attribution)
[0m19:24:15.839256 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.fact_fund_performance"
[0m19:24:15.841938 [debug] [Thread-1  ]: Applying DROP to: "bain_analytics"."public"."fact_cashflow_waterfall__dbt_backup"
[0m19:24:15.842369 [debug] [Thread-3  ]: Began compiling node model.bain_capital_analytics.fact_portfolio_attribution
[0m19:24:15.842688 [debug] [Thread-4  ]: SQL status: CREATE VIEW in 0.007 seconds
[0m19:24:15.843006 [debug] [Thread-2  ]: On model.bain_capital_analytics.fact_fund_performance: COMMIT
[0m19:24:15.843539 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.fact_cashflow_waterfall"
[0m19:24:15.847899 [debug] [Thread-3  ]: Writing injected SQL for node "model.bain_capital_analytics.fact_portfolio_attribution"
[0m19:24:15.850878 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.report_lp_quarterly"
[0m19:24:15.851327 [debug] [Thread-1  ]: On model.bain_capital_analytics.fact_cashflow_waterfall: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.fact_cashflow_waterfall"} */
drop view if exists "bain_analytics"."public"."fact_cashflow_waterfall__dbt_backup" cascade
[0m19:24:15.851743 [debug] [Thread-4  ]: On model.bain_capital_analytics.report_lp_quarterly: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.report_lp_quarterly"} */
alter table "bain_analytics"."public"."report_lp_quarterly__dbt_tmp" rename to "report_lp_quarterly"
[0m19:24:15.852321 [debug] [Thread-3  ]: Began executing node model.bain_capital_analytics.fact_portfolio_attribution
[0m19:24:15.855935 [debug] [Thread-3  ]: Writing runtime sql for node "model.bain_capital_analytics.fact_portfolio_attribution"
[0m19:24:15.856314 [debug] [Thread-4  ]: SQL status: ALTER TABLE in 0.004 seconds
[0m19:24:15.856633 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.005 seconds
[0m19:24:15.857062 [debug] [Thread-2  ]: SQL status: COMMIT in 0.006 seconds
[0m19:24:15.858106 [debug] [Thread-4  ]: On model.bain_capital_analytics.report_lp_quarterly: COMMIT
[0m19:24:15.859404 [debug] [Thread-1  ]: On model.bain_capital_analytics.fact_cashflow_waterfall: Close
[0m19:24:15.861852 [debug] [Thread-2  ]: Applying DROP to: "bain_analytics"."public"."fact_fund_performance__dbt_backup"
[0m19:24:15.862256 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.fact_portfolio_attribution"
[0m19:24:15.862565 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.report_lp_quarterly"
[0m19:24:15.863071 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.fact_fund_performance"
[0m19:24:15.863561 [debug] [Thread-3  ]: On model.bain_capital_analytics.fact_portfolio_attribution: BEGIN
[0m19:24:15.863917 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8cf7dc50-2df4-42b7-924b-85984f2cad9f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10eed06d0>]}
[0m19:24:15.864245 [debug] [Thread-4  ]: On model.bain_capital_analytics.report_lp_quarterly: COMMIT
[0m19:24:15.864547 [debug] [Thread-2  ]: On model.bain_capital_analytics.fact_fund_performance: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.fact_fund_performance"} */
drop view if exists "bain_analytics"."public"."fact_fund_performance__dbt_backup" cascade
[0m19:24:15.864900 [debug] [Thread-3  ]: Opening a new connection, currently in state closed
[0m19:24:15.865591 [info ] [Thread-1  ]: 44 of 54 OK created sql view model public.fact_cashflow_waterfall .............. [[32mCREATE VIEW[0m in 0.09s]
[0m19:24:15.866096 [debug] [Thread-4  ]: SQL status: COMMIT in 0.001 seconds
[0m19:24:15.866423 [debug] [Thread-2  ]: SQL status: DROP VIEW in 0.000 seconds
[0m19:24:15.866983 [debug] [Thread-1  ]: Finished running node model.bain_capital_analytics.fact_cashflow_waterfall
[0m19:24:15.869359 [debug] [Thread-4  ]: Applying DROP to: "bain_analytics"."public"."report_lp_quarterly__dbt_backup"
[0m19:24:15.870531 [debug] [Thread-2  ]: On model.bain_capital_analytics.fact_fund_performance: Close
[0m19:24:15.871153 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.report_lp_quarterly"
[0m19:24:15.871580 [debug] [Thread-1  ]: Began running node test.bain_capital_analytics.not_null_fact_cashflow_waterfall_cashflow_id.7aafd60486
[0m19:24:15.872055 [debug] [Thread-4  ]: On model.bain_capital_analytics.report_lp_quarterly: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.report_lp_quarterly"} */
drop view if exists "bain_analytics"."public"."report_lp_quarterly__dbt_backup" cascade
[0m19:24:15.872365 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8cf7dc50-2df4-42b7-924b-85984f2cad9f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ece6460>]}
[0m19:24:15.872744 [info ] [Thread-1  ]: 49 of 54 START test not_null_fact_cashflow_waterfall_cashflow_id ............... [RUN]
[0m19:24:15.873430 [info ] [Thread-2  ]: 46 of 54 OK created sql view model public.fact_fund_performance ................ [[32mCREATE VIEW[0m in 0.09s]
[0m19:24:15.873871 [debug] [Thread-4  ]: SQL status: DROP VIEW in 0.001 seconds
[0m19:24:15.874222 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.bain_capital_analytics.fact_cashflow_waterfall, now test.bain_capital_analytics.not_null_fact_cashflow_waterfall_cashflow_id.7aafd60486)
[0m19:24:15.874713 [debug] [Thread-2  ]: Finished running node model.bain_capital_analytics.fact_fund_performance
[0m19:24:15.875829 [debug] [Thread-4  ]: On model.bain_capital_analytics.report_lp_quarterly: Close
[0m19:24:15.876150 [debug] [Thread-3  ]: SQL status: BEGIN in 0.011 seconds
[0m19:24:15.876456 [debug] [Thread-1  ]: Began compiling node test.bain_capital_analytics.not_null_fact_cashflow_waterfall_cashflow_id.7aafd60486
[0m19:24:15.876928 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.fact_portfolio_attribution"
[0m19:24:15.877615 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8cf7dc50-2df4-42b7-924b-85984f2cad9f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ece6490>]}
[0m19:24:15.882714 [debug] [Thread-1  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_fact_cashflow_waterfall_cashflow_id.7aafd60486"
[0m19:24:15.883089 [debug] [Thread-2  ]: Began running node test.bain_capital_analytics.not_null_fact_fund_performance_fund_id.738d6489c4
[0m19:24:15.883484 [debug] [Thread-3  ]: On model.bain_capital_analytics.fact_portfolio_attribution: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.fact_portfolio_attribution"} */

  create view "bain_analytics"."public"."fact_portfolio_attribution__dbt_tmp"
    
    
  as (
    -- Pipeline C: FACT table - Portfolio attribution with benchmark comparison
-- Anti-pattern: re-joins data that's already in intermediate models
-- Anti-pattern: repeated computation of sector weights

with attribution as (
    select
        pa.portfolio_id,
        pa.portfolio_name,
        pa.strategy,
        pa.fund_id,
        pa.position_date,
        pa.sector,
        pa.sector_mv,
        pa.sector_ugl,
        pa.num_instruments,
        pa.total_portfolio_mv,
        pa.total_portfolio_ugl,
        pa.sector_weight,
        pa.sector_contribution
    from "bain_analytics"."public"."int_portfolio_attribution" pa
),

-- Anti-pattern: re-joining benchmarks (could be done in intermediate)
attribution_with_benchmark as (
    select
        a.*,
        bm.benchmark_name,
        bm.return_mtd as benchmark_return,
        bm.rolling_3m_return as benchmark_3m_return,
        bm.rolling_12m_return as benchmark_12m_return
    from attribution a
    left join "bain_analytics"."public"."int_benchmark_returns" bm
        on a.position_date = bm.benchmark_date
        and bm.benchmark_id = 'BM_SP500'
),

-- Anti-pattern: computing alpha in yet another CTE
attribution_with_alpha as (
    select
        ab.*,
        -- Simplified active return
        case
            when ab.total_portfolio_mv != 0
            then (ab.sector_ugl / ab.total_portfolio_mv) - coalesce(ab.benchmark_return, 0) * ab.sector_weight
            else 0
        end as sector_active_return,
        -- Anti-pattern: re-computing portfolio-level return here
        case
            when ab.total_portfolio_mv != 0
            then ab.total_portfolio_ugl / ab.total_portfolio_mv
            else 0
        end as portfolio_return
    from attribution_with_benchmark ab
)

select * from attribution_with_alpha
  );
[0m19:24:15.884211 [info ] [Thread-4  ]: 47 of 54 OK created sql view model public.report_lp_quarterly .................. [[32mCREATE VIEW[0m in 0.08s]
[0m19:24:15.884555 [info ] [Thread-2  ]: 50 of 54 START test not_null_fact_fund_performance_fund_id ..................... [RUN]
[0m19:24:15.885076 [debug] [Thread-4  ]: Finished running node model.bain_capital_analytics.report_lp_quarterly
[0m19:24:15.885445 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly model.bain_capital_analytics.fact_fund_performance, now test.bain_capital_analytics.not_null_fact_fund_performance_fund_id.738d6489c4)
[0m19:24:15.885912 [debug] [Thread-2  ]: Began compiling node test.bain_capital_analytics.not_null_fact_fund_performance_fund_id.738d6489c4
[0m19:24:15.937757 [debug] [Thread-3  ]: SQL status: CREATE VIEW in 0.053 seconds
[0m19:24:15.938233 [debug] [Thread-1  ]: Began executing node test.bain_capital_analytics.not_null_fact_cashflow_waterfall_cashflow_id.7aafd60486
[0m19:24:15.941938 [debug] [Thread-2  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_fact_fund_performance_fund_id.738d6489c4"
[0m19:24:15.942307 [debug] [Thread-4  ]: Began running node test.bain_capital_analytics.not_null_report_lp_quarterly_fund_id.aa355f6583
[0m19:24:15.945231 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.fact_portfolio_attribution"
[0m19:24:15.947528 [debug] [Thread-1  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_fact_cashflow_waterfall_cashflow_id.7aafd60486"
[0m19:24:15.947963 [info ] [Thread-4  ]: 51 of 54 START test not_null_report_lp_quarterly_fund_id ....................... [RUN]
[0m19:24:15.948373 [debug] [Thread-3  ]: On model.bain_capital_analytics.fact_portfolio_attribution: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.fact_portfolio_attribution"} */
alter table "bain_analytics"."public"."fact_portfolio_attribution__dbt_tmp" rename to "fact_portfolio_attribution"
[0m19:24:15.948991 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly model.bain_capital_analytics.report_lp_quarterly, now test.bain_capital_analytics.not_null_report_lp_quarterly_fund_id.aa355f6583)
[0m19:24:15.949350 [debug] [Thread-2  ]: Began executing node test.bain_capital_analytics.not_null_fact_fund_performance_fund_id.738d6489c4
[0m19:24:15.949740 [debug] [Thread-4  ]: Began compiling node test.bain_capital_analytics.not_null_report_lp_quarterly_fund_id.aa355f6583
[0m19:24:15.950117 [debug] [Thread-1  ]: Using postgres connection "test.bain_capital_analytics.not_null_fact_cashflow_waterfall_cashflow_id.7aafd60486"
[0m19:24:15.952481 [debug] [Thread-2  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_fact_fund_performance_fund_id.738d6489c4"
[0m19:24:15.952845 [debug] [Thread-3  ]: SQL status: ALTER TABLE in 0.003 seconds
[0m19:24:15.956485 [debug] [Thread-4  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_report_lp_quarterly_fund_id.aa355f6583"
[0m19:24:15.956842 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_fact_cashflow_waterfall_cashflow_id.7aafd60486: BEGIN
[0m19:24:15.958149 [debug] [Thread-3  ]: On model.bain_capital_analytics.fact_portfolio_attribution: COMMIT
[0m19:24:15.958569 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m19:24:15.958973 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.fact_portfolio_attribution"
[0m19:24:15.959488 [debug] [Thread-4  ]: Began executing node test.bain_capital_analytics.not_null_report_lp_quarterly_fund_id.aa355f6583
[0m19:24:15.959820 [debug] [Thread-2  ]: Using postgres connection "test.bain_capital_analytics.not_null_fact_fund_performance_fund_id.738d6489c4"
[0m19:24:15.960124 [debug] [Thread-3  ]: On model.bain_capital_analytics.fact_portfolio_attribution: COMMIT
[0m19:24:15.963504 [debug] [Thread-4  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_report_lp_quarterly_fund_id.aa355f6583"
[0m19:24:15.963874 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_fact_fund_performance_fund_id.738d6489c4: BEGIN
[0m19:24:15.964319 [debug] [Thread-2  ]: Opening a new connection, currently in state closed
[0m19:24:15.964854 [debug] [Thread-4  ]: Using postgres connection "test.bain_capital_analytics.not_null_report_lp_quarterly_fund_id.aa355f6583"
[0m19:24:15.965196 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_report_lp_quarterly_fund_id.aa355f6583: BEGIN
[0m19:24:15.965543 [debug] [Thread-4  ]: Opening a new connection, currently in state closed
[0m19:24:15.965871 [debug] [Thread-3  ]: SQL status: COMMIT in 0.002 seconds
[0m19:24:15.968450 [debug] [Thread-3  ]: Applying DROP to: "bain_analytics"."public"."fact_portfolio_attribution__dbt_backup"
[0m19:24:15.968989 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.fact_portfolio_attribution"
[0m19:24:15.969311 [debug] [Thread-3  ]: On model.bain_capital_analytics.fact_portfolio_attribution: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.fact_portfolio_attribution"} */
drop view if exists "bain_analytics"."public"."fact_portfolio_attribution__dbt_backup" cascade
[0m19:24:15.969634 [debug] [Thread-1  ]: SQL status: BEGIN in 0.011 seconds
[0m19:24:15.969980 [debug] [Thread-1  ]: Using postgres connection "test.bain_capital_analytics.not_null_fact_cashflow_waterfall_cashflow_id.7aafd60486"
[0m19:24:15.970297 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_fact_cashflow_waterfall_cashflow_id.7aafd60486: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_fact_cashflow_waterfall_cashflow_id.7aafd60486"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select cashflow_id
from "bain_analytics"."public"."fact_cashflow_waterfall"
where cashflow_id is null



  
  
      
    ) dbt_internal_test
[0m19:24:15.970620 [debug] [Thread-3  ]: SQL status: DROP VIEW in 0.001 seconds
[0m19:24:15.971771 [debug] [Thread-3  ]: On model.bain_capital_analytics.fact_portfolio_attribution: Close
[0m19:24:15.972291 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8cf7dc50-2df4-42b7-924b-85984f2cad9f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ed16b80>]}
[0m19:24:15.972893 [info ] [Thread-3  ]: 48 of 54 OK created sql view model public.fact_portfolio_attribution ........... [[32mCREATE VIEW[0m in 0.13s]
[0m19:24:15.973368 [debug] [Thread-3  ]: Finished running node model.bain_capital_analytics.fact_portfolio_attribution
[0m19:24:15.973715 [debug] [Thread-2  ]: SQL status: BEGIN in 0.009 seconds
[0m19:24:15.974437 [debug] [Thread-2  ]: Using postgres connection "test.bain_capital_analytics.not_null_fact_fund_performance_fund_id.738d6489c4"
[0m19:24:15.974888 [debug] [Thread-3  ]: Began running node test.bain_capital_analytics.not_null_fact_portfolio_attribution_portfolio_id.f676c7df62
[0m19:24:15.975189 [debug] [Thread-4  ]: SQL status: BEGIN in 0.010 seconds
[0m19:24:15.975504 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_fact_fund_performance_fund_id.738d6489c4: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_fact_fund_performance_fund_id.738d6489c4"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select fund_id
from "bain_analytics"."public"."fact_fund_performance"
where fund_id is null



  
  
      
    ) dbt_internal_test
[0m19:24:15.975867 [info ] [Thread-3  ]: 52 of 54 START test not_null_fact_portfolio_attribution_portfolio_id ........... [RUN]
[0m19:24:15.976269 [debug] [Thread-4  ]: Using postgres connection "test.bain_capital_analytics.not_null_report_lp_quarterly_fund_id.aa355f6583"
[0m19:24:15.976708 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly model.bain_capital_analytics.fact_portfolio_attribution, now test.bain_capital_analytics.not_null_fact_portfolio_attribution_portfolio_id.f676c7df62)
[0m19:24:15.977051 [debug] [Thread-1  ]: SQL status: SELECT 1 in 0.006 seconds
[0m19:24:15.977365 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_report_lp_quarterly_fund_id.aa355f6583: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_report_lp_quarterly_fund_id.aa355f6583"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select fund_id
from "bain_analytics"."public"."report_lp_quarterly"
where fund_id is null



  
  
      
    ) dbt_internal_test
[0m19:24:15.977695 [debug] [Thread-3  ]: Began compiling node test.bain_capital_analytics.not_null_fact_portfolio_attribution_portfolio_id.f676c7df62
[0m19:24:15.978921 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_fact_cashflow_waterfall_cashflow_id.7aafd60486: ROLLBACK
[0m19:24:15.983010 [debug] [Thread-3  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_fact_portfolio_attribution_portfolio_id.f676c7df62"
[0m19:24:15.983416 [debug] [Thread-2  ]: SQL status: SELECT 1 in 0.007 seconds
[0m19:24:15.984800 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_fact_fund_performance_fund_id.738d6489c4: ROLLBACK
[0m19:24:15.985146 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_fact_cashflow_waterfall_cashflow_id.7aafd60486: Close
[0m19:24:15.985728 [info ] [Thread-1  ]: 49 of 54 PASS not_null_fact_cashflow_waterfall_cashflow_id ..................... [[32mPASS[0m in 0.11s]
[0m19:24:15.986120 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_fact_fund_performance_fund_id.738d6489c4: Close
[0m19:24:15.986553 [debug] [Thread-1  ]: Finished running node test.bain_capital_analytics.not_null_fact_cashflow_waterfall_cashflow_id.7aafd60486
[0m19:24:15.986875 [debug] [Thread-4  ]: SQL status: SELECT 1 in 0.008 seconds
[0m19:24:15.987236 [debug] [Thread-3  ]: Began executing node test.bain_capital_analytics.not_null_fact_portfolio_attribution_portfolio_id.f676c7df62
[0m19:24:15.987746 [info ] [Thread-2  ]: 50 of 54 PASS not_null_fact_fund_performance_fund_id ........................... [[32mPASS[0m in 0.10s]
[0m19:24:15.989000 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_report_lp_quarterly_fund_id.aa355f6583: ROLLBACK
[0m19:24:15.991601 [debug] [Thread-3  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_fact_portfolio_attribution_portfolio_id.f676c7df62"
[0m19:24:15.992072 [debug] [Thread-2  ]: Finished running node test.bain_capital_analytics.not_null_fact_fund_performance_fund_id.738d6489c4
[0m19:24:15.992698 [debug] [Thread-1  ]: Began running node model.bain_capital_analytics.report_ic_dashboard
[0m19:24:15.993012 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_report_lp_quarterly_fund_id.aa355f6583: Close
[0m19:24:15.993439 [info ] [Thread-1  ]: 53 of 54 START sql view model public.report_ic_dashboard ....................... [RUN]
[0m19:24:15.993959 [info ] [Thread-4  ]: 51 of 54 PASS not_null_report_lp_quarterly_fund_id ............................. [[32mPASS[0m in 0.05s]
[0m19:24:15.994351 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.not_null_fact_cashflow_waterfall_cashflow_id.7aafd60486, now model.bain_capital_analytics.report_ic_dashboard)
[0m19:24:15.994715 [debug] [Thread-3  ]: Using postgres connection "test.bain_capital_analytics.not_null_fact_portfolio_attribution_portfolio_id.f676c7df62"
[0m19:24:15.995150 [debug] [Thread-4  ]: Finished running node test.bain_capital_analytics.not_null_report_lp_quarterly_fund_id.aa355f6583
[0m19:24:15.995463 [debug] [Thread-1  ]: Began compiling node model.bain_capital_analytics.report_ic_dashboard
[0m19:24:15.995770 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_fact_portfolio_attribution_portfolio_id.f676c7df62: BEGIN
[0m19:24:15.999337 [debug] [Thread-1  ]: Writing injected SQL for node "model.bain_capital_analytics.report_ic_dashboard"
[0m19:24:15.999663 [debug] [Thread-3  ]: Opening a new connection, currently in state closed
[0m19:24:16.000216 [debug] [Thread-1  ]: Began executing node model.bain_capital_analytics.report_ic_dashboard
[0m19:24:16.003797 [debug] [Thread-1  ]: Writing runtime sql for node "model.bain_capital_analytics.report_ic_dashboard"
[0m19:24:16.004362 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.report_ic_dashboard"
[0m19:24:16.004669 [debug] [Thread-1  ]: On model.bain_capital_analytics.report_ic_dashboard: BEGIN
[0m19:24:16.004949 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m19:24:16.007884 [debug] [Thread-3  ]: SQL status: BEGIN in 0.008 seconds
[0m19:24:16.008223 [debug] [Thread-3  ]: Using postgres connection "test.bain_capital_analytics.not_null_fact_portfolio_attribution_portfolio_id.f676c7df62"
[0m19:24:16.008544 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_fact_portfolio_attribution_portfolio_id.f676c7df62: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_fact_portfolio_attribution_portfolio_id.f676c7df62"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select portfolio_id
from "bain_analytics"."public"."fact_portfolio_attribution"
where portfolio_id is null



  
  
      
    ) dbt_internal_test
[0m19:24:16.012312 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m19:24:16.012625 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.report_ic_dashboard"
[0m19:24:16.013035 [debug] [Thread-1  ]: On model.bain_capital_analytics.report_ic_dashboard: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.report_ic_dashboard"} */

  create view "bain_analytics"."public"."report_ic_dashboard__dbt_tmp"
    
    
  as (
    -- Pipeline C: REPORT table - Investment Committee dashboard
-- Anti-pattern: massive query joining many sources, no intermediate reuse
-- Anti-pattern: subquery for latest records instead of QUALIFY
-- Anti-pattern: duplicated logic from other reports

with latest_fund_performance as (
    select *
    from (
        select
            fp.*,
            -- Anti-pattern: subquery dedup instead of QUALIFY
            row_number() over (
                partition by fp.fund_id
                order by fp.valuation_date desc
            ) as rn
        from "bain_analytics"."public"."fact_fund_performance" fp
    ) sub
    where rn = 1
),

latest_portfolio_summary as (
    select *
    from (
        select
            ps.*,
            row_number() over (
                partition by ps.portfolio_id
                order by ps.position_date desc
            ) as rn
        from "bain_analytics"."public"."fact_portfolio_summary" ps
    ) sub
    where rn = 1
),

-- Anti-pattern: re-joining fund structures (already in fact_fund_performance)
fund_overview as (
    select
        lfp.fund_id,
        lfp.fund_name,
        lfp.fund_type,
        lfp.committed_capital,
        lfp.valuation_date as latest_valuation_date,
        lfp.fund_nav,
        lfp.fund_gav,
        lfp.fund_nav_return as latest_nav_return,
        lfp.tvpi_gross,
        lfp.fund_approx_irr,
        lfp.fund_tvpi,
        lfp.fund_dpi,
        lfp.num_portfolios,
        lfp.fund_total_invested,
        lfp.fund_total_distributed,
        -- Anti-pattern: re-joining fund structures
        fs.management_fee_rate,
        fs.carry_rate,
        fs.hurdle_rate,
        fs.vintage_year
    from latest_fund_performance lfp
    inner join "bain_analytics"."public"."stg_fund_structures" fs
        on lfp.fund_id = fs.fund_id
),

portfolio_details as (
    select
        lps.portfolio_id,
        lps.portfolio_name,
        lps.strategy,
        lps.fund_id,
        lps.total_market_value,
        lps.total_unrealized_pnl,
        lps.portfolio_return_pct,
        lps.num_positions,
        -- Anti-pattern: re-computing fiscal quarter
        case
            when extract(month from lps.position_date) between 1 and 3 then 'Q3'
            when extract(month from lps.position_date) between 4 and 6 then 'Q4'
            when extract(month from lps.position_date) between 7 and 9 then 'Q1'
            when extract(month from lps.position_date) between 10 and 12 then 'Q2'
        end as reporting_fiscal_quarter
    from latest_portfolio_summary lps
)

select
    fo.fund_id,
    fo.fund_name,
    fo.fund_type,
    fo.vintage_year,
    fo.committed_capital,
    fo.latest_valuation_date,
    fo.fund_nav,
    fo.fund_gav,
    fo.latest_nav_return,
    fo.tvpi_gross,
    fo.fund_approx_irr,
    fo.fund_tvpi,
    fo.fund_dpi,
    fo.num_portfolios,
    fo.fund_total_invested,
    fo.fund_total_distributed,
    fo.management_fee_rate,
    fo.carry_rate,
    fo.hurdle_rate,
    pd.portfolio_id,
    pd.portfolio_name,
    pd.strategy,
    pd.total_market_value as portfolio_mv,
    pd.total_unrealized_pnl as portfolio_unrealized_pnl,
    pd.portfolio_return_pct,
    pd.num_positions as portfolio_num_positions,
    pd.reporting_fiscal_quarter
from fund_overview fo
inner join portfolio_details pd
    on fo.fund_id = pd.fund_id
order by fo.fund_nav desc, pd.total_market_value desc
  );
[0m19:24:16.015250 [debug] [Thread-1  ]: Postgres adapter: Postgres error: relation "public.fact_portfolio_summary" does not exist
LINE 36:         from "bain_analytics"."public"."fact_portfolio_summa...
                      ^

[0m19:24:16.015567 [debug] [Thread-1  ]: On model.bain_capital_analytics.report_ic_dashboard: ROLLBACK
[0m19:24:16.016201 [debug] [Thread-1  ]: On model.bain_capital_analytics.report_ic_dashboard: Close
[0m19:24:16.016539 [debug] [Thread-3  ]: SQL status: SELECT 1 in 0.006 seconds
[0m19:24:16.017824 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_fact_portfolio_attribution_portfolio_id.f676c7df62: ROLLBACK
[0m19:24:16.021133 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_fact_portfolio_attribution_portfolio_id.f676c7df62: Close
[0m19:24:16.021662 [info ] [Thread-3  ]: 52 of 54 PASS not_null_fact_portfolio_attribution_portfolio_id ................. [[32mPASS[0m in 0.04s]
[0m19:24:16.022138 [debug] [Thread-3  ]: Finished running node test.bain_capital_analytics.not_null_fact_portfolio_attribution_portfolio_id.f676c7df62
[0m19:24:16.038459 [debug] [Thread-1  ]: Database Error in model report_ic_dashboard (models/marts/report_ic_dashboard.sql)
  relation "public.fact_portfolio_summary" does not exist
  LINE 36:         from "bain_analytics"."public"."fact_portfolio_summa...
                        ^
  compiled code at target/run/bain_capital_analytics/models/marts/report_ic_dashboard.sql
[0m19:24:16.039018 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8cf7dc50-2df4-42b7-924b-85984f2cad9f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10db9daf0>]}
[0m19:24:16.039615 [error] [Thread-1  ]: 53 of 54 ERROR creating sql view model public.report_ic_dashboard .............. [[31mERROR[0m in 0.04s]
[0m19:24:16.040097 [debug] [Thread-1  ]: Finished running node model.bain_capital_analytics.report_ic_dashboard
[0m19:24:16.040520 [debug] [Thread-7  ]: Marking all children of 'model.bain_capital_analytics.report_ic_dashboard' to be skipped because of status 'error'.  Reason: Database Error in model report_ic_dashboard (models/marts/report_ic_dashboard.sql)
  relation "public.fact_portfolio_summary" does not exist
  LINE 36:         from "bain_analytics"."public"."fact_portfolio_summa...
                        ^
  compiled code at target/run/bain_capital_analytics/models/marts/report_ic_dashboard.sql.
[0m19:24:16.041254 [debug] [Thread-2  ]: Began running node test.bain_capital_analytics.not_null_report_ic_dashboard_fund_id.e430aafd84
[0m19:24:16.041698 [info ] [Thread-2  ]: 54 of 54 SKIP test not_null_report_ic_dashboard_fund_id ........................ [[33mSKIP[0m]
[0m19:24:16.042062 [debug] [Thread-2  ]: Finished running node test.bain_capital_analytics.not_null_report_ic_dashboard_fund_id.e430aafd84
[0m19:24:16.042356 [debug] [Thread-7  ]: Marking all children of 'test.bain_capital_analytics.not_null_report_ic_dashboard_fund_id.e430aafd84' to be skipped because of status 'skipped'. 
[0m19:24:16.043352 [debug] [MainThread]: Using postgres connection "master"
[0m19:24:16.043625 [debug] [MainThread]: On master: BEGIN
[0m19:24:16.043873 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m19:24:16.052546 [debug] [MainThread]: SQL status: BEGIN in 0.009 seconds
[0m19:24:16.052906 [debug] [MainThread]: On master: COMMIT
[0m19:24:16.053168 [debug] [MainThread]: Using postgres connection "master"
[0m19:24:16.053415 [debug] [MainThread]: On master: COMMIT
[0m19:24:16.053916 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m19:24:16.054175 [debug] [MainThread]: On master: Close
[0m19:24:16.054530 [debug] [MainThread]: Connection 'master' was properly closed.
[0m19:24:16.054763 [debug] [MainThread]: Connection 'model.bain_capital_analytics.report_ic_dashboard' was properly closed.
[0m19:24:16.054989 [debug] [MainThread]: Connection 'test.bain_capital_analytics.not_null_fact_fund_performance_fund_id.738d6489c4' was properly closed.
[0m19:24:16.055209 [debug] [MainThread]: Connection 'test.bain_capital_analytics.not_null_fact_portfolio_attribution_portfolio_id.f676c7df62' was properly closed.
[0m19:24:16.055432 [debug] [MainThread]: Connection 'test.bain_capital_analytics.not_null_report_lp_quarterly_fund_id.aa355f6583' was properly closed.
[0m19:24:16.055816 [info ] [MainThread]: 
[0m19:24:16.056100 [info ] [MainThread]: Finished running 35 data tests, 19 view models in 0 hours 0 minutes and 1.49 seconds (1.49s).
[0m19:24:16.061802 [debug] [MainThread]: Command end result
[0m19:24:16.103631 [debug] [MainThread]: Wrote artifact WritableManifest to ./target/manifest.json
[0m19:24:16.105348 [debug] [MainThread]: Wrote artifact SemanticManifest to ./target/semantic_manifest.json
[0m19:24:16.113530 [debug] [MainThread]: Wrote artifact RunExecutionResult to ./target/run_results.json
[0m19:24:16.113862 [info ] [MainThread]: 
[0m19:24:16.114191 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m19:24:16.114464 [info ] [MainThread]: 
[0m19:24:16.114795 [error] [MainThread]: [31mFailure in model report_ic_dashboard (models/marts/report_ic_dashboard.sql)[0m
[0m19:24:16.115122 [error] [MainThread]:   Database Error in model report_ic_dashboard (models/marts/report_ic_dashboard.sql)
  relation "public.fact_portfolio_summary" does not exist
  LINE 36:         from "bain_analytics"."public"."fact_portfolio_summa...
                        ^
  compiled code at target/run/bain_capital_analytics/models/marts/report_ic_dashboard.sql
[0m19:24:16.115378 [info ] [MainThread]: 
[0m19:24:16.115671 [info ] [MainThread]:   compiled code at target/compiled/bain_capital_analytics/models/marts/report_ic_dashboard.sql
[0m19:24:16.115976 [info ] [MainThread]: 
[0m19:24:16.116251 [info ] [MainThread]: Done. PASS=52 WARN=0 ERROR=1 SKIP=1 NO-OP=0 TOTAL=54
[0m19:24:16.119048 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": false, "command_wall_clock_time": 2.4675395, "process_in_blocks": "0", "process_kernel_time": 0.372928, "process_mem_max_rss": "141672448", "process_out_blocks": "0", "process_user_time": 3.570383}
[0m19:24:16.119397 [debug] [MainThread]: Command `dbt build` failed at 19:24:16.119326 after 2.47 seconds
[0m19:24:16.119732 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c3d51c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e5f2670>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e5c5820>]}
[0m19:24:16.120057 [debug] [MainThread]: Flushing usage events
[0m19:24:18.922439 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m19:24:28.608874 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c122130>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d1ce700>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d1ce520>]}


============================== 19:24:28.612858 | 017548fa-fe6a-4721-ae83-5bbb94d0ff42 ==============================
[0m19:24:28.612858 [info ] [MainThread]: Running with dbt=1.11.0-b3
[0m19:24:28.613377 [debug] [MainThread]: running dbt with arguments {'debug': 'False', 'empty': 'False', 'write_json': 'True', 'target_path': 'None', 'fail_fast': 'False', 'printer_width': '80', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'use_colors': 'True', 'log_cache_events': 'False', 'invocation_command': 'dbt build --select tag:pipeline_a --profiles-dir . --project-dir .', 'warn_error': 'None', 'profiles_dir': '.', 'introspect': 'True', 'cache_selected_only': 'False', 'indirect_selection': 'eager', 'quiet': 'False', 'send_anonymous_usage_stats': 'True', 'log_path': 'logs', 'no_print': 'None', 'static_parser': 'True', 'log_format': 'default', 'use_experimental_parser': 'False', 'partial_parse': 'True', 'version_check': 'True'}
[0m19:24:28.809097 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '017548fa-fe6a-4721-ae83-5bbb94d0ff42', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d8c3fa0>]}
[0m19:24:28.884368 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '017548fa-fe6a-4721-ae83-5bbb94d0ff42', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10cf59220>]}
[0m19:24:28.885308 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m19:24:28.988181 [debug] [MainThread]: checksum: e63134dccc1251cfb572caf0e4aa952f030c125ee3634f3bf2c0a2e1bb6ae349, vars: {}, profile: , target: , version: 1.11.0b3
[0m19:24:29.210119 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m19:24:29.210571 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m19:24:29.273882 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '017548fa-fe6a-4721-ae83-5bbb94d0ff42', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e32c130>]}
[0m19:24:29.401466 [debug] [MainThread]: Wrote artifact WritableManifest to ./target/manifest.json
[0m19:24:29.403293 [debug] [MainThread]: Wrote artifact SemanticManifest to ./target/semantic_manifest.json
[0m19:24:29.432414 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '017548fa-fe6a-4721-ae83-5bbb94d0ff42', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e31dac0>]}
[0m19:24:29.432964 [info ] [MainThread]: Found 28 models, 53 data tests, 10 seeds, 569 macros
[0m19:24:29.435548 [info ] [MainThread]: 
[0m19:24:29.435865 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m19:24:29.436118 [info ] [MainThread]: 
[0m19:24:29.436540 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m19:24:29.440413 [debug] [ThreadPool]: Acquiring new postgres connection 'list_bain_analytics'
[0m19:24:29.492549 [debug] [ThreadPool]: Using postgres connection "list_bain_analytics"
[0m19:24:29.492987 [debug] [ThreadPool]: On list_bain_analytics: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "connection_name": "list_bain_analytics"} */

    select distinct nspname from pg_namespace
  
[0m19:24:29.493272 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m19:24:29.531058 [debug] [ThreadPool]: SQL status: SELECT 5 in 0.038 seconds
[0m19:24:29.532428 [debug] [ThreadPool]: On list_bain_analytics: Close
[0m19:24:29.535935 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_bain_analytics, now list_bain_analytics_public_raw)
[0m19:24:29.536432 [debug] [ThreadPool]: Acquiring new postgres connection 'list_bain_analytics_public'
[0m19:24:29.542691 [debug] [ThreadPool]: Using postgres connection "list_bain_analytics_public_raw"
[0m19:24:29.545248 [debug] [ThreadPool]: Using postgres connection "list_bain_analytics_public"
[0m19:24:29.545551 [debug] [ThreadPool]: On list_bain_analytics_public_raw: BEGIN
[0m19:24:29.545807 [debug] [ThreadPool]: On list_bain_analytics_public: BEGIN
[0m19:24:29.546058 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:24:29.546305 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m19:24:29.558553 [debug] [ThreadPool]: SQL status: BEGIN in 0.012 seconds
[0m19:24:29.558835 [debug] [ThreadPool]: Using postgres connection "list_bain_analytics_public"
[0m19:24:29.559145 [debug] [ThreadPool]: On list_bain_analytics_public: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "connection_name": "list_bain_analytics_public"} */
select
      'bain_analytics' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'bain_analytics' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'bain_analytics' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m19:24:29.559931 [debug] [ThreadPool]: SQL status: BEGIN in 0.014 seconds
[0m19:24:29.560307 [debug] [ThreadPool]: Using postgres connection "list_bain_analytics_public_raw"
[0m19:24:29.560623 [debug] [ThreadPool]: On list_bain_analytics_public_raw: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "connection_name": "list_bain_analytics_public_raw"} */
select
      'bain_analytics' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_raw'
    union all
    select
      'bain_analytics' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_raw'
    union all
    select
      'bain_analytics' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_raw'
  
[0m19:24:29.564486 [debug] [ThreadPool]: SQL status: SELECT 20 in 0.005 seconds
[0m19:24:29.565883 [debug] [ThreadPool]: On list_bain_analytics_public: ROLLBACK
[0m19:24:29.566168 [debug] [ThreadPool]: SQL status: SELECT 10 in 0.005 seconds
[0m19:24:29.567219 [debug] [ThreadPool]: On list_bain_analytics_public_raw: ROLLBACK
[0m19:24:29.567487 [debug] [ThreadPool]: On list_bain_analytics_public: Close
[0m19:24:29.569938 [debug] [ThreadPool]: On list_bain_analytics_public_raw: Close
[0m19:24:29.577739 [debug] [MainThread]: Using postgres connection "master"
[0m19:24:29.578087 [debug] [MainThread]: On master: BEGIN
[0m19:24:29.578345 [debug] [MainThread]: Opening a new connection, currently in state init
[0m19:24:29.588718 [debug] [MainThread]: SQL status: BEGIN in 0.010 seconds
[0m19:24:29.589035 [debug] [MainThread]: Using postgres connection "master"
[0m19:24:29.589367 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "connection_name": "master"} */
select distinct
        dependent_namespace.nspname as dependent_schema,
        dependent_class.relname as dependent_name,
        referenced_namespace.nspname as referenced_schema,
        referenced_class.relname as referenced_name

    -- Query for views: views are entries in pg_class with an entry in pg_rewrite, but we avoid
    -- a seq scan on pg_rewrite by leveraging the fact there is an "internal" row in pg_depend for
    -- the view...
    from pg_class as dependent_class
    join pg_namespace as dependent_namespace on dependent_namespace.oid = dependent_class.relnamespace
    join pg_depend as dependent_depend on dependent_depend.refobjid = dependent_class.oid
        and dependent_depend.classid = 'pg_rewrite'::regclass
        and dependent_depend.refclassid = 'pg_class'::regclass
        and dependent_depend.deptype = 'i'

    -- ... and via pg_depend (that has a row per column, hence the need for "distinct" above, and
    -- making sure to exclude the internal row to avoid a view appearing to depend on itself)...
    join pg_depend as joining_depend on joining_depend.objid = dependent_depend.objid
        and joining_depend.classid = 'pg_rewrite'::regclass
        and joining_depend.refclassid = 'pg_class'::regclass
        and joining_depend.refobjid != dependent_depend.refobjid

    -- ... we can find the tables they query from in pg_class, but excluding system tables. Note we
    -- don't need need to exclude _dependent_ system tables, because they only query from other
    -- system tables, and so are automatically excluded by excluding _referenced_ system tables
    join pg_class as referenced_class on referenced_class.oid = joining_depend.refobjid
    join pg_namespace as referenced_namespace on referenced_namespace.oid = referenced_class.relnamespace
        and referenced_namespace.nspname != 'information_schema'
        and referenced_namespace.nspname not like 'pg\_%'

    order by
        dependent_schema, dependent_name, referenced_schema, referenced_name;
[0m19:24:29.595980 [debug] [MainThread]: SQL status: SELECT 38 in 0.006 seconds
[0m19:24:29.602225 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '017548fa-fe6a-4721-ae83-5bbb94d0ff42', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e384490>]}
[0m19:24:29.602638 [debug] [MainThread]: On master: ROLLBACK
[0m19:24:29.603722 [debug] [MainThread]: Using postgres connection "master"
[0m19:24:29.603978 [debug] [MainThread]: On master: BEGIN
[0m19:24:29.604809 [debug] [MainThread]: SQL status: BEGIN in 0.001 seconds
[0m19:24:29.605063 [debug] [MainThread]: On master: COMMIT
[0m19:24:29.605319 [debug] [MainThread]: Using postgres connection "master"
[0m19:24:29.605554 [debug] [MainThread]: On master: COMMIT
[0m19:24:29.606061 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m19:24:29.606314 [debug] [MainThread]: On master: Close
[0m19:24:29.608622 [debug] [Thread-1  ]: Began running node model.bain_capital_analytics.stg_portfolios
[0m19:24:29.608986 [debug] [Thread-2  ]: Began running node model.bain_capital_analytics.stg_positions
[0m19:24:29.609460 [info ] [Thread-1  ]: 1 of 14 START sql view model public.stg_portfolios ............................. [RUN]
[0m19:24:29.609925 [info ] [Thread-2  ]: 2 of 14 START sql view model public.stg_positions .............................. [RUN]
[0m19:24:29.610338 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_bain_analytics_public_raw, now model.bain_capital_analytics.stg_portfolios)
[0m19:24:29.610685 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly list_bain_analytics_public, now model.bain_capital_analytics.stg_positions)
[0m19:24:29.611007 [debug] [Thread-1  ]: Began compiling node model.bain_capital_analytics.stg_portfolios
[0m19:24:29.611302 [debug] [Thread-2  ]: Began compiling node model.bain_capital_analytics.stg_positions
[0m19:24:29.619217 [debug] [Thread-1  ]: Writing injected SQL for node "model.bain_capital_analytics.stg_portfolios"
[0m19:24:29.621814 [debug] [Thread-2  ]: Writing injected SQL for node "model.bain_capital_analytics.stg_positions"
[0m19:24:29.622560 [debug] [Thread-2  ]: Began executing node model.bain_capital_analytics.stg_positions
[0m19:24:29.622884 [debug] [Thread-1  ]: Began executing node model.bain_capital_analytics.stg_portfolios
[0m19:24:29.668525 [debug] [Thread-2  ]: Writing runtime sql for node "model.bain_capital_analytics.stg_positions"
[0m19:24:29.669747 [debug] [Thread-1  ]: Writing runtime sql for node "model.bain_capital_analytics.stg_portfolios"
[0m19:24:29.670617 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.stg_positions"
[0m19:24:29.670999 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.stg_portfolios"
[0m19:24:29.671314 [debug] [Thread-2  ]: On model.bain_capital_analytics.stg_positions: BEGIN
[0m19:24:29.671616 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_portfolios: BEGIN
[0m19:24:29.671917 [debug] [Thread-2  ]: Opening a new connection, currently in state closed
[0m19:24:29.672212 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m19:24:29.692750 [debug] [Thread-1  ]: SQL status: BEGIN in 0.020 seconds
[0m19:24:29.693188 [debug] [Thread-2  ]: SQL status: BEGIN in 0.021 seconds
[0m19:24:29.693498 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.stg_portfolios"
[0m19:24:29.693799 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.stg_positions"
[0m19:24:29.694141 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_portfolios: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_portfolios"} */

  create view "bain_analytics"."public"."stg_portfolios__dbt_tmp"
    
    
  as (
    -- Anti-pattern: unnecessary DISTINCT when source data is already unique
-- Anti-pattern: casting in every model instead of once upstream

select distinct
    cast(portfolio_id as varchar(10)) as portfolio_id,
    cast(portfolio_name as varchar(100)) as portfolio_name,
    cast(strategy as varchar(50)) as strategy,
    cast(inception_date as date) as inception_date,
    cast(fund_id as varchar(10)) as fund_id,
    cast(manager_name as varchar(100)) as manager_name,
    cast(is_active as boolean) as is_active,
    -- Anti-pattern: duplicated fiscal quarter logic (repeated in many models)
    case
        when extract(month from cast(inception_date as date)) between 1 and 3 then 'Q3'
        when extract(month from cast(inception_date as date)) between 4 and 6 then 'Q4'
        when extract(month from cast(inception_date as date)) between 7 and 9 then 'Q1'
        when extract(month from cast(inception_date as date)) between 10 and 12 then 'Q2'
    end as inception_fiscal_quarter
from "bain_analytics"."public_raw"."raw_portfolios"
where cast(is_active as boolean) = true
  );
[0m19:24:29.694514 [debug] [Thread-2  ]: On model.bain_capital_analytics.stg_positions: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_positions"} */

  create view "bain_analytics"."public"."stg_positions__dbt_tmp"
    
    
  as (
    -- Anti-pattern: unnecessary DISTINCT
-- Anti-pattern: no filtering or partitioning strategy

select distinct
    position_id,
    portfolio_id,
    instrument_id,
    cast(position_date as date) as position_date,
    cast(quantity as numeric(18,4)) as quantity,
    cast(market_value as numeric(18,2)) as market_value,
    cast(cost_basis as numeric(18,2)) as cost_basis,
    currency,
    -- Anti-pattern: computed column that could be done downstream
    cast(market_value as numeric(18,2)) - cast(cost_basis as numeric(18,2)) as unrealized_gain_loss,
    case
        when cast(cost_basis as numeric(18,2)) != 0
        then (cast(market_value as numeric(18,2)) - cast(cost_basis as numeric(18,2))) / abs(cast(cost_basis as numeric(18,2)))
        else 0
    end as unrealized_return_pct
from "bain_analytics"."public_raw"."raw_positions"
  );
[0m19:24:29.699524 [debug] [Thread-2  ]: SQL status: CREATE VIEW in 0.005 seconds
[0m19:24:29.699850 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.005 seconds
[0m19:24:29.706866 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.stg_positions"
[0m19:24:29.710242 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.stg_portfolios"
[0m19:24:29.710596 [debug] [Thread-2  ]: On model.bain_capital_analytics.stg_positions: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_positions"} */
alter table "bain_analytics"."public"."stg_positions" rename to "stg_positions__dbt_backup"
[0m19:24:29.710911 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_portfolios: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_portfolios"} */
alter table "bain_analytics"."public"."stg_portfolios" rename to "stg_portfolios__dbt_backup"
[0m19:24:29.712404 [debug] [Thread-2  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m19:24:29.712712 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m19:24:29.715426 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.stg_positions"
[0m19:24:29.718870 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.stg_portfolios"
[0m19:24:29.719198 [debug] [Thread-2  ]: On model.bain_capital_analytics.stg_positions: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_positions"} */
alter table "bain_analytics"."public"."stg_positions__dbt_tmp" rename to "stg_positions"
[0m19:24:29.719504 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_portfolios: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_portfolios"} */
alter table "bain_analytics"."public"."stg_portfolios__dbt_tmp" rename to "stg_portfolios"
[0m19:24:29.720816 [debug] [Thread-2  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m19:24:29.721108 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m19:24:29.736281 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_portfolios: COMMIT
[0m19:24:29.738710 [debug] [Thread-2  ]: On model.bain_capital_analytics.stg_positions: COMMIT
[0m19:24:29.739055 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.stg_portfolios"
[0m19:24:29.739378 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.stg_positions"
[0m19:24:29.739692 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_portfolios: COMMIT
[0m19:24:29.739996 [debug] [Thread-2  ]: On model.bain_capital_analytics.stg_positions: COMMIT
[0m19:24:29.741449 [debug] [Thread-2  ]: SQL status: COMMIT in 0.001 seconds
[0m19:24:29.741766 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m19:24:29.747158 [debug] [Thread-2  ]: Applying DROP to: "bain_analytics"."public"."stg_positions__dbt_backup"
[0m19:24:29.749569 [debug] [Thread-1  ]: Applying DROP to: "bain_analytics"."public"."stg_portfolios__dbt_backup"
[0m19:24:29.753010 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.stg_positions"
[0m19:24:29.753486 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.stg_portfolios"
[0m19:24:29.753803 [debug] [Thread-2  ]: On model.bain_capital_analytics.stg_positions: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_positions"} */
drop view if exists "bain_analytics"."public"."stg_positions__dbt_backup" cascade
[0m19:24:29.754114 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_portfolios: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_portfolios"} */
drop view if exists "bain_analytics"."public"."stg_portfolios__dbt_backup" cascade
[0m19:24:29.760920 [debug] [Thread-2  ]: SQL status: DROP VIEW in 0.006 seconds
[0m19:24:29.763173 [debug] [Thread-2  ]: On model.bain_capital_analytics.stg_positions: Close
[0m19:24:29.764869 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '017548fa-fe6a-4721-ae83-5bbb94d0ff42', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e986d30>]}
[0m19:24:29.765466 [info ] [Thread-2  ]: 2 of 14 OK created sql view model public.stg_positions ......................... [[32mCREATE VIEW[0m in 0.15s]
[0m19:24:29.765949 [debug] [Thread-2  ]: Finished running node model.bain_capital_analytics.stg_positions
[0m19:24:29.766518 [debug] [Thread-4  ]: Began running node test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c
[0m19:24:29.766872 [debug] [Thread-3  ]: Began running node test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1
[0m19:24:29.767225 [info ] [Thread-4  ]: 3 of 14 START test not_null_stg_positions_portfolio_id ......................... [RUN]
[0m19:24:29.767579 [debug] [Thread-2  ]: Began running node test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f
[0m19:24:29.767885 [info ] [Thread-3  ]: 4 of 14 START test not_null_stg_positions_position_id .......................... [RUN]
[0m19:24:29.768327 [debug] [Thread-4  ]: Acquiring new postgres connection 'test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c'
[0m19:24:29.768638 [info ] [Thread-2  ]: 5 of 14 START test unique_stg_positions_position_id ............................ [RUN]
[0m19:24:29.769029 [debug] [Thread-3  ]: Acquiring new postgres connection 'test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1'
[0m19:24:29.769348 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.015 seconds
[0m19:24:29.769657 [debug] [Thread-4  ]: Began compiling node test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c
[0m19:24:29.770010 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly model.bain_capital_analytics.stg_positions, now test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f)
[0m19:24:29.770318 [debug] [Thread-3  ]: Began compiling node test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1
[0m19:24:29.771343 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_portfolios: Close
[0m19:24:29.781790 [debug] [Thread-4  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c"
[0m19:24:29.782123 [debug] [Thread-2  ]: Began compiling node test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f
[0m19:24:29.785600 [debug] [Thread-3  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1"
[0m19:24:29.786237 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '017548fa-fe6a-4721-ae83-5bbb94d0ff42', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ea387f0>]}
[0m19:24:29.792567 [debug] [Thread-2  ]: Writing injected SQL for node "test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f"
[0m19:24:29.793258 [debug] [Thread-4  ]: Began executing node test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c
[0m19:24:29.793817 [info ] [Thread-1  ]: 1 of 14 OK created sql view model public.stg_portfolios ........................ [[32mCREATE VIEW[0m in 0.18s]
[0m19:24:29.809512 [debug] [Thread-4  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c"
[0m19:24:29.810147 [debug] [Thread-1  ]: Finished running node model.bain_capital_analytics.stg_portfolios
[0m19:24:29.810504 [debug] [Thread-2  ]: Began executing node test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f
[0m19:24:29.810834 [debug] [Thread-3  ]: Began executing node test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1
[0m19:24:29.813342 [debug] [Thread-2  ]: Writing runtime sql for node "test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f"
[0m19:24:29.815792 [debug] [Thread-3  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1"
[0m19:24:29.816138 [debug] [Thread-1  ]: Began running node test.bain_capital_analytics.not_null_stg_portfolios_fund_id.70b04d82bd
[0m19:24:29.816625 [debug] [Thread-4  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c"
[0m19:24:29.817099 [info ] [Thread-1  ]: 6 of 14 START test not_null_stg_portfolios_fund_id ............................. [RUN]
[0m19:24:29.817517 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c: BEGIN
[0m19:24:29.818029 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.bain_capital_analytics.stg_portfolios, now test.bain_capital_analytics.not_null_stg_portfolios_fund_id.70b04d82bd)
[0m19:24:29.818420 [debug] [Thread-3  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1"
[0m19:24:29.818723 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m19:24:29.819033 [debug] [Thread-2  ]: Using postgres connection "test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f"
[0m19:24:29.819338 [debug] [Thread-1  ]: Began compiling node test.bain_capital_analytics.not_null_stg_portfolios_fund_id.70b04d82bd
[0m19:24:29.819637 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1: BEGIN
[0m19:24:29.820049 [debug] [Thread-2  ]: On test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f: BEGIN
[0m19:24:29.823703 [debug] [Thread-1  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_stg_portfolios_fund_id.70b04d82bd"
[0m19:24:29.824025 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m19:24:29.824455 [debug] [Thread-2  ]: Opening a new connection, currently in state closed
[0m19:24:29.825483 [debug] [Thread-1  ]: Began executing node test.bain_capital_analytics.not_null_stg_portfolios_fund_id.70b04d82bd
[0m19:24:29.870583 [debug] [Thread-1  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_stg_portfolios_fund_id.70b04d82bd"
[0m19:24:29.871142 [debug] [Thread-3  ]: SQL status: BEGIN in 0.047 seconds
[0m19:24:29.871462 [debug] [Thread-3  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1"
[0m19:24:29.871781 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select position_id
from "bain_analytics"."public"."stg_positions"
where position_id is null



  
  
      
    ) dbt_internal_test
[0m19:24:29.872175 [debug] [Thread-2  ]: SQL status: BEGIN in 0.048 seconds
[0m19:24:29.872524 [debug] [Thread-4  ]: SQL status: BEGIN in 0.054 seconds
[0m19:24:29.872831 [debug] [Thread-2  ]: Using postgres connection "test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f"
[0m19:24:29.873160 [debug] [Thread-4  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c"
[0m19:24:29.873494 [debug] [Thread-2  ]: On test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

select
    position_id as unique_field,
    count(*) as n_records

from "bain_analytics"."public"."stg_positions"
where position_id is not null
group by position_id
having count(*) > 1



  
  
      
    ) dbt_internal_test
[0m19:24:29.873844 [debug] [Thread-1  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_portfolios_fund_id.70b04d82bd"
[0m19:24:29.874198 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select portfolio_id
from "bain_analytics"."public"."stg_positions"
where portfolio_id is null



  
  
      
    ) dbt_internal_test
[0m19:24:29.874530 [debug] [Thread-3  ]: SQL status: SELECT 1 in 0.002 seconds
[0m19:24:29.874863 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_stg_portfolios_fund_id.70b04d82bd: BEGIN
[0m19:24:29.877877 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1: ROLLBACK
[0m19:24:29.878253 [debug] [Thread-2  ]: SQL status: SELECT 1 in 0.004 seconds
[0m19:24:29.878574 [debug] [Thread-4  ]: SQL status: SELECT 1 in 0.003 seconds
[0m19:24:29.878874 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m19:24:29.880059 [debug] [Thread-2  ]: On test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f: ROLLBACK
[0m19:24:29.880380 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1: Close
[0m19:24:29.881399 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c: ROLLBACK
[0m19:24:29.882406 [debug] [Thread-2  ]: On test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f: Close
[0m19:24:29.882124 [info ] [Thread-3  ]: 4 of 14 PASS not_null_stg_positions_position_id ................................ [[32mPASS[0m in 0.11s]
[0m19:24:29.882850 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c: Close
[0m19:24:29.883321 [info ] [Thread-2  ]: 5 of 14 PASS unique_stg_positions_position_id .................................. [[32mPASS[0m in 0.11s]
[0m19:24:29.883777 [debug] [Thread-3  ]: Finished running node test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1
[0m19:24:29.884239 [debug] [Thread-2  ]: Finished running node test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f
[0m19:24:29.884656 [info ] [Thread-4  ]: 3 of 14 PASS not_null_stg_positions_portfolio_id ............................... [[32mPASS[0m in 0.12s]
[0m19:24:29.885025 [debug] [Thread-3  ]: Began running node test.bain_capital_analytics.not_null_stg_portfolios_portfolio_id.7126a480ec
[0m19:24:29.885433 [debug] [Thread-2  ]: Began running node test.bain_capital_analytics.relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_.2823f12709
[0m19:24:29.885907 [debug] [Thread-4  ]: Finished running node test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c
[0m19:24:29.886226 [info ] [Thread-3  ]: 7 of 14 START test not_null_stg_portfolios_portfolio_id ........................ [RUN]
[0m19:24:29.886564 [info ] [Thread-2  ]: 8 of 14 START test relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_  [RUN]
[0m19:24:29.886910 [debug] [Thread-4  ]: Began running node test.bain_capital_analytics.unique_stg_portfolios_portfolio_id.aa125b6658
[0m19:24:29.887260 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1, now test.bain_capital_analytics.not_null_stg_portfolios_portfolio_id.7126a480ec)
[0m19:24:29.887618 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f, now test.bain_capital_analytics.relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_.2823f12709)
[0m19:24:29.887943 [info ] [Thread-4  ]: 9 of 14 START test unique_stg_portfolios_portfolio_id .......................... [RUN]
[0m19:24:29.888260 [debug] [Thread-3  ]: Began compiling node test.bain_capital_analytics.not_null_stg_portfolios_portfolio_id.7126a480ec
[0m19:24:29.888560 [debug] [Thread-2  ]: Began compiling node test.bain_capital_analytics.relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_.2823f12709
[0m19:24:29.888870 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c, now test.bain_capital_analytics.unique_stg_portfolios_portfolio_id.aa125b6658)
[0m19:24:29.893080 [debug] [Thread-3  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_stg_portfolios_portfolio_id.7126a480ec"
[0m19:24:29.899757 [debug] [Thread-1  ]: SQL status: BEGIN in 0.021 seconds
[0m19:24:29.900472 [debug] [Thread-2  ]: Writing injected SQL for node "test.bain_capital_analytics.relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_.2823f12709"
[0m19:24:29.900810 [debug] [Thread-4  ]: Began compiling node test.bain_capital_analytics.unique_stg_portfolios_portfolio_id.aa125b6658
[0m19:24:29.901244 [debug] [Thread-1  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_portfolios_fund_id.70b04d82bd"
[0m19:24:29.904640 [debug] [Thread-4  ]: Writing injected SQL for node "test.bain_capital_analytics.unique_stg_portfolios_portfolio_id.aa125b6658"
[0m19:24:29.905032 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_stg_portfolios_fund_id.70b04d82bd: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_stg_portfolios_fund_id.70b04d82bd"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select fund_id
from "bain_analytics"."public"."stg_portfolios"
where fund_id is null



  
  
      
    ) dbt_internal_test
[0m19:24:29.905370 [debug] [Thread-3  ]: Began executing node test.bain_capital_analytics.not_null_stg_portfolios_portfolio_id.7126a480ec
[0m19:24:29.905722 [debug] [Thread-2  ]: Began executing node test.bain_capital_analytics.relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_.2823f12709
[0m19:24:29.908203 [debug] [Thread-3  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_stg_portfolios_portfolio_id.7126a480ec"
[0m19:24:29.908546 [debug] [Thread-4  ]: Began executing node test.bain_capital_analytics.unique_stg_portfolios_portfolio_id.aa125b6658
[0m19:24:29.910870 [debug] [Thread-2  ]: Writing runtime sql for node "test.bain_capital_analytics.relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_.2823f12709"
[0m19:24:29.911215 [debug] [Thread-1  ]: SQL status: SELECT 1 in 0.005 seconds
[0m19:24:29.914495 [debug] [Thread-4  ]: Writing runtime sql for node "test.bain_capital_analytics.unique_stg_portfolios_portfolio_id.aa125b6658"
[0m19:24:29.915828 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_stg_portfolios_fund_id.70b04d82bd: ROLLBACK
[0m19:24:29.916300 [debug] [Thread-3  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_portfolios_portfolio_id.7126a480ec"
[0m19:24:29.916649 [debug] [Thread-2  ]: Using postgres connection "test.bain_capital_analytics.relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_.2823f12709"
[0m19:24:29.916989 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_stg_portfolios_portfolio_id.7126a480ec: BEGIN
[0m19:24:29.917345 [debug] [Thread-2  ]: On test.bain_capital_analytics.relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_.2823f12709: BEGIN
[0m19:24:29.917629 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_stg_portfolios_fund_id.70b04d82bd: Close
[0m19:24:29.917946 [debug] [Thread-4  ]: Using postgres connection "test.bain_capital_analytics.unique_stg_portfolios_portfolio_id.aa125b6658"
[0m19:24:29.918238 [debug] [Thread-3  ]: Opening a new connection, currently in state closed
[0m19:24:29.918541 [debug] [Thread-2  ]: Opening a new connection, currently in state closed
[0m19:24:29.919032 [info ] [Thread-1  ]: 6 of 14 PASS not_null_stg_portfolios_fund_id ................................... [[32mPASS[0m in 0.10s]
[0m19:24:29.919351 [debug] [Thread-4  ]: On test.bain_capital_analytics.unique_stg_portfolios_portfolio_id.aa125b6658: BEGIN
[0m19:24:29.919982 [debug] [Thread-1  ]: Finished running node test.bain_capital_analytics.not_null_stg_portfolios_fund_id.70b04d82bd
[0m19:24:29.920279 [debug] [Thread-4  ]: Opening a new connection, currently in state closed
[0m19:24:29.932132 [debug] [Thread-2  ]: SQL status: BEGIN in 0.014 seconds
[0m19:24:29.932496 [debug] [Thread-3  ]: SQL status: BEGIN in 0.014 seconds
[0m19:24:29.932795 [debug] [Thread-2  ]: Using postgres connection "test.bain_capital_analytics.relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_.2823f12709"
[0m19:24:29.933077 [debug] [Thread-4  ]: SQL status: BEGIN in 0.013 seconds
[0m19:24:29.933377 [debug] [Thread-3  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_portfolios_portfolio_id.7126a480ec"
[0m19:24:29.933721 [debug] [Thread-2  ]: On test.bain_capital_analytics.relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_.2823f12709: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_.2823f12709"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

with child as (
    select portfolio_id as from_field
    from "bain_analytics"."public"."stg_positions"
    where portfolio_id is not null
),

parent as (
    select portfolio_id as to_field
    from "bain_analytics"."public"."stg_portfolios"
)

select
    from_field

from child
left join parent
    on child.from_field = parent.to_field

where parent.to_field is null



  
  
      
    ) dbt_internal_test
[0m19:24:29.934051 [debug] [Thread-4  ]: Using postgres connection "test.bain_capital_analytics.unique_stg_portfolios_portfolio_id.aa125b6658"
[0m19:24:29.934365 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_stg_portfolios_portfolio_id.7126a480ec: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_stg_portfolios_portfolio_id.7126a480ec"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select portfolio_id
from "bain_analytics"."public"."stg_portfolios"
where portfolio_id is null



  
  
      
    ) dbt_internal_test
[0m19:24:29.934739 [debug] [Thread-4  ]: On test.bain_capital_analytics.unique_stg_portfolios_portfolio_id.aa125b6658: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.unique_stg_portfolios_portfolio_id.aa125b6658"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

select
    portfolio_id as unique_field,
    count(*) as n_records

from "bain_analytics"."public"."stg_portfolios"
where portfolio_id is not null
group by portfolio_id
having count(*) > 1



  
  
      
    ) dbt_internal_test
[0m19:24:29.938046 [debug] [Thread-3  ]: SQL status: SELECT 1 in 0.003 seconds
[0m19:24:29.938346 [debug] [Thread-4  ]: SQL status: SELECT 1 in 0.003 seconds
[0m19:24:29.939533 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_stg_portfolios_portfolio_id.7126a480ec: ROLLBACK
[0m19:24:29.939853 [debug] [Thread-2  ]: SQL status: SELECT 1 in 0.005 seconds
[0m19:24:29.940954 [debug] [Thread-4  ]: On test.bain_capital_analytics.unique_stg_portfolios_portfolio_id.aa125b6658: ROLLBACK
[0m19:24:29.942090 [debug] [Thread-2  ]: On test.bain_capital_analytics.relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_.2823f12709: ROLLBACK
[0m19:24:29.942417 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_stg_portfolios_portfolio_id.7126a480ec: Close
[0m19:24:29.942974 [info ] [Thread-3  ]: 7 of 14 PASS not_null_stg_portfolios_portfolio_id .............................. [[32mPASS[0m in 0.06s]
[0m19:24:29.943310 [debug] [Thread-4  ]: On test.bain_capital_analytics.unique_stg_portfolios_portfolio_id.aa125b6658: Close
[0m19:24:29.943585 [debug] [Thread-2  ]: On test.bain_capital_analytics.relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_.2823f12709: Close
[0m19:24:29.943985 [debug] [Thread-3  ]: Finished running node test.bain_capital_analytics.not_null_stg_portfolios_portfolio_id.7126a480ec
[0m19:24:29.944425 [info ] [Thread-4  ]: 9 of 14 PASS unique_stg_portfolios_portfolio_id ................................ [[32mPASS[0m in 0.06s]
[0m19:24:29.944864 [info ] [Thread-2  ]: 8 of 14 PASS relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_  [[32mPASS[0m in 0.06s]
[0m19:24:29.945374 [debug] [Thread-4  ]: Finished running node test.bain_capital_analytics.unique_stg_portfolios_portfolio_id.aa125b6658
[0m19:24:29.945784 [debug] [Thread-2  ]: Finished running node test.bain_capital_analytics.relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_.2823f12709
[0m19:24:29.946374 [debug] [Thread-1  ]: Began running node model.bain_capital_analytics.fact_portfolio_summary
[0m19:24:29.946847 [info ] [Thread-1  ]: 10 of 14 START sql view model public.fact_portfolio_summary .................... [RUN]
[0m19:24:29.947225 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.not_null_stg_portfolios_fund_id.70b04d82bd, now model.bain_capital_analytics.fact_portfolio_summary)
[0m19:24:29.947553 [debug] [Thread-1  ]: Began compiling node model.bain_capital_analytics.fact_portfolio_summary
[0m19:24:29.950877 [debug] [Thread-1  ]: Writing injected SQL for node "model.bain_capital_analytics.fact_portfolio_summary"
[0m19:24:29.951468 [debug] [Thread-1  ]: Began executing node model.bain_capital_analytics.fact_portfolio_summary
[0m19:24:29.954826 [debug] [Thread-1  ]: Writing runtime sql for node "model.bain_capital_analytics.fact_portfolio_summary"
[0m19:24:29.955347 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.fact_portfolio_summary"
[0m19:24:29.955639 [debug] [Thread-1  ]: On model.bain_capital_analytics.fact_portfolio_summary: BEGIN
[0m19:24:29.955926 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m19:24:29.967379 [debug] [Thread-1  ]: SQL status: BEGIN in 0.011 seconds
[0m19:24:29.967707 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.fact_portfolio_summary"
[0m19:24:29.968058 [debug] [Thread-1  ]: On model.bain_capital_analytics.fact_portfolio_summary: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.fact_portfolio_summary"} */

  create view "bain_analytics"."public"."fact_portfolio_summary__dbt_tmp"
    
    
  as (
    -- Pipeline A: FACT table - Portfolio summary with positions
-- Anti-pattern: unnecessary DISTINCT on already-unique aggregation
-- Anti-pattern: late filtering (filters at the end instead of upstream)
-- Anti-pattern: materialized as view (should be table)

select distinct
    p.portfolio_id,
    p.portfolio_name,
    p.strategy,
    p.fund_id,
    p.manager_name,
    pos.position_date,
    count(distinct pos.instrument_id) as num_positions,
    sum(pos.market_value) as total_market_value,
    sum(pos.cost_basis) as total_cost_basis,
    sum(pos.unrealized_gain_loss) as total_unrealized_pnl,
    case
        when sum(pos.cost_basis) != 0
        then sum(pos.unrealized_gain_loss) / abs(sum(pos.cost_basis))
        else 0
    end as portfolio_return_pct,
    max(pos.market_value) as largest_position_mv,
    min(pos.market_value) as smallest_position_mv
from "bain_analytics"."public"."stg_portfolios" p
inner join "bain_analytics"."public"."stg_positions" pos
    on p.portfolio_id = pos.portfolio_id
-- Anti-pattern: filter at the end instead of in staging
where p.is_active = true
group by
    p.portfolio_id,
    p.portfolio_name,
    p.strategy,
    p.fund_id,
    p.manager_name,
    pos.position_date
  );
[0m19:24:29.975032 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.007 seconds
[0m19:24:29.978021 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.fact_portfolio_summary"
[0m19:24:29.978338 [debug] [Thread-1  ]: On model.bain_capital_analytics.fact_portfolio_summary: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.fact_portfolio_summary"} */
alter table "bain_analytics"."public"."fact_portfolio_summary__dbt_tmp" rename to "fact_portfolio_summary"
[0m19:24:29.979358 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m19:24:29.980343 [debug] [Thread-1  ]: On model.bain_capital_analytics.fact_portfolio_summary: COMMIT
[0m19:24:29.980650 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.fact_portfolio_summary"
[0m19:24:29.980931 [debug] [Thread-1  ]: On model.bain_capital_analytics.fact_portfolio_summary: COMMIT
[0m19:24:29.982292 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m19:24:29.984445 [debug] [Thread-1  ]: Applying DROP to: "bain_analytics"."public"."fact_portfolio_summary__dbt_backup"
[0m19:24:29.984910 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.fact_portfolio_summary"
[0m19:24:29.985210 [debug] [Thread-1  ]: On model.bain_capital_analytics.fact_portfolio_summary: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.fact_portfolio_summary"} */
drop view if exists "bain_analytics"."public"."fact_portfolio_summary__dbt_backup" cascade
[0m19:24:29.985946 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.000 seconds
[0m19:24:29.986931 [debug] [Thread-1  ]: On model.bain_capital_analytics.fact_portfolio_summary: Close
[0m19:24:29.987411 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '017548fa-fe6a-4721-ae83-5bbb94d0ff42', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10eae6550>]}
[0m19:24:29.987943 [info ] [Thread-1  ]: 10 of 14 OK created sql view model public.fact_portfolio_summary ............... [[32mCREATE VIEW[0m in 0.04s]
[0m19:24:29.988392 [debug] [Thread-1  ]: Finished running node model.bain_capital_analytics.fact_portfolio_summary
[0m19:24:29.988989 [debug] [Thread-4  ]: Began running node test.bain_capital_analytics.not_null_fact_portfolio_summary_portfolio_id.98891ba523
[0m19:24:29.989313 [debug] [Thread-2  ]: Began running node test.bain_capital_analytics.not_null_fact_portfolio_summary_position_date.f6861b4961
[0m19:24:29.989632 [info ] [Thread-4  ]: 11 of 14 START test not_null_fact_portfolio_summary_portfolio_id ............... [RUN]
[0m19:24:29.989998 [info ] [Thread-2  ]: 12 of 14 START test not_null_fact_portfolio_summary_position_date .............. [RUN]
[0m19:24:29.990397 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.unique_stg_portfolios_portfolio_id.aa125b6658, now test.bain_capital_analytics.not_null_fact_portfolio_summary_portfolio_id.98891ba523)
[0m19:24:29.990758 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_.2823f12709, now test.bain_capital_analytics.not_null_fact_portfolio_summary_position_date.f6861b4961)
[0m19:24:29.991140 [debug] [Thread-4  ]: Began compiling node test.bain_capital_analytics.not_null_fact_portfolio_summary_portfolio_id.98891ba523
[0m19:24:29.991449 [debug] [Thread-2  ]: Began compiling node test.bain_capital_analytics.not_null_fact_portfolio_summary_position_date.f6861b4961
[0m19:24:29.996261 [debug] [Thread-4  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_fact_portfolio_summary_portfolio_id.98891ba523"
[0m19:24:29.999502 [debug] [Thread-2  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_fact_portfolio_summary_position_date.f6861b4961"
[0m19:24:30.000161 [debug] [Thread-4  ]: Began executing node test.bain_capital_analytics.not_null_fact_portfolio_summary_portfolio_id.98891ba523
[0m19:24:30.000487 [debug] [Thread-2  ]: Began executing node test.bain_capital_analytics.not_null_fact_portfolio_summary_position_date.f6861b4961
[0m19:24:30.002722 [debug] [Thread-4  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_fact_portfolio_summary_portfolio_id.98891ba523"
[0m19:24:30.004825 [debug] [Thread-2  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_fact_portfolio_summary_position_date.f6861b4961"
[0m19:24:30.005403 [debug] [Thread-4  ]: Using postgres connection "test.bain_capital_analytics.not_null_fact_portfolio_summary_portfolio_id.98891ba523"
[0m19:24:30.005749 [debug] [Thread-2  ]: Using postgres connection "test.bain_capital_analytics.not_null_fact_portfolio_summary_position_date.f6861b4961"
[0m19:24:30.006047 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_fact_portfolio_summary_portfolio_id.98891ba523: BEGIN
[0m19:24:30.006347 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_fact_portfolio_summary_position_date.f6861b4961: BEGIN
[0m19:24:30.006646 [debug] [Thread-4  ]: Opening a new connection, currently in state closed
[0m19:24:30.006938 [debug] [Thread-2  ]: Opening a new connection, currently in state closed
[0m19:24:30.020595 [debug] [Thread-4  ]: SQL status: BEGIN in 0.014 seconds
[0m19:24:30.020929 [debug] [Thread-2  ]: SQL status: BEGIN in 0.014 seconds
[0m19:24:30.021238 [debug] [Thread-4  ]: Using postgres connection "test.bain_capital_analytics.not_null_fact_portfolio_summary_portfolio_id.98891ba523"
[0m19:24:30.021548 [debug] [Thread-2  ]: Using postgres connection "test.bain_capital_analytics.not_null_fact_portfolio_summary_position_date.f6861b4961"
[0m19:24:30.021865 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_fact_portfolio_summary_portfolio_id.98891ba523: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_fact_portfolio_summary_portfolio_id.98891ba523"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select portfolio_id
from "bain_analytics"."public"."fact_portfolio_summary"
where portfolio_id is null



  
  
      
    ) dbt_internal_test
[0m19:24:30.022189 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_fact_portfolio_summary_position_date.f6861b4961: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_fact_portfolio_summary_position_date.f6861b4961"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select position_date
from "bain_analytics"."public"."fact_portfolio_summary"
where position_date is null



  
  
      
    ) dbt_internal_test
[0m19:24:30.026814 [debug] [Thread-4  ]: SQL status: SELECT 1 in 0.004 seconds
[0m19:24:30.027166 [debug] [Thread-2  ]: SQL status: SELECT 1 in 0.005 seconds
[0m19:24:30.028551 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_fact_portfolio_summary_portfolio_id.98891ba523: ROLLBACK
[0m19:24:30.029618 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_fact_portfolio_summary_position_date.f6861b4961: ROLLBACK
[0m19:24:30.030324 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_fact_portfolio_summary_portfolio_id.98891ba523: Close
[0m19:24:30.030626 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_fact_portfolio_summary_position_date.f6861b4961: Close
[0m19:24:30.031127 [info ] [Thread-4  ]: 11 of 14 PASS not_null_fact_portfolio_summary_portfolio_id ..................... [[32mPASS[0m in 0.04s]
[0m19:24:30.031586 [info ] [Thread-2  ]: 12 of 14 PASS not_null_fact_portfolio_summary_position_date .................... [[32mPASS[0m in 0.04s]
[0m19:24:30.032023 [debug] [Thread-4  ]: Finished running node test.bain_capital_analytics.not_null_fact_portfolio_summary_portfolio_id.98891ba523
[0m19:24:30.032435 [debug] [Thread-2  ]: Finished running node test.bain_capital_analytics.not_null_fact_portfolio_summary_position_date.f6861b4961
[0m19:24:30.033085 [debug] [Thread-1  ]: Began running node model.bain_capital_analytics.report_portfolio_overview
[0m19:24:30.033515 [info ] [Thread-1  ]: 13 of 14 START sql view model public.report_portfolio_overview ................. [RUN]
[0m19:24:30.033884 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.bain_capital_analytics.fact_portfolio_summary, now model.bain_capital_analytics.report_portfolio_overview)
[0m19:24:30.034194 [debug] [Thread-1  ]: Began compiling node model.bain_capital_analytics.report_portfolio_overview
[0m19:24:30.037493 [debug] [Thread-1  ]: Writing injected SQL for node "model.bain_capital_analytics.report_portfolio_overview"
[0m19:24:30.038055 [debug] [Thread-1  ]: Began executing node model.bain_capital_analytics.report_portfolio_overview
[0m19:24:30.041590 [debug] [Thread-1  ]: Writing runtime sql for node "model.bain_capital_analytics.report_portfolio_overview"
[0m19:24:30.042178 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.report_portfolio_overview"
[0m19:24:30.042485 [debug] [Thread-1  ]: On model.bain_capital_analytics.report_portfolio_overview: BEGIN
[0m19:24:30.042779 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m19:24:30.055041 [debug] [Thread-1  ]: SQL status: BEGIN in 0.012 seconds
[0m19:24:30.055379 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.report_portfolio_overview"
[0m19:24:30.055722 [debug] [Thread-1  ]: On model.bain_capital_analytics.report_portfolio_overview: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.report_portfolio_overview"} */

  create view "bain_analytics"."public"."report_portfolio_overview__dbt_tmp"
    
    
  as (
    -- Pipeline A: REPORT table - Portfolio overview for management reporting
-- Anti-pattern: re-aggregates from fact instead of using fact directly in some cases
-- Anti-pattern: subquery instead of QUALIFY for latest date

select
    fps.portfolio_id,
    fps.portfolio_name,
    fps.strategy,
    fps.manager_name,
    fps.position_date as reporting_date,
    fps.num_positions,
    fps.total_market_value,
    fps.total_cost_basis,
    fps.total_unrealized_pnl,
    fps.portfolio_return_pct,
    fps.largest_position_mv,
    fps.smallest_position_mv,
    -- Anti-pattern: duplicated fiscal quarter logic AGAIN
    case
        when extract(month from fps.position_date) between 1 and 3 then 'Q3'
        when extract(month from fps.position_date) between 4 and 6 then 'Q4'
        when extract(month from fps.position_date) between 7 and 9 then 'Q1'
        when extract(month from fps.position_date) between 10 and 12 then 'Q2'
    end as fiscal_quarter,
    case
        when extract(month from fps.position_date) >= 7
        then extract(year from fps.position_date) + 1
        else extract(year from fps.position_date)
    end as fiscal_year
from "bain_analytics"."public"."fact_portfolio_summary" fps
where fps.position_date = (
    -- Anti-pattern: correlated subquery instead of window function / QUALIFY
    select max(fps2.position_date)
    from "bain_analytics"."public"."fact_portfolio_summary" fps2
    where fps2.portfolio_id = fps.portfolio_id
)
order by fps.total_market_value desc
  );
[0m19:24:30.062766 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.007 seconds
[0m19:24:30.067345 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.report_portfolio_overview"
[0m19:24:30.067660 [debug] [Thread-1  ]: On model.bain_capital_analytics.report_portfolio_overview: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.report_portfolio_overview"} */
alter table "bain_analytics"."public"."report_portfolio_overview__dbt_tmp" rename to "report_portfolio_overview"
[0m19:24:30.069205 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m19:24:30.070191 [debug] [Thread-1  ]: On model.bain_capital_analytics.report_portfolio_overview: COMMIT
[0m19:24:30.070497 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.report_portfolio_overview"
[0m19:24:30.070782 [debug] [Thread-1  ]: On model.bain_capital_analytics.report_portfolio_overview: COMMIT
[0m19:24:30.072310 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m19:24:30.074748 [debug] [Thread-1  ]: Applying DROP to: "bain_analytics"."public"."report_portfolio_overview__dbt_backup"
[0m19:24:30.075308 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.report_portfolio_overview"
[0m19:24:30.075611 [debug] [Thread-1  ]: On model.bain_capital_analytics.report_portfolio_overview: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.report_portfolio_overview"} */
drop view if exists "bain_analytics"."public"."report_portfolio_overview__dbt_backup" cascade
[0m19:24:30.076453 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.001 seconds
[0m19:24:30.077502 [debug] [Thread-1  ]: On model.bain_capital_analytics.report_portfolio_overview: Close
[0m19:24:30.078086 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '017548fa-fe6a-4721-ae83-5bbb94d0ff42', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e4fd220>]}
[0m19:24:30.078692 [info ] [Thread-1  ]: 13 of 14 OK created sql view model public.report_portfolio_overview ............ [[32mCREATE VIEW[0m in 0.04s]
[0m19:24:30.079166 [debug] [Thread-1  ]: Finished running node model.bain_capital_analytics.report_portfolio_overview
[0m19:24:30.079900 [debug] [Thread-4  ]: Began running node test.bain_capital_analytics.not_null_report_portfolio_overview_portfolio_id.4930122a4f
[0m19:24:30.080302 [info ] [Thread-4  ]: 14 of 14 START test not_null_report_portfolio_overview_portfolio_id ............ [RUN]
[0m19:24:30.080780 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.not_null_fact_portfolio_summary_portfolio_id.98891ba523, now test.bain_capital_analytics.not_null_report_portfolio_overview_portfolio_id.4930122a4f)
[0m19:24:30.081138 [debug] [Thread-4  ]: Began compiling node test.bain_capital_analytics.not_null_report_portfolio_overview_portfolio_id.4930122a4f
[0m19:24:30.085218 [debug] [Thread-4  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_report_portfolio_overview_portfolio_id.4930122a4f"
[0m19:24:30.086001 [debug] [Thread-4  ]: Began executing node test.bain_capital_analytics.not_null_report_portfolio_overview_portfolio_id.4930122a4f
[0m19:24:30.088442 [debug] [Thread-4  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_report_portfolio_overview_portfolio_id.4930122a4f"
[0m19:24:30.089041 [debug] [Thread-4  ]: Using postgres connection "test.bain_capital_analytics.not_null_report_portfolio_overview_portfolio_id.4930122a4f"
[0m19:24:30.089353 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_report_portfolio_overview_portfolio_id.4930122a4f: BEGIN
[0m19:24:30.089644 [debug] [Thread-4  ]: Opening a new connection, currently in state closed
[0m19:24:30.099350 [debug] [Thread-4  ]: SQL status: BEGIN in 0.010 seconds
[0m19:24:30.099815 [debug] [Thread-4  ]: Using postgres connection "test.bain_capital_analytics.not_null_report_portfolio_overview_portfolio_id.4930122a4f"
[0m19:24:30.100174 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_report_portfolio_overview_portfolio_id.4930122a4f: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_report_portfolio_overview_portfolio_id.4930122a4f"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select portfolio_id
from "bain_analytics"."public"."report_portfolio_overview"
where portfolio_id is null



  
  
      
    ) dbt_internal_test
[0m19:24:30.104983 [debug] [Thread-4  ]: SQL status: SELECT 1 in 0.004 seconds
[0m19:24:30.106561 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_report_portfolio_overview_portfolio_id.4930122a4f: ROLLBACK
[0m19:24:30.107219 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_report_portfolio_overview_portfolio_id.4930122a4f: Close
[0m19:24:30.107995 [info ] [Thread-4  ]: 14 of 14 PASS not_null_report_portfolio_overview_portfolio_id .................. [[32mPASS[0m in 0.03s]
[0m19:24:30.108502 [debug] [Thread-4  ]: Finished running node test.bain_capital_analytics.not_null_report_portfolio_overview_portfolio_id.4930122a4f
[0m19:24:30.109713 [debug] [MainThread]: Using postgres connection "master"
[0m19:24:30.110045 [debug] [MainThread]: On master: BEGIN
[0m19:24:30.110314 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m19:24:30.118824 [debug] [MainThread]: SQL status: BEGIN in 0.008 seconds
[0m19:24:30.119150 [debug] [MainThread]: On master: COMMIT
[0m19:24:30.119422 [debug] [MainThread]: Using postgres connection "master"
[0m19:24:30.119678 [debug] [MainThread]: On master: COMMIT
[0m19:24:30.120166 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m19:24:30.120430 [debug] [MainThread]: On master: Close
[0m19:24:30.120774 [debug] [MainThread]: Connection 'master' was properly closed.
[0m19:24:30.121017 [debug] [MainThread]: Connection 'model.bain_capital_analytics.report_portfolio_overview' was properly closed.
[0m19:24:30.121250 [debug] [MainThread]: Connection 'test.bain_capital_analytics.not_null_fact_portfolio_summary_position_date.f6861b4961' was properly closed.
[0m19:24:30.121477 [debug] [MainThread]: Connection 'test.bain_capital_analytics.not_null_report_portfolio_overview_portfolio_id.4930122a4f' was properly closed.
[0m19:24:30.121700 [debug] [MainThread]: Connection 'test.bain_capital_analytics.not_null_stg_portfolios_portfolio_id.7126a480ec' was properly closed.
[0m19:24:30.122036 [info ] [MainThread]: 
[0m19:24:30.122332 [info ] [MainThread]: Finished running 10 data tests, 4 view models in 0 hours 0 minutes and 0.69 seconds (0.69s).
[0m19:24:30.124314 [debug] [MainThread]: Command end result
[0m19:24:30.167779 [debug] [MainThread]: Wrote artifact WritableManifest to ./target/manifest.json
[0m19:24:30.169893 [debug] [MainThread]: Wrote artifact SemanticManifest to ./target/semantic_manifest.json
[0m19:24:30.176523 [debug] [MainThread]: Wrote artifact RunExecutionResult to ./target/run_results.json
[0m19:24:30.176826 [info ] [MainThread]: 
[0m19:24:30.177172 [info ] [MainThread]: [32mCompleted successfully[0m
[0m19:24:30.177454 [info ] [MainThread]: 
[0m19:24:30.177756 [info ] [MainThread]: Done. PASS=14 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=14
[0m19:24:30.180550 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 1.6522002, "process_in_blocks": "0", "process_kernel_time": 0.316983, "process_mem_max_rss": "138936320", "process_out_blocks": "0", "process_user_time": 2.584839}
[0m19:24:30.180915 [debug] [MainThread]: Command `dbt build` succeeded at 19:24:30.180840 after 1.65 seconds
[0m19:24:30.181273 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c122130>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10cf59220>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b6040a0>]}
[0m19:24:30.181629 [debug] [MainThread]: Flushing usage events
[0m19:24:31.756386 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m19:24:45.591981 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10bb891c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10cc36850>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10cc36670>]}


============================== 19:24:45.595894 | 061c5d81-79d9-4b19-b279-0314ee76b1d2 ==============================
[0m19:24:45.595894 [info ] [MainThread]: Running with dbt=1.11.0-b3
[0m19:24:45.596392 [debug] [MainThread]: running dbt with arguments {'target_path': 'None', 'printer_width': '80', 'quiet': 'False', 'send_anonymous_usage_stats': 'True', 'static_parser': 'True', 'introspect': 'True', 'empty': 'False', 'log_path': 'logs', 'version_check': 'True', 'write_json': 'True', 'use_colors': 'True', 'debug': 'False', 'log_cache_events': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'cache_selected_only': 'False', 'use_experimental_parser': 'False', 'no_print': 'None', 'invocation_command': 'dbt build --select tag:pipeline_a --profiles-dir . --project-dir .', 'warn_error': 'None', 'partial_parse': 'True', 'indirect_selection': 'eager', 'fail_fast': 'False', 'log_format': 'default', 'profiles_dir': '.'}
[0m19:24:45.795722 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '061c5d81-79d9-4b19-b279-0314ee76b1d2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10bcc9490>]}
[0m19:24:45.869736 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '061c5d81-79d9-4b19-b279-0314ee76b1d2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10be2cfd0>]}
[0m19:24:45.870663 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m19:24:45.976934 [debug] [MainThread]: checksum: e63134dccc1251cfb572caf0e4aa952f030c125ee3634f3bf2c0a2e1bb6ae349, vars: {}, profile: , target: , version: 1.11.0b3
[0m19:24:46.214207 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m19:24:46.214658 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m19:24:46.277877 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '061c5d81-79d9-4b19-b279-0314ee76b1d2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10dd94130>]}
[0m19:24:46.404490 [debug] [MainThread]: Wrote artifact WritableManifest to ./target/manifest.json
[0m19:24:46.406561 [debug] [MainThread]: Wrote artifact SemanticManifest to ./target/semantic_manifest.json
[0m19:24:46.441284 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '061c5d81-79d9-4b19-b279-0314ee76b1d2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10deae9d0>]}
[0m19:24:46.441834 [info ] [MainThread]: Found 28 models, 53 data tests, 10 seeds, 569 macros
[0m19:24:46.444458 [info ] [MainThread]: 
[0m19:24:46.444781 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m19:24:46.445034 [info ] [MainThread]: 
[0m19:24:46.445497 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m19:24:46.449565 [debug] [ThreadPool]: Acquiring new postgres connection 'list_bain_analytics'
[0m19:24:46.509410 [debug] [ThreadPool]: Using postgres connection "list_bain_analytics"
[0m19:24:46.509939 [debug] [ThreadPool]: On list_bain_analytics: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "connection_name": "list_bain_analytics"} */

    select distinct nspname from pg_namespace
  
[0m19:24:46.510257 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m19:24:46.544968 [debug] [ThreadPool]: SQL status: SELECT 5 in 0.035 seconds
[0m19:24:46.546395 [debug] [ThreadPool]: On list_bain_analytics: Close
[0m19:24:46.550083 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_bain_analytics, now list_bain_analytics_public)
[0m19:24:46.550584 [debug] [ThreadPool]: Acquiring new postgres connection 'list_bain_analytics_public_raw'
[0m19:24:46.556921 [debug] [ThreadPool]: Using postgres connection "list_bain_analytics_public"
[0m19:24:46.559816 [debug] [ThreadPool]: Using postgres connection "list_bain_analytics_public_raw"
[0m19:24:46.560256 [debug] [ThreadPool]: On list_bain_analytics_public: BEGIN
[0m19:24:46.560573 [debug] [ThreadPool]: On list_bain_analytics_public_raw: BEGIN
[0m19:24:46.560867 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:24:46.561115 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m19:24:46.574039 [debug] [ThreadPool]: SQL status: BEGIN in 0.013 seconds
[0m19:24:46.574311 [debug] [ThreadPool]: Using postgres connection "list_bain_analytics_public_raw"
[0m19:24:46.574605 [debug] [ThreadPool]: On list_bain_analytics_public_raw: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "connection_name": "list_bain_analytics_public_raw"} */
select
      'bain_analytics' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_raw'
    union all
    select
      'bain_analytics' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_raw'
    union all
    select
      'bain_analytics' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_raw'
  
[0m19:24:46.575606 [debug] [ThreadPool]: SQL status: BEGIN in 0.015 seconds
[0m19:24:46.575924 [debug] [ThreadPool]: Using postgres connection "list_bain_analytics_public"
[0m19:24:46.576214 [debug] [ThreadPool]: On list_bain_analytics_public: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "connection_name": "list_bain_analytics_public"} */
select
      'bain_analytics' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'bain_analytics' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'bain_analytics' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m19:24:46.579955 [debug] [ThreadPool]: SQL status: SELECT 10 in 0.005 seconds
[0m19:24:46.581288 [debug] [ThreadPool]: On list_bain_analytics_public_raw: ROLLBACK
[0m19:24:46.581607 [debug] [ThreadPool]: SQL status: SELECT 13 in 0.005 seconds
[0m19:24:46.582773 [debug] [ThreadPool]: On list_bain_analytics_public: ROLLBACK
[0m19:24:46.583040 [debug] [ThreadPool]: On list_bain_analytics_public_raw: Close
[0m19:24:46.584586 [debug] [ThreadPool]: On list_bain_analytics_public: Close
[0m19:24:46.592901 [debug] [MainThread]: Using postgres connection "master"
[0m19:24:46.593211 [debug] [MainThread]: On master: BEGIN
[0m19:24:46.593459 [debug] [MainThread]: Opening a new connection, currently in state init
[0m19:24:46.603357 [debug] [MainThread]: SQL status: BEGIN in 0.010 seconds
[0m19:24:46.603618 [debug] [MainThread]: Using postgres connection "master"
[0m19:24:46.603941 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "connection_name": "master"} */
select distinct
        dependent_namespace.nspname as dependent_schema,
        dependent_class.relname as dependent_name,
        referenced_namespace.nspname as referenced_schema,
        referenced_class.relname as referenced_name

    -- Query for views: views are entries in pg_class with an entry in pg_rewrite, but we avoid
    -- a seq scan on pg_rewrite by leveraging the fact there is an "internal" row in pg_depend for
    -- the view...
    from pg_class as dependent_class
    join pg_namespace as dependent_namespace on dependent_namespace.oid = dependent_class.relnamespace
    join pg_depend as dependent_depend on dependent_depend.refobjid = dependent_class.oid
        and dependent_depend.classid = 'pg_rewrite'::regclass
        and dependent_depend.refclassid = 'pg_class'::regclass
        and dependent_depend.deptype = 'i'

    -- ... and via pg_depend (that has a row per column, hence the need for "distinct" above, and
    -- making sure to exclude the internal row to avoid a view appearing to depend on itself)...
    join pg_depend as joining_depend on joining_depend.objid = dependent_depend.objid
        and joining_depend.classid = 'pg_rewrite'::regclass
        and joining_depend.refclassid = 'pg_class'::regclass
        and joining_depend.refobjid != dependent_depend.refobjid

    -- ... we can find the tables they query from in pg_class, but excluding system tables. Note we
    -- don't need need to exclude _dependent_ system tables, because they only query from other
    -- system tables, and so are automatically excluded by excluding _referenced_ system tables
    join pg_class as referenced_class on referenced_class.oid = joining_depend.refobjid
    join pg_namespace as referenced_namespace on referenced_namespace.oid = referenced_class.relnamespace
        and referenced_namespace.nspname != 'information_schema'
        and referenced_namespace.nspname not like 'pg\_%'

    order by
        dependent_schema, dependent_name, referenced_schema, referenced_name;
[0m19:24:46.609744 [debug] [MainThread]: SQL status: SELECT 15 in 0.005 seconds
[0m19:24:46.613006 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '061c5d81-79d9-4b19-b279-0314ee76b1d2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e26f4f0>]}
[0m19:24:46.613487 [debug] [MainThread]: On master: ROLLBACK
[0m19:24:46.614066 [debug] [MainThread]: Using postgres connection "master"
[0m19:24:46.614320 [debug] [MainThread]: On master: BEGIN
[0m19:24:46.615147 [debug] [MainThread]: SQL status: BEGIN in 0.001 seconds
[0m19:24:46.615396 [debug] [MainThread]: On master: COMMIT
[0m19:24:46.615641 [debug] [MainThread]: Using postgres connection "master"
[0m19:24:46.615874 [debug] [MainThread]: On master: COMMIT
[0m19:24:46.616441 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m19:24:46.616710 [debug] [MainThread]: On master: Close
[0m19:24:46.620020 [debug] [Thread-1  ]: Began running node model.bain_capital_analytics.stg_portfolios
[0m19:24:46.620369 [debug] [Thread-2  ]: Began running node model.bain_capital_analytics.stg_positions
[0m19:24:46.620830 [info ] [Thread-1  ]: 1 of 14 START sql view model public.stg_portfolios ............................. [RUN]
[0m19:24:46.621281 [info ] [Thread-2  ]: 2 of 14 START sql view model public.stg_positions .............................. [RUN]
[0m19:24:46.621679 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_bain_analytics_public, now model.bain_capital_analytics.stg_portfolios)
[0m19:24:46.622011 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly list_bain_analytics_public_raw, now model.bain_capital_analytics.stg_positions)
[0m19:24:46.622329 [debug] [Thread-1  ]: Began compiling node model.bain_capital_analytics.stg_portfolios
[0m19:24:46.622627 [debug] [Thread-2  ]: Began compiling node model.bain_capital_analytics.stg_positions
[0m19:24:46.630860 [debug] [Thread-1  ]: Writing injected SQL for node "model.bain_capital_analytics.stg_portfolios"
[0m19:24:46.633499 [debug] [Thread-2  ]: Writing injected SQL for node "model.bain_capital_analytics.stg_positions"
[0m19:24:46.634409 [debug] [Thread-2  ]: Began executing node model.bain_capital_analytics.stg_positions
[0m19:24:46.634746 [debug] [Thread-1  ]: Began executing node model.bain_capital_analytics.stg_portfolios
[0m19:24:46.681558 [debug] [Thread-2  ]: Writing runtime sql for node "model.bain_capital_analytics.stg_positions"
[0m19:24:46.682813 [debug] [Thread-1  ]: Writing runtime sql for node "model.bain_capital_analytics.stg_portfolios"
[0m19:24:46.683537 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.stg_positions"
[0m19:24:46.683933 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.stg_portfolios"
[0m19:24:46.684275 [debug] [Thread-2  ]: On model.bain_capital_analytics.stg_positions: BEGIN
[0m19:24:46.684580 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_portfolios: BEGIN
[0m19:24:46.684875 [debug] [Thread-2  ]: Opening a new connection, currently in state closed
[0m19:24:46.685167 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m19:24:46.700394 [debug] [Thread-2  ]: SQL status: BEGIN in 0.015 seconds
[0m19:24:46.700734 [debug] [Thread-1  ]: SQL status: BEGIN in 0.016 seconds
[0m19:24:46.701025 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.stg_positions"
[0m19:24:46.701327 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.stg_portfolios"
[0m19:24:46.701659 [debug] [Thread-2  ]: On model.bain_capital_analytics.stg_positions: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_positions"} */

  create view "bain_analytics"."public"."stg_positions__dbt_tmp"
    
    
  as (
    -- Anti-pattern: unnecessary DISTINCT
-- Anti-pattern: no filtering or partitioning strategy

select distinct
    position_id,
    portfolio_id,
    instrument_id,
    cast(position_date as date) as position_date,
    cast(quantity as numeric(18,4)) as quantity,
    cast(market_value as numeric(18,2)) as market_value,
    cast(cost_basis as numeric(18,2)) as cost_basis,
    currency,
    -- Anti-pattern: computed column that could be done downstream
    cast(market_value as numeric(18,2)) - cast(cost_basis as numeric(18,2)) as unrealized_gain_loss,
    case
        when cast(cost_basis as numeric(18,2)) != 0
        then (cast(market_value as numeric(18,2)) - cast(cost_basis as numeric(18,2))) / abs(cast(cost_basis as numeric(18,2)))
        else 0
    end as unrealized_return_pct
from "bain_analytics"."public_raw"."raw_positions"
  );
[0m19:24:46.702048 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_portfolios: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_portfolios"} */

  create view "bain_analytics"."public"."stg_portfolios__dbt_tmp"
    
    
  as (
    -- Anti-pattern: unnecessary DISTINCT when source data is already unique
-- Anti-pattern: casting in every model instead of once upstream

select distinct
    cast(portfolio_id as varchar(10)) as portfolio_id,
    cast(portfolio_name as varchar(100)) as portfolio_name,
    cast(strategy as varchar(50)) as strategy,
    cast(inception_date as date) as inception_date,
    cast(fund_id as varchar(10)) as fund_id,
    cast(manager_name as varchar(100)) as manager_name,
    cast(is_active as boolean) as is_active,
    -- Anti-pattern: duplicated fiscal quarter logic (repeated in many models)
    case
        when extract(month from cast(inception_date as date)) between 1 and 3 then 'Q3'
        when extract(month from cast(inception_date as date)) between 4 and 6 then 'Q4'
        when extract(month from cast(inception_date as date)) between 7 and 9 then 'Q1'
        when extract(month from cast(inception_date as date)) between 10 and 12 then 'Q2'
    end as inception_fiscal_quarter
from "bain_analytics"."public_raw"."raw_portfolios"
where cast(is_active as boolean) = true
  );
[0m19:24:46.707988 [debug] [Thread-2  ]: SQL status: CREATE VIEW in 0.006 seconds
[0m19:24:46.708324 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.006 seconds
[0m19:24:46.714504 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.stg_positions"
[0m19:24:46.717505 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.stg_portfolios"
[0m19:24:46.717832 [debug] [Thread-2  ]: On model.bain_capital_analytics.stg_positions: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_positions"} */
alter table "bain_analytics"."public"."stg_positions" rename to "stg_positions__dbt_backup"
[0m19:24:46.718149 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_portfolios: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_portfolios"} */
alter table "bain_analytics"."public"."stg_portfolios" rename to "stg_portfolios__dbt_backup"
[0m19:24:46.719547 [debug] [Thread-2  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m19:24:46.719855 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m19:24:46.722629 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.stg_positions"
[0m19:24:46.726132 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.stg_portfolios"
[0m19:24:46.726457 [debug] [Thread-2  ]: On model.bain_capital_analytics.stg_positions: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_positions"} */
alter table "bain_analytics"."public"."stg_positions__dbt_tmp" rename to "stg_positions"
[0m19:24:46.726762 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_portfolios: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_portfolios"} */
alter table "bain_analytics"."public"."stg_portfolios__dbt_tmp" rename to "stg_portfolios"
[0m19:24:46.728404 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m19:24:46.728710 [debug] [Thread-2  ]: SQL status: ALTER TABLE in 0.002 seconds
[0m19:24:46.742444 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_portfolios: COMMIT
[0m19:24:46.743515 [debug] [Thread-2  ]: On model.bain_capital_analytics.stg_positions: COMMIT
[0m19:24:46.743854 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.stg_portfolios"
[0m19:24:46.744162 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.stg_positions"
[0m19:24:46.744488 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_portfolios: COMMIT
[0m19:24:46.744807 [debug] [Thread-2  ]: On model.bain_capital_analytics.stg_positions: COMMIT
[0m19:24:46.748959 [debug] [Thread-2  ]: SQL status: COMMIT in 0.004 seconds
[0m19:24:46.749257 [debug] [Thread-1  ]: SQL status: COMMIT in 0.004 seconds
[0m19:24:46.754585 [debug] [Thread-2  ]: Applying DROP to: "bain_analytics"."public"."stg_positions__dbt_backup"
[0m19:24:46.756851 [debug] [Thread-1  ]: Applying DROP to: "bain_analytics"."public"."stg_portfolios__dbt_backup"
[0m19:24:46.760536 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.stg_positions"
[0m19:24:46.761038 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.stg_portfolios"
[0m19:24:46.761374 [debug] [Thread-2  ]: On model.bain_capital_analytics.stg_positions: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_positions"} */
drop view if exists "bain_analytics"."public"."stg_positions__dbt_backup" cascade
[0m19:24:46.761697 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_portfolios: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_portfolios"} */
drop view if exists "bain_analytics"."public"."stg_portfolios__dbt_backup" cascade
[0m19:24:46.771847 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.010 seconds
[0m19:24:46.774116 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_portfolios: Close
[0m19:24:46.775743 [debug] [Thread-2  ]: SQL status: DROP VIEW in 0.014 seconds
[0m19:24:46.776894 [debug] [Thread-2  ]: On model.bain_capital_analytics.stg_positions: Close
[0m19:24:46.777813 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '061c5d81-79d9-4b19-b279-0314ee76b1d2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b616940>]}
[0m19:24:46.778111 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '061c5d81-79d9-4b19-b279-0314ee76b1d2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e26f4f0>]}
[0m19:24:46.778802 [info ] [Thread-2  ]: 2 of 14 OK created sql view model public.stg_positions ......................... [[32mCREATE VIEW[0m in 0.16s]
[0m19:24:46.779277 [info ] [Thread-1  ]: 1 of 14 OK created sql view model public.stg_portfolios ........................ [[32mCREATE VIEW[0m in 0.15s]
[0m19:24:46.779751 [debug] [Thread-2  ]: Finished running node model.bain_capital_analytics.stg_positions
[0m19:24:46.780191 [debug] [Thread-1  ]: Finished running node model.bain_capital_analytics.stg_portfolios
[0m19:24:46.780969 [debug] [Thread-4  ]: Began running node test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c
[0m19:24:46.781347 [debug] [Thread-3  ]: Began running node test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1
[0m19:24:46.781720 [info ] [Thread-4  ]: 3 of 14 START test not_null_stg_positions_portfolio_id ......................... [RUN]
[0m19:24:46.782115 [debug] [Thread-2  ]: Began running node test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f
[0m19:24:46.782454 [info ] [Thread-3  ]: 4 of 14 START test not_null_stg_positions_position_id .......................... [RUN]
[0m19:24:46.782912 [debug] [Thread-1  ]: Began running node test.bain_capital_analytics.not_null_stg_portfolios_fund_id.70b04d82bd
[0m19:24:46.783579 [debug] [Thread-4  ]: Acquiring new postgres connection 'test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c'
[0m19:24:46.784120 [info ] [Thread-2  ]: 5 of 14 START test unique_stg_positions_position_id ............................ [RUN]
[0m19:24:46.784629 [debug] [Thread-3  ]: Acquiring new postgres connection 'test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1'
[0m19:24:46.784959 [info ] [Thread-1  ]: 6 of 14 START test not_null_stg_portfolios_fund_id ............................. [RUN]
[0m19:24:46.785386 [debug] [Thread-4  ]: Began compiling node test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c
[0m19:24:46.785777 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly model.bain_capital_analytics.stg_positions, now test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f)
[0m19:24:46.786105 [debug] [Thread-3  ]: Began compiling node test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1
[0m19:24:46.786425 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.bain_capital_analytics.stg_portfolios, now test.bain_capital_analytics.not_null_stg_portfolios_fund_id.70b04d82bd)
[0m19:24:46.797632 [debug] [Thread-4  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c"
[0m19:24:46.797988 [debug] [Thread-2  ]: Began compiling node test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f
[0m19:24:46.802831 [debug] [Thread-3  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1"
[0m19:24:46.803175 [debug] [Thread-1  ]: Began compiling node test.bain_capital_analytics.not_null_stg_portfolios_fund_id.70b04d82bd
[0m19:24:46.808703 [debug] [Thread-2  ]: Writing injected SQL for node "test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f"
[0m19:24:46.812242 [debug] [Thread-1  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_stg_portfolios_fund_id.70b04d82bd"
[0m19:24:46.812740 [debug] [Thread-4  ]: Began executing node test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c
[0m19:24:46.813126 [debug] [Thread-3  ]: Began executing node test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1
[0m19:24:46.828687 [debug] [Thread-4  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c"
[0m19:24:46.831232 [debug] [Thread-3  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1"
[0m19:24:46.831614 [debug] [Thread-1  ]: Began executing node test.bain_capital_analytics.not_null_stg_portfolios_fund_id.70b04d82bd
[0m19:24:46.831916 [debug] [Thread-2  ]: Began executing node test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f
[0m19:24:46.834389 [debug] [Thread-1  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_stg_portfolios_fund_id.70b04d82bd"
[0m19:24:46.902191 [debug] [Thread-2  ]: Writing runtime sql for node "test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f"
[0m19:24:46.902908 [debug] [Thread-4  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c"
[0m19:24:46.903281 [debug] [Thread-3  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1"
[0m19:24:46.903605 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c: BEGIN
[0m19:24:46.904007 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1: BEGIN
[0m19:24:46.904341 [debug] [Thread-2  ]: Using postgres connection "test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f"
[0m19:24:46.904677 [debug] [Thread-1  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_portfolios_fund_id.70b04d82bd"
[0m19:24:46.904964 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m19:24:46.905253 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m19:24:46.905546 [debug] [Thread-2  ]: On test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f: BEGIN
[0m19:24:46.905833 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_stg_portfolios_fund_id.70b04d82bd: BEGIN
[0m19:24:46.906361 [debug] [Thread-2  ]: Opening a new connection, currently in state closed
[0m19:24:46.906704 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m19:24:46.919911 [debug] [Thread-4  ]: SQL status: BEGIN in 0.015 seconds
[0m19:24:46.920335 [debug] [Thread-2  ]: SQL status: BEGIN in 0.014 seconds
[0m19:24:46.920703 [debug] [Thread-3  ]: SQL status: BEGIN in 0.015 seconds
[0m19:24:46.921003 [debug] [Thread-4  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c"
[0m19:24:46.921285 [debug] [Thread-1  ]: SQL status: BEGIN in 0.015 seconds
[0m19:24:46.921586 [debug] [Thread-2  ]: Using postgres connection "test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f"
[0m19:24:46.921889 [debug] [Thread-3  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1"
[0m19:24:46.922203 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select portfolio_id
from "bain_analytics"."public"."stg_positions"
where portfolio_id is null



  
  
      
    ) dbt_internal_test
[0m19:24:46.922513 [debug] [Thread-1  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_portfolios_fund_id.70b04d82bd"
[0m19:24:46.922823 [debug] [Thread-2  ]: On test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

select
    position_id as unique_field,
    count(*) as n_records

from "bain_analytics"."public"."stg_positions"
where position_id is not null
group by position_id
having count(*) > 1



  
  
      
    ) dbt_internal_test
[0m19:24:46.923151 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select position_id
from "bain_analytics"."public"."stg_positions"
where position_id is null



  
  
      
    ) dbt_internal_test
[0m19:24:46.923563 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_stg_portfolios_fund_id.70b04d82bd: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_stg_portfolios_fund_id.70b04d82bd"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select fund_id
from "bain_analytics"."public"."stg_portfolios"
where fund_id is null



  
  
      
    ) dbt_internal_test
[0m19:24:46.925205 [debug] [Thread-4  ]: SQL status: SELECT 1 in 0.002 seconds
[0m19:24:46.928162 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c: ROLLBACK
[0m19:24:46.928528 [debug] [Thread-2  ]: SQL status: SELECT 1 in 0.005 seconds
[0m19:24:46.928826 [debug] [Thread-3  ]: SQL status: SELECT 1 in 0.005 seconds
[0m19:24:46.929146 [debug] [Thread-1  ]: SQL status: SELECT 1 in 0.005 seconds
[0m19:24:46.929480 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c: Close
[0m19:24:46.930534 [debug] [Thread-2  ]: On test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f: ROLLBACK
[0m19:24:46.931549 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1: ROLLBACK
[0m19:24:46.932530 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_stg_portfolios_fund_id.70b04d82bd: ROLLBACK
[0m19:24:46.933066 [info ] [Thread-4  ]: 3 of 14 PASS not_null_stg_positions_portfolio_id ............................... [[32mPASS[0m in 0.15s]
[0m19:24:46.933661 [debug] [Thread-4  ]: Finished running node test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c
[0m19:24:46.933967 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1: Close
[0m19:24:46.934250 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_stg_portfolios_fund_id.70b04d82bd: Close
[0m19:24:46.934518 [debug] [Thread-2  ]: On test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f: Close
[0m19:24:46.934840 [debug] [Thread-4  ]: Began running node test.bain_capital_analytics.not_null_stg_portfolios_portfolio_id.7126a480ec
[0m19:24:46.935394 [info ] [Thread-3  ]: 4 of 14 PASS not_null_stg_positions_position_id ................................ [[32mPASS[0m in 0.15s]
[0m19:24:46.935872 [info ] [Thread-1  ]: 6 of 14 PASS not_null_stg_portfolios_fund_id ................................... [[32mPASS[0m in 0.15s]
[0m19:24:46.936316 [info ] [Thread-2  ]: 5 of 14 PASS unique_stg_positions_position_id .................................. [[32mPASS[0m in 0.15s]
[0m19:24:46.936778 [info ] [Thread-4  ]: 7 of 14 START test not_null_stg_portfolios_portfolio_id ........................ [RUN]
[0m19:24:46.937276 [debug] [Thread-3  ]: Finished running node test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1
[0m19:24:46.937695 [debug] [Thread-1  ]: Finished running node test.bain_capital_analytics.not_null_stg_portfolios_fund_id.70b04d82bd
[0m19:24:46.938096 [debug] [Thread-2  ]: Finished running node test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f
[0m19:24:46.938438 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c, now test.bain_capital_analytics.not_null_stg_portfolios_portfolio_id.7126a480ec)
[0m19:24:46.938774 [debug] [Thread-3  ]: Began running node test.bain_capital_analytics.relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_.2823f12709
[0m19:24:46.939135 [debug] [Thread-1  ]: Began running node test.bain_capital_analytics.unique_stg_portfolios_portfolio_id.aa125b6658
[0m19:24:46.939555 [debug] [Thread-4  ]: Began compiling node test.bain_capital_analytics.not_null_stg_portfolios_portfolio_id.7126a480ec
[0m19:24:46.939893 [info ] [Thread-3  ]: 8 of 14 START test relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_  [RUN]
[0m19:24:46.940222 [info ] [Thread-1  ]: 9 of 14 START test unique_stg_portfolios_portfolio_id .......................... [RUN]
[0m19:24:46.944405 [debug] [Thread-4  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_stg_portfolios_portfolio_id.7126a480ec"
[0m19:24:46.944786 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1, now test.bain_capital_analytics.relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_.2823f12709)
[0m19:24:46.945120 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.not_null_stg_portfolios_fund_id.70b04d82bd, now test.bain_capital_analytics.unique_stg_portfolios_portfolio_id.aa125b6658)
[0m19:24:46.945512 [debug] [Thread-3  ]: Began compiling node test.bain_capital_analytics.relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_.2823f12709
[0m19:24:46.945818 [debug] [Thread-1  ]: Began compiling node test.bain_capital_analytics.unique_stg_portfolios_portfolio_id.aa125b6658
[0m19:24:46.952844 [debug] [Thread-3  ]: Writing injected SQL for node "test.bain_capital_analytics.relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_.2823f12709"
[0m19:24:46.956311 [debug] [Thread-1  ]: Writing injected SQL for node "test.bain_capital_analytics.unique_stg_portfolios_portfolio_id.aa125b6658"
[0m19:24:46.956633 [debug] [Thread-4  ]: Began executing node test.bain_capital_analytics.not_null_stg_portfolios_portfolio_id.7126a480ec
[0m19:24:46.959192 [debug] [Thread-4  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_stg_portfolios_portfolio_id.7126a480ec"
[0m19:24:46.959635 [debug] [Thread-3  ]: Began executing node test.bain_capital_analytics.relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_.2823f12709
[0m19:24:46.959977 [debug] [Thread-1  ]: Began executing node test.bain_capital_analytics.unique_stg_portfolios_portfolio_id.aa125b6658
[0m19:24:46.963422 [debug] [Thread-3  ]: Writing runtime sql for node "test.bain_capital_analytics.relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_.2823f12709"
[0m19:24:46.965721 [debug] [Thread-1  ]: Writing runtime sql for node "test.bain_capital_analytics.unique_stg_portfolios_portfolio_id.aa125b6658"
[0m19:24:46.966092 [debug] [Thread-4  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_portfolios_portfolio_id.7126a480ec"
[0m19:24:46.966557 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_stg_portfolios_portfolio_id.7126a480ec: BEGIN
[0m19:24:46.966918 [debug] [Thread-4  ]: Opening a new connection, currently in state closed
[0m19:24:46.967366 [debug] [Thread-1  ]: Using postgres connection "test.bain_capital_analytics.unique_stg_portfolios_portfolio_id.aa125b6658"
[0m19:24:46.967705 [debug] [Thread-3  ]: Using postgres connection "test.bain_capital_analytics.relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_.2823f12709"
[0m19:24:46.968004 [debug] [Thread-1  ]: On test.bain_capital_analytics.unique_stg_portfolios_portfolio_id.aa125b6658: BEGIN
[0m19:24:46.968315 [debug] [Thread-3  ]: On test.bain_capital_analytics.relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_.2823f12709: BEGIN
[0m19:24:46.968626 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m19:24:46.968929 [debug] [Thread-3  ]: Opening a new connection, currently in state closed
[0m19:24:46.977866 [debug] [Thread-4  ]: SQL status: BEGIN in 0.011 seconds
[0m19:24:46.978300 [debug] [Thread-4  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_portfolios_portfolio_id.7126a480ec"
[0m19:24:46.978643 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_stg_portfolios_portfolio_id.7126a480ec: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_stg_portfolios_portfolio_id.7126a480ec"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select portfolio_id
from "bain_analytics"."public"."stg_portfolios"
where portfolio_id is null



  
  
      
    ) dbt_internal_test
[0m19:24:46.978985 [debug] [Thread-1  ]: SQL status: BEGIN in 0.010 seconds
[0m19:24:46.979330 [debug] [Thread-3  ]: SQL status: BEGIN in 0.010 seconds
[0m19:24:46.979695 [debug] [Thread-1  ]: Using postgres connection "test.bain_capital_analytics.unique_stg_portfolios_portfolio_id.aa125b6658"
[0m19:24:46.980024 [debug] [Thread-3  ]: Using postgres connection "test.bain_capital_analytics.relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_.2823f12709"
[0m19:24:46.980351 [debug] [Thread-1  ]: On test.bain_capital_analytics.unique_stg_portfolios_portfolio_id.aa125b6658: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.unique_stg_portfolios_portfolio_id.aa125b6658"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

select
    portfolio_id as unique_field,
    count(*) as n_records

from "bain_analytics"."public"."stg_portfolios"
where portfolio_id is not null
group by portfolio_id
having count(*) > 1



  
  
      
    ) dbt_internal_test
[0m19:24:46.980700 [debug] [Thread-3  ]: On test.bain_capital_analytics.relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_.2823f12709: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_.2823f12709"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

with child as (
    select portfolio_id as from_field
    from "bain_analytics"."public"."stg_positions"
    where portfolio_id is not null
),

parent as (
    select portfolio_id as to_field
    from "bain_analytics"."public"."stg_portfolios"
)

select
    from_field

from child
left join parent
    on child.from_field = parent.to_field

where parent.to_field is null



  
  
      
    ) dbt_internal_test
[0m19:24:46.981423 [debug] [Thread-4  ]: SQL status: SELECT 1 in 0.002 seconds
[0m19:24:46.982686 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_stg_portfolios_portfolio_id.7126a480ec: ROLLBACK
[0m19:24:46.983273 [debug] [Thread-1  ]: SQL status: SELECT 1 in 0.002 seconds
[0m19:24:46.983620 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_stg_portfolios_portfolio_id.7126a480ec: Close
[0m19:24:46.984775 [debug] [Thread-1  ]: On test.bain_capital_analytics.unique_stg_portfolios_portfolio_id.aa125b6658: ROLLBACK
[0m19:24:46.985117 [debug] [Thread-3  ]: SQL status: SELECT 1 in 0.004 seconds
[0m19:24:46.985614 [info ] [Thread-4  ]: 7 of 14 PASS not_null_stg_portfolios_portfolio_id .............................. [[32mPASS[0m in 0.05s]
[0m19:24:46.986756 [debug] [Thread-3  ]: On test.bain_capital_analytics.relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_.2823f12709: ROLLBACK
[0m19:24:46.987081 [debug] [Thread-1  ]: On test.bain_capital_analytics.unique_stg_portfolios_portfolio_id.aa125b6658: Close
[0m19:24:46.987525 [debug] [Thread-4  ]: Finished running node test.bain_capital_analytics.not_null_stg_portfolios_portfolio_id.7126a480ec
[0m19:24:46.988022 [info ] [Thread-1  ]: 9 of 14 PASS unique_stg_portfolios_portfolio_id ................................ [[32mPASS[0m in 0.04s]
[0m19:24:46.988334 [debug] [Thread-3  ]: On test.bain_capital_analytics.relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_.2823f12709: Close
[0m19:24:46.988867 [debug] [Thread-1  ]: Finished running node test.bain_capital_analytics.unique_stg_portfolios_portfolio_id.aa125b6658
[0m19:24:46.989369 [info ] [Thread-3  ]: 8 of 14 PASS relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_  [[32mPASS[0m in 0.04s]
[0m19:24:46.989895 [debug] [Thread-3  ]: Finished running node test.bain_capital_analytics.relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_.2823f12709
[0m19:24:46.990443 [debug] [Thread-2  ]: Began running node model.bain_capital_analytics.fact_portfolio_summary
[0m19:24:46.991034 [info ] [Thread-2  ]: 10 of 14 START sql view model public.fact_portfolio_summary .................... [RUN]
[0m19:24:46.991432 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f, now model.bain_capital_analytics.fact_portfolio_summary)
[0m19:24:46.991746 [debug] [Thread-2  ]: Began compiling node model.bain_capital_analytics.fact_portfolio_summary
[0m19:24:46.994967 [debug] [Thread-2  ]: Writing injected SQL for node "model.bain_capital_analytics.fact_portfolio_summary"
[0m19:24:46.995573 [debug] [Thread-2  ]: Began executing node model.bain_capital_analytics.fact_portfolio_summary
[0m19:24:46.998795 [debug] [Thread-2  ]: Writing runtime sql for node "model.bain_capital_analytics.fact_portfolio_summary"
[0m19:24:46.999306 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.fact_portfolio_summary"
[0m19:24:46.999600 [debug] [Thread-2  ]: On model.bain_capital_analytics.fact_portfolio_summary: BEGIN
[0m19:24:46.999885 [debug] [Thread-2  ]: Opening a new connection, currently in state closed
[0m19:24:47.008975 [debug] [Thread-2  ]: SQL status: BEGIN in 0.009 seconds
[0m19:24:47.009314 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.fact_portfolio_summary"
[0m19:24:47.009656 [debug] [Thread-2  ]: On model.bain_capital_analytics.fact_portfolio_summary: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.fact_portfolio_summary"} */

  create view "bain_analytics"."public"."fact_portfolio_summary__dbt_tmp"
    
    
  as (
    -- Pipeline A: FACT table - Portfolio summary with positions
-- Anti-pattern: unnecessary DISTINCT on already-unique aggregation
-- Anti-pattern: late filtering (filters at the end instead of upstream)
-- Anti-pattern: materialized as view (should be table)

select distinct
    p.portfolio_id,
    p.portfolio_name,
    p.strategy,
    p.fund_id,
    p.manager_name,
    pos.position_date,
    count(distinct pos.instrument_id) as num_positions,
    sum(pos.market_value) as total_market_value,
    sum(pos.cost_basis) as total_cost_basis,
    sum(pos.unrealized_gain_loss) as total_unrealized_pnl,
    case
        when sum(pos.cost_basis) != 0
        then sum(pos.unrealized_gain_loss) / abs(sum(pos.cost_basis))
        else 0
    end as portfolio_return_pct,
    max(pos.market_value) as largest_position_mv,
    min(pos.market_value) as smallest_position_mv
from "bain_analytics"."public"."stg_portfolios" p
inner join "bain_analytics"."public"."stg_positions" pos
    on p.portfolio_id = pos.portfolio_id
-- Anti-pattern: filter at the end instead of in staging
where p.is_active = true
group by
    p.portfolio_id,
    p.portfolio_name,
    p.strategy,
    p.fund_id,
    p.manager_name,
    pos.position_date
  );
[0m19:24:47.015291 [debug] [Thread-2  ]: SQL status: CREATE VIEW in 0.005 seconds
[0m19:24:47.018207 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.fact_portfolio_summary"
[0m19:24:47.018527 [debug] [Thread-2  ]: On model.bain_capital_analytics.fact_portfolio_summary: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.fact_portfolio_summary"} */
alter table "bain_analytics"."public"."fact_portfolio_summary__dbt_tmp" rename to "fact_portfolio_summary"
[0m19:24:47.019430 [debug] [Thread-2  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m19:24:47.020467 [debug] [Thread-2  ]: On model.bain_capital_analytics.fact_portfolio_summary: COMMIT
[0m19:24:47.020784 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.fact_portfolio_summary"
[0m19:24:47.021067 [debug] [Thread-2  ]: On model.bain_capital_analytics.fact_portfolio_summary: COMMIT
[0m19:24:47.022171 [debug] [Thread-2  ]: SQL status: COMMIT in 0.001 seconds
[0m19:24:47.024501 [debug] [Thread-2  ]: Applying DROP to: "bain_analytics"."public"."fact_portfolio_summary__dbt_backup"
[0m19:24:47.025018 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.fact_portfolio_summary"
[0m19:24:47.025326 [debug] [Thread-2  ]: On model.bain_capital_analytics.fact_portfolio_summary: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.fact_portfolio_summary"} */
drop view if exists "bain_analytics"."public"."fact_portfolio_summary__dbt_backup" cascade
[0m19:24:47.025920 [debug] [Thread-2  ]: SQL status: DROP VIEW in 0.000 seconds
[0m19:24:47.026953 [debug] [Thread-2  ]: On model.bain_capital_analytics.fact_portfolio_summary: Close
[0m19:24:47.027470 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '061c5d81-79d9-4b19-b279-0314ee76b1d2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e55d3d0>]}
[0m19:24:47.028024 [info ] [Thread-2  ]: 10 of 14 OK created sql view model public.fact_portfolio_summary ............... [[32mCREATE VIEW[0m in 0.04s]
[0m19:24:47.028490 [debug] [Thread-2  ]: Finished running node model.bain_capital_analytics.fact_portfolio_summary
[0m19:24:47.029142 [debug] [Thread-1  ]: Began running node test.bain_capital_analytics.not_null_fact_portfolio_summary_portfolio_id.98891ba523
[0m19:24:47.029474 [debug] [Thread-3  ]: Began running node test.bain_capital_analytics.not_null_fact_portfolio_summary_position_date.f6861b4961
[0m19:24:47.029824 [info ] [Thread-1  ]: 11 of 14 START test not_null_fact_portfolio_summary_portfolio_id ............... [RUN]
[0m19:24:47.030168 [info ] [Thread-3  ]: 12 of 14 START test not_null_fact_portfolio_summary_position_date .............. [RUN]
[0m19:24:47.030534 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.unique_stg_portfolios_portfolio_id.aa125b6658, now test.bain_capital_analytics.not_null_fact_portfolio_summary_portfolio_id.98891ba523)
[0m19:24:47.030889 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_.2823f12709, now test.bain_capital_analytics.not_null_fact_portfolio_summary_position_date.f6861b4961)
[0m19:24:47.031207 [debug] [Thread-1  ]: Began compiling node test.bain_capital_analytics.not_null_fact_portfolio_summary_portfolio_id.98891ba523
[0m19:24:47.031495 [debug] [Thread-3  ]: Began compiling node test.bain_capital_analytics.not_null_fact_portfolio_summary_position_date.f6861b4961
[0m19:24:47.036619 [debug] [Thread-1  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_fact_portfolio_summary_portfolio_id.98891ba523"
[0m19:24:47.039916 [debug] [Thread-3  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_fact_portfolio_summary_position_date.f6861b4961"
[0m19:24:47.040667 [debug] [Thread-3  ]: Began executing node test.bain_capital_analytics.not_null_fact_portfolio_summary_position_date.f6861b4961
[0m19:24:47.040986 [debug] [Thread-1  ]: Began executing node test.bain_capital_analytics.not_null_fact_portfolio_summary_portfolio_id.98891ba523
[0m19:24:47.043252 [debug] [Thread-3  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_fact_portfolio_summary_position_date.f6861b4961"
[0m19:24:47.045408 [debug] [Thread-1  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_fact_portfolio_summary_portfolio_id.98891ba523"
[0m19:24:47.045935 [debug] [Thread-3  ]: Using postgres connection "test.bain_capital_analytics.not_null_fact_portfolio_summary_position_date.f6861b4961"
[0m19:24:47.046246 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_fact_portfolio_summary_position_date.f6861b4961: BEGIN
[0m19:24:47.046551 [debug] [Thread-3  ]: Opening a new connection, currently in state closed
[0m19:24:47.046975 [debug] [Thread-1  ]: Using postgres connection "test.bain_capital_analytics.not_null_fact_portfolio_summary_portfolio_id.98891ba523"
[0m19:24:47.047273 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_fact_portfolio_summary_portfolio_id.98891ba523: BEGIN
[0m19:24:47.047549 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m19:24:47.057271 [debug] [Thread-3  ]: SQL status: BEGIN in 0.011 seconds
[0m19:24:47.057643 [debug] [Thread-1  ]: SQL status: BEGIN in 0.010 seconds
[0m19:24:47.057995 [debug] [Thread-3  ]: Using postgres connection "test.bain_capital_analytics.not_null_fact_portfolio_summary_position_date.f6861b4961"
[0m19:24:47.058302 [debug] [Thread-1  ]: Using postgres connection "test.bain_capital_analytics.not_null_fact_portfolio_summary_portfolio_id.98891ba523"
[0m19:24:47.058633 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_fact_portfolio_summary_position_date.f6861b4961: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_fact_portfolio_summary_position_date.f6861b4961"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select position_date
from "bain_analytics"."public"."fact_portfolio_summary"
where position_date is null



  
  
      
    ) dbt_internal_test
[0m19:24:47.058966 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_fact_portfolio_summary_portfolio_id.98891ba523: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_fact_portfolio_summary_portfolio_id.98891ba523"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select portfolio_id
from "bain_analytics"."public"."fact_portfolio_summary"
where portfolio_id is null



  
  
      
    ) dbt_internal_test
[0m19:24:47.063693 [debug] [Thread-1  ]: SQL status: SELECT 1 in 0.004 seconds
[0m19:24:47.063997 [debug] [Thread-3  ]: SQL status: SELECT 1 in 0.005 seconds
[0m19:24:47.065222 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_fact_portfolio_summary_portfolio_id.98891ba523: ROLLBACK
[0m19:24:47.066258 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_fact_portfolio_summary_position_date.f6861b4961: ROLLBACK
[0m19:24:47.067007 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_fact_portfolio_summary_portfolio_id.98891ba523: Close
[0m19:24:47.067317 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_fact_portfolio_summary_position_date.f6861b4961: Close
[0m19:24:47.067815 [info ] [Thread-1  ]: 11 of 14 PASS not_null_fact_portfolio_summary_portfolio_id ..................... [[32mPASS[0m in 0.04s]
[0m19:24:47.068277 [info ] [Thread-3  ]: 12 of 14 PASS not_null_fact_portfolio_summary_position_date .................... [[32mPASS[0m in 0.04s]
[0m19:24:47.068723 [debug] [Thread-1  ]: Finished running node test.bain_capital_analytics.not_null_fact_portfolio_summary_portfolio_id.98891ba523
[0m19:24:47.069132 [debug] [Thread-3  ]: Finished running node test.bain_capital_analytics.not_null_fact_portfolio_summary_position_date.f6861b4961
[0m19:24:47.069804 [debug] [Thread-2  ]: Began running node model.bain_capital_analytics.report_portfolio_overview
[0m19:24:47.070282 [info ] [Thread-2  ]: 13 of 14 START sql view model public.report_portfolio_overview ................. [RUN]
[0m19:24:47.070671 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly model.bain_capital_analytics.fact_portfolio_summary, now model.bain_capital_analytics.report_portfolio_overview)
[0m19:24:47.070996 [debug] [Thread-2  ]: Began compiling node model.bain_capital_analytics.report_portfolio_overview
[0m19:24:47.074400 [debug] [Thread-2  ]: Writing injected SQL for node "model.bain_capital_analytics.report_portfolio_overview"
[0m19:24:47.074961 [debug] [Thread-2  ]: Began executing node model.bain_capital_analytics.report_portfolio_overview
[0m19:24:47.079604 [debug] [Thread-2  ]: Writing runtime sql for node "model.bain_capital_analytics.report_portfolio_overview"
[0m19:24:47.080129 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.report_portfolio_overview"
[0m19:24:47.080422 [debug] [Thread-2  ]: On model.bain_capital_analytics.report_portfolio_overview: BEGIN
[0m19:24:47.080701 [debug] [Thread-2  ]: Opening a new connection, currently in state closed
[0m19:24:47.090012 [debug] [Thread-2  ]: SQL status: BEGIN in 0.009 seconds
[0m19:24:47.090322 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.report_portfolio_overview"
[0m19:24:47.090667 [debug] [Thread-2  ]: On model.bain_capital_analytics.report_portfolio_overview: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.report_portfolio_overview"} */

  create view "bain_analytics"."public"."report_portfolio_overview__dbt_tmp"
    
    
  as (
    -- Pipeline A: REPORT table - Portfolio overview for management reporting
-- Anti-pattern: re-aggregates from fact instead of using fact directly in some cases
-- Anti-pattern: subquery instead of QUALIFY for latest date

select
    fps.portfolio_id,
    fps.portfolio_name,
    fps.strategy,
    fps.manager_name,
    fps.position_date as reporting_date,
    fps.num_positions,
    fps.total_market_value,
    fps.total_cost_basis,
    fps.total_unrealized_pnl,
    fps.portfolio_return_pct,
    fps.largest_position_mv,
    fps.smallest_position_mv,
    -- Anti-pattern: duplicated fiscal quarter logic AGAIN
    case
        when extract(month from fps.position_date) between 1 and 3 then 'Q3'
        when extract(month from fps.position_date) between 4 and 6 then 'Q4'
        when extract(month from fps.position_date) between 7 and 9 then 'Q1'
        when extract(month from fps.position_date) between 10 and 12 then 'Q2'
    end as fiscal_quarter,
    case
        when extract(month from fps.position_date) >= 7
        then extract(year from fps.position_date) + 1
        else extract(year from fps.position_date)
    end as fiscal_year
from "bain_analytics"."public"."fact_portfolio_summary" fps
where fps.position_date = (
    -- Anti-pattern: correlated subquery instead of window function / QUALIFY
    select max(fps2.position_date)
    from "bain_analytics"."public"."fact_portfolio_summary" fps2
    where fps2.portfolio_id = fps.portfolio_id
)
order by fps.total_market_value desc
  );
[0m19:24:47.096403 [debug] [Thread-2  ]: SQL status: CREATE VIEW in 0.005 seconds
[0m19:24:47.099159 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.report_portfolio_overview"
[0m19:24:47.099550 [debug] [Thread-2  ]: On model.bain_capital_analytics.report_portfolio_overview: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.report_portfolio_overview"} */
alter table "bain_analytics"."public"."report_portfolio_overview__dbt_tmp" rename to "report_portfolio_overview"
[0m19:24:47.100743 [debug] [Thread-2  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m19:24:47.101753 [debug] [Thread-2  ]: On model.bain_capital_analytics.report_portfolio_overview: COMMIT
[0m19:24:47.102065 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.report_portfolio_overview"
[0m19:24:47.102351 [debug] [Thread-2  ]: On model.bain_capital_analytics.report_portfolio_overview: COMMIT
[0m19:24:47.103370 [debug] [Thread-2  ]: SQL status: COMMIT in 0.001 seconds
[0m19:24:47.105570 [debug] [Thread-2  ]: Applying DROP to: "bain_analytics"."public"."report_portfolio_overview__dbt_backup"
[0m19:24:47.106032 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.report_portfolio_overview"
[0m19:24:47.106338 [debug] [Thread-2  ]: On model.bain_capital_analytics.report_portfolio_overview: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.report_portfolio_overview"} */
drop view if exists "bain_analytics"."public"."report_portfolio_overview__dbt_backup" cascade
[0m19:24:47.106952 [debug] [Thread-2  ]: SQL status: DROP VIEW in 0.000 seconds
[0m19:24:47.108010 [debug] [Thread-2  ]: On model.bain_capital_analytics.report_portfolio_overview: Close
[0m19:24:47.108500 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '061c5d81-79d9-4b19-b279-0314ee76b1d2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e4fe220>]}
[0m19:24:47.109040 [info ] [Thread-2  ]: 13 of 14 OK created sql view model public.report_portfolio_overview ............ [[32mCREATE VIEW[0m in 0.04s]
[0m19:24:47.109495 [debug] [Thread-2  ]: Finished running node model.bain_capital_analytics.report_portfolio_overview
[0m19:24:47.110068 [debug] [Thread-1  ]: Began running node test.bain_capital_analytics.not_null_report_portfolio_overview_portfolio_id.4930122a4f
[0m19:24:47.110397 [info ] [Thread-1  ]: 14 of 14 START test not_null_report_portfolio_overview_portfolio_id ............ [RUN]
[0m19:24:47.110748 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.not_null_fact_portfolio_summary_portfolio_id.98891ba523, now test.bain_capital_analytics.not_null_report_portfolio_overview_portfolio_id.4930122a4f)
[0m19:24:47.111054 [debug] [Thread-1  ]: Began compiling node test.bain_capital_analytics.not_null_report_portfolio_overview_portfolio_id.4930122a4f
[0m19:24:47.114599 [debug] [Thread-1  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_report_portfolio_overview_portfolio_id.4930122a4f"
[0m19:24:47.115097 [debug] [Thread-1  ]: Began executing node test.bain_capital_analytics.not_null_report_portfolio_overview_portfolio_id.4930122a4f
[0m19:24:47.117305 [debug] [Thread-1  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_report_portfolio_overview_portfolio_id.4930122a4f"
[0m19:24:47.117790 [debug] [Thread-1  ]: Using postgres connection "test.bain_capital_analytics.not_null_report_portfolio_overview_portfolio_id.4930122a4f"
[0m19:24:47.118076 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_report_portfolio_overview_portfolio_id.4930122a4f: BEGIN
[0m19:24:47.118353 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m19:24:47.128555 [debug] [Thread-1  ]: SQL status: BEGIN in 0.010 seconds
[0m19:24:47.128863 [debug] [Thread-1  ]: Using postgres connection "test.bain_capital_analytics.not_null_report_portfolio_overview_portfolio_id.4930122a4f"
[0m19:24:47.129164 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_report_portfolio_overview_portfolio_id.4930122a4f: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_report_portfolio_overview_portfolio_id.4930122a4f"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select portfolio_id
from "bain_analytics"."public"."report_portfolio_overview"
where portfolio_id is null



  
  
      
    ) dbt_internal_test
[0m19:24:47.134962 [debug] [Thread-1  ]: SQL status: SELECT 1 in 0.005 seconds
[0m19:24:47.136110 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_report_portfolio_overview_portfolio_id.4930122a4f: ROLLBACK
[0m19:24:47.136687 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_report_portfolio_overview_portfolio_id.4930122a4f: Close
[0m19:24:47.137151 [info ] [Thread-1  ]: 14 of 14 PASS not_null_report_portfolio_overview_portfolio_id .................. [[32mPASS[0m in 0.03s]
[0m19:24:47.137599 [debug] [Thread-1  ]: Finished running node test.bain_capital_analytics.not_null_report_portfolio_overview_portfolio_id.4930122a4f
[0m19:24:47.138538 [debug] [MainThread]: Using postgres connection "master"
[0m19:24:47.138808 [debug] [MainThread]: On master: BEGIN
[0m19:24:47.139049 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m19:24:47.148073 [debug] [MainThread]: SQL status: BEGIN in 0.009 seconds
[0m19:24:47.148421 [debug] [MainThread]: On master: COMMIT
[0m19:24:47.148680 [debug] [MainThread]: Using postgres connection "master"
[0m19:24:47.148926 [debug] [MainThread]: On master: COMMIT
[0m19:24:47.149477 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m19:24:47.149736 [debug] [MainThread]: On master: Close
[0m19:24:47.150092 [debug] [MainThread]: Connection 'master' was properly closed.
[0m19:24:47.150334 [debug] [MainThread]: Connection 'test.bain_capital_analytics.not_null_report_portfolio_overview_portfolio_id.4930122a4f' was properly closed.
[0m19:24:47.150563 [debug] [MainThread]: Connection 'model.bain_capital_analytics.report_portfolio_overview' was properly closed.
[0m19:24:47.150792 [debug] [MainThread]: Connection 'test.bain_capital_analytics.not_null_stg_portfolios_portfolio_id.7126a480ec' was properly closed.
[0m19:24:47.151012 [debug] [MainThread]: Connection 'test.bain_capital_analytics.not_null_fact_portfolio_summary_position_date.f6861b4961' was properly closed.
[0m19:24:47.151346 [info ] [MainThread]: 
[0m19:24:47.151632 [info ] [MainThread]: Finished running 10 data tests, 4 view models in 0 hours 0 minutes and 0.71 seconds (0.71s).
[0m19:24:47.153564 [debug] [MainThread]: Command end result
[0m19:24:47.198122 [debug] [MainThread]: Wrote artifact WritableManifest to ./target/manifest.json
[0m19:24:47.199910 [debug] [MainThread]: Wrote artifact SemanticManifest to ./target/semantic_manifest.json
[0m19:24:47.206295 [debug] [MainThread]: Wrote artifact RunExecutionResult to ./target/run_results.json
[0m19:24:47.206588 [info ] [MainThread]: 
[0m19:24:47.206933 [info ] [MainThread]: [32mCompleted successfully[0m
[0m19:24:47.207211 [info ] [MainThread]: 
[0m19:24:47.207498 [info ] [MainThread]: Done. PASS=14 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=14
[0m19:24:47.210370 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 1.7004031, "process_in_blocks": "0", "process_kernel_time": 0.323445, "process_mem_max_rss": "138493952", "process_out_blocks": "0", "process_user_time": 2.615403}
[0m19:24:47.210732 [debug] [MainThread]: Command `dbt build` succeeded at 19:24:47.210662 after 1.70 seconds
[0m19:24:47.211055 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10bb891c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10be2cfd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10be68280>]}
[0m19:24:47.211386 [debug] [MainThread]: Flushing usage events
[0m19:24:49.736566 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m19:24:51.347824 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108676160>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109722730>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109722550>]}


============================== 19:24:51.351756 | 11234c95-e197-4418-bde7-98b392860bc9 ==============================
[0m19:24:51.351756 [info ] [MainThread]: Running with dbt=1.11.0-b3
[0m19:24:51.352281 [debug] [MainThread]: running dbt with arguments {'static_parser': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'write_json': 'True', 'no_print': 'None', 'log_format': 'default', 'profiles_dir': '.', 'indirect_selection': 'eager', 'introspect': 'True', 'printer_width': '80', 'version_check': 'True', 'debug': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'log_path': 'logs', 'invocation_command': 'dbt build --select tag:pipeline_b --profiles-dir . --project-dir .', 'empty': 'False', 'fail_fast': 'False', 'target_path': 'None', 'quiet': 'False', 'send_anonymous_usage_stats': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'log_cache_events': 'False', 'warn_error': 'None'}
[0m19:24:51.547165 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '11234c95-e197-4418-bde7-98b392860bc9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109e5a190>]}
[0m19:24:51.621723 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '11234c95-e197-4418-bde7-98b392860bc9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109cd8c10>]}
[0m19:24:51.622601 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m19:24:51.727450 [debug] [MainThread]: checksum: e63134dccc1251cfb572caf0e4aa952f030c125ee3634f3bf2c0a2e1bb6ae349, vars: {}, profile: , target: , version: 1.11.0b3
[0m19:24:51.962026 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m19:24:51.962615 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m19:24:52.027321 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '11234c95-e197-4418-bde7-98b392860bc9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a880130>]}
[0m19:24:52.153235 [debug] [MainThread]: Wrote artifact WritableManifest to ./target/manifest.json
[0m19:24:52.155413 [debug] [MainThread]: Wrote artifact SemanticManifest to ./target/semantic_manifest.json
[0m19:24:52.185962 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '11234c95-e197-4418-bde7-98b392860bc9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a863520>]}
[0m19:24:52.186480 [info ] [MainThread]: Found 28 models, 53 data tests, 10 seeds, 569 macros
[0m19:24:52.189733 [info ] [MainThread]: 
[0m19:24:52.190038 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m19:24:52.190290 [info ] [MainThread]: 
[0m19:24:52.190692 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m19:24:52.195130 [debug] [ThreadPool]: Acquiring new postgres connection 'list_bain_analytics'
[0m19:24:52.237489 [debug] [ThreadPool]: Using postgres connection "list_bain_analytics"
[0m19:24:52.237874 [debug] [ThreadPool]: On list_bain_analytics: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "connection_name": "list_bain_analytics"} */

    select distinct nspname from pg_namespace
  
[0m19:24:52.238133 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m19:24:52.269748 [debug] [ThreadPool]: SQL status: SELECT 5 in 0.032 seconds
[0m19:24:52.270818 [debug] [ThreadPool]: On list_bain_analytics: Close
[0m19:24:52.274019 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_bain_analytics, now list_bain_analytics_public)
[0m19:24:52.279638 [debug] [ThreadPool]: Using postgres connection "list_bain_analytics_public"
[0m19:24:52.280063 [debug] [ThreadPool]: Acquiring new postgres connection 'list_bain_analytics_public_raw'
[0m19:24:52.280371 [debug] [ThreadPool]: On list_bain_analytics_public: BEGIN
[0m19:24:52.282714 [debug] [ThreadPool]: Using postgres connection "list_bain_analytics_public_raw"
[0m19:24:52.282979 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:24:52.283242 [debug] [ThreadPool]: On list_bain_analytics_public_raw: BEGIN
[0m19:24:52.283622 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m19:24:52.297670 [debug] [ThreadPool]: SQL status: BEGIN in 0.014 seconds
[0m19:24:52.298042 [debug] [ThreadPool]: SQL status: BEGIN in 0.015 seconds
[0m19:24:52.298350 [debug] [ThreadPool]: Using postgres connection "list_bain_analytics_public_raw"
[0m19:24:52.298647 [debug] [ThreadPool]: Using postgres connection "list_bain_analytics_public"
[0m19:24:52.298947 [debug] [ThreadPool]: On list_bain_analytics_public_raw: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "connection_name": "list_bain_analytics_public_raw"} */
select
      'bain_analytics' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_raw'
    union all
    select
      'bain_analytics' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_raw'
    union all
    select
      'bain_analytics' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_raw'
  
[0m19:24:52.299259 [debug] [ThreadPool]: On list_bain_analytics_public: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "connection_name": "list_bain_analytics_public"} */
select
      'bain_analytics' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'bain_analytics' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'bain_analytics' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m19:24:52.304857 [debug] [ThreadPool]: SQL status: SELECT 13 in 0.005 seconds
[0m19:24:52.305142 [debug] [ThreadPool]: SQL status: SELECT 10 in 0.006 seconds
[0m19:24:52.306391 [debug] [ThreadPool]: On list_bain_analytics_public: ROLLBACK
[0m19:24:52.307455 [debug] [ThreadPool]: On list_bain_analytics_public_raw: ROLLBACK
[0m19:24:52.308168 [debug] [ThreadPool]: On list_bain_analytics_public_raw: Close
[0m19:24:52.308447 [debug] [ThreadPool]: On list_bain_analytics_public: Close
[0m19:24:52.317325 [debug] [MainThread]: Using postgres connection "master"
[0m19:24:52.317654 [debug] [MainThread]: On master: BEGIN
[0m19:24:52.317911 [debug] [MainThread]: Opening a new connection, currently in state init
[0m19:24:52.328866 [debug] [MainThread]: SQL status: BEGIN in 0.011 seconds
[0m19:24:52.329136 [debug] [MainThread]: Using postgres connection "master"
[0m19:24:52.329454 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "connection_name": "master"} */
select distinct
        dependent_namespace.nspname as dependent_schema,
        dependent_class.relname as dependent_name,
        referenced_namespace.nspname as referenced_schema,
        referenced_class.relname as referenced_name

    -- Query for views: views are entries in pg_class with an entry in pg_rewrite, but we avoid
    -- a seq scan on pg_rewrite by leveraging the fact there is an "internal" row in pg_depend for
    -- the view...
    from pg_class as dependent_class
    join pg_namespace as dependent_namespace on dependent_namespace.oid = dependent_class.relnamespace
    join pg_depend as dependent_depend on dependent_depend.refobjid = dependent_class.oid
        and dependent_depend.classid = 'pg_rewrite'::regclass
        and dependent_depend.refclassid = 'pg_class'::regclass
        and dependent_depend.deptype = 'i'

    -- ... and via pg_depend (that has a row per column, hence the need for "distinct" above, and
    -- making sure to exclude the internal row to avoid a view appearing to depend on itself)...
    join pg_depend as joining_depend on joining_depend.objid = dependent_depend.objid
        and joining_depend.classid = 'pg_rewrite'::regclass
        and joining_depend.refclassid = 'pg_class'::regclass
        and joining_depend.refobjid != dependent_depend.refobjid

    -- ... we can find the tables they query from in pg_class, but excluding system tables. Note we
    -- don't need need to exclude _dependent_ system tables, because they only query from other
    -- system tables, and so are automatically excluded by excluding _referenced_ system tables
    join pg_class as referenced_class on referenced_class.oid = joining_depend.refobjid
    join pg_namespace as referenced_namespace on referenced_namespace.oid = referenced_class.relnamespace
        and referenced_namespace.nspname != 'information_schema'
        and referenced_namespace.nspname not like 'pg\_%'

    order by
        dependent_schema, dependent_name, referenced_schema, referenced_name;
[0m19:24:52.336560 [debug] [MainThread]: SQL status: SELECT 15 in 0.007 seconds
[0m19:24:52.339635 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '11234c95-e197-4418-bde7-98b392860bc9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10aa07ee0>]}
[0m19:24:52.340033 [debug] [MainThread]: On master: ROLLBACK
[0m19:24:52.340676 [debug] [MainThread]: Using postgres connection "master"
[0m19:24:52.341017 [debug] [MainThread]: On master: BEGIN
[0m19:24:52.341814 [debug] [MainThread]: SQL status: BEGIN in 0.001 seconds
[0m19:24:52.342081 [debug] [MainThread]: On master: COMMIT
[0m19:24:52.342332 [debug] [MainThread]: Using postgres connection "master"
[0m19:24:52.342576 [debug] [MainThread]: On master: COMMIT
[0m19:24:52.343110 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m19:24:52.343371 [debug] [MainThread]: On master: Close
[0m19:24:52.345260 [debug] [Thread-1  ]: Began running node model.bain_capital_analytics.stg_benchmarks
[0m19:24:52.345604 [debug] [Thread-2  ]: Began running node model.bain_capital_analytics.stg_counterparties
[0m19:24:52.346026 [info ] [Thread-1  ]: 1 of 40 START sql view model public.stg_benchmarks ............................. [RUN]
[0m19:24:52.346404 [debug] [Thread-3  ]: Began running node model.bain_capital_analytics.stg_dates
[0m19:24:52.346810 [info ] [Thread-2  ]: 2 of 40 START sql view model public.stg_counterparties ......................... [RUN]
[0m19:24:52.347160 [debug] [Thread-4  ]: Began running node model.bain_capital_analytics.stg_instruments
[0m19:24:52.347500 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_bain_analytics_public, now model.bain_capital_analytics.stg_benchmarks)
[0m19:24:52.347882 [info ] [Thread-3  ]: 3 of 40 START sql view model public.stg_dates .................................. [RUN]
[0m19:24:52.348236 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly list_bain_analytics_public_raw, now model.bain_capital_analytics.stg_counterparties)
[0m19:24:52.348610 [info ] [Thread-4  ]: 4 of 40 START sql view model public.stg_instruments ............................ [RUN]
[0m19:24:52.348929 [debug] [Thread-1  ]: Began compiling node model.bain_capital_analytics.stg_benchmarks
[0m19:24:52.349298 [debug] [Thread-3  ]: Acquiring new postgres connection 'model.bain_capital_analytics.stg_dates'
[0m19:24:52.349593 [debug] [Thread-2  ]: Began compiling node model.bain_capital_analytics.stg_counterparties
[0m19:24:52.349954 [debug] [Thread-4  ]: Acquiring new postgres connection 'model.bain_capital_analytics.stg_instruments'
[0m19:24:52.357390 [debug] [Thread-1  ]: Writing injected SQL for node "model.bain_capital_analytics.stg_benchmarks"
[0m19:24:52.357772 [debug] [Thread-3  ]: Began compiling node model.bain_capital_analytics.stg_dates
[0m19:24:52.360451 [debug] [Thread-2  ]: Writing injected SQL for node "model.bain_capital_analytics.stg_counterparties"
[0m19:24:52.360776 [debug] [Thread-4  ]: Began compiling node model.bain_capital_analytics.stg_instruments
[0m19:24:52.363448 [debug] [Thread-3  ]: Writing injected SQL for node "model.bain_capital_analytics.stg_dates"
[0m19:24:52.367242 [debug] [Thread-4  ]: Writing injected SQL for node "model.bain_capital_analytics.stg_instruments"
[0m19:24:52.367695 [debug] [Thread-1  ]: Began executing node model.bain_capital_analytics.stg_benchmarks
[0m19:24:52.392519 [debug] [Thread-3  ]: Began executing node model.bain_capital_analytics.stg_dates
[0m19:24:52.398061 [debug] [Thread-1  ]: Writing runtime sql for node "model.bain_capital_analytics.stg_benchmarks"
[0m19:24:52.401496 [debug] [Thread-3  ]: Writing runtime sql for node "model.bain_capital_analytics.stg_dates"
[0m19:24:52.401815 [debug] [Thread-2  ]: Began executing node model.bain_capital_analytics.stg_counterparties
[0m19:24:52.402211 [debug] [Thread-4  ]: Began executing node model.bain_capital_analytics.stg_instruments
[0m19:24:52.405487 [debug] [Thread-2  ]: Writing runtime sql for node "model.bain_capital_analytics.stg_counterparties"
[0m19:24:52.409343 [debug] [Thread-4  ]: Writing runtime sql for node "model.bain_capital_analytics.stg_instruments"
[0m19:24:52.409916 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.stg_dates"
[0m19:24:52.410254 [debug] [Thread-3  ]: On model.bain_capital_analytics.stg_dates: BEGIN
[0m19:24:52.410569 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m19:24:52.410906 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.stg_benchmarks"
[0m19:24:52.411360 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_benchmarks: BEGIN
[0m19:24:52.411698 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.stg_instruments"
[0m19:24:52.412001 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m19:24:52.412318 [debug] [Thread-4  ]: On model.bain_capital_analytics.stg_instruments: BEGIN
[0m19:24:52.412642 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.stg_counterparties"
[0m19:24:52.413015 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m19:24:52.413337 [debug] [Thread-2  ]: On model.bain_capital_analytics.stg_counterparties: BEGIN
[0m19:24:52.413764 [debug] [Thread-2  ]: Opening a new connection, currently in state closed
[0m19:24:52.425899 [debug] [Thread-4  ]: SQL status: BEGIN in 0.013 seconds
[0m19:24:52.426259 [debug] [Thread-2  ]: SQL status: BEGIN in 0.012 seconds
[0m19:24:52.426570 [debug] [Thread-1  ]: SQL status: BEGIN in 0.015 seconds
[0m19:24:52.426884 [debug] [Thread-3  ]: SQL status: BEGIN in 0.016 seconds
[0m19:24:52.427187 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.stg_instruments"
[0m19:24:52.427483 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.stg_counterparties"
[0m19:24:52.427770 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.stg_benchmarks"
[0m19:24:52.428049 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.stg_dates"
[0m19:24:52.428376 [debug] [Thread-4  ]: On model.bain_capital_analytics.stg_instruments: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_instruments"} */

  create view "bain_analytics"."public"."stg_instruments__dbt_tmp"
    
    
  as (
    -- Anti-pattern: unnecessary DISTINCT
select distinct
    instrument_id,
    instrument_name,
    instrument_type,
    sector,
    currency,
    exchange,
    issuer,
    cast(maturity_date as date) as maturity_date,
    -- Anti-pattern: PostgreSQL-specific date subtraction
    case
        when maturity_date is not null
        then cast(maturity_date as date) - current_date
        else null
    end as days_to_maturity,
    case
        when instrument_type in ('equity', 'futures') then 'liquid'
        when instrument_type in ('corporate_bond', 'government_bond', 'sovereign_bond', 'leveraged_loan') then 'semi_liquid'
        when instrument_type in ('private_equity', 'venture_capital', 'real_estate', 'real_estate_debt', 'infrastructure') then 'illiquid'
        else 'other'
    end as liquidity_class
from "bain_analytics"."public_raw"."raw_instruments"
  );
[0m19:24:52.428727 [debug] [Thread-2  ]: On model.bain_capital_analytics.stg_counterparties: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_counterparties"} */

  create view "bain_analytics"."public"."stg_counterparties__dbt_tmp"
    
    
  as (
    select distinct
    counterparty_id,
    counterparty_name,
    counterparty_type,
    country,
    credit_rating,
    cast(is_active as boolean) as is_active
from "bain_analytics"."public_raw"."raw_counterparties"
where cast(is_active as boolean) = true
  );
[0m19:24:52.429069 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_benchmarks: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_benchmarks"} */

  create view "bain_analytics"."public"."stg_benchmarks__dbt_tmp"
    
    
  as (
    select distinct
    benchmark_id,
    benchmark_name,
    cast(benchmark_date as date) as benchmark_date,
    cast(return_daily as numeric(18,8)) as return_daily,
    cast(return_mtd as numeric(18,8)) as return_mtd,
    cast(return_ytd as numeric(18,8)) as return_ytd,
    cast(benchmark_level as numeric(18,4)) as benchmark_level,
    -- Anti-pattern: duplicated fiscal quarter logic
    case
        when extract(month from cast(benchmark_date as date)) between 1 and 3 then 'Q3'
        when extract(month from cast(benchmark_date as date)) between 4 and 6 then 'Q4'
        when extract(month from cast(benchmark_date as date)) between 7 and 9 then 'Q1'
        when extract(month from cast(benchmark_date as date)) between 10 and 12 then 'Q2'
    end as benchmark_fiscal_quarter
from "bain_analytics"."public_raw"."raw_benchmarks"
  );
[0m19:24:52.429415 [debug] [Thread-3  ]: On model.bain_capital_analytics.stg_dates: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_dates"} */

  create view "bain_analytics"."public"."stg_dates__dbt_tmp"
    
    
  as (
    select
    cast(date_day as date) as date_day,
    cast(is_business_day as boolean) as is_business_day,
    cast(is_month_end as boolean) as is_month_end,
    cast(is_quarter_end as boolean) as is_quarter_end,
    cast(is_year_end as boolean) as is_year_end,
    fiscal_quarter,
    fiscal_year,
    -- Anti-pattern: PostgreSQL-specific date_trunc
    date_trunc('month', cast(date_day as date)) as month_start,
    date_trunc('quarter', cast(date_day as date)) as quarter_start,
    extract(month from cast(date_day as date)) as calendar_month,
    extract(year from cast(date_day as date)) as calendar_year
from "bain_analytics"."public_raw"."raw_dates"
  );
[0m19:24:52.433095 [debug] [Thread-2  ]: SQL status: CREATE VIEW in 0.003 seconds
[0m19:24:52.433400 [debug] [Thread-3  ]: SQL status: CREATE VIEW in 0.004 seconds
[0m19:24:52.439406 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.stg_counterparties"
[0m19:24:52.439762 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.010 seconds
[0m19:24:52.442918 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.stg_dates"
[0m19:24:52.443228 [debug] [Thread-4  ]: SQL status: CREATE VIEW in 0.013 seconds
[0m19:24:52.443551 [debug] [Thread-2  ]: On model.bain_capital_analytics.stg_counterparties: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_counterparties"} */
alter table "bain_analytics"."public"."stg_counterparties" rename to "stg_counterparties__dbt_backup"
[0m19:24:52.446499 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.stg_benchmarks"
[0m19:24:52.446825 [debug] [Thread-3  ]: On model.bain_capital_analytics.stg_dates: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_dates"} */
alter table "bain_analytics"."public"."stg_dates" rename to "stg_dates__dbt_backup"
[0m19:24:52.449689 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.stg_instruments"
[0m19:24:52.450099 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_benchmarks: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_benchmarks"} */
alter table "bain_analytics"."public"."stg_benchmarks" rename to "stg_benchmarks__dbt_backup"
[0m19:24:52.450536 [debug] [Thread-4  ]: On model.bain_capital_analytics.stg_instruments: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_instruments"} */
alter table "bain_analytics"."public"."stg_instruments" rename to "stg_instruments__dbt_backup"
[0m19:24:52.451080 [debug] [Thread-2  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m19:24:52.451410 [debug] [Thread-3  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m19:24:52.454672 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.stg_counterparties"
[0m19:24:52.455001 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.004 seconds
[0m19:24:52.455294 [debug] [Thread-4  ]: SQL status: ALTER TABLE in 0.004 seconds
[0m19:24:52.458109 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.stg_dates"
[0m19:24:52.458509 [debug] [Thread-2  ]: On model.bain_capital_analytics.stg_counterparties: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_counterparties"} */
alter table "bain_analytics"."public"."stg_counterparties__dbt_tmp" rename to "stg_counterparties"
[0m19:24:52.461276 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.stg_benchmarks"
[0m19:24:52.463860 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.stg_instruments"
[0m19:24:52.464180 [debug] [Thread-3  ]: On model.bain_capital_analytics.stg_dates: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_dates"} */
alter table "bain_analytics"."public"."stg_dates__dbt_tmp" rename to "stg_dates"
[0m19:24:52.464537 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_benchmarks: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_benchmarks"} */
alter table "bain_analytics"."public"."stg_benchmarks__dbt_tmp" rename to "stg_benchmarks"
[0m19:24:52.464853 [debug] [Thread-4  ]: On model.bain_capital_analytics.stg_instruments: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_instruments"} */
alter table "bain_analytics"."public"."stg_instruments__dbt_tmp" rename to "stg_instruments"
[0m19:24:52.465162 [debug] [Thread-2  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m19:24:52.471716 [debug] [Thread-4  ]: SQL status: ALTER TABLE in 0.006 seconds
[0m19:24:52.478344 [debug] [Thread-3  ]: SQL status: ALTER TABLE in 0.013 seconds
[0m19:24:52.481776 [debug] [Thread-4  ]: On model.bain_capital_analytics.stg_instruments: COMMIT
[0m19:24:52.483602 [debug] [Thread-2  ]: On model.bain_capital_analytics.stg_counterparties: COMMIT
[0m19:24:52.483898 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.018 seconds
[0m19:24:52.484888 [debug] [Thread-3  ]: On model.bain_capital_analytics.stg_dates: COMMIT
[0m19:24:52.485205 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.stg_instruments"
[0m19:24:52.485503 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.stg_counterparties"
[0m19:24:52.486449 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_benchmarks: COMMIT
[0m19:24:52.486753 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.stg_dates"
[0m19:24:52.487045 [debug] [Thread-4  ]: On model.bain_capital_analytics.stg_instruments: COMMIT
[0m19:24:52.487328 [debug] [Thread-2  ]: On model.bain_capital_analytics.stg_counterparties: COMMIT
[0m19:24:52.487612 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.stg_benchmarks"
[0m19:24:52.487892 [debug] [Thread-3  ]: On model.bain_capital_analytics.stg_dates: COMMIT
[0m19:24:52.488298 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_benchmarks: COMMIT
[0m19:24:52.489756 [debug] [Thread-4  ]: SQL status: COMMIT in 0.002 seconds
[0m19:24:52.490101 [debug] [Thread-2  ]: SQL status: COMMIT in 0.002 seconds
[0m19:24:52.490394 [debug] [Thread-3  ]: SQL status: COMMIT in 0.002 seconds
[0m19:24:52.495729 [debug] [Thread-4  ]: Applying DROP to: "bain_analytics"."public"."stg_instruments__dbt_backup"
[0m19:24:52.496047 [debug] [Thread-1  ]: SQL status: COMMIT in 0.007 seconds
[0m19:24:52.499001 [debug] [Thread-2  ]: Applying DROP to: "bain_analytics"."public"."stg_counterparties__dbt_backup"
[0m19:24:52.540836 [debug] [Thread-3  ]: Applying DROP to: "bain_analytics"."public"."stg_dates__dbt_backup"
[0m19:24:52.545165 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.stg_instruments"
[0m19:24:52.547685 [debug] [Thread-1  ]: Applying DROP to: "bain_analytics"."public"."stg_benchmarks__dbt_backup"
[0m19:24:52.548225 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.stg_counterparties"
[0m19:24:52.548709 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.stg_dates"
[0m19:24:52.549028 [debug] [Thread-4  ]: On model.bain_capital_analytics.stg_instruments: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_instruments"} */
drop view if exists "bain_analytics"."public"."stg_instruments__dbt_backup" cascade
[0m19:24:52.549570 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.stg_benchmarks"
[0m19:24:52.549894 [debug] [Thread-2  ]: On model.bain_capital_analytics.stg_counterparties: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_counterparties"} */
drop view if exists "bain_analytics"."public"."stg_counterparties__dbt_backup" cascade
[0m19:24:52.550209 [debug] [Thread-3  ]: On model.bain_capital_analytics.stg_dates: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_dates"} */
drop view if exists "bain_analytics"."public"."stg_dates__dbt_backup" cascade
[0m19:24:52.550615 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_benchmarks: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_benchmarks"} */
drop view if exists "bain_analytics"."public"."stg_benchmarks__dbt_backup" cascade
[0m19:24:52.555138 [debug] [Thread-2  ]: SQL status: DROP VIEW in 0.004 seconds
[0m19:24:52.555471 [debug] [Thread-4  ]: SQL status: DROP VIEW in 0.005 seconds
[0m19:24:52.557706 [debug] [Thread-2  ]: On model.bain_capital_analytics.stg_counterparties: Close
[0m19:24:52.558047 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.007 seconds
[0m19:24:52.558329 [debug] [Thread-3  ]: SQL status: DROP VIEW in 0.007 seconds
[0m19:24:52.559358 [debug] [Thread-4  ]: On model.bain_capital_analytics.stg_instruments: Close
[0m19:24:52.560996 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_benchmarks: Close
[0m19:24:52.562631 [debug] [Thread-3  ]: On model.bain_capital_analytics.stg_dates: Close
[0m19:24:52.563496 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '11234c95-e197-4418-bde7-98b392860bc9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10af3aeb0>]}
[0m19:24:52.563937 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '11234c95-e197-4418-bde7-98b392860bc9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10af9bf40>]}
[0m19:24:52.564218 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '11234c95-e197-4418-bde7-98b392860bc9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10afdfbe0>]}
[0m19:24:52.564742 [info ] [Thread-2  ]: 2 of 40 OK created sql view model public.stg_counterparties .................... [[32mCREATE VIEW[0m in 0.21s]
[0m19:24:52.565062 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '11234c95-e197-4418-bde7-98b392860bc9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10af5e910>]}
[0m19:24:52.565561 [info ] [Thread-3  ]: 3 of 40 OK created sql view model public.stg_dates ............................. [[32mCREATE VIEW[0m in 0.21s]
[0m19:24:52.566029 [info ] [Thread-4  ]: 4 of 40 OK created sql view model public.stg_instruments ....................... [[32mCREATE VIEW[0m in 0.21s]
[0m19:24:52.566486 [debug] [Thread-2  ]: Finished running node model.bain_capital_analytics.stg_counterparties
[0m19:24:52.566951 [info ] [Thread-1  ]: 1 of 40 OK created sql view model public.stg_benchmarks ........................ [[32mCREATE VIEW[0m in 0.22s]
[0m19:24:52.567396 [debug] [Thread-3  ]: Finished running node model.bain_capital_analytics.stg_dates
[0m19:24:52.567813 [debug] [Thread-4  ]: Finished running node model.bain_capital_analytics.stg_instruments
[0m19:24:52.568150 [debug] [Thread-2  ]: Began running node model.bain_capital_analytics.stg_portfolios
[0m19:24:52.568653 [debug] [Thread-1  ]: Finished running node model.bain_capital_analytics.stg_benchmarks
[0m19:24:52.569073 [debug] [Thread-3  ]: Began running node model.bain_capital_analytics.stg_positions
[0m19:24:52.569444 [debug] [Thread-4  ]: Began running node model.bain_capital_analytics.stg_trades
[0m19:24:52.569933 [info ] [Thread-2  ]: 5 of 40 START sql view model public.stg_portfolios ............................. [RUN]
[0m19:24:52.570339 [debug] [Thread-1  ]: Began running node test.bain_capital_analytics.not_null_stg_counterparties_counterparty_id.4754302940
[0m19:24:52.570766 [info ] [Thread-3  ]: 6 of 40 START sql view model public.stg_positions .............................. [RUN]
[0m19:24:52.571224 [info ] [Thread-4  ]: 7 of 40 START sql view model public.stg_trades ................................. [RUN]
[0m19:24:52.571610 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly model.bain_capital_analytics.stg_counterparties, now model.bain_capital_analytics.stg_portfolios)
[0m19:24:52.571936 [info ] [Thread-1  ]: 8 of 40 START test not_null_stg_counterparties_counterparty_id ................. [RUN]
[0m19:24:52.572283 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly model.bain_capital_analytics.stg_dates, now model.bain_capital_analytics.stg_positions)
[0m19:24:52.572606 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly model.bain_capital_analytics.stg_instruments, now model.bain_capital_analytics.stg_trades)
[0m19:24:52.572922 [debug] [Thread-2  ]: Began compiling node model.bain_capital_analytics.stg_portfolios
[0m19:24:52.573241 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.bain_capital_analytics.stg_benchmarks, now test.bain_capital_analytics.not_null_stg_counterparties_counterparty_id.4754302940)
[0m19:24:52.573551 [debug] [Thread-3  ]: Began compiling node model.bain_capital_analytics.stg_positions
[0m19:24:52.573838 [debug] [Thread-4  ]: Began compiling node model.bain_capital_analytics.stg_trades
[0m19:24:52.576884 [debug] [Thread-2  ]: Writing injected SQL for node "model.bain_capital_analytics.stg_portfolios"
[0m19:24:52.577215 [debug] [Thread-1  ]: Began compiling node test.bain_capital_analytics.not_null_stg_counterparties_counterparty_id.4754302940
[0m19:24:52.579746 [debug] [Thread-3  ]: Writing injected SQL for node "model.bain_capital_analytics.stg_positions"
[0m19:24:52.582285 [debug] [Thread-4  ]: Writing injected SQL for node "model.bain_capital_analytics.stg_trades"
[0m19:24:52.593889 [debug] [Thread-1  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_stg_counterparties_counterparty_id.4754302940"
[0m19:24:52.594366 [debug] [Thread-2  ]: Began executing node model.bain_capital_analytics.stg_portfolios
[0m19:24:52.597887 [debug] [Thread-2  ]: Writing runtime sql for node "model.bain_capital_analytics.stg_portfolios"
[0m19:24:52.598375 [debug] [Thread-3  ]: Began executing node model.bain_capital_analytics.stg_positions
[0m19:24:52.598690 [debug] [Thread-4  ]: Began executing node model.bain_capital_analytics.stg_trades
[0m19:24:52.599005 [debug] [Thread-1  ]: Began executing node test.bain_capital_analytics.not_null_stg_counterparties_counterparty_id.4754302940
[0m19:24:52.602276 [debug] [Thread-3  ]: Writing runtime sql for node "model.bain_capital_analytics.stg_positions"
[0m19:24:52.605448 [debug] [Thread-4  ]: Writing runtime sql for node "model.bain_capital_analytics.stg_trades"
[0m19:24:52.605823 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.stg_portfolios"
[0m19:24:52.620850 [debug] [Thread-1  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_stg_counterparties_counterparty_id.4754302940"
[0m19:24:52.621262 [debug] [Thread-2  ]: On model.bain_capital_analytics.stg_portfolios: BEGIN
[0m19:24:52.621719 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.stg_positions"
[0m19:24:52.622048 [debug] [Thread-2  ]: Opening a new connection, currently in state closed
[0m19:24:52.622436 [debug] [Thread-3  ]: On model.bain_capital_analytics.stg_positions: BEGIN
[0m19:24:52.622756 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.stg_trades"
[0m19:24:52.623105 [debug] [Thread-1  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_counterparties_counterparty_id.4754302940"
[0m19:24:52.623534 [debug] [Thread-3  ]: Opening a new connection, currently in state closed
[0m19:24:52.623832 [debug] [Thread-4  ]: On model.bain_capital_analytics.stg_trades: BEGIN
[0m19:24:52.624199 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_stg_counterparties_counterparty_id.4754302940: BEGIN
[0m19:24:52.624574 [debug] [Thread-4  ]: Opening a new connection, currently in state closed
[0m19:24:52.624878 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m19:24:52.638785 [debug] [Thread-2  ]: SQL status: BEGIN in 0.017 seconds
[0m19:24:52.639112 [debug] [Thread-3  ]: SQL status: BEGIN in 0.016 seconds
[0m19:24:52.639406 [debug] [Thread-4  ]: SQL status: BEGIN in 0.015 seconds
[0m19:24:52.639684 [debug] [Thread-1  ]: SQL status: BEGIN in 0.015 seconds
[0m19:24:52.639963 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.stg_portfolios"
[0m19:24:52.640260 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.stg_positions"
[0m19:24:52.640551 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.stg_trades"
[0m19:24:52.640859 [debug] [Thread-1  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_counterparties_counterparty_id.4754302940"
[0m19:24:52.641267 [debug] [Thread-2  ]: On model.bain_capital_analytics.stg_portfolios: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_portfolios"} */

  create view "bain_analytics"."public"."stg_portfolios__dbt_tmp"
    
    
  as (
    -- Anti-pattern: unnecessary DISTINCT when source data is already unique
-- Anti-pattern: casting in every model instead of once upstream

select distinct
    cast(portfolio_id as varchar(10)) as portfolio_id,
    cast(portfolio_name as varchar(100)) as portfolio_name,
    cast(strategy as varchar(50)) as strategy,
    cast(inception_date as date) as inception_date,
    cast(fund_id as varchar(10)) as fund_id,
    cast(manager_name as varchar(100)) as manager_name,
    cast(is_active as boolean) as is_active,
    -- Anti-pattern: duplicated fiscal quarter logic (repeated in many models)
    case
        when extract(month from cast(inception_date as date)) between 1 and 3 then 'Q3'
        when extract(month from cast(inception_date as date)) between 4 and 6 then 'Q4'
        when extract(month from cast(inception_date as date)) between 7 and 9 then 'Q1'
        when extract(month from cast(inception_date as date)) between 10 and 12 then 'Q2'
    end as inception_fiscal_quarter
from "bain_analytics"."public_raw"."raw_portfolios"
where cast(is_active as boolean) = true
  );
[0m19:24:52.641638 [debug] [Thread-3  ]: On model.bain_capital_analytics.stg_positions: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_positions"} */

  create view "bain_analytics"."public"."stg_positions__dbt_tmp"
    
    
  as (
    -- Anti-pattern: unnecessary DISTINCT
-- Anti-pattern: no filtering or partitioning strategy

select distinct
    position_id,
    portfolio_id,
    instrument_id,
    cast(position_date as date) as position_date,
    cast(quantity as numeric(18,4)) as quantity,
    cast(market_value as numeric(18,2)) as market_value,
    cast(cost_basis as numeric(18,2)) as cost_basis,
    currency,
    -- Anti-pattern: computed column that could be done downstream
    cast(market_value as numeric(18,2)) - cast(cost_basis as numeric(18,2)) as unrealized_gain_loss,
    case
        when cast(cost_basis as numeric(18,2)) != 0
        then (cast(market_value as numeric(18,2)) - cast(cost_basis as numeric(18,2))) / abs(cast(cost_basis as numeric(18,2)))
        else 0
    end as unrealized_return_pct
from "bain_analytics"."public_raw"."raw_positions"
  );
[0m19:24:52.642013 [debug] [Thread-4  ]: On model.bain_capital_analytics.stg_trades: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_trades"} */

  create view "bain_analytics"."public"."stg_trades__dbt_tmp"
    
    
  as (
    -- Anti-pattern: unnecessary DISTINCT on already-unique trade_id
-- Anti-pattern: heavy casting repeated everywhere

select distinct
    trade_id,
    portfolio_id,
    instrument_id,
    counterparty_id,
    cast(trade_date as date) as trade_date,
    cast(settlement_date as date) as settlement_date,
    trade_type,
    cast(quantity as numeric(18,4)) as quantity,
    cast(price as numeric(18,6)) as price,
    cast(notional_amount as numeric(18,2)) as notional_amount,
    cast(commission as numeric(18,2)) as commission,
    currency,
    status,
    -- Anti-pattern: duplicated fiscal quarter logic
    case
        when extract(month from cast(trade_date as date)) between 1 and 3 then 'Q3'
        when extract(month from cast(trade_date as date)) between 4 and 6 then 'Q4'
        when extract(month from cast(trade_date as date)) between 7 and 9 then 'Q1'
        when extract(month from cast(trade_date as date)) between 10 and 12 then 'Q2'
    end as trade_fiscal_quarter,
    -- Anti-pattern: PostgreSQL-specific date arithmetic
    cast(settlement_date as date) - cast(trade_date as date) as settlement_days
from "bain_analytics"."public_raw"."raw_trades"
where status = 'settled'
  );
[0m19:24:52.642367 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_stg_counterparties_counterparty_id.4754302940: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_stg_counterparties_counterparty_id.4754302940"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select counterparty_id
from "bain_analytics"."public"."stg_counterparties"
where counterparty_id is null



  
  
      
    ) dbt_internal_test
[0m19:24:52.644628 [debug] [Thread-1  ]: SQL status: SELECT 1 in 0.002 seconds
[0m19:24:52.647493 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_stg_counterparties_counterparty_id.4754302940: ROLLBACK
[0m19:24:52.647881 [debug] [Thread-4  ]: SQL status: CREATE VIEW in 0.005 seconds
[0m19:24:52.648173 [debug] [Thread-3  ]: SQL status: CREATE VIEW in 0.005 seconds
[0m19:24:52.648491 [debug] [Thread-2  ]: SQL status: CREATE VIEW in 0.006 seconds
[0m19:24:52.653107 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.stg_trades"
[0m19:24:52.653602 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_stg_counterparties_counterparty_id.4754302940: Close
[0m19:24:52.656630 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.stg_positions"
[0m19:24:52.659875 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.stg_portfolios"
[0m19:24:52.660264 [debug] [Thread-4  ]: On model.bain_capital_analytics.stg_trades: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_trades"} */
alter table "bain_analytics"."public"."stg_trades" rename to "stg_trades__dbt_backup"
[0m19:24:52.660663 [debug] [Thread-3  ]: On model.bain_capital_analytics.stg_positions: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_positions"} */
alter table "bain_analytics"."public"."stg_positions" rename to "stg_positions__dbt_backup"
[0m19:24:52.661206 [info ] [Thread-1  ]: 8 of 40 PASS not_null_stg_counterparties_counterparty_id ....................... [[32mPASS[0m in 0.09s]
[0m19:24:52.661564 [debug] [Thread-2  ]: On model.bain_capital_analytics.stg_portfolios: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_portfolios"} */
alter table "bain_analytics"."public"."stg_portfolios" rename to "stg_portfolios__dbt_backup"
[0m19:24:52.662164 [debug] [Thread-1  ]: Finished running node test.bain_capital_analytics.not_null_stg_counterparties_counterparty_id.4754302940
[0m19:24:52.662641 [debug] [Thread-1  ]: Began running node test.bain_capital_analytics.unique_stg_counterparties_counterparty_id.d712ebd057
[0m19:24:52.663241 [debug] [Thread-4  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m19:24:52.662983 [info ] [Thread-1  ]: 9 of 40 START test unique_stg_counterparties_counterparty_id ................... [RUN]
[0m19:24:52.663657 [debug] [Thread-2  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m19:24:52.663931 [debug] [Thread-3  ]: SQL status: ALTER TABLE in 0.002 seconds
[0m19:24:52.666651 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.stg_trades"
[0m19:24:52.667024 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.not_null_stg_counterparties_counterparty_id.4754302940, now test.bain_capital_analytics.unique_stg_counterparties_counterparty_id.d712ebd057)
[0m19:24:52.669763 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.stg_portfolios"
[0m19:24:52.673355 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.stg_positions"
[0m19:24:52.673682 [debug] [Thread-4  ]: On model.bain_capital_analytics.stg_trades: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_trades"} */
alter table "bain_analytics"."public"."stg_trades__dbt_tmp" rename to "stg_trades"
[0m19:24:52.673999 [debug] [Thread-1  ]: Began compiling node test.bain_capital_analytics.unique_stg_counterparties_counterparty_id.d712ebd057
[0m19:24:52.674354 [debug] [Thread-2  ]: On model.bain_capital_analytics.stg_portfolios: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_portfolios"} */
alter table "bain_analytics"."public"."stg_portfolios__dbt_tmp" rename to "stg_portfolios"
[0m19:24:52.674709 [debug] [Thread-3  ]: On model.bain_capital_analytics.stg_positions: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_positions"} */
alter table "bain_analytics"."public"."stg_positions__dbt_tmp" rename to "stg_positions"
[0m19:24:52.680425 [debug] [Thread-1  ]: Writing injected SQL for node "test.bain_capital_analytics.unique_stg_counterparties_counterparty_id.d712ebd057"
[0m19:24:52.680792 [debug] [Thread-4  ]: SQL status: ALTER TABLE in 0.006 seconds
[0m19:24:52.682068 [debug] [Thread-4  ]: On model.bain_capital_analytics.stg_trades: COMMIT
[0m19:24:52.682400 [debug] [Thread-3  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m19:24:52.682679 [debug] [Thread-2  ]: SQL status: ALTER TABLE in 0.002 seconds
[0m19:24:52.682984 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.stg_trades"
[0m19:24:52.684058 [debug] [Thread-3  ]: On model.bain_capital_analytics.stg_positions: COMMIT
[0m19:24:52.685253 [debug] [Thread-2  ]: On model.bain_capital_analytics.stg_portfolios: COMMIT
[0m19:24:52.685580 [debug] [Thread-4  ]: On model.bain_capital_analytics.stg_trades: COMMIT
[0m19:24:52.685912 [debug] [Thread-1  ]: Began executing node test.bain_capital_analytics.unique_stg_counterparties_counterparty_id.d712ebd057
[0m19:24:52.686205 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.stg_positions"
[0m19:24:52.686503 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.stg_portfolios"
[0m19:24:52.688925 [debug] [Thread-1  ]: Writing runtime sql for node "test.bain_capital_analytics.unique_stg_counterparties_counterparty_id.d712ebd057"
[0m19:24:52.689254 [debug] [Thread-4  ]: SQL status: COMMIT in 0.002 seconds
[0m19:24:52.689527 [debug] [Thread-3  ]: On model.bain_capital_analytics.stg_positions: COMMIT
[0m19:24:52.689811 [debug] [Thread-2  ]: On model.bain_capital_analytics.stg_portfolios: COMMIT
[0m19:24:52.692195 [debug] [Thread-4  ]: Applying DROP to: "bain_analytics"."public"."stg_trades__dbt_backup"
[0m19:24:52.692662 [debug] [Thread-1  ]: Using postgres connection "test.bain_capital_analytics.unique_stg_counterparties_counterparty_id.d712ebd057"
[0m19:24:52.693126 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.stg_trades"
[0m19:24:52.693449 [debug] [Thread-2  ]: SQL status: COMMIT in 0.001 seconds
[0m19:24:52.693743 [debug] [Thread-3  ]: SQL status: COMMIT in 0.001 seconds
[0m19:24:52.694028 [debug] [Thread-1  ]: On test.bain_capital_analytics.unique_stg_counterparties_counterparty_id.d712ebd057: BEGIN
[0m19:24:52.694336 [debug] [Thread-4  ]: On model.bain_capital_analytics.stg_trades: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_trades"} */
drop view if exists "bain_analytics"."public"."stg_trades__dbt_backup" cascade
[0m19:24:52.696578 [debug] [Thread-2  ]: Applying DROP to: "bain_analytics"."public"."stg_portfolios__dbt_backup"
[0m19:24:52.699354 [debug] [Thread-3  ]: Applying DROP to: "bain_analytics"."public"."stg_positions__dbt_backup"
[0m19:24:52.699664 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m19:24:52.700155 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.stg_portfolios"
[0m19:24:52.700598 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.stg_positions"
[0m19:24:52.701016 [debug] [Thread-2  ]: On model.bain_capital_analytics.stg_portfolios: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_portfolios"} */
drop view if exists "bain_analytics"."public"."stg_portfolios__dbt_backup" cascade
[0m19:24:52.701340 [debug] [Thread-3  ]: On model.bain_capital_analytics.stg_positions: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_positions"} */
drop view if exists "bain_analytics"."public"."stg_positions__dbt_backup" cascade
[0m19:24:52.702091 [debug] [Thread-4  ]: SQL status: DROP VIEW in 0.002 seconds
[0m19:24:52.703131 [debug] [Thread-4  ]: On model.bain_capital_analytics.stg_trades: Close
[0m19:24:52.703660 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '11234c95-e197-4418-bde7-98b392860bc9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10aee0970>]}
[0m19:24:52.704223 [info ] [Thread-4  ]: 7 of 40 OK created sql view model public.stg_trades ............................ [[32mCREATE VIEW[0m in 0.13s]
[0m19:24:52.704746 [debug] [Thread-4  ]: Finished running node model.bain_capital_analytics.stg_trades
[0m19:24:52.705123 [debug] [Thread-4  ]: Began running node test.bain_capital_analytics.not_null_stg_dates_date_day.f3ec4da188
[0m19:24:52.705440 [debug] [Thread-3  ]: SQL status: DROP VIEW in 0.004 seconds
[0m19:24:52.705768 [info ] [Thread-4  ]: 10 of 40 START test not_null_stg_dates_date_day ................................ [RUN]
[0m19:24:52.706998 [debug] [Thread-3  ]: On model.bain_capital_analytics.stg_positions: Close
[0m19:24:52.707300 [debug] [Thread-2  ]: SQL status: DROP VIEW in 0.006 seconds
[0m19:24:52.707834 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly model.bain_capital_analytics.stg_trades, now test.bain_capital_analytics.not_null_stg_dates_date_day.f3ec4da188)
[0m19:24:52.708323 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '11234c95-e197-4418-bde7-98b392860bc9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10af9bf40>]}
[0m19:24:52.709328 [debug] [Thread-2  ]: On model.bain_capital_analytics.stg_portfolios: Close
[0m19:24:52.709730 [debug] [Thread-4  ]: Began compiling node test.bain_capital_analytics.not_null_stg_dates_date_day.f3ec4da188
[0m19:24:52.710622 [debug] [Thread-1  ]: SQL status: BEGIN in 0.011 seconds
[0m19:24:52.711052 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '11234c95-e197-4418-bde7-98b392860bc9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10af66430>]}
[0m19:24:52.714983 [debug] [Thread-4  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_stg_dates_date_day.f3ec4da188"
[0m19:24:52.710305 [info ] [Thread-3  ]: 6 of 40 OK created sql view model public.stg_positions ......................... [[32mCREATE VIEW[0m in 0.14s]
[0m19:24:52.715396 [debug] [Thread-1  ]: Using postgres connection "test.bain_capital_analytics.unique_stg_counterparties_counterparty_id.d712ebd057"
[0m19:24:52.715961 [info ] [Thread-2  ]: 5 of 40 OK created sql view model public.stg_portfolios ........................ [[32mCREATE VIEW[0m in 0.14s]
[0m19:24:52.716442 [debug] [Thread-3  ]: Finished running node model.bain_capital_analytics.stg_positions
[0m19:24:52.716784 [debug] [Thread-1  ]: On test.bain_capital_analytics.unique_stg_counterparties_counterparty_id.d712ebd057: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.unique_stg_counterparties_counterparty_id.d712ebd057"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

select
    counterparty_id as unique_field,
    count(*) as n_records

from "bain_analytics"."public"."stg_counterparties"
where counterparty_id is not null
group by counterparty_id
having count(*) > 1



  
  
      
    ) dbt_internal_test
[0m19:24:52.717266 [debug] [Thread-2  ]: Finished running node model.bain_capital_analytics.stg_portfolios
[0m19:24:52.717635 [debug] [Thread-3  ]: Began running node test.bain_capital_analytics.unique_stg_dates_date_day.e062be8e28
[0m19:24:52.718005 [debug] [Thread-4  ]: Began executing node test.bain_capital_analytics.not_null_stg_dates_date_day.f3ec4da188
[0m19:24:52.718451 [debug] [Thread-2  ]: Began running node test.bain_capital_analytics.not_null_stg_instruments_instrument_id.18bdfd2ebe
[0m19:24:52.718829 [info ] [Thread-3  ]: 11 of 40 START test unique_stg_dates_date_day .................................. [RUN]
[0m19:24:52.721306 [debug] [Thread-4  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_stg_dates_date_day.f3ec4da188"
[0m19:24:52.721661 [debug] [Thread-1  ]: SQL status: SELECT 1 in 0.003 seconds
[0m19:24:52.721969 [info ] [Thread-2  ]: 12 of 40 START test not_null_stg_instruments_instrument_id ..................... [RUN]
[0m19:24:52.722348 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly model.bain_capital_analytics.stg_positions, now test.bain_capital_analytics.unique_stg_dates_date_day.e062be8e28)
[0m19:24:52.723629 [debug] [Thread-1  ]: On test.bain_capital_analytics.unique_stg_counterparties_counterparty_id.d712ebd057: ROLLBACK
[0m19:24:52.724017 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly model.bain_capital_analytics.stg_portfolios, now test.bain_capital_analytics.not_null_stg_instruments_instrument_id.18bdfd2ebe)
[0m19:24:52.724366 [debug] [Thread-3  ]: Began compiling node test.bain_capital_analytics.unique_stg_dates_date_day.e062be8e28
[0m19:24:52.724753 [debug] [Thread-4  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_dates_date_day.f3ec4da188"
[0m19:24:52.725087 [debug] [Thread-2  ]: Began compiling node test.bain_capital_analytics.not_null_stg_instruments_instrument_id.18bdfd2ebe
[0m19:24:52.725393 [debug] [Thread-1  ]: On test.bain_capital_analytics.unique_stg_counterparties_counterparty_id.d712ebd057: Close
[0m19:24:52.728806 [debug] [Thread-3  ]: Writing injected SQL for node "test.bain_capital_analytics.unique_stg_dates_date_day.e062be8e28"
[0m19:24:52.729127 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_stg_dates_date_day.f3ec4da188: BEGIN
[0m19:24:52.732604 [debug] [Thread-2  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_stg_instruments_instrument_id.18bdfd2ebe"
[0m19:24:52.733121 [info ] [Thread-1  ]: 9 of 40 PASS unique_stg_counterparties_counterparty_id ......................... [[32mPASS[0m in 0.07s]
[0m19:24:52.733515 [debug] [Thread-4  ]: Opening a new connection, currently in state closed
[0m19:24:52.734037 [debug] [Thread-1  ]: Finished running node test.bain_capital_analytics.unique_stg_counterparties_counterparty_id.d712ebd057
[0m19:24:52.734517 [debug] [Thread-3  ]: Began executing node test.bain_capital_analytics.unique_stg_dates_date_day.e062be8e28
[0m19:24:52.734873 [debug] [Thread-1  ]: Began running node test.bain_capital_analytics.unique_stg_instruments_instrument_id.0e70adcd34
[0m19:24:52.735233 [debug] [Thread-2  ]: Began executing node test.bain_capital_analytics.not_null_stg_instruments_instrument_id.18bdfd2ebe
[0m19:24:52.737523 [debug] [Thread-3  ]: Writing runtime sql for node "test.bain_capital_analytics.unique_stg_dates_date_day.e062be8e28"
[0m19:24:52.737852 [info ] [Thread-1  ]: 13 of 40 START test unique_stg_instruments_instrument_id ....................... [RUN]
[0m19:24:52.741199 [debug] [Thread-2  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_stg_instruments_instrument_id.18bdfd2ebe"
[0m19:24:52.741694 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.unique_stg_counterparties_counterparty_id.d712ebd057, now test.bain_capital_analytics.unique_stg_instruments_instrument_id.0e70adcd34)
[0m19:24:52.742121 [debug] [Thread-1  ]: Began compiling node test.bain_capital_analytics.unique_stg_instruments_instrument_id.0e70adcd34
[0m19:24:52.745655 [debug] [Thread-1  ]: Writing injected SQL for node "test.bain_capital_analytics.unique_stg_instruments_instrument_id.0e70adcd34"
[0m19:24:52.746041 [debug] [Thread-4  ]: SQL status: BEGIN in 0.013 seconds
[0m19:24:52.746395 [debug] [Thread-3  ]: Using postgres connection "test.bain_capital_analytics.unique_stg_dates_date_day.e062be8e28"
[0m19:24:52.746726 [debug] [Thread-4  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_dates_date_day.f3ec4da188"
[0m19:24:52.747064 [debug] [Thread-3  ]: On test.bain_capital_analytics.unique_stg_dates_date_day.e062be8e28: BEGIN
[0m19:24:52.747428 [debug] [Thread-2  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_instruments_instrument_id.18bdfd2ebe"
[0m19:24:52.747749 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_stg_dates_date_day.f3ec4da188: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_stg_dates_date_day.f3ec4da188"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select date_day
from "bain_analytics"."public"."stg_dates"
where date_day is null



  
  
      
    ) dbt_internal_test
[0m19:24:52.748096 [debug] [Thread-3  ]: Opening a new connection, currently in state closed
[0m19:24:52.748409 [debug] [Thread-1  ]: Began executing node test.bain_capital_analytics.unique_stg_instruments_instrument_id.0e70adcd34
[0m19:24:52.748699 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_stg_instruments_instrument_id.18bdfd2ebe: BEGIN
[0m19:24:52.751052 [debug] [Thread-1  ]: Writing runtime sql for node "test.bain_capital_analytics.unique_stg_instruments_instrument_id.0e70adcd34"
[0m19:24:52.751425 [debug] [Thread-4  ]: SQL status: SELECT 1 in 0.002 seconds
[0m19:24:52.751712 [debug] [Thread-2  ]: Opening a new connection, currently in state closed
[0m19:24:52.752991 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_stg_dates_date_day.f3ec4da188: ROLLBACK
[0m19:24:52.753483 [debug] [Thread-1  ]: Using postgres connection "test.bain_capital_analytics.unique_stg_instruments_instrument_id.0e70adcd34"
[0m19:24:52.753799 [debug] [Thread-1  ]: On test.bain_capital_analytics.unique_stg_instruments_instrument_id.0e70adcd34: BEGIN
[0m19:24:52.754090 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_stg_dates_date_day.f3ec4da188: Close
[0m19:24:52.754392 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m19:24:52.754870 [info ] [Thread-4  ]: 10 of 40 PASS not_null_stg_dates_date_day ...................................... [[32mPASS[0m in 0.05s]
[0m19:24:52.755396 [debug] [Thread-4  ]: Finished running node test.bain_capital_analytics.not_null_stg_dates_date_day.f3ec4da188
[0m19:24:52.755730 [debug] [Thread-4  ]: Began running node test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_date.d5c8f88f3e
[0m19:24:52.756040 [info ] [Thread-4  ]: 14 of 40 START test not_null_stg_benchmarks_benchmark_date ..................... [RUN]
[0m19:24:52.756465 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.not_null_stg_dates_date_day.f3ec4da188, now test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_date.d5c8f88f3e)
[0m19:24:52.756771 [debug] [Thread-4  ]: Began compiling node test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_date.d5c8f88f3e
[0m19:24:52.760459 [debug] [Thread-4  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_date.d5c8f88f3e"
[0m19:24:52.760824 [debug] [Thread-3  ]: SQL status: BEGIN in 0.013 seconds
[0m19:24:52.761213 [debug] [Thread-3  ]: Using postgres connection "test.bain_capital_analytics.unique_stg_dates_date_day.e062be8e28"
[0m19:24:52.761549 [debug] [Thread-3  ]: On test.bain_capital_analytics.unique_stg_dates_date_day.e062be8e28: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.unique_stg_dates_date_day.e062be8e28"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

select
    date_day as unique_field,
    count(*) as n_records

from "bain_analytics"."public"."stg_dates"
where date_day is not null
group by date_day
having count(*) > 1



  
  
      
    ) dbt_internal_test
[0m19:24:52.761903 [debug] [Thread-2  ]: SQL status: BEGIN in 0.010 seconds
[0m19:24:52.762234 [debug] [Thread-2  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_instruments_instrument_id.18bdfd2ebe"
[0m19:24:52.762658 [debug] [Thread-4  ]: Began executing node test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_date.d5c8f88f3e
[0m19:24:52.763177 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_stg_instruments_instrument_id.18bdfd2ebe: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_stg_instruments_instrument_id.18bdfd2ebe"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select instrument_id
from "bain_analytics"."public"."stg_instruments"
where instrument_id is null



  
  
      
    ) dbt_internal_test
[0m19:24:52.765580 [debug] [Thread-4  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_date.d5c8f88f3e"
[0m19:24:52.765932 [debug] [Thread-1  ]: SQL status: BEGIN in 0.012 seconds
[0m19:24:52.766279 [debug] [Thread-3  ]: SQL status: SELECT 1 in 0.004 seconds
[0m19:24:52.766651 [debug] [Thread-1  ]: Using postgres connection "test.bain_capital_analytics.unique_stg_instruments_instrument_id.0e70adcd34"
[0m19:24:52.767917 [debug] [Thread-3  ]: On test.bain_capital_analytics.unique_stg_dates_date_day.e062be8e28: ROLLBACK
[0m19:24:52.768291 [debug] [Thread-2  ]: SQL status: SELECT 1 in 0.002 seconds
[0m19:24:52.768672 [debug] [Thread-1  ]: On test.bain_capital_analytics.unique_stg_instruments_instrument_id.0e70adcd34: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.unique_stg_instruments_instrument_id.0e70adcd34"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

select
    instrument_id as unique_field,
    count(*) as n_records

from "bain_analytics"."public"."stg_instruments"
where instrument_id is not null
group by instrument_id
having count(*) > 1



  
  
      
    ) dbt_internal_test
[0m19:24:52.769057 [debug] [Thread-4  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_date.d5c8f88f3e"
[0m19:24:52.770161 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_stg_instruments_instrument_id.18bdfd2ebe: ROLLBACK
[0m19:24:52.770477 [debug] [Thread-3  ]: On test.bain_capital_analytics.unique_stg_dates_date_day.e062be8e28: Close
[0m19:24:52.770815 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_date.d5c8f88f3e: BEGIN
[0m19:24:52.771571 [debug] [Thread-4  ]: Opening a new connection, currently in state closed
[0m19:24:52.771327 [info ] [Thread-3  ]: 11 of 40 PASS unique_stg_dates_date_day ........................................ [[32mPASS[0m in 0.05s]
[0m19:24:52.771967 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_stg_instruments_instrument_id.18bdfd2ebe: Close
[0m19:24:52.772526 [debug] [Thread-3  ]: Finished running node test.bain_capital_analytics.unique_stg_dates_date_day.e062be8e28
[0m19:24:52.772839 [debug] [Thread-1  ]: SQL status: SELECT 1 in 0.002 seconds
[0m19:24:52.773472 [info ] [Thread-2  ]: 12 of 40 PASS not_null_stg_instruments_instrument_id ........................... [[32mPASS[0m in 0.05s]
[0m19:24:52.773880 [debug] [Thread-3  ]: Began running node test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_id.ec87e4ee58
[0m19:24:52.775140 [debug] [Thread-1  ]: On test.bain_capital_analytics.unique_stg_instruments_instrument_id.0e70adcd34: ROLLBACK
[0m19:24:52.775597 [debug] [Thread-2  ]: Finished running node test.bain_capital_analytics.not_null_stg_instruments_instrument_id.18bdfd2ebe
[0m19:24:52.775947 [info ] [Thread-3  ]: 15 of 40 START test not_null_stg_benchmarks_benchmark_id ....................... [RUN]
[0m19:24:52.776366 [debug] [Thread-2  ]: Began running node test.bain_capital_analytics.not_null_stg_trades_instrument_id.15cdc65a72
[0m19:24:52.776705 [debug] [Thread-1  ]: On test.bain_capital_analytics.unique_stg_instruments_instrument_id.0e70adcd34: Close
[0m19:24:52.777029 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.unique_stg_dates_date_day.e062be8e28, now test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_id.ec87e4ee58)
[0m19:24:52.777352 [info ] [Thread-2  ]: 16 of 40 START test not_null_stg_trades_instrument_id .......................... [RUN]
[0m19:24:52.777818 [info ] [Thread-1  ]: 13 of 40 PASS unique_stg_instruments_instrument_id ............................. [[32mPASS[0m in 0.04s]
[0m19:24:52.778139 [debug] [Thread-3  ]: Began compiling node test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_id.ec87e4ee58
[0m19:24:52.778486 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.not_null_stg_instruments_instrument_id.18bdfd2ebe, now test.bain_capital_analytics.not_null_stg_trades_instrument_id.15cdc65a72)
[0m19:24:52.778934 [debug] [Thread-1  ]: Finished running node test.bain_capital_analytics.unique_stg_instruments_instrument_id.0e70adcd34
[0m19:24:52.782884 [debug] [Thread-3  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_id.ec87e4ee58"
[0m19:24:52.783245 [debug] [Thread-2  ]: Began compiling node test.bain_capital_analytics.not_null_stg_trades_instrument_id.15cdc65a72
[0m19:24:52.783580 [debug] [Thread-1  ]: Began running node test.bain_capital_analytics.not_null_stg_trades_portfolio_id.2becbd2a0b
[0m19:24:52.783903 [debug] [Thread-4  ]: SQL status: BEGIN in 0.012 seconds
[0m19:24:52.788551 [debug] [Thread-2  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_stg_trades_instrument_id.15cdc65a72"
[0m19:24:52.788905 [info ] [Thread-1  ]: 17 of 40 START test not_null_stg_trades_portfolio_id ........................... [RUN]
[0m19:24:52.789269 [debug] [Thread-4  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_date.d5c8f88f3e"
[0m19:24:52.789694 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.unique_stg_instruments_instrument_id.0e70adcd34, now test.bain_capital_analytics.not_null_stg_trades_portfolio_id.2becbd2a0b)
[0m19:24:52.790040 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_date.d5c8f88f3e: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_date.d5c8f88f3e"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select benchmark_date
from "bain_analytics"."public"."stg_benchmarks"
where benchmark_date is null



  
  
      
    ) dbt_internal_test
[0m19:24:52.790449 [debug] [Thread-3  ]: Began executing node test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_id.ec87e4ee58
[0m19:24:52.790844 [debug] [Thread-1  ]: Began compiling node test.bain_capital_analytics.not_null_stg_trades_portfolio_id.2becbd2a0b
[0m19:24:52.791213 [debug] [Thread-2  ]: Began executing node test.bain_capital_analytics.not_null_stg_trades_instrument_id.15cdc65a72
[0m19:24:52.793453 [debug] [Thread-3  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_id.ec87e4ee58"
[0m19:24:52.793790 [debug] [Thread-4  ]: SQL status: SELECT 1 in 0.003 seconds
[0m19:24:52.797193 [debug] [Thread-1  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_stg_trades_portfolio_id.2becbd2a0b"
[0m19:24:52.799438 [debug] [Thread-2  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_stg_trades_instrument_id.15cdc65a72"
[0m19:24:52.800787 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_date.d5c8f88f3e: ROLLBACK
[0m19:24:52.801402 [debug] [Thread-3  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_id.ec87e4ee58"
[0m19:24:52.801753 [debug] [Thread-2  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_trades_instrument_id.15cdc65a72"
[0m19:24:52.802053 [debug] [Thread-1  ]: Began executing node test.bain_capital_analytics.not_null_stg_trades_portfolio_id.2becbd2a0b
[0m19:24:52.802335 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_id.ec87e4ee58: BEGIN
[0m19:24:52.802609 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_date.d5c8f88f3e: Close
[0m19:24:52.802907 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_stg_trades_instrument_id.15cdc65a72: BEGIN
[0m19:24:52.805300 [debug] [Thread-1  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_stg_trades_portfolio_id.2becbd2a0b"
[0m19:24:52.805615 [debug] [Thread-3  ]: Opening a new connection, currently in state closed
[0m19:24:52.806087 [info ] [Thread-4  ]: 14 of 40 PASS not_null_stg_benchmarks_benchmark_date ........................... [[32mPASS[0m in 0.05s]
[0m19:24:52.806407 [debug] [Thread-2  ]: Opening a new connection, currently in state closed
[0m19:24:52.807016 [debug] [Thread-4  ]: Finished running node test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_date.d5c8f88f3e
[0m19:24:52.807460 [debug] [Thread-1  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_trades_portfolio_id.2becbd2a0b"
[0m19:24:52.807939 [debug] [Thread-4  ]: Began running node test.bain_capital_analytics.not_null_stg_trades_trade_id.f81937320b
[0m19:24:52.808310 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_stg_trades_portfolio_id.2becbd2a0b: BEGIN
[0m19:24:52.808632 [info ] [Thread-4  ]: 18 of 40 START test not_null_stg_trades_trade_id ............................... [RUN]
[0m19:24:52.808972 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m19:24:52.809321 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_date.d5c8f88f3e, now test.bain_capital_analytics.not_null_stg_trades_trade_id.f81937320b)
[0m19:24:52.809727 [debug] [Thread-4  ]: Began compiling node test.bain_capital_analytics.not_null_stg_trades_trade_id.f81937320b
[0m19:24:52.813896 [debug] [Thread-4  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_stg_trades_trade_id.f81937320b"
[0m19:24:52.814413 [debug] [Thread-4  ]: Began executing node test.bain_capital_analytics.not_null_stg_trades_trade_id.f81937320b
[0m19:24:52.816615 [debug] [Thread-4  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_stg_trades_trade_id.f81937320b"
[0m19:24:52.817145 [debug] [Thread-4  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_trades_trade_id.f81937320b"
[0m19:24:52.817438 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_stg_trades_trade_id.f81937320b: BEGIN
[0m19:24:52.817745 [debug] [Thread-1  ]: SQL status: BEGIN in 0.009 seconds
[0m19:24:52.818040 [debug] [Thread-4  ]: Opening a new connection, currently in state closed
[0m19:24:52.818320 [debug] [Thread-3  ]: SQL status: BEGIN in 0.013 seconds
[0m19:24:52.818628 [debug] [Thread-2  ]: SQL status: BEGIN in 0.012 seconds
[0m19:24:52.818926 [debug] [Thread-1  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_trades_portfolio_id.2becbd2a0b"
[0m19:24:52.819301 [debug] [Thread-3  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_id.ec87e4ee58"
[0m19:24:52.819592 [debug] [Thread-2  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_trades_instrument_id.15cdc65a72"
[0m19:24:52.819902 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_stg_trades_portfolio_id.2becbd2a0b: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_stg_trades_portfolio_id.2becbd2a0b"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select portfolio_id
from "bain_analytics"."public"."stg_trades"
where portfolio_id is null



  
  
      
    ) dbt_internal_test
[0m19:24:52.820237 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_id.ec87e4ee58: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_id.ec87e4ee58"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select benchmark_id
from "bain_analytics"."public"."stg_benchmarks"
where benchmark_id is null



  
  
      
    ) dbt_internal_test
[0m19:24:52.820574 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_stg_trades_instrument_id.15cdc65a72: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_stg_trades_instrument_id.15cdc65a72"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select instrument_id
from "bain_analytics"."public"."stg_trades"
where instrument_id is null



  
  
      
    ) dbt_internal_test
[0m19:24:52.822896 [debug] [Thread-3  ]: SQL status: SELECT 1 in 0.002 seconds
[0m19:24:52.823206 [debug] [Thread-1  ]: SQL status: SELECT 1 in 0.002 seconds
[0m19:24:52.824461 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_id.ec87e4ee58: ROLLBACK
[0m19:24:52.824766 [debug] [Thread-2  ]: SQL status: SELECT 1 in 0.004 seconds
[0m19:24:52.825875 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_stg_trades_portfolio_id.2becbd2a0b: ROLLBACK
[0m19:24:52.826923 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_stg_trades_instrument_id.15cdc65a72: ROLLBACK
[0m19:24:52.827228 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_id.ec87e4ee58: Close
[0m19:24:52.828020 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_stg_trades_instrument_id.15cdc65a72: Close
[0m19:24:52.828317 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_stg_trades_portfolio_id.2becbd2a0b: Close
[0m19:24:52.828601 [debug] [Thread-4  ]: SQL status: BEGIN in 0.011 seconds
[0m19:24:52.827777 [info ] [Thread-3  ]: 15 of 40 PASS not_null_stg_benchmarks_benchmark_id ............................. [[32mPASS[0m in 0.05s]
[0m19:24:52.829106 [info ] [Thread-2  ]: 16 of 40 PASS not_null_stg_trades_instrument_id ................................ [[32mPASS[0m in 0.05s]
[0m19:24:52.829584 [info ] [Thread-1  ]: 17 of 40 PASS not_null_stg_trades_portfolio_id ................................. [[32mPASS[0m in 0.04s]
[0m19:24:52.829905 [debug] [Thread-4  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_trades_trade_id.f81937320b"
[0m19:24:52.830322 [debug] [Thread-3  ]: Finished running node test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_id.ec87e4ee58
[0m19:24:52.830724 [debug] [Thread-2  ]: Finished running node test.bain_capital_analytics.not_null_stg_trades_instrument_id.15cdc65a72
[0m19:24:52.831119 [debug] [Thread-1  ]: Finished running node test.bain_capital_analytics.not_null_stg_trades_portfolio_id.2becbd2a0b
[0m19:24:52.831421 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_stg_trades_trade_id.f81937320b: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_stg_trades_trade_id.f81937320b"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select trade_id
from "bain_analytics"."public"."stg_trades"
where trade_id is null



  
  
      
    ) dbt_internal_test
[0m19:24:52.831766 [debug] [Thread-3  ]: Began running node test.bain_capital_analytics.unique_stg_trades_trade_id.f973ed6ffd
[0m19:24:52.832130 [debug] [Thread-2  ]: Began running node test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c
[0m19:24:52.832488 [debug] [Thread-1  ]: Began running node test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1
[0m19:24:52.832864 [info ] [Thread-3  ]: 19 of 40 START test unique_stg_trades_trade_id ................................. [RUN]
[0m19:24:52.833189 [info ] [Thread-2  ]: 20 of 40 START test not_null_stg_positions_portfolio_id ........................ [RUN]
[0m19:24:52.833514 [info ] [Thread-1  ]: 21 of 40 START test not_null_stg_positions_position_id ......................... [RUN]
[0m19:24:52.833884 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_id.ec87e4ee58, now test.bain_capital_analytics.unique_stg_trades_trade_id.f973ed6ffd)
[0m19:24:52.834225 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.not_null_stg_trades_instrument_id.15cdc65a72, now test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c)
[0m19:24:52.834546 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.not_null_stg_trades_portfolio_id.2becbd2a0b, now test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1)
[0m19:24:52.834833 [debug] [Thread-4  ]: SQL status: SELECT 1 in 0.002 seconds
[0m19:24:52.835125 [debug] [Thread-3  ]: Began compiling node test.bain_capital_analytics.unique_stg_trades_trade_id.f973ed6ffd
[0m19:24:52.835406 [debug] [Thread-2  ]: Began compiling node test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c
[0m19:24:52.835681 [debug] [Thread-1  ]: Began compiling node test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1
[0m19:24:52.836721 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_stg_trades_trade_id.f81937320b: ROLLBACK
[0m19:24:52.840405 [debug] [Thread-3  ]: Writing injected SQL for node "test.bain_capital_analytics.unique_stg_trades_trade_id.f973ed6ffd"
[0m19:24:52.843866 [debug] [Thread-2  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c"
[0m19:24:52.847137 [debug] [Thread-1  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1"
[0m19:24:52.847767 [debug] [Thread-2  ]: Began executing node test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c
[0m19:24:52.848078 [debug] [Thread-1  ]: Began executing node test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1
[0m19:24:52.848377 [debug] [Thread-3  ]: Began executing node test.bain_capital_analytics.unique_stg_trades_trade_id.f973ed6ffd
[0m19:24:52.848655 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_stg_trades_trade_id.f81937320b: Close
[0m19:24:52.850873 [debug] [Thread-2  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c"
[0m19:24:52.854091 [debug] [Thread-1  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1"
[0m19:24:52.856206 [debug] [Thread-3  ]: Writing runtime sql for node "test.bain_capital_analytics.unique_stg_trades_trade_id.f973ed6ffd"
[0m19:24:52.856672 [info ] [Thread-4  ]: 18 of 40 PASS not_null_stg_trades_trade_id ..................................... [[32mPASS[0m in 0.05s]
[0m19:24:52.857351 [debug] [Thread-4  ]: Finished running node test.bain_capital_analytics.not_null_stg_trades_trade_id.f81937320b
[0m19:24:52.857758 [debug] [Thread-4  ]: Began running node test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f
[0m19:24:52.858172 [info ] [Thread-4  ]: 22 of 40 START test unique_stg_positions_position_id ........................... [RUN]
[0m19:24:52.858529 [debug] [Thread-3  ]: Using postgres connection "test.bain_capital_analytics.unique_stg_trades_trade_id.f973ed6ffd"
[0m19:24:52.858875 [debug] [Thread-2  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c"
[0m19:24:52.859218 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.not_null_stg_trades_trade_id.f81937320b, now test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f)
[0m19:24:52.859548 [debug] [Thread-1  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1"
[0m19:24:52.859845 [debug] [Thread-3  ]: On test.bain_capital_analytics.unique_stg_trades_trade_id.f973ed6ffd: BEGIN
[0m19:24:52.860151 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c: BEGIN
[0m19:24:52.860470 [debug] [Thread-4  ]: Began compiling node test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f
[0m19:24:52.860773 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1: BEGIN
[0m19:24:52.861063 [debug] [Thread-3  ]: Opening a new connection, currently in state closed
[0m19:24:52.861356 [debug] [Thread-2  ]: Opening a new connection, currently in state closed
[0m19:24:52.864750 [debug] [Thread-4  ]: Writing injected SQL for node "test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f"
[0m19:24:52.865059 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m19:24:52.865712 [debug] [Thread-4  ]: Began executing node test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f
[0m19:24:52.867843 [debug] [Thread-4  ]: Writing runtime sql for node "test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f"
[0m19:24:52.868308 [debug] [Thread-4  ]: Using postgres connection "test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f"
[0m19:24:52.868598 [debug] [Thread-4  ]: On test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f: BEGIN
[0m19:24:52.868866 [debug] [Thread-4  ]: Opening a new connection, currently in state closed
[0m19:24:52.876805 [debug] [Thread-2  ]: SQL status: BEGIN in 0.015 seconds
[0m19:24:52.877126 [debug] [Thread-1  ]: SQL status: BEGIN in 0.012 seconds
[0m19:24:52.877408 [debug] [Thread-3  ]: SQL status: BEGIN in 0.016 seconds
[0m19:24:52.877693 [debug] [Thread-2  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c"
[0m19:24:52.878015 [debug] [Thread-1  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1"
[0m19:24:52.878309 [debug] [Thread-3  ]: Using postgres connection "test.bain_capital_analytics.unique_stg_trades_trade_id.f973ed6ffd"
[0m19:24:52.878598 [debug] [Thread-4  ]: SQL status: BEGIN in 0.010 seconds
[0m19:24:52.878881 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select portfolio_id
from "bain_analytics"."public"."stg_positions"
where portfolio_id is null



  
  
      
    ) dbt_internal_test
[0m19:24:52.879200 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select position_id
from "bain_analytics"."public"."stg_positions"
where position_id is null



  
  
      
    ) dbt_internal_test
[0m19:24:52.879526 [debug] [Thread-3  ]: On test.bain_capital_analytics.unique_stg_trades_trade_id.f973ed6ffd: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.unique_stg_trades_trade_id.f973ed6ffd"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

select
    trade_id as unique_field,
    count(*) as n_records

from "bain_analytics"."public"."stg_trades"
where trade_id is not null
group by trade_id
having count(*) > 1



  
  
      
    ) dbt_internal_test
[0m19:24:52.879834 [debug] [Thread-4  ]: Using postgres connection "test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f"
[0m19:24:52.880238 [debug] [Thread-4  ]: On test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

select
    position_id as unique_field,
    count(*) as n_records

from "bain_analytics"."public"."stg_positions"
where position_id is not null
group by position_id
having count(*) > 1



  
  
      
    ) dbt_internal_test
[0m19:24:52.882574 [debug] [Thread-1  ]: SQL status: SELECT 1 in 0.002 seconds
[0m19:24:52.882871 [debug] [Thread-2  ]: SQL status: SELECT 1 in 0.003 seconds
[0m19:24:52.884047 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1: ROLLBACK
[0m19:24:52.884338 [debug] [Thread-4  ]: SQL status: SELECT 1 in 0.004 seconds
[0m19:24:52.884626 [debug] [Thread-3  ]: SQL status: SELECT 1 in 0.004 seconds
[0m19:24:52.885577 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c: ROLLBACK
[0m19:24:52.886669 [debug] [Thread-4  ]: On test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f: ROLLBACK
[0m19:24:52.886967 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1: Close
[0m19:24:52.887914 [debug] [Thread-3  ]: On test.bain_capital_analytics.unique_stg_trades_trade_id.f973ed6ffd: ROLLBACK
[0m19:24:52.888425 [info ] [Thread-1  ]: 21 of 40 PASS not_null_stg_positions_position_id ............................... [[32mPASS[0m in 0.05s]
[0m19:24:52.888727 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c: Close
[0m19:24:52.889004 [debug] [Thread-4  ]: On test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f: Close
[0m19:24:52.889291 [debug] [Thread-3  ]: On test.bain_capital_analytics.unique_stg_trades_trade_id.f973ed6ffd: Close
[0m19:24:52.889683 [debug] [Thread-1  ]: Finished running node test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1
[0m19:24:52.890112 [info ] [Thread-2  ]: 20 of 40 PASS not_null_stg_positions_portfolio_id .............................. [[32mPASS[0m in 0.06s]
[0m19:24:52.890543 [info ] [Thread-4  ]: 22 of 40 PASS unique_stg_positions_position_id ................................. [[32mPASS[0m in 0.03s]
[0m19:24:52.891018 [info ] [Thread-3  ]: 19 of 40 PASS unique_stg_trades_trade_id ....................................... [[32mPASS[0m in 0.06s]
[0m19:24:52.891382 [debug] [Thread-1  ]: Began running node test.bain_capital_analytics.not_null_stg_portfolios_fund_id.70b04d82bd
[0m19:24:52.891857 [debug] [Thread-2  ]: Finished running node test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c
[0m19:24:52.892268 [debug] [Thread-4  ]: Finished running node test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f
[0m19:24:52.892663 [debug] [Thread-3  ]: Finished running node test.bain_capital_analytics.unique_stg_trades_trade_id.f973ed6ffd
[0m19:24:52.893023 [info ] [Thread-1  ]: 23 of 40 START test not_null_stg_portfolios_fund_id ............................ [RUN]
[0m19:24:52.893382 [debug] [Thread-2  ]: Began running node test.bain_capital_analytics.not_null_stg_portfolios_portfolio_id.7126a480ec
[0m19:24:52.893761 [debug] [Thread-4  ]: Began running node test.bain_capital_analytics.relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_.2823f12709
[0m19:24:52.894145 [debug] [Thread-3  ]: Began running node test.bain_capital_analytics.unique_stg_portfolios_portfolio_id.aa125b6658
[0m19:24:52.894537 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1, now test.bain_capital_analytics.not_null_stg_portfolios_fund_id.70b04d82bd)
[0m19:24:52.894864 [info ] [Thread-2  ]: 24 of 40 START test not_null_stg_portfolios_portfolio_id ....................... [RUN]
[0m19:24:52.895188 [info ] [Thread-4  ]: 25 of 40 START test relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_  [RUN]
[0m19:24:52.895504 [info ] [Thread-3  ]: 26 of 40 START test unique_stg_portfolios_portfolio_id ......................... [RUN]
[0m19:24:52.895809 [debug] [Thread-1  ]: Began compiling node test.bain_capital_analytics.not_null_stg_portfolios_fund_id.70b04d82bd
[0m19:24:52.896116 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c, now test.bain_capital_analytics.not_null_stg_portfolios_portfolio_id.7126a480ec)
[0m19:24:52.896437 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f, now test.bain_capital_analytics.relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_.2823f12709)
[0m19:24:52.896750 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.unique_stg_trades_trade_id.f973ed6ffd, now test.bain_capital_analytics.unique_stg_portfolios_portfolio_id.aa125b6658)
[0m19:24:52.900484 [debug] [Thread-1  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_stg_portfolios_fund_id.70b04d82bd"
[0m19:24:52.900808 [debug] [Thread-2  ]: Began compiling node test.bain_capital_analytics.not_null_stg_portfolios_portfolio_id.7126a480ec
[0m19:24:52.901104 [debug] [Thread-4  ]: Began compiling node test.bain_capital_analytics.relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_.2823f12709
[0m19:24:52.901385 [debug] [Thread-3  ]: Began compiling node test.bain_capital_analytics.unique_stg_portfolios_portfolio_id.aa125b6658
[0m19:24:52.904876 [debug] [Thread-2  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_stg_portfolios_portfolio_id.7126a480ec"
[0m19:24:52.913109 [debug] [Thread-4  ]: Writing injected SQL for node "test.bain_capital_analytics.relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_.2823f12709"
[0m19:24:52.916423 [debug] [Thread-3  ]: Writing injected SQL for node "test.bain_capital_analytics.unique_stg_portfolios_portfolio_id.aa125b6658"
[0m19:24:52.916765 [debug] [Thread-1  ]: Began executing node test.bain_capital_analytics.not_null_stg_portfolios_fund_id.70b04d82bd
[0m19:24:52.919307 [debug] [Thread-1  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_stg_portfolios_fund_id.70b04d82bd"
[0m19:24:52.919762 [debug] [Thread-2  ]: Began executing node test.bain_capital_analytics.not_null_stg_portfolios_portfolio_id.7126a480ec
[0m19:24:52.921939 [debug] [Thread-2  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_stg_portfolios_portfolio_id.7126a480ec"
[0m19:24:52.922319 [debug] [Thread-4  ]: Began executing node test.bain_capital_analytics.relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_.2823f12709
[0m19:24:52.922625 [debug] [Thread-3  ]: Began executing node test.bain_capital_analytics.unique_stg_portfolios_portfolio_id.aa125b6658
[0m19:24:52.924873 [debug] [Thread-4  ]: Writing runtime sql for node "test.bain_capital_analytics.relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_.2823f12709"
[0m19:24:52.925221 [debug] [Thread-1  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_portfolios_fund_id.70b04d82bd"
[0m19:24:52.928049 [debug] [Thread-3  ]: Writing runtime sql for node "test.bain_capital_analytics.unique_stg_portfolios_portfolio_id.aa125b6658"
[0m19:24:52.928459 [debug] [Thread-2  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_portfolios_portfolio_id.7126a480ec"
[0m19:24:52.928797 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_stg_portfolios_fund_id.70b04d82bd: BEGIN
[0m19:24:52.929204 [debug] [Thread-4  ]: Using postgres connection "test.bain_capital_analytics.relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_.2823f12709"
[0m19:24:52.929512 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_stg_portfolios_portfolio_id.7126a480ec: BEGIN
[0m19:24:52.929805 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m19:24:52.930112 [debug] [Thread-4  ]: On test.bain_capital_analytics.relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_.2823f12709: BEGIN
[0m19:24:52.930440 [debug] [Thread-2  ]: Opening a new connection, currently in state closed
[0m19:24:52.930778 [debug] [Thread-3  ]: Using postgres connection "test.bain_capital_analytics.unique_stg_portfolios_portfolio_id.aa125b6658"
[0m19:24:52.931147 [debug] [Thread-4  ]: Opening a new connection, currently in state closed
[0m19:24:52.931523 [debug] [Thread-3  ]: On test.bain_capital_analytics.unique_stg_portfolios_portfolio_id.aa125b6658: BEGIN
[0m19:24:52.931891 [debug] [Thread-3  ]: Opening a new connection, currently in state closed
[0m19:24:52.946866 [debug] [Thread-2  ]: SQL status: BEGIN in 0.016 seconds
[0m19:24:52.947197 [debug] [Thread-4  ]: SQL status: BEGIN in 0.016 seconds
[0m19:24:52.947471 [debug] [Thread-3  ]: SQL status: BEGIN in 0.016 seconds
[0m19:24:52.947736 [debug] [Thread-1  ]: SQL status: BEGIN in 0.018 seconds
[0m19:24:52.948006 [debug] [Thread-2  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_portfolios_portfolio_id.7126a480ec"
[0m19:24:52.948308 [debug] [Thread-4  ]: Using postgres connection "test.bain_capital_analytics.relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_.2823f12709"
[0m19:24:52.948598 [debug] [Thread-3  ]: Using postgres connection "test.bain_capital_analytics.unique_stg_portfolios_portfolio_id.aa125b6658"
[0m19:24:52.948873 [debug] [Thread-1  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_portfolios_fund_id.70b04d82bd"
[0m19:24:52.949169 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_stg_portfolios_portfolio_id.7126a480ec: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_stg_portfolios_portfolio_id.7126a480ec"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select portfolio_id
from "bain_analytics"."public"."stg_portfolios"
where portfolio_id is null



  
  
      
    ) dbt_internal_test
[0m19:24:52.949493 [debug] [Thread-4  ]: On test.bain_capital_analytics.relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_.2823f12709: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_.2823f12709"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

with child as (
    select portfolio_id as from_field
    from "bain_analytics"."public"."stg_positions"
    where portfolio_id is not null
),

parent as (
    select portfolio_id as to_field
    from "bain_analytics"."public"."stg_portfolios"
)

select
    from_field

from child
left join parent
    on child.from_field = parent.to_field

where parent.to_field is null



  
  
      
    ) dbt_internal_test
[0m19:24:52.949821 [debug] [Thread-3  ]: On test.bain_capital_analytics.unique_stg_portfolios_portfolio_id.aa125b6658: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.unique_stg_portfolios_portfolio_id.aa125b6658"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

select
    portfolio_id as unique_field,
    count(*) as n_records

from "bain_analytics"."public"."stg_portfolios"
where portfolio_id is not null
group by portfolio_id
having count(*) > 1



  
  
      
    ) dbt_internal_test
[0m19:24:52.950141 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_stg_portfolios_fund_id.70b04d82bd: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_stg_portfolios_fund_id.70b04d82bd"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select fund_id
from "bain_analytics"."public"."stg_portfolios"
where fund_id is null



  
  
      
    ) dbt_internal_test
[0m19:24:52.953375 [debug] [Thread-2  ]: SQL status: SELECT 1 in 0.003 seconds
[0m19:24:52.953682 [debug] [Thread-1  ]: SQL status: SELECT 1 in 0.003 seconds
[0m19:24:52.954870 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_stg_portfolios_portfolio_id.7126a480ec: ROLLBACK
[0m19:24:52.955168 [debug] [Thread-3  ]: SQL status: SELECT 1 in 0.005 seconds
[0m19:24:52.955483 [debug] [Thread-4  ]: SQL status: SELECT 1 in 0.005 seconds
[0m19:24:52.956513 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_stg_portfolios_fund_id.70b04d82bd: ROLLBACK
[0m19:24:52.957606 [debug] [Thread-3  ]: On test.bain_capital_analytics.unique_stg_portfolios_portfolio_id.aa125b6658: ROLLBACK
[0m19:24:52.957948 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_stg_portfolios_portfolio_id.7126a480ec: Close
[0m19:24:52.958932 [debug] [Thread-4  ]: On test.bain_capital_analytics.relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_.2823f12709: ROLLBACK
[0m19:24:52.959495 [info ] [Thread-2  ]: 24 of 40 PASS not_null_stg_portfolios_portfolio_id ............................. [[32mPASS[0m in 0.06s]
[0m19:24:52.959818 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_stg_portfolios_fund_id.70b04d82bd: Close
[0m19:24:52.960096 [debug] [Thread-3  ]: On test.bain_capital_analytics.unique_stg_portfolios_portfolio_id.aa125b6658: Close
[0m19:24:52.960367 [debug] [Thread-4  ]: On test.bain_capital_analytics.relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_.2823f12709: Close
[0m19:24:52.960774 [debug] [Thread-2  ]: Finished running node test.bain_capital_analytics.not_null_stg_portfolios_portfolio_id.7126a480ec
[0m19:24:52.961227 [info ] [Thread-1  ]: 23 of 40 PASS not_null_stg_portfolios_fund_id .................................. [[32mPASS[0m in 0.07s]
[0m19:24:52.961671 [info ] [Thread-3  ]: 26 of 40 PASS unique_stg_portfolios_portfolio_id ............................... [[32mPASS[0m in 0.06s]
[0m19:24:52.962116 [info ] [Thread-4  ]: 25 of 40 PASS relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_  [[32mPASS[0m in 0.07s]
[0m19:24:52.962653 [debug] [Thread-1  ]: Finished running node test.bain_capital_analytics.not_null_stg_portfolios_fund_id.70b04d82bd
[0m19:24:52.963061 [debug] [Thread-3  ]: Finished running node test.bain_capital_analytics.unique_stg_portfolios_portfolio_id.aa125b6658
[0m19:24:52.963460 [debug] [Thread-4  ]: Finished running node test.bain_capital_analytics.relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_.2823f12709
[0m19:24:52.964041 [debug] [Thread-2  ]: Began running node model.bain_capital_analytics.fact_trade_activity
[0m19:24:52.964510 [info ] [Thread-2  ]: 27 of 40 START sql view model public.fact_trade_activity ....................... [RUN]
[0m19:24:52.964866 [debug] [Thread-1  ]: Began running node model.bain_capital_analytics.int_trade_enriched
[0m19:24:52.965198 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.not_null_stg_portfolios_portfolio_id.7126a480ec, now model.bain_capital_analytics.fact_trade_activity)
[0m19:24:52.965499 [debug] [Thread-3  ]: Began running node model.bain_capital_analytics.int_daily_positions
[0m19:24:52.965885 [info ] [Thread-1  ]: 28 of 40 START sql view model public.int_trade_enriched ........................ [RUN]
[0m19:24:52.966210 [debug] [Thread-2  ]: Began compiling node model.bain_capital_analytics.fact_trade_activity
[0m19:24:52.966590 [info ] [Thread-3  ]: 29 of 40 START sql view model public.int_daily_positions ....................... [RUN]
[0m19:24:52.966949 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.not_null_stg_portfolios_fund_id.70b04d82bd, now model.bain_capital_analytics.int_trade_enriched)
[0m19:24:52.970702 [debug] [Thread-2  ]: Writing injected SQL for node "model.bain_capital_analytics.fact_trade_activity"
[0m19:24:52.971056 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.unique_stg_portfolios_portfolio_id.aa125b6658, now model.bain_capital_analytics.int_daily_positions)
[0m19:24:52.971362 [debug] [Thread-1  ]: Began compiling node model.bain_capital_analytics.int_trade_enriched
[0m19:24:52.971717 [debug] [Thread-3  ]: Began compiling node model.bain_capital_analytics.int_daily_positions
[0m19:24:52.975104 [debug] [Thread-1  ]: Writing injected SQL for node "model.bain_capital_analytics.int_trade_enriched"
[0m19:24:52.978421 [debug] [Thread-3  ]: Writing injected SQL for node "model.bain_capital_analytics.int_daily_positions"
[0m19:24:52.978801 [debug] [Thread-2  ]: Began executing node model.bain_capital_analytics.fact_trade_activity
[0m19:24:52.982083 [debug] [Thread-2  ]: Writing runtime sql for node "model.bain_capital_analytics.fact_trade_activity"
[0m19:24:52.982523 [debug] [Thread-1  ]: Began executing node model.bain_capital_analytics.int_trade_enriched
[0m19:24:52.985723 [debug] [Thread-1  ]: Writing runtime sql for node "model.bain_capital_analytics.int_trade_enriched"
[0m19:24:52.986030 [debug] [Thread-3  ]: Began executing node model.bain_capital_analytics.int_daily_positions
[0m19:24:53.037352 [debug] [Thread-3  ]: Writing runtime sql for node "model.bain_capital_analytics.int_daily_positions"
[0m19:24:53.037832 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.fact_trade_activity"
[0m19:24:53.038301 [debug] [Thread-2  ]: On model.bain_capital_analytics.fact_trade_activity: BEGIN
[0m19:24:53.038622 [debug] [Thread-2  ]: Opening a new connection, currently in state closed
[0m19:24:53.038968 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.int_trade_enriched"
[0m19:24:53.039417 [debug] [Thread-1  ]: On model.bain_capital_analytics.int_trade_enriched: BEGIN
[0m19:24:53.039757 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.int_daily_positions"
[0m19:24:53.040037 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m19:24:53.040326 [debug] [Thread-3  ]: On model.bain_capital_analytics.int_daily_positions: BEGIN
[0m19:24:53.040721 [debug] [Thread-3  ]: Opening a new connection, currently in state closed
[0m19:24:53.051897 [debug] [Thread-2  ]: SQL status: BEGIN in 0.013 seconds
[0m19:24:53.052253 [debug] [Thread-3  ]: SQL status: BEGIN in 0.012 seconds
[0m19:24:53.052552 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.fact_trade_activity"
[0m19:24:53.052841 [debug] [Thread-1  ]: SQL status: BEGIN in 0.013 seconds
[0m19:24:53.053132 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.int_daily_positions"
[0m19:24:53.053508 [debug] [Thread-2  ]: On model.bain_capital_analytics.fact_trade_activity: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.fact_trade_activity"} */

  create view "bain_analytics"."public"."fact_trade_activity__dbt_tmp"
    
    
  as (
    -- Pipeline B: FACT table - Trade activity detail
-- Anti-pattern: repeats the SAME 3-table join as fact_portfolio_pnl and int_trade_enriched
-- Anti-pattern: could use int_trade_enriched but re-does everything

select
    t.trade_id,
    t.portfolio_id,
    t.instrument_id,
    t.counterparty_id,
    t.trade_date,
    t.settlement_date,
    t.trade_type,
    t.quantity,
    t.price,
    t.notional_amount,
    t.commission,
    t.currency,
    t.settlement_days,
    -- Anti-pattern: re-joining instruments (done in int_trade_enriched)
    i.instrument_name,
    i.instrument_type,
    i.sector,
    i.liquidity_class,
    -- Anti-pattern: re-joining counterparties (done in int_trade_enriched)
    c.counterparty_name,
    c.counterparty_type,
    c.credit_rating,
    -- Anti-pattern: re-joining portfolios (done in int_trade_enriched)
    p.portfolio_name,
    p.strategy,
    p.fund_id,
    p.manager_name,
    -- Anti-pattern: re-joining dates
    d.fiscal_quarter,
    d.fiscal_year,
    d.is_month_end,
    -- Anti-pattern: duplicated fiscal quarter logic
    case
        when extract(month from t.trade_date) between 1 and 3 then 'Q3'
        when extract(month from t.trade_date) between 4 and 6 then 'Q4'
        when extract(month from t.trade_date) between 7 and 9 then 'Q1'
        when extract(month from t.trade_date) between 10 and 12 then 'Q2'
    end as computed_fiscal_quarter,
    -- Anti-pattern: window functions recomputed (already in int_trade_enriched)
    sum(t.notional_amount) over (
        partition by t.portfolio_id
        order by t.trade_date
        rows between unbounded preceding and current row
    ) as running_notional,
    count(*) over (
        partition by t.portfolio_id, date_trunc('month', t.trade_date)
    ) as monthly_trade_count,
    sum(t.commission) over (
        partition by t.portfolio_id, date_trunc('month', t.trade_date)
    ) as monthly_commissions
from "bain_analytics"."public"."stg_trades" t
inner join "bain_analytics"."public"."stg_instruments" i
    on t.instrument_id = i.instrument_id
inner join "bain_analytics"."public"."stg_counterparties" c
    on t.counterparty_id = c.counterparty_id
inner join "bain_analytics"."public"."stg_portfolios" p
    on t.portfolio_id = p.portfolio_id
inner join "bain_analytics"."public"."stg_dates" d
    on t.trade_date = d.date_day
  );
[0m19:24:53.053888 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.int_trade_enriched"
[0m19:24:53.054263 [debug] [Thread-3  ]: On model.bain_capital_analytics.int_daily_positions: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.int_daily_positions"} */

  create view "bain_analytics"."public"."int_daily_positions__dbt_tmp"
    
    
  as (
    -- Pipeline B: Daily position snapshots with PnL calculations
-- Anti-pattern: deep CTE nesting
-- Anti-pattern: repeated joins to same dimension tables

with position_base as (
    select
        pos.position_id,
        pos.portfolio_id,
        pos.instrument_id,
        pos.position_date,
        pos.quantity,
        pos.market_value,
        pos.cost_basis,
        pos.unrealized_gain_loss,
        pos.unrealized_return_pct,
        pos.currency
    from "bain_analytics"."public"."stg_positions" pos
),

-- Anti-pattern: CTE level 2 - join instruments (same join as int_trade_enriched)
position_with_instruments as (
    select
        pb.*,
        i.instrument_name,
        i.instrument_type,
        i.sector,
        i.liquidity_class
    from position_base pb
    inner join "bain_analytics"."public"."stg_instruments" i
        on pb.instrument_id = i.instrument_id
),

-- Anti-pattern: CTE level 3 - join portfolios (same join as int_trade_enriched)
position_with_portfolio as (
    select
        pwi.*,
        p.portfolio_name,
        p.strategy,
        p.fund_id
    from position_with_instruments pwi
    inner join "bain_analytics"."public"."stg_portfolios" p
        on pwi.portfolio_id = p.portfolio_id
),

-- Anti-pattern: CTE level 4 - join dates
position_with_dates as (
    select
        pwp.*,
        d.is_business_day,
        d.is_month_end,
        d.is_quarter_end,
        d.fiscal_quarter,
        d.fiscal_year
    from position_with_portfolio pwp
    inner join "bain_analytics"."public"."stg_dates" d
        on pwp.position_date = d.date_day
),

-- Anti-pattern: CTE level 5 - compute window functions
position_with_analytics as (
    select
        pwd.*,
        -- Anti-pattern: multiple window functions on same partition
        lag(pwd.market_value) over (
            partition by pwd.portfolio_id, pwd.instrument_id
            order by pwd.position_date
        ) as prev_market_value,
        pwd.market_value - coalesce(
            lag(pwd.market_value) over (
                partition by pwd.portfolio_id, pwd.instrument_id
                order by pwd.position_date
            ), pwd.cost_basis
        ) as daily_pnl,
        sum(pwd.market_value) over (
            partition by pwd.portfolio_id, pwd.position_date
        ) as portfolio_total_mv,
        case
            when sum(pwd.market_value) over (partition by pwd.portfolio_id, pwd.position_date) != 0
            then pwd.market_value / sum(pwd.market_value) over (partition by pwd.portfolio_id, pwd.position_date)
            else 0
        end as weight_in_portfolio
    from position_with_dates pwd
)

select * from position_with_analytics
  );
[0m19:24:53.054797 [debug] [Thread-1  ]: On model.bain_capital_analytics.int_trade_enriched: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.int_trade_enriched"} */

  create view "bain_analytics"."public"."int_trade_enriched__dbt_tmp"
    
    
  as (
    -- Pipeline B: Enriched trade data with instrument and counterparty details
-- Anti-pattern: subquery for dedup instead of QUALIFY (Snowflake)
-- Anti-pattern: heavy join that will be repeated in multiple downstream models

with latest_trades as (
    -- Anti-pattern: subquery to filter row_number instead of QUALIFY
    select *
    from (
        select
            t.*,
            i.instrument_name,
            i.instrument_type,
            i.sector,
            i.liquidity_class,
            c.counterparty_name,
            c.counterparty_type,
            c.credit_rating,
            p.portfolio_name,
            p.strategy,
            p.manager_name,
            -- Anti-pattern: duplicated fiscal quarter logic AGAIN
            case
                when extract(month from t.trade_date) between 1 and 3 then 'Q3'
                when extract(month from t.trade_date) between 4 and 6 then 'Q4'
                when extract(month from t.trade_date) between 7 and 9 then 'Q1'
                when extract(month from t.trade_date) between 10 and 12 then 'Q2'
            end as fiscal_quarter,
            row_number() over (
                partition by t.portfolio_id, t.instrument_id, t.trade_date
                order by t.trade_id desc
            ) as rn
        from "bain_analytics"."public"."stg_trades" t
        -- Anti-pattern: these 3 joins are repeated in fact_portfolio_pnl and fact_trade_activity
        inner join "bain_analytics"."public"."stg_instruments" i
            on t.instrument_id = i.instrument_id
        inner join "bain_analytics"."public"."stg_counterparties" c
            on t.counterparty_id = c.counterparty_id
        inner join "bain_analytics"."public"."stg_portfolios" p
            on t.portfolio_id = p.portfolio_id
    ) sub
    where rn = 1
)

select
    trade_id,
    portfolio_id,
    portfolio_name,
    strategy,
    manager_name,
    instrument_id,
    instrument_name,
    instrument_type,
    sector,
    liquidity_class,
    counterparty_id,
    counterparty_name,
    counterparty_type,
    credit_rating,
    trade_date,
    settlement_date,
    trade_type,
    quantity,
    price,
    notional_amount,
    commission,
    currency,
    fiscal_quarter,
    settlement_days,
    -- Anti-pattern: running total computed here AND again in downstream models
    sum(notional_amount) over (
        partition by portfolio_id
        order by trade_date
        rows between unbounded preceding and current row
    ) as cumulative_notional
from latest_trades
  );
[0m19:24:53.063004 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.008 seconds
[0m19:24:53.063316 [debug] [Thread-2  ]: SQL status: CREATE VIEW in 0.009 seconds
[0m19:24:53.063608 [debug] [Thread-3  ]: SQL status: CREATE VIEW in 0.008 seconds
[0m19:24:53.066621 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.int_trade_enriched"
[0m19:24:53.069268 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.fact_trade_activity"
[0m19:24:53.071763 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.int_daily_positions"
[0m19:24:53.072090 [debug] [Thread-1  ]: On model.bain_capital_analytics.int_trade_enriched: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.int_trade_enriched"} */
alter table "bain_analytics"."public"."int_trade_enriched__dbt_tmp" rename to "int_trade_enriched"
[0m19:24:53.072405 [debug] [Thread-2  ]: On model.bain_capital_analytics.fact_trade_activity: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.fact_trade_activity"} */
alter table "bain_analytics"."public"."fact_trade_activity__dbt_tmp" rename to "fact_trade_activity"
[0m19:24:53.072714 [debug] [Thread-3  ]: On model.bain_capital_analytics.int_daily_positions: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.int_daily_positions"} */
alter table "bain_analytics"."public"."int_daily_positions__dbt_tmp" rename to "int_daily_positions"
[0m19:24:53.074268 [debug] [Thread-2  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m19:24:53.074594 [debug] [Thread-3  ]: SQL status: ALTER TABLE in 0.002 seconds
[0m19:24:53.074865 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.002 seconds
[0m19:24:53.075877 [debug] [Thread-2  ]: On model.bain_capital_analytics.fact_trade_activity: COMMIT
[0m19:24:53.076805 [debug] [Thread-3  ]: On model.bain_capital_analytics.int_daily_positions: COMMIT
[0m19:24:53.077828 [debug] [Thread-1  ]: On model.bain_capital_analytics.int_trade_enriched: COMMIT
[0m19:24:53.078134 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.fact_trade_activity"
[0m19:24:53.078425 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.int_daily_positions"
[0m19:24:53.078708 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.int_trade_enriched"
[0m19:24:53.078994 [debug] [Thread-2  ]: On model.bain_capital_analytics.fact_trade_activity: COMMIT
[0m19:24:53.079275 [debug] [Thread-3  ]: On model.bain_capital_analytics.int_daily_positions: COMMIT
[0m19:24:53.079549 [debug] [Thread-1  ]: On model.bain_capital_analytics.int_trade_enriched: COMMIT
[0m19:24:53.081378 [debug] [Thread-2  ]: SQL status: COMMIT in 0.002 seconds
[0m19:24:53.083531 [debug] [Thread-2  ]: Applying DROP to: "bain_analytics"."public"."fact_trade_activity__dbt_backup"
[0m19:24:53.083834 [debug] [Thread-1  ]: SQL status: COMMIT in 0.004 seconds
[0m19:24:53.084113 [debug] [Thread-3  ]: SQL status: COMMIT in 0.004 seconds
[0m19:24:53.084563 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.fact_trade_activity"
[0m19:24:53.087572 [debug] [Thread-1  ]: Applying DROP to: "bain_analytics"."public"."int_trade_enriched__dbt_backup"
[0m19:24:53.089615 [debug] [Thread-3  ]: Applying DROP to: "bain_analytics"."public"."int_daily_positions__dbt_backup"
[0m19:24:53.089925 [debug] [Thread-2  ]: On model.bain_capital_analytics.fact_trade_activity: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.fact_trade_activity"} */
drop view if exists "bain_analytics"."public"."fact_trade_activity__dbt_backup" cascade
[0m19:24:53.090422 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.int_trade_enriched"
[0m19:24:53.090874 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.int_daily_positions"
[0m19:24:53.091213 [debug] [Thread-1  ]: On model.bain_capital_analytics.int_trade_enriched: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.int_trade_enriched"} */
drop view if exists "bain_analytics"."public"."int_trade_enriched__dbt_backup" cascade
[0m19:24:53.091521 [debug] [Thread-3  ]: On model.bain_capital_analytics.int_daily_positions: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.int_daily_positions"} */
drop view if exists "bain_analytics"."public"."int_daily_positions__dbt_backup" cascade
[0m19:24:53.091971 [debug] [Thread-2  ]: SQL status: DROP VIEW in 0.001 seconds
[0m19:24:53.092998 [debug] [Thread-2  ]: On model.bain_capital_analytics.fact_trade_activity: Close
[0m19:24:53.093331 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.002 seconds
[0m19:24:53.093824 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '11234c95-e197-4418-bde7-98b392860bc9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11002d760>]}
[0m19:24:53.094763 [debug] [Thread-1  ]: On model.bain_capital_analytics.int_trade_enriched: Close
[0m19:24:53.095046 [debug] [Thread-3  ]: SQL status: DROP VIEW in 0.003 seconds
[0m19:24:53.095575 [info ] [Thread-2  ]: 27 of 40 OK created sql view model public.fact_trade_activity .................. [[32mCREATE VIEW[0m in 0.13s]
[0m19:24:53.096031 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '11234c95-e197-4418-bde7-98b392860bc9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1103b5dc0>]}
[0m19:24:53.096941 [debug] [Thread-3  ]: On model.bain_capital_analytics.int_daily_positions: Close
[0m19:24:53.097369 [debug] [Thread-2  ]: Finished running node model.bain_capital_analytics.fact_trade_activity
[0m19:24:53.097831 [info ] [Thread-1  ]: 28 of 40 OK created sql view model public.int_trade_enriched ................... [[32mCREATE VIEW[0m in 0.13s]
[0m19:24:53.098324 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '11234c95-e197-4418-bde7-98b392860bc9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1101ae820>]}
[0m19:24:53.098823 [debug] [Thread-1  ]: Finished running node model.bain_capital_analytics.int_trade_enriched
[0m19:24:53.099289 [debug] [Thread-4  ]: Began running node test.bain_capital_analytics.not_null_fact_trade_activity_trade_id.6ec5fc5e45
[0m19:24:53.099691 [info ] [Thread-3  ]: 29 of 40 OK created sql view model public.int_daily_positions .................. [[32mCREATE VIEW[0m in 0.13s]
[0m19:24:53.100016 [debug] [Thread-2  ]: Began running node test.bain_capital_analytics.unique_fact_trade_activity_trade_id.e03d2f9a00
[0m19:24:53.100413 [info ] [Thread-4  ]: 30 of 40 START test not_null_fact_trade_activity_trade_id ...................... [RUN]
[0m19:24:53.100907 [debug] [Thread-3  ]: Finished running node model.bain_capital_analytics.int_daily_positions
[0m19:24:53.101214 [debug] [Thread-1  ]: Began running node test.bain_capital_analytics.not_null_int_trade_enriched_trade_id.020f969dc8
[0m19:24:53.101532 [info ] [Thread-2  ]: 31 of 40 START test unique_fact_trade_activity_trade_id ........................ [RUN]
[0m19:24:53.101905 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_.2823f12709, now test.bain_capital_analytics.not_null_fact_trade_activity_trade_id.6ec5fc5e45)
[0m19:24:53.102243 [debug] [Thread-3  ]: Began running node test.bain_capital_analytics.unique_int_trade_enriched_trade_id.9cdb3dc82a
[0m19:24:53.102591 [info ] [Thread-1  ]: 32 of 40 START test not_null_int_trade_enriched_trade_id ....................... [RUN]
[0m19:24:53.102979 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly model.bain_capital_analytics.fact_trade_activity, now test.bain_capital_analytics.unique_fact_trade_activity_trade_id.e03d2f9a00)
[0m19:24:53.103303 [debug] [Thread-4  ]: Began compiling node test.bain_capital_analytics.not_null_fact_trade_activity_trade_id.6ec5fc5e45
[0m19:24:53.103606 [info ] [Thread-3  ]: 33 of 40 START test unique_int_trade_enriched_trade_id ......................... [RUN]
[0m19:24:53.103944 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.bain_capital_analytics.int_trade_enriched, now test.bain_capital_analytics.not_null_int_trade_enriched_trade_id.020f969dc8)
[0m19:24:53.104245 [debug] [Thread-2  ]: Began compiling node test.bain_capital_analytics.unique_fact_trade_activity_trade_id.e03d2f9a00
[0m19:24:53.108007 [debug] [Thread-4  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_fact_trade_activity_trade_id.6ec5fc5e45"
[0m19:24:53.108354 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly model.bain_capital_analytics.int_daily_positions, now test.bain_capital_analytics.unique_int_trade_enriched_trade_id.9cdb3dc82a)
[0m19:24:53.108661 [debug] [Thread-1  ]: Began compiling node test.bain_capital_analytics.not_null_int_trade_enriched_trade_id.020f969dc8
[0m19:24:53.111905 [debug] [Thread-2  ]: Writing injected SQL for node "test.bain_capital_analytics.unique_fact_trade_activity_trade_id.e03d2f9a00"
[0m19:24:53.112307 [debug] [Thread-3  ]: Began compiling node test.bain_capital_analytics.unique_int_trade_enriched_trade_id.9cdb3dc82a
[0m19:24:53.115575 [debug] [Thread-1  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_int_trade_enriched_trade_id.020f969dc8"
[0m19:24:53.118847 [debug] [Thread-3  ]: Writing injected SQL for node "test.bain_capital_analytics.unique_int_trade_enriched_trade_id.9cdb3dc82a"
[0m19:24:53.119309 [debug] [Thread-4  ]: Began executing node test.bain_capital_analytics.not_null_fact_trade_activity_trade_id.6ec5fc5e45
[0m19:24:53.119701 [debug] [Thread-2  ]: Began executing node test.bain_capital_analytics.unique_fact_trade_activity_trade_id.e03d2f9a00
[0m19:24:53.123156 [debug] [Thread-4  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_fact_trade_activity_trade_id.6ec5fc5e45"
[0m19:24:53.125454 [debug] [Thread-2  ]: Writing runtime sql for node "test.bain_capital_analytics.unique_fact_trade_activity_trade_id.e03d2f9a00"
[0m19:24:53.125753 [debug] [Thread-1  ]: Began executing node test.bain_capital_analytics.not_null_int_trade_enriched_trade_id.020f969dc8
[0m19:24:53.126069 [debug] [Thread-3  ]: Began executing node test.bain_capital_analytics.unique_int_trade_enriched_trade_id.9cdb3dc82a
[0m19:24:53.128438 [debug] [Thread-1  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_int_trade_enriched_trade_id.020f969dc8"
[0m19:24:53.130585 [debug] [Thread-3  ]: Writing runtime sql for node "test.bain_capital_analytics.unique_int_trade_enriched_trade_id.9cdb3dc82a"
[0m19:24:53.130955 [debug] [Thread-4  ]: Using postgres connection "test.bain_capital_analytics.not_null_fact_trade_activity_trade_id.6ec5fc5e45"
[0m19:24:53.131380 [debug] [Thread-2  ]: Using postgres connection "test.bain_capital_analytics.unique_fact_trade_activity_trade_id.e03d2f9a00"
[0m19:24:53.131748 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_fact_trade_activity_trade_id.6ec5fc5e45: BEGIN
[0m19:24:53.132059 [debug] [Thread-2  ]: On test.bain_capital_analytics.unique_fact_trade_activity_trade_id.e03d2f9a00: BEGIN
[0m19:24:53.132370 [debug] [Thread-4  ]: Opening a new connection, currently in state closed
[0m19:24:53.132704 [debug] [Thread-1  ]: Using postgres connection "test.bain_capital_analytics.not_null_int_trade_enriched_trade_id.020f969dc8"
[0m19:24:53.133007 [debug] [Thread-2  ]: Opening a new connection, currently in state closed
[0m19:24:53.133337 [debug] [Thread-3  ]: Using postgres connection "test.bain_capital_analytics.unique_int_trade_enriched_trade_id.9cdb3dc82a"
[0m19:24:53.133724 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_int_trade_enriched_trade_id.020f969dc8: BEGIN
[0m19:24:53.134095 [debug] [Thread-3  ]: On test.bain_capital_analytics.unique_int_trade_enriched_trade_id.9cdb3dc82a: BEGIN
[0m19:24:53.134373 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m19:24:53.134656 [debug] [Thread-3  ]: Opening a new connection, currently in state closed
[0m19:24:53.149890 [debug] [Thread-4  ]: SQL status: BEGIN in 0.017 seconds
[0m19:24:53.150274 [debug] [Thread-1  ]: SQL status: BEGIN in 0.016 seconds
[0m19:24:53.150583 [debug] [Thread-2  ]: SQL status: BEGIN in 0.018 seconds
[0m19:24:53.150881 [debug] [Thread-3  ]: SQL status: BEGIN in 0.016 seconds
[0m19:24:53.151163 [debug] [Thread-4  ]: Using postgres connection "test.bain_capital_analytics.not_null_fact_trade_activity_trade_id.6ec5fc5e45"
[0m19:24:53.151475 [debug] [Thread-1  ]: Using postgres connection "test.bain_capital_analytics.not_null_int_trade_enriched_trade_id.020f969dc8"
[0m19:24:53.151767 [debug] [Thread-2  ]: Using postgres connection "test.bain_capital_analytics.unique_fact_trade_activity_trade_id.e03d2f9a00"
[0m19:24:53.152058 [debug] [Thread-3  ]: Using postgres connection "test.bain_capital_analytics.unique_int_trade_enriched_trade_id.9cdb3dc82a"
[0m19:24:53.152360 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_fact_trade_activity_trade_id.6ec5fc5e45: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_fact_trade_activity_trade_id.6ec5fc5e45"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select trade_id
from "bain_analytics"."public"."fact_trade_activity"
where trade_id is null



  
  
      
    ) dbt_internal_test
[0m19:24:53.152684 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_int_trade_enriched_trade_id.020f969dc8: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_int_trade_enriched_trade_id.020f969dc8"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select trade_id
from "bain_analytics"."public"."int_trade_enriched"
where trade_id is null



  
  
      
    ) dbt_internal_test
[0m19:24:53.153017 [debug] [Thread-2  ]: On test.bain_capital_analytics.unique_fact_trade_activity_trade_id.e03d2f9a00: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.unique_fact_trade_activity_trade_id.e03d2f9a00"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

select
    trade_id as unique_field,
    count(*) as n_records

from "bain_analytics"."public"."fact_trade_activity"
where trade_id is not null
group by trade_id
having count(*) > 1



  
  
      
    ) dbt_internal_test
[0m19:24:53.153343 [debug] [Thread-3  ]: On test.bain_capital_analytics.unique_int_trade_enriched_trade_id.9cdb3dc82a: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.unique_int_trade_enriched_trade_id.9cdb3dc82a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

select
    trade_id as unique_field,
    count(*) as n_records

from "bain_analytics"."public"."int_trade_enriched"
where trade_id is not null
group by trade_id
having count(*) > 1



  
  
      
    ) dbt_internal_test
[0m19:24:53.161455 [debug] [Thread-2  ]: SQL status: SELECT 1 in 0.008 seconds
[0m19:24:53.161840 [debug] [Thread-1  ]: SQL status: SELECT 1 in 0.008 seconds
[0m19:24:53.162186 [debug] [Thread-3  ]: SQL status: SELECT 1 in 0.008 seconds
[0m19:24:53.163506 [debug] [Thread-2  ]: On test.bain_capital_analytics.unique_fact_trade_activity_trade_id.e03d2f9a00: ROLLBACK
[0m19:24:53.163825 [debug] [Thread-4  ]: SQL status: SELECT 1 in 0.010 seconds
[0m19:24:53.164904 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_int_trade_enriched_trade_id.020f969dc8: ROLLBACK
[0m19:24:53.165916 [debug] [Thread-3  ]: On test.bain_capital_analytics.unique_int_trade_enriched_trade_id.9cdb3dc82a: ROLLBACK
[0m19:24:53.167042 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_fact_trade_activity_trade_id.6ec5fc5e45: ROLLBACK
[0m19:24:53.167368 [debug] [Thread-2  ]: On test.bain_capital_analytics.unique_fact_trade_activity_trade_id.e03d2f9a00: Close
[0m19:24:53.167981 [info ] [Thread-2  ]: 31 of 40 PASS unique_fact_trade_activity_trade_id .............................. [[32mPASS[0m in 0.06s]
[0m19:24:53.168322 [debug] [Thread-3  ]: On test.bain_capital_analytics.unique_int_trade_enriched_trade_id.9cdb3dc82a: Close
[0m19:24:53.168604 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_fact_trade_activity_trade_id.6ec5fc5e45: Close
[0m19:24:53.168869 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_int_trade_enriched_trade_id.020f969dc8: Close
[0m19:24:53.169273 [debug] [Thread-2  ]: Finished running node test.bain_capital_analytics.unique_fact_trade_activity_trade_id.e03d2f9a00
[0m19:24:53.169730 [info ] [Thread-3  ]: 33 of 40 PASS unique_int_trade_enriched_trade_id ............................... [[32mPASS[0m in 0.06s]
[0m19:24:53.170177 [info ] [Thread-4  ]: 30 of 40 PASS not_null_fact_trade_activity_trade_id ............................ [[32mPASS[0m in 0.07s]
[0m19:24:53.170617 [info ] [Thread-1  ]: 32 of 40 PASS not_null_int_trade_enriched_trade_id ............................. [[32mPASS[0m in 0.07s]
[0m19:24:53.170960 [debug] [Thread-2  ]: Began running node test.bain_capital_analytics.not_null_int_daily_positions_position_id.198d23a5e6
[0m19:24:53.171430 [debug] [Thread-3  ]: Finished running node test.bain_capital_analytics.unique_int_trade_enriched_trade_id.9cdb3dc82a
[0m19:24:53.171837 [debug] [Thread-4  ]: Finished running node test.bain_capital_analytics.not_null_fact_trade_activity_trade_id.6ec5fc5e45
[0m19:24:53.172230 [debug] [Thread-1  ]: Finished running node test.bain_capital_analytics.not_null_int_trade_enriched_trade_id.020f969dc8
[0m19:24:53.172540 [info ] [Thread-2  ]: 34 of 40 START test not_null_int_daily_positions_position_id ................... [RUN]
[0m19:24:53.173062 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.unique_fact_trade_activity_trade_id.e03d2f9a00, now test.bain_capital_analytics.not_null_int_daily_positions_position_id.198d23a5e6)
[0m19:24:53.173377 [debug] [Thread-2  ]: Began compiling node test.bain_capital_analytics.not_null_int_daily_positions_position_id.198d23a5e6
[0m19:24:53.177528 [debug] [Thread-2  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_int_daily_positions_position_id.198d23a5e6"
[0m19:24:53.178124 [debug] [Thread-2  ]: Began executing node test.bain_capital_analytics.not_null_int_daily_positions_position_id.198d23a5e6
[0m19:24:53.180394 [debug] [Thread-2  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_int_daily_positions_position_id.198d23a5e6"
[0m19:24:53.180902 [debug] [Thread-2  ]: Using postgres connection "test.bain_capital_analytics.not_null_int_daily_positions_position_id.198d23a5e6"
[0m19:24:53.181200 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_int_daily_positions_position_id.198d23a5e6: BEGIN
[0m19:24:53.181476 [debug] [Thread-2  ]: Opening a new connection, currently in state closed
[0m19:24:53.191725 [debug] [Thread-2  ]: SQL status: BEGIN in 0.010 seconds
[0m19:24:53.192023 [debug] [Thread-2  ]: Using postgres connection "test.bain_capital_analytics.not_null_int_daily_positions_position_id.198d23a5e6"
[0m19:24:53.192325 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_int_daily_positions_position_id.198d23a5e6: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_int_daily_positions_position_id.198d23a5e6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select position_id
from "bain_analytics"."public"."int_daily_positions"
where position_id is null



  
  
      
    ) dbt_internal_test
[0m19:24:53.198793 [debug] [Thread-2  ]: SQL status: SELECT 1 in 0.006 seconds
[0m19:24:53.199979 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_int_daily_positions_position_id.198d23a5e6: ROLLBACK
[0m19:24:53.200635 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_int_daily_positions_position_id.198d23a5e6: Close
[0m19:24:53.201124 [info ] [Thread-2  ]: 34 of 40 PASS not_null_int_daily_positions_position_id ......................... [[32mPASS[0m in 0.03s]
[0m19:24:53.201580 [debug] [Thread-2  ]: Finished running node test.bain_capital_analytics.not_null_int_daily_positions_position_id.198d23a5e6
[0m19:24:53.202169 [debug] [Thread-3  ]: Began running node model.bain_capital_analytics.fact_portfolio_pnl
[0m19:24:53.202610 [info ] [Thread-3  ]: 35 of 40 START sql view model public.fact_portfolio_pnl ........................ [RUN]
[0m19:24:53.203040 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.unique_int_trade_enriched_trade_id.9cdb3dc82a, now model.bain_capital_analytics.fact_portfolio_pnl)
[0m19:24:53.203376 [debug] [Thread-3  ]: Began compiling node model.bain_capital_analytics.fact_portfolio_pnl
[0m19:24:53.208788 [debug] [Thread-3  ]: Writing injected SQL for node "model.bain_capital_analytics.fact_portfolio_pnl"
[0m19:24:53.209350 [debug] [Thread-3  ]: Began executing node model.bain_capital_analytics.fact_portfolio_pnl
[0m19:24:53.212645 [debug] [Thread-3  ]: Writing runtime sql for node "model.bain_capital_analytics.fact_portfolio_pnl"
[0m19:24:53.213164 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.fact_portfolio_pnl"
[0m19:24:53.213461 [debug] [Thread-3  ]: On model.bain_capital_analytics.fact_portfolio_pnl: BEGIN
[0m19:24:53.213737 [debug] [Thread-3  ]: Opening a new connection, currently in state closed
[0m19:24:53.221842 [debug] [Thread-3  ]: SQL status: BEGIN in 0.008 seconds
[0m19:24:53.222152 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.fact_portfolio_pnl"
[0m19:24:53.222606 [debug] [Thread-3  ]: On model.bain_capital_analytics.fact_portfolio_pnl: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.fact_portfolio_pnl"} */

  create view "bain_analytics"."public"."fact_portfolio_pnl__dbt_tmp"
    
    
  as (
    -- Pipeline B: FACT table - Portfolio PnL by date
-- Anti-pattern: repeats the same heavy 3-table join as int_trade_enriched
-- Anti-pattern: late aggregation after expensive joins
-- Anti-pattern: materialized as view (should be table/incremental)

with trade_pnl as (
    -- Anti-pattern: re-joining trades to instruments and portfolios
    -- (same join already done in int_trade_enriched)
    select
        t.portfolio_id,
        t.trade_date,
        t.instrument_id,
        t.trade_type,
        t.notional_amount,
        t.commission,
        i.instrument_name,
        i.instrument_type,
        i.sector,
        p.portfolio_name,
        p.strategy,
        p.fund_id,
        d.fiscal_quarter,
        d.fiscal_year,
        d.is_month_end,
        d.is_quarter_end
    from "bain_analytics"."public"."stg_trades" t
    inner join "bain_analytics"."public"."stg_instruments" i
        on t.instrument_id = i.instrument_id
    inner join "bain_analytics"."public"."stg_portfolios" p
        on t.portfolio_id = p.portfolio_id
    inner join "bain_analytics"."public"."stg_dates" d
        on t.trade_date = d.date_day
),

position_pnl as (
    select
        dp.portfolio_id,
        dp.position_date,
        dp.portfolio_name,
        dp.strategy,
        dp.fund_id,
        dp.fiscal_quarter,
        dp.fiscal_year,
        sum(dp.daily_pnl) as position_daily_pnl,
        sum(dp.market_value) as total_market_value,
        count(distinct dp.instrument_id) as num_positions
    from "bain_analytics"."public"."int_daily_positions" dp
    group by
        dp.portfolio_id, dp.position_date, dp.portfolio_name,
        dp.strategy, dp.fund_id, dp.fiscal_quarter, dp.fiscal_year
),

-- Anti-pattern: aggregating trades separately then joining back
trade_activity as (
    select
        portfolio_id,
        trade_date,
        sum(notional_amount) as total_traded_notional,
        sum(commission) as total_commissions,
        count(*) as num_trades
    from trade_pnl
    group by portfolio_id, trade_date
)

select
    pp.portfolio_id,
    pp.portfolio_name,
    pp.strategy,
    pp.fund_id,
    pp.position_date as pnl_date,
    pp.fiscal_quarter,
    pp.fiscal_year,
    pp.position_daily_pnl,
    pp.total_market_value,
    pp.num_positions,
    coalesce(ta.total_traded_notional, 0) as total_traded_notional,
    coalesce(ta.total_commissions, 0) as total_commissions,
    coalesce(ta.num_trades, 0) as num_trades,
    -- Anti-pattern: running total recomputed here (already in int_trade_enriched)
    sum(pp.position_daily_pnl) over (
        partition by pp.portfolio_id
        order by pp.position_date
        rows between unbounded preceding and current row
    ) as cumulative_pnl
from position_pnl pp
left join trade_activity ta
    on pp.portfolio_id = ta.portfolio_id
    and pp.position_date = ta.trade_date
  );
[0m19:24:53.229004 [debug] [Thread-3  ]: SQL status: CREATE VIEW in 0.006 seconds
[0m19:24:53.232007 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.fact_portfolio_pnl"
[0m19:24:53.232321 [debug] [Thread-3  ]: On model.bain_capital_analytics.fact_portfolio_pnl: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.fact_portfolio_pnl"} */
alter table "bain_analytics"."public"."fact_portfolio_pnl__dbt_tmp" rename to "fact_portfolio_pnl"
[0m19:24:53.233353 [debug] [Thread-3  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m19:24:53.234349 [debug] [Thread-3  ]: On model.bain_capital_analytics.fact_portfolio_pnl: COMMIT
[0m19:24:53.234657 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.fact_portfolio_pnl"
[0m19:24:53.234936 [debug] [Thread-3  ]: On model.bain_capital_analytics.fact_portfolio_pnl: COMMIT
[0m19:24:53.235999 [debug] [Thread-3  ]: SQL status: COMMIT in 0.001 seconds
[0m19:24:53.238173 [debug] [Thread-3  ]: Applying DROP to: "bain_analytics"."public"."fact_portfolio_pnl__dbt_backup"
[0m19:24:53.238638 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.fact_portfolio_pnl"
[0m19:24:53.238940 [debug] [Thread-3  ]: On model.bain_capital_analytics.fact_portfolio_pnl: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.fact_portfolio_pnl"} */
drop view if exists "bain_analytics"."public"."fact_portfolio_pnl__dbt_backup" cascade
[0m19:24:53.239600 [debug] [Thread-3  ]: SQL status: DROP VIEW in 0.000 seconds
[0m19:24:53.240660 [debug] [Thread-3  ]: On model.bain_capital_analytics.fact_portfolio_pnl: Close
[0m19:24:53.241334 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '11234c95-e197-4418-bde7-98b392860bc9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10afa0370>]}
[0m19:24:53.241932 [info ] [Thread-3  ]: 35 of 40 OK created sql view model public.fact_portfolio_pnl ................... [[32mCREATE VIEW[0m in 0.04s]
[0m19:24:53.242400 [debug] [Thread-3  ]: Finished running node model.bain_capital_analytics.fact_portfolio_pnl
[0m19:24:53.243226 [debug] [Thread-1  ]: Began running node test.bain_capital_analytics.assert_pnl_balanced
[0m19:24:53.243615 [debug] [Thread-2  ]: Began running node test.bain_capital_analytics.not_null_fact_portfolio_pnl_pnl_date.1a8f6bfde4
[0m19:24:53.243939 [info ] [Thread-1  ]: 36 of 40 START test assert_pnl_balanced ........................................ [RUN]
[0m19:24:53.244307 [debug] [Thread-4  ]: Began running node test.bain_capital_analytics.not_null_fact_portfolio_pnl_portfolio_id.f71baa71b4
[0m19:24:53.244633 [info ] [Thread-2  ]: 37 of 40 START test not_null_fact_portfolio_pnl_pnl_date ....................... [RUN]
[0m19:24:53.245023 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.not_null_int_trade_enriched_trade_id.020f969dc8, now test.bain_capital_analytics.assert_pnl_balanced)
[0m19:24:53.245363 [info ] [Thread-4  ]: 38 of 40 START test not_null_fact_portfolio_pnl_portfolio_id ................... [RUN]
[0m19:24:53.245700 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.not_null_int_daily_positions_position_id.198d23a5e6, now test.bain_capital_analytics.not_null_fact_portfolio_pnl_pnl_date.1a8f6bfde4)
[0m19:24:53.246007 [debug] [Thread-1  ]: Began compiling node test.bain_capital_analytics.assert_pnl_balanced
[0m19:24:53.246315 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.not_null_fact_trade_activity_trade_id.6ec5fc5e45, now test.bain_capital_analytics.not_null_fact_portfolio_pnl_portfolio_id.f71baa71b4)
[0m19:24:53.246619 [debug] [Thread-2  ]: Began compiling node test.bain_capital_analytics.not_null_fact_portfolio_pnl_pnl_date.1a8f6bfde4
[0m19:24:53.249611 [debug] [Thread-1  ]: Writing injected SQL for node "test.bain_capital_analytics.assert_pnl_balanced"
[0m19:24:53.249932 [debug] [Thread-4  ]: Began compiling node test.bain_capital_analytics.not_null_fact_portfolio_pnl_portfolio_id.f71baa71b4
[0m19:24:53.254746 [debug] [Thread-2  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_fact_portfolio_pnl_pnl_date.1a8f6bfde4"
[0m19:24:53.258299 [debug] [Thread-4  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_fact_portfolio_pnl_portfolio_id.f71baa71b4"
[0m19:24:53.258906 [debug] [Thread-1  ]: Began executing node test.bain_capital_analytics.assert_pnl_balanced
[0m19:24:53.259232 [debug] [Thread-2  ]: Began executing node test.bain_capital_analytics.not_null_fact_portfolio_pnl_pnl_date.1a8f6bfde4
[0m19:24:53.261595 [debug] [Thread-1  ]: Writing runtime sql for node "test.bain_capital_analytics.assert_pnl_balanced"
[0m19:24:53.261890 [debug] [Thread-4  ]: Began executing node test.bain_capital_analytics.not_null_fact_portfolio_pnl_portfolio_id.f71baa71b4
[0m19:24:53.264087 [debug] [Thread-2  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_fact_portfolio_pnl_pnl_date.1a8f6bfde4"
[0m19:24:53.266281 [debug] [Thread-4  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_fact_portfolio_pnl_portfolio_id.f71baa71b4"
[0m19:24:53.266822 [debug] [Thread-1  ]: Using postgres connection "test.bain_capital_analytics.assert_pnl_balanced"
[0m19:24:53.267172 [debug] [Thread-1  ]: On test.bain_capital_analytics.assert_pnl_balanced: BEGIN
[0m19:24:53.267514 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m19:24:53.267952 [debug] [Thread-4  ]: Using postgres connection "test.bain_capital_analytics.not_null_fact_portfolio_pnl_portfolio_id.f71baa71b4"
[0m19:24:53.268284 [debug] [Thread-2  ]: Using postgres connection "test.bain_capital_analytics.not_null_fact_portfolio_pnl_pnl_date.1a8f6bfde4"
[0m19:24:53.268587 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_fact_portfolio_pnl_portfolio_id.f71baa71b4: BEGIN
[0m19:24:53.268905 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_fact_portfolio_pnl_pnl_date.1a8f6bfde4: BEGIN
[0m19:24:53.269207 [debug] [Thread-4  ]: Opening a new connection, currently in state closed
[0m19:24:53.269491 [debug] [Thread-2  ]: Opening a new connection, currently in state closed
[0m19:24:53.277583 [debug] [Thread-1  ]: SQL status: BEGIN in 0.010 seconds
[0m19:24:53.277899 [debug] [Thread-1  ]: Using postgres connection "test.bain_capital_analytics.assert_pnl_balanced"
[0m19:24:53.278271 [debug] [Thread-1  ]: On test.bain_capital_analytics.assert_pnl_balanced: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.assert_pnl_balanced"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  -- Custom test: Ensure total PnL across all portfolios is reasonable
-- (not wildly negative, which would indicate a data or logic error)

select
    pnl_date,
    sum(position_daily_pnl) as total_daily_pnl
from "bain_analytics"."public"."fact_portfolio_pnl"
group by pnl_date
having sum(position_daily_pnl) < -100000000  -- flag if total daily loss exceeds $100M
  
  
      
    ) dbt_internal_test
[0m19:24:53.278737 [debug] [Thread-2  ]: SQL status: BEGIN in 0.009 seconds
[0m19:24:53.279064 [debug] [Thread-4  ]: SQL status: BEGIN in 0.010 seconds
[0m19:24:53.279356 [debug] [Thread-2  ]: Using postgres connection "test.bain_capital_analytics.not_null_fact_portfolio_pnl_pnl_date.1a8f6bfde4"
[0m19:24:53.279656 [debug] [Thread-4  ]: Using postgres connection "test.bain_capital_analytics.not_null_fact_portfolio_pnl_portfolio_id.f71baa71b4"
[0m19:24:53.279971 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_fact_portfolio_pnl_pnl_date.1a8f6bfde4: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_fact_portfolio_pnl_pnl_date.1a8f6bfde4"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select pnl_date
from "bain_analytics"."public"."fact_portfolio_pnl"
where pnl_date is null



  
  
      
    ) dbt_internal_test
[0m19:24:53.280297 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_fact_portfolio_pnl_portfolio_id.f71baa71b4: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_fact_portfolio_pnl_portfolio_id.f71baa71b4"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select portfolio_id
from "bain_analytics"."public"."fact_portfolio_pnl"
where portfolio_id is null



  
  
      
    ) dbt_internal_test
[0m19:24:53.287050 [debug] [Thread-1  ]: SQL status: SELECT 1 in 0.008 seconds
[0m19:24:53.287367 [debug] [Thread-4  ]: SQL status: SELECT 1 in 0.007 seconds
[0m19:24:53.288761 [debug] [Thread-1  ]: On test.bain_capital_analytics.assert_pnl_balanced: ROLLBACK
[0m19:24:53.289061 [debug] [Thread-2  ]: SQL status: SELECT 1 in 0.008 seconds
[0m19:24:53.290099 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_fact_portfolio_pnl_portfolio_id.f71baa71b4: ROLLBACK
[0m19:24:53.291270 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_fact_portfolio_pnl_pnl_date.1a8f6bfde4: ROLLBACK
[0m19:24:53.291585 [debug] [Thread-1  ]: On test.bain_capital_analytics.assert_pnl_balanced: Close
[0m19:24:53.292197 [info ] [Thread-1  ]: 36 of 40 PASS assert_pnl_balanced .............................................. [[32mPASS[0m in 0.05s]
[0m19:24:53.292555 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_fact_portfolio_pnl_pnl_date.1a8f6bfde4: Close
[0m19:24:53.292849 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_fact_portfolio_pnl_portfolio_id.f71baa71b4: Close
[0m19:24:53.293267 [debug] [Thread-1  ]: Finished running node test.bain_capital_analytics.assert_pnl_balanced
[0m19:24:53.293731 [info ] [Thread-2  ]: 37 of 40 PASS not_null_fact_portfolio_pnl_pnl_date ............................. [[32mPASS[0m in 0.05s]
[0m19:24:53.294182 [info ] [Thread-4  ]: 38 of 40 PASS not_null_fact_portfolio_pnl_portfolio_id ......................... [[32mPASS[0m in 0.05s]
[0m19:24:53.294652 [debug] [Thread-2  ]: Finished running node test.bain_capital_analytics.not_null_fact_portfolio_pnl_pnl_date.1a8f6bfde4
[0m19:24:53.295113 [debug] [Thread-4  ]: Finished running node test.bain_capital_analytics.not_null_fact_portfolio_pnl_portfolio_id.f71baa71b4
[0m19:24:53.295739 [debug] [Thread-3  ]: Began running node model.bain_capital_analytics.report_daily_pnl
[0m19:24:53.296275 [info ] [Thread-3  ]: 39 of 40 START sql view model public.report_daily_pnl .......................... [RUN]
[0m19:24:53.296684 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly model.bain_capital_analytics.fact_portfolio_pnl, now model.bain_capital_analytics.report_daily_pnl)
[0m19:24:53.297001 [debug] [Thread-3  ]: Began compiling node model.bain_capital_analytics.report_daily_pnl
[0m19:24:53.300391 [debug] [Thread-3  ]: Writing injected SQL for node "model.bain_capital_analytics.report_daily_pnl"
[0m19:24:53.301005 [debug] [Thread-3  ]: Began executing node model.bain_capital_analytics.report_daily_pnl
[0m19:24:53.305760 [debug] [Thread-3  ]: Writing runtime sql for node "model.bain_capital_analytics.report_daily_pnl"
[0m19:24:53.306275 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.report_daily_pnl"
[0m19:24:53.306575 [debug] [Thread-3  ]: On model.bain_capital_analytics.report_daily_pnl: BEGIN
[0m19:24:53.306852 [debug] [Thread-3  ]: Opening a new connection, currently in state closed
[0m19:24:53.314887 [debug] [Thread-3  ]: SQL status: BEGIN in 0.008 seconds
[0m19:24:53.315204 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.report_daily_pnl"
[0m19:24:53.315557 [debug] [Thread-3  ]: On model.bain_capital_analytics.report_daily_pnl: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.report_daily_pnl"} */

  create view "bain_analytics"."public"."report_daily_pnl__dbt_tmp"
    
    
  as (
    -- Pipeline B: REPORT table - Daily PnL report for portfolio managers
-- Anti-pattern: subquery for latest-only instead of QUALIFY
-- Anti-pattern: re-aggregation from fact that's already aggregated

with latest_pnl as (
    select *
    from (
        select
            fpnl.*,
            -- Anti-pattern: subquery dedup instead of QUALIFY
            row_number() over (
                partition by fpnl.portfolio_id
                order by fpnl.pnl_date desc
            ) as rn
        from "bain_analytics"."public"."fact_portfolio_pnl" fpnl
    ) sub
    where rn <= 5  -- last 5 dates per portfolio
),

-- Anti-pattern: re-joining to get benchmark data that should be part of the pipeline
pnl_with_benchmark as (
    select
        lp.*,
        bm.return_mtd as benchmark_return_mtd,
        bm.return_ytd as benchmark_return_ytd,
        bm.benchmark_name
    from latest_pnl lp
    left join "bain_analytics"."public"."stg_benchmarks" bm
        on lp.pnl_date = bm.benchmark_date
        and bm.benchmark_id = 'BM_SP500'
)

select
    portfolio_id,
    portfolio_name,
    strategy,
    pnl_date,
    fiscal_quarter,
    position_daily_pnl,
    cumulative_pnl,
    total_market_value,
    num_positions,
    total_traded_notional,
    total_commissions,
    num_trades,
    benchmark_name,
    benchmark_return_mtd,
    benchmark_return_ytd,
    -- Anti-pattern: computing return inline instead of upstream
    case
        when total_market_value != 0
        then position_daily_pnl / total_market_value
        else 0
    end as daily_return_pct
from pnl_with_benchmark
order by portfolio_id, pnl_date desc
  );
[0m19:24:53.320576 [debug] [Thread-3  ]: SQL status: CREATE VIEW in 0.005 seconds
[0m19:24:53.323532 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.report_daily_pnl"
[0m19:24:53.323860 [debug] [Thread-3  ]: On model.bain_capital_analytics.report_daily_pnl: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.report_daily_pnl"} */
alter table "bain_analytics"."public"."report_daily_pnl__dbt_tmp" rename to "report_daily_pnl"
[0m19:24:53.324972 [debug] [Thread-3  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m19:24:53.325973 [debug] [Thread-3  ]: On model.bain_capital_analytics.report_daily_pnl: COMMIT
[0m19:24:53.326284 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.report_daily_pnl"
[0m19:24:53.326570 [debug] [Thread-3  ]: On model.bain_capital_analytics.report_daily_pnl: COMMIT
[0m19:24:53.327417 [debug] [Thread-3  ]: SQL status: COMMIT in 0.001 seconds
[0m19:24:53.329578 [debug] [Thread-3  ]: Applying DROP to: "bain_analytics"."public"."report_daily_pnl__dbt_backup"
[0m19:24:53.330039 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.report_daily_pnl"
[0m19:24:53.330339 [debug] [Thread-3  ]: On model.bain_capital_analytics.report_daily_pnl: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.report_daily_pnl"} */
drop view if exists "bain_analytics"."public"."report_daily_pnl__dbt_backup" cascade
[0m19:24:53.330938 [debug] [Thread-3  ]: SQL status: DROP VIEW in 0.000 seconds
[0m19:24:53.331987 [debug] [Thread-3  ]: On model.bain_capital_analytics.report_daily_pnl: Close
[0m19:24:53.332493 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '11234c95-e197-4418-bde7-98b392860bc9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11021dcd0>]}
[0m19:24:53.333042 [info ] [Thread-3  ]: 39 of 40 OK created sql view model public.report_daily_pnl ..................... [[32mCREATE VIEW[0m in 0.04s]
[0m19:24:53.333500 [debug] [Thread-3  ]: Finished running node model.bain_capital_analytics.report_daily_pnl
[0m19:24:53.334102 [debug] [Thread-2  ]: Began running node test.bain_capital_analytics.not_null_report_daily_pnl_portfolio_id.37974cbf9b
[0m19:24:53.334489 [info ] [Thread-2  ]: 40 of 40 START test not_null_report_daily_pnl_portfolio_id ..................... [RUN]
[0m19:24:53.334849 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.not_null_fact_portfolio_pnl_pnl_date.1a8f6bfde4, now test.bain_capital_analytics.not_null_report_daily_pnl_portfolio_id.37974cbf9b)
[0m19:24:53.335204 [debug] [Thread-2  ]: Began compiling node test.bain_capital_analytics.not_null_report_daily_pnl_portfolio_id.37974cbf9b
[0m19:24:53.338972 [debug] [Thread-2  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_report_daily_pnl_portfolio_id.37974cbf9b"
[0m19:24:53.339563 [debug] [Thread-2  ]: Began executing node test.bain_capital_analytics.not_null_report_daily_pnl_portfolio_id.37974cbf9b
[0m19:24:53.342108 [debug] [Thread-2  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_report_daily_pnl_portfolio_id.37974cbf9b"
[0m19:24:53.342734 [debug] [Thread-2  ]: Using postgres connection "test.bain_capital_analytics.not_null_report_daily_pnl_portfolio_id.37974cbf9b"
[0m19:24:53.343074 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_report_daily_pnl_portfolio_id.37974cbf9b: BEGIN
[0m19:24:53.343367 [debug] [Thread-2  ]: Opening a new connection, currently in state closed
[0m19:24:53.351799 [debug] [Thread-2  ]: SQL status: BEGIN in 0.008 seconds
[0m19:24:53.352198 [debug] [Thread-2  ]: Using postgres connection "test.bain_capital_analytics.not_null_report_daily_pnl_portfolio_id.37974cbf9b"
[0m19:24:53.352511 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_report_daily_pnl_portfolio_id.37974cbf9b: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_report_daily_pnl_portfolio_id.37974cbf9b"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select portfolio_id
from "bain_analytics"."public"."report_daily_pnl"
where portfolio_id is null



  
  
      
    ) dbt_internal_test
[0m19:24:53.360886 [debug] [Thread-2  ]: SQL status: SELECT 1 in 0.008 seconds
[0m19:24:53.362357 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_report_daily_pnl_portfolio_id.37974cbf9b: ROLLBACK
[0m19:24:53.363057 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_report_daily_pnl_portfolio_id.37974cbf9b: Close
[0m19:24:53.363637 [info ] [Thread-2  ]: 40 of 40 PASS not_null_report_daily_pnl_portfolio_id ........................... [[32mPASS[0m in 0.03s]
[0m19:24:53.364121 [debug] [Thread-2  ]: Finished running node test.bain_capital_analytics.not_null_report_daily_pnl_portfolio_id.37974cbf9b
[0m19:24:53.365282 [debug] [MainThread]: Using postgres connection "master"
[0m19:24:53.365557 [debug] [MainThread]: On master: BEGIN
[0m19:24:53.365801 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m19:24:53.374115 [debug] [MainThread]: SQL status: BEGIN in 0.008 seconds
[0m19:24:53.374630 [debug] [MainThread]: On master: COMMIT
[0m19:24:53.374949 [debug] [MainThread]: Using postgres connection "master"
[0m19:24:53.375216 [debug] [MainThread]: On master: COMMIT
[0m19:24:53.375981 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m19:24:53.376329 [debug] [MainThread]: On master: Close
[0m19:24:53.377076 [debug] [MainThread]: Connection 'master' was properly closed.
[0m19:24:53.377421 [debug] [MainThread]: Connection 'test.bain_capital_analytics.assert_pnl_balanced' was properly closed.
[0m19:24:53.377684 [debug] [MainThread]: Connection 'test.bain_capital_analytics.not_null_report_daily_pnl_portfolio_id.37974cbf9b' was properly closed.
[0m19:24:53.377922 [debug] [MainThread]: Connection 'model.bain_capital_analytics.report_daily_pnl' was properly closed.
[0m19:24:53.378146 [debug] [MainThread]: Connection 'test.bain_capital_analytics.not_null_fact_portfolio_pnl_portfolio_id.f71baa71b4' was properly closed.
[0m19:24:53.378535 [info ] [MainThread]: 
[0m19:24:53.378829 [info ] [MainThread]: Finished running 28 data tests, 12 view models in 0 hours 0 minutes and 1.19 seconds (1.19s).
[0m19:24:53.383163 [debug] [MainThread]: Command end result
[0m19:24:53.426542 [debug] [MainThread]: Wrote artifact WritableManifest to ./target/manifest.json
[0m19:24:53.428258 [debug] [MainThread]: Wrote artifact SemanticManifest to ./target/semantic_manifest.json
[0m19:24:53.435841 [debug] [MainThread]: Wrote artifact RunExecutionResult to ./target/run_results.json
[0m19:24:53.436157 [info ] [MainThread]: 
[0m19:24:53.436489 [info ] [MainThread]: [32mCompleted successfully[0m
[0m19:24:53.436794 [info ] [MainThread]: 
[0m19:24:53.437081 [info ] [MainThread]: Done. PASS=40 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=40
[0m19:24:53.439667 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 2.172363, "process_in_blocks": "0", "process_kernel_time": 0.332102, "process_mem_max_rss": "142016512", "process_out_blocks": "0", "process_user_time": 3.181316}
[0m19:24:53.440019 [debug] [MainThread]: Command `dbt build` succeeded at 19:24:53.439949 after 2.17 seconds
[0m19:24:53.440351 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108676160>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a863520>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11039fe50>]}
[0m19:24:53.440673 [debug] [MainThread]: Flushing usage events
[0m19:24:55.472712 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m19:24:57.100338 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a4ad190>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b55a820>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b55a640>]}


============================== 19:24:57.103790 | 9d39665d-60b2-44a5-9c3b-d86d9b9d1de5 ==============================
[0m19:24:57.103790 [info ] [MainThread]: Running with dbt=1.11.0-b3
[0m19:24:57.104266 [debug] [MainThread]: running dbt with arguments {'version_check': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'introspect': 'True', 'debug': 'False', 'write_json': 'True', 'send_anonymous_usage_stats': 'True', 'partial_parse': 'True', 'indirect_selection': 'eager', 'invocation_command': 'dbt build --select tag:pipeline_c --profiles-dir . --project-dir .', 'log_path': 'logs', 'no_print': 'None', 'use_experimental_parser': 'False', 'fail_fast': 'False', 'static_parser': 'True', 'warn_error': 'None', 'log_format': 'default', 'cache_selected_only': 'False', 'printer_width': '80', 'quiet': 'False', 'log_cache_events': 'False', 'use_colors': 'True', 'empty': 'False', 'profiles_dir': '.'}
[0m19:24:57.301619 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '9d39665d-60b2-44a5-9c3b-d86d9b9d1de5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108d5c310>]}
[0m19:24:57.375369 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '9d39665d-60b2-44a5-9c3b-d86d9b9d1de5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b4a3250>]}
[0m19:24:57.376317 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m19:24:57.478117 [debug] [MainThread]: checksum: e63134dccc1251cfb572caf0e4aa952f030c125ee3634f3bf2c0a2e1bb6ae349, vars: {}, profile: , target: , version: 1.11.0b3
[0m19:24:57.700717 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m19:24:57.701149 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m19:24:57.765547 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '9d39665d-60b2-44a5-9c3b-d86d9b9d1de5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c6b8130>]}
[0m19:24:57.890929 [debug] [MainThread]: Wrote artifact WritableManifest to ./target/manifest.json
[0m19:24:57.892993 [debug] [MainThread]: Wrote artifact SemanticManifest to ./target/semantic_manifest.json
[0m19:24:57.923637 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '9d39665d-60b2-44a5-9c3b-d86d9b9d1de5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c6a9a60>]}
[0m19:24:57.924168 [info ] [MainThread]: Found 28 models, 53 data tests, 10 seeds, 569 macros
[0m19:24:57.928227 [info ] [MainThread]: 
[0m19:24:57.928582 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m19:24:57.928853 [info ] [MainThread]: 
[0m19:24:57.929324 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m19:24:57.934320 [debug] [ThreadPool]: Acquiring new postgres connection 'list_bain_analytics'
[0m19:24:57.988240 [debug] [ThreadPool]: Using postgres connection "list_bain_analytics"
[0m19:24:57.988720 [debug] [ThreadPool]: On list_bain_analytics: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "connection_name": "list_bain_analytics"} */

    select distinct nspname from pg_namespace
  
[0m19:24:57.988996 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m19:24:58.023876 [debug] [ThreadPool]: SQL status: SELECT 5 in 0.035 seconds
[0m19:24:58.025264 [debug] [ThreadPool]: On list_bain_analytics: Close
[0m19:24:58.028823 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_bain_analytics, now list_bain_analytics_public_raw)
[0m19:24:58.029289 [debug] [ThreadPool]: Acquiring new postgres connection 'list_bain_analytics_public'
[0m19:24:58.035377 [debug] [ThreadPool]: Using postgres connection "list_bain_analytics_public_raw"
[0m19:24:58.037841 [debug] [ThreadPool]: Using postgres connection "list_bain_analytics_public"
[0m19:24:58.038134 [debug] [ThreadPool]: On list_bain_analytics_public_raw: BEGIN
[0m19:24:58.038396 [debug] [ThreadPool]: On list_bain_analytics_public: BEGIN
[0m19:24:58.038641 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:24:58.038890 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m19:24:58.051869 [debug] [ThreadPool]: SQL status: BEGIN in 0.013 seconds
[0m19:24:58.052171 [debug] [ThreadPool]: SQL status: BEGIN in 0.014 seconds
[0m19:24:58.052450 [debug] [ThreadPool]: Using postgres connection "list_bain_analytics_public"
[0m19:24:58.052712 [debug] [ThreadPool]: Using postgres connection "list_bain_analytics_public_raw"
[0m19:24:58.052991 [debug] [ThreadPool]: On list_bain_analytics_public: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "connection_name": "list_bain_analytics_public"} */
select
      'bain_analytics' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'bain_analytics' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'bain_analytics' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m19:24:58.053288 [debug] [ThreadPool]: On list_bain_analytics_public_raw: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "connection_name": "list_bain_analytics_public_raw"} */
select
      'bain_analytics' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_raw'
    union all
    select
      'bain_analytics' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_raw'
    union all
    select
      'bain_analytics' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_raw'
  
[0m19:24:58.058799 [debug] [ThreadPool]: SQL status: SELECT 10 in 0.005 seconds
[0m19:24:58.059074 [debug] [ThreadPool]: SQL status: SELECT 15 in 0.006 seconds
[0m19:24:58.060291 [debug] [ThreadPool]: On list_bain_analytics_public_raw: ROLLBACK
[0m19:24:58.061414 [debug] [ThreadPool]: On list_bain_analytics_public: ROLLBACK
[0m19:24:58.062122 [debug] [ThreadPool]: On list_bain_analytics_public_raw: Close
[0m19:24:58.062383 [debug] [ThreadPool]: On list_bain_analytics_public: Close
[0m19:24:58.071278 [debug] [MainThread]: Using postgres connection "master"
[0m19:24:58.071578 [debug] [MainThread]: On master: BEGIN
[0m19:24:58.071827 [debug] [MainThread]: Opening a new connection, currently in state init
[0m19:24:58.082239 [debug] [MainThread]: SQL status: BEGIN in 0.010 seconds
[0m19:24:58.082521 [debug] [MainThread]: Using postgres connection "master"
[0m19:24:58.082829 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "connection_name": "master"} */
select distinct
        dependent_namespace.nspname as dependent_schema,
        dependent_class.relname as dependent_name,
        referenced_namespace.nspname as referenced_schema,
        referenced_class.relname as referenced_name

    -- Query for views: views are entries in pg_class with an entry in pg_rewrite, but we avoid
    -- a seq scan on pg_rewrite by leveraging the fact there is an "internal" row in pg_depend for
    -- the view...
    from pg_class as dependent_class
    join pg_namespace as dependent_namespace on dependent_namespace.oid = dependent_class.relnamespace
    join pg_depend as dependent_depend on dependent_depend.refobjid = dependent_class.oid
        and dependent_depend.classid = 'pg_rewrite'::regclass
        and dependent_depend.refclassid = 'pg_class'::regclass
        and dependent_depend.deptype = 'i'

    -- ... and via pg_depend (that has a row per column, hence the need for "distinct" above, and
    -- making sure to exclude the internal row to avoid a view appearing to depend on itself)...
    join pg_depend as joining_depend on joining_depend.objid = dependent_depend.objid
        and joining_depend.classid = 'pg_rewrite'::regclass
        and joining_depend.refclassid = 'pg_class'::regclass
        and joining_depend.refobjid != dependent_depend.refobjid

    -- ... we can find the tables they query from in pg_class, but excluding system tables. Note we
    -- don't need need to exclude _dependent_ system tables, because they only query from other
    -- system tables, and so are automatically excluded by excluding _referenced_ system tables
    join pg_class as referenced_class on referenced_class.oid = joining_depend.refobjid
    join pg_namespace as referenced_namespace on referenced_namespace.oid = referenced_class.relnamespace
        and referenced_namespace.nspname != 'information_schema'
        and referenced_namespace.nspname not like 'pg\_%'

    order by
        dependent_schema, dependent_name, referenced_schema, referenced_name;
[0m19:24:58.090413 [debug] [MainThread]: SQL status: SELECT 30 in 0.007 seconds
[0m19:24:58.095442 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '9d39665d-60b2-44a5-9c3b-d86d9b9d1de5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c8189d0>]}
[0m19:24:58.095834 [debug] [MainThread]: On master: ROLLBACK
[0m19:24:58.096827 [debug] [MainThread]: Using postgres connection "master"
[0m19:24:58.097072 [debug] [MainThread]: On master: BEGIN
[0m19:24:58.098155 [debug] [MainThread]: SQL status: BEGIN in 0.001 seconds
[0m19:24:58.098407 [debug] [MainThread]: On master: COMMIT
[0m19:24:58.098647 [debug] [MainThread]: Using postgres connection "master"
[0m19:24:58.098879 [debug] [MainThread]: On master: COMMIT
[0m19:24:58.099611 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m19:24:58.099862 [debug] [MainThread]: On master: Close
[0m19:24:58.101759 [debug] [Thread-1  ]: Began running node model.bain_capital_analytics.stg_benchmarks
[0m19:24:58.102102 [debug] [Thread-2  ]: Began running node model.bain_capital_analytics.stg_cashflows
[0m19:24:58.102530 [info ] [Thread-1  ]: 1 of 54 START sql view model public.stg_benchmarks ............................. [RUN]
[0m19:24:58.102901 [debug] [Thread-3  ]: Began running node model.bain_capital_analytics.stg_dates
[0m19:24:58.103300 [info ] [Thread-2  ]: 2 of 54 START sql view model public.stg_cashflows .............................. [RUN]
[0m19:24:58.103650 [debug] [Thread-4  ]: Began running node model.bain_capital_analytics.stg_fund_structures
[0m19:24:58.103985 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_bain_analytics_public_raw, now model.bain_capital_analytics.stg_benchmarks)
[0m19:24:58.104370 [info ] [Thread-3  ]: 3 of 54 START sql view model public.stg_dates .................................. [RUN]
[0m19:24:58.104714 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly list_bain_analytics_public, now model.bain_capital_analytics.stg_cashflows)
[0m19:24:58.105086 [info ] [Thread-4  ]: 4 of 54 START sql view model public.stg_fund_structures ........................ [RUN]
[0m19:24:58.105405 [debug] [Thread-1  ]: Began compiling node model.bain_capital_analytics.stg_benchmarks
[0m19:24:58.105773 [debug] [Thread-3  ]: Acquiring new postgres connection 'model.bain_capital_analytics.stg_dates'
[0m19:24:58.106072 [debug] [Thread-2  ]: Began compiling node model.bain_capital_analytics.stg_cashflows
[0m19:24:58.106426 [debug] [Thread-4  ]: Acquiring new postgres connection 'model.bain_capital_analytics.stg_fund_structures'
[0m19:24:58.114155 [debug] [Thread-1  ]: Writing injected SQL for node "model.bain_capital_analytics.stg_benchmarks"
[0m19:24:58.114484 [debug] [Thread-3  ]: Began compiling node model.bain_capital_analytics.stg_dates
[0m19:24:58.117113 [debug] [Thread-2  ]: Writing injected SQL for node "model.bain_capital_analytics.stg_cashflows"
[0m19:24:58.117440 [debug] [Thread-4  ]: Began compiling node model.bain_capital_analytics.stg_fund_structures
[0m19:24:58.121147 [debug] [Thread-3  ]: Writing injected SQL for node "model.bain_capital_analytics.stg_dates"
[0m19:24:58.123935 [debug] [Thread-4  ]: Writing injected SQL for node "model.bain_capital_analytics.stg_fund_structures"
[0m19:24:58.124559 [debug] [Thread-1  ]: Began executing node model.bain_capital_analytics.stg_benchmarks
[0m19:24:58.125072 [debug] [Thread-2  ]: Began executing node model.bain_capital_analytics.stg_cashflows
[0m19:24:58.131719 [debug] [Thread-3  ]: Began executing node model.bain_capital_analytics.stg_dates
[0m19:24:58.150953 [debug] [Thread-4  ]: Began executing node model.bain_capital_analytics.stg_fund_structures
[0m19:24:58.174223 [debug] [Thread-1  ]: Writing runtime sql for node "model.bain_capital_analytics.stg_benchmarks"
[0m19:24:58.177686 [debug] [Thread-2  ]: Writing runtime sql for node "model.bain_capital_analytics.stg_cashflows"
[0m19:24:58.181006 [debug] [Thread-4  ]: Writing runtime sql for node "model.bain_capital_analytics.stg_fund_structures"
[0m19:24:58.183975 [debug] [Thread-3  ]: Writing runtime sql for node "model.bain_capital_analytics.stg_dates"
[0m19:24:58.184784 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.stg_benchmarks"
[0m19:24:58.185145 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_benchmarks: BEGIN
[0m19:24:58.185531 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.stg_cashflows"
[0m19:24:58.185901 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m19:24:58.186256 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.stg_fund_structures"
[0m19:24:58.186550 [debug] [Thread-2  ]: On model.bain_capital_analytics.stg_cashflows: BEGIN
[0m19:24:58.186849 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.stg_dates"
[0m19:24:58.187268 [debug] [Thread-4  ]: On model.bain_capital_analytics.stg_fund_structures: BEGIN
[0m19:24:58.187581 [debug] [Thread-2  ]: Opening a new connection, currently in state closed
[0m19:24:58.187895 [debug] [Thread-3  ]: On model.bain_capital_analytics.stg_dates: BEGIN
[0m19:24:58.188228 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m19:24:58.188668 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m19:24:58.201441 [debug] [Thread-1  ]: SQL status: BEGIN in 0.016 seconds
[0m19:24:58.201823 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.stg_benchmarks"
[0m19:24:58.202245 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_benchmarks: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_benchmarks"} */

  create view "bain_analytics"."public"."stg_benchmarks__dbt_tmp"
    
    
  as (
    select distinct
    benchmark_id,
    benchmark_name,
    cast(benchmark_date as date) as benchmark_date,
    cast(return_daily as numeric(18,8)) as return_daily,
    cast(return_mtd as numeric(18,8)) as return_mtd,
    cast(return_ytd as numeric(18,8)) as return_ytd,
    cast(benchmark_level as numeric(18,4)) as benchmark_level,
    -- Anti-pattern: duplicated fiscal quarter logic
    case
        when extract(month from cast(benchmark_date as date)) between 1 and 3 then 'Q3'
        when extract(month from cast(benchmark_date as date)) between 4 and 6 then 'Q4'
        when extract(month from cast(benchmark_date as date)) between 7 and 9 then 'Q1'
        when extract(month from cast(benchmark_date as date)) between 10 and 12 then 'Q2'
    end as benchmark_fiscal_quarter
from "bain_analytics"."public_raw"."raw_benchmarks"
  );
[0m19:24:58.202630 [debug] [Thread-2  ]: SQL status: BEGIN in 0.015 seconds
[0m19:24:58.202976 [debug] [Thread-4  ]: SQL status: BEGIN in 0.015 seconds
[0m19:24:58.203290 [debug] [Thread-3  ]: SQL status: BEGIN in 0.015 seconds
[0m19:24:58.203577 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.stg_cashflows"
[0m19:24:58.203876 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.stg_fund_structures"
[0m19:24:58.204166 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.stg_dates"
[0m19:24:58.204498 [debug] [Thread-2  ]: On model.bain_capital_analytics.stg_cashflows: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_cashflows"} */

  create view "bain_analytics"."public"."stg_cashflows__dbt_tmp"
    
    
  as (
    -- Anti-pattern: unnecessary DISTINCT
-- Anti-pattern: duplicated fiscal quarter logic
select distinct
    cashflow_id,
    fund_id,
    portfolio_id,
    cast(cashflow_date as date) as cashflow_date,
    cashflow_type,
    cast(amount as numeric(18,2)) as amount,
    currency,
    description,
    investor_id,
    -- Anti-pattern: duplicated fiscal quarter logic (same as stg_trades, stg_portfolios)
    case
        when extract(month from cast(cashflow_date as date)) between 1 and 3 then 'Q3'
        when extract(month from cast(cashflow_date as date)) between 4 and 6 then 'Q4'
        when extract(month from cast(cashflow_date as date)) between 7 and 9 then 'Q1'
        when extract(month from cast(cashflow_date as date)) between 10 and 12 then 'Q2'
    end as cashflow_fiscal_quarter,
    -- Anti-pattern: PostgreSQL-specific extract
    extract(year from cast(cashflow_date as date)) as cashflow_year
from "bain_analytics"."public_raw"."raw_cashflows"
  );
[0m19:24:58.204852 [debug] [Thread-4  ]: On model.bain_capital_analytics.stg_fund_structures: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_fund_structures"} */

  create view "bain_analytics"."public"."stg_fund_structures__dbt_tmp"
    
    
  as (
    select distinct
    fund_id,
    fund_name,
    fund_type,
    cast(vintage_year as integer) as vintage_year,
    cast(committed_capital as numeric(18,2)) as committed_capital,
    cast(management_fee_rate as numeric(8,4)) as management_fee_rate,
    cast(carry_rate as numeric(8,4)) as carry_rate,
    cast(hurdle_rate as numeric(8,4)) as hurdle_rate,
    cast(gp_commitment_pct as numeric(8,4)) as gp_commitment_pct,
    fund_currency,
    fund_status
from "bain_analytics"."public_raw"."raw_fund_structures"
  );
[0m19:24:58.205193 [debug] [Thread-3  ]: On model.bain_capital_analytics.stg_dates: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_dates"} */

  create view "bain_analytics"."public"."stg_dates__dbt_tmp"
    
    
  as (
    select
    cast(date_day as date) as date_day,
    cast(is_business_day as boolean) as is_business_day,
    cast(is_month_end as boolean) as is_month_end,
    cast(is_quarter_end as boolean) as is_quarter_end,
    cast(is_year_end as boolean) as is_year_end,
    fiscal_quarter,
    fiscal_year,
    -- Anti-pattern: PostgreSQL-specific date_trunc
    date_trunc('month', cast(date_day as date)) as month_start,
    date_trunc('quarter', cast(date_day as date)) as quarter_start,
    extract(month from cast(date_day as date)) as calendar_month,
    extract(year from cast(date_day as date)) as calendar_year
from "bain_analytics"."public_raw"."raw_dates"
  );
[0m19:24:58.207835 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.005 seconds
[0m19:24:58.213672 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.stg_benchmarks"
[0m19:24:58.214012 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_benchmarks: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_benchmarks"} */
alter table "bain_analytics"."public"."stg_benchmarks" rename to "stg_benchmarks__dbt_backup"
[0m19:24:58.214329 [debug] [Thread-2  ]: SQL status: CREATE VIEW in 0.009 seconds
[0m19:24:58.214636 [debug] [Thread-3  ]: SQL status: CREATE VIEW in 0.009 seconds
[0m19:24:58.214950 [debug] [Thread-4  ]: SQL status: CREATE VIEW in 0.009 seconds
[0m19:24:58.218032 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.stg_cashflows"
[0m19:24:58.218352 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.004 seconds
[0m19:24:58.221281 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.stg_dates"
[0m19:24:58.224779 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.stg_fund_structures"
[0m19:24:58.225602 [debug] [Thread-2  ]: On model.bain_capital_analytics.stg_cashflows: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_cashflows"} */
alter table "bain_analytics"."public"."stg_cashflows" rename to "stg_cashflows__dbt_backup"
[0m19:24:58.228345 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.stg_benchmarks"
[0m19:24:58.230051 [debug] [Thread-3  ]: On model.bain_capital_analytics.stg_dates: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_dates"} */
alter table "bain_analytics"."public"."stg_dates" rename to "stg_dates__dbt_backup"
[0m19:24:58.230366 [debug] [Thread-4  ]: On model.bain_capital_analytics.stg_fund_structures: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_fund_structures"} */
alter table "bain_analytics"."public"."stg_fund_structures" rename to "stg_fund_structures__dbt_backup"
[0m19:24:58.230728 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_benchmarks: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_benchmarks"} */
alter table "bain_analytics"."public"."stg_benchmarks__dbt_tmp" rename to "stg_benchmarks"
[0m19:24:58.232002 [debug] [Thread-2  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m19:24:58.236538 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.stg_cashflows"
[0m19:24:58.236857 [debug] [Thread-3  ]: SQL status: ALTER TABLE in 0.003 seconds
[0m19:24:58.237137 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.003 seconds
[0m19:24:58.237409 [debug] [Thread-2  ]: On model.bain_capital_analytics.stg_cashflows: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_cashflows"} */
alter table "bain_analytics"."public"."stg_cashflows__dbt_tmp" rename to "stg_cashflows"
[0m19:24:58.237686 [debug] [Thread-4  ]: SQL status: ALTER TABLE in 0.004 seconds
[0m19:24:58.240280 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.stg_dates"
[0m19:24:58.254139 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_benchmarks: COMMIT
[0m19:24:58.254469 [debug] [Thread-2  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m19:24:58.257146 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.stg_fund_structures"
[0m19:24:58.257476 [debug] [Thread-3  ]: On model.bain_capital_analytics.stg_dates: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_dates"} */
alter table "bain_analytics"."public"."stg_dates__dbt_tmp" rename to "stg_dates"
[0m19:24:58.257852 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.stg_benchmarks"
[0m19:24:58.258856 [debug] [Thread-2  ]: On model.bain_capital_analytics.stg_cashflows: COMMIT
[0m19:24:58.259170 [debug] [Thread-4  ]: On model.bain_capital_analytics.stg_fund_structures: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_fund_structures"} */
alter table "bain_analytics"."public"."stg_fund_structures__dbt_tmp" rename to "stg_fund_structures"
[0m19:24:58.259505 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_benchmarks: COMMIT
[0m19:24:58.259809 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.stg_cashflows"
[0m19:24:58.260150 [debug] [Thread-2  ]: On model.bain_capital_analytics.stg_cashflows: COMMIT
[0m19:24:58.260645 [debug] [Thread-3  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m19:24:58.261584 [debug] [Thread-3  ]: On model.bain_capital_analytics.stg_dates: COMMIT
[0m19:24:58.261893 [debug] [Thread-1  ]: SQL status: COMMIT in 0.002 seconds
[0m19:24:58.262180 [debug] [Thread-4  ]: SQL status: ALTER TABLE in 0.002 seconds
[0m19:24:58.262454 [debug] [Thread-2  ]: SQL status: COMMIT in 0.002 seconds
[0m19:24:58.262729 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.stg_dates"
[0m19:24:58.268133 [debug] [Thread-1  ]: Applying DROP to: "bain_analytics"."public"."stg_benchmarks__dbt_backup"
[0m19:24:58.269195 [debug] [Thread-4  ]: On model.bain_capital_analytics.stg_fund_structures: COMMIT
[0m19:24:58.311749 [debug] [Thread-2  ]: Applying DROP to: "bain_analytics"."public"."stg_cashflows__dbt_backup"
[0m19:24:58.312133 [debug] [Thread-3  ]: On model.bain_capital_analytics.stg_dates: COMMIT
[0m19:24:58.315901 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.stg_benchmarks"
[0m19:24:58.316244 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.stg_fund_structures"
[0m19:24:58.316705 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.stg_cashflows"
[0m19:24:58.317088 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_benchmarks: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_benchmarks"} */
drop view if exists "bain_analytics"."public"."stg_benchmarks__dbt_backup" cascade
[0m19:24:58.317414 [debug] [Thread-4  ]: On model.bain_capital_analytics.stg_fund_structures: COMMIT
[0m19:24:58.317709 [debug] [Thread-2  ]: On model.bain_capital_analytics.stg_cashflows: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_cashflows"} */
drop view if exists "bain_analytics"."public"."stg_cashflows__dbt_backup" cascade
[0m19:24:58.319572 [debug] [Thread-3  ]: SQL status: COMMIT in 0.003 seconds
[0m19:24:58.322149 [debug] [Thread-3  ]: Applying DROP to: "bain_analytics"."public"."stg_dates__dbt_backup"
[0m19:24:58.322491 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.004 seconds
[0m19:24:58.322782 [debug] [Thread-2  ]: SQL status: DROP VIEW in 0.005 seconds
[0m19:24:58.323051 [debug] [Thread-4  ]: SQL status: COMMIT in 0.005 seconds
[0m19:24:58.323557 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.stg_dates"
[0m19:24:58.326053 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_benchmarks: Close
[0m19:24:58.327083 [debug] [Thread-2  ]: On model.bain_capital_analytics.stg_cashflows: Close
[0m19:24:58.329377 [debug] [Thread-4  ]: Applying DROP to: "bain_analytics"."public"."stg_fund_structures__dbt_backup"
[0m19:24:58.329707 [debug] [Thread-3  ]: On model.bain_capital_analytics.stg_dates: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_dates"} */
drop view if exists "bain_analytics"."public"."stg_dates__dbt_backup" cascade
[0m19:24:58.331583 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.stg_fund_structures"
[0m19:24:58.332131 [debug] [Thread-4  ]: On model.bain_capital_analytics.stg_fund_structures: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_fund_structures"} */
drop view if exists "bain_analytics"."public"."stg_fund_structures__dbt_backup" cascade
[0m19:24:58.332527 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9d39665d-60b2-44a5-9c3b-d86d9b9d1de5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10cd64fa0>]}
[0m19:24:58.332844 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9d39665d-60b2-44a5-9c3b-d86d9b9d1de5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109f3a8b0>]}
[0m19:24:58.333420 [info ] [Thread-1  ]: 1 of 54 OK created sql view model public.stg_benchmarks ........................ [[32mCREATE VIEW[0m in 0.23s]
[0m19:24:58.334041 [debug] [Thread-1  ]: Finished running node model.bain_capital_analytics.stg_benchmarks
[0m19:24:58.334463 [info ] [Thread-2  ]: 2 of 54 OK created sql view model public.stg_cashflows ......................... [[32mCREATE VIEW[0m in 0.23s]
[0m19:24:58.334821 [debug] [Thread-1  ]: Began running node model.bain_capital_analytics.stg_instruments
[0m19:24:58.335340 [debug] [Thread-2  ]: Finished running node model.bain_capital_analytics.stg_cashflows
[0m19:24:58.335837 [info ] [Thread-1  ]: 5 of 54 START sql view model public.stg_instruments ............................ [RUN]
[0m19:24:58.336157 [debug] [Thread-4  ]: SQL status: DROP VIEW in 0.004 seconds
[0m19:24:58.336476 [debug] [Thread-2  ]: Began running node model.bain_capital_analytics.stg_portfolios
[0m19:24:58.336869 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.bain_capital_analytics.stg_benchmarks, now model.bain_capital_analytics.stg_instruments)
[0m19:24:58.337982 [debug] [Thread-4  ]: On model.bain_capital_analytics.stg_fund_structures: Close
[0m19:24:58.338292 [debug] [Thread-3  ]: SQL status: DROP VIEW in 0.006 seconds
[0m19:24:58.338680 [info ] [Thread-2  ]: 6 of 54 START sql view model public.stg_portfolios ............................. [RUN]
[0m19:24:58.339017 [debug] [Thread-1  ]: Began compiling node model.bain_capital_analytics.stg_instruments
[0m19:24:58.339450 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9d39665d-60b2-44a5-9c3b-d86d9b9d1de5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ce0b7c0>]}
[0m19:24:58.340441 [debug] [Thread-3  ]: On model.bain_capital_analytics.stg_dates: Close
[0m19:24:58.340761 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly model.bain_capital_analytics.stg_cashflows, now model.bain_capital_analytics.stg_portfolios)
[0m19:24:58.343914 [debug] [Thread-1  ]: Writing injected SQL for node "model.bain_capital_analytics.stg_instruments"
[0m19:24:58.344438 [info ] [Thread-4  ]: 4 of 54 OK created sql view model public.stg_fund_structures ................... [[32mCREATE VIEW[0m in 0.23s]
[0m19:24:58.344894 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9d39665d-60b2-44a5-9c3b-d86d9b9d1de5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ce268b0>]}
[0m19:24:58.345183 [debug] [Thread-2  ]: Began compiling node model.bain_capital_analytics.stg_portfolios
[0m19:24:58.345670 [debug] [Thread-4  ]: Finished running node model.bain_capital_analytics.stg_fund_structures
[0m19:24:58.346141 [info ] [Thread-3  ]: 3 of 54 OK created sql view model public.stg_dates ............................. [[32mCREATE VIEW[0m in 0.24s]
[0m19:24:58.348897 [debug] [Thread-2  ]: Writing injected SQL for node "model.bain_capital_analytics.stg_portfolios"
[0m19:24:58.349283 [debug] [Thread-4  ]: Began running node model.bain_capital_analytics.stg_positions
[0m19:24:58.349595 [debug] [Thread-1  ]: Began executing node model.bain_capital_analytics.stg_instruments
[0m19:24:58.350052 [debug] [Thread-3  ]: Finished running node model.bain_capital_analytics.stg_dates
[0m19:24:58.350556 [info ] [Thread-4  ]: 7 of 54 START sql view model public.stg_positions .............................. [RUN]
[0m19:24:58.355266 [debug] [Thread-1  ]: Writing runtime sql for node "model.bain_capital_analytics.stg_instruments"
[0m19:24:58.355653 [debug] [Thread-3  ]: Began running node model.bain_capital_analytics.stg_valuations
[0m19:24:58.355964 [debug] [Thread-2  ]: Began executing node model.bain_capital_analytics.stg_portfolios
[0m19:24:58.356331 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly model.bain_capital_analytics.stg_fund_structures, now model.bain_capital_analytics.stg_positions)
[0m19:24:58.356883 [info ] [Thread-3  ]: 8 of 54 START sql view model public.stg_valuations ............................. [RUN]
[0m19:24:58.360213 [debug] [Thread-2  ]: Writing runtime sql for node "model.bain_capital_analytics.stg_portfolios"
[0m19:24:58.360550 [debug] [Thread-4  ]: Began compiling node model.bain_capital_analytics.stg_positions
[0m19:24:58.360898 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.stg_instruments"
[0m19:24:58.361204 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly model.bain_capital_analytics.stg_dates, now model.bain_capital_analytics.stg_valuations)
[0m19:24:58.363826 [debug] [Thread-4  ]: Writing injected SQL for node "model.bain_capital_analytics.stg_positions"
[0m19:24:58.364150 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_instruments: BEGIN
[0m19:24:58.364493 [debug] [Thread-3  ]: Began compiling node model.bain_capital_analytics.stg_valuations
[0m19:24:58.364855 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.stg_portfolios"
[0m19:24:58.365200 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m19:24:58.367805 [debug] [Thread-3  ]: Writing injected SQL for node "model.bain_capital_analytics.stg_valuations"
[0m19:24:58.368151 [debug] [Thread-2  ]: On model.bain_capital_analytics.stg_portfolios: BEGIN
[0m19:24:58.368462 [debug] [Thread-4  ]: Began executing node model.bain_capital_analytics.stg_positions
[0m19:24:58.368920 [debug] [Thread-2  ]: Opening a new connection, currently in state closed
[0m19:24:58.371969 [debug] [Thread-4  ]: Writing runtime sql for node "model.bain_capital_analytics.stg_positions"
[0m19:24:58.372457 [debug] [Thread-3  ]: Began executing node model.bain_capital_analytics.stg_valuations
[0m19:24:58.376903 [debug] [Thread-3  ]: Writing runtime sql for node "model.bain_capital_analytics.stg_valuations"
[0m19:24:58.377427 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.stg_positions"
[0m19:24:58.377758 [debug] [Thread-4  ]: On model.bain_capital_analytics.stg_positions: BEGIN
[0m19:24:58.378053 [debug] [Thread-4  ]: Opening a new connection, currently in state closed
[0m19:24:58.378509 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.stg_valuations"
[0m19:24:58.378822 [debug] [Thread-3  ]: On model.bain_capital_analytics.stg_valuations: BEGIN
[0m19:24:58.379132 [debug] [Thread-3  ]: Opening a new connection, currently in state closed
[0m19:24:58.379792 [debug] [Thread-1  ]: SQL status: BEGIN in 0.015 seconds
[0m19:24:58.380095 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.stg_instruments"
[0m19:24:58.380445 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_instruments: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_instruments"} */

  create view "bain_analytics"."public"."stg_instruments__dbt_tmp"
    
    
  as (
    -- Anti-pattern: unnecessary DISTINCT
select distinct
    instrument_id,
    instrument_name,
    instrument_type,
    sector,
    currency,
    exchange,
    issuer,
    cast(maturity_date as date) as maturity_date,
    -- Anti-pattern: PostgreSQL-specific date subtraction
    case
        when maturity_date is not null
        then cast(maturity_date as date) - current_date
        else null
    end as days_to_maturity,
    case
        when instrument_type in ('equity', 'futures') then 'liquid'
        when instrument_type in ('corporate_bond', 'government_bond', 'sovereign_bond', 'leveraged_loan') then 'semi_liquid'
        when instrument_type in ('private_equity', 'venture_capital', 'real_estate', 'real_estate_debt', 'infrastructure') then 'illiquid'
        else 'other'
    end as liquidity_class
from "bain_analytics"."public_raw"."raw_instruments"
  );
[0m19:24:58.381010 [debug] [Thread-2  ]: SQL status: BEGIN in 0.012 seconds
[0m19:24:58.381308 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.stg_portfolios"
[0m19:24:58.381627 [debug] [Thread-2  ]: On model.bain_capital_analytics.stg_portfolios: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_portfolios"} */

  create view "bain_analytics"."public"."stg_portfolios__dbt_tmp"
    
    
  as (
    -- Anti-pattern: unnecessary DISTINCT when source data is already unique
-- Anti-pattern: casting in every model instead of once upstream

select distinct
    cast(portfolio_id as varchar(10)) as portfolio_id,
    cast(portfolio_name as varchar(100)) as portfolio_name,
    cast(strategy as varchar(50)) as strategy,
    cast(inception_date as date) as inception_date,
    cast(fund_id as varchar(10)) as fund_id,
    cast(manager_name as varchar(100)) as manager_name,
    cast(is_active as boolean) as is_active,
    -- Anti-pattern: duplicated fiscal quarter logic (repeated in many models)
    case
        when extract(month from cast(inception_date as date)) between 1 and 3 then 'Q3'
        when extract(month from cast(inception_date as date)) between 4 and 6 then 'Q4'
        when extract(month from cast(inception_date as date)) between 7 and 9 then 'Q1'
        when extract(month from cast(inception_date as date)) between 10 and 12 then 'Q2'
    end as inception_fiscal_quarter
from "bain_analytics"."public_raw"."raw_portfolios"
where cast(is_active as boolean) = true
  );
[0m19:24:58.384739 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.004 seconds
[0m19:24:58.387795 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.stg_instruments"
[0m19:24:58.388175 [debug] [Thread-2  ]: SQL status: CREATE VIEW in 0.006 seconds
[0m19:24:58.388486 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_instruments: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_instruments"} */
alter table "bain_analytics"."public"."stg_instruments" rename to "stg_instruments__dbt_backup"
[0m19:24:58.391668 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.stg_portfolios"
[0m19:24:58.392070 [debug] [Thread-4  ]: SQL status: BEGIN in 0.014 seconds
[0m19:24:58.392382 [debug] [Thread-3  ]: SQL status: BEGIN in 0.013 seconds
[0m19:24:58.392690 [debug] [Thread-2  ]: On model.bain_capital_analytics.stg_portfolios: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_portfolios"} */
alter table "bain_analytics"."public"."stg_portfolios" rename to "stg_portfolios__dbt_backup"
[0m19:24:58.392983 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.stg_positions"
[0m19:24:58.393300 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.stg_valuations"
[0m19:24:58.393608 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m19:24:58.393978 [debug] [Thread-4  ]: On model.bain_capital_analytics.stg_positions: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_positions"} */

  create view "bain_analytics"."public"."stg_positions__dbt_tmp"
    
    
  as (
    -- Anti-pattern: unnecessary DISTINCT
-- Anti-pattern: no filtering or partitioning strategy

select distinct
    position_id,
    portfolio_id,
    instrument_id,
    cast(position_date as date) as position_date,
    cast(quantity as numeric(18,4)) as quantity,
    cast(market_value as numeric(18,2)) as market_value,
    cast(cost_basis as numeric(18,2)) as cost_basis,
    currency,
    -- Anti-pattern: computed column that could be done downstream
    cast(market_value as numeric(18,2)) - cast(cost_basis as numeric(18,2)) as unrealized_gain_loss,
    case
        when cast(cost_basis as numeric(18,2)) != 0
        then (cast(market_value as numeric(18,2)) - cast(cost_basis as numeric(18,2))) / abs(cast(cost_basis as numeric(18,2)))
        else 0
    end as unrealized_return_pct
from "bain_analytics"."public_raw"."raw_positions"
  );
[0m19:24:58.394340 [debug] [Thread-3  ]: On model.bain_capital_analytics.stg_valuations: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_valuations"} */

  create view "bain_analytics"."public"."stg_valuations__dbt_tmp"
    
    
  as (
    -- Anti-pattern: unnecessary DISTINCT
select distinct
    valuation_id,
    portfolio_id,
    cast(valuation_date as date) as valuation_date,
    cast(gross_asset_value as numeric(18,2)) as gross_asset_value,
    cast(net_asset_value as numeric(18,2)) as net_asset_value,
    cast(total_liabilities as numeric(18,2)) as total_liabilities,
    cast(unrealized_pnl as numeric(18,2)) as unrealized_pnl,
    cast(realized_pnl as numeric(18,2)) as realized_pnl,
    valuation_method,
    -- Anti-pattern: duplicated fiscal quarter logic
    case
        when extract(month from cast(valuation_date as date)) between 1 and 3 then 'Q3'
        when extract(month from cast(valuation_date as date)) between 4 and 6 then 'Q4'
        when extract(month from cast(valuation_date as date)) between 7 and 9 then 'Q1'
        when extract(month from cast(valuation_date as date)) between 10 and 12 then 'Q2'
    end as valuation_fiscal_quarter
from "bain_analytics"."public_raw"."raw_valuations"
  );
[0m19:24:58.394668 [debug] [Thread-2  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m19:24:58.397455 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.stg_instruments"
[0m19:24:58.400334 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.stg_portfolios"
[0m19:24:58.400676 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_instruments: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_instruments"} */
alter table "bain_analytics"."public"."stg_instruments__dbt_tmp" rename to "stg_instruments"
[0m19:24:58.400990 [debug] [Thread-2  ]: On model.bain_capital_analytics.stg_portfolios: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_portfolios"} */
alter table "bain_analytics"."public"."stg_portfolios__dbt_tmp" rename to "stg_portfolios"
[0m19:24:58.402207 [debug] [Thread-2  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m19:24:58.402554 [debug] [Thread-3  ]: SQL status: CREATE VIEW in 0.005 seconds
[0m19:24:58.402835 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.002 seconds
[0m19:24:58.403872 [debug] [Thread-2  ]: On model.bain_capital_analytics.stg_portfolios: COMMIT
[0m19:24:58.404166 [debug] [Thread-4  ]: SQL status: CREATE VIEW in 0.006 seconds
[0m19:24:58.407215 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.stg_valuations"
[0m19:24:58.408464 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_instruments: COMMIT
[0m19:24:58.408908 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.stg_portfolios"
[0m19:24:58.413180 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.stg_positions"
[0m19:24:58.413559 [debug] [Thread-3  ]: On model.bain_capital_analytics.stg_valuations: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_valuations"} */
alter table "bain_analytics"."public"."stg_valuations" rename to "stg_valuations__dbt_backup"
[0m19:24:58.413885 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.stg_instruments"
[0m19:24:58.414180 [debug] [Thread-2  ]: On model.bain_capital_analytics.stg_portfolios: COMMIT
[0m19:24:58.414478 [debug] [Thread-4  ]: On model.bain_capital_analytics.stg_positions: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_positions"} */
alter table "bain_analytics"."public"."stg_positions" rename to "stg_positions__dbt_backup"
[0m19:24:58.414846 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_instruments: COMMIT
[0m19:24:58.415856 [debug] [Thread-3  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m19:24:58.416179 [debug] [Thread-4  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m19:24:58.416583 [debug] [Thread-2  ]: SQL status: COMMIT in 0.001 seconds
[0m19:24:58.416857 [debug] [Thread-1  ]: SQL status: COMMIT in 0.002 seconds
[0m19:24:58.419713 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.stg_valuations"
[0m19:24:58.422326 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.stg_positions"
[0m19:24:58.424631 [debug] [Thread-2  ]: Applying DROP to: "bain_analytics"."public"."stg_portfolios__dbt_backup"
[0m19:24:58.427225 [debug] [Thread-1  ]: Applying DROP to: "bain_analytics"."public"."stg_instruments__dbt_backup"
[0m19:24:58.427583 [debug] [Thread-3  ]: On model.bain_capital_analytics.stg_valuations: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_valuations"} */
alter table "bain_analytics"."public"."stg_valuations__dbt_tmp" rename to "stg_valuations"
[0m19:24:58.427891 [debug] [Thread-4  ]: On model.bain_capital_analytics.stg_positions: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_positions"} */
alter table "bain_analytics"."public"."stg_positions__dbt_tmp" rename to "stg_positions"
[0m19:24:58.428374 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.stg_portfolios"
[0m19:24:58.428830 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.stg_instruments"
[0m19:24:58.429238 [debug] [Thread-2  ]: On model.bain_capital_analytics.stg_portfolios: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_portfolios"} */
drop view if exists "bain_analytics"."public"."stg_portfolios__dbt_backup" cascade
[0m19:24:58.429550 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_instruments: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_instruments"} */
drop view if exists "bain_analytics"."public"."stg_instruments__dbt_backup" cascade
[0m19:24:58.430625 [debug] [Thread-4  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m19:24:58.430985 [debug] [Thread-3  ]: SQL status: ALTER TABLE in 0.002 seconds
[0m19:24:58.432181 [debug] [Thread-4  ]: On model.bain_capital_analytics.stg_positions: COMMIT
[0m19:24:58.433358 [debug] [Thread-3  ]: On model.bain_capital_analytics.stg_valuations: COMMIT
[0m19:24:58.433698 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.004 seconds
[0m19:24:58.434004 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.stg_positions"
[0m19:24:58.434308 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.stg_valuations"
[0m19:24:58.435412 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_instruments: Close
[0m19:24:58.435740 [debug] [Thread-2  ]: SQL status: DROP VIEW in 0.006 seconds
[0m19:24:58.436040 [debug] [Thread-4  ]: On model.bain_capital_analytics.stg_positions: COMMIT
[0m19:24:58.436334 [debug] [Thread-3  ]: On model.bain_capital_analytics.stg_valuations: COMMIT
[0m19:24:58.436847 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9d39665d-60b2-44a5-9c3b-d86d9b9d1de5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10bc79850>]}
[0m19:24:58.437842 [debug] [Thread-2  ]: On model.bain_capital_analytics.stg_portfolios: Close
[0m19:24:58.438504 [info ] [Thread-1  ]: 5 of 54 OK created sql view model public.stg_instruments ....................... [[32mCREATE VIEW[0m in 0.10s]
[0m19:24:58.438987 [debug] [Thread-1  ]: Finished running node model.bain_capital_analytics.stg_instruments
[0m19:24:58.439427 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9d39665d-60b2-44a5-9c3b-d86d9b9d1de5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109f3a8b0>]}
[0m19:24:58.439736 [debug] [Thread-4  ]: SQL status: COMMIT in 0.002 seconds
[0m19:24:58.440173 [debug] [Thread-1  ]: Began running node test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_date.d5c8f88f3e
[0m19:24:58.440758 [debug] [Thread-3  ]: SQL status: COMMIT in 0.002 seconds
[0m19:24:58.441749 [info ] [Thread-2  ]: 6 of 54 OK created sql view model public.stg_portfolios ........................ [[32mCREATE VIEW[0m in 0.10s]
[0m19:24:58.445597 [debug] [Thread-4  ]: Applying DROP to: "bain_analytics"."public"."stg_positions__dbt_backup"
[0m19:24:58.445947 [info ] [Thread-1  ]: 9 of 54 START test not_null_stg_benchmarks_benchmark_date ...................... [RUN]
[0m19:24:58.448139 [debug] [Thread-3  ]: Applying DROP to: "bain_analytics"."public"."stg_valuations__dbt_backup"
[0m19:24:58.448574 [debug] [Thread-2  ]: Finished running node model.bain_capital_analytics.stg_portfolios
[0m19:24:58.449042 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.stg_positions"
[0m19:24:58.449387 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.bain_capital_analytics.stg_instruments, now test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_date.d5c8f88f3e)
[0m19:24:58.449837 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.stg_valuations"
[0m19:24:58.450165 [debug] [Thread-2  ]: Began running node test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_id.ec87e4ee58
[0m19:24:58.450569 [debug] [Thread-4  ]: On model.bain_capital_analytics.stg_positions: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_positions"} */
drop view if exists "bain_analytics"."public"."stg_positions__dbt_backup" cascade
[0m19:24:58.451013 [debug] [Thread-1  ]: Began compiling node test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_date.d5c8f88f3e
[0m19:24:58.451322 [debug] [Thread-3  ]: On model.bain_capital_analytics.stg_valuations: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_valuations"} */
drop view if exists "bain_analytics"."public"."stg_valuations__dbt_backup" cascade
[0m19:24:58.451639 [info ] [Thread-2  ]: 10 of 54 START test not_null_stg_benchmarks_benchmark_id ....................... [RUN]
[0m19:24:58.458125 [debug] [Thread-4  ]: SQL status: DROP VIEW in 0.006 seconds
[0m19:24:58.462304 [debug] [Thread-1  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_date.d5c8f88f3e"
[0m19:24:58.462727 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly model.bain_capital_analytics.stg_portfolios, now test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_id.ec87e4ee58)
[0m19:24:58.463813 [debug] [Thread-4  ]: On model.bain_capital_analytics.stg_positions: Close
[0m19:24:58.464202 [debug] [Thread-2  ]: Began compiling node test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_id.ec87e4ee58
[0m19:24:58.464744 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9d39665d-60b2-44a5-9c3b-d86d9b9d1de5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10cd6c0d0>]}
[0m19:24:58.468396 [debug] [Thread-2  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_id.ec87e4ee58"
[0m19:24:58.468828 [debug] [Thread-3  ]: SQL status: DROP VIEW in 0.006 seconds
[0m19:24:58.469124 [debug] [Thread-1  ]: Began executing node test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_date.d5c8f88f3e
[0m19:24:58.469543 [info ] [Thread-4  ]: 7 of 54 OK created sql view model public.stg_positions ......................... [[32mCREATE VIEW[0m in 0.11s]
[0m19:24:58.470634 [debug] [Thread-3  ]: On model.bain_capital_analytics.stg_valuations: Close
[0m19:24:58.482549 [debug] [Thread-4  ]: Finished running node model.bain_capital_analytics.stg_positions
[0m19:24:58.486316 [debug] [Thread-1  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_date.d5c8f88f3e"
[0m19:24:58.486842 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9d39665d-60b2-44a5-9c3b-d86d9b9d1de5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10cd6c040>]}
[0m19:24:58.487188 [debug] [Thread-4  ]: Began running node test.bain_capital_analytics.not_null_stg_cashflows_cashflow_id.4176024898
[0m19:24:58.487482 [debug] [Thread-2  ]: Began executing node test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_id.ec87e4ee58
[0m19:24:58.488137 [info ] [Thread-4  ]: 11 of 54 START test not_null_stg_cashflows_cashflow_id ......................... [RUN]
[0m19:24:58.488603 [info ] [Thread-3  ]: 8 of 54 OK created sql view model public.stg_valuations ........................ [[32mCREATE VIEW[0m in 0.13s]
[0m19:24:58.490967 [debug] [Thread-2  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_id.ec87e4ee58"
[0m19:24:58.491367 [debug] [Thread-1  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_date.d5c8f88f3e"
[0m19:24:58.491683 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly model.bain_capital_analytics.stg_positions, now test.bain_capital_analytics.not_null_stg_cashflows_cashflow_id.4176024898)
[0m19:24:58.492114 [debug] [Thread-3  ]: Finished running node model.bain_capital_analytics.stg_valuations
[0m19:24:58.492484 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_date.d5c8f88f3e: BEGIN
[0m19:24:58.492805 [debug] [Thread-4  ]: Began compiling node test.bain_capital_analytics.not_null_stg_cashflows_cashflow_id.4176024898
[0m19:24:58.493154 [debug] [Thread-3  ]: Began running node test.bain_capital_analytics.not_null_stg_cashflows_fund_id.7ff8a45dde
[0m19:24:58.493536 [debug] [Thread-2  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_id.ec87e4ee58"
[0m19:24:58.493806 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m19:24:58.498497 [debug] [Thread-4  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_stg_cashflows_cashflow_id.4176024898"
[0m19:24:58.498845 [info ] [Thread-3  ]: 12 of 54 START test not_null_stg_cashflows_fund_id ............................. [RUN]
[0m19:24:58.499179 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_id.ec87e4ee58: BEGIN
[0m19:24:58.499682 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly model.bain_capital_analytics.stg_valuations, now test.bain_capital_analytics.not_null_stg_cashflows_fund_id.7ff8a45dde)
[0m19:24:58.499998 [debug] [Thread-2  ]: Opening a new connection, currently in state closed
[0m19:24:58.500365 [debug] [Thread-3  ]: Began compiling node test.bain_capital_analytics.not_null_stg_cashflows_fund_id.7ff8a45dde
[0m19:24:58.500748 [debug] [Thread-4  ]: Began executing node test.bain_capital_analytics.not_null_stg_cashflows_cashflow_id.4176024898
[0m19:24:58.504201 [debug] [Thread-3  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_stg_cashflows_fund_id.7ff8a45dde"
[0m19:24:58.506415 [debug] [Thread-4  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_stg_cashflows_cashflow_id.4176024898"
[0m19:24:58.506932 [debug] [Thread-3  ]: Began executing node test.bain_capital_analytics.not_null_stg_cashflows_fund_id.7ff8a45dde
[0m19:24:58.509163 [debug] [Thread-3  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_stg_cashflows_fund_id.7ff8a45dde"
[0m19:24:58.509515 [debug] [Thread-4  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_cashflows_cashflow_id.4176024898"
[0m19:24:58.509862 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_stg_cashflows_cashflow_id.4176024898: BEGIN
[0m19:24:58.510152 [debug] [Thread-4  ]: Opening a new connection, currently in state closed
[0m19:24:58.510628 [debug] [Thread-3  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_cashflows_fund_id.7ff8a45dde"
[0m19:24:58.510945 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_stg_cashflows_fund_id.7ff8a45dde: BEGIN
[0m19:24:58.511227 [debug] [Thread-3  ]: Opening a new connection, currently in state closed
[0m19:24:58.514723 [debug] [Thread-1  ]: SQL status: BEGIN in 0.021 seconds
[0m19:24:58.515050 [debug] [Thread-1  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_date.d5c8f88f3e"
[0m19:24:58.515402 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_date.d5c8f88f3e: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_date.d5c8f88f3e"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select benchmark_date
from "bain_analytics"."public"."stg_benchmarks"
where benchmark_date is null



  
  
      
    ) dbt_internal_test
[0m19:24:58.515823 [debug] [Thread-2  ]: SQL status: BEGIN in 0.016 seconds
[0m19:24:58.516118 [debug] [Thread-2  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_id.ec87e4ee58"
[0m19:24:58.516471 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_id.ec87e4ee58: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_id.ec87e4ee58"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select benchmark_id
from "bain_analytics"."public"."stg_benchmarks"
where benchmark_id is null



  
  
      
    ) dbt_internal_test
[0m19:24:58.517623 [debug] [Thread-1  ]: SQL status: SELECT 1 in 0.002 seconds
[0m19:24:58.520456 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_date.d5c8f88f3e: ROLLBACK
[0m19:24:58.520861 [debug] [Thread-2  ]: SQL status: SELECT 1 in 0.004 seconds
[0m19:24:58.521962 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_id.ec87e4ee58: ROLLBACK
[0m19:24:58.522274 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_date.d5c8f88f3e: Close
[0m19:24:58.522606 [debug] [Thread-4  ]: SQL status: BEGIN in 0.012 seconds
[0m19:24:58.522893 [debug] [Thread-3  ]: SQL status: BEGIN in 0.012 seconds
[0m19:24:58.523160 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_id.ec87e4ee58: Close
[0m19:24:58.523646 [info ] [Thread-1  ]: 9 of 54 PASS not_null_stg_benchmarks_benchmark_date ............................ [[32mPASS[0m in 0.07s]
[0m19:24:58.523967 [debug] [Thread-4  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_cashflows_cashflow_id.4176024898"
[0m19:24:58.524266 [debug] [Thread-3  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_cashflows_fund_id.7ff8a45dde"
[0m19:24:58.524796 [debug] [Thread-1  ]: Finished running node test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_date.d5c8f88f3e
[0m19:24:58.525205 [info ] [Thread-2  ]: 10 of 54 PASS not_null_stg_benchmarks_benchmark_id ............................. [[32mPASS[0m in 0.06s]
[0m19:24:58.525547 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_stg_cashflows_cashflow_id.4176024898: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_stg_cashflows_cashflow_id.4176024898"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select cashflow_id
from "bain_analytics"."public"."stg_cashflows"
where cashflow_id is null



  
  
      
    ) dbt_internal_test
[0m19:24:58.525870 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_stg_cashflows_fund_id.7ff8a45dde: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_stg_cashflows_fund_id.7ff8a45dde"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select fund_id
from "bain_analytics"."public"."stg_cashflows"
where fund_id is null



  
  
      
    ) dbt_internal_test
[0m19:24:58.526216 [debug] [Thread-1  ]: Began running node test.bain_capital_analytics.not_null_stg_cashflows_portfolio_id.cbd1d93e57
[0m19:24:58.526695 [debug] [Thread-2  ]: Finished running node test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_id.ec87e4ee58
[0m19:24:58.527104 [info ] [Thread-1  ]: 13 of 54 START test not_null_stg_cashflows_portfolio_id ........................ [RUN]
[0m19:24:58.527475 [debug] [Thread-2  ]: Began running node test.bain_capital_analytics.unique_stg_cashflows_cashflow_id.359e4f4704
[0m19:24:58.527886 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_date.d5c8f88f3e, now test.bain_capital_analytics.not_null_stg_cashflows_portfolio_id.cbd1d93e57)
[0m19:24:58.528220 [info ] [Thread-2  ]: 14 of 54 START test unique_stg_cashflows_cashflow_id ........................... [RUN]
[0m19:24:58.528552 [debug] [Thread-1  ]: Began compiling node test.bain_capital_analytics.not_null_stg_cashflows_portfolio_id.cbd1d93e57
[0m19:24:58.528884 [debug] [Thread-3  ]: SQL status: SELECT 1 in 0.002 seconds
[0m19:24:58.529182 [debug] [Thread-4  ]: SQL status: SELECT 1 in 0.002 seconds
[0m19:24:58.529511 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_id.ec87e4ee58, now test.bain_capital_analytics.unique_stg_cashflows_cashflow_id.359e4f4704)
[0m19:24:58.533445 [debug] [Thread-1  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_stg_cashflows_portfolio_id.cbd1d93e57"
[0m19:24:58.534638 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_stg_cashflows_fund_id.7ff8a45dde: ROLLBACK
[0m19:24:58.535645 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_stg_cashflows_cashflow_id.4176024898: ROLLBACK
[0m19:24:58.535958 [debug] [Thread-2  ]: Began compiling node test.bain_capital_analytics.unique_stg_cashflows_cashflow_id.359e4f4704
[0m19:24:58.542757 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_stg_cashflows_cashflow_id.4176024898: Close
[0m19:24:58.543248 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_stg_cashflows_fund_id.7ff8a45dde: Close
[0m19:24:58.544385 [debug] [Thread-2  ]: Writing injected SQL for node "test.bain_capital_analytics.unique_stg_cashflows_cashflow_id.359e4f4704"
[0m19:24:58.544988 [info ] [Thread-4  ]: 11 of 54 PASS not_null_stg_cashflows_cashflow_id ............................... [[32mPASS[0m in 0.05s]
[0m19:24:58.545697 [info ] [Thread-3  ]: 12 of 54 PASS not_null_stg_cashflows_fund_id ................................... [[32mPASS[0m in 0.05s]
[0m19:24:58.546039 [debug] [Thread-1  ]: Began executing node test.bain_capital_analytics.not_null_stg_cashflows_portfolio_id.cbd1d93e57
[0m19:24:58.546613 [debug] [Thread-4  ]: Finished running node test.bain_capital_analytics.not_null_stg_cashflows_cashflow_id.4176024898
[0m19:24:58.547101 [debug] [Thread-3  ]: Finished running node test.bain_capital_analytics.not_null_stg_cashflows_fund_id.7ff8a45dde
[0m19:24:58.549623 [debug] [Thread-1  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_stg_cashflows_portfolio_id.cbd1d93e57"
[0m19:24:58.550036 [debug] [Thread-4  ]: Began running node test.bain_capital_analytics.not_null_stg_fund_structures_fund_id.a284274f31
[0m19:24:58.550457 [debug] [Thread-3  ]: Began running node test.bain_capital_analytics.unique_stg_fund_structures_fund_id.bb9fec42ab
[0m19:24:58.550755 [debug] [Thread-2  ]: Began executing node test.bain_capital_analytics.unique_stg_cashflows_cashflow_id.359e4f4704
[0m19:24:58.551174 [info ] [Thread-4  ]: 15 of 54 START test not_null_stg_fund_structures_fund_id ....................... [RUN]
[0m19:24:58.551577 [info ] [Thread-3  ]: 16 of 54 START test unique_stg_fund_structures_fund_id ......................... [RUN]
[0m19:24:58.552049 [debug] [Thread-1  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_cashflows_portfolio_id.cbd1d93e57"
[0m19:24:58.554402 [debug] [Thread-2  ]: Writing runtime sql for node "test.bain_capital_analytics.unique_stg_cashflows_cashflow_id.359e4f4704"
[0m19:24:58.554786 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.not_null_stg_cashflows_cashflow_id.4176024898, now test.bain_capital_analytics.not_null_stg_fund_structures_fund_id.a284274f31)
[0m19:24:58.555123 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.not_null_stg_cashflows_fund_id.7ff8a45dde, now test.bain_capital_analytics.unique_stg_fund_structures_fund_id.bb9fec42ab)
[0m19:24:58.555444 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_stg_cashflows_portfolio_id.cbd1d93e57: BEGIN
[0m19:24:58.555826 [debug] [Thread-4  ]: Began compiling node test.bain_capital_analytics.not_null_stg_fund_structures_fund_id.a284274f31
[0m19:24:58.556138 [debug] [Thread-3  ]: Began compiling node test.bain_capital_analytics.unique_stg_fund_structures_fund_id.bb9fec42ab
[0m19:24:58.556474 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m19:24:58.560119 [debug] [Thread-4  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_stg_fund_structures_fund_id.a284274f31"
[0m19:24:58.560477 [debug] [Thread-2  ]: Using postgres connection "test.bain_capital_analytics.unique_stg_cashflows_cashflow_id.359e4f4704"
[0m19:24:58.563909 [debug] [Thread-3  ]: Writing injected SQL for node "test.bain_capital_analytics.unique_stg_fund_structures_fund_id.bb9fec42ab"
[0m19:24:58.564406 [debug] [Thread-2  ]: On test.bain_capital_analytics.unique_stg_cashflows_cashflow_id.359e4f4704: BEGIN
[0m19:24:58.564801 [debug] [Thread-2  ]: Opening a new connection, currently in state closed
[0m19:24:58.565245 [debug] [Thread-4  ]: Began executing node test.bain_capital_analytics.not_null_stg_fund_structures_fund_id.a284274f31
[0m19:24:58.567583 [debug] [Thread-4  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_stg_fund_structures_fund_id.a284274f31"
[0m19:24:58.567938 [debug] [Thread-3  ]: Began executing node test.bain_capital_analytics.unique_stg_fund_structures_fund_id.bb9fec42ab
[0m19:24:58.571126 [debug] [Thread-3  ]: Writing runtime sql for node "test.bain_capital_analytics.unique_stg_fund_structures_fund_id.bb9fec42ab"
[0m19:24:58.571614 [debug] [Thread-4  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_fund_structures_fund_id.a284274f31"
[0m19:24:58.571925 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_stg_fund_structures_fund_id.a284274f31: BEGIN
[0m19:24:58.572245 [debug] [Thread-3  ]: Using postgres connection "test.bain_capital_analytics.unique_stg_fund_structures_fund_id.bb9fec42ab"
[0m19:24:58.572550 [debug] [Thread-4  ]: Opening a new connection, currently in state closed
[0m19:24:58.572927 [debug] [Thread-3  ]: On test.bain_capital_analytics.unique_stg_fund_structures_fund_id.bb9fec42ab: BEGIN
[0m19:24:58.573386 [debug] [Thread-3  ]: Opening a new connection, currently in state closed
[0m19:24:58.573818 [debug] [Thread-2  ]: SQL status: BEGIN in 0.009 seconds
[0m19:24:58.574142 [debug] [Thread-1  ]: SQL status: BEGIN in 0.018 seconds
[0m19:24:58.574542 [debug] [Thread-2  ]: Using postgres connection "test.bain_capital_analytics.unique_stg_cashflows_cashflow_id.359e4f4704"
[0m19:24:58.574871 [debug] [Thread-1  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_cashflows_portfolio_id.cbd1d93e57"
[0m19:24:58.575200 [debug] [Thread-2  ]: On test.bain_capital_analytics.unique_stg_cashflows_cashflow_id.359e4f4704: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.unique_stg_cashflows_cashflow_id.359e4f4704"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

select
    cashflow_id as unique_field,
    count(*) as n_records

from "bain_analytics"."public"."stg_cashflows"
where cashflow_id is not null
group by cashflow_id
having count(*) > 1



  
  
      
    ) dbt_internal_test
[0m19:24:58.575564 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_stg_cashflows_portfolio_id.cbd1d93e57: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_stg_cashflows_portfolio_id.cbd1d93e57"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select portfolio_id
from "bain_analytics"."public"."stg_cashflows"
where portfolio_id is null



  
  
      
    ) dbt_internal_test
[0m19:24:58.577593 [debug] [Thread-1  ]: SQL status: SELECT 1 in 0.002 seconds
[0m19:24:58.577914 [debug] [Thread-2  ]: SQL status: SELECT 1 in 0.002 seconds
[0m19:24:58.579196 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_stg_cashflows_portfolio_id.cbd1d93e57: ROLLBACK
[0m19:24:58.580308 [debug] [Thread-2  ]: On test.bain_capital_analytics.unique_stg_cashflows_cashflow_id.359e4f4704: ROLLBACK
[0m19:24:58.580908 [debug] [Thread-2  ]: On test.bain_capital_analytics.unique_stg_cashflows_cashflow_id.359e4f4704: Close
[0m19:24:58.581240 [debug] [Thread-4  ]: SQL status: BEGIN in 0.009 seconds
[0m19:24:58.581522 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_stg_cashflows_portfolio_id.cbd1d93e57: Close
[0m19:24:58.582051 [info ] [Thread-2  ]: 14 of 54 PASS unique_stg_cashflows_cashflow_id ................................. [[32mPASS[0m in 0.05s]
[0m19:24:58.582411 [debug] [Thread-3  ]: SQL status: BEGIN in 0.009 seconds
[0m19:24:58.582726 [debug] [Thread-4  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_fund_structures_fund_id.a284274f31"
[0m19:24:58.583204 [info ] [Thread-1  ]: 13 of 54 PASS not_null_stg_cashflows_portfolio_id .............................. [[32mPASS[0m in 0.06s]
[0m19:24:58.583680 [debug] [Thread-2  ]: Finished running node test.bain_capital_analytics.unique_stg_cashflows_cashflow_id.359e4f4704
[0m19:24:58.583994 [debug] [Thread-3  ]: Using postgres connection "test.bain_capital_analytics.unique_stg_fund_structures_fund_id.bb9fec42ab"
[0m19:24:58.584322 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_stg_fund_structures_fund_id.a284274f31: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_stg_fund_structures_fund_id.a284274f31"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select fund_id
from "bain_analytics"."public"."stg_fund_structures"
where fund_id is null



  
  
      
    ) dbt_internal_test
[0m19:24:58.584759 [debug] [Thread-1  ]: Finished running node test.bain_capital_analytics.not_null_stg_cashflows_portfolio_id.cbd1d93e57
[0m19:24:58.585091 [debug] [Thread-2  ]: Began running node test.bain_capital_analytics.not_null_stg_dates_date_day.f3ec4da188
[0m19:24:58.585476 [debug] [Thread-3  ]: On test.bain_capital_analytics.unique_stg_fund_structures_fund_id.bb9fec42ab: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.unique_stg_fund_structures_fund_id.bb9fec42ab"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

select
    fund_id as unique_field,
    count(*) as n_records

from "bain_analytics"."public"."stg_fund_structures"
where fund_id is not null
group by fund_id
having count(*) > 1



  
  
      
    ) dbt_internal_test
[0m19:24:58.585860 [debug] [Thread-1  ]: Began running node test.bain_capital_analytics.unique_stg_dates_date_day.e062be8e28
[0m19:24:58.586216 [info ] [Thread-2  ]: 17 of 54 START test not_null_stg_dates_date_day ................................ [RUN]
[0m19:24:58.586581 [info ] [Thread-1  ]: 18 of 54 START test unique_stg_dates_date_day .................................. [RUN]
[0m19:24:58.586954 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.unique_stg_cashflows_cashflow_id.359e4f4704, now test.bain_capital_analytics.not_null_stg_dates_date_day.f3ec4da188)
[0m19:24:58.587289 [debug] [Thread-4  ]: SQL status: SELECT 1 in 0.001 seconds
[0m19:24:58.587632 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.not_null_stg_cashflows_portfolio_id.cbd1d93e57, now test.bain_capital_analytics.unique_stg_dates_date_day.e062be8e28)
[0m19:24:58.587970 [debug] [Thread-3  ]: SQL status: SELECT 1 in 0.001 seconds
[0m19:24:58.588256 [debug] [Thread-2  ]: Began compiling node test.bain_capital_analytics.not_null_stg_dates_date_day.f3ec4da188
[0m19:24:58.589317 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_stg_fund_structures_fund_id.a284274f31: ROLLBACK
[0m19:24:58.589624 [debug] [Thread-1  ]: Began compiling node test.bain_capital_analytics.unique_stg_dates_date_day.e062be8e28
[0m19:24:58.590618 [debug] [Thread-3  ]: On test.bain_capital_analytics.unique_stg_fund_structures_fund_id.bb9fec42ab: ROLLBACK
[0m19:24:58.594586 [debug] [Thread-2  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_stg_dates_date_day.f3ec4da188"
[0m19:24:58.598072 [debug] [Thread-1  ]: Writing injected SQL for node "test.bain_capital_analytics.unique_stg_dates_date_day.e062be8e28"
[0m19:24:58.598414 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_stg_fund_structures_fund_id.a284274f31: Close
[0m19:24:58.599172 [info ] [Thread-4  ]: 15 of 54 PASS not_null_stg_fund_structures_fund_id ............................. [[32mPASS[0m in 0.04s]
[0m19:24:58.599516 [debug] [Thread-3  ]: On test.bain_capital_analytics.unique_stg_fund_structures_fund_id.bb9fec42ab: Close
[0m19:24:58.599925 [debug] [Thread-4  ]: Finished running node test.bain_capital_analytics.not_null_stg_fund_structures_fund_id.a284274f31
[0m19:24:58.600216 [debug] [Thread-2  ]: Began executing node test.bain_capital_analytics.not_null_stg_dates_date_day.f3ec4da188
[0m19:24:58.600751 [info ] [Thread-3  ]: 16 of 54 PASS unique_stg_fund_structures_fund_id ............................... [[32mPASS[0m in 0.05s]
[0m19:24:58.601139 [debug] [Thread-4  ]: Began running node test.bain_capital_analytics.not_null_stg_instruments_instrument_id.18bdfd2ebe
[0m19:24:58.601457 [debug] [Thread-1  ]: Began executing node test.bain_capital_analytics.unique_stg_dates_date_day.e062be8e28
[0m19:24:58.603911 [debug] [Thread-2  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_stg_dates_date_day.f3ec4da188"
[0m19:24:58.604360 [debug] [Thread-3  ]: Finished running node test.bain_capital_analytics.unique_stg_fund_structures_fund_id.bb9fec42ab
[0m19:24:58.604684 [info ] [Thread-4  ]: 19 of 54 START test not_null_stg_instruments_instrument_id ..................... [RUN]
[0m19:24:58.606956 [debug] [Thread-1  ]: Writing runtime sql for node "test.bain_capital_analytics.unique_stg_dates_date_day.e062be8e28"
[0m19:24:58.607377 [debug] [Thread-3  ]: Began running node test.bain_capital_analytics.unique_stg_instruments_instrument_id.0e70adcd34
[0m19:24:58.607824 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.not_null_stg_fund_structures_fund_id.a284274f31, now test.bain_capital_analytics.not_null_stg_instruments_instrument_id.18bdfd2ebe)
[0m19:24:58.608260 [debug] [Thread-2  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_dates_date_day.f3ec4da188"
[0m19:24:58.608589 [info ] [Thread-3  ]: 20 of 54 START test unique_stg_instruments_instrument_id ....................... [RUN]
[0m19:24:58.608940 [debug] [Thread-4  ]: Began compiling node test.bain_capital_analytics.not_null_stg_instruments_instrument_id.18bdfd2ebe
[0m19:24:58.609265 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_stg_dates_date_day.f3ec4da188: BEGIN
[0m19:24:58.609606 [debug] [Thread-1  ]: Using postgres connection "test.bain_capital_analytics.unique_stg_dates_date_day.e062be8e28"
[0m19:24:58.609957 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.unique_stg_fund_structures_fund_id.bb9fec42ab, now test.bain_capital_analytics.unique_stg_instruments_instrument_id.0e70adcd34)
[0m19:24:58.614463 [debug] [Thread-4  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_stg_instruments_instrument_id.18bdfd2ebe"
[0m19:24:58.614803 [debug] [Thread-2  ]: Opening a new connection, currently in state closed
[0m19:24:58.615107 [debug] [Thread-1  ]: On test.bain_capital_analytics.unique_stg_dates_date_day.e062be8e28: BEGIN
[0m19:24:58.615415 [debug] [Thread-3  ]: Began compiling node test.bain_capital_analytics.unique_stg_instruments_instrument_id.0e70adcd34
[0m19:24:58.615871 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m19:24:58.619266 [debug] [Thread-3  ]: Writing injected SQL for node "test.bain_capital_analytics.unique_stg_instruments_instrument_id.0e70adcd34"
[0m19:24:58.619606 [debug] [Thread-4  ]: Began executing node test.bain_capital_analytics.not_null_stg_instruments_instrument_id.18bdfd2ebe
[0m19:24:58.622017 [debug] [Thread-4  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_stg_instruments_instrument_id.18bdfd2ebe"
[0m19:24:58.622483 [debug] [Thread-3  ]: Began executing node test.bain_capital_analytics.unique_stg_instruments_instrument_id.0e70adcd34
[0m19:24:58.624821 [debug] [Thread-3  ]: Writing runtime sql for node "test.bain_capital_analytics.unique_stg_instruments_instrument_id.0e70adcd34"
[0m19:24:58.625346 [debug] [Thread-4  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_instruments_instrument_id.18bdfd2ebe"
[0m19:24:58.625660 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_stg_instruments_instrument_id.18bdfd2ebe: BEGIN
[0m19:24:58.625981 [debug] [Thread-2  ]: SQL status: BEGIN in 0.011 seconds
[0m19:24:58.626270 [debug] [Thread-4  ]: Opening a new connection, currently in state closed
[0m19:24:58.626652 [debug] [Thread-3  ]: Using postgres connection "test.bain_capital_analytics.unique_stg_instruments_instrument_id.0e70adcd34"
[0m19:24:58.627020 [debug] [Thread-2  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_dates_date_day.f3ec4da188"
[0m19:24:58.627319 [debug] [Thread-1  ]: SQL status: BEGIN in 0.011 seconds
[0m19:24:58.627714 [debug] [Thread-3  ]: On test.bain_capital_analytics.unique_stg_instruments_instrument_id.0e70adcd34: BEGIN
[0m19:24:58.628027 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_stg_dates_date_day.f3ec4da188: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_stg_dates_date_day.f3ec4da188"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select date_day
from "bain_analytics"."public"."stg_dates"
where date_day is null



  
  
      
    ) dbt_internal_test
[0m19:24:58.628351 [debug] [Thread-1  ]: Using postgres connection "test.bain_capital_analytics.unique_stg_dates_date_day.e062be8e28"
[0m19:24:58.628649 [debug] [Thread-3  ]: Opening a new connection, currently in state closed
[0m19:24:58.628991 [debug] [Thread-1  ]: On test.bain_capital_analytics.unique_stg_dates_date_day.e062be8e28: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.unique_stg_dates_date_day.e062be8e28"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

select
    date_day as unique_field,
    count(*) as n_records

from "bain_analytics"."public"."stg_dates"
where date_day is not null
group by date_day
having count(*) > 1



  
  
      
    ) dbt_internal_test
[0m19:24:58.629981 [debug] [Thread-2  ]: SQL status: SELECT 1 in 0.001 seconds
[0m19:24:58.631237 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_stg_dates_date_day.f3ec4da188: ROLLBACK
[0m19:24:58.631551 [debug] [Thread-1  ]: SQL status: SELECT 1 in 0.002 seconds
[0m19:24:58.632594 [debug] [Thread-1  ]: On test.bain_capital_analytics.unique_stg_dates_date_day.e062be8e28: ROLLBACK
[0m19:24:58.632898 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_stg_dates_date_day.f3ec4da188: Close
[0m19:24:58.633698 [debug] [Thread-1  ]: On test.bain_capital_analytics.unique_stg_dates_date_day.e062be8e28: Close
[0m19:24:58.633423 [info ] [Thread-2  ]: 17 of 54 PASS not_null_stg_dates_date_day ...................................... [[32mPASS[0m in 0.05s]
[0m19:24:58.634255 [debug] [Thread-2  ]: Finished running node test.bain_capital_analytics.not_null_stg_dates_date_day.f3ec4da188
[0m19:24:58.634584 [debug] [Thread-2  ]: Began running node test.bain_capital_analytics.not_null_stg_portfolios_fund_id.70b04d82bd
[0m19:24:58.635019 [info ] [Thread-1  ]: 18 of 54 PASS unique_stg_dates_date_day ........................................ [[32mPASS[0m in 0.05s]
[0m19:24:58.635499 [info ] [Thread-2  ]: 21 of 54 START test not_null_stg_portfolios_fund_id ............................ [RUN]
[0m19:24:58.635989 [debug] [Thread-1  ]: Finished running node test.bain_capital_analytics.unique_stg_dates_date_day.e062be8e28
[0m19:24:58.636305 [debug] [Thread-4  ]: SQL status: BEGIN in 0.010 seconds
[0m19:24:58.636669 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.not_null_stg_dates_date_day.f3ec4da188, now test.bain_capital_analytics.not_null_stg_portfolios_fund_id.70b04d82bd)
[0m19:24:58.637025 [debug] [Thread-1  ]: Began running node test.bain_capital_analytics.not_null_stg_portfolios_portfolio_id.7126a480ec
[0m19:24:58.637345 [debug] [Thread-3  ]: SQL status: BEGIN in 0.009 seconds
[0m19:24:58.637696 [debug] [Thread-4  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_instruments_instrument_id.18bdfd2ebe"
[0m19:24:58.638084 [debug] [Thread-2  ]: Began compiling node test.bain_capital_analytics.not_null_stg_portfolios_fund_id.70b04d82bd
[0m19:24:58.638402 [info ] [Thread-1  ]: 22 of 54 START test not_null_stg_portfolios_portfolio_id ....................... [RUN]
[0m19:24:58.638751 [debug] [Thread-3  ]: Using postgres connection "test.bain_capital_analytics.unique_stg_instruments_instrument_id.0e70adcd34"
[0m19:24:58.639071 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_stg_instruments_instrument_id.18bdfd2ebe: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_stg_instruments_instrument_id.18bdfd2ebe"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select instrument_id
from "bain_analytics"."public"."stg_instruments"
where instrument_id is null



  
  
      
    ) dbt_internal_test
[0m19:24:58.643075 [debug] [Thread-2  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_stg_portfolios_fund_id.70b04d82bd"
[0m19:24:58.643429 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.unique_stg_dates_date_day.e062be8e28, now test.bain_capital_analytics.not_null_stg_portfolios_portfolio_id.7126a480ec)
[0m19:24:58.643759 [debug] [Thread-3  ]: On test.bain_capital_analytics.unique_stg_instruments_instrument_id.0e70adcd34: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.unique_stg_instruments_instrument_id.0e70adcd34"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

select
    instrument_id as unique_field,
    count(*) as n_records

from "bain_analytics"."public"."stg_instruments"
where instrument_id is not null
group by instrument_id
having count(*) > 1



  
  
      
    ) dbt_internal_test
[0m19:24:58.644188 [debug] [Thread-1  ]: Began compiling node test.bain_capital_analytics.not_null_stg_portfolios_portfolio_id.7126a480ec
[0m19:24:58.647786 [debug] [Thread-1  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_stg_portfolios_portfolio_id.7126a480ec"
[0m19:24:58.648129 [debug] [Thread-3  ]: SQL status: SELECT 1 in 0.004 seconds
[0m19:24:58.648446 [debug] [Thread-4  ]: SQL status: SELECT 1 in 0.004 seconds
[0m19:24:58.649745 [debug] [Thread-3  ]: On test.bain_capital_analytics.unique_stg_instruments_instrument_id.0e70adcd34: ROLLBACK
[0m19:24:58.650108 [debug] [Thread-2  ]: Began executing node test.bain_capital_analytics.not_null_stg_portfolios_fund_id.70b04d82bd
[0m19:24:58.651196 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_stg_instruments_instrument_id.18bdfd2ebe: ROLLBACK
[0m19:24:58.654667 [debug] [Thread-2  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_stg_portfolios_fund_id.70b04d82bd"
[0m19:24:58.654998 [debug] [Thread-1  ]: Began executing node test.bain_capital_analytics.not_null_stg_portfolios_portfolio_id.7126a480ec
[0m19:24:58.655297 [debug] [Thread-3  ]: On test.bain_capital_analytics.unique_stg_instruments_instrument_id.0e70adcd34: Close
[0m19:24:58.657926 [debug] [Thread-1  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_stg_portfolios_portfolio_id.7126a480ec"
[0m19:24:58.658613 [info ] [Thread-3  ]: 20 of 54 PASS unique_stg_instruments_instrument_id ............................. [[32mPASS[0m in 0.05s]
[0m19:24:58.659218 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_stg_instruments_instrument_id.18bdfd2ebe: Close
[0m19:24:58.659573 [debug] [Thread-2  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_portfolios_fund_id.70b04d82bd"
[0m19:24:58.660190 [debug] [Thread-3  ]: Finished running node test.bain_capital_analytics.unique_stg_instruments_instrument_id.0e70adcd34
[0m19:24:58.660755 [info ] [Thread-4  ]: 19 of 54 PASS not_null_stg_instruments_instrument_id ........................... [[32mPASS[0m in 0.05s]
[0m19:24:58.661164 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_stg_portfolios_fund_id.70b04d82bd: BEGIN
[0m19:24:58.661569 [debug] [Thread-3  ]: Began running node test.bain_capital_analytics.unique_stg_portfolios_portfolio_id.aa125b6658
[0m19:24:58.662030 [debug] [Thread-1  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_portfolios_portfolio_id.7126a480ec"
[0m19:24:58.662476 [debug] [Thread-4  ]: Finished running node test.bain_capital_analytics.not_null_stg_instruments_instrument_id.18bdfd2ebe
[0m19:24:58.662794 [debug] [Thread-2  ]: Opening a new connection, currently in state closed
[0m19:24:58.663109 [info ] [Thread-3  ]: 23 of 54 START test unique_stg_portfolios_portfolio_id ......................... [RUN]
[0m19:24:58.663455 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_stg_portfolios_portfolio_id.7126a480ec: BEGIN
[0m19:24:58.663792 [debug] [Thread-4  ]: Began running node test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c
[0m19:24:58.664290 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.unique_stg_instruments_instrument_id.0e70adcd34, now test.bain_capital_analytics.unique_stg_portfolios_portfolio_id.aa125b6658)
[0m19:24:58.664612 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m19:24:58.664949 [info ] [Thread-4  ]: 24 of 54 START test not_null_stg_positions_portfolio_id ........................ [RUN]
[0m19:24:58.665324 [debug] [Thread-3  ]: Began compiling node test.bain_capital_analytics.unique_stg_portfolios_portfolio_id.aa125b6658
[0m19:24:58.665792 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.not_null_stg_instruments_instrument_id.18bdfd2ebe, now test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c)
[0m19:24:58.669762 [debug] [Thread-3  ]: Writing injected SQL for node "test.bain_capital_analytics.unique_stg_portfolios_portfolio_id.aa125b6658"
[0m19:24:58.670131 [debug] [Thread-4  ]: Began compiling node test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c
[0m19:24:58.673708 [debug] [Thread-4  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c"
[0m19:24:58.674508 [debug] [Thread-3  ]: Began executing node test.bain_capital_analytics.unique_stg_portfolios_portfolio_id.aa125b6658
[0m19:24:58.674832 [debug] [Thread-4  ]: Began executing node test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c
[0m19:24:58.675164 [debug] [Thread-2  ]: SQL status: BEGIN in 0.012 seconds
[0m19:24:58.675484 [debug] [Thread-1  ]: SQL status: BEGIN in 0.011 seconds
[0m19:24:58.677840 [debug] [Thread-3  ]: Writing runtime sql for node "test.bain_capital_analytics.unique_stg_portfolios_portfolio_id.aa125b6658"
[0m19:24:58.680083 [debug] [Thread-4  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c"
[0m19:24:58.680407 [debug] [Thread-2  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_portfolios_fund_id.70b04d82bd"
[0m19:24:58.680702 [debug] [Thread-1  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_portfolios_portfolio_id.7126a480ec"
[0m19:24:58.681163 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_stg_portfolios_fund_id.70b04d82bd: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_stg_portfolios_fund_id.70b04d82bd"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select fund_id
from "bain_analytics"."public"."stg_portfolios"
where fund_id is null



  
  
      
    ) dbt_internal_test
[0m19:24:58.681594 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_stg_portfolios_portfolio_id.7126a480ec: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_stg_portfolios_portfolio_id.7126a480ec"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select portfolio_id
from "bain_analytics"."public"."stg_portfolios"
where portfolio_id is null



  
  
      
    ) dbt_internal_test
[0m19:24:58.681970 [debug] [Thread-3  ]: Using postgres connection "test.bain_capital_analytics.unique_stg_portfolios_portfolio_id.aa125b6658"
[0m19:24:58.682326 [debug] [Thread-4  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c"
[0m19:24:58.682670 [debug] [Thread-3  ]: On test.bain_capital_analytics.unique_stg_portfolios_portfolio_id.aa125b6658: BEGIN
[0m19:24:58.682973 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c: BEGIN
[0m19:24:58.683271 [debug] [Thread-3  ]: Opening a new connection, currently in state closed
[0m19:24:58.683554 [debug] [Thread-4  ]: Opening a new connection, currently in state closed
[0m19:24:58.684070 [debug] [Thread-2  ]: SQL status: SELECT 1 in 0.002 seconds
[0m19:24:58.684390 [debug] [Thread-1  ]: SQL status: SELECT 1 in 0.002 seconds
[0m19:24:58.686766 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_stg_portfolios_fund_id.70b04d82bd: ROLLBACK
[0m19:24:58.687966 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_stg_portfolios_portfolio_id.7126a480ec: ROLLBACK
[0m19:24:58.688674 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_stg_portfolios_fund_id.70b04d82bd: Close
[0m19:24:58.688980 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_stg_portfolios_portfolio_id.7126a480ec: Close
[0m19:24:58.689529 [info ] [Thread-2  ]: 21 of 54 PASS not_null_stg_portfolios_fund_id .................................. [[32mPASS[0m in 0.05s]
[0m19:24:58.690597 [info ] [Thread-1  ]: 22 of 54 PASS not_null_stg_portfolios_portfolio_id ............................. [[32mPASS[0m in 0.05s]
[0m19:24:58.691412 [debug] [Thread-2  ]: Finished running node test.bain_capital_analytics.not_null_stg_portfolios_fund_id.70b04d82bd
[0m19:24:58.691901 [debug] [Thread-1  ]: Finished running node test.bain_capital_analytics.not_null_stg_portfolios_portfolio_id.7126a480ec
[0m19:24:58.692321 [debug] [Thread-2  ]: Began running node test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1
[0m19:24:58.692902 [debug] [Thread-1  ]: Began running node test.bain_capital_analytics.relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_.2823f12709
[0m19:24:58.693304 [info ] [Thread-2  ]: 25 of 54 START test not_null_stg_positions_position_id ......................... [RUN]
[0m19:24:58.693852 [info ] [Thread-1  ]: 26 of 54 START test relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_  [RUN]
[0m19:24:58.694208 [debug] [Thread-3  ]: SQL status: BEGIN in 0.011 seconds
[0m19:24:58.694630 [debug] [Thread-4  ]: SQL status: BEGIN in 0.011 seconds
[0m19:24:58.695053 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.not_null_stg_portfolios_fund_id.70b04d82bd, now test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1)
[0m19:24:58.695451 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.not_null_stg_portfolios_portfolio_id.7126a480ec, now test.bain_capital_analytics.relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_.2823f12709)
[0m19:24:58.695829 [debug] [Thread-3  ]: Using postgres connection "test.bain_capital_analytics.unique_stg_portfolios_portfolio_id.aa125b6658"
[0m19:24:58.696134 [debug] [Thread-4  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c"
[0m19:24:58.696442 [debug] [Thread-2  ]: Began compiling node test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1
[0m19:24:58.696745 [debug] [Thread-1  ]: Began compiling node test.bain_capital_analytics.relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_.2823f12709
[0m19:24:58.697059 [debug] [Thread-3  ]: On test.bain_capital_analytics.unique_stg_portfolios_portfolio_id.aa125b6658: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.unique_stg_portfolios_portfolio_id.aa125b6658"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

select
    portfolio_id as unique_field,
    count(*) as n_records

from "bain_analytics"."public"."stg_portfolios"
where portfolio_id is not null
group by portfolio_id
having count(*) > 1



  
  
      
    ) dbt_internal_test
[0m19:24:58.697378 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select portfolio_id
from "bain_analytics"."public"."stg_positions"
where portfolio_id is null



  
  
      
    ) dbt_internal_test
[0m19:24:58.701411 [debug] [Thread-2  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1"
[0m19:24:58.708540 [debug] [Thread-1  ]: Writing injected SQL for node "test.bain_capital_analytics.relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_.2823f12709"
[0m19:24:58.709366 [debug] [Thread-2  ]: Began executing node test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1
[0m19:24:58.709710 [debug] [Thread-1  ]: Began executing node test.bain_capital_analytics.relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_.2823f12709
[0m19:24:58.712137 [debug] [Thread-2  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1"
[0m19:24:58.712508 [debug] [Thread-4  ]: SQL status: SELECT 1 in 0.004 seconds
[0m19:24:58.714797 [debug] [Thread-1  ]: Writing runtime sql for node "test.bain_capital_analytics.relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_.2823f12709"
[0m19:24:58.715092 [debug] [Thread-3  ]: SQL status: SELECT 1 in 0.006 seconds
[0m19:24:58.716382 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c: ROLLBACK
[0m19:24:58.717644 [debug] [Thread-3  ]: On test.bain_capital_analytics.unique_stg_portfolios_portfolio_id.aa125b6658: ROLLBACK
[0m19:24:58.718210 [debug] [Thread-1  ]: Using postgres connection "test.bain_capital_analytics.relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_.2823f12709"
[0m19:24:58.718549 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c: Close
[0m19:24:58.718837 [debug] [Thread-3  ]: On test.bain_capital_analytics.unique_stg_portfolios_portfolio_id.aa125b6658: Close
[0m19:24:58.719118 [debug] [Thread-1  ]: On test.bain_capital_analytics.relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_.2823f12709: BEGIN
[0m19:24:58.719442 [debug] [Thread-2  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1"
[0m19:24:58.719959 [info ] [Thread-4  ]: 24 of 54 PASS not_null_stg_positions_portfolio_id .............................. [[32mPASS[0m in 0.05s]
[0m19:24:58.720673 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m19:24:58.720329 [info ] [Thread-3  ]: 23 of 54 PASS unique_stg_portfolios_portfolio_id ............................... [[32mPASS[0m in 0.06s]
[0m19:24:58.721089 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1: BEGIN
[0m19:24:58.721525 [debug] [Thread-4  ]: Finished running node test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c
[0m19:24:58.722048 [debug] [Thread-3  ]: Finished running node test.bain_capital_analytics.unique_stg_portfolios_portfolio_id.aa125b6658
[0m19:24:58.722350 [debug] [Thread-2  ]: Opening a new connection, currently in state closed
[0m19:24:58.722697 [debug] [Thread-4  ]: Began running node test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f
[0m19:24:58.723102 [debug] [Thread-3  ]: Began running node test.bain_capital_analytics.not_null_stg_valuations_portfolio_id.d5af3e5188
[0m19:24:58.723680 [info ] [Thread-4  ]: 27 of 54 START test unique_stg_positions_position_id ........................... [RUN]
[0m19:24:58.724063 [info ] [Thread-3  ]: 28 of 54 START test not_null_stg_valuations_portfolio_id ....................... [RUN]
[0m19:24:58.724600 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c, now test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f)
[0m19:24:58.724956 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.unique_stg_portfolios_portfolio_id.aa125b6658, now test.bain_capital_analytics.not_null_stg_valuations_portfolio_id.d5af3e5188)
[0m19:24:58.725315 [debug] [Thread-4  ]: Began compiling node test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f
[0m19:24:58.725655 [debug] [Thread-3  ]: Began compiling node test.bain_capital_analytics.not_null_stg_valuations_portfolio_id.d5af3e5188
[0m19:24:58.729507 [debug] [Thread-4  ]: Writing injected SQL for node "test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f"
[0m19:24:58.734224 [debug] [Thread-3  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_stg_valuations_portfolio_id.d5af3e5188"
[0m19:24:58.734602 [debug] [Thread-1  ]: SQL status: BEGIN in 0.014 seconds
[0m19:24:58.735109 [debug] [Thread-1  ]: Using postgres connection "test.bain_capital_analytics.relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_.2823f12709"
[0m19:24:58.735460 [debug] [Thread-2  ]: SQL status: BEGIN in 0.013 seconds
[0m19:24:58.735832 [debug] [Thread-1  ]: On test.bain_capital_analytics.relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_.2823f12709: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_.2823f12709"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

with child as (
    select portfolio_id as from_field
    from "bain_analytics"."public"."stg_positions"
    where portfolio_id is not null
),

parent as (
    select portfolio_id as to_field
    from "bain_analytics"."public"."stg_portfolios"
)

select
    from_field

from child
left join parent
    on child.from_field = parent.to_field

where parent.to_field is null



  
  
      
    ) dbt_internal_test
[0m19:24:58.736207 [debug] [Thread-2  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1"
[0m19:24:58.736586 [debug] [Thread-3  ]: Began executing node test.bain_capital_analytics.not_null_stg_valuations_portfolio_id.d5af3e5188
[0m19:24:58.736903 [debug] [Thread-4  ]: Began executing node test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f
[0m19:24:58.737209 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select position_id
from "bain_analytics"."public"."stg_positions"
where position_id is null



  
  
      
    ) dbt_internal_test
[0m19:24:58.739504 [debug] [Thread-3  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_stg_valuations_portfolio_id.d5af3e5188"
[0m19:24:58.739838 [debug] [Thread-1  ]: SQL status: SELECT 1 in 0.003 seconds
[0m19:24:58.742087 [debug] [Thread-4  ]: Writing runtime sql for node "test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f"
[0m19:24:58.743468 [debug] [Thread-1  ]: On test.bain_capital_analytics.relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_.2823f12709: ROLLBACK
[0m19:24:58.743897 [debug] [Thread-2  ]: SQL status: SELECT 1 in 0.001 seconds
[0m19:24:58.745171 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1: ROLLBACK
[0m19:24:58.745513 [debug] [Thread-1  ]: On test.bain_capital_analytics.relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_.2823f12709: Close
[0m19:24:58.745844 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1: Close
[0m19:24:58.746212 [debug] [Thread-3  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_valuations_portfolio_id.d5af3e5188"
[0m19:24:58.746710 [info ] [Thread-1  ]: 26 of 54 PASS relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_  [[32mPASS[0m in 0.05s]
[0m19:24:58.747128 [debug] [Thread-4  ]: Using postgres connection "test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f"
[0m19:24:58.747554 [info ] [Thread-2  ]: 25 of 54 PASS not_null_stg_positions_position_id ............................... [[32mPASS[0m in 0.05s]
[0m19:24:58.747900 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_stg_valuations_portfolio_id.d5af3e5188: BEGIN
[0m19:24:58.748345 [debug] [Thread-1  ]: Finished running node test.bain_capital_analytics.relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_.2823f12709
[0m19:24:58.748653 [debug] [Thread-4  ]: On test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f: BEGIN
[0m19:24:58.749073 [debug] [Thread-2  ]: Finished running node test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1
[0m19:24:58.749370 [debug] [Thread-3  ]: Opening a new connection, currently in state closed
[0m19:24:58.749720 [debug] [Thread-1  ]: Began running node test.bain_capital_analytics.not_null_stg_valuations_valuation_id.88ca70781d
[0m19:24:58.750084 [debug] [Thread-4  ]: Opening a new connection, currently in state closed
[0m19:24:58.750405 [debug] [Thread-2  ]: Began running node test.bain_capital_analytics.unique_stg_valuations_valuation_id.fce7eb13b5
[0m19:24:58.750853 [info ] [Thread-1  ]: 29 of 54 START test not_null_stg_valuations_valuation_id ....................... [RUN]
[0m19:24:58.751295 [info ] [Thread-2  ]: 30 of 54 START test unique_stg_valuations_valuation_id ......................... [RUN]
[0m19:24:58.751670 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_.2823f12709, now test.bain_capital_analytics.not_null_stg_valuations_valuation_id.88ca70781d)
[0m19:24:58.752020 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1, now test.bain_capital_analytics.unique_stg_valuations_valuation_id.fce7eb13b5)
[0m19:24:58.752355 [debug] [Thread-1  ]: Began compiling node test.bain_capital_analytics.not_null_stg_valuations_valuation_id.88ca70781d
[0m19:24:58.752667 [debug] [Thread-2  ]: Began compiling node test.bain_capital_analytics.unique_stg_valuations_valuation_id.fce7eb13b5
[0m19:24:58.756552 [debug] [Thread-1  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_stg_valuations_valuation_id.88ca70781d"
[0m19:24:58.760050 [debug] [Thread-2  ]: Writing injected SQL for node "test.bain_capital_analytics.unique_stg_valuations_valuation_id.fce7eb13b5"
[0m19:24:58.760717 [debug] [Thread-1  ]: Began executing node test.bain_capital_analytics.not_null_stg_valuations_valuation_id.88ca70781d
[0m19:24:58.761053 [debug] [Thread-3  ]: SQL status: BEGIN in 0.012 seconds
[0m19:24:58.763334 [debug] [Thread-1  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_stg_valuations_valuation_id.88ca70781d"
[0m19:24:58.763641 [debug] [Thread-4  ]: SQL status: BEGIN in 0.014 seconds
[0m19:24:58.763950 [debug] [Thread-2  ]: Began executing node test.bain_capital_analytics.unique_stg_valuations_valuation_id.fce7eb13b5
[0m19:24:58.764271 [debug] [Thread-3  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_valuations_portfolio_id.d5af3e5188"
[0m19:24:58.764639 [debug] [Thread-4  ]: Using postgres connection "test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f"
[0m19:24:58.811378 [debug] [Thread-2  ]: Writing runtime sql for node "test.bain_capital_analytics.unique_stg_valuations_valuation_id.fce7eb13b5"
[0m19:24:58.811831 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_stg_valuations_portfolio_id.d5af3e5188: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_stg_valuations_portfolio_id.d5af3e5188"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select portfolio_id
from "bain_analytics"."public"."stg_valuations"
where portfolio_id is null



  
  
      
    ) dbt_internal_test
[0m19:24:58.812247 [debug] [Thread-1  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_valuations_valuation_id.88ca70781d"
[0m19:24:58.812659 [debug] [Thread-4  ]: On test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

select
    position_id as unique_field,
    count(*) as n_records

from "bain_analytics"."public"."stg_positions"
where position_id is not null
group by position_id
having count(*) > 1



  
  
      
    ) dbt_internal_test
[0m19:24:58.813156 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_stg_valuations_valuation_id.88ca70781d: BEGIN
[0m19:24:58.813576 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m19:24:58.813975 [debug] [Thread-2  ]: Using postgres connection "test.bain_capital_analytics.unique_stg_valuations_valuation_id.fce7eb13b5"
[0m19:24:58.814394 [debug] [Thread-2  ]: On test.bain_capital_analytics.unique_stg_valuations_valuation_id.fce7eb13b5: BEGIN
[0m19:24:58.814686 [debug] [Thread-2  ]: Opening a new connection, currently in state closed
[0m19:24:58.815222 [debug] [Thread-3  ]: SQL status: SELECT 1 in 0.002 seconds
[0m19:24:58.816553 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_stg_valuations_portfolio_id.d5af3e5188: ROLLBACK
[0m19:24:58.816886 [debug] [Thread-4  ]: SQL status: SELECT 1 in 0.003 seconds
[0m19:24:58.817914 [debug] [Thread-4  ]: On test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f: ROLLBACK
[0m19:24:58.818224 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_stg_valuations_portfolio_id.d5af3e5188: Close
[0m19:24:58.818777 [info ] [Thread-3  ]: 28 of 54 PASS not_null_stg_valuations_portfolio_id ............................. [[32mPASS[0m in 0.09s]
[0m19:24:58.819122 [debug] [Thread-4  ]: On test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f: Close
[0m19:24:58.819541 [debug] [Thread-3  ]: Finished running node test.bain_capital_analytics.not_null_stg_valuations_portfolio_id.d5af3e5188
[0m19:24:58.820055 [info ] [Thread-4  ]: 27 of 54 PASS unique_stg_positions_position_id ................................. [[32mPASS[0m in 0.10s]
[0m19:24:58.820438 [debug] [Thread-3  ]: Began running node model.bain_capital_analytics.int_benchmark_returns
[0m19:24:58.820954 [debug] [Thread-4  ]: Finished running node test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f
[0m19:24:58.821392 [info ] [Thread-3  ]: 31 of 54 START sql view model public.int_benchmark_returns ..................... [RUN]
[0m19:24:58.821749 [debug] [Thread-4  ]: Began running node model.bain_capital_analytics.int_cashflow_enriched
[0m19:24:58.822154 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.not_null_stg_valuations_portfolio_id.d5af3e5188, now model.bain_capital_analytics.int_benchmark_returns)
[0m19:24:58.822644 [info ] [Thread-4  ]: 32 of 54 START sql view model public.int_cashflow_enriched ..................... [RUN]
[0m19:24:58.823073 [debug] [Thread-3  ]: Began compiling node model.bain_capital_analytics.int_benchmark_returns
[0m19:24:58.823540 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f, now model.bain_capital_analytics.int_cashflow_enriched)
[0m19:24:58.823950 [debug] [Thread-2  ]: SQL status: BEGIN in 0.009 seconds
[0m19:24:58.827345 [debug] [Thread-3  ]: Writing injected SQL for node "model.bain_capital_analytics.int_benchmark_returns"
[0m19:24:58.827656 [debug] [Thread-1  ]: SQL status: BEGIN in 0.014 seconds
[0m19:24:58.827966 [debug] [Thread-4  ]: Began compiling node model.bain_capital_analytics.int_cashflow_enriched
[0m19:24:58.828273 [debug] [Thread-2  ]: Using postgres connection "test.bain_capital_analytics.unique_stg_valuations_valuation_id.fce7eb13b5"
[0m19:24:58.828651 [debug] [Thread-1  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_valuations_valuation_id.88ca70781d"
[0m19:24:58.831896 [debug] [Thread-4  ]: Writing injected SQL for node "model.bain_capital_analytics.int_cashflow_enriched"
[0m19:24:58.832261 [debug] [Thread-2  ]: On test.bain_capital_analytics.unique_stg_valuations_valuation_id.fce7eb13b5: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.unique_stg_valuations_valuation_id.fce7eb13b5"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

select
    valuation_id as unique_field,
    count(*) as n_records

from "bain_analytics"."public"."stg_valuations"
where valuation_id is not null
group by valuation_id
having count(*) > 1



  
  
      
    ) dbt_internal_test
[0m19:24:58.832617 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_stg_valuations_valuation_id.88ca70781d: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_stg_valuations_valuation_id.88ca70781d"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select valuation_id
from "bain_analytics"."public"."stg_valuations"
where valuation_id is null



  
  
      
    ) dbt_internal_test
[0m19:24:58.832946 [debug] [Thread-3  ]: Began executing node model.bain_capital_analytics.int_benchmark_returns
[0m19:24:58.833461 [debug] [Thread-4  ]: Began executing node model.bain_capital_analytics.int_cashflow_enriched
[0m19:24:58.836731 [debug] [Thread-3  ]: Writing runtime sql for node "model.bain_capital_analytics.int_benchmark_returns"
[0m19:24:58.837058 [debug] [Thread-1  ]: SQL status: SELECT 1 in 0.004 seconds
[0m19:24:58.840245 [debug] [Thread-4  ]: Writing runtime sql for node "model.bain_capital_analytics.int_cashflow_enriched"
[0m19:24:58.840547 [debug] [Thread-2  ]: SQL status: SELECT 1 in 0.007 seconds
[0m19:24:58.841945 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_stg_valuations_valuation_id.88ca70781d: ROLLBACK
[0m19:24:58.843134 [debug] [Thread-2  ]: On test.bain_capital_analytics.unique_stg_valuations_valuation_id.fce7eb13b5: ROLLBACK
[0m19:24:58.843557 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.int_benchmark_returns"
[0m19:24:58.843866 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_stg_valuations_valuation_id.88ca70781d: Close
[0m19:24:58.844195 [debug] [Thread-3  ]: On model.bain_capital_analytics.int_benchmark_returns: BEGIN
[0m19:24:58.844488 [debug] [Thread-2  ]: On test.bain_capital_analytics.unique_stg_valuations_valuation_id.fce7eb13b5: Close
[0m19:24:58.844817 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.int_cashflow_enriched"
[0m19:24:58.845545 [debug] [Thread-3  ]: Opening a new connection, currently in state closed
[0m19:24:58.845295 [info ] [Thread-1  ]: 29 of 54 PASS not_null_stg_valuations_valuation_id ............................. [[32mPASS[0m in 0.09s]
[0m19:24:58.846333 [debug] [Thread-4  ]: On model.bain_capital_analytics.int_cashflow_enriched: BEGIN
[0m19:24:58.846086 [info ] [Thread-2  ]: 30 of 54 PASS unique_stg_valuations_valuation_id ............................... [[32mPASS[0m in 0.09s]
[0m19:24:58.846956 [debug] [Thread-1  ]: Finished running node test.bain_capital_analytics.not_null_stg_valuations_valuation_id.88ca70781d
[0m19:24:58.847260 [debug] [Thread-4  ]: Opening a new connection, currently in state closed
[0m19:24:58.847730 [debug] [Thread-2  ]: Finished running node test.bain_capital_analytics.unique_stg_valuations_valuation_id.fce7eb13b5
[0m19:24:58.848075 [debug] [Thread-1  ]: Began running node model.bain_capital_analytics.int_portfolio_attribution
[0m19:24:58.848708 [info ] [Thread-1  ]: 33 of 54 START sql view model public.int_portfolio_attribution ................. [RUN]
[0m19:24:58.849090 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.not_null_stg_valuations_valuation_id.88ca70781d, now model.bain_capital_analytics.int_portfolio_attribution)
[0m19:24:58.849408 [debug] [Thread-1  ]: Began compiling node model.bain_capital_analytics.int_portfolio_attribution
[0m19:24:58.853855 [debug] [Thread-1  ]: Writing injected SQL for node "model.bain_capital_analytics.int_portfolio_attribution"
[0m19:24:58.854393 [debug] [Thread-2  ]: Began running node model.bain_capital_analytics.int_fund_nav
[0m19:24:58.855131 [debug] [Thread-3  ]: SQL status: BEGIN in 0.010 seconds
[0m19:24:58.854796 [info ] [Thread-2  ]: 34 of 54 START sql view model public.int_fund_nav .............................. [RUN]
[0m19:24:58.855539 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.int_benchmark_returns"
[0m19:24:58.855832 [debug] [Thread-4  ]: SQL status: BEGIN in 0.009 seconds
[0m19:24:58.856131 [debug] [Thread-1  ]: Began executing node model.bain_capital_analytics.int_portfolio_attribution
[0m19:24:58.856469 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.unique_stg_valuations_valuation_id.fce7eb13b5, now model.bain_capital_analytics.int_fund_nav)
[0m19:24:58.856861 [debug] [Thread-3  ]: On model.bain_capital_analytics.int_benchmark_returns: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.int_benchmark_returns"} */

  create view "bain_analytics"."public"."int_benchmark_returns__dbt_tmp"
    
    
  as (
    -- Pipeline C: Benchmark returns with rolling calculations
-- Anti-pattern: heavy window functions that could be pre-computed

with benchmark_base as (
    select
        b.benchmark_id,
        b.benchmark_name,
        b.benchmark_date,
        b.return_daily,
        b.return_mtd,
        b.return_ytd,
        b.benchmark_level,
        b.benchmark_fiscal_quarter,
        d.fiscal_year,
        d.is_quarter_end,
        d.is_year_end
    from "bain_analytics"."public"."stg_benchmarks" b
    inner join "bain_analytics"."public"."stg_dates" d
        on b.benchmark_date = d.date_day
),

-- Anti-pattern: compute many overlapping windows
benchmark_with_rolling as (
    select
        bb.*,
        -- rolling 3-month return
        exp(sum(ln(1 + bb.return_mtd)) over (
            partition by bb.benchmark_id
            order by bb.benchmark_date
            rows between 2 preceding and current row
        )) - 1 as rolling_3m_return,
        -- rolling 6-month return
        exp(sum(ln(1 + bb.return_mtd)) over (
            partition by bb.benchmark_id
            order by bb.benchmark_date
            rows between 5 preceding and current row
        )) - 1 as rolling_6m_return,
        -- rolling 12-month return
        exp(sum(ln(1 + bb.return_mtd)) over (
            partition by bb.benchmark_id
            order by bb.benchmark_date
            rows between 11 preceding and current row
        )) - 1 as rolling_12m_return,
        -- Anti-pattern: volatility via window (expensive)
        stddev(bb.return_mtd) over (
            partition by bb.benchmark_id
            order by bb.benchmark_date
            rows between 11 preceding and current row
        ) as rolling_12m_volatility,
        avg(bb.return_mtd) over (
            partition by bb.benchmark_id
            order by bb.benchmark_date
            rows between 11 preceding and current row
        ) as rolling_12m_avg_return,
        lag(bb.benchmark_level) over (
            partition by bb.benchmark_id
            order by bb.benchmark_date
        ) as prev_benchmark_level
    from benchmark_base bb
)

select * from benchmark_with_rolling
  );
[0m19:24:58.857233 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.int_cashflow_enriched"
[0m19:24:58.860629 [debug] [Thread-1  ]: Writing runtime sql for node "model.bain_capital_analytics.int_portfolio_attribution"
[0m19:24:58.860952 [debug] [Thread-2  ]: Began compiling node model.bain_capital_analytics.int_fund_nav
[0m19:24:58.861388 [debug] [Thread-4  ]: On model.bain_capital_analytics.int_cashflow_enriched: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.int_cashflow_enriched"} */

  create view "bain_analytics"."public"."int_cashflow_enriched__dbt_tmp"
    
    
  as (
    -- Pipeline C: Enriched cashflow data with fund and portfolio details
-- Anti-pattern: subquery for dedup instead of QUALIFY
-- Anti-pattern: joins repeated from other intermediate models

with cashflow_with_details as (
    select *
    from (
        select
            cf.*,
            p.portfolio_name,
            p.strategy,
            p.manager_name,
            fs.fund_name,
            fs.fund_type,
            fs.committed_capital,
            fs.management_fee_rate,
            fs.carry_rate,
            fs.hurdle_rate,
            -- Anti-pattern: subquery filter instead of QUALIFY
            row_number() over (
                partition by cf.cashflow_id
                order by cf.cashflow_date desc
            ) as rn
        from "bain_analytics"."public"."stg_cashflows" cf
        inner join "bain_analytics"."public"."stg_portfolios" p
            on cf.portfolio_id = p.portfolio_id
        inner join "bain_analytics"."public"."stg_fund_structures" fs
            on cf.fund_id = fs.fund_id
    ) sub
    where rn = 1
),

-- Anti-pattern: running totals computed here AND again downstream
cashflow_cumulative as (
    select
        *,
        sum(case when cashflow_type = 'capital_call' then amount else 0 end) over (
            partition by fund_id, portfolio_id
            order by cashflow_date
            rows between unbounded preceding and current row
        ) as cumulative_called,
        sum(case when cashflow_type = 'distribution' then amount else 0 end) over (
            partition by fund_id, portfolio_id
            order by cashflow_date
            rows between unbounded preceding and current row
        ) as cumulative_distributed,
        sum(amount) over (
            partition by fund_id, portfolio_id
            order by cashflow_date
            rows between unbounded preceding and current row
        ) as cumulative_net_cashflow
    from cashflow_with_details
)

select
    cashflow_id,
    fund_id,
    fund_name,
    fund_type,
    portfolio_id,
    portfolio_name,
    strategy,
    manager_name,
    cashflow_date,
    cashflow_type,
    amount,
    currency,
    description,
    investor_id,
    cashflow_fiscal_quarter,
    cashflow_year,
    committed_capital,
    management_fee_rate,
    carry_rate,
    hurdle_rate,
    cumulative_called,
    cumulative_distributed,
    cumulative_net_cashflow,
    case
        when committed_capital > 0
        then cumulative_called / committed_capital
        else 0
    end as pct_called
from cashflow_cumulative
  );
[0m19:24:58.864656 [debug] [Thread-2  ]: Writing injected SQL for node "model.bain_capital_analytics.int_fund_nav"
[0m19:24:58.865078 [debug] [Thread-3  ]: SQL status: CREATE VIEW in 0.004 seconds
[0m19:24:58.865547 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.int_portfolio_attribution"
[0m19:24:58.868268 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.int_benchmark_returns"
[0m19:24:58.868584 [debug] [Thread-1  ]: On model.bain_capital_analytics.int_portfolio_attribution: BEGIN
[0m19:24:58.868919 [debug] [Thread-3  ]: On model.bain_capital_analytics.int_benchmark_returns: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.int_benchmark_returns"} */
alter table "bain_analytics"."public"."int_benchmark_returns__dbt_tmp" rename to "int_benchmark_returns"
[0m19:24:58.869238 [debug] [Thread-2  ]: Began executing node model.bain_capital_analytics.int_fund_nav
[0m19:24:58.869516 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m19:24:58.869829 [debug] [Thread-4  ]: SQL status: CREATE VIEW in 0.004 seconds
[0m19:24:58.873041 [debug] [Thread-2  ]: Writing runtime sql for node "model.bain_capital_analytics.int_fund_nav"
[0m19:24:58.873353 [debug] [Thread-3  ]: SQL status: ALTER TABLE in 0.003 seconds
[0m19:24:58.876982 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.int_cashflow_enriched"
[0m19:24:58.878114 [debug] [Thread-3  ]: On model.bain_capital_analytics.int_benchmark_returns: COMMIT
[0m19:24:58.878442 [debug] [Thread-4  ]: On model.bain_capital_analytics.int_cashflow_enriched: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.int_cashflow_enriched"} */
alter table "bain_analytics"."public"."int_cashflow_enriched__dbt_tmp" rename to "int_cashflow_enriched"
[0m19:24:58.878791 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.int_benchmark_returns"
[0m19:24:58.879122 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.int_fund_nav"
[0m19:24:58.879452 [debug] [Thread-3  ]: On model.bain_capital_analytics.int_benchmark_returns: COMMIT
[0m19:24:58.879763 [debug] [Thread-2  ]: On model.bain_capital_analytics.int_fund_nav: BEGIN
[0m19:24:58.880078 [debug] [Thread-4  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m19:24:58.880447 [debug] [Thread-2  ]: Opening a new connection, currently in state closed
[0m19:24:58.881458 [debug] [Thread-4  ]: On model.bain_capital_analytics.int_cashflow_enriched: COMMIT
[0m19:24:58.881787 [debug] [Thread-1  ]: SQL status: BEGIN in 0.012 seconds
[0m19:24:58.882177 [debug] [Thread-3  ]: SQL status: COMMIT in 0.002 seconds
[0m19:24:58.882526 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.int_cashflow_enriched"
[0m19:24:58.882831 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.int_portfolio_attribution"
[0m19:24:58.885166 [debug] [Thread-3  ]: Applying DROP to: "bain_analytics"."public"."int_benchmark_returns__dbt_backup"
[0m19:24:58.885506 [debug] [Thread-4  ]: On model.bain_capital_analytics.int_cashflow_enriched: COMMIT
[0m19:24:58.885906 [debug] [Thread-1  ]: On model.bain_capital_analytics.int_portfolio_attribution: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.int_portfolio_attribution"} */

  create view "bain_analytics"."public"."int_portfolio_attribution__dbt_tmp"
    
    
  as (
    -- Pipeline C: Portfolio performance attribution by sector and instrument type
-- Anti-pattern: deep CTE chain, repeated joins, late aggregation
-- Anti-pattern: same position-instrument-portfolio joins as int_daily_positions

with positions_enriched as (
    -- Anti-pattern: repeating the same 3-way join as int_daily_positions
    select
        pos.position_id,
        pos.portfolio_id,
        pos.instrument_id,
        pos.position_date,
        pos.quantity,
        pos.market_value,
        pos.cost_basis,
        pos.unrealized_gain_loss,
        i.instrument_name,
        i.instrument_type,
        i.sector,
        p.portfolio_name,
        p.strategy,
        p.fund_id
    from "bain_analytics"."public"."stg_positions" pos
    inner join "bain_analytics"."public"."stg_instruments" i
        on pos.instrument_id = i.instrument_id
    inner join "bain_analytics"."public"."stg_portfolios" p
        on pos.portfolio_id = p.portfolio_id
),

-- Anti-pattern: compute portfolio totals in a separate CTE instead of a single pass
portfolio_totals as (
    select
        portfolio_id,
        position_date,
        sum(market_value) as total_portfolio_mv,
        sum(unrealized_gain_loss) as total_portfolio_ugl
    from positions_enriched
    group by portfolio_id, position_date
),

-- Anti-pattern: sector aggregation in yet another CTE
sector_attribution as (
    select
        pe.portfolio_id,
        pe.portfolio_name,
        pe.strategy,
        pe.fund_id,
        pe.position_date,
        pe.sector,
        sum(pe.market_value) as sector_mv,
        sum(pe.unrealized_gain_loss) as sector_ugl,
        count(distinct pe.instrument_id) as num_instruments
    from positions_enriched pe
    group by
        pe.portfolio_id, pe.portfolio_name, pe.strategy,
        pe.fund_id, pe.position_date, pe.sector
),

-- Anti-pattern: joining back to get weights instead of computing in one pass
attribution_with_weights as (
    select
        sa.*,
        pt.total_portfolio_mv,
        pt.total_portfolio_ugl,
        case
            when pt.total_portfolio_mv != 0
            then sa.sector_mv / pt.total_portfolio_mv
            else 0
        end as sector_weight,
        case
            when pt.total_portfolio_ugl != 0
            then sa.sector_ugl / pt.total_portfolio_ugl
            else 0
        end as sector_contribution
    from sector_attribution sa
    inner join portfolio_totals pt
        on sa.portfolio_id = pt.portfolio_id
        and sa.position_date = pt.position_date
)

select * from attribution_with_weights
  );
[0m19:24:58.886485 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.int_benchmark_returns"
[0m19:24:58.886882 [debug] [Thread-3  ]: On model.bain_capital_analytics.int_benchmark_returns: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.int_benchmark_returns"} */
drop view if exists "bain_analytics"."public"."int_benchmark_returns__dbt_backup" cascade
[0m19:24:58.887415 [debug] [Thread-4  ]: SQL status: COMMIT in 0.001 seconds
[0m19:24:58.887738 [debug] [Thread-3  ]: SQL status: DROP VIEW in 0.001 seconds
[0m19:24:58.889890 [debug] [Thread-4  ]: Applying DROP to: "bain_analytics"."public"."int_cashflow_enriched__dbt_backup"
[0m19:24:58.891123 [debug] [Thread-3  ]: On model.bain_capital_analytics.int_benchmark_returns: Close
[0m19:24:58.891465 [debug] [Thread-2  ]: SQL status: BEGIN in 0.011 seconds
[0m19:24:58.891784 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.005 seconds
[0m19:24:58.892277 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.int_cashflow_enriched"
[0m19:24:58.892860 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.int_fund_nav"
[0m19:24:58.893262 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9d39665d-60b2-44a5-9c3b-d86d9b9d1de5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10cf90e20>]}
[0m19:24:58.896070 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.int_portfolio_attribution"
[0m19:24:58.896399 [debug] [Thread-4  ]: On model.bain_capital_analytics.int_cashflow_enriched: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.int_cashflow_enriched"} */
drop view if exists "bain_analytics"."public"."int_cashflow_enriched__dbt_backup" cascade
[0m19:24:58.896787 [debug] [Thread-2  ]: On model.bain_capital_analytics.int_fund_nav: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.int_fund_nav"} */

  create view "bain_analytics"."public"."int_fund_nav__dbt_tmp"
    
    
  as (
    -- Pipeline C: Fund-level NAV calculation from portfolio valuations
-- Anti-pattern: late aggregation - joins everything then aggregates at the end
-- Anti-pattern: repeated joins to fund_structures and portfolios

with portfolio_valuations as (
    select
        v.portfolio_id,
        v.valuation_date,
        v.net_asset_value,
        v.gross_asset_value,
        v.total_liabilities,
        v.unrealized_pnl,
        v.realized_pnl,
        v.valuation_method,
        p.fund_id,
        p.portfolio_name,
        p.strategy,
        -- Anti-pattern: joining fund_structures again (already done in int_cashflow_enriched)
        fs.fund_name,
        fs.fund_type,
        fs.committed_capital,
        fs.management_fee_rate
    from "bain_analytics"."public"."stg_valuations" v
    inner join "bain_analytics"."public"."stg_portfolios" p
        on v.portfolio_id = p.portfolio_id
    inner join "bain_analytics"."public"."stg_fund_structures" fs
        on p.fund_id = fs.fund_id
),

-- Anti-pattern: aggregation happens here at the end after all joins
fund_level_nav as (
    select
        fund_id,
        fund_name,
        fund_type,
        committed_capital,
        management_fee_rate,
        valuation_date,
        sum(net_asset_value) as fund_nav,
        sum(gross_asset_value) as fund_gav,
        sum(total_liabilities) as fund_total_liabilities,
        sum(unrealized_pnl) as fund_unrealized_pnl,
        sum(realized_pnl) as fund_realized_pnl,
        count(distinct portfolio_id) as num_portfolios
    from portfolio_valuations
    group by
        fund_id, fund_name, fund_type, committed_capital,
        management_fee_rate, valuation_date
),

fund_nav_with_changes as (
    select
        fn.*,
        lag(fn.fund_nav) over (
            partition by fn.fund_id order by fn.valuation_date
        ) as prev_fund_nav,
        case
            when lag(fn.fund_nav) over (
                partition by fn.fund_id order by fn.valuation_date
            ) is not null
            and lag(fn.fund_nav) over (
                partition by fn.fund_id order by fn.valuation_date
            ) != 0
            then (fn.fund_nav - lag(fn.fund_nav) over (
                partition by fn.fund_id order by fn.valuation_date
            )) / lag(fn.fund_nav) over (
                partition by fn.fund_id order by fn.valuation_date
            )
            else null
        end as fund_nav_return,
        fn.fund_nav / nullif(fn.committed_capital, 0) as tvpi_gross
    from fund_level_nav fn
)

select * from fund_nav_with_changes
  );
[0m19:24:58.897427 [info ] [Thread-3  ]: 31 of 54 OK created sql view model public.int_benchmark_returns ................ [[32mCREATE VIEW[0m in 0.07s]
[0m19:24:58.897768 [debug] [Thread-1  ]: On model.bain_capital_analytics.int_portfolio_attribution: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.int_portfolio_attribution"} */
alter table "bain_analytics"."public"."int_portfolio_attribution__dbt_tmp" rename to "int_portfolio_attribution"
[0m19:24:58.898299 [debug] [Thread-3  ]: Finished running node model.bain_capital_analytics.int_benchmark_returns
[0m19:24:58.898636 [debug] [Thread-4  ]: SQL status: DROP VIEW in 0.001 seconds
[0m19:24:58.898980 [debug] [Thread-3  ]: Began running node model.bain_capital_analytics.int_irr_calculations
[0m19:24:58.899303 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m19:24:58.900392 [debug] [Thread-4  ]: On model.bain_capital_analytics.int_cashflow_enriched: Close
[0m19:24:58.900859 [info ] [Thread-3  ]: 35 of 54 START sql view model public.int_irr_calculations ...................... [RUN]
[0m19:24:58.901836 [debug] [Thread-1  ]: On model.bain_capital_analytics.int_portfolio_attribution: COMMIT
[0m19:24:58.902229 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly model.bain_capital_analytics.int_benchmark_returns, now model.bain_capital_analytics.int_irr_calculations)
[0m19:24:58.902678 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9d39665d-60b2-44a5-9c3b-d86d9b9d1de5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ce7a970>]}
[0m19:24:58.903035 [debug] [Thread-2  ]: SQL status: CREATE VIEW in 0.005 seconds
[0m19:24:58.903337 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.int_portfolio_attribution"
[0m19:24:58.903641 [debug] [Thread-3  ]: Began compiling node model.bain_capital_analytics.int_irr_calculations
[0m19:24:58.904164 [info ] [Thread-4  ]: 32 of 54 OK created sql view model public.int_cashflow_enriched ................ [[32mCREATE VIEW[0m in 0.08s]
[0m19:24:58.907145 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.int_fund_nav"
[0m19:24:58.907465 [debug] [Thread-1  ]: On model.bain_capital_analytics.int_portfolio_attribution: COMMIT
[0m19:24:58.911143 [debug] [Thread-3  ]: Writing injected SQL for node "model.bain_capital_analytics.int_irr_calculations"
[0m19:24:58.911585 [debug] [Thread-4  ]: Finished running node model.bain_capital_analytics.int_cashflow_enriched
[0m19:24:58.911887 [debug] [Thread-2  ]: On model.bain_capital_analytics.int_fund_nav: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.int_fund_nav"} */
alter table "bain_analytics"."public"."int_fund_nav__dbt_tmp" rename to "int_fund_nav"
[0m19:24:58.912352 [debug] [Thread-4  ]: Began running node model.bain_capital_analytics.int_valuation_enriched
[0m19:24:58.913026 [info ] [Thread-4  ]: 36 of 54 START sql view model public.int_valuation_enriched .................... [RUN]
[0m19:24:58.913386 [debug] [Thread-3  ]: Began executing node model.bain_capital_analytics.int_irr_calculations
[0m19:24:58.913677 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m19:24:58.913947 [debug] [Thread-2  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m19:24:58.914264 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly model.bain_capital_analytics.int_cashflow_enriched, now model.bain_capital_analytics.int_valuation_enriched)
[0m19:24:58.918837 [debug] [Thread-3  ]: Writing runtime sql for node "model.bain_capital_analytics.int_irr_calculations"
[0m19:24:58.920965 [debug] [Thread-1  ]: Applying DROP to: "bain_analytics"."public"."int_portfolio_attribution__dbt_backup"
[0m19:24:58.921975 [debug] [Thread-2  ]: On model.bain_capital_analytics.int_fund_nav: COMMIT
[0m19:24:58.922281 [debug] [Thread-4  ]: Began compiling node model.bain_capital_analytics.int_valuation_enriched
[0m19:24:58.922816 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.int_portfolio_attribution"
[0m19:24:58.923196 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.int_fund_nav"
[0m19:24:58.926296 [debug] [Thread-4  ]: Writing injected SQL for node "model.bain_capital_analytics.int_valuation_enriched"
[0m19:24:58.926682 [debug] [Thread-1  ]: On model.bain_capital_analytics.int_portfolio_attribution: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.int_portfolio_attribution"} */
drop view if exists "bain_analytics"."public"."int_portfolio_attribution__dbt_backup" cascade
[0m19:24:58.927076 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.int_irr_calculations"
[0m19:24:58.927365 [debug] [Thread-2  ]: On model.bain_capital_analytics.int_fund_nav: COMMIT
[0m19:24:58.927774 [debug] [Thread-3  ]: On model.bain_capital_analytics.int_irr_calculations: BEGIN
[0m19:24:58.928131 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.000 seconds
[0m19:24:58.928461 [debug] [Thread-3  ]: Opening a new connection, currently in state closed
[0m19:24:58.928781 [debug] [Thread-4  ]: Began executing node model.bain_capital_analytics.int_valuation_enriched
[0m19:24:58.929859 [debug] [Thread-1  ]: On model.bain_capital_analytics.int_portfolio_attribution: Close
[0m19:24:58.930153 [debug] [Thread-2  ]: SQL status: COMMIT in 0.002 seconds
[0m19:24:58.933596 [debug] [Thread-4  ]: Writing runtime sql for node "model.bain_capital_analytics.int_valuation_enriched"
[0m19:24:58.936048 [debug] [Thread-2  ]: Applying DROP to: "bain_analytics"."public"."int_fund_nav__dbt_backup"
[0m19:24:58.936362 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9d39665d-60b2-44a5-9c3b-d86d9b9d1de5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c8cfc40>]}
[0m19:24:58.936914 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.int_fund_nav"
[0m19:24:58.937518 [info ] [Thread-1  ]: 33 of 54 OK created sql view model public.int_portfolio_attribution ............ [[32mCREATE VIEW[0m in 0.09s]
[0m19:24:58.937874 [debug] [Thread-2  ]: On model.bain_capital_analytics.int_fund_nav: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.int_fund_nav"} */
drop view if exists "bain_analytics"."public"."int_fund_nav__dbt_backup" cascade
[0m19:24:58.938373 [debug] [Thread-1  ]: Finished running node model.bain_capital_analytics.int_portfolio_attribution
[0m19:24:58.938701 [debug] [Thread-3  ]: SQL status: BEGIN in 0.010 seconds
[0m19:24:58.939048 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.int_valuation_enriched"
[0m19:24:58.939365 [debug] [Thread-2  ]: SQL status: DROP VIEW in 0.000 seconds
[0m19:24:58.939726 [debug] [Thread-1  ]: Began running node test.bain_capital_analytics.not_null_int_benchmark_returns_benchmark_id.fa96f53b44
[0m19:24:58.940095 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.int_irr_calculations"
[0m19:24:58.940445 [debug] [Thread-4  ]: On model.bain_capital_analytics.int_valuation_enriched: BEGIN
[0m19:24:58.941559 [debug] [Thread-2  ]: On model.bain_capital_analytics.int_fund_nav: Close
[0m19:24:58.941890 [info ] [Thread-1  ]: 37 of 54 START test not_null_int_benchmark_returns_benchmark_id ................ [RUN]
[0m19:24:58.942364 [debug] [Thread-3  ]: On model.bain_capital_analytics.int_irr_calculations: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.int_irr_calculations"} */

  create view "bain_analytics"."public"."int_irr_calculations__dbt_tmp"
    
    
  as (
    -- Pipeline C: Approximate IRR calculation per fund/portfolio
-- Anti-pattern: extremely deep CTE nesting (6 levels)
-- Anti-pattern: PostgreSQL-specific date arithmetic
-- Anti-pattern: complex logic that should be a macro

with cashflow_series as (
    -- CTE level 1: get all cashflows with proper signs
    select
        cf.fund_id,
        cf.portfolio_id,
        cf.cashflow_date,
        cf.cashflow_type,
        case
            when cf.cashflow_type = 'capital_call' then -1 * abs(cf.amount)
            when cf.cashflow_type = 'distribution' then abs(cf.amount)
            when cf.cashflow_type = 'management_fee' then -1 * abs(cf.amount)
            else cf.amount
        end as signed_amount
    from "bain_analytics"."public"."stg_cashflows" cf
),

terminal_values as (
    -- CTE level 2: get latest NAV as terminal cashflow
    select
        v.portfolio_id,
        p.fund_id,
        v.valuation_date as cashflow_date,
        'terminal_value' as cashflow_type,
        v.net_asset_value as signed_amount
    from "bain_analytics"."public"."stg_valuations" v
    inner join "bain_analytics"."public"."stg_portfolios" p
        on v.portfolio_id = p.portfolio_id
    where v.valuation_date = (
        -- Anti-pattern: correlated subquery instead of window function
        select max(v2.valuation_date)
        from "bain_analytics"."public"."stg_valuations" v2
        where v2.portfolio_id = v.portfolio_id
    )
),

all_cashflows as (
    -- CTE level 3: union cashflows and terminal values
    select fund_id, portfolio_id, cashflow_date, cashflow_type, signed_amount
    from cashflow_series
    union all
    select fund_id, portfolio_id, cashflow_date, cashflow_type, signed_amount
    from terminal_values
),

cashflow_with_timing as (
    -- CTE level 4: compute time fractions
    -- Anti-pattern: PostgreSQL date subtraction
    select
        ac.*,
        min(ac.cashflow_date) over (partition by ac.fund_id, ac.portfolio_id) as first_cf_date,
        (ac.cashflow_date - min(ac.cashflow_date) over (partition by ac.fund_id, ac.portfolio_id))::numeric / 365.25 as year_fraction
    from all_cashflows ac
),

-- CTE level 5: compute simple multiples as IRR proxy
portfolio_multiples as (
    select
        fund_id,
        portfolio_id,
        min(cashflow_date) as first_cashflow_date,
        max(cashflow_date) as last_cashflow_date,
        -- Anti-pattern: PostgreSQL date subtraction
        max(cashflow_date) - min(cashflow_date) as investment_days,
        (max(cashflow_date) - min(cashflow_date))::numeric / 365.25 as investment_years,
        sum(case when cashflow_type = 'capital_call' then abs(signed_amount) else 0 end) as total_invested,
        sum(case when cashflow_type = 'distribution' then signed_amount else 0 end) as total_distributed,
        sum(case when cashflow_type = 'terminal_value' then signed_amount else 0 end) as terminal_value,
        sum(signed_amount) as net_cashflow
    from cashflow_with_timing
    group by fund_id, portfolio_id
),

-- CTE level 6: compute IRR approximation
irr_approximation as (
    select
        pm.*,
        case
            when pm.total_invested > 0
            then (pm.total_distributed + pm.terminal_value) / pm.total_invested
            else null
        end as tvpi,
        case
            when pm.total_invested > 0
            then pm.total_distributed / pm.total_invested
            else null
        end as dpi,
        case
            when pm.total_invested > 0
            then pm.terminal_value / pm.total_invested
            else null
        end as rvpi,
        -- Simplified IRR approximation: (TVPI^(1/years)) - 1
        case
            when pm.total_invested > 0 and pm.investment_years > 0
            then power(
                (pm.total_distributed + pm.terminal_value) / pm.total_invested,
                1.0 / pm.investment_years
            ) - 1
            else null
        end as approx_irr
    from portfolio_multiples pm
)

select * from irr_approximation
  );
[0m19:24:58.942802 [debug] [Thread-4  ]: Opening a new connection, currently in state closed
[0m19:24:58.943291 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.bain_capital_analytics.int_portfolio_attribution, now test.bain_capital_analytics.not_null_int_benchmark_returns_benchmark_id.fa96f53b44)
[0m19:24:58.943608 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9d39665d-60b2-44a5-9c3b-d86d9b9d1de5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10cc43a60>]}
[0m19:24:58.944075 [debug] [Thread-1  ]: Began compiling node test.bain_capital_analytics.not_null_int_benchmark_returns_benchmark_id.fa96f53b44
[0m19:24:58.949153 [debug] [Thread-1  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_int_benchmark_returns_benchmark_id.fa96f53b44"
[0m19:24:58.949658 [info ] [Thread-2  ]: 34 of 54 OK created sql view model public.int_fund_nav ......................... [[32mCREATE VIEW[0m in 0.09s]
[0m19:24:58.950055 [debug] [Thread-3  ]: SQL status: CREATE VIEW in 0.006 seconds
[0m19:24:58.950529 [debug] [Thread-2  ]: Finished running node model.bain_capital_analytics.int_fund_nav
[0m19:24:58.953299 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.int_irr_calculations"
[0m19:24:58.953723 [debug] [Thread-2  ]: Began running node test.bain_capital_analytics.not_null_int_cashflow_enriched_cashflow_id.8460e9066d
[0m19:24:58.954146 [debug] [Thread-1  ]: Began executing node test.bain_capital_analytics.not_null_int_benchmark_returns_benchmark_id.fa96f53b44
[0m19:24:58.954460 [debug] [Thread-3  ]: On model.bain_capital_analytics.int_irr_calculations: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.int_irr_calculations"} */
alter table "bain_analytics"."public"."int_irr_calculations__dbt_tmp" rename to "int_irr_calculations"
[0m19:24:58.954754 [debug] [Thread-4  ]: SQL status: BEGIN in 0.012 seconds
[0m19:24:58.955123 [info ] [Thread-2  ]: 38 of 54 START test not_null_int_cashflow_enriched_cashflow_id ................. [RUN]
[0m19:24:58.957424 [debug] [Thread-1  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_int_benchmark_returns_benchmark_id.fa96f53b44"
[0m19:24:58.957855 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.int_valuation_enriched"
[0m19:24:58.958217 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly model.bain_capital_analytics.int_fund_nav, now test.bain_capital_analytics.not_null_int_cashflow_enriched_cashflow_id.8460e9066d)
[0m19:24:58.958534 [debug] [Thread-3  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m19:24:58.958975 [debug] [Thread-4  ]: On model.bain_capital_analytics.int_valuation_enriched: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.int_valuation_enriched"} */

  create view "bain_analytics"."public"."int_valuation_enriched__dbt_tmp"
    
    
  as (
    -- Pipeline C: Enriched valuation data
-- Anti-pattern: subquery for dedup instead of QUALIFY
-- Anti-pattern: repeated portfolio join
-- Anti-pattern: PostgreSQL-specific date functions

with valuation_ranked as (
    select *
    from (
        select
            v.*,
            p.portfolio_name,
            p.strategy,
            p.fund_id,
            p.manager_name,
            -- Anti-pattern: subquery dedup instead of QUALIFY
            row_number() over (
                partition by v.portfolio_id, v.valuation_date
                order by v.valuation_id desc
            ) as rn
        from "bain_analytics"."public"."stg_valuations" v
        inner join "bain_analytics"."public"."stg_portfolios" p
            on v.portfolio_id = p.portfolio_id
    ) sub
    where rn = 1
),

valuation_with_changes as (
    select
        vr.*,
        lag(vr.net_asset_value) over (
            partition by vr.portfolio_id order by vr.valuation_date
        ) as prev_nav,
        case
            when lag(vr.net_asset_value) over (
                partition by vr.portfolio_id order by vr.valuation_date
            ) is not null
            and lag(vr.net_asset_value) over (
                partition by vr.portfolio_id order by vr.valuation_date
            ) != 0
            then (vr.net_asset_value - lag(vr.net_asset_value) over (
                partition by vr.portfolio_id order by vr.valuation_date
            )) / lag(vr.net_asset_value) over (
                partition by vr.portfolio_id order by vr.valuation_date
            )
            else null
        end as nav_return_pct,
        -- Anti-pattern: PostgreSQL date subtraction
        vr.valuation_date - lag(vr.valuation_date) over (
            partition by vr.portfolio_id order by vr.valuation_date
        ) as days_between_valuations
    from valuation_ranked vr
)

select * from valuation_with_changes
  );
[0m19:24:58.959365 [debug] [Thread-2  ]: Began compiling node test.bain_capital_analytics.not_null_int_cashflow_enriched_cashflow_id.8460e9066d
[0m19:24:58.960359 [debug] [Thread-3  ]: On model.bain_capital_analytics.int_irr_calculations: COMMIT
[0m19:24:58.960738 [debug] [Thread-1  ]: Using postgres connection "test.bain_capital_analytics.not_null_int_benchmark_returns_benchmark_id.fa96f53b44"
[0m19:24:58.964180 [debug] [Thread-2  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_int_cashflow_enriched_cashflow_id.8460e9066d"
[0m19:24:58.964513 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.int_irr_calculations"
[0m19:24:58.964827 [debug] [Thread-4  ]: SQL status: CREATE VIEW in 0.004 seconds
[0m19:24:58.965118 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_int_benchmark_returns_benchmark_id.fa96f53b44: BEGIN
[0m19:24:58.965474 [debug] [Thread-3  ]: On model.bain_capital_analytics.int_irr_calculations: COMMIT
[0m19:24:58.968188 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.int_valuation_enriched"
[0m19:24:58.968517 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m19:24:58.968827 [debug] [Thread-2  ]: Began executing node test.bain_capital_analytics.not_null_int_cashflow_enriched_cashflow_id.8460e9066d
[0m19:24:58.969163 [debug] [Thread-4  ]: On model.bain_capital_analytics.int_valuation_enriched: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.int_valuation_enriched"} */
alter table "bain_analytics"."public"."int_valuation_enriched__dbt_tmp" rename to "int_valuation_enriched"
[0m19:24:58.971459 [debug] [Thread-2  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_int_cashflow_enriched_cashflow_id.8460e9066d"
[0m19:24:58.971781 [debug] [Thread-3  ]: SQL status: COMMIT in 0.003 seconds
[0m19:24:58.975139 [debug] [Thread-3  ]: Applying DROP to: "bain_analytics"."public"."int_irr_calculations__dbt_backup"
[0m19:24:58.975630 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.int_irr_calculations"
[0m19:24:58.975945 [debug] [Thread-4  ]: SQL status: ALTER TABLE in 0.004 seconds
[0m19:24:58.976255 [debug] [Thread-3  ]: On model.bain_capital_analytics.int_irr_calculations: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.int_irr_calculations"} */
drop view if exists "bain_analytics"."public"."int_irr_calculations__dbt_backup" cascade
[0m19:24:58.977387 [debug] [Thread-4  ]: On model.bain_capital_analytics.int_valuation_enriched: COMMIT
[0m19:24:58.977709 [debug] [Thread-1  ]: SQL status: BEGIN in 0.009 seconds
[0m19:24:58.978027 [debug] [Thread-2  ]: Using postgres connection "test.bain_capital_analytics.not_null_int_cashflow_enriched_cashflow_id.8460e9066d"
[0m19:24:58.978365 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.int_valuation_enriched"
[0m19:24:58.978664 [debug] [Thread-3  ]: SQL status: DROP VIEW in 0.000 seconds
[0m19:24:58.978934 [debug] [Thread-1  ]: Using postgres connection "test.bain_capital_analytics.not_null_int_benchmark_returns_benchmark_id.fa96f53b44"
[0m19:24:58.979214 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_int_cashflow_enriched_cashflow_id.8460e9066d: BEGIN
[0m19:24:58.979495 [debug] [Thread-4  ]: On model.bain_capital_analytics.int_valuation_enriched: COMMIT
[0m19:24:58.980482 [debug] [Thread-3  ]: On model.bain_capital_analytics.int_irr_calculations: Close
[0m19:24:58.980794 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_int_benchmark_returns_benchmark_id.fa96f53b44: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_int_benchmark_returns_benchmark_id.fa96f53b44"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select benchmark_id
from "bain_analytics"."public"."int_benchmark_returns"
where benchmark_id is null



  
  
      
    ) dbt_internal_test
[0m19:24:58.981088 [debug] [Thread-2  ]: Opening a new connection, currently in state closed
[0m19:24:58.981629 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9d39665d-60b2-44a5-9c3b-d86d9b9d1de5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112139d00>]}
[0m19:24:58.981955 [debug] [Thread-4  ]: SQL status: COMMIT in 0.001 seconds
[0m19:24:58.984430 [debug] [Thread-4  ]: Applying DROP to: "bain_analytics"."public"."int_valuation_enriched__dbt_backup"
[0m19:24:58.984770 [debug] [Thread-1  ]: SQL status: SELECT 1 in 0.003 seconds
[0m19:24:58.985236 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.int_valuation_enriched"
[0m19:24:58.985714 [info ] [Thread-3  ]: 35 of 54 OK created sql view model public.int_irr_calculations ................. [[32mCREATE VIEW[0m in 0.08s]
[0m19:24:58.986924 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_int_benchmark_returns_benchmark_id.fa96f53b44: ROLLBACK
[0m19:24:58.987252 [debug] [Thread-4  ]: On model.bain_capital_analytics.int_valuation_enriched: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.int_valuation_enriched"} */
drop view if exists "bain_analytics"."public"."int_valuation_enriched__dbt_backup" cascade
[0m19:24:58.987695 [debug] [Thread-3  ]: Finished running node model.bain_capital_analytics.int_irr_calculations
[0m19:24:58.988125 [debug] [Thread-3  ]: Began running node test.bain_capital_analytics.unique_int_cashflow_enriched_cashflow_id.6944893c17
[0m19:24:58.988439 [debug] [Thread-4  ]: SQL status: DROP VIEW in 0.000 seconds
[0m19:24:58.988716 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_int_benchmark_returns_benchmark_id.fa96f53b44: Close
[0m19:24:58.989108 [info ] [Thread-3  ]: 39 of 54 START test unique_int_cashflow_enriched_cashflow_id ................... [RUN]
[0m19:24:58.990240 [debug] [Thread-4  ]: On model.bain_capital_analytics.int_valuation_enriched: Close
[0m19:24:58.990552 [debug] [Thread-2  ]: SQL status: BEGIN in 0.009 seconds
[0m19:24:58.991059 [info ] [Thread-1  ]: 37 of 54 PASS not_null_int_benchmark_returns_benchmark_id ...................... [[32mPASS[0m in 0.05s]
[0m19:24:58.991487 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly model.bain_capital_analytics.int_irr_calculations, now test.bain_capital_analytics.unique_int_cashflow_enriched_cashflow_id.6944893c17)
[0m19:24:58.991829 [debug] [Thread-2  ]: Using postgres connection "test.bain_capital_analytics.not_null_int_cashflow_enriched_cashflow_id.8460e9066d"
[0m19:24:58.992242 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9d39665d-60b2-44a5-9c3b-d86d9b9d1de5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10cdf3af0>]}
[0m19:24:58.992678 [debug] [Thread-1  ]: Finished running node test.bain_capital_analytics.not_null_int_benchmark_returns_benchmark_id.fa96f53b44
[0m19:24:58.992980 [debug] [Thread-3  ]: Began compiling node test.bain_capital_analytics.unique_int_cashflow_enriched_cashflow_id.6944893c17
[0m19:24:58.993289 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_int_cashflow_enriched_cashflow_id.8460e9066d: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_int_cashflow_enriched_cashflow_id.8460e9066d"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select cashflow_id
from "bain_analytics"."public"."int_cashflow_enriched"
where cashflow_id is null



  
  
      
    ) dbt_internal_test
[0m19:24:58.993810 [debug] [Thread-1  ]: Began running node test.bain_capital_analytics.not_null_int_portfolio_attribution_portfolio_id.3e04b7c210
[0m19:24:58.994262 [info ] [Thread-4  ]: 36 of 54 OK created sql view model public.int_valuation_enriched ............... [[32mCREATE VIEW[0m in 0.08s]
[0m19:24:58.998381 [debug] [Thread-3  ]: Writing injected SQL for node "test.bain_capital_analytics.unique_int_cashflow_enriched_cashflow_id.6944893c17"
[0m19:24:58.998813 [info ] [Thread-1  ]: 40 of 54 START test not_null_int_portfolio_attribution_portfolio_id ............ [RUN]
[0m19:24:58.999265 [debug] [Thread-4  ]: Finished running node model.bain_capital_analytics.int_valuation_enriched
[0m19:24:58.999669 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.not_null_int_benchmark_returns_benchmark_id.fa96f53b44, now test.bain_capital_analytics.not_null_int_portfolio_attribution_portfolio_id.3e04b7c210)
[0m19:24:59.000039 [debug] [Thread-4  ]: Began running node test.bain_capital_analytics.not_null_int_fund_nav_fund_id.ebf0b6cc99
[0m19:24:59.000403 [debug] [Thread-1  ]: Began compiling node test.bain_capital_analytics.not_null_int_portfolio_attribution_portfolio_id.3e04b7c210
[0m19:24:59.000810 [info ] [Thread-4  ]: 41 of 54 START test not_null_int_fund_nav_fund_id .............................. [RUN]
[0m19:24:59.004277 [debug] [Thread-1  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_int_portfolio_attribution_portfolio_id.3e04b7c210"
[0m19:24:59.004609 [debug] [Thread-3  ]: Began executing node test.bain_capital_analytics.unique_int_cashflow_enriched_cashflow_id.6944893c17
[0m19:24:59.004952 [debug] [Thread-2  ]: SQL status: SELECT 1 in 0.006 seconds
[0m19:24:59.005314 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly model.bain_capital_analytics.int_valuation_enriched, now test.bain_capital_analytics.not_null_int_fund_nav_fund_id.ebf0b6cc99)
[0m19:24:59.007750 [debug] [Thread-3  ]: Writing runtime sql for node "test.bain_capital_analytics.unique_int_cashflow_enriched_cashflow_id.6944893c17"
[0m19:24:59.009070 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_int_cashflow_enriched_cashflow_id.8460e9066d: ROLLBACK
[0m19:24:59.009415 [debug] [Thread-4  ]: Began compiling node test.bain_capital_analytics.not_null_int_fund_nav_fund_id.ebf0b6cc99
[0m19:24:59.009745 [debug] [Thread-1  ]: Began executing node test.bain_capital_analytics.not_null_int_portfolio_attribution_portfolio_id.3e04b7c210
[0m19:24:59.013297 [debug] [Thread-4  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_int_fund_nav_fund_id.ebf0b6cc99"
[0m19:24:59.013626 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_int_cashflow_enriched_cashflow_id.8460e9066d: Close
[0m19:24:59.017140 [debug] [Thread-1  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_int_portfolio_attribution_portfolio_id.3e04b7c210"
[0m19:24:59.017565 [debug] [Thread-3  ]: Using postgres connection "test.bain_capital_analytics.unique_int_cashflow_enriched_cashflow_id.6944893c17"
[0m19:24:59.018107 [info ] [Thread-2  ]: 38 of 54 PASS not_null_int_cashflow_enriched_cashflow_id ....................... [[32mPASS[0m in 0.06s]
[0m19:24:59.018535 [debug] [Thread-3  ]: On test.bain_capital_analytics.unique_int_cashflow_enriched_cashflow_id.6944893c17: BEGIN
[0m19:24:59.018862 [debug] [Thread-4  ]: Began executing node test.bain_capital_analytics.not_null_int_fund_nav_fund_id.ebf0b6cc99
[0m19:24:59.019258 [debug] [Thread-2  ]: Finished running node test.bain_capital_analytics.not_null_int_cashflow_enriched_cashflow_id.8460e9066d
[0m19:24:59.019613 [debug] [Thread-3  ]: Opening a new connection, currently in state closed
[0m19:24:59.019974 [debug] [Thread-1  ]: Using postgres connection "test.bain_capital_analytics.not_null_int_portfolio_attribution_portfolio_id.3e04b7c210"
[0m19:24:59.022244 [debug] [Thread-4  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_int_fund_nav_fund_id.ebf0b6cc99"
[0m19:24:59.022618 [debug] [Thread-2  ]: Began running node test.bain_capital_analytics.not_null_int_irr_calculations_fund_id.35702f5be3
[0m19:24:59.023077 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_int_portfolio_attribution_portfolio_id.3e04b7c210: BEGIN
[0m19:24:59.023453 [info ] [Thread-2  ]: 42 of 54 START test not_null_int_irr_calculations_fund_id ...................... [RUN]
[0m19:24:59.023832 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m19:24:59.024199 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.not_null_int_cashflow_enriched_cashflow_id.8460e9066d, now test.bain_capital_analytics.not_null_int_irr_calculations_fund_id.35702f5be3)
[0m19:24:59.024690 [debug] [Thread-4  ]: Using postgres connection "test.bain_capital_analytics.not_null_int_fund_nav_fund_id.ebf0b6cc99"
[0m19:24:59.025029 [debug] [Thread-2  ]: Began compiling node test.bain_capital_analytics.not_null_int_irr_calculations_fund_id.35702f5be3
[0m19:24:59.025337 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_int_fund_nav_fund_id.ebf0b6cc99: BEGIN
[0m19:24:59.029465 [debug] [Thread-2  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_int_irr_calculations_fund_id.35702f5be3"
[0m19:24:59.029834 [debug] [Thread-4  ]: Opening a new connection, currently in state closed
[0m19:24:59.030497 [debug] [Thread-2  ]: Began executing node test.bain_capital_analytics.not_null_int_irr_calculations_fund_id.35702f5be3
[0m19:24:59.032832 [debug] [Thread-2  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_int_irr_calculations_fund_id.35702f5be3"
[0m19:24:59.033485 [debug] [Thread-2  ]: Using postgres connection "test.bain_capital_analytics.not_null_int_irr_calculations_fund_id.35702f5be3"
[0m19:24:59.033790 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_int_irr_calculations_fund_id.35702f5be3: BEGIN
[0m19:24:59.034113 [debug] [Thread-3  ]: SQL status: BEGIN in 0.014 seconds
[0m19:24:59.034419 [debug] [Thread-2  ]: Opening a new connection, currently in state closed
[0m19:24:59.034707 [debug] [Thread-1  ]: SQL status: BEGIN in 0.011 seconds
[0m19:24:59.035013 [debug] [Thread-3  ]: Using postgres connection "test.bain_capital_analytics.unique_int_cashflow_enriched_cashflow_id.6944893c17"
[0m19:24:59.035400 [debug] [Thread-1  ]: Using postgres connection "test.bain_capital_analytics.not_null_int_portfolio_attribution_portfolio_id.3e04b7c210"
[0m19:24:59.035746 [debug] [Thread-3  ]: On test.bain_capital_analytics.unique_int_cashflow_enriched_cashflow_id.6944893c17: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.unique_int_cashflow_enriched_cashflow_id.6944893c17"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

select
    cashflow_id as unique_field,
    count(*) as n_records

from "bain_analytics"."public"."int_cashflow_enriched"
where cashflow_id is not null
group by cashflow_id
having count(*) > 1



  
  
      
    ) dbt_internal_test
[0m19:24:59.036124 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_int_portfolio_attribution_portfolio_id.3e04b7c210: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_int_portfolio_attribution_portfolio_id.3e04b7c210"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select portfolio_id
from "bain_analytics"."public"."int_portfolio_attribution"
where portfolio_id is null



  
  
      
    ) dbt_internal_test
[0m19:24:59.037497 [debug] [Thread-4  ]: SQL status: BEGIN in 0.008 seconds
[0m19:24:59.037808 [debug] [Thread-4  ]: Using postgres connection "test.bain_capital_analytics.not_null_int_fund_nav_fund_id.ebf0b6cc99"
[0m19:24:59.038115 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_int_fund_nav_fund_id.ebf0b6cc99: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_int_fund_nav_fund_id.ebf0b6cc99"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select fund_id
from "bain_analytics"."public"."int_fund_nav"
where fund_id is null



  
  
      
    ) dbt_internal_test
[0m19:24:59.040264 [debug] [Thread-3  ]: SQL status: SELECT 1 in 0.004 seconds
[0m19:24:59.040600 [debug] [Thread-1  ]: SQL status: SELECT 1 in 0.004 seconds
[0m19:24:59.042032 [debug] [Thread-3  ]: On test.bain_capital_analytics.unique_int_cashflow_enriched_cashflow_id.6944893c17: ROLLBACK
[0m19:24:59.042378 [debug] [Thread-4  ]: SQL status: SELECT 1 in 0.004 seconds
[0m19:24:59.043464 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_int_portfolio_attribution_portfolio_id.3e04b7c210: ROLLBACK
[0m19:24:59.044643 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_int_fund_nav_fund_id.ebf0b6cc99: ROLLBACK
[0m19:24:59.044969 [debug] [Thread-3  ]: On test.bain_capital_analytics.unique_int_cashflow_enriched_cashflow_id.6944893c17: Close
[0m19:24:59.045265 [debug] [Thread-2  ]: SQL status: BEGIN in 0.011 seconds
[0m19:24:59.045679 [debug] [Thread-2  ]: Using postgres connection "test.bain_capital_analytics.not_null_int_irr_calculations_fund_id.35702f5be3"
[0m19:24:59.046012 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_int_irr_calculations_fund_id.35702f5be3: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_int_irr_calculations_fund_id.35702f5be3"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select fund_id
from "bain_analytics"."public"."int_irr_calculations"
where fund_id is null



  
  
      
    ) dbt_internal_test
[0m19:24:59.046521 [info ] [Thread-3  ]: 39 of 54 PASS unique_int_cashflow_enriched_cashflow_id ......................... [[32mPASS[0m in 0.05s]
[0m19:24:59.046836 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_int_fund_nav_fund_id.ebf0b6cc99: Close
[0m19:24:59.047097 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_int_portfolio_attribution_portfolio_id.3e04b7c210: Close
[0m19:24:59.047559 [debug] [Thread-3  ]: Finished running node test.bain_capital_analytics.unique_int_cashflow_enriched_cashflow_id.6944893c17
[0m19:24:59.048036 [info ] [Thread-4  ]: 41 of 54 PASS not_null_int_fund_nav_fund_id .................................... [[32mPASS[0m in 0.04s]
[0m19:24:59.048489 [info ] [Thread-1  ]: 40 of 54 PASS not_null_int_portfolio_attribution_portfolio_id .................. [[32mPASS[0m in 0.05s]
[0m19:24:59.048845 [debug] [Thread-3  ]: Began running node test.bain_capital_analytics.not_null_int_irr_calculations_portfolio_id.5530046e4d
[0m19:24:59.049442 [debug] [Thread-4  ]: Finished running node test.bain_capital_analytics.not_null_int_fund_nav_fund_id.ebf0b6cc99
[0m19:24:59.049976 [debug] [Thread-1  ]: Finished running node test.bain_capital_analytics.not_null_int_portfolio_attribution_portfolio_id.3e04b7c210
[0m19:24:59.050314 [info ] [Thread-3  ]: 43 of 54 START test not_null_int_irr_calculations_portfolio_id ................. [RUN]
[0m19:24:59.050692 [debug] [Thread-4  ]: Began running node test.bain_capital_analytics.not_null_int_valuation_enriched_valuation_id.048a7ba03a
[0m19:24:59.051080 [debug] [Thread-1  ]: Began running node model.bain_capital_analytics.fact_cashflow_waterfall
[0m19:24:59.051496 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.unique_int_cashflow_enriched_cashflow_id.6944893c17, now test.bain_capital_analytics.not_null_int_irr_calculations_portfolio_id.5530046e4d)
[0m19:24:59.051893 [debug] [Thread-2  ]: SQL status: SELECT 1 in 0.005 seconds
[0m19:24:59.052205 [info ] [Thread-4  ]: 44 of 54 START test not_null_int_valuation_enriched_valuation_id ............... [RUN]
[0m19:24:59.052670 [info ] [Thread-1  ]: 45 of 54 START sql view model public.fact_cashflow_waterfall ................... [RUN]
[0m19:24:59.053017 [debug] [Thread-3  ]: Began compiling node test.bain_capital_analytics.not_null_int_irr_calculations_portfolio_id.5530046e4d
[0m19:24:59.054240 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_int_irr_calculations_fund_id.35702f5be3: ROLLBACK
[0m19:24:59.054600 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.not_null_int_fund_nav_fund_id.ebf0b6cc99, now test.bain_capital_analytics.not_null_int_valuation_enriched_valuation_id.048a7ba03a)
[0m19:24:59.054936 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.not_null_int_portfolio_attribution_portfolio_id.3e04b7c210, now model.bain_capital_analytics.fact_cashflow_waterfall)
[0m19:24:59.059053 [debug] [Thread-3  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_int_irr_calculations_portfolio_id.5530046e4d"
[0m19:24:59.059438 [debug] [Thread-4  ]: Began compiling node test.bain_capital_analytics.not_null_int_valuation_enriched_valuation_id.048a7ba03a
[0m19:24:59.059748 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_int_irr_calculations_fund_id.35702f5be3: Close
[0m19:24:59.060035 [debug] [Thread-1  ]: Began compiling node model.bain_capital_analytics.fact_cashflow_waterfall
[0m19:24:59.064874 [debug] [Thread-4  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_int_valuation_enriched_valuation_id.048a7ba03a"
[0m19:24:59.065459 [info ] [Thread-2  ]: 42 of 54 PASS not_null_int_irr_calculations_fund_id ............................ [[32mPASS[0m in 0.04s]
[0m19:24:59.065788 [debug] [Thread-3  ]: Began executing node test.bain_capital_analytics.not_null_int_irr_calculations_portfolio_id.5530046e4d
[0m19:24:59.068888 [debug] [Thread-1  ]: Writing injected SQL for node "model.bain_capital_analytics.fact_cashflow_waterfall"
[0m19:24:59.069408 [debug] [Thread-2  ]: Finished running node test.bain_capital_analytics.not_null_int_irr_calculations_fund_id.35702f5be3
[0m19:24:59.071692 [debug] [Thread-3  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_int_irr_calculations_portfolio_id.5530046e4d"
[0m19:24:59.072112 [debug] [Thread-4  ]: Began executing node test.bain_capital_analytics.not_null_int_valuation_enriched_valuation_id.048a7ba03a
[0m19:24:59.072441 [debug] [Thread-2  ]: Began running node model.bain_capital_analytics.fact_portfolio_attribution
[0m19:24:59.074816 [debug] [Thread-4  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_int_valuation_enriched_valuation_id.048a7ba03a"
[0m19:24:59.075135 [debug] [Thread-1  ]: Began executing node model.bain_capital_analytics.fact_cashflow_waterfall
[0m19:24:59.075521 [info ] [Thread-2  ]: 46 of 54 START sql view model public.fact_portfolio_attribution ................ [RUN]
[0m19:24:59.076009 [debug] [Thread-3  ]: Using postgres connection "test.bain_capital_analytics.not_null_int_irr_calculations_portfolio_id.5530046e4d"
[0m19:24:59.079345 [debug] [Thread-1  ]: Writing runtime sql for node "model.bain_capital_analytics.fact_cashflow_waterfall"
[0m19:24:59.079729 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.not_null_int_irr_calculations_fund_id.35702f5be3, now model.bain_capital_analytics.fact_portfolio_attribution)
[0m19:24:59.080087 [debug] [Thread-4  ]: Using postgres connection "test.bain_capital_analytics.not_null_int_valuation_enriched_valuation_id.048a7ba03a"
[0m19:24:59.080381 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_int_irr_calculations_portfolio_id.5530046e4d: BEGIN
[0m19:24:59.080764 [debug] [Thread-2  ]: Began compiling node model.bain_capital_analytics.fact_portfolio_attribution
[0m19:24:59.081091 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_int_valuation_enriched_valuation_id.048a7ba03a: BEGIN
[0m19:24:59.081426 [debug] [Thread-3  ]: Opening a new connection, currently in state closed
[0m19:24:59.081775 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.fact_cashflow_waterfall"
[0m19:24:59.084804 [debug] [Thread-2  ]: Writing injected SQL for node "model.bain_capital_analytics.fact_portfolio_attribution"
[0m19:24:59.085127 [debug] [Thread-4  ]: Opening a new connection, currently in state closed
[0m19:24:59.085538 [debug] [Thread-1  ]: On model.bain_capital_analytics.fact_cashflow_waterfall: BEGIN
[0m19:24:59.085968 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m19:24:59.086394 [debug] [Thread-2  ]: Began executing node model.bain_capital_analytics.fact_portfolio_attribution
[0m19:24:59.090545 [debug] [Thread-2  ]: Writing runtime sql for node "model.bain_capital_analytics.fact_portfolio_attribution"
[0m19:24:59.091246 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.fact_portfolio_attribution"
[0m19:24:59.091555 [debug] [Thread-2  ]: On model.bain_capital_analytics.fact_portfolio_attribution: BEGIN
[0m19:24:59.091832 [debug] [Thread-2  ]: Opening a new connection, currently in state closed
[0m19:24:59.095416 [debug] [Thread-3  ]: SQL status: BEGIN in 0.014 seconds
[0m19:24:59.095748 [debug] [Thread-4  ]: SQL status: BEGIN in 0.011 seconds
[0m19:24:59.096046 [debug] [Thread-1  ]: SQL status: BEGIN in 0.010 seconds
[0m19:24:59.096324 [debug] [Thread-3  ]: Using postgres connection "test.bain_capital_analytics.not_null_int_irr_calculations_portfolio_id.5530046e4d"
[0m19:24:59.096626 [debug] [Thread-4  ]: Using postgres connection "test.bain_capital_analytics.not_null_int_valuation_enriched_valuation_id.048a7ba03a"
[0m19:24:59.096926 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.fact_cashflow_waterfall"
[0m19:24:59.097231 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_int_irr_calculations_portfolio_id.5530046e4d: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_int_irr_calculations_portfolio_id.5530046e4d"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select portfolio_id
from "bain_analytics"."public"."int_irr_calculations"
where portfolio_id is null



  
  
      
    ) dbt_internal_test
[0m19:24:59.097561 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_int_valuation_enriched_valuation_id.048a7ba03a: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_int_valuation_enriched_valuation_id.048a7ba03a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select valuation_id
from "bain_analytics"."public"."int_valuation_enriched"
where valuation_id is null



  
  
      
    ) dbt_internal_test
[0m19:24:59.097960 [debug] [Thread-1  ]: On model.bain_capital_analytics.fact_cashflow_waterfall: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.fact_cashflow_waterfall"} */

  create view "bain_analytics"."public"."fact_cashflow_waterfall__dbt_tmp"
    
    
  as (
    -- Pipeline C: FACT table - Cashflow waterfall for PE/fund reporting
-- Anti-pattern: deep CTEs, repeated joins, late aggregation
-- Anti-pattern: PostgreSQL-specific date functions

with enriched_cashflows as (
    select
        ce.cashflow_id,
        ce.fund_id,
        ce.fund_name,
        ce.fund_type,
        ce.portfolio_id,
        ce.portfolio_name,
        ce.cashflow_date,
        ce.cashflow_type,
        ce.amount,
        ce.investor_id,
        ce.committed_capital,
        ce.management_fee_rate,
        ce.carry_rate,
        ce.hurdle_rate,
        ce.cumulative_called,
        ce.cumulative_distributed,
        ce.cumulative_net_cashflow,
        ce.pct_called,
        -- Anti-pattern: duplicated fiscal quarter logic
        case
            when extract(month from ce.cashflow_date) between 1 and 3 then 'Q3'
            when extract(month from ce.cashflow_date) between 4 and 6 then 'Q4'
            when extract(month from ce.cashflow_date) between 7 and 9 then 'Q1'
            when extract(month from ce.cashflow_date) between 10 and 12 then 'Q2'
        end as fiscal_quarter,
        -- Anti-pattern: PostgreSQL extract
        extract(year from ce.cashflow_date) as calendar_year
    from "bain_analytics"."public"."int_cashflow_enriched" ce
),

-- Anti-pattern: re-joining valuations when int_valuation_enriched already has this
waterfall_with_nav as (
    select
        ecf.*,
        v.net_asset_value,
        v.gross_asset_value,
        v.unrealized_pnl as nav_unrealized_pnl,
        v.realized_pnl as nav_realized_pnl
    from enriched_cashflows ecf
    left join "bain_analytics"."public"."stg_valuations" v
        on ecf.portfolio_id = v.portfolio_id
        and ecf.cashflow_date = v.valuation_date
),

-- Anti-pattern: computing carry/waterfall in a CTE chain instead of a macro
waterfall_calculations as (
    select
        wn.*,
        -- Simplified carry calculation
        case
            when wn.cumulative_distributed > wn.cumulative_called * (1 + wn.hurdle_rate)
            then (wn.cumulative_distributed - wn.cumulative_called * (1 + wn.hurdle_rate)) * wn.carry_rate
            else 0
        end as estimated_carry,
        wn.cumulative_called * wn.management_fee_rate as annual_mgmt_fee,
        case
            when wn.cumulative_called > 0
            then wn.cumulative_distributed / wn.cumulative_called
            else 0
        end as dpi,
        case
            when wn.cumulative_called > 0 and wn.net_asset_value is not null
            then (wn.cumulative_distributed + wn.net_asset_value) / wn.cumulative_called
            else null
        end as tvpi
    from waterfall_with_nav wn
)

select * from waterfall_calculations
  );
[0m19:24:59.099347 [debug] [Thread-2  ]: SQL status: BEGIN in 0.007 seconds
[0m19:24:59.099662 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.fact_portfolio_attribution"
[0m19:24:59.100014 [debug] [Thread-2  ]: On model.bain_capital_analytics.fact_portfolio_attribution: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.fact_portfolio_attribution"} */

  create view "bain_analytics"."public"."fact_portfolio_attribution__dbt_tmp"
    
    
  as (
    -- Pipeline C: FACT table - Portfolio attribution with benchmark comparison
-- Anti-pattern: re-joins data that's already in intermediate models
-- Anti-pattern: repeated computation of sector weights

with attribution as (
    select
        pa.portfolio_id,
        pa.portfolio_name,
        pa.strategy,
        pa.fund_id,
        pa.position_date,
        pa.sector,
        pa.sector_mv,
        pa.sector_ugl,
        pa.num_instruments,
        pa.total_portfolio_mv,
        pa.total_portfolio_ugl,
        pa.sector_weight,
        pa.sector_contribution
    from "bain_analytics"."public"."int_portfolio_attribution" pa
),

-- Anti-pattern: re-joining benchmarks (could be done in intermediate)
attribution_with_benchmark as (
    select
        a.*,
        bm.benchmark_name,
        bm.return_mtd as benchmark_return,
        bm.rolling_3m_return as benchmark_3m_return,
        bm.rolling_12m_return as benchmark_12m_return
    from attribution a
    left join "bain_analytics"."public"."int_benchmark_returns" bm
        on a.position_date = bm.benchmark_date
        and bm.benchmark_id = 'BM_SP500'
),

-- Anti-pattern: computing alpha in yet another CTE
attribution_with_alpha as (
    select
        ab.*,
        -- Simplified active return
        case
            when ab.total_portfolio_mv != 0
            then (ab.sector_ugl / ab.total_portfolio_mv) - coalesce(ab.benchmark_return, 0) * ab.sector_weight
            else 0
        end as sector_active_return,
        -- Anti-pattern: re-computing portfolio-level return here
        case
            when ab.total_portfolio_mv != 0
            then ab.total_portfolio_ugl / ab.total_portfolio_mv
            else 0
        end as portfolio_return
    from attribution_with_benchmark ab
)

select * from attribution_with_alpha
  );
[0m19:24:59.101694 [debug] [Thread-4  ]: SQL status: SELECT 1 in 0.003 seconds
[0m19:24:59.102997 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_int_valuation_enriched_valuation_id.048a7ba03a: ROLLBACK
[0m19:24:59.103329 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.005 seconds
[0m19:24:59.103649 [debug] [Thread-3  ]: SQL status: SELECT 1 in 0.005 seconds
[0m19:24:59.103987 [debug] [Thread-2  ]: SQL status: CREATE VIEW in 0.004 seconds
[0m19:24:59.104284 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_int_valuation_enriched_valuation_id.048a7ba03a: Close
[0m19:24:59.107180 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.fact_cashflow_waterfall"
[0m19:24:59.108404 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_int_irr_calculations_portfolio_id.5530046e4d: ROLLBACK
[0m19:24:59.111082 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.fact_portfolio_attribution"
[0m19:24:59.111608 [info ] [Thread-4  ]: 44 of 54 PASS not_null_int_valuation_enriched_valuation_id ..................... [[32mPASS[0m in 0.06s]
[0m19:24:59.111934 [debug] [Thread-1  ]: On model.bain_capital_analytics.fact_cashflow_waterfall: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.fact_cashflow_waterfall"} */
alter table "bain_analytics"."public"."fact_cashflow_waterfall__dbt_tmp" rename to "fact_cashflow_waterfall"
[0m19:24:59.112275 [debug] [Thread-2  ]: On model.bain_capital_analytics.fact_portfolio_attribution: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.fact_portfolio_attribution"} */
alter table "bain_analytics"."public"."fact_portfolio_attribution__dbt_tmp" rename to "fact_portfolio_attribution"
[0m19:24:59.112727 [debug] [Thread-4  ]: Finished running node test.bain_capital_analytics.not_null_int_valuation_enriched_valuation_id.048a7ba03a
[0m19:24:59.112996 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_int_irr_calculations_portfolio_id.5530046e4d: Close
[0m19:24:59.113635 [info ] [Thread-3  ]: 43 of 54 PASS not_null_int_irr_calculations_portfolio_id ....................... [[32mPASS[0m in 0.06s]
[0m19:24:59.114066 [debug] [Thread-3  ]: Finished running node test.bain_capital_analytics.not_null_int_irr_calculations_portfolio_id.5530046e4d
[0m19:24:59.114370 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m19:24:59.114652 [debug] [Thread-2  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m19:24:59.115760 [debug] [Thread-1  ]: On model.bain_capital_analytics.fact_cashflow_waterfall: COMMIT
[0m19:24:59.116092 [debug] [Thread-4  ]: Began running node model.bain_capital_analytics.fact_fund_performance
[0m19:24:59.116459 [debug] [Thread-3  ]: Began running node model.bain_capital_analytics.report_lp_quarterly
[0m19:24:59.117524 [debug] [Thread-2  ]: On model.bain_capital_analytics.fact_portfolio_attribution: COMMIT
[0m19:24:59.117842 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.fact_cashflow_waterfall"
[0m19:24:59.118257 [info ] [Thread-4  ]: 47 of 54 START sql view model public.fact_fund_performance ..................... [RUN]
[0m19:24:59.118658 [info ] [Thread-3  ]: 48 of 54 START sql view model public.report_lp_quarterly ....................... [RUN]
[0m19:24:59.118985 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.fact_portfolio_attribution"
[0m19:24:59.119281 [debug] [Thread-1  ]: On model.bain_capital_analytics.fact_cashflow_waterfall: COMMIT
[0m19:24:59.119608 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.not_null_int_valuation_enriched_valuation_id.048a7ba03a, now model.bain_capital_analytics.fact_fund_performance)
[0m19:24:59.119936 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.not_null_int_irr_calculations_portfolio_id.5530046e4d, now model.bain_capital_analytics.report_lp_quarterly)
[0m19:24:59.120255 [debug] [Thread-2  ]: On model.bain_capital_analytics.fact_portfolio_attribution: COMMIT
[0m19:24:59.120582 [debug] [Thread-4  ]: Began compiling node model.bain_capital_analytics.fact_fund_performance
[0m19:24:59.120878 [debug] [Thread-3  ]: Began compiling node model.bain_capital_analytics.report_lp_quarterly
[0m19:24:59.124508 [debug] [Thread-4  ]: Writing injected SQL for node "model.bain_capital_analytics.fact_fund_performance"
[0m19:24:59.124835 [debug] [Thread-1  ]: SQL status: COMMIT in 0.004 seconds
[0m19:24:59.128609 [debug] [Thread-3  ]: Writing injected SQL for node "model.bain_capital_analytics.report_lp_quarterly"
[0m19:24:59.128918 [debug] [Thread-2  ]: SQL status: COMMIT in 0.008 seconds
[0m19:24:59.132238 [debug] [Thread-1  ]: Applying DROP to: "bain_analytics"."public"."fact_cashflow_waterfall__dbt_backup"
[0m19:24:59.134498 [debug] [Thread-2  ]: Applying DROP to: "bain_analytics"."public"."fact_portfolio_attribution__dbt_backup"
[0m19:24:59.135036 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.fact_cashflow_waterfall"
[0m19:24:59.135523 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.fact_portfolio_attribution"
[0m19:24:59.135817 [debug] [Thread-4  ]: Began executing node model.bain_capital_analytics.fact_fund_performance
[0m19:24:59.136125 [debug] [Thread-3  ]: Began executing node model.bain_capital_analytics.report_lp_quarterly
[0m19:24:59.136415 [debug] [Thread-1  ]: On model.bain_capital_analytics.fact_cashflow_waterfall: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.fact_cashflow_waterfall"} */
drop view if exists "bain_analytics"."public"."fact_cashflow_waterfall__dbt_backup" cascade
[0m19:24:59.136728 [debug] [Thread-2  ]: On model.bain_capital_analytics.fact_portfolio_attribution: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.fact_portfolio_attribution"} */
drop view if exists "bain_analytics"."public"."fact_portfolio_attribution__dbt_backup" cascade
[0m19:24:59.140099 [debug] [Thread-4  ]: Writing runtime sql for node "model.bain_capital_analytics.fact_fund_performance"
[0m19:24:59.143453 [debug] [Thread-3  ]: Writing runtime sql for node "model.bain_capital_analytics.report_lp_quarterly"
[0m19:24:59.144250 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.report_lp_quarterly"
[0m19:24:59.144576 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.001 seconds
[0m19:24:59.144871 [debug] [Thread-2  ]: SQL status: DROP VIEW in 0.001 seconds
[0m19:24:59.145188 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.fact_fund_performance"
[0m19:24:59.145467 [debug] [Thread-3  ]: On model.bain_capital_analytics.report_lp_quarterly: BEGIN
[0m19:24:59.146552 [debug] [Thread-1  ]: On model.bain_capital_analytics.fact_cashflow_waterfall: Close
[0m19:24:59.147499 [debug] [Thread-2  ]: On model.bain_capital_analytics.fact_portfolio_attribution: Close
[0m19:24:59.147802 [debug] [Thread-4  ]: On model.bain_capital_analytics.fact_fund_performance: BEGIN
[0m19:24:59.148091 [debug] [Thread-3  ]: Opening a new connection, currently in state closed
[0m19:24:59.148592 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9d39665d-60b2-44a5-9c3b-d86d9b9d1de5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c87b0a0>]}
[0m19:24:59.149030 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9d39665d-60b2-44a5-9c3b-d86d9b9d1de5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11205d9a0>]}
[0m19:24:59.149317 [debug] [Thread-4  ]: Opening a new connection, currently in state closed
[0m19:24:59.150021 [info ] [Thread-1  ]: 45 of 54 OK created sql view model public.fact_cashflow_waterfall .............. [[32mCREATE VIEW[0m in 0.09s]
[0m19:24:59.150501 [info ] [Thread-2  ]: 46 of 54 OK created sql view model public.fact_portfolio_attribution ........... [[32mCREATE VIEW[0m in 0.07s]
[0m19:24:59.151058 [debug] [Thread-1  ]: Finished running node model.bain_capital_analytics.fact_cashflow_waterfall
[0m19:24:59.151502 [debug] [Thread-2  ]: Finished running node model.bain_capital_analytics.fact_portfolio_attribution
[0m19:24:59.152057 [debug] [Thread-1  ]: Began running node test.bain_capital_analytics.not_null_fact_cashflow_waterfall_cashflow_id.7aafd60486
[0m19:24:59.152423 [info ] [Thread-1  ]: 49 of 54 START test not_null_fact_cashflow_waterfall_cashflow_id ............... [RUN]
[0m19:24:59.152758 [debug] [Thread-2  ]: Began running node test.bain_capital_analytics.not_null_fact_portfolio_attribution_portfolio_id.f676c7df62
[0m19:24:59.153082 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.bain_capital_analytics.fact_cashflow_waterfall, now test.bain_capital_analytics.not_null_fact_cashflow_waterfall_cashflow_id.7aafd60486)
[0m19:24:59.153413 [info ] [Thread-2  ]: 50 of 54 START test not_null_fact_portfolio_attribution_portfolio_id ........... [RUN]
[0m19:24:59.153790 [debug] [Thread-1  ]: Began compiling node test.bain_capital_analytics.not_null_fact_cashflow_waterfall_cashflow_id.7aafd60486
[0m19:24:59.154114 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly model.bain_capital_analytics.fact_portfolio_attribution, now test.bain_capital_analytics.not_null_fact_portfolio_attribution_portfolio_id.f676c7df62)
[0m19:24:59.158223 [debug] [Thread-1  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_fact_cashflow_waterfall_cashflow_id.7aafd60486"
[0m19:24:59.158626 [debug] [Thread-2  ]: Began compiling node test.bain_capital_analytics.not_null_fact_portfolio_attribution_portfolio_id.f676c7df62
[0m19:24:59.163439 [debug] [Thread-2  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_fact_portfolio_attribution_portfolio_id.f676c7df62"
[0m19:24:59.163794 [debug] [Thread-3  ]: SQL status: BEGIN in 0.016 seconds
[0m19:24:59.164086 [debug] [Thread-4  ]: SQL status: BEGIN in 0.015 seconds
[0m19:24:59.164489 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.report_lp_quarterly"
[0m19:24:59.164845 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.fact_fund_performance"
[0m19:24:59.165350 [debug] [Thread-3  ]: On model.bain_capital_analytics.report_lp_quarterly: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.report_lp_quarterly"} */

  create view "bain_analytics"."public"."report_lp_quarterly__dbt_tmp"
    
    
  as (
    -- Pipeline C: REPORT table - LP quarterly reporting
-- Anti-pattern: massive query, duplicated logic, no reuse of intermediates
-- Anti-pattern: PostgreSQL-specific date_trunc
-- Anti-pattern: re-aggregation of data already aggregated upstream

with quarterly_cashflows as (
    -- Anti-pattern: re-aggregating cashflows by quarter (already in int_cashflow_enriched)
    select
        cf.fund_id,
        cf.portfolio_id,
        -- Anti-pattern: PostgreSQL-specific date_trunc
        date_trunc('quarter', cf.cashflow_date) as quarter_start,
        cf.cashflow_fiscal_quarter as fiscal_quarter,
        cf.cashflow_year,
        sum(case when cf.cashflow_type = 'capital_call' then cf.amount else 0 end) as quarter_calls,
        sum(case when cf.cashflow_type = 'distribution' then cf.amount else 0 end) as quarter_distributions,
        sum(case when cf.cashflow_type = 'management_fee' then cf.amount else 0 end) as quarter_fees,
        sum(cf.amount) as quarter_net
    from "bain_analytics"."public"."stg_cashflows" cf
    group by
        cf.fund_id, cf.portfolio_id,
        date_trunc('quarter', cf.cashflow_date),
        cf.cashflow_fiscal_quarter, cf.cashflow_year
),

quarterly_valuations as (
    -- Anti-pattern: re-querying valuations with subquery for quarter-end
    select *
    from (
        select
            v.portfolio_id,
            v.valuation_date,
            v.net_asset_value,
            v.gross_asset_value,
            v.unrealized_pnl,
            v.realized_pnl,
            v.valuation_method,
            -- Anti-pattern: subquery dedup instead of QUALIFY
            row_number() over (
                partition by v.portfolio_id, date_trunc('quarter', v.valuation_date)
                order by v.valuation_date desc
            ) as rn
        from "bain_analytics"."public"."stg_valuations" v
    ) sub
    where rn = 1
),

-- Anti-pattern: re-joining fund structures (done in multiple places)
fund_details as (
    select
        fs.fund_id,
        fs.fund_name,
        fs.fund_type,
        fs.committed_capital,
        fs.management_fee_rate,
        fs.carry_rate,
        fs.hurdle_rate,
        fs.vintage_year,
        fs.gp_commitment_pct
    from "bain_analytics"."public"."stg_fund_structures" fs
),

-- Anti-pattern: joining everything at the end
lp_report as (
    select
        fd.fund_id,
        fd.fund_name,
        fd.fund_type,
        fd.vintage_year,
        fd.committed_capital,
        fd.management_fee_rate,
        fd.carry_rate,
        fd.hurdle_rate,
        fd.gp_commitment_pct,
        qc.portfolio_id,
        p.portfolio_name,
        p.strategy,
        qc.quarter_start,
        qc.fiscal_quarter,
        qc.cashflow_year,
        qc.quarter_calls,
        qc.quarter_distributions,
        qc.quarter_fees,
        qc.quarter_net,
        qv.net_asset_value as quarter_end_nav,
        qv.gross_asset_value as quarter_end_gav,
        qv.unrealized_pnl,
        qv.realized_pnl,
        qv.valuation_method,
        -- Anti-pattern: IRR re-joined from separate calculation
        irr.approx_irr,
        irr.tvpi,
        irr.dpi,
        irr.rvpi
    from quarterly_cashflows qc
    inner join fund_details fd
        on qc.fund_id = fd.fund_id
    inner join "bain_analytics"."public"."stg_portfolios" p
        on qc.portfolio_id = p.portfolio_id
    left join quarterly_valuations qv
        on qc.portfolio_id = qv.portfolio_id
        and date_trunc('quarter', qv.valuation_date) = qc.quarter_start
    left join "bain_analytics"."public"."int_irr_calculations" irr
        on qc.fund_id = irr.fund_id
        and qc.portfolio_id = irr.portfolio_id
)

select
    *,
    -- Anti-pattern: computed columns in final select
    case
        when committed_capital > 0
        then quarter_calls / committed_capital
        else 0
    end as quarterly_drawdown_rate,
    case
        when quarter_end_nav is not null and committed_capital > 0
        then quarter_end_nav / committed_capital
        else null
    end as nav_to_commitment_ratio
from lp_report
order by fund_id, portfolio_id, quarter_start
  );
[0m19:24:59.165963 [debug] [Thread-4  ]: On model.bain_capital_analytics.fact_fund_performance: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.fact_fund_performance"} */

  create view "bain_analytics"."public"."fact_fund_performance__dbt_tmp"
    
    
  as (
    -- Pipeline C: FACT table - Fund-level performance metrics
-- Anti-pattern: late aggregation - joins everything then aggregates
-- Anti-pattern: re-joins fund_structures (already in int_fund_nav, int_cashflow_enriched)
-- Anti-pattern: materialized as view (should be table)

with fund_nav_data as (
    select
        fn.fund_id,
        fn.fund_name,
        fn.fund_type,
        fn.committed_capital,
        fn.valuation_date,
        fn.fund_nav,
        fn.fund_gav,
        fn.fund_total_liabilities,
        fn.fund_unrealized_pnl,
        fn.fund_realized_pnl,
        fn.fund_nav_return,
        fn.tvpi_gross,
        fn.num_portfolios
    from "bain_analytics"."public"."int_fund_nav" fn
),

fund_cashflows as (
    -- Anti-pattern: re-aggregating cashflows that are already in int_cashflow_enriched
    select
        cf.fund_id,
        cf.cashflow_date,
        sum(case when cf.cashflow_type = 'capital_call' then cf.amount else 0 end) as period_calls,
        sum(case when cf.cashflow_type = 'distribution' then cf.amount else 0 end) as period_distributions,
        sum(case when cf.cashflow_type = 'management_fee' then cf.amount else 0 end) as period_fees,
        sum(cf.amount) as period_net_cashflow
    from "bain_analytics"."public"."stg_cashflows" cf
    group by cf.fund_id, cf.cashflow_date
),

fund_irr as (
    select
        irr.fund_id,
        sum(irr.total_invested) as fund_total_invested,
        sum(irr.total_distributed) as fund_total_distributed,
        sum(irr.terminal_value) as fund_terminal_value,
        -- Anti-pattern: averaging portfolio IRRs as proxy for fund IRR (incorrect but intentional)
        avg(irr.approx_irr) as fund_approx_irr,
        avg(irr.tvpi) as fund_tvpi,
        avg(irr.dpi) as fund_dpi
    from "bain_analytics"."public"."int_irr_calculations" irr
    group by irr.fund_id
),

-- Anti-pattern: joining everything together at the end
combined as (
    select
        fn.fund_id,
        fn.fund_name,
        fn.fund_type,
        fn.committed_capital,
        fn.valuation_date,
        fn.fund_nav,
        fn.fund_gav,
        fn.fund_total_liabilities,
        fn.fund_unrealized_pnl,
        fn.fund_realized_pnl,
        fn.fund_nav_return,
        fn.tvpi_gross,
        fn.num_portfolios,
        coalesce(fc.period_calls, 0) as period_calls,
        coalesce(fc.period_distributions, 0) as period_distributions,
        coalesce(fc.period_fees, 0) as period_fees,
        coalesce(fc.period_net_cashflow, 0) as period_net_cashflow,
        fi.fund_total_invested,
        fi.fund_total_distributed,
        fi.fund_approx_irr,
        fi.fund_tvpi,
        fi.fund_dpi
    from fund_nav_data fn
    left join fund_cashflows fc
        on fn.fund_id = fc.fund_id
        and fn.valuation_date = fc.cashflow_date
    left join fund_irr fi
        on fn.fund_id = fi.fund_id
)

select * from combined
  );
[0m19:24:59.166391 [debug] [Thread-1  ]: Began executing node test.bain_capital_analytics.not_null_fact_cashflow_waterfall_cashflow_id.7aafd60486
[0m19:24:59.166707 [debug] [Thread-2  ]: Began executing node test.bain_capital_analytics.not_null_fact_portfolio_attribution_portfolio_id.f676c7df62
[0m19:24:59.169049 [debug] [Thread-1  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_fact_cashflow_waterfall_cashflow_id.7aafd60486"
[0m19:24:59.171356 [debug] [Thread-2  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_fact_portfolio_attribution_portfolio_id.f676c7df62"
[0m19:24:59.171955 [debug] [Thread-1  ]: Using postgres connection "test.bain_capital_analytics.not_null_fact_cashflow_waterfall_cashflow_id.7aafd60486"
[0m19:24:59.172294 [debug] [Thread-4  ]: SQL status: CREATE VIEW in 0.005 seconds
[0m19:24:59.172618 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_fact_cashflow_waterfall_cashflow_id.7aafd60486: BEGIN
[0m19:24:59.175441 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.fact_fund_performance"
[0m19:24:59.175822 [debug] [Thread-2  ]: Using postgres connection "test.bain_capital_analytics.not_null_fact_portfolio_attribution_portfolio_id.f676c7df62"
[0m19:24:59.176127 [debug] [Thread-3  ]: SQL status: CREATE VIEW in 0.009 seconds
[0m19:24:59.176399 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m19:24:59.176702 [debug] [Thread-4  ]: On model.bain_capital_analytics.fact_fund_performance: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.fact_fund_performance"} */
alter table "bain_analytics"."public"."fact_fund_performance__dbt_tmp" rename to "fact_fund_performance"
[0m19:24:59.176993 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_fact_portfolio_attribution_portfolio_id.f676c7df62: BEGIN
[0m19:24:59.179682 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.report_lp_quarterly"
[0m19:24:59.180166 [debug] [Thread-2  ]: Opening a new connection, currently in state closed
[0m19:24:59.180527 [debug] [Thread-3  ]: On model.bain_capital_analytics.report_lp_quarterly: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.report_lp_quarterly"} */
alter table "bain_analytics"."public"."report_lp_quarterly__dbt_tmp" rename to "report_lp_quarterly"
[0m19:24:59.181014 [debug] [Thread-4  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m19:24:59.182106 [debug] [Thread-4  ]: On model.bain_capital_analytics.fact_fund_performance: COMMIT
[0m19:24:59.182494 [debug] [Thread-3  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m19:24:59.182841 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.fact_fund_performance"
[0m19:24:59.184019 [debug] [Thread-3  ]: On model.bain_capital_analytics.report_lp_quarterly: COMMIT
[0m19:24:59.184366 [debug] [Thread-4  ]: On model.bain_capital_analytics.fact_fund_performance: COMMIT
[0m19:24:59.184683 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.report_lp_quarterly"
[0m19:24:59.185022 [debug] [Thread-3  ]: On model.bain_capital_analytics.report_lp_quarterly: COMMIT
[0m19:24:59.185757 [debug] [Thread-4  ]: SQL status: COMMIT in 0.001 seconds
[0m19:24:59.188069 [debug] [Thread-4  ]: Applying DROP to: "bain_analytics"."public"."fact_fund_performance__dbt_backup"
[0m19:24:59.188574 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.fact_fund_performance"
[0m19:24:59.188904 [debug] [Thread-4  ]: On model.bain_capital_analytics.fact_fund_performance: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.fact_fund_performance"} */
drop view if exists "bain_analytics"."public"."fact_fund_performance__dbt_backup" cascade
[0m19:24:59.189233 [debug] [Thread-3  ]: SQL status: COMMIT in 0.004 seconds
[0m19:24:59.189575 [debug] [Thread-2  ]: SQL status: BEGIN in 0.009 seconds
[0m19:24:59.189913 [debug] [Thread-1  ]: SQL status: BEGIN in 0.013 seconds
[0m19:24:59.190234 [debug] [Thread-4  ]: SQL status: DROP VIEW in 0.001 seconds
[0m19:24:59.239195 [debug] [Thread-3  ]: Applying DROP to: "bain_analytics"."public"."report_lp_quarterly__dbt_backup"
[0m19:24:59.239618 [debug] [Thread-2  ]: Using postgres connection "test.bain_capital_analytics.not_null_fact_portfolio_attribution_portfolio_id.f676c7df62"
[0m19:24:59.239925 [debug] [Thread-1  ]: Using postgres connection "test.bain_capital_analytics.not_null_fact_cashflow_waterfall_cashflow_id.7aafd60486"
[0m19:24:59.241147 [debug] [Thread-4  ]: On model.bain_capital_analytics.fact_fund_performance: Close
[0m19:24:59.241700 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.report_lp_quarterly"
[0m19:24:59.242040 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_fact_portfolio_attribution_portfolio_id.f676c7df62: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_fact_portfolio_attribution_portfolio_id.f676c7df62"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select portfolio_id
from "bain_analytics"."public"."fact_portfolio_attribution"
where portfolio_id is null



  
  
      
    ) dbt_internal_test
[0m19:24:59.242369 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_fact_cashflow_waterfall_cashflow_id.7aafd60486: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_fact_cashflow_waterfall_cashflow_id.7aafd60486"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select cashflow_id
from "bain_analytics"."public"."fact_cashflow_waterfall"
where cashflow_id is null



  
  
      
    ) dbt_internal_test
[0m19:24:59.242745 [debug] [Thread-3  ]: On model.bain_capital_analytics.report_lp_quarterly: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.report_lp_quarterly"} */
drop view if exists "bain_analytics"."public"."report_lp_quarterly__dbt_backup" cascade
[0m19:24:59.243294 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9d39665d-60b2-44a5-9c3b-d86d9b9d1de5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112113bb0>]}
[0m19:24:59.243934 [info ] [Thread-4  ]: 47 of 54 OK created sql view model public.fact_fund_performance ................ [[32mCREATE VIEW[0m in 0.12s]
[0m19:24:59.244413 [debug] [Thread-4  ]: Finished running node model.bain_capital_analytics.fact_fund_performance
[0m19:24:59.244719 [debug] [Thread-3  ]: SQL status: DROP VIEW in 0.001 seconds
[0m19:24:59.245858 [debug] [Thread-3  ]: On model.bain_capital_analytics.report_lp_quarterly: Close
[0m19:24:59.246184 [debug] [Thread-4  ]: Began running node test.bain_capital_analytics.not_null_fact_fund_performance_fund_id.738d6489c4
[0m19:24:59.246674 [info ] [Thread-4  ]: 51 of 54 START test not_null_fact_fund_performance_fund_id ..................... [RUN]
[0m19:24:59.247043 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9d39665d-60b2-44a5-9c3b-d86d9b9d1de5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10cf62160>]}
[0m19:24:59.247368 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly model.bain_capital_analytics.fact_fund_performance, now test.bain_capital_analytics.not_null_fact_fund_performance_fund_id.738d6489c4)
[0m19:24:59.247766 [debug] [Thread-4  ]: Began compiling node test.bain_capital_analytics.not_null_fact_fund_performance_fund_id.738d6489c4
[0m19:24:59.248239 [info ] [Thread-3  ]: 48 of 54 OK created sql view model public.report_lp_quarterly .................. [[32mCREATE VIEW[0m in 0.13s]
[0m19:24:59.252204 [debug] [Thread-4  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_fact_fund_performance_fund_id.738d6489c4"
[0m19:24:59.252540 [debug] [Thread-1  ]: SQL status: SELECT 1 in 0.009 seconds
[0m19:24:59.252978 [debug] [Thread-3  ]: Finished running node model.bain_capital_analytics.report_lp_quarterly
[0m19:24:59.253286 [debug] [Thread-2  ]: SQL status: SELECT 1 in 0.010 seconds
[0m19:24:59.254533 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_fact_cashflow_waterfall_cashflow_id.7aafd60486: ROLLBACK
[0m19:24:59.255678 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_fact_portfolio_attribution_portfolio_id.f676c7df62: ROLLBACK
[0m19:24:59.256045 [debug] [Thread-4  ]: Began executing node test.bain_capital_analytics.not_null_fact_fund_performance_fund_id.738d6489c4
[0m19:24:59.256425 [debug] [Thread-3  ]: Began running node test.bain_capital_analytics.not_null_report_lp_quarterly_fund_id.aa355f6583
[0m19:24:59.258857 [debug] [Thread-4  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_fact_fund_performance_fund_id.738d6489c4"
[0m19:24:59.259176 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_fact_portfolio_attribution_portfolio_id.f676c7df62: Close
[0m19:24:59.259459 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_fact_cashflow_waterfall_cashflow_id.7aafd60486: Close
[0m19:24:59.259756 [info ] [Thread-3  ]: 52 of 54 START test not_null_report_lp_quarterly_fund_id ....................... [RUN]
[0m19:24:59.260456 [info ] [Thread-2  ]: 50 of 54 PASS not_null_fact_portfolio_attribution_portfolio_id ................. [[32mPASS[0m in 0.11s]
[0m19:24:59.260954 [info ] [Thread-1  ]: 49 of 54 PASS not_null_fact_cashflow_waterfall_cashflow_id ..................... [[32mPASS[0m in 0.11s]
[0m19:24:59.261347 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly model.bain_capital_analytics.report_lp_quarterly, now test.bain_capital_analytics.not_null_report_lp_quarterly_fund_id.aa355f6583)
[0m19:24:59.261712 [debug] [Thread-4  ]: Using postgres connection "test.bain_capital_analytics.not_null_fact_fund_performance_fund_id.738d6489c4"
[0m19:24:59.262124 [debug] [Thread-2  ]: Finished running node test.bain_capital_analytics.not_null_fact_portfolio_attribution_portfolio_id.f676c7df62
[0m19:24:59.262527 [debug] [Thread-1  ]: Finished running node test.bain_capital_analytics.not_null_fact_cashflow_waterfall_cashflow_id.7aafd60486
[0m19:24:59.262821 [debug] [Thread-3  ]: Began compiling node test.bain_capital_analytics.not_null_report_lp_quarterly_fund_id.aa355f6583
[0m19:24:59.263109 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_fact_fund_performance_fund_id.738d6489c4: BEGIN
[0m19:24:59.266881 [debug] [Thread-3  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_report_lp_quarterly_fund_id.aa355f6583"
[0m19:24:59.267205 [debug] [Thread-4  ]: Opening a new connection, currently in state closed
[0m19:24:59.267727 [debug] [Thread-3  ]: Began executing node test.bain_capital_analytics.not_null_report_lp_quarterly_fund_id.aa355f6583
[0m19:24:59.269955 [debug] [Thread-3  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_report_lp_quarterly_fund_id.aa355f6583"
[0m19:24:59.270448 [debug] [Thread-3  ]: Using postgres connection "test.bain_capital_analytics.not_null_report_lp_quarterly_fund_id.aa355f6583"
[0m19:24:59.270734 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_report_lp_quarterly_fund_id.aa355f6583: BEGIN
[0m19:24:59.271004 [debug] [Thread-3  ]: Opening a new connection, currently in state closed
[0m19:24:59.276523 [debug] [Thread-4  ]: SQL status: BEGIN in 0.009 seconds
[0m19:24:59.276822 [debug] [Thread-4  ]: Using postgres connection "test.bain_capital_analytics.not_null_fact_fund_performance_fund_id.738d6489c4"
[0m19:24:59.277119 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_fact_fund_performance_fund_id.738d6489c4: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_fact_fund_performance_fund_id.738d6489c4"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select fund_id
from "bain_analytics"."public"."fact_fund_performance"
where fund_id is null



  
  
      
    ) dbt_internal_test
[0m19:24:59.278960 [debug] [Thread-3  ]: SQL status: BEGIN in 0.008 seconds
[0m19:24:59.279249 [debug] [Thread-3  ]: Using postgres connection "test.bain_capital_analytics.not_null_report_lp_quarterly_fund_id.aa355f6583"
[0m19:24:59.279542 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_report_lp_quarterly_fund_id.aa355f6583: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_report_lp_quarterly_fund_id.aa355f6583"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select fund_id
from "bain_analytics"."public"."report_lp_quarterly"
where fund_id is null



  
  
      
    ) dbt_internal_test
[0m19:24:59.285735 [debug] [Thread-4  ]: SQL status: SELECT 1 in 0.008 seconds
[0m19:24:59.286893 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_fact_fund_performance_fund_id.738d6489c4: ROLLBACK
[0m19:24:59.287646 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_fact_fund_performance_fund_id.738d6489c4: Close
[0m19:24:59.288099 [info ] [Thread-4  ]: 51 of 54 PASS not_null_fact_fund_performance_fund_id ........................... [[32mPASS[0m in 0.04s]
[0m19:24:59.288537 [debug] [Thread-4  ]: Finished running node test.bain_capital_analytics.not_null_fact_fund_performance_fund_id.738d6489c4
[0m19:24:59.288849 [debug] [Thread-3  ]: SQL status: SELECT 1 in 0.009 seconds
[0m19:24:59.290004 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_report_lp_quarterly_fund_id.aa355f6583: ROLLBACK
[0m19:24:59.290452 [debug] [Thread-2  ]: Began running node model.bain_capital_analytics.report_ic_dashboard
[0m19:24:59.290987 [info ] [Thread-2  ]: 53 of 54 START sql view model public.report_ic_dashboard ....................... [RUN]
[0m19:24:59.291309 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_report_lp_quarterly_fund_id.aa355f6583: Close
[0m19:24:59.291639 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.not_null_fact_portfolio_attribution_portfolio_id.f676c7df62, now model.bain_capital_analytics.report_ic_dashboard)
[0m19:24:59.292086 [info ] [Thread-3  ]: 52 of 54 PASS not_null_report_lp_quarterly_fund_id ............................. [[32mPASS[0m in 0.03s]
[0m19:24:59.292393 [debug] [Thread-2  ]: Began compiling node model.bain_capital_analytics.report_ic_dashboard
[0m19:24:59.292798 [debug] [Thread-3  ]: Finished running node test.bain_capital_analytics.not_null_report_lp_quarterly_fund_id.aa355f6583
[0m19:24:59.296378 [debug] [Thread-2  ]: Writing injected SQL for node "model.bain_capital_analytics.report_ic_dashboard"
[0m19:24:59.297010 [debug] [Thread-2  ]: Began executing node model.bain_capital_analytics.report_ic_dashboard
[0m19:24:59.301837 [debug] [Thread-2  ]: Writing runtime sql for node "model.bain_capital_analytics.report_ic_dashboard"
[0m19:24:59.302348 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.report_ic_dashboard"
[0m19:24:59.302641 [debug] [Thread-2  ]: On model.bain_capital_analytics.report_ic_dashboard: BEGIN
[0m19:24:59.302917 [debug] [Thread-2  ]: Opening a new connection, currently in state closed
[0m19:24:59.312684 [debug] [Thread-2  ]: SQL status: BEGIN in 0.010 seconds
[0m19:24:59.313026 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.report_ic_dashboard"
[0m19:24:59.313429 [debug] [Thread-2  ]: On model.bain_capital_analytics.report_ic_dashboard: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.report_ic_dashboard"} */

  create view "bain_analytics"."public"."report_ic_dashboard__dbt_tmp"
    
    
  as (
    -- Pipeline C: REPORT table - Investment Committee dashboard
-- Anti-pattern: massive query joining many sources, no intermediate reuse
-- Anti-pattern: subquery for latest records instead of QUALIFY
-- Anti-pattern: duplicated logic from other reports

with latest_fund_performance as (
    select *
    from (
        select
            fp.*,
            -- Anti-pattern: subquery dedup instead of QUALIFY
            row_number() over (
                partition by fp.fund_id
                order by fp.valuation_date desc
            ) as rn
        from "bain_analytics"."public"."fact_fund_performance" fp
    ) sub
    where rn = 1
),

latest_portfolio_summary as (
    select *
    from (
        select
            ps.*,
            row_number() over (
                partition by ps.portfolio_id
                order by ps.position_date desc
            ) as rn
        from "bain_analytics"."public"."fact_portfolio_summary" ps
    ) sub
    where rn = 1
),

-- Anti-pattern: re-joining fund structures (already in fact_fund_performance)
fund_overview as (
    select
        lfp.fund_id,
        lfp.fund_name,
        lfp.fund_type,
        lfp.committed_capital,
        lfp.valuation_date as latest_valuation_date,
        lfp.fund_nav,
        lfp.fund_gav,
        lfp.fund_nav_return as latest_nav_return,
        lfp.tvpi_gross,
        lfp.fund_approx_irr,
        lfp.fund_tvpi,
        lfp.fund_dpi,
        lfp.num_portfolios,
        lfp.fund_total_invested,
        lfp.fund_total_distributed,
        -- Anti-pattern: re-joining fund structures
        fs.management_fee_rate,
        fs.carry_rate,
        fs.hurdle_rate,
        fs.vintage_year
    from latest_fund_performance lfp
    inner join "bain_analytics"."public"."stg_fund_structures" fs
        on lfp.fund_id = fs.fund_id
),

portfolio_details as (
    select
        lps.portfolio_id,
        lps.portfolio_name,
        lps.strategy,
        lps.fund_id,
        lps.total_market_value,
        lps.total_unrealized_pnl,
        lps.portfolio_return_pct,
        lps.num_positions,
        -- Anti-pattern: re-computing fiscal quarter
        case
            when extract(month from lps.position_date) between 1 and 3 then 'Q3'
            when extract(month from lps.position_date) between 4 and 6 then 'Q4'
            when extract(month from lps.position_date) between 7 and 9 then 'Q1'
            when extract(month from lps.position_date) between 10 and 12 then 'Q2'
        end as reporting_fiscal_quarter
    from latest_portfolio_summary lps
)

select
    fo.fund_id,
    fo.fund_name,
    fo.fund_type,
    fo.vintage_year,
    fo.committed_capital,
    fo.latest_valuation_date,
    fo.fund_nav,
    fo.fund_gav,
    fo.latest_nav_return,
    fo.tvpi_gross,
    fo.fund_approx_irr,
    fo.fund_tvpi,
    fo.fund_dpi,
    fo.num_portfolios,
    fo.fund_total_invested,
    fo.fund_total_distributed,
    fo.management_fee_rate,
    fo.carry_rate,
    fo.hurdle_rate,
    pd.portfolio_id,
    pd.portfolio_name,
    pd.strategy,
    pd.total_market_value as portfolio_mv,
    pd.total_unrealized_pnl as portfolio_unrealized_pnl,
    pd.portfolio_return_pct,
    pd.num_positions as portfolio_num_positions,
    pd.reporting_fiscal_quarter
from fund_overview fo
inner join portfolio_details pd
    on fo.fund_id = pd.fund_id
order by fo.fund_nav desc, pd.total_market_value desc
  );
[0m19:24:59.317441 [debug] [Thread-2  ]: Postgres adapter: Postgres error: relation "public.fact_portfolio_summary" does not exist
LINE 36:         from "bain_analytics"."public"."fact_portfolio_summa...
                      ^

[0m19:24:59.323156 [debug] [Thread-2  ]: On model.bain_capital_analytics.report_ic_dashboard: ROLLBACK
[0m19:24:59.325512 [debug] [Thread-2  ]: On model.bain_capital_analytics.report_ic_dashboard: Close
[0m19:24:59.350823 [debug] [Thread-2  ]: Database Error in model report_ic_dashboard (models/marts/report_ic_dashboard.sql)
  relation "public.fact_portfolio_summary" does not exist
  LINE 36:         from "bain_analytics"."public"."fact_portfolio_summa...
                        ^
  compiled code at target/run/bain_capital_analytics/models/marts/report_ic_dashboard.sql
[0m19:24:59.351449 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9d39665d-60b2-44a5-9c3b-d86d9b9d1de5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10cd82b50>]}
[0m19:24:59.352060 [error] [Thread-2  ]: 53 of 54 ERROR creating sql view model public.report_ic_dashboard .............. [[31mERROR[0m in 0.06s]
[0m19:24:59.352551 [debug] [Thread-2  ]: Finished running node model.bain_capital_analytics.report_ic_dashboard
[0m19:24:59.353018 [debug] [Thread-7  ]: Marking all children of 'model.bain_capital_analytics.report_ic_dashboard' to be skipped because of status 'error'.  Reason: Database Error in model report_ic_dashboard (models/marts/report_ic_dashboard.sql)
  relation "public.fact_portfolio_summary" does not exist
  LINE 36:         from "bain_analytics"."public"."fact_portfolio_summa...
                        ^
  compiled code at target/run/bain_capital_analytics/models/marts/report_ic_dashboard.sql.
[0m19:24:59.353617 [debug] [Thread-4  ]: Began running node test.bain_capital_analytics.not_null_report_ic_dashboard_fund_id.e430aafd84
[0m19:24:59.354029 [info ] [Thread-4  ]: 54 of 54 SKIP test not_null_report_ic_dashboard_fund_id ........................ [[33mSKIP[0m]
[0m19:24:59.354399 [debug] [Thread-4  ]: Finished running node test.bain_capital_analytics.not_null_report_ic_dashboard_fund_id.e430aafd84
[0m19:24:59.354679 [debug] [Thread-7  ]: Marking all children of 'test.bain_capital_analytics.not_null_report_ic_dashboard_fund_id.e430aafd84' to be skipped because of status 'skipped'. 
[0m19:24:59.355633 [debug] [MainThread]: Using postgres connection "master"
[0m19:24:59.355932 [debug] [MainThread]: On master: BEGIN
[0m19:24:59.356181 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m19:24:59.366846 [debug] [MainThread]: SQL status: BEGIN in 0.011 seconds
[0m19:24:59.367189 [debug] [MainThread]: On master: COMMIT
[0m19:24:59.367443 [debug] [MainThread]: Using postgres connection "master"
[0m19:24:59.367676 [debug] [MainThread]: On master: COMMIT
[0m19:24:59.368359 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m19:24:59.368605 [debug] [MainThread]: On master: Close
[0m19:24:59.368946 [debug] [MainThread]: Connection 'master' was properly closed.
[0m19:24:59.369178 [debug] [MainThread]: Connection 'test.bain_capital_analytics.not_null_fact_cashflow_waterfall_cashflow_id.7aafd60486' was properly closed.
[0m19:24:59.369395 [debug] [MainThread]: Connection 'model.bain_capital_analytics.report_ic_dashboard' was properly closed.
[0m19:24:59.369610 [debug] [MainThread]: Connection 'test.bain_capital_analytics.not_null_report_lp_quarterly_fund_id.aa355f6583' was properly closed.
[0m19:24:59.369822 [debug] [MainThread]: Connection 'test.bain_capital_analytics.not_null_fact_fund_performance_fund_id.738d6489c4' was properly closed.
[0m19:24:59.370191 [info ] [MainThread]: 
[0m19:24:59.370465 [info ] [MainThread]: Finished running 35 data tests, 19 view models in 0 hours 0 minutes and 1.44 seconds (1.44s).
[0m19:24:59.376128 [debug] [MainThread]: Command end result
[0m19:24:59.418329 [debug] [MainThread]: Wrote artifact WritableManifest to ./target/manifest.json
[0m19:24:59.420130 [debug] [MainThread]: Wrote artifact SemanticManifest to ./target/semantic_manifest.json
[0m19:24:59.428331 [debug] [MainThread]: Wrote artifact RunExecutionResult to ./target/run_results.json
[0m19:24:59.428689 [info ] [MainThread]: 
[0m19:24:59.429019 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m19:24:59.429296 [info ] [MainThread]: 
[0m19:24:59.429638 [error] [MainThread]: [31mFailure in model report_ic_dashboard (models/marts/report_ic_dashboard.sql)[0m
[0m19:24:59.429960 [error] [MainThread]:   Database Error in model report_ic_dashboard (models/marts/report_ic_dashboard.sql)
  relation "public.fact_portfolio_summary" does not exist
  LINE 36:         from "bain_analytics"."public"."fact_portfolio_summa...
                        ^
  compiled code at target/run/bain_capital_analytics/models/marts/report_ic_dashboard.sql
[0m19:24:59.430221 [info ] [MainThread]: 
[0m19:24:59.430515 [info ] [MainThread]:   compiled code at target/compiled/bain_capital_analytics/models/marts/report_ic_dashboard.sql
[0m19:24:59.430831 [info ] [MainThread]: 
[0m19:24:59.431116 [info ] [MainThread]: Done. PASS=52 WARN=0 ERROR=1 SKIP=1 NO-OP=0 TOTAL=54
[0m19:24:59.433767 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": false, "command_wall_clock_time": 2.4113767, "process_in_blocks": "0", "process_kernel_time": 0.370092, "process_mem_max_rss": "141541376", "process_out_blocks": "0", "process_user_time": 3.518184}
[0m19:24:59.434145 [debug] [MainThread]: Command `dbt build` failed at 19:24:59.434075 after 2.41 seconds
[0m19:24:59.434487 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a4ad190>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c82b640>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c82bc10>]}
[0m19:24:59.434816 [debug] [MainThread]: Flushing usage events
[0m19:25:02.452382 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m19:25:13.960879 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1086c11c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10976e850>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10976e670>]}


============================== 19:25:13.964861 | f5777163-bfb8-4ecd-8d00-9b8bf6f11360 ==============================
[0m19:25:13.964861 [info ] [MainThread]: Running with dbt=1.11.0-b3
[0m19:25:13.965383 [debug] [MainThread]: running dbt with arguments {'send_anonymous_usage_stats': 'True', 'fail_fast': 'False', 'log_cache_events': 'False', 'static_parser': 'True', 'partial_parse': 'True', 'log_format': 'default', 'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'use_experimental_parser': 'False', 'version_check': 'True', 'cache_selected_only': 'False', 'use_colors': 'True', 'empty': 'False', 'no_print': 'None', 'warn_error': 'None', 'profiles_dir': '.', 'log_path': 'logs', 'quiet': 'False', 'introspect': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'invocation_command': 'dbt build --select tag:pipeline_c --profiles-dir . --project-dir .', 'debug': 'False'}
[0m19:25:14.163520 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'f5777163-bfb8-4ecd-8d00-9b8bf6f11360', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108802490>]}
[0m19:25:14.239142 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'f5777163-bfb8-4ecd-8d00-9b8bf6f11360', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108964d90>]}
[0m19:25:14.240349 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m19:25:14.347542 [debug] [MainThread]: checksum: e63134dccc1251cfb572caf0e4aa952f030c125ee3634f3bf2c0a2e1bb6ae349, vars: {}, profile: , target: , version: 1.11.0b3
[0m19:25:14.580986 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m19:25:14.581458 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m19:25:14.645015 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'f5777163-bfb8-4ecd-8d00-9b8bf6f11360', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a8cc130>]}
[0m19:25:14.774144 [debug] [MainThread]: Wrote artifact WritableManifest to ./target/manifest.json
[0m19:25:14.776156 [debug] [MainThread]: Wrote artifact SemanticManifest to ./target/semantic_manifest.json
[0m19:25:14.805554 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'f5777163-bfb8-4ecd-8d00-9b8bf6f11360', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a9e59d0>]}
[0m19:25:14.806119 [info ] [MainThread]: Found 28 models, 53 data tests, 10 seeds, 569 macros
[0m19:25:14.810186 [info ] [MainThread]: 
[0m19:25:14.810527 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m19:25:14.810784 [info ] [MainThread]: 
[0m19:25:14.811193 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m19:25:14.816008 [debug] [ThreadPool]: Acquiring new postgres connection 'list_bain_analytics'
[0m19:25:14.866429 [debug] [ThreadPool]: Using postgres connection "list_bain_analytics"
[0m19:25:14.866887 [debug] [ThreadPool]: On list_bain_analytics: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "connection_name": "list_bain_analytics"} */

    select distinct nspname from pg_namespace
  
[0m19:25:14.867193 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m19:25:14.894985 [debug] [ThreadPool]: SQL status: SELECT 5 in 0.028 seconds
[0m19:25:14.896220 [debug] [ThreadPool]: On list_bain_analytics: Close
[0m19:25:14.899498 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_bain_analytics, now list_bain_analytics_public)
[0m19:25:14.905256 [debug] [ThreadPool]: Using postgres connection "list_bain_analytics_public"
[0m19:25:14.905676 [debug] [ThreadPool]: Acquiring new postgres connection 'list_bain_analytics_public_raw'
[0m19:25:14.905949 [debug] [ThreadPool]: On list_bain_analytics_public: BEGIN
[0m19:25:14.908430 [debug] [ThreadPool]: Using postgres connection "list_bain_analytics_public_raw"
[0m19:25:14.908766 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:25:14.909139 [debug] [ThreadPool]: On list_bain_analytics_public_raw: BEGIN
[0m19:25:14.909567 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m19:25:14.919648 [debug] [ThreadPool]: SQL status: BEGIN in 0.010 seconds
[0m19:25:14.920008 [debug] [ThreadPool]: SQL status: BEGIN in 0.011 seconds
[0m19:25:14.920319 [debug] [ThreadPool]: Using postgres connection "list_bain_analytics_public_raw"
[0m19:25:14.920611 [debug] [ThreadPool]: Using postgres connection "list_bain_analytics_public"
[0m19:25:14.920925 [debug] [ThreadPool]: On list_bain_analytics_public_raw: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "connection_name": "list_bain_analytics_public_raw"} */
select
      'bain_analytics' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_raw'
    union all
    select
      'bain_analytics' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_raw'
    union all
    select
      'bain_analytics' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_raw'
  
[0m19:25:14.921230 [debug] [ThreadPool]: On list_bain_analytics_public: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "connection_name": "list_bain_analytics_public"} */
select
      'bain_analytics' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'bain_analytics' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'bain_analytics' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m19:25:14.924993 [debug] [ThreadPool]: SQL status: SELECT 10 in 0.003 seconds
[0m19:25:14.925318 [debug] [ThreadPool]: SQL status: SELECT 20 in 0.004 seconds
[0m19:25:14.926640 [debug] [ThreadPool]: On list_bain_analytics_public_raw: ROLLBACK
[0m19:25:14.927861 [debug] [ThreadPool]: On list_bain_analytics_public: ROLLBACK
[0m19:25:14.928496 [debug] [ThreadPool]: On list_bain_analytics_public: Close
[0m19:25:14.928764 [debug] [ThreadPool]: On list_bain_analytics_public_raw: Close
[0m19:25:14.938713 [debug] [MainThread]: Using postgres connection "master"
[0m19:25:14.939044 [debug] [MainThread]: On master: BEGIN
[0m19:25:14.939302 [debug] [MainThread]: Opening a new connection, currently in state init
[0m19:25:14.947630 [debug] [MainThread]: SQL status: BEGIN in 0.008 seconds
[0m19:25:14.947958 [debug] [MainThread]: Using postgres connection "master"
[0m19:25:14.948275 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "connection_name": "master"} */
select distinct
        dependent_namespace.nspname as dependent_schema,
        dependent_class.relname as dependent_name,
        referenced_namespace.nspname as referenced_schema,
        referenced_class.relname as referenced_name

    -- Query for views: views are entries in pg_class with an entry in pg_rewrite, but we avoid
    -- a seq scan on pg_rewrite by leveraging the fact there is an "internal" row in pg_depend for
    -- the view...
    from pg_class as dependent_class
    join pg_namespace as dependent_namespace on dependent_namespace.oid = dependent_class.relnamespace
    join pg_depend as dependent_depend on dependent_depend.refobjid = dependent_class.oid
        and dependent_depend.classid = 'pg_rewrite'::regclass
        and dependent_depend.refclassid = 'pg_class'::regclass
        and dependent_depend.deptype = 'i'

    -- ... and via pg_depend (that has a row per column, hence the need for "distinct" above, and
    -- making sure to exclude the internal row to avoid a view appearing to depend on itself)...
    join pg_depend as joining_depend on joining_depend.objid = dependent_depend.objid
        and joining_depend.classid = 'pg_rewrite'::regclass
        and joining_depend.refclassid = 'pg_class'::regclass
        and joining_depend.refobjid != dependent_depend.refobjid

    -- ... we can find the tables they query from in pg_class, but excluding system tables. Note we
    -- don't need need to exclude _dependent_ system tables, because they only query from other
    -- system tables, and so are automatically excluded by excluding _referenced_ system tables
    join pg_class as referenced_class on referenced_class.oid = joining_depend.refobjid
    join pg_namespace as referenced_namespace on referenced_namespace.oid = referenced_class.relnamespace
        and referenced_namespace.nspname != 'information_schema'
        and referenced_namespace.nspname not like 'pg\_%'

    order by
        dependent_schema, dependent_name, referenced_schema, referenced_name;
[0m19:25:14.953286 [debug] [MainThread]: SQL status: SELECT 38 in 0.005 seconds
[0m19:25:14.959911 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f5777163-bfb8-4ecd-8d00-9b8bf6f11360', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ae67d60>]}
[0m19:25:14.960414 [debug] [MainThread]: On master: ROLLBACK
[0m19:25:14.961057 [debug] [MainThread]: Using postgres connection "master"
[0m19:25:14.961336 [debug] [MainThread]: On master: BEGIN
[0m19:25:14.962162 [debug] [MainThread]: SQL status: BEGIN in 0.001 seconds
[0m19:25:14.962441 [debug] [MainThread]: On master: COMMIT
[0m19:25:14.962700 [debug] [MainThread]: Using postgres connection "master"
[0m19:25:14.962945 [debug] [MainThread]: On master: COMMIT
[0m19:25:14.963450 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m19:25:14.963735 [debug] [MainThread]: On master: Close
[0m19:25:14.966123 [debug] [Thread-1  ]: Began running node model.bain_capital_analytics.stg_benchmarks
[0m19:25:14.966486 [debug] [Thread-2  ]: Began running node model.bain_capital_analytics.stg_cashflows
[0m19:25:14.966958 [info ] [Thread-1  ]: 1 of 54 START sql view model public.stg_benchmarks ............................. [RUN]
[0m19:25:14.967338 [debug] [Thread-3  ]: Began running node model.bain_capital_analytics.stg_dates
[0m19:25:14.967740 [info ] [Thread-2  ]: 2 of 54 START sql view model public.stg_cashflows .............................. [RUN]
[0m19:25:14.968149 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_bain_analytics_public, now model.bain_capital_analytics.stg_benchmarks)
[0m19:25:14.968459 [debug] [Thread-4  ]: Began running node model.bain_capital_analytics.stg_fund_structures
[0m19:25:14.968846 [info ] [Thread-3  ]: 3 of 54 START sql view model public.stg_dates .................................. [RUN]
[0m19:25:14.969190 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly list_bain_analytics_public_raw, now model.bain_capital_analytics.stg_cashflows)
[0m19:25:14.969512 [debug] [Thread-1  ]: Began compiling node model.bain_capital_analytics.stg_benchmarks
[0m19:25:14.969879 [info ] [Thread-4  ]: 4 of 54 START sql view model public.stg_fund_structures ........................ [RUN]
[0m19:25:14.970298 [debug] [Thread-3  ]: Acquiring new postgres connection 'model.bain_capital_analytics.stg_dates'
[0m19:25:14.970601 [debug] [Thread-2  ]: Began compiling node model.bain_capital_analytics.stg_cashflows
[0m19:25:14.979103 [debug] [Thread-1  ]: Writing injected SQL for node "model.bain_capital_analytics.stg_benchmarks"
[0m19:25:14.979589 [debug] [Thread-4  ]: Acquiring new postgres connection 'model.bain_capital_analytics.stg_fund_structures'
[0m19:25:14.979914 [debug] [Thread-3  ]: Began compiling node model.bain_capital_analytics.stg_dates
[0m19:25:14.982715 [debug] [Thread-2  ]: Writing injected SQL for node "model.bain_capital_analytics.stg_cashflows"
[0m19:25:14.983125 [debug] [Thread-4  ]: Began compiling node model.bain_capital_analytics.stg_fund_structures
[0m19:25:14.986813 [debug] [Thread-3  ]: Writing injected SQL for node "model.bain_capital_analytics.stg_dates"
[0m19:25:14.989542 [debug] [Thread-4  ]: Writing injected SQL for node "model.bain_capital_analytics.stg_fund_structures"
[0m19:25:14.990035 [debug] [Thread-1  ]: Began executing node model.bain_capital_analytics.stg_benchmarks
[0m19:25:14.990384 [debug] [Thread-2  ]: Began executing node model.bain_capital_analytics.stg_cashflows
[0m19:25:14.997011 [debug] [Thread-3  ]: Began executing node model.bain_capital_analytics.stg_dates
[0m19:25:15.037643 [debug] [Thread-1  ]: Writing runtime sql for node "model.bain_capital_analytics.stg_benchmarks"
[0m19:25:15.038062 [debug] [Thread-4  ]: Began executing node model.bain_capital_analytics.stg_fund_structures
[0m19:25:15.038478 [debug] [Thread-2  ]: Writing runtime sql for node "model.bain_capital_analytics.stg_cashflows"
[0m19:25:15.038865 [debug] [Thread-3  ]: Writing runtime sql for node "model.bain_capital_analytics.stg_dates"
[0m19:25:15.042458 [debug] [Thread-4  ]: Writing runtime sql for node "model.bain_capital_analytics.stg_fund_structures"
[0m19:25:15.043138 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.stg_cashflows"
[0m19:25:15.043556 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.stg_benchmarks"
[0m19:25:15.043914 [debug] [Thread-2  ]: On model.bain_capital_analytics.stg_cashflows: BEGIN
[0m19:25:15.044284 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_benchmarks: BEGIN
[0m19:25:15.044648 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.stg_dates"
[0m19:25:15.045011 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.stg_fund_structures"
[0m19:25:15.045314 [debug] [Thread-2  ]: Opening a new connection, currently in state closed
[0m19:25:15.045616 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m19:25:15.045914 [debug] [Thread-3  ]: On model.bain_capital_analytics.stg_dates: BEGIN
[0m19:25:15.046205 [debug] [Thread-4  ]: On model.bain_capital_analytics.stg_fund_structures: BEGIN
[0m19:25:15.046696 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m19:25:15.047000 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m19:25:15.063119 [debug] [Thread-4  ]: SQL status: BEGIN in 0.016 seconds
[0m19:25:15.063503 [debug] [Thread-2  ]: SQL status: BEGIN in 0.018 seconds
[0m19:25:15.063809 [debug] [Thread-3  ]: SQL status: BEGIN in 0.017 seconds
[0m19:25:15.064129 [debug] [Thread-1  ]: SQL status: BEGIN in 0.018 seconds
[0m19:25:15.064430 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.stg_fund_structures"
[0m19:25:15.064738 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.stg_cashflows"
[0m19:25:15.065030 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.stg_dates"
[0m19:25:15.065323 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.stg_benchmarks"
[0m19:25:15.065643 [debug] [Thread-4  ]: On model.bain_capital_analytics.stg_fund_structures: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_fund_structures"} */

  create view "bain_analytics"."public"."stg_fund_structures__dbt_tmp"
    
    
  as (
    select distinct
    fund_id,
    fund_name,
    fund_type,
    cast(vintage_year as integer) as vintage_year,
    cast(committed_capital as numeric(18,2)) as committed_capital,
    cast(management_fee_rate as numeric(8,4)) as management_fee_rate,
    cast(carry_rate as numeric(8,4)) as carry_rate,
    cast(hurdle_rate as numeric(8,4)) as hurdle_rate,
    cast(gp_commitment_pct as numeric(8,4)) as gp_commitment_pct,
    fund_currency,
    fund_status
from "bain_analytics"."public_raw"."raw_fund_structures"
  );
[0m19:25:15.065993 [debug] [Thread-2  ]: On model.bain_capital_analytics.stg_cashflows: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_cashflows"} */

  create view "bain_analytics"."public"."stg_cashflows__dbt_tmp"
    
    
  as (
    -- Anti-pattern: unnecessary DISTINCT
-- Anti-pattern: duplicated fiscal quarter logic
select distinct
    cashflow_id,
    fund_id,
    portfolio_id,
    cast(cashflow_date as date) as cashflow_date,
    cashflow_type,
    cast(amount as numeric(18,2)) as amount,
    currency,
    description,
    investor_id,
    -- Anti-pattern: duplicated fiscal quarter logic (same as stg_trades, stg_portfolios)
    case
        when extract(month from cast(cashflow_date as date)) between 1 and 3 then 'Q3'
        when extract(month from cast(cashflow_date as date)) between 4 and 6 then 'Q4'
        when extract(month from cast(cashflow_date as date)) between 7 and 9 then 'Q1'
        when extract(month from cast(cashflow_date as date)) between 10 and 12 then 'Q2'
    end as cashflow_fiscal_quarter,
    -- Anti-pattern: PostgreSQL-specific extract
    extract(year from cast(cashflow_date as date)) as cashflow_year
from "bain_analytics"."public_raw"."raw_cashflows"
  );
[0m19:25:15.066354 [debug] [Thread-3  ]: On model.bain_capital_analytics.stg_dates: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_dates"} */

  create view "bain_analytics"."public"."stg_dates__dbt_tmp"
    
    
  as (
    select
    cast(date_day as date) as date_day,
    cast(is_business_day as boolean) as is_business_day,
    cast(is_month_end as boolean) as is_month_end,
    cast(is_quarter_end as boolean) as is_quarter_end,
    cast(is_year_end as boolean) as is_year_end,
    fiscal_quarter,
    fiscal_year,
    -- Anti-pattern: PostgreSQL-specific date_trunc
    date_trunc('month', cast(date_day as date)) as month_start,
    date_trunc('quarter', cast(date_day as date)) as quarter_start,
    extract(month from cast(date_day as date)) as calendar_month,
    extract(year from cast(date_day as date)) as calendar_year
from "bain_analytics"."public_raw"."raw_dates"
  );
[0m19:25:15.066702 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_benchmarks: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_benchmarks"} */

  create view "bain_analytics"."public"."stg_benchmarks__dbt_tmp"
    
    
  as (
    select distinct
    benchmark_id,
    benchmark_name,
    cast(benchmark_date as date) as benchmark_date,
    cast(return_daily as numeric(18,8)) as return_daily,
    cast(return_mtd as numeric(18,8)) as return_mtd,
    cast(return_ytd as numeric(18,8)) as return_ytd,
    cast(benchmark_level as numeric(18,4)) as benchmark_level,
    -- Anti-pattern: duplicated fiscal quarter logic
    case
        when extract(month from cast(benchmark_date as date)) between 1 and 3 then 'Q3'
        when extract(month from cast(benchmark_date as date)) between 4 and 6 then 'Q4'
        when extract(month from cast(benchmark_date as date)) between 7 and 9 then 'Q1'
        when extract(month from cast(benchmark_date as date)) between 10 and 12 then 'Q2'
    end as benchmark_fiscal_quarter
from "bain_analytics"."public_raw"."raw_benchmarks"
  );
[0m19:25:15.071133 [debug] [Thread-3  ]: SQL status: CREATE VIEW in 0.004 seconds
[0m19:25:15.077604 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.stg_dates"
[0m19:25:15.077998 [debug] [Thread-2  ]: SQL status: CREATE VIEW in 0.011 seconds
[0m19:25:15.078309 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.011 seconds
[0m19:25:15.078587 [debug] [Thread-4  ]: SQL status: CREATE VIEW in 0.012 seconds
[0m19:25:15.078877 [debug] [Thread-3  ]: On model.bain_capital_analytics.stg_dates: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_dates"} */
alter table "bain_analytics"."public"."stg_dates" rename to "stg_dates__dbt_backup"
[0m19:25:15.082163 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.stg_cashflows"
[0m19:25:15.085159 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.stg_benchmarks"
[0m19:25:15.087993 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.stg_fund_structures"
[0m19:25:15.088355 [debug] [Thread-2  ]: On model.bain_capital_analytics.stg_cashflows: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_cashflows"} */
alter table "bain_analytics"."public"."stg_cashflows" rename to "stg_cashflows__dbt_backup"
[0m19:25:15.088678 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_benchmarks: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_benchmarks"} */
alter table "bain_analytics"."public"."stg_benchmarks" rename to "stg_benchmarks__dbt_backup"
[0m19:25:15.088979 [debug] [Thread-4  ]: On model.bain_capital_analytics.stg_fund_structures: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_fund_structures"} */
alter table "bain_analytics"."public"."stg_fund_structures" rename to "stg_fund_structures__dbt_backup"
[0m19:25:15.089635 [debug] [Thread-3  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m19:25:15.092934 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.stg_dates"
[0m19:25:15.093259 [debug] [Thread-4  ]: SQL status: ALTER TABLE in 0.004 seconds
[0m19:25:15.093552 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.004 seconds
[0m19:25:15.093824 [debug] [Thread-2  ]: SQL status: ALTER TABLE in 0.005 seconds
[0m19:25:15.094105 [debug] [Thread-3  ]: On model.bain_capital_analytics.stg_dates: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_dates"} */
alter table "bain_analytics"."public"."stg_dates__dbt_tmp" rename to "stg_dates"
[0m19:25:15.096762 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.stg_fund_structures"
[0m19:25:15.099331 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.stg_benchmarks"
[0m19:25:15.101925 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.stg_cashflows"
[0m19:25:15.102298 [debug] [Thread-4  ]: On model.bain_capital_analytics.stg_fund_structures: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_fund_structures"} */
alter table "bain_analytics"."public"."stg_fund_structures__dbt_tmp" rename to "stg_fund_structures"
[0m19:25:15.102626 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_benchmarks: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_benchmarks"} */
alter table "bain_analytics"."public"."stg_benchmarks__dbt_tmp" rename to "stg_benchmarks"
[0m19:25:15.102927 [debug] [Thread-2  ]: On model.bain_capital_analytics.stg_cashflows: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_cashflows"} */
alter table "bain_analytics"."public"."stg_cashflows__dbt_tmp" rename to "stg_cashflows"
[0m19:25:15.103749 [debug] [Thread-3  ]: SQL status: ALTER TABLE in 0.002 seconds
[0m19:25:15.111091 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.008 seconds
[0m19:25:15.111416 [debug] [Thread-2  ]: SQL status: ALTER TABLE in 0.008 seconds
[0m19:25:15.118515 [debug] [Thread-3  ]: On model.bain_capital_analytics.stg_dates: COMMIT
[0m19:25:15.118829 [debug] [Thread-4  ]: SQL status: ALTER TABLE in 0.016 seconds
[0m19:25:15.119846 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_benchmarks: COMMIT
[0m19:25:15.120805 [debug] [Thread-2  ]: On model.bain_capital_analytics.stg_cashflows: COMMIT
[0m19:25:15.121113 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.stg_dates"
[0m19:25:15.122074 [debug] [Thread-4  ]: On model.bain_capital_analytics.stg_fund_structures: COMMIT
[0m19:25:15.122382 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.stg_benchmarks"
[0m19:25:15.122680 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.stg_cashflows"
[0m19:25:15.122961 [debug] [Thread-3  ]: On model.bain_capital_analytics.stg_dates: COMMIT
[0m19:25:15.123258 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.stg_fund_structures"
[0m19:25:15.123644 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_benchmarks: COMMIT
[0m19:25:15.123940 [debug] [Thread-2  ]: On model.bain_capital_analytics.stg_cashflows: COMMIT
[0m19:25:15.124265 [debug] [Thread-4  ]: On model.bain_capital_analytics.stg_fund_structures: COMMIT
[0m19:25:15.125990 [debug] [Thread-3  ]: SQL status: COMMIT in 0.002 seconds
[0m19:25:15.131601 [debug] [Thread-3  ]: Applying DROP to: "bain_analytics"."public"."stg_dates__dbt_backup"
[0m19:25:15.131968 [debug] [Thread-2  ]: SQL status: COMMIT in 0.007 seconds
[0m19:25:15.132245 [debug] [Thread-1  ]: SQL status: COMMIT in 0.008 seconds
[0m19:25:15.135703 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.stg_dates"
[0m19:25:15.136000 [debug] [Thread-4  ]: SQL status: COMMIT in 0.011 seconds
[0m19:25:15.182205 [debug] [Thread-2  ]: Applying DROP to: "bain_analytics"."public"."stg_cashflows__dbt_backup"
[0m19:25:15.184806 [debug] [Thread-1  ]: Applying DROP to: "bain_analytics"."public"."stg_benchmarks__dbt_backup"
[0m19:25:15.185173 [debug] [Thread-3  ]: On model.bain_capital_analytics.stg_dates: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_dates"} */
drop view if exists "bain_analytics"."public"."stg_dates__dbt_backup" cascade
[0m19:25:15.187418 [debug] [Thread-4  ]: Applying DROP to: "bain_analytics"."public"."stg_fund_structures__dbt_backup"
[0m19:25:15.187952 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.stg_cashflows"
[0m19:25:15.188415 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.stg_benchmarks"
[0m19:25:15.189018 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.stg_fund_structures"
[0m19:25:15.189394 [debug] [Thread-2  ]: On model.bain_capital_analytics.stg_cashflows: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_cashflows"} */
drop view if exists "bain_analytics"."public"."stg_cashflows__dbt_backup" cascade
[0m19:25:15.189738 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_benchmarks: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_benchmarks"} */
drop view if exists "bain_analytics"."public"."stg_benchmarks__dbt_backup" cascade
[0m19:25:15.190057 [debug] [Thread-4  ]: On model.bain_capital_analytics.stg_fund_structures: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_fund_structures"} */
drop view if exists "bain_analytics"."public"."stg_fund_structures__dbt_backup" cascade
[0m19:25:15.194781 [debug] [Thread-3  ]: SQL status: DROP VIEW in 0.006 seconds
[0m19:25:15.197195 [debug] [Thread-3  ]: On model.bain_capital_analytics.stg_dates: Close
[0m19:25:15.197533 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.007 seconds
[0m19:25:15.198573 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_benchmarks: Close
[0m19:25:15.201554 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f5777163-bfb8-4ecd-8d00-9b8bf6f11360', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10af7c820>]}
[0m19:25:15.201887 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f5777163-bfb8-4ecd-8d00-9b8bf6f11360', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10af7ce20>]}
[0m19:25:15.202457 [info ] [Thread-1  ]: 1 of 54 OK created sql view model public.stg_benchmarks ........................ [[32mCREATE VIEW[0m in 0.23s]
[0m19:25:15.202962 [info ] [Thread-3  ]: 3 of 54 OK created sql view model public.stg_dates ............................. [[32mCREATE VIEW[0m in 0.23s]
[0m19:25:15.203442 [debug] [Thread-1  ]: Finished running node model.bain_capital_analytics.stg_benchmarks
[0m19:25:15.203855 [debug] [Thread-3  ]: Finished running node model.bain_capital_analytics.stg_dates
[0m19:25:15.204201 [debug] [Thread-1  ]: Began running node model.bain_capital_analytics.stg_instruments
[0m19:25:15.204631 [debug] [Thread-3  ]: Began running node model.bain_capital_analytics.stg_portfolios
[0m19:25:15.205180 [info ] [Thread-1  ]: 5 of 54 START sql view model public.stg_instruments ............................ [RUN]
[0m19:25:15.205659 [info ] [Thread-3  ]: 6 of 54 START sql view model public.stg_portfolios ............................. [RUN]
[0m19:25:15.206067 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.bain_capital_analytics.stg_benchmarks, now model.bain_capital_analytics.stg_instruments)
[0m19:25:15.206393 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly model.bain_capital_analytics.stg_dates, now model.bain_capital_analytics.stg_portfolios)
[0m19:25:15.206699 [debug] [Thread-1  ]: Began compiling node model.bain_capital_analytics.stg_instruments
[0m19:25:15.206992 [debug] [Thread-3  ]: Began compiling node model.bain_capital_analytics.stg_portfolios
[0m19:25:15.210194 [debug] [Thread-1  ]: Writing injected SQL for node "model.bain_capital_analytics.stg_instruments"
[0m19:25:15.212846 [debug] [Thread-3  ]: Writing injected SQL for node "model.bain_capital_analytics.stg_portfolios"
[0m19:25:15.213548 [debug] [Thread-3  ]: Began executing node model.bain_capital_analytics.stg_portfolios
[0m19:25:15.213866 [debug] [Thread-1  ]: Began executing node model.bain_capital_analytics.stg_instruments
[0m19:25:15.218373 [debug] [Thread-3  ]: Writing runtime sql for node "model.bain_capital_analytics.stg_portfolios"
[0m19:25:15.221453 [debug] [Thread-1  ]: Writing runtime sql for node "model.bain_capital_analytics.stg_instruments"
[0m19:25:15.222032 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.stg_portfolios"
[0m19:25:15.222337 [debug] [Thread-3  ]: On model.bain_capital_analytics.stg_portfolios: BEGIN
[0m19:25:15.222683 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.stg_instruments"
[0m19:25:15.222972 [debug] [Thread-3  ]: Opening a new connection, currently in state closed
[0m19:25:15.223267 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_instruments: BEGIN
[0m19:25:15.223676 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m19:25:15.235930 [debug] [Thread-3  ]: SQL status: BEGIN in 0.013 seconds
[0m19:25:15.236335 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.stg_portfolios"
[0m19:25:15.236703 [debug] [Thread-3  ]: On model.bain_capital_analytics.stg_portfolios: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_portfolios"} */

  create view "bain_analytics"."public"."stg_portfolios__dbt_tmp"
    
    
  as (
    -- Anti-pattern: unnecessary DISTINCT when source data is already unique
-- Anti-pattern: casting in every model instead of once upstream

select distinct
    cast(portfolio_id as varchar(10)) as portfolio_id,
    cast(portfolio_name as varchar(100)) as portfolio_name,
    cast(strategy as varchar(50)) as strategy,
    cast(inception_date as date) as inception_date,
    cast(fund_id as varchar(10)) as fund_id,
    cast(manager_name as varchar(100)) as manager_name,
    cast(is_active as boolean) as is_active,
    -- Anti-pattern: duplicated fiscal quarter logic (repeated in many models)
    case
        when extract(month from cast(inception_date as date)) between 1 and 3 then 'Q3'
        when extract(month from cast(inception_date as date)) between 4 and 6 then 'Q4'
        when extract(month from cast(inception_date as date)) between 7 and 9 then 'Q1'
        when extract(month from cast(inception_date as date)) between 10 and 12 then 'Q2'
    end as inception_fiscal_quarter
from "bain_analytics"."public_raw"."raw_portfolios"
where cast(is_active as boolean) = true
  );
[0m19:25:15.237299 [debug] [Thread-1  ]: SQL status: BEGIN in 0.014 seconds
[0m19:25:15.237650 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.stg_instruments"
[0m19:25:15.237999 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_instruments: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_instruments"} */

  create view "bain_analytics"."public"."stg_instruments__dbt_tmp"
    
    
  as (
    -- Anti-pattern: unnecessary DISTINCT
select distinct
    instrument_id,
    instrument_name,
    instrument_type,
    sector,
    currency,
    exchange,
    issuer,
    cast(maturity_date as date) as maturity_date,
    -- Anti-pattern: PostgreSQL-specific date subtraction
    case
        when maturity_date is not null
        then cast(maturity_date as date) - current_date
        else null
    end as days_to_maturity,
    case
        when instrument_type in ('equity', 'futures') then 'liquid'
        when instrument_type in ('corporate_bond', 'government_bond', 'sovereign_bond', 'leveraged_loan') then 'semi_liquid'
        when instrument_type in ('private_equity', 'venture_capital', 'real_estate', 'real_estate_debt', 'infrastructure') then 'illiquid'
        else 'other'
    end as liquidity_class
from "bain_analytics"."public_raw"."raw_instruments"
  );
[0m19:25:15.242494 [debug] [Thread-3  ]: SQL status: CREATE VIEW in 0.005 seconds
[0m19:25:15.242813 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.004 seconds
[0m19:25:15.246617 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.stg_portfolios"
[0m19:25:15.249677 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.stg_instruments"
[0m19:25:15.250012 [debug] [Thread-3  ]: On model.bain_capital_analytics.stg_portfolios: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_portfolios"} */
alter table "bain_analytics"."public"."stg_portfolios" rename to "stg_portfolios__dbt_backup"
[0m19:25:15.250322 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_instruments: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_instruments"} */
alter table "bain_analytics"."public"."stg_instruments" rename to "stg_instruments__dbt_backup"
[0m19:25:15.252015 [debug] [Thread-3  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m19:25:15.252411 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.002 seconds
[0m19:25:15.255107 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.stg_portfolios"
[0m19:25:15.257723 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.stg_instruments"
[0m19:25:15.258050 [debug] [Thread-3  ]: On model.bain_capital_analytics.stg_portfolios: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_portfolios"} */
alter table "bain_analytics"."public"."stg_portfolios__dbt_tmp" rename to "stg_portfolios"
[0m19:25:15.258360 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_instruments: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_instruments"} */
alter table "bain_analytics"."public"."stg_instruments__dbt_tmp" rename to "stg_instruments"
[0m19:25:15.259718 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m19:25:15.260069 [debug] [Thread-3  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m19:25:15.261204 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_instruments: COMMIT
[0m19:25:15.262209 [debug] [Thread-3  ]: On model.bain_capital_analytics.stg_portfolios: COMMIT
[0m19:25:15.262525 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.stg_instruments"
[0m19:25:15.262832 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.stg_portfolios"
[0m19:25:15.263133 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_instruments: COMMIT
[0m19:25:15.263419 [debug] [Thread-3  ]: On model.bain_capital_analytics.stg_portfolios: COMMIT
[0m19:25:15.265197 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m19:25:15.265480 [debug] [Thread-3  ]: SQL status: COMMIT in 0.002 seconds
[0m19:25:15.269213 [debug] [Thread-1  ]: Applying DROP to: "bain_analytics"."public"."stg_instruments__dbt_backup"
[0m19:25:15.271397 [debug] [Thread-3  ]: Applying DROP to: "bain_analytics"."public"."stg_portfolios__dbt_backup"
[0m19:25:15.271891 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.stg_instruments"
[0m19:25:15.272343 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.stg_portfolios"
[0m19:25:15.272650 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_instruments: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_instruments"} */
drop view if exists "bain_analytics"."public"."stg_instruments__dbt_backup" cascade
[0m19:25:15.272951 [debug] [Thread-3  ]: On model.bain_capital_analytics.stg_portfolios: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_portfolios"} */
drop view if exists "bain_analytics"."public"."stg_portfolios__dbt_backup" cascade
[0m19:25:15.277730 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.004 seconds
[0m19:25:15.278861 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_instruments: Close
[0m19:25:15.279424 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f5777163-bfb8-4ecd-8d00-9b8bf6f11360', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10814e940>]}
[0m19:25:15.280021 [info ] [Thread-1  ]: 5 of 54 OK created sql view model public.stg_instruments ....................... [[32mCREATE VIEW[0m in 0.07s]
[0m19:25:15.280495 [debug] [Thread-1  ]: Finished running node model.bain_capital_analytics.stg_instruments
[0m19:25:15.280828 [debug] [Thread-1  ]: Began running node model.bain_capital_analytics.stg_positions
[0m19:25:15.281326 [info ] [Thread-1  ]: 7 of 54 START sql view model public.stg_positions .............................. [RUN]
[0m19:25:15.281804 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.bain_capital_analytics.stg_instruments, now model.bain_capital_analytics.stg_positions)
[0m19:25:15.282122 [debug] [Thread-1  ]: Began compiling node model.bain_capital_analytics.stg_positions
[0m19:25:15.285321 [debug] [Thread-1  ]: Writing injected SQL for node "model.bain_capital_analytics.stg_positions"
[0m19:25:15.286049 [debug] [Thread-1  ]: Began executing node model.bain_capital_analytics.stg_positions
[0m19:25:15.289452 [debug] [Thread-1  ]: Writing runtime sql for node "model.bain_capital_analytics.stg_positions"
[0m19:25:15.290000 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.stg_positions"
[0m19:25:15.290294 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_positions: BEGIN
[0m19:25:15.290581 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m19:25:15.303236 [debug] [Thread-1  ]: SQL status: BEGIN in 0.013 seconds
[0m19:25:15.303536 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.stg_positions"
[0m19:25:15.303856 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_positions: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_positions"} */

  create view "bain_analytics"."public"."stg_positions__dbt_tmp"
    
    
  as (
    -- Anti-pattern: unnecessary DISTINCT
-- Anti-pattern: no filtering or partitioning strategy

select distinct
    position_id,
    portfolio_id,
    instrument_id,
    cast(position_date as date) as position_date,
    cast(quantity as numeric(18,4)) as quantity,
    cast(market_value as numeric(18,2)) as market_value,
    cast(cost_basis as numeric(18,2)) as cost_basis,
    currency,
    -- Anti-pattern: computed column that could be done downstream
    cast(market_value as numeric(18,2)) - cast(cost_basis as numeric(18,2)) as unrealized_gain_loss,
    case
        when cast(cost_basis as numeric(18,2)) != 0
        then (cast(market_value as numeric(18,2)) - cast(cost_basis as numeric(18,2))) / abs(cast(cost_basis as numeric(18,2)))
        else 0
    end as unrealized_return_pct
from "bain_analytics"."public_raw"."raw_positions"
  );
[0m19:25:15.309437 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.005 seconds
[0m19:25:15.312553 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.stg_positions"
[0m19:25:15.312857 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_positions: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_positions"} */
alter table "bain_analytics"."public"."stg_positions" rename to "stg_positions__dbt_backup"
[0m19:25:15.313963 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m19:25:15.317458 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.stg_positions"
[0m19:25:15.317791 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_positions: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_positions"} */
alter table "bain_analytics"."public"."stg_positions__dbt_tmp" rename to "stg_positions"
[0m19:25:15.319007 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m19:25:15.320000 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_positions: COMMIT
[0m19:25:15.320296 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.stg_positions"
[0m19:25:15.320570 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_positions: COMMIT
[0m19:25:15.321950 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m19:25:15.324125 [debug] [Thread-1  ]: Applying DROP to: "bain_analytics"."public"."stg_positions__dbt_backup"
[0m19:25:15.324692 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.stg_positions"
[0m19:25:15.324991 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_positions: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_positions"} */
drop view if exists "bain_analytics"."public"."stg_positions__dbt_backup" cascade
[0m19:25:15.327750 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.002 seconds
[0m19:25:15.328832 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_positions: Close
[0m19:25:15.329356 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f5777163-bfb8-4ecd-8d00-9b8bf6f11360', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11005cdc0>]}
[0m19:25:15.329916 [info ] [Thread-1  ]: 7 of 54 OK created sql view model public.stg_positions ......................... [[32mCREATE VIEW[0m in 0.05s]
[0m19:25:15.330394 [debug] [Thread-1  ]: Finished running node model.bain_capital_analytics.stg_positions
[0m19:25:15.330727 [debug] [Thread-1  ]: Began running node model.bain_capital_analytics.stg_valuations
[0m19:25:15.331204 [info ] [Thread-1  ]: 8 of 54 START sql view model public.stg_valuations ............................. [RUN]
[0m19:25:15.331678 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.bain_capital_analytics.stg_positions, now model.bain_capital_analytics.stg_valuations)
[0m19:25:15.331999 [debug] [Thread-1  ]: Began compiling node model.bain_capital_analytics.stg_valuations
[0m19:25:15.334887 [debug] [Thread-1  ]: Writing injected SQL for node "model.bain_capital_analytics.stg_valuations"
[0m19:25:15.335547 [debug] [Thread-1  ]: Began executing node model.bain_capital_analytics.stg_valuations
[0m19:25:15.338808 [debug] [Thread-1  ]: Writing runtime sql for node "model.bain_capital_analytics.stg_valuations"
[0m19:25:15.339330 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.stg_valuations"
[0m19:25:15.339617 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_valuations: BEGIN
[0m19:25:15.339889 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m19:25:15.350666 [debug] [Thread-1  ]: SQL status: BEGIN in 0.011 seconds
[0m19:25:15.350981 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.stg_valuations"
[0m19:25:15.351304 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_valuations: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_valuations"} */

  create view "bain_analytics"."public"."stg_valuations__dbt_tmp"
    
    
  as (
    -- Anti-pattern: unnecessary DISTINCT
select distinct
    valuation_id,
    portfolio_id,
    cast(valuation_date as date) as valuation_date,
    cast(gross_asset_value as numeric(18,2)) as gross_asset_value,
    cast(net_asset_value as numeric(18,2)) as net_asset_value,
    cast(total_liabilities as numeric(18,2)) as total_liabilities,
    cast(unrealized_pnl as numeric(18,2)) as unrealized_pnl,
    cast(realized_pnl as numeric(18,2)) as realized_pnl,
    valuation_method,
    -- Anti-pattern: duplicated fiscal quarter logic
    case
        when extract(month from cast(valuation_date as date)) between 1 and 3 then 'Q3'
        when extract(month from cast(valuation_date as date)) between 4 and 6 then 'Q4'
        when extract(month from cast(valuation_date as date)) between 7 and 9 then 'Q1'
        when extract(month from cast(valuation_date as date)) between 10 and 12 then 'Q2'
    end as valuation_fiscal_quarter
from "bain_analytics"."public_raw"."raw_valuations"
  );
[0m19:25:15.358062 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.006 seconds
[0m19:25:15.361179 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.stg_valuations"
[0m19:25:15.361488 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_valuations: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_valuations"} */
alter table "bain_analytics"."public"."stg_valuations" rename to "stg_valuations__dbt_backup"
[0m19:25:15.362664 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m19:25:15.365243 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.stg_valuations"
[0m19:25:15.365541 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_valuations: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_valuations"} */
alter table "bain_analytics"."public"."stg_valuations__dbt_tmp" rename to "stg_valuations"
[0m19:25:15.366565 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m19:25:15.367626 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_valuations: COMMIT
[0m19:25:15.367937 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.stg_valuations"
[0m19:25:15.368213 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_valuations: COMMIT
[0m19:25:15.369740 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m19:25:15.372986 [debug] [Thread-1  ]: Applying DROP to: "bain_analytics"."public"."stg_valuations__dbt_backup"
[0m19:25:15.373451 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.stg_valuations"
[0m19:25:15.373739 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_valuations: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_valuations"} */
drop view if exists "bain_analytics"."public"."stg_valuations__dbt_backup" cascade
[0m19:25:16.193496 [debug] [Thread-2  ]: Postgres adapter: Postgres error: deadlock detected
DETAIL:  Process 4429 waits for AccessExclusiveLock on object 16919 of class 2618 of database 16384; blocked by process 4428.
Process 4428 waits for AccessExclusiveLock on object 16879 of class 2618 of database 16384; blocked by process 4429.
HINT:  See server log for query details.

[0m19:25:16.195334 [debug] [Thread-2  ]: Postgres adapter: Error running SQL: macro drop_relation
[0m19:25:16.195874 [debug] [Thread-2  ]: Postgres adapter: Rolling back transaction.
[0m19:25:16.196387 [debug] [Thread-2  ]: On model.bain_capital_analytics.stg_cashflows: Close
[0m19:25:16.203271 [debug] [Thread-4  ]: SQL status: DROP VIEW in 1.013 seconds
[0m19:25:16.205621 [debug] [Thread-4  ]: On model.bain_capital_analytics.stg_fund_structures: Close
[0m19:25:16.206545 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f5777163-bfb8-4ecd-8d00-9b8bf6f11360', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11006bfa0>]}
[0m19:25:16.211067 [info ] [Thread-4  ]: 4 of 54 OK created sql view model public.stg_fund_structures ................... [[32mCREATE VIEW[0m in 1.23s]
[0m19:25:16.211807 [debug] [Thread-4  ]: Finished running node model.bain_capital_analytics.stg_fund_structures
[0m19:25:16.212352 [debug] [Thread-4  ]: Began running node test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_date.d5c8f88f3e
[0m19:25:16.213410 [info ] [Thread-4  ]: 9 of 54 START test not_null_stg_benchmarks_benchmark_date ...................... [RUN]
[0m19:25:16.216386 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly model.bain_capital_analytics.stg_fund_structures, now test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_date.d5c8f88f3e)
[0m19:25:16.216865 [debug] [Thread-4  ]: Began compiling node test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_date.d5c8f88f3e
[0m19:25:16.229176 [debug] [Thread-4  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_date.d5c8f88f3e"
[0m19:25:16.234340 [debug] [Thread-4  ]: Began executing node test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_date.d5c8f88f3e
[0m19:25:16.250268 [debug] [Thread-4  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_date.d5c8f88f3e"
[0m19:25:16.255001 [debug] [Thread-4  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_date.d5c8f88f3e"
[0m19:25:16.260579 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_date.d5c8f88f3e: BEGIN
[0m19:25:16.262551 [debug] [Thread-4  ]: Opening a new connection, currently in state closed
[0m19:25:16.268211 [debug] [Thread-2  ]: Database Error in model stg_cashflows (models/staging/stg_cashflows.sql)
  deadlock detected
  DETAIL:  Process 4429 waits for AccessExclusiveLock on object 16919 of class 2618 of database 16384; blocked by process 4428.
  Process 4428 waits for AccessExclusiveLock on object 16879 of class 2618 of database 16384; blocked by process 4429.
  HINT:  See server log for query details.
  compiled code at target/run/bain_capital_analytics/models/staging/stg_cashflows.sql
[0m19:25:16.268779 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f5777163-bfb8-4ecd-8d00-9b8bf6f11360', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110011b80>]}
[0m19:25:16.269380 [error] [Thread-2  ]: 2 of 54 ERROR creating sql view model public.stg_cashflows ..................... [[31mERROR[0m in 1.30s]
[0m19:25:16.269880 [debug] [Thread-2  ]: Finished running node model.bain_capital_analytics.stg_cashflows
[0m19:25:16.270242 [debug] [Thread-2  ]: Began running node test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_id.ec87e4ee58
[0m19:25:16.270672 [debug] [Thread-7  ]: Marking all children of 'model.bain_capital_analytics.stg_cashflows' to be skipped because of status 'error'.  Reason: Database Error in model stg_cashflows (models/staging/stg_cashflows.sql)
  deadlock detected
  DETAIL:  Process 4429 waits for AccessExclusiveLock on object 16919 of class 2618 of database 16384; blocked by process 4428.
  Process 4428 waits for AccessExclusiveLock on object 16879 of class 2618 of database 16384; blocked by process 4429.
  HINT:  See server log for query details.
  compiled code at target/run/bain_capital_analytics/models/staging/stg_cashflows.sql.
[0m19:25:16.271009 [info ] [Thread-2  ]: 10 of 54 START test not_null_stg_benchmarks_benchmark_id ....................... [RUN]
[0m19:25:16.271639 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly model.bain_capital_analytics.stg_cashflows, now test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_id.ec87e4ee58)
[0m19:25:16.271965 [debug] [Thread-2  ]: Began compiling node test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_id.ec87e4ee58
[0m19:25:16.275763 [debug] [Thread-2  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_id.ec87e4ee58"
[0m19:25:16.276321 [debug] [Thread-2  ]: Began executing node test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_id.ec87e4ee58
[0m19:25:16.278564 [debug] [Thread-2  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_id.ec87e4ee58"
[0m19:25:16.278891 [debug] [Thread-4  ]: SQL status: BEGIN in 0.016 seconds
[0m19:25:16.279247 [debug] [Thread-4  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_date.d5c8f88f3e"
[0m19:25:16.279560 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_date.d5c8f88f3e: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_date.d5c8f88f3e"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select benchmark_date
from "bain_analytics"."public"."stg_benchmarks"
where benchmark_date is null



  
  
      
    ) dbt_internal_test
[0m19:25:16.279978 [debug] [Thread-2  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_id.ec87e4ee58"
[0m19:25:16.280278 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_id.ec87e4ee58: BEGIN
[0m19:25:16.280558 [debug] [Thread-2  ]: Opening a new connection, currently in state closed
[0m19:25:16.282362 [debug] [Thread-4  ]: SQL status: SELECT 1 in 0.002 seconds
[0m19:25:16.285010 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_date.d5c8f88f3e: ROLLBACK
[0m19:25:16.285660 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_date.d5c8f88f3e: Close
[0m19:25:16.286129 [info ] [Thread-4  ]: 9 of 54 PASS not_null_stg_benchmarks_benchmark_date ............................ [[32mPASS[0m in 0.07s]
[0m19:25:16.286571 [debug] [Thread-4  ]: Finished running node test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_date.d5c8f88f3e
[0m19:25:16.286895 [debug] [Thread-4  ]: Began running node test.bain_capital_analytics.not_null_stg_dates_date_day.f3ec4da188
[0m19:25:16.287240 [info ] [Thread-4  ]: 11 of 54 START test not_null_stg_dates_date_day ................................ [RUN]
[0m19:25:16.287575 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_date.d5c8f88f3e, now test.bain_capital_analytics.not_null_stg_dates_date_day.f3ec4da188)
[0m19:25:16.287870 [debug] [Thread-4  ]: Began compiling node test.bain_capital_analytics.not_null_stg_dates_date_day.f3ec4da188
[0m19:25:16.292539 [debug] [Thread-4  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_stg_dates_date_day.f3ec4da188"
[0m19:25:16.293040 [debug] [Thread-4  ]: Began executing node test.bain_capital_analytics.not_null_stg_dates_date_day.f3ec4da188
[0m19:25:16.295220 [debug] [Thread-4  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_stg_dates_date_day.f3ec4da188"
[0m19:25:16.295540 [debug] [Thread-2  ]: SQL status: BEGIN in 0.015 seconds
[0m19:25:16.295897 [debug] [Thread-2  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_id.ec87e4ee58"
[0m19:25:16.296211 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_id.ec87e4ee58: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_id.ec87e4ee58"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select benchmark_id
from "bain_analytics"."public"."stg_benchmarks"
where benchmark_id is null



  
  
      
    ) dbt_internal_test
[0m19:25:16.296610 [debug] [Thread-4  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_dates_date_day.f3ec4da188"
[0m19:25:16.296906 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_stg_dates_date_day.f3ec4da188: BEGIN
[0m19:25:16.297181 [debug] [Thread-4  ]: Opening a new connection, currently in state closed
[0m19:25:16.298850 [debug] [Thread-2  ]: SQL status: SELECT 1 in 0.002 seconds
[0m19:25:16.299941 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_id.ec87e4ee58: ROLLBACK
[0m19:25:16.300659 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_id.ec87e4ee58: Close
[0m19:25:16.301105 [info ] [Thread-2  ]: 10 of 54 PASS not_null_stg_benchmarks_benchmark_id ............................. [[32mPASS[0m in 0.03s]
[0m19:25:16.301548 [debug] [Thread-2  ]: Finished running node test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_id.ec87e4ee58
[0m19:25:16.301862 [debug] [Thread-2  ]: Began running node test.bain_capital_analytics.unique_stg_dates_date_day.e062be8e28
[0m19:25:16.302197 [info ] [Thread-2  ]: 12 of 54 START test unique_stg_dates_date_day .................................. [RUN]
[0m19:25:16.302526 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_id.ec87e4ee58, now test.bain_capital_analytics.unique_stg_dates_date_day.e062be8e28)
[0m19:25:16.302823 [debug] [Thread-2  ]: Began compiling node test.bain_capital_analytics.unique_stg_dates_date_day.e062be8e28
[0m19:25:16.308025 [debug] [Thread-2  ]: Writing injected SQL for node "test.bain_capital_analytics.unique_stg_dates_date_day.e062be8e28"
[0m19:25:16.308518 [debug] [Thread-2  ]: Began executing node test.bain_capital_analytics.unique_stg_dates_date_day.e062be8e28
[0m19:25:16.310773 [debug] [Thread-2  ]: Writing runtime sql for node "test.bain_capital_analytics.unique_stg_dates_date_day.e062be8e28"
[0m19:25:16.311098 [debug] [Thread-4  ]: SQL status: BEGIN in 0.014 seconds
[0m19:25:16.311472 [debug] [Thread-4  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_dates_date_day.f3ec4da188"
[0m19:25:16.311795 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_stg_dates_date_day.f3ec4da188: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_stg_dates_date_day.f3ec4da188"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select date_day
from "bain_analytics"."public"."stg_dates"
where date_day is null



  
  
      
    ) dbt_internal_test
[0m19:25:16.312219 [debug] [Thread-2  ]: Using postgres connection "test.bain_capital_analytics.unique_stg_dates_date_day.e062be8e28"
[0m19:25:16.312526 [debug] [Thread-2  ]: On test.bain_capital_analytics.unique_stg_dates_date_day.e062be8e28: BEGIN
[0m19:25:16.312804 [debug] [Thread-2  ]: Opening a new connection, currently in state closed
[0m19:25:16.313735 [debug] [Thread-4  ]: SQL status: SELECT 1 in 0.002 seconds
[0m19:25:16.314761 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_stg_dates_date_day.f3ec4da188: ROLLBACK
[0m19:25:16.315442 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_stg_dates_date_day.f3ec4da188: Close
[0m19:25:16.315878 [info ] [Thread-4  ]: 11 of 54 PASS not_null_stg_dates_date_day ...................................... [[32mPASS[0m in 0.03s]
[0m19:25:16.316316 [debug] [Thread-4  ]: Finished running node test.bain_capital_analytics.not_null_stg_dates_date_day.f3ec4da188
[0m19:25:16.316634 [debug] [Thread-4  ]: Began running node test.bain_capital_analytics.not_null_stg_instruments_instrument_id.18bdfd2ebe
[0m19:25:16.316978 [info ] [Thread-4  ]: 13 of 54 START test not_null_stg_instruments_instrument_id ..................... [RUN]
[0m19:25:16.317306 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.not_null_stg_dates_date_day.f3ec4da188, now test.bain_capital_analytics.not_null_stg_instruments_instrument_id.18bdfd2ebe)
[0m19:25:16.317607 [debug] [Thread-4  ]: Began compiling node test.bain_capital_analytics.not_null_stg_instruments_instrument_id.18bdfd2ebe
[0m19:25:16.320886 [debug] [Thread-4  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_stg_instruments_instrument_id.18bdfd2ebe"
[0m19:25:16.321343 [debug] [Thread-4  ]: Began executing node test.bain_capital_analytics.not_null_stg_instruments_instrument_id.18bdfd2ebe
[0m19:25:16.323533 [debug] [Thread-4  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_stg_instruments_instrument_id.18bdfd2ebe"
[0m19:25:16.323846 [debug] [Thread-2  ]: SQL status: BEGIN in 0.011 seconds
[0m19:25:16.324201 [debug] [Thread-2  ]: Using postgres connection "test.bain_capital_analytics.unique_stg_dates_date_day.e062be8e28"
[0m19:25:16.324600 [debug] [Thread-2  ]: On test.bain_capital_analytics.unique_stg_dates_date_day.e062be8e28: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.unique_stg_dates_date_day.e062be8e28"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

select
    date_day as unique_field,
    count(*) as n_records

from "bain_analytics"."public"."stg_dates"
where date_day is not null
group by date_day
having count(*) > 1



  
  
      
    ) dbt_internal_test
[0m19:25:16.325021 [debug] [Thread-4  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_instruments_instrument_id.18bdfd2ebe"
[0m19:25:16.325316 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_stg_instruments_instrument_id.18bdfd2ebe: BEGIN
[0m19:25:16.325585 [debug] [Thread-4  ]: Opening a new connection, currently in state closed
[0m19:25:16.326908 [debug] [Thread-2  ]: SQL status: SELECT 1 in 0.002 seconds
[0m19:25:16.328024 [debug] [Thread-2  ]: On test.bain_capital_analytics.unique_stg_dates_date_day.e062be8e28: ROLLBACK
[0m19:25:16.328705 [debug] [Thread-2  ]: On test.bain_capital_analytics.unique_stg_dates_date_day.e062be8e28: Close
[0m19:25:16.329178 [info ] [Thread-2  ]: 12 of 54 PASS unique_stg_dates_date_day ........................................ [[32mPASS[0m in 0.03s]
[0m19:25:16.329627 [debug] [Thread-2  ]: Finished running node test.bain_capital_analytics.unique_stg_dates_date_day.e062be8e28
[0m19:25:16.329955 [debug] [Thread-2  ]: Began running node test.bain_capital_analytics.unique_stg_instruments_instrument_id.0e70adcd34
[0m19:25:16.330309 [info ] [Thread-2  ]: 14 of 54 START test unique_stg_instruments_instrument_id ....................... [RUN]
[0m19:25:16.330710 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.unique_stg_dates_date_day.e062be8e28, now test.bain_capital_analytics.unique_stg_instruments_instrument_id.0e70adcd34)
[0m19:25:16.331047 [debug] [Thread-2  ]: Began compiling node test.bain_capital_analytics.unique_stg_instruments_instrument_id.0e70adcd34
[0m19:25:16.335690 [debug] [Thread-2  ]: Writing injected SQL for node "test.bain_capital_analytics.unique_stg_instruments_instrument_id.0e70adcd34"
[0m19:25:16.336222 [debug] [Thread-2  ]: Began executing node test.bain_capital_analytics.unique_stg_instruments_instrument_id.0e70adcd34
[0m19:25:16.338395 [debug] [Thread-2  ]: Writing runtime sql for node "test.bain_capital_analytics.unique_stg_instruments_instrument_id.0e70adcd34"
[0m19:25:16.338724 [debug] [Thread-4  ]: SQL status: BEGIN in 0.013 seconds
[0m19:25:16.339105 [debug] [Thread-4  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_instruments_instrument_id.18bdfd2ebe"
[0m19:25:16.339458 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_stg_instruments_instrument_id.18bdfd2ebe: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_stg_instruments_instrument_id.18bdfd2ebe"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select instrument_id
from "bain_analytics"."public"."stg_instruments"
where instrument_id is null



  
  
      
    ) dbt_internal_test
[0m19:25:16.339849 [debug] [Thread-2  ]: Using postgres connection "test.bain_capital_analytics.unique_stg_instruments_instrument_id.0e70adcd34"
[0m19:25:16.340205 [debug] [Thread-2  ]: On test.bain_capital_analytics.unique_stg_instruments_instrument_id.0e70adcd34: BEGIN
[0m19:25:16.340496 [debug] [Thread-2  ]: Opening a new connection, currently in state closed
[0m19:25:16.341515 [debug] [Thread-4  ]: SQL status: SELECT 1 in 0.002 seconds
[0m19:25:16.342814 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_stg_instruments_instrument_id.18bdfd2ebe: ROLLBACK
[0m19:25:16.343429 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_stg_instruments_instrument_id.18bdfd2ebe: Close
[0m19:25:16.343886 [info ] [Thread-4  ]: 13 of 54 PASS not_null_stg_instruments_instrument_id ........................... [[32mPASS[0m in 0.03s]
[0m19:25:16.344339 [debug] [Thread-4  ]: Finished running node test.bain_capital_analytics.not_null_stg_instruments_instrument_id.18bdfd2ebe
[0m19:25:16.344666 [debug] [Thread-4  ]: Began running node test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c
[0m19:25:16.345016 [info ] [Thread-4  ]: 15 of 54 START test not_null_stg_positions_portfolio_id ........................ [RUN]
[0m19:25:16.345362 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.not_null_stg_instruments_instrument_id.18bdfd2ebe, now test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c)
[0m19:25:16.345670 [debug] [Thread-4  ]: Began compiling node test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c
[0m19:25:16.349369 [debug] [Thread-4  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c"
[0m19:25:16.349927 [debug] [Thread-4  ]: Began executing node test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c
[0m19:25:16.352202 [debug] [Thread-4  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c"
[0m19:25:16.352528 [debug] [Thread-2  ]: SQL status: BEGIN in 0.012 seconds
[0m19:25:16.352881 [debug] [Thread-2  ]: Using postgres connection "test.bain_capital_analytics.unique_stg_instruments_instrument_id.0e70adcd34"
[0m19:25:16.353209 [debug] [Thread-2  ]: On test.bain_capital_analytics.unique_stg_instruments_instrument_id.0e70adcd34: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.unique_stg_instruments_instrument_id.0e70adcd34"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

select
    instrument_id as unique_field,
    count(*) as n_records

from "bain_analytics"."public"."stg_instruments"
where instrument_id is not null
group by instrument_id
having count(*) > 1



  
  
      
    ) dbt_internal_test
[0m19:25:16.353613 [debug] [Thread-4  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c"
[0m19:25:16.353903 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c: BEGIN
[0m19:25:16.354182 [debug] [Thread-4  ]: Opening a new connection, currently in state closed
[0m19:25:16.355822 [debug] [Thread-2  ]: SQL status: SELECT 1 in 0.002 seconds
[0m19:25:16.356909 [debug] [Thread-2  ]: On test.bain_capital_analytics.unique_stg_instruments_instrument_id.0e70adcd34: ROLLBACK
[0m19:25:16.357527 [debug] [Thread-2  ]: On test.bain_capital_analytics.unique_stg_instruments_instrument_id.0e70adcd34: Close
[0m19:25:16.358082 [info ] [Thread-2  ]: 14 of 54 PASS unique_stg_instruments_instrument_id ............................. [[32mPASS[0m in 0.03s]
[0m19:25:16.358522 [debug] [Thread-2  ]: Finished running node test.bain_capital_analytics.unique_stg_instruments_instrument_id.0e70adcd34
[0m19:25:16.358840 [debug] [Thread-2  ]: Began running node test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1
[0m19:25:16.359187 [info ] [Thread-2  ]: 16 of 54 START test not_null_stg_positions_position_id ......................... [RUN]
[0m19:25:16.359523 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.unique_stg_instruments_instrument_id.0e70adcd34, now test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1)
[0m19:25:16.359818 [debug] [Thread-2  ]: Began compiling node test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1
[0m19:25:16.363196 [debug] [Thread-2  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1"
[0m19:25:16.363666 [debug] [Thread-2  ]: Began executing node test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1
[0m19:25:16.366735 [debug] [Thread-2  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1"
[0m19:25:16.367057 [debug] [Thread-4  ]: SQL status: BEGIN in 0.013 seconds
[0m19:25:16.367420 [debug] [Thread-4  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c"
[0m19:25:16.367739 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select portfolio_id
from "bain_analytics"."public"."stg_positions"
where portfolio_id is null



  
  
      
    ) dbt_internal_test
[0m19:25:16.368139 [debug] [Thread-2  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1"
[0m19:25:16.368426 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1: BEGIN
[0m19:25:16.368700 [debug] [Thread-2  ]: Opening a new connection, currently in state closed
[0m19:25:16.370217 [debug] [Thread-4  ]: SQL status: SELECT 1 in 0.002 seconds
[0m19:25:16.371353 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c: ROLLBACK
[0m19:25:16.371988 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c: Close
[0m19:25:16.372460 [info ] [Thread-4  ]: 15 of 54 PASS not_null_stg_positions_portfolio_id .............................. [[32mPASS[0m in 0.03s]
[0m19:25:16.372914 [debug] [Thread-4  ]: Finished running node test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c
[0m19:25:16.373241 [debug] [Thread-4  ]: Began running node test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f
[0m19:25:16.373587 [info ] [Thread-4  ]: 17 of 54 START test unique_stg_positions_position_id ........................... [RUN]
[0m19:25:16.373934 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c, now test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f)
[0m19:25:16.374235 [debug] [Thread-4  ]: Began compiling node test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f
[0m19:25:16.377646 [debug] [Thread-4  ]: Writing injected SQL for node "test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f"
[0m19:25:16.378181 [debug] [Thread-4  ]: Began executing node test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f
[0m19:25:16.380394 [debug] [Thread-4  ]: Writing runtime sql for node "test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f"
[0m19:25:16.380723 [debug] [Thread-2  ]: SQL status: BEGIN in 0.012 seconds
[0m19:25:16.381079 [debug] [Thread-2  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1"
[0m19:25:16.381382 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select position_id
from "bain_analytics"."public"."stg_positions"
where position_id is null



  
  
      
    ) dbt_internal_test
[0m19:25:16.381793 [debug] [Thread-4  ]: Using postgres connection "test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f"
[0m19:25:16.382100 [debug] [Thread-4  ]: On test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f: BEGIN
[0m19:25:16.382381 [debug] [Thread-4  ]: Opening a new connection, currently in state closed
[0m19:25:16.383669 [debug] [Thread-2  ]: SQL status: SELECT 1 in 0.002 seconds
[0m19:25:16.384755 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1: ROLLBACK
[0m19:25:16.385375 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1: Close
[0m19:25:16.385815 [info ] [Thread-2  ]: 16 of 54 PASS not_null_stg_positions_position_id ............................... [[32mPASS[0m in 0.03s]
[0m19:25:16.386253 [debug] [Thread-2  ]: Finished running node test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1
[0m19:25:16.386570 [debug] [Thread-2  ]: Began running node test.bain_capital_analytics.not_null_stg_fund_structures_fund_id.a284274f31
[0m19:25:16.386900 [info ] [Thread-2  ]: 18 of 54 START test not_null_stg_fund_structures_fund_id ....................... [RUN]
[0m19:25:16.387234 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1, now test.bain_capital_analytics.not_null_stg_fund_structures_fund_id.a284274f31)
[0m19:25:16.387532 [debug] [Thread-2  ]: Began compiling node test.bain_capital_analytics.not_null_stg_fund_structures_fund_id.a284274f31
[0m19:25:16.390899 [debug] [Thread-2  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_stg_fund_structures_fund_id.a284274f31"
[0m19:25:16.391484 [debug] [Thread-2  ]: Began executing node test.bain_capital_analytics.not_null_stg_fund_structures_fund_id.a284274f31
[0m19:25:16.391796 [debug] [Thread-4  ]: SQL status: BEGIN in 0.009 seconds
[0m19:25:16.394037 [debug] [Thread-2  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_stg_fund_structures_fund_id.a284274f31"
[0m19:25:16.394353 [debug] [Thread-4  ]: Using postgres connection "test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f"
[0m19:25:16.394746 [debug] [Thread-4  ]: On test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

select
    position_id as unique_field,
    count(*) as n_records

from "bain_analytics"."public"."stg_positions"
where position_id is not null
group by position_id
having count(*) > 1



  
  
      
    ) dbt_internal_test
[0m19:25:16.395171 [debug] [Thread-2  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_fund_structures_fund_id.a284274f31"
[0m19:25:16.395461 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_stg_fund_structures_fund_id.a284274f31: BEGIN
[0m19:25:16.395740 [debug] [Thread-2  ]: Opening a new connection, currently in state closed
[0m19:25:16.397261 [debug] [Thread-4  ]: SQL status: SELECT 1 in 0.002 seconds
[0m19:25:16.398369 [debug] [Thread-4  ]: On test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f: ROLLBACK
[0m19:25:16.398935 [debug] [Thread-4  ]: On test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f: Close
[0m19:25:16.399365 [info ] [Thread-4  ]: 17 of 54 PASS unique_stg_positions_position_id ................................. [[32mPASS[0m in 0.03s]
[0m19:25:16.399800 [debug] [Thread-4  ]: Finished running node test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f
[0m19:25:16.400115 [debug] [Thread-4  ]: Began running node test.bain_capital_analytics.unique_stg_fund_structures_fund_id.bb9fec42ab
[0m19:25:16.400457 [info ] [Thread-4  ]: 19 of 54 START test unique_stg_fund_structures_fund_id ......................... [RUN]
[0m19:25:16.400789 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f, now test.bain_capital_analytics.unique_stg_fund_structures_fund_id.bb9fec42ab)
[0m19:25:16.401086 [debug] [Thread-4  ]: Began compiling node test.bain_capital_analytics.unique_stg_fund_structures_fund_id.bb9fec42ab
[0m19:25:16.404387 [debug] [Thread-4  ]: Writing injected SQL for node "test.bain_capital_analytics.unique_stg_fund_structures_fund_id.bb9fec42ab"
[0m19:25:16.404878 [debug] [Thread-4  ]: Began executing node test.bain_capital_analytics.unique_stg_fund_structures_fund_id.bb9fec42ab
[0m19:25:16.408062 [debug] [Thread-4  ]: Writing runtime sql for node "test.bain_capital_analytics.unique_stg_fund_structures_fund_id.bb9fec42ab"
[0m19:25:16.408384 [debug] [Thread-2  ]: SQL status: BEGIN in 0.013 seconds
[0m19:25:16.408740 [debug] [Thread-2  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_fund_structures_fund_id.a284274f31"
[0m19:25:16.409058 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_stg_fund_structures_fund_id.a284274f31: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_stg_fund_structures_fund_id.a284274f31"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select fund_id
from "bain_analytics"."public"."stg_fund_structures"
where fund_id is null



  
  
      
    ) dbt_internal_test
[0m19:25:16.409459 [debug] [Thread-4  ]: Using postgres connection "test.bain_capital_analytics.unique_stg_fund_structures_fund_id.bb9fec42ab"
[0m19:25:16.409757 [debug] [Thread-4  ]: On test.bain_capital_analytics.unique_stg_fund_structures_fund_id.bb9fec42ab: BEGIN
[0m19:25:16.410041 [debug] [Thread-4  ]: Opening a new connection, currently in state closed
[0m19:25:16.410939 [debug] [Thread-2  ]: SQL status: SELECT 1 in 0.002 seconds
[0m19:25:16.411980 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_stg_fund_structures_fund_id.a284274f31: ROLLBACK
[0m19:25:16.412512 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_stg_fund_structures_fund_id.a284274f31: Close
[0m19:25:16.412952 [info ] [Thread-2  ]: 18 of 54 PASS not_null_stg_fund_structures_fund_id ............................. [[32mPASS[0m in 0.03s]
[0m19:25:16.413399 [debug] [Thread-2  ]: Finished running node test.bain_capital_analytics.not_null_stg_fund_structures_fund_id.a284274f31
[0m19:25:16.413722 [debug] [Thread-2  ]: Began running node test.bain_capital_analytics.not_null_stg_cashflows_cashflow_id.4176024898
[0m19:25:16.414097 [info ] [Thread-2  ]: 20 of 54 SKIP test not_null_stg_cashflows_cashflow_id .......................... [[33mSKIP[0m]
[0m19:25:16.414426 [debug] [Thread-2  ]: Finished running node test.bain_capital_analytics.not_null_stg_cashflows_cashflow_id.4176024898
[0m19:25:16.414738 [debug] [Thread-2  ]: Began running node test.bain_capital_analytics.not_null_stg_cashflows_fund_id.7ff8a45dde
[0m19:25:16.415020 [debug] [Thread-7  ]: Marking all children of 'test.bain_capital_analytics.not_null_stg_cashflows_cashflow_id.4176024898' to be skipped because of status 'skipped'. 
[0m19:25:16.415347 [info ] [Thread-2  ]: 21 of 54 SKIP test not_null_stg_cashflows_fund_id .............................. [[33mSKIP[0m]
[0m19:25:16.415762 [debug] [Thread-2  ]: Finished running node test.bain_capital_analytics.not_null_stg_cashflows_fund_id.7ff8a45dde
[0m19:25:16.416067 [debug] [Thread-2  ]: Began running node test.bain_capital_analytics.not_null_stg_cashflows_portfolio_id.cbd1d93e57
[0m19:25:16.416338 [debug] [Thread-7  ]: Marking all children of 'test.bain_capital_analytics.not_null_stg_cashflows_fund_id.7ff8a45dde' to be skipped because of status 'skipped'. 
[0m19:25:16.416656 [info ] [Thread-2  ]: 22 of 54 SKIP test not_null_stg_cashflows_portfolio_id ......................... [[33mSKIP[0m]
[0m19:25:16.417060 [debug] [Thread-2  ]: Finished running node test.bain_capital_analytics.not_null_stg_cashflows_portfolio_id.cbd1d93e57
[0m19:25:16.417388 [debug] [Thread-2  ]: Began running node test.bain_capital_analytics.unique_stg_cashflows_cashflow_id.359e4f4704
[0m19:25:16.417652 [debug] [Thread-7  ]: Marking all children of 'test.bain_capital_analytics.not_null_stg_cashflows_portfolio_id.cbd1d93e57' to be skipped because of status 'skipped'. 
[0m19:25:16.417965 [info ] [Thread-2  ]: 23 of 54 SKIP test unique_stg_cashflows_cashflow_id ............................ [[33mSKIP[0m]
[0m19:25:16.418303 [debug] [Thread-4  ]: SQL status: BEGIN in 0.008 seconds
[0m19:25:16.418689 [debug] [Thread-2  ]: Finished running node test.bain_capital_analytics.unique_stg_cashflows_cashflow_id.359e4f4704
[0m19:25:16.418992 [debug] [Thread-4  ]: Using postgres connection "test.bain_capital_analytics.unique_stg_fund_structures_fund_id.bb9fec42ab"
[0m19:25:16.419324 [debug] [Thread-2  ]: Began running node model.bain_capital_analytics.int_benchmark_returns
[0m19:25:16.419624 [debug] [Thread-7  ]: Marking all children of 'test.bain_capital_analytics.unique_stg_cashflows_cashflow_id.359e4f4704' to be skipped because of status 'skipped'. 
[0m19:25:16.419938 [debug] [Thread-4  ]: On test.bain_capital_analytics.unique_stg_fund_structures_fund_id.bb9fec42ab: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.unique_stg_fund_structures_fund_id.bb9fec42ab"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

select
    fund_id as unique_field,
    count(*) as n_records

from "bain_analytics"."public"."stg_fund_structures"
where fund_id is not null
group by fund_id
having count(*) > 1



  
  
      
    ) dbt_internal_test
[0m19:25:16.420362 [info ] [Thread-2  ]: 24 of 54 START sql view model public.int_benchmark_returns ..................... [RUN]
[0m19:25:16.420825 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.not_null_stg_fund_structures_fund_id.a284274f31, now model.bain_capital_analytics.int_benchmark_returns)
[0m19:25:16.421125 [debug] [Thread-2  ]: Began compiling node model.bain_capital_analytics.int_benchmark_returns
[0m19:25:16.424180 [debug] [Thread-2  ]: Writing injected SQL for node "model.bain_capital_analytics.int_benchmark_returns"
[0m19:25:16.424588 [debug] [Thread-4  ]: SQL status: SELECT 1 in 0.004 seconds
[0m19:25:16.425659 [debug] [Thread-4  ]: On test.bain_capital_analytics.unique_stg_fund_structures_fund_id.bb9fec42ab: ROLLBACK
[0m19:25:16.426106 [debug] [Thread-2  ]: Began executing node model.bain_capital_analytics.int_benchmark_returns
[0m19:25:16.426405 [debug] [Thread-4  ]: On test.bain_capital_analytics.unique_stg_fund_structures_fund_id.bb9fec42ab: Close
[0m19:25:16.429597 [debug] [Thread-2  ]: Writing runtime sql for node "model.bain_capital_analytics.int_benchmark_returns"
[0m19:25:16.430058 [info ] [Thread-4  ]: 19 of 54 PASS unique_stg_fund_structures_fund_id ............................... [[32mPASS[0m in 0.03s]
[0m19:25:16.430551 [debug] [Thread-4  ]: Finished running node test.bain_capital_analytics.unique_stg_fund_structures_fund_id.bb9fec42ab
[0m19:25:16.430981 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.int_benchmark_returns"
[0m19:25:16.431270 [debug] [Thread-2  ]: On model.bain_capital_analytics.int_benchmark_returns: BEGIN
[0m19:25:16.431545 [debug] [Thread-2  ]: Opening a new connection, currently in state closed
[0m19:25:16.440358 [debug] [Thread-2  ]: SQL status: BEGIN in 0.009 seconds
[0m19:25:16.440660 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.int_benchmark_returns"
[0m19:25:16.441048 [debug] [Thread-2  ]: On model.bain_capital_analytics.int_benchmark_returns: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.int_benchmark_returns"} */

  create view "bain_analytics"."public"."int_benchmark_returns__dbt_tmp"
    
    
  as (
    -- Pipeline C: Benchmark returns with rolling calculations
-- Anti-pattern: heavy window functions that could be pre-computed

with benchmark_base as (
    select
        b.benchmark_id,
        b.benchmark_name,
        b.benchmark_date,
        b.return_daily,
        b.return_mtd,
        b.return_ytd,
        b.benchmark_level,
        b.benchmark_fiscal_quarter,
        d.fiscal_year,
        d.is_quarter_end,
        d.is_year_end
    from "bain_analytics"."public"."stg_benchmarks" b
    inner join "bain_analytics"."public"."stg_dates" d
        on b.benchmark_date = d.date_day
),

-- Anti-pattern: compute many overlapping windows
benchmark_with_rolling as (
    select
        bb.*,
        -- rolling 3-month return
        exp(sum(ln(1 + bb.return_mtd)) over (
            partition by bb.benchmark_id
            order by bb.benchmark_date
            rows between 2 preceding and current row
        )) - 1 as rolling_3m_return,
        -- rolling 6-month return
        exp(sum(ln(1 + bb.return_mtd)) over (
            partition by bb.benchmark_id
            order by bb.benchmark_date
            rows between 5 preceding and current row
        )) - 1 as rolling_6m_return,
        -- rolling 12-month return
        exp(sum(ln(1 + bb.return_mtd)) over (
            partition by bb.benchmark_id
            order by bb.benchmark_date
            rows between 11 preceding and current row
        )) - 1 as rolling_12m_return,
        -- Anti-pattern: volatility via window (expensive)
        stddev(bb.return_mtd) over (
            partition by bb.benchmark_id
            order by bb.benchmark_date
            rows between 11 preceding and current row
        ) as rolling_12m_volatility,
        avg(bb.return_mtd) over (
            partition by bb.benchmark_id
            order by bb.benchmark_date
            rows between 11 preceding and current row
        ) as rolling_12m_avg_return,
        lag(bb.benchmark_level) over (
            partition by bb.benchmark_id
            order by bb.benchmark_date
        ) as prev_benchmark_level
    from benchmark_base bb
)

select * from benchmark_with_rolling
  );
[0m19:25:16.446644 [debug] [Thread-2  ]: SQL status: CREATE VIEW in 0.005 seconds
[0m19:25:16.449268 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.int_benchmark_returns"
[0m19:25:16.449585 [debug] [Thread-2  ]: On model.bain_capital_analytics.int_benchmark_returns: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.int_benchmark_returns"} */
alter table "bain_analytics"."public"."int_benchmark_returns__dbt_tmp" rename to "int_benchmark_returns"
[0m19:25:16.450712 [debug] [Thread-2  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m19:25:16.451641 [debug] [Thread-2  ]: On model.bain_capital_analytics.int_benchmark_returns: COMMIT
[0m19:25:16.451936 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.int_benchmark_returns"
[0m19:25:16.452213 [debug] [Thread-2  ]: On model.bain_capital_analytics.int_benchmark_returns: COMMIT
[0m19:25:16.453300 [debug] [Thread-2  ]: SQL status: COMMIT in 0.001 seconds
[0m19:25:16.455422 [debug] [Thread-2  ]: Applying DROP to: "bain_analytics"."public"."int_benchmark_returns__dbt_backup"
[0m19:25:16.455921 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.int_benchmark_returns"
[0m19:25:16.456214 [debug] [Thread-2  ]: On model.bain_capital_analytics.int_benchmark_returns: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.int_benchmark_returns"} */
drop view if exists "bain_analytics"."public"."int_benchmark_returns__dbt_backup" cascade
[0m19:25:16.456863 [debug] [Thread-2  ]: SQL status: DROP VIEW in 0.000 seconds
[0m19:25:16.457977 [debug] [Thread-2  ]: On model.bain_capital_analytics.int_benchmark_returns: Close
[0m19:25:16.458455 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f5777163-bfb8-4ecd-8d00-9b8bf6f11360', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110078eb0>]}
[0m19:25:16.458985 [info ] [Thread-2  ]: 24 of 54 OK created sql view model public.int_benchmark_returns ................ [[32mCREATE VIEW[0m in 0.04s]
[0m19:25:16.459437 [debug] [Thread-2  ]: Finished running node model.bain_capital_analytics.int_benchmark_returns
[0m19:25:16.459871 [debug] [Thread-4  ]: Began running node test.bain_capital_analytics.not_null_int_benchmark_returns_benchmark_id.fa96f53b44
[0m19:25:16.460190 [info ] [Thread-4  ]: 25 of 54 START test not_null_int_benchmark_returns_benchmark_id ................ [RUN]
[0m19:25:16.460534 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.unique_stg_fund_structures_fund_id.bb9fec42ab, now test.bain_capital_analytics.not_null_int_benchmark_returns_benchmark_id.fa96f53b44)
[0m19:25:16.460842 [debug] [Thread-4  ]: Began compiling node test.bain_capital_analytics.not_null_int_benchmark_returns_benchmark_id.fa96f53b44
[0m19:25:16.465411 [debug] [Thread-4  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_int_benchmark_returns_benchmark_id.fa96f53b44"
[0m19:25:16.465916 [debug] [Thread-4  ]: Began executing node test.bain_capital_analytics.not_null_int_benchmark_returns_benchmark_id.fa96f53b44
[0m19:25:16.468166 [debug] [Thread-4  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_int_benchmark_returns_benchmark_id.fa96f53b44"
[0m19:25:16.468667 [debug] [Thread-4  ]: Using postgres connection "test.bain_capital_analytics.not_null_int_benchmark_returns_benchmark_id.fa96f53b44"
[0m19:25:16.468963 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_int_benchmark_returns_benchmark_id.fa96f53b44: BEGIN
[0m19:25:16.469252 [debug] [Thread-4  ]: Opening a new connection, currently in state closed
[0m19:25:16.478324 [debug] [Thread-4  ]: SQL status: BEGIN in 0.009 seconds
[0m19:25:16.478628 [debug] [Thread-4  ]: Using postgres connection "test.bain_capital_analytics.not_null_int_benchmark_returns_benchmark_id.fa96f53b44"
[0m19:25:16.478932 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_int_benchmark_returns_benchmark_id.fa96f53b44: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_int_benchmark_returns_benchmark_id.fa96f53b44"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select benchmark_id
from "bain_analytics"."public"."int_benchmark_returns"
where benchmark_id is null



  
  
      
    ) dbt_internal_test
[0m19:25:16.483260 [debug] [Thread-4  ]: SQL status: SELECT 1 in 0.004 seconds
[0m19:25:16.484405 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_int_benchmark_returns_benchmark_id.fa96f53b44: ROLLBACK
[0m19:25:16.485049 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_int_benchmark_returns_benchmark_id.fa96f53b44: Close
[0m19:25:16.485505 [info ] [Thread-4  ]: 25 of 54 PASS not_null_int_benchmark_returns_benchmark_id ...................... [[32mPASS[0m in 0.02s]
[0m19:25:16.485951 [debug] [Thread-4  ]: Finished running node test.bain_capital_analytics.not_null_int_benchmark_returns_benchmark_id.fa96f53b44
[0m19:25:17.206791 [debug] [Thread-1  ]: Postgres adapter: Postgres error: deadlock detected
DETAIL:  Process 4434 waits for AccessExclusiveLock on object 16894 of class 2618 of database 16384; blocked by process 4432.
Process 4432 waits for AccessExclusiveLock on object 16899 of class 2618 of database 16384; blocked by process 4434.
HINT:  See server log for query details.

[0m19:25:17.208476 [debug] [Thread-1  ]: Postgres adapter: Error running SQL: macro drop_relation
[0m19:25:17.209077 [debug] [Thread-1  ]: Postgres adapter: Rolling back transaction.
[0m19:25:17.209743 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_valuations: Close
[0m19:25:17.217997 [debug] [Thread-3  ]: SQL status: DROP VIEW in 1.945 seconds
[0m19:25:17.229366 [debug] [Thread-1  ]: Database Error in model stg_valuations (models/staging/stg_valuations.sql)
  deadlock detected
  DETAIL:  Process 4434 waits for AccessExclusiveLock on object 16894 of class 2618 of database 16384; blocked by process 4432.
  Process 4432 waits for AccessExclusiveLock on object 16899 of class 2618 of database 16384; blocked by process 4434.
  HINT:  See server log for query details.
  compiled code at target/run/bain_capital_analytics/models/staging/stg_valuations.sql
[0m19:25:17.231149 [debug] [Thread-3  ]: On model.bain_capital_analytics.stg_portfolios: Close
[0m19:25:17.231725 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f5777163-bfb8-4ecd-8d00-9b8bf6f11360', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11005cdc0>]}
[0m19:25:17.232416 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f5777163-bfb8-4ecd-8d00-9b8bf6f11360', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11003e2b0>]}
[0m19:25:17.233075 [info ] [Thread-3  ]: 6 of 54 OK created sql view model public.stg_portfolios ........................ [[32mCREATE VIEW[0m in 2.03s]
[0m19:25:17.233576 [error] [Thread-1  ]: 8 of 54 ERROR creating sql view model public.stg_valuations .................... [[31mERROR[0m in 1.90s]
[0m19:25:17.234055 [debug] [Thread-3  ]: Finished running node model.bain_capital_analytics.stg_portfolios
[0m19:25:17.234485 [debug] [Thread-1  ]: Finished running node model.bain_capital_analytics.stg_valuations
[0m19:25:17.235039 [debug] [Thread-7  ]: Marking all children of 'model.bain_capital_analytics.stg_valuations' to be skipped because of status 'error'.  Reason: Database Error in model stg_valuations (models/staging/stg_valuations.sql)
  deadlock detected
  DETAIL:  Process 4434 waits for AccessExclusiveLock on object 16894 of class 2618 of database 16384; blocked by process 4432.
  Process 4432 waits for AccessExclusiveLock on object 16899 of class 2618 of database 16384; blocked by process 4434.
  HINT:  See server log for query details.
  compiled code at target/run/bain_capital_analytics/models/staging/stg_valuations.sql.
[0m19:25:17.235730 [debug] [Thread-2  ]: Began running node test.bain_capital_analytics.not_null_stg_portfolios_fund_id.70b04d82bd
[0m19:25:17.236148 [info ] [Thread-2  ]: 26 of 54 START test not_null_stg_portfolios_fund_id ............................ [RUN]
[0m19:25:17.236513 [debug] [Thread-4  ]: Began running node test.bain_capital_analytics.not_null_stg_portfolios_portfolio_id.7126a480ec
[0m19:25:17.236923 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly model.bain_capital_analytics.int_benchmark_returns, now test.bain_capital_analytics.not_null_stg_portfolios_fund_id.70b04d82bd)
[0m19:25:17.237282 [debug] [Thread-3  ]: Began running node test.bain_capital_analytics.relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_.2823f12709
[0m19:25:17.237614 [debug] [Thread-1  ]: Began running node test.bain_capital_analytics.unique_stg_portfolios_portfolio_id.aa125b6658
[0m19:25:17.237915 [info ] [Thread-4  ]: 27 of 54 START test not_null_stg_portfolios_portfolio_id ....................... [RUN]
[0m19:25:17.238249 [debug] [Thread-2  ]: Began compiling node test.bain_capital_analytics.not_null_stg_portfolios_fund_id.70b04d82bd
[0m19:25:17.238568 [info ] [Thread-3  ]: 28 of 54 START test relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_  [RUN]
[0m19:25:17.238894 [info ] [Thread-1  ]: 29 of 54 START test unique_stg_portfolios_portfolio_id ......................... [RUN]
[0m19:25:17.239250 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.not_null_int_benchmark_returns_benchmark_id.fa96f53b44, now test.bain_capital_analytics.not_null_stg_portfolios_portfolio_id.7126a480ec)
[0m19:25:17.243966 [debug] [Thread-2  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_stg_portfolios_fund_id.70b04d82bd"
[0m19:25:17.244367 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly model.bain_capital_analytics.stg_portfolios, now test.bain_capital_analytics.relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_.2823f12709)
[0m19:25:17.244705 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.bain_capital_analytics.stg_valuations, now test.bain_capital_analytics.unique_stg_portfolios_portfolio_id.aa125b6658)
[0m19:25:17.245020 [debug] [Thread-4  ]: Began compiling node test.bain_capital_analytics.not_null_stg_portfolios_portfolio_id.7126a480ec
[0m19:25:17.245419 [debug] [Thread-3  ]: Began compiling node test.bain_capital_analytics.relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_.2823f12709
[0m19:25:17.245729 [debug] [Thread-1  ]: Began compiling node test.bain_capital_analytics.unique_stg_portfolios_portfolio_id.aa125b6658
[0m19:25:17.249296 [debug] [Thread-4  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_stg_portfolios_portfolio_id.7126a480ec"
[0m19:25:17.255924 [debug] [Thread-2  ]: Began executing node test.bain_capital_analytics.not_null_stg_portfolios_fund_id.70b04d82bd
[0m19:25:17.256730 [debug] [Thread-3  ]: Writing injected SQL for node "test.bain_capital_analytics.relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_.2823f12709"
[0m19:25:17.260127 [debug] [Thread-1  ]: Writing injected SQL for node "test.bain_capital_analytics.unique_stg_portfolios_portfolio_id.aa125b6658"
[0m19:25:17.263869 [debug] [Thread-2  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_stg_portfolios_fund_id.70b04d82bd"
[0m19:25:17.264406 [debug] [Thread-4  ]: Began executing node test.bain_capital_analytics.not_null_stg_portfolios_portfolio_id.7126a480ec
[0m19:25:17.266814 [debug] [Thread-4  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_stg_portfolios_portfolio_id.7126a480ec"
[0m19:25:17.267242 [debug] [Thread-3  ]: Began executing node test.bain_capital_analytics.relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_.2823f12709
[0m19:25:17.269759 [debug] [Thread-3  ]: Writing runtime sql for node "test.bain_capital_analytics.relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_.2823f12709"
[0m19:25:17.270340 [debug] [Thread-2  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_portfolios_fund_id.70b04d82bd"
[0m19:25:17.270668 [debug] [Thread-1  ]: Began executing node test.bain_capital_analytics.unique_stg_portfolios_portfolio_id.aa125b6658
[0m19:25:17.270998 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_stg_portfolios_fund_id.70b04d82bd: BEGIN
[0m19:25:17.271354 [debug] [Thread-4  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_portfolios_portfolio_id.7126a480ec"
[0m19:25:17.273639 [debug] [Thread-1  ]: Writing runtime sql for node "test.bain_capital_analytics.unique_stg_portfolios_portfolio_id.aa125b6658"
[0m19:25:17.274014 [debug] [Thread-3  ]: Using postgres connection "test.bain_capital_analytics.relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_.2823f12709"
[0m19:25:17.274328 [debug] [Thread-2  ]: Opening a new connection, currently in state closed
[0m19:25:17.274681 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_stg_portfolios_portfolio_id.7126a480ec: BEGIN
[0m19:25:17.275066 [debug] [Thread-3  ]: On test.bain_capital_analytics.relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_.2823f12709: BEGIN
[0m19:25:17.275510 [debug] [Thread-4  ]: Opening a new connection, currently in state closed
[0m19:25:17.275846 [debug] [Thread-1  ]: Using postgres connection "test.bain_capital_analytics.unique_stg_portfolios_portfolio_id.aa125b6658"
[0m19:25:17.276131 [debug] [Thread-3  ]: Opening a new connection, currently in state closed
[0m19:25:17.276496 [debug] [Thread-1  ]: On test.bain_capital_analytics.unique_stg_portfolios_portfolio_id.aa125b6658: BEGIN
[0m19:25:17.276901 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m19:25:17.292325 [debug] [Thread-4  ]: SQL status: BEGIN in 0.017 seconds
[0m19:25:17.292646 [debug] [Thread-4  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_portfolios_portfolio_id.7126a480ec"
[0m19:25:17.292961 [debug] [Thread-1  ]: SQL status: BEGIN in 0.016 seconds
[0m19:25:17.293249 [debug] [Thread-2  ]: SQL status: BEGIN in 0.019 seconds
[0m19:25:17.293522 [debug] [Thread-3  ]: SQL status: BEGIN in 0.017 seconds
[0m19:25:17.293806 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_stg_portfolios_portfolio_id.7126a480ec: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_stg_portfolios_portfolio_id.7126a480ec"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select portfolio_id
from "bain_analytics"."public"."stg_portfolios"
where portfolio_id is null



  
  
      
    ) dbt_internal_test
[0m19:25:17.294106 [debug] [Thread-1  ]: Using postgres connection "test.bain_capital_analytics.unique_stg_portfolios_portfolio_id.aa125b6658"
[0m19:25:17.294395 [debug] [Thread-2  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_portfolios_fund_id.70b04d82bd"
[0m19:25:17.294674 [debug] [Thread-3  ]: Using postgres connection "test.bain_capital_analytics.relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_.2823f12709"
[0m19:25:17.295023 [debug] [Thread-1  ]: On test.bain_capital_analytics.unique_stg_portfolios_portfolio_id.aa125b6658: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.unique_stg_portfolios_portfolio_id.aa125b6658"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

select
    portfolio_id as unique_field,
    count(*) as n_records

from "bain_analytics"."public"."stg_portfolios"
where portfolio_id is not null
group by portfolio_id
having count(*) > 1



  
  
      
    ) dbt_internal_test
[0m19:25:17.295347 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_stg_portfolios_fund_id.70b04d82bd: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_stg_portfolios_fund_id.70b04d82bd"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select fund_id
from "bain_analytics"."public"."stg_portfolios"
where fund_id is null



  
  
      
    ) dbt_internal_test
[0m19:25:17.295679 [debug] [Thread-3  ]: On test.bain_capital_analytics.relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_.2823f12709: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_.2823f12709"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

with child as (
    select portfolio_id as from_field
    from "bain_analytics"."public"."stg_positions"
    where portfolio_id is not null
),

parent as (
    select portfolio_id as to_field
    from "bain_analytics"."public"."stg_portfolios"
)

select
    from_field

from child
left join parent
    on child.from_field = parent.to_field

where parent.to_field is null



  
  
      
    ) dbt_internal_test
[0m19:25:17.297761 [debug] [Thread-4  ]: SQL status: SELECT 1 in 0.003 seconds
[0m19:25:17.298919 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_stg_portfolios_portfolio_id.7126a480ec: ROLLBACK
[0m19:25:17.299266 [debug] [Thread-1  ]: SQL status: SELECT 1 in 0.003 seconds
[0m19:25:17.299610 [debug] [Thread-2  ]: SQL status: SELECT 1 in 0.004 seconds
[0m19:25:17.300729 [debug] [Thread-1  ]: On test.bain_capital_analytics.unique_stg_portfolios_portfolio_id.aa125b6658: ROLLBACK
[0m19:25:17.301082 [debug] [Thread-3  ]: SQL status: SELECT 1 in 0.005 seconds
[0m19:25:17.301366 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_stg_portfolios_portfolio_id.7126a480ec: Close
[0m19:25:17.302390 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_stg_portfolios_fund_id.70b04d82bd: ROLLBACK
[0m19:25:17.303458 [debug] [Thread-3  ]: On test.bain_capital_analytics.relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_.2823f12709: ROLLBACK
[0m19:25:17.303767 [debug] [Thread-1  ]: On test.bain_capital_analytics.unique_stg_portfolios_portfolio_id.aa125b6658: Close
[0m19:25:17.304225 [info ] [Thread-4  ]: 27 of 54 PASS not_null_stg_portfolios_portfolio_id ............................. [[32mPASS[0m in 0.06s]
[0m19:25:17.304730 [info ] [Thread-1  ]: 29 of 54 PASS unique_stg_portfolios_portfolio_id ............................... [[32mPASS[0m in 0.06s]
[0m19:25:17.305034 [debug] [Thread-3  ]: On test.bain_capital_analytics.relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_.2823f12709: Close
[0m19:25:17.305432 [debug] [Thread-4  ]: Finished running node test.bain_capital_analytics.not_null_stg_portfolios_portfolio_id.7126a480ec
[0m19:25:17.305696 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_stg_portfolios_fund_id.70b04d82bd: Close
[0m19:25:17.306096 [debug] [Thread-1  ]: Finished running node test.bain_capital_analytics.unique_stg_portfolios_portfolio_id.aa125b6658
[0m19:25:17.306527 [info ] [Thread-3  ]: 28 of 54 PASS relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_  [[32mPASS[0m in 0.06s]
[0m19:25:17.306861 [debug] [Thread-4  ]: Began running node test.bain_capital_analytics.not_null_stg_valuations_portfolio_id.d5af3e5188
[0m19:25:17.307390 [info ] [Thread-2  ]: 26 of 54 PASS not_null_stg_portfolios_fund_id .................................. [[32mPASS[0m in 0.07s]
[0m19:25:17.307790 [debug] [Thread-1  ]: Began running node test.bain_capital_analytics.not_null_stg_valuations_valuation_id.88ca70781d
[0m19:25:17.308276 [debug] [Thread-3  ]: Finished running node test.bain_capital_analytics.relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_.2823f12709
[0m19:25:17.308619 [info ] [Thread-4  ]: 30 of 54 SKIP test not_null_stg_valuations_portfolio_id ........................ [[33mSKIP[0m]
[0m19:25:17.309056 [debug] [Thread-2  ]: Finished running node test.bain_capital_analytics.not_null_stg_portfolios_fund_id.70b04d82bd
[0m19:25:17.309397 [info ] [Thread-1  ]: 31 of 54 SKIP test not_null_stg_valuations_valuation_id ........................ [[33mSKIP[0m]
[0m19:25:17.309731 [debug] [Thread-3  ]: Began running node test.bain_capital_analytics.unique_stg_valuations_valuation_id.fce7eb13b5
[0m19:25:17.310101 [debug] [Thread-4  ]: Finished running node test.bain_capital_analytics.not_null_stg_valuations_portfolio_id.d5af3e5188
[0m19:25:17.310595 [debug] [Thread-1  ]: Finished running node test.bain_capital_analytics.not_null_stg_valuations_valuation_id.88ca70781d
[0m19:25:17.310906 [debug] [Thread-2  ]: Began running node model.bain_capital_analytics.int_cashflow_enriched
[0m19:25:17.311231 [info ] [Thread-3  ]: 32 of 54 SKIP test unique_stg_valuations_valuation_id .......................... [[33mSKIP[0m]
[0m19:25:17.311565 [debug] [Thread-4  ]: Began running node model.bain_capital_analytics.int_portfolio_attribution
[0m19:25:17.311840 [debug] [Thread-7  ]: Marking all children of 'test.bain_capital_analytics.not_null_stg_valuations_portfolio_id.d5af3e5188' to be skipped because of status 'skipped'. 
[0m19:25:17.312186 [info ] [Thread-2  ]: 33 of 54 SKIP relation public.int_cashflow_enriched ............................ [[33mSKIP[0m]
[0m19:25:17.312513 [debug] [Thread-3  ]: Finished running node test.bain_capital_analytics.unique_stg_valuations_valuation_id.fce7eb13b5
[0m19:25:17.312914 [info ] [Thread-4  ]: 34 of 54 START sql view model public.int_portfolio_attribution ................. [RUN]
[0m19:25:17.313253 [debug] [Thread-7  ]: Marking all children of 'test.bain_capital_analytics.not_null_stg_valuations_valuation_id.88ca70781d' to be skipped because of status 'skipped'. 
[0m19:25:17.313572 [debug] [Thread-2  ]: Finished running node model.bain_capital_analytics.int_cashflow_enriched
[0m19:25:17.313943 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.not_null_stg_portfolios_portfolio_id.7126a480ec, now model.bain_capital_analytics.int_portfolio_attribution)
[0m19:25:17.314263 [debug] [Thread-7  ]: Marking all children of 'test.bain_capital_analytics.unique_stg_valuations_valuation_id.fce7eb13b5' to be skipped because of status 'skipped'. 
[0m19:25:17.314592 [debug] [Thread-4  ]: Began compiling node model.bain_capital_analytics.int_portfolio_attribution
[0m19:25:17.314912 [debug] [Thread-7  ]: Marking all children of 'model.bain_capital_analytics.int_cashflow_enriched' to be skipped because of status 'skipped'. 
[0m19:25:17.318500 [debug] [Thread-4  ]: Writing injected SQL for node "model.bain_capital_analytics.int_portfolio_attribution"
[0m19:25:17.318825 [debug] [Thread-1  ]: Began running node model.bain_capital_analytics.int_fund_nav
[0m19:25:17.319152 [debug] [Thread-3  ]: Began running node model.bain_capital_analytics.int_irr_calculations
[0m19:25:17.319528 [debug] [Thread-2  ]: Began running node model.bain_capital_analytics.int_valuation_enriched
[0m19:25:17.319990 [info ] [Thread-1  ]: 35 of 54 SKIP relation public.int_fund_nav ..................................... [[33mSKIP[0m]
[0m19:25:17.320338 [info ] [Thread-3  ]: 36 of 54 SKIP relation public.int_irr_calculations ............................. [[33mSKIP[0m]
[0m19:25:17.320698 [info ] [Thread-2  ]: 37 of 54 SKIP relation public.int_valuation_enriched ........................... [[33mSKIP[0m]
[0m19:25:17.321068 [debug] [Thread-1  ]: Finished running node model.bain_capital_analytics.int_fund_nav
[0m19:25:17.321391 [debug] [Thread-3  ]: Finished running node model.bain_capital_analytics.int_irr_calculations
[0m19:25:17.321687 [debug] [Thread-4  ]: Began executing node model.bain_capital_analytics.int_portfolio_attribution
[0m19:25:17.321986 [debug] [Thread-2  ]: Finished running node model.bain_capital_analytics.int_valuation_enriched
[0m19:25:17.322293 [debug] [Thread-1  ]: Began running node test.bain_capital_analytics.not_null_int_cashflow_enriched_cashflow_id.8460e9066d
[0m19:25:17.322564 [debug] [Thread-7  ]: Marking all children of 'model.bain_capital_analytics.int_fund_nav' to be skipped because of status 'skipped'. 
[0m19:25:17.322885 [debug] [Thread-3  ]: Began running node test.bain_capital_analytics.unique_int_cashflow_enriched_cashflow_id.6944893c17
[0m19:25:17.326194 [debug] [Thread-4  ]: Writing runtime sql for node "model.bain_capital_analytics.int_portfolio_attribution"
[0m19:25:17.326583 [info ] [Thread-1  ]: 38 of 54 SKIP test not_null_int_cashflow_enriched_cashflow_id .................. [[33mSKIP[0m]
[0m19:25:17.326942 [debug] [Thread-7  ]: Marking all children of 'model.bain_capital_analytics.int_irr_calculations' to be skipped because of status 'skipped'. 
[0m19:25:17.327330 [info ] [Thread-3  ]: 39 of 54 SKIP test unique_int_cashflow_enriched_cashflow_id .................... [[33mSKIP[0m]
[0m19:25:17.327649 [debug] [Thread-2  ]: Began running node test.bain_capital_analytics.not_null_int_fund_nav_fund_id.ebf0b6cc99
[0m19:25:17.327996 [debug] [Thread-1  ]: Finished running node test.bain_capital_analytics.not_null_int_cashflow_enriched_cashflow_id.8460e9066d
[0m19:25:17.328315 [debug] [Thread-7  ]: Marking all children of 'model.bain_capital_analytics.int_valuation_enriched' to be skipped because of status 'skipped'. 
[0m19:25:17.328741 [debug] [Thread-3  ]: Finished running node test.bain_capital_analytics.unique_int_cashflow_enriched_cashflow_id.6944893c17
[0m19:25:17.329086 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.int_portfolio_attribution"
[0m19:25:17.329410 [info ] [Thread-2  ]: 40 of 54 SKIP test not_null_int_fund_nav_fund_id ............................... [[33mSKIP[0m]
[0m19:25:17.329751 [debug] [Thread-1  ]: Began running node test.bain_capital_analytics.not_null_int_irr_calculations_fund_id.35702f5be3
[0m19:25:17.330054 [debug] [Thread-7  ]: Marking all children of 'test.bain_capital_analytics.not_null_int_cashflow_enriched_cashflow_id.8460e9066d' to be skipped because of status 'skipped'. 
[0m19:25:17.330418 [debug] [Thread-3  ]: Began running node test.bain_capital_analytics.not_null_int_irr_calculations_portfolio_id.5530046e4d
[0m19:25:17.330724 [debug] [Thread-4  ]: On model.bain_capital_analytics.int_portfolio_attribution: BEGIN
[0m19:25:17.331035 [debug] [Thread-2  ]: Finished running node test.bain_capital_analytics.not_null_int_fund_nav_fund_id.ebf0b6cc99
[0m19:25:17.331355 [info ] [Thread-1  ]: 41 of 54 SKIP test not_null_int_irr_calculations_fund_id ....................... [[33mSKIP[0m]
[0m19:25:17.331675 [debug] [Thread-7  ]: Marking all children of 'test.bain_capital_analytics.unique_int_cashflow_enriched_cashflow_id.6944893c17' to be skipped because of status 'skipped'. 
[0m19:25:17.332012 [info ] [Thread-3  ]: 42 of 54 SKIP test not_null_int_irr_calculations_portfolio_id .................. [[33mSKIP[0m]
[0m19:25:17.332337 [debug] [Thread-4  ]: Opening a new connection, currently in state closed
[0m19:25:17.332656 [debug] [Thread-2  ]: Began running node test.bain_capital_analytics.not_null_int_valuation_enriched_valuation_id.048a7ba03a
[0m19:25:17.332971 [debug] [Thread-1  ]: Finished running node test.bain_capital_analytics.not_null_int_irr_calculations_fund_id.35702f5be3
[0m19:25:17.333280 [debug] [Thread-7  ]: Marking all children of 'test.bain_capital_analytics.not_null_int_fund_nav_fund_id.ebf0b6cc99' to be skipped because of status 'skipped'. 
[0m19:25:17.333645 [debug] [Thread-3  ]: Finished running node test.bain_capital_analytics.not_null_int_irr_calculations_portfolio_id.5530046e4d
[0m19:25:17.334060 [info ] [Thread-2  ]: 43 of 54 SKIP test not_null_int_valuation_enriched_valuation_id ................ [[33mSKIP[0m]
[0m19:25:17.334409 [debug] [Thread-1  ]: Began running node model.bain_capital_analytics.fact_cashflow_waterfall
[0m19:25:17.334713 [debug] [Thread-7  ]: Marking all children of 'test.bain_capital_analytics.not_null_int_irr_calculations_fund_id.35702f5be3' to be skipped because of status 'skipped'. 
[0m19:25:17.335114 [debug] [Thread-2  ]: Finished running node test.bain_capital_analytics.not_null_int_valuation_enriched_valuation_id.048a7ba03a
[0m19:25:17.335471 [info ] [Thread-1  ]: 44 of 54 SKIP relation public.fact_cashflow_waterfall .......................... [[33mSKIP[0m]
[0m19:25:17.335805 [debug] [Thread-7  ]: Marking all children of 'test.bain_capital_analytics.not_null_int_irr_calculations_portfolio_id.5530046e4d' to be skipped because of status 'skipped'. 
[0m19:25:17.336181 [debug] [Thread-1  ]: Finished running node model.bain_capital_analytics.fact_cashflow_waterfall
[0m19:25:17.336492 [debug] [Thread-7  ]: Marking all children of 'test.bain_capital_analytics.not_null_int_valuation_enriched_valuation_id.048a7ba03a' to be skipped because of status 'skipped'. 
[0m19:25:17.336887 [debug] [Thread-3  ]: Began running node model.bain_capital_analytics.fact_fund_performance
[0m19:25:17.337193 [debug] [Thread-2  ]: Began running node model.bain_capital_analytics.report_lp_quarterly
[0m19:25:17.337465 [debug] [Thread-7  ]: Marking all children of 'model.bain_capital_analytics.fact_cashflow_waterfall' to be skipped because of status 'skipped'. 
[0m19:25:17.337795 [info ] [Thread-3  ]: 45 of 54 SKIP relation public.fact_fund_performance ............................ [[33mSKIP[0m]
[0m19:25:17.338128 [info ] [Thread-2  ]: 46 of 54 SKIP relation public.report_lp_quarterly .............................. [[33mSKIP[0m]
[0m19:25:17.338579 [debug] [Thread-1  ]: Began running node test.bain_capital_analytics.not_null_fact_cashflow_waterfall_cashflow_id.7aafd60486
[0m19:25:17.338898 [debug] [Thread-3  ]: Finished running node model.bain_capital_analytics.fact_fund_performance
[0m19:25:17.339221 [debug] [Thread-2  ]: Finished running node model.bain_capital_analytics.report_lp_quarterly
[0m19:25:17.339539 [info ] [Thread-1  ]: 47 of 54 SKIP test not_null_fact_cashflow_waterfall_cashflow_id ................ [[33mSKIP[0m]
[0m19:25:17.339858 [debug] [Thread-7  ]: Marking all children of 'model.bain_capital_analytics.fact_fund_performance' to be skipped because of status 'skipped'. 
[0m19:25:17.340198 [debug] [Thread-1  ]: Finished running node test.bain_capital_analytics.not_null_fact_cashflow_waterfall_cashflow_id.7aafd60486
[0m19:25:17.340516 [debug] [Thread-7  ]: Marking all children of 'model.bain_capital_analytics.report_lp_quarterly' to be skipped because of status 'skipped'. 
[0m19:25:17.340876 [debug] [Thread-3  ]: Began running node test.bain_capital_analytics.not_null_fact_fund_performance_fund_id.738d6489c4
[0m19:25:17.341301 [debug] [Thread-7  ]: Marking all children of 'test.bain_capital_analytics.not_null_fact_cashflow_waterfall_cashflow_id.7aafd60486' to be skipped because of status 'skipped'. 
[0m19:25:17.341658 [debug] [Thread-1  ]: Began running node test.bain_capital_analytics.not_null_report_lp_quarterly_fund_id.aa355f6583
[0m19:25:17.341988 [info ] [Thread-3  ]: 48 of 54 SKIP test not_null_fact_fund_performance_fund_id ...................... [[33mSKIP[0m]
[0m19:25:17.342406 [info ] [Thread-1  ]: 49 of 54 SKIP test not_null_report_lp_quarterly_fund_id ........................ [[33mSKIP[0m]
[0m19:25:17.342738 [debug] [Thread-3  ]: Finished running node test.bain_capital_analytics.not_null_fact_fund_performance_fund_id.738d6489c4
[0m19:25:17.343042 [debug] [Thread-1  ]: Finished running node test.bain_capital_analytics.not_null_report_lp_quarterly_fund_id.aa355f6583
[0m19:25:17.343320 [debug] [Thread-7  ]: Marking all children of 'test.bain_capital_analytics.not_null_fact_fund_performance_fund_id.738d6489c4' to be skipped because of status 'skipped'. 
[0m19:25:17.343644 [debug] [Thread-7  ]: Marking all children of 'test.bain_capital_analytics.not_null_report_lp_quarterly_fund_id.aa355f6583' to be skipped because of status 'skipped'. 
[0m19:25:17.344044 [debug] [Thread-2  ]: Began running node model.bain_capital_analytics.report_ic_dashboard
[0m19:25:17.344364 [info ] [Thread-2  ]: 50 of 54 SKIP relation public.report_ic_dashboard .............................. [[33mSKIP[0m]
[0m19:25:17.344692 [debug] [Thread-2  ]: Finished running node model.bain_capital_analytics.report_ic_dashboard
[0m19:25:17.344978 [debug] [Thread-7  ]: Marking all children of 'model.bain_capital_analytics.report_ic_dashboard' to be skipped because of status 'skipped'. 
[0m19:25:17.345283 [debug] [Thread-4  ]: SQL status: BEGIN in 0.013 seconds
[0m19:25:17.345669 [debug] [Thread-1  ]: Began running node test.bain_capital_analytics.not_null_report_ic_dashboard_fund_id.e430aafd84
[0m19:25:17.345989 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.int_portfolio_attribution"
[0m19:25:17.346313 [info ] [Thread-1  ]: 51 of 54 SKIP test not_null_report_ic_dashboard_fund_id ........................ [[33mSKIP[0m]
[0m19:25:17.346733 [debug] [Thread-4  ]: On model.bain_capital_analytics.int_portfolio_attribution: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.int_portfolio_attribution"} */

  create view "bain_analytics"."public"."int_portfolio_attribution__dbt_tmp"
    
    
  as (
    -- Pipeline C: Portfolio performance attribution by sector and instrument type
-- Anti-pattern: deep CTE chain, repeated joins, late aggregation
-- Anti-pattern: same position-instrument-portfolio joins as int_daily_positions

with positions_enriched as (
    -- Anti-pattern: repeating the same 3-way join as int_daily_positions
    select
        pos.position_id,
        pos.portfolio_id,
        pos.instrument_id,
        pos.position_date,
        pos.quantity,
        pos.market_value,
        pos.cost_basis,
        pos.unrealized_gain_loss,
        i.instrument_name,
        i.instrument_type,
        i.sector,
        p.portfolio_name,
        p.strategy,
        p.fund_id
    from "bain_analytics"."public"."stg_positions" pos
    inner join "bain_analytics"."public"."stg_instruments" i
        on pos.instrument_id = i.instrument_id
    inner join "bain_analytics"."public"."stg_portfolios" p
        on pos.portfolio_id = p.portfolio_id
),

-- Anti-pattern: compute portfolio totals in a separate CTE instead of a single pass
portfolio_totals as (
    select
        portfolio_id,
        position_date,
        sum(market_value) as total_portfolio_mv,
        sum(unrealized_gain_loss) as total_portfolio_ugl
    from positions_enriched
    group by portfolio_id, position_date
),

-- Anti-pattern: sector aggregation in yet another CTE
sector_attribution as (
    select
        pe.portfolio_id,
        pe.portfolio_name,
        pe.strategy,
        pe.fund_id,
        pe.position_date,
        pe.sector,
        sum(pe.market_value) as sector_mv,
        sum(pe.unrealized_gain_loss) as sector_ugl,
        count(distinct pe.instrument_id) as num_instruments
    from positions_enriched pe
    group by
        pe.portfolio_id, pe.portfolio_name, pe.strategy,
        pe.fund_id, pe.position_date, pe.sector
),

-- Anti-pattern: joining back to get weights instead of computing in one pass
attribution_with_weights as (
    select
        sa.*,
        pt.total_portfolio_mv,
        pt.total_portfolio_ugl,
        case
            when pt.total_portfolio_mv != 0
            then sa.sector_mv / pt.total_portfolio_mv
            else 0
        end as sector_weight,
        case
            when pt.total_portfolio_ugl != 0
            then sa.sector_ugl / pt.total_portfolio_ugl
            else 0
        end as sector_contribution
    from sector_attribution sa
    inner join portfolio_totals pt
        on sa.portfolio_id = pt.portfolio_id
        and sa.position_date = pt.position_date
)

select * from attribution_with_weights
  );
[0m19:25:17.347132 [debug] [Thread-1  ]: Finished running node test.bain_capital_analytics.not_null_report_ic_dashboard_fund_id.e430aafd84
[0m19:25:17.347451 [debug] [Thread-7  ]: Marking all children of 'test.bain_capital_analytics.not_null_report_ic_dashboard_fund_id.e430aafd84' to be skipped because of status 'skipped'. 
[0m19:25:17.357423 [debug] [Thread-4  ]: SQL status: CREATE VIEW in 0.010 seconds
[0m19:25:17.361568 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.int_portfolio_attribution"
[0m19:25:17.361887 [debug] [Thread-4  ]: On model.bain_capital_analytics.int_portfolio_attribution: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.int_portfolio_attribution"} */
alter table "bain_analytics"."public"."int_portfolio_attribution__dbt_tmp" rename to "int_portfolio_attribution"
[0m19:25:17.363455 [debug] [Thread-4  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m19:25:17.364407 [debug] [Thread-4  ]: On model.bain_capital_analytics.int_portfolio_attribution: COMMIT
[0m19:25:17.364705 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.int_portfolio_attribution"
[0m19:25:17.364997 [debug] [Thread-4  ]: On model.bain_capital_analytics.int_portfolio_attribution: COMMIT
[0m19:25:17.366336 [debug] [Thread-4  ]: SQL status: COMMIT in 0.001 seconds
[0m19:25:17.368469 [debug] [Thread-4  ]: Applying DROP to: "bain_analytics"."public"."int_portfolio_attribution__dbt_backup"
[0m19:25:17.368921 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.int_portfolio_attribution"
[0m19:25:17.369220 [debug] [Thread-4  ]: On model.bain_capital_analytics.int_portfolio_attribution: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.int_portfolio_attribution"} */
drop view if exists "bain_analytics"."public"."int_portfolio_attribution__dbt_backup" cascade
[0m19:25:17.370498 [debug] [Thread-4  ]: SQL status: DROP VIEW in 0.001 seconds
[0m19:25:17.371444 [debug] [Thread-4  ]: On model.bain_capital_analytics.int_portfolio_attribution: Close
[0m19:25:17.371908 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f5777163-bfb8-4ecd-8d00-9b8bf6f11360', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10afd27c0>]}
[0m19:25:17.372422 [info ] [Thread-4  ]: 34 of 54 OK created sql view model public.int_portfolio_attribution ............ [[32mCREATE VIEW[0m in 0.06s]
[0m19:25:17.372857 [debug] [Thread-4  ]: Finished running node model.bain_capital_analytics.int_portfolio_attribution
[0m19:25:17.373365 [debug] [Thread-2  ]: Began running node test.bain_capital_analytics.not_null_int_portfolio_attribution_portfolio_id.3e04b7c210
[0m19:25:17.373739 [info ] [Thread-2  ]: 52 of 54 START test not_null_int_portfolio_attribution_portfolio_id ............ [RUN]
[0m19:25:17.374118 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.not_null_stg_portfolios_fund_id.70b04d82bd, now test.bain_capital_analytics.not_null_int_portfolio_attribution_portfolio_id.3e04b7c210)
[0m19:25:17.374477 [debug] [Thread-2  ]: Began compiling node test.bain_capital_analytics.not_null_int_portfolio_attribution_portfolio_id.3e04b7c210
[0m19:25:17.377978 [debug] [Thread-2  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_int_portfolio_attribution_portfolio_id.3e04b7c210"
[0m19:25:17.378542 [debug] [Thread-2  ]: Began executing node test.bain_capital_analytics.not_null_int_portfolio_attribution_portfolio_id.3e04b7c210
[0m19:25:17.380756 [debug] [Thread-2  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_int_portfolio_attribution_portfolio_id.3e04b7c210"
[0m19:25:17.381255 [debug] [Thread-2  ]: Using postgres connection "test.bain_capital_analytics.not_null_int_portfolio_attribution_portfolio_id.3e04b7c210"
[0m19:25:17.381556 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_int_portfolio_attribution_portfolio_id.3e04b7c210: BEGIN
[0m19:25:17.381848 [debug] [Thread-2  ]: Opening a new connection, currently in state closed
[0m19:25:17.392752 [debug] [Thread-2  ]: SQL status: BEGIN in 0.011 seconds
[0m19:25:17.393051 [debug] [Thread-2  ]: Using postgres connection "test.bain_capital_analytics.not_null_int_portfolio_attribution_portfolio_id.3e04b7c210"
[0m19:25:17.393345 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_int_portfolio_attribution_portfolio_id.3e04b7c210: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_int_portfolio_attribution_portfolio_id.3e04b7c210"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select portfolio_id
from "bain_analytics"."public"."int_portfolio_attribution"
where portfolio_id is null



  
  
      
    ) dbt_internal_test
[0m19:25:17.399961 [debug] [Thread-2  ]: SQL status: SELECT 1 in 0.006 seconds
[0m19:25:17.401134 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_int_portfolio_attribution_portfolio_id.3e04b7c210: ROLLBACK
[0m19:25:17.402047 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_int_portfolio_attribution_portfolio_id.3e04b7c210: Close
[0m19:25:17.402503 [info ] [Thread-2  ]: 52 of 54 PASS not_null_int_portfolio_attribution_portfolio_id .................. [[32mPASS[0m in 0.03s]
[0m19:25:17.402940 [debug] [Thread-2  ]: Finished running node test.bain_capital_analytics.not_null_int_portfolio_attribution_portfolio_id.3e04b7c210
[0m19:25:17.403487 [debug] [Thread-1  ]: Began running node model.bain_capital_analytics.fact_portfolio_attribution
[0m19:25:17.403878 [info ] [Thread-1  ]: 53 of 54 START sql view model public.fact_portfolio_attribution ................ [RUN]
[0m19:25:17.404213 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.unique_stg_portfolios_portfolio_id.aa125b6658, now model.bain_capital_analytics.fact_portfolio_attribution)
[0m19:25:17.404507 [debug] [Thread-1  ]: Began compiling node model.bain_capital_analytics.fact_portfolio_attribution
[0m19:25:17.407537 [debug] [Thread-1  ]: Writing injected SQL for node "model.bain_capital_analytics.fact_portfolio_attribution"
[0m19:25:17.408058 [debug] [Thread-1  ]: Began executing node model.bain_capital_analytics.fact_portfolio_attribution
[0m19:25:17.412320 [debug] [Thread-1  ]: Writing runtime sql for node "model.bain_capital_analytics.fact_portfolio_attribution"
[0m19:25:17.412827 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.fact_portfolio_attribution"
[0m19:25:17.413119 [debug] [Thread-1  ]: On model.bain_capital_analytics.fact_portfolio_attribution: BEGIN
[0m19:25:17.413392 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m19:25:17.423028 [debug] [Thread-1  ]: SQL status: BEGIN in 0.010 seconds
[0m19:25:17.423334 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.fact_portfolio_attribution"
[0m19:25:17.423680 [debug] [Thread-1  ]: On model.bain_capital_analytics.fact_portfolio_attribution: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.fact_portfolio_attribution"} */

  create view "bain_analytics"."public"."fact_portfolio_attribution__dbt_tmp"
    
    
  as (
    -- Pipeline C: FACT table - Portfolio attribution with benchmark comparison
-- Anti-pattern: re-joins data that's already in intermediate models
-- Anti-pattern: repeated computation of sector weights

with attribution as (
    select
        pa.portfolio_id,
        pa.portfolio_name,
        pa.strategy,
        pa.fund_id,
        pa.position_date,
        pa.sector,
        pa.sector_mv,
        pa.sector_ugl,
        pa.num_instruments,
        pa.total_portfolio_mv,
        pa.total_portfolio_ugl,
        pa.sector_weight,
        pa.sector_contribution
    from "bain_analytics"."public"."int_portfolio_attribution" pa
),

-- Anti-pattern: re-joining benchmarks (could be done in intermediate)
attribution_with_benchmark as (
    select
        a.*,
        bm.benchmark_name,
        bm.return_mtd as benchmark_return,
        bm.rolling_3m_return as benchmark_3m_return,
        bm.rolling_12m_return as benchmark_12m_return
    from attribution a
    left join "bain_analytics"."public"."int_benchmark_returns" bm
        on a.position_date = bm.benchmark_date
        and bm.benchmark_id = 'BM_SP500'
),

-- Anti-pattern: computing alpha in yet another CTE
attribution_with_alpha as (
    select
        ab.*,
        -- Simplified active return
        case
            when ab.total_portfolio_mv != 0
            then (ab.sector_ugl / ab.total_portfolio_mv) - coalesce(ab.benchmark_return, 0) * ab.sector_weight
            else 0
        end as sector_active_return,
        -- Anti-pattern: re-computing portfolio-level return here
        case
            when ab.total_portfolio_mv != 0
            then ab.total_portfolio_ugl / ab.total_portfolio_mv
            else 0
        end as portfolio_return
    from attribution_with_benchmark ab
)

select * from attribution_with_alpha
  );
[0m19:25:17.429256 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.005 seconds
[0m19:25:17.431975 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.fact_portfolio_attribution"
[0m19:25:17.432289 [debug] [Thread-1  ]: On model.bain_capital_analytics.fact_portfolio_attribution: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.fact_portfolio_attribution"} */
alter table "bain_analytics"."public"."fact_portfolio_attribution__dbt_tmp" rename to "fact_portfolio_attribution"
[0m19:25:17.433577 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m19:25:17.434557 [debug] [Thread-1  ]: On model.bain_capital_analytics.fact_portfolio_attribution: COMMIT
[0m19:25:17.434862 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.fact_portfolio_attribution"
[0m19:25:17.435144 [debug] [Thread-1  ]: On model.bain_capital_analytics.fact_portfolio_attribution: COMMIT
[0m19:25:17.436317 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m19:25:17.438450 [debug] [Thread-1  ]: Applying DROP to: "bain_analytics"."public"."fact_portfolio_attribution__dbt_backup"
[0m19:25:17.438910 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.fact_portfolio_attribution"
[0m19:25:17.439205 [debug] [Thread-1  ]: On model.bain_capital_analytics.fact_portfolio_attribution: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.fact_portfolio_attribution"} */
drop view if exists "bain_analytics"."public"."fact_portfolio_attribution__dbt_backup" cascade
[0m19:25:17.439856 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.000 seconds
[0m19:25:17.440807 [debug] [Thread-1  ]: On model.bain_capital_analytics.fact_portfolio_attribution: Close
[0m19:25:17.441360 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f5777163-bfb8-4ecd-8d00-9b8bf6f11360', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110396df0>]}
[0m19:25:17.441927 [info ] [Thread-1  ]: 53 of 54 OK created sql view model public.fact_portfolio_attribution ........... [[32mCREATE VIEW[0m in 0.04s]
[0m19:25:17.442396 [debug] [Thread-1  ]: Finished running node model.bain_capital_analytics.fact_portfolio_attribution
[0m19:25:17.442980 [debug] [Thread-3  ]: Began running node test.bain_capital_analytics.not_null_fact_portfolio_attribution_portfolio_id.f676c7df62
[0m19:25:17.443306 [info ] [Thread-3  ]: 54 of 54 START test not_null_fact_portfolio_attribution_portfolio_id ........... [RUN]
[0m19:25:17.443661 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_.2823f12709, now test.bain_capital_analytics.not_null_fact_portfolio_attribution_portfolio_id.f676c7df62)
[0m19:25:17.443958 [debug] [Thread-3  ]: Began compiling node test.bain_capital_analytics.not_null_fact_portfolio_attribution_portfolio_id.f676c7df62
[0m19:25:17.447467 [debug] [Thread-3  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_fact_portfolio_attribution_portfolio_id.f676c7df62"
[0m19:25:17.448006 [debug] [Thread-3  ]: Began executing node test.bain_capital_analytics.not_null_fact_portfolio_attribution_portfolio_id.f676c7df62
[0m19:25:17.450191 [debug] [Thread-3  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_fact_portfolio_attribution_portfolio_id.f676c7df62"
[0m19:25:17.450734 [debug] [Thread-3  ]: Using postgres connection "test.bain_capital_analytics.not_null_fact_portfolio_attribution_portfolio_id.f676c7df62"
[0m19:25:17.451032 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_fact_portfolio_attribution_portfolio_id.f676c7df62: BEGIN
[0m19:25:17.451306 [debug] [Thread-3  ]: Opening a new connection, currently in state closed
[0m19:25:17.461972 [debug] [Thread-3  ]: SQL status: BEGIN in 0.011 seconds
[0m19:25:17.462296 [debug] [Thread-3  ]: Using postgres connection "test.bain_capital_analytics.not_null_fact_portfolio_attribution_portfolio_id.f676c7df62"
[0m19:25:17.462604 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_fact_portfolio_attribution_portfolio_id.f676c7df62: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_fact_portfolio_attribution_portfolio_id.f676c7df62"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select portfolio_id
from "bain_analytics"."public"."fact_portfolio_attribution"
where portfolio_id is null



  
  
      
    ) dbt_internal_test
[0m19:25:17.472371 [debug] [Thread-3  ]: SQL status: SELECT 1 in 0.009 seconds
[0m19:25:17.473680 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_fact_portfolio_attribution_portfolio_id.f676c7df62: ROLLBACK
[0m19:25:17.474426 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_fact_portfolio_attribution_portfolio_id.f676c7df62: Close
[0m19:25:17.474918 [info ] [Thread-3  ]: 54 of 54 PASS not_null_fact_portfolio_attribution_portfolio_id ................. [[32mPASS[0m in 0.03s]
[0m19:25:17.475356 [debug] [Thread-3  ]: Finished running node test.bain_capital_analytics.not_null_fact_portfolio_attribution_portfolio_id.f676c7df62
[0m19:25:17.476364 [debug] [MainThread]: Using postgres connection "master"
[0m19:25:17.476641 [debug] [MainThread]: On master: BEGIN
[0m19:25:17.476878 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m19:25:17.486342 [debug] [MainThread]: SQL status: BEGIN in 0.009 seconds
[0m19:25:17.486618 [debug] [MainThread]: On master: COMMIT
[0m19:25:17.486865 [debug] [MainThread]: Using postgres connection "master"
[0m19:25:17.487104 [debug] [MainThread]: On master: COMMIT
[0m19:25:17.487626 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m19:25:17.487878 [debug] [MainThread]: On master: Close
[0m19:25:17.488191 [debug] [MainThread]: Connection 'master' was properly closed.
[0m19:25:17.488420 [debug] [MainThread]: Connection 'model.bain_capital_analytics.fact_portfolio_attribution' was properly closed.
[0m19:25:17.488642 [debug] [MainThread]: Connection 'test.bain_capital_analytics.not_null_int_portfolio_attribution_portfolio_id.3e04b7c210' was properly closed.
[0m19:25:17.488861 [debug] [MainThread]: Connection 'test.bain_capital_analytics.not_null_fact_portfolio_attribution_portfolio_id.f676c7df62' was properly closed.
[0m19:25:17.489077 [debug] [MainThread]: Connection 'model.bain_capital_analytics.int_portfolio_attribution' was properly closed.
[0m19:25:17.489424 [info ] [MainThread]: 
[0m19:25:17.489691 [info ] [MainThread]: Finished running 35 data tests, 19 view models in 0 hours 0 minutes and 2.68 seconds (2.68s).
[0m19:25:17.493571 [debug] [MainThread]: Command end result
[0m19:25:17.612337 [debug] [MainThread]: Wrote artifact WritableManifest to ./target/manifest.json
[0m19:25:17.614116 [debug] [MainThread]: Wrote artifact SemanticManifest to ./target/semantic_manifest.json
[0m19:25:17.621313 [debug] [MainThread]: Wrote artifact RunExecutionResult to ./target/run_results.json
[0m19:25:17.621633 [info ] [MainThread]: 
[0m19:25:17.621952 [info ] [MainThread]: [31mCompleted with 2 errors, 0 partial successes, and 0 warnings:[0m
[0m19:25:17.622232 [info ] [MainThread]: 
[0m19:25:17.622548 [error] [MainThread]: [31mFailure in model stg_cashflows (models/staging/stg_cashflows.sql)[0m
[0m19:25:17.622872 [error] [MainThread]:   Database Error in model stg_cashflows (models/staging/stg_cashflows.sql)
  deadlock detected
  DETAIL:  Process 4429 waits for AccessExclusiveLock on object 16919 of class 2618 of database 16384; blocked by process 4428.
  Process 4428 waits for AccessExclusiveLock on object 16879 of class 2618 of database 16384; blocked by process 4429.
  HINT:  See server log for query details.
  compiled code at target/run/bain_capital_analytics/models/staging/stg_cashflows.sql
[0m19:25:17.623131 [info ] [MainThread]: 
[0m19:25:17.623417 [info ] [MainThread]:   compiled code at target/compiled/bain_capital_analytics/models/staging/stg_cashflows.sql
[0m19:25:17.623685 [info ] [MainThread]: 
[0m19:25:17.623979 [error] [MainThread]: [31mFailure in model stg_valuations (models/staging/stg_valuations.sql)[0m
[0m19:25:17.624284 [error] [MainThread]:   Database Error in model stg_valuations (models/staging/stg_valuations.sql)
  deadlock detected
  DETAIL:  Process 4434 waits for AccessExclusiveLock on object 16894 of class 2618 of database 16384; blocked by process 4432.
  Process 4432 waits for AccessExclusiveLock on object 16899 of class 2618 of database 16384; blocked by process 4434.
  HINT:  See server log for query details.
  compiled code at target/run/bain_capital_analytics/models/staging/stg_valuations.sql
[0m19:25:17.624613 [info ] [MainThread]: 
[0m19:25:17.624942 [info ] [MainThread]:   compiled code at target/compiled/bain_capital_analytics/models/staging/stg_valuations.sql
[0m19:25:17.625249 [info ] [MainThread]: 
[0m19:25:17.625541 [info ] [MainThread]: Done. PASS=27 WARN=0 ERROR=2 SKIP=25 NO-OP=0 TOTAL=54
[0m19:25:17.628518 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": false, "command_wall_clock_time": 3.744713, "process_in_blocks": "0", "process_kernel_time": 0.341091, "process_mem_max_rss": "141901824", "process_out_blocks": "0", "process_user_time": 3.111196}
[0m19:25:17.628928 [debug] [MainThread]: Command `dbt build` failed at 19:25:17.628854 after 3.75 seconds
[0m19:25:17.629269 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1086c11c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107bcca00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1089a0280>]}
[0m19:25:17.629615 [debug] [MainThread]: Flushing usage events
[0m19:25:19.033564 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m19:30:14.069560 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ba741c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10cb22850>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10cb22670>]}


============================== 19:30:14.073799 | 06decbc9-1bfd-415a-a35a-88ae35545da3 ==============================
[0m19:30:14.073799 [info ] [MainThread]: Running with dbt=1.11.0-b3
[0m19:30:14.074285 [debug] [MainThread]: running dbt with arguments {'use_experimental_parser': 'False', 'target_path': 'None', 'printer_width': '80', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'warn_error': 'None', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'write_json': 'True', 'log_path': 'logs', 'log_cache_events': 'False', 'empty': 'False', 'debug': 'False', 'profiles_dir': '.', 'no_print': 'None', 'partial_parse': 'True', 'static_parser': 'True', 'invocation_command': 'dbt build --select tag:pipeline_c --profiles-dir . --project-dir .', 'version_check': 'True', 'fail_fast': 'False', 'send_anonymous_usage_stats': 'True', 'cache_selected_only': 'False', 'indirect_selection': 'eager', 'use_colors': 'True'}
[0m19:30:14.299425 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '06decbc9-1bfd-415a-a35a-88ae35545da3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10bbb6490>]}
[0m19:30:14.375350 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '06decbc9-1bfd-415a-a35a-88ae35545da3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10bd18280>]}
[0m19:30:14.377177 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m19:30:14.487111 [debug] [MainThread]: checksum: e63134dccc1251cfb572caf0e4aa952f030c125ee3634f3bf2c0a2e1bb6ae349, vars: {}, profile: , target: , version: 1.11.0b3
[0m19:30:14.730291 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m19:30:14.730755 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m19:30:14.794825 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '06decbc9-1bfd-415a-a35a-88ae35545da3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10dc80130>]}
[0m19:30:14.924249 [debug] [MainThread]: Wrote artifact WritableManifest to ./target/manifest.json
[0m19:30:14.926634 [debug] [MainThread]: Wrote artifact SemanticManifest to ./target/semantic_manifest.json
[0m19:30:14.962884 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '06decbc9-1bfd-415a-a35a-88ae35545da3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10dd9a9d0>]}
[0m19:30:14.963415 [info ] [MainThread]: Found 28 models, 53 data tests, 10 seeds, 569 macros
[0m19:30:14.967343 [info ] [MainThread]: 
[0m19:30:14.967723 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m19:30:14.967998 [info ] [MainThread]: 
[0m19:30:14.968444 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m19:30:14.973314 [debug] [ThreadPool]: Acquiring new postgres connection 'list_bain_analytics'
[0m19:30:15.028867 [debug] [ThreadPool]: Using postgres connection "list_bain_analytics"
[0m19:30:15.029284 [debug] [ThreadPool]: On list_bain_analytics: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "connection_name": "list_bain_analytics"} */

    select distinct nspname from pg_namespace
  
[0m19:30:15.029550 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m19:30:15.076338 [debug] [ThreadPool]: SQL status: SELECT 5 in 0.047 seconds
[0m19:30:15.077791 [debug] [ThreadPool]: On list_bain_analytics: Close
[0m19:30:15.081355 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_bain_analytics, now list_bain_analytics_public)
[0m19:30:15.081865 [debug] [ThreadPool]: Acquiring new postgres connection 'list_bain_analytics_public_raw'
[0m19:30:15.088158 [debug] [ThreadPool]: Using postgres connection "list_bain_analytics_public"
[0m19:30:15.090813 [debug] [ThreadPool]: Using postgres connection "list_bain_analytics_public_raw"
[0m19:30:15.091151 [debug] [ThreadPool]: On list_bain_analytics_public: BEGIN
[0m19:30:15.091447 [debug] [ThreadPool]: On list_bain_analytics_public_raw: BEGIN
[0m19:30:15.091728 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:30:15.091994 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m19:30:15.106209 [debug] [ThreadPool]: SQL status: BEGIN in 0.014 seconds
[0m19:30:15.106536 [debug] [ThreadPool]: SQL status: BEGIN in 0.015 seconds
[0m19:30:15.106811 [debug] [ThreadPool]: Using postgres connection "list_bain_analytics_public"
[0m19:30:15.107075 [debug] [ThreadPool]: Using postgres connection "list_bain_analytics_public_raw"
[0m19:30:15.107353 [debug] [ThreadPool]: On list_bain_analytics_public: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "connection_name": "list_bain_analytics_public"} */
select
      'bain_analytics' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'bain_analytics' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'bain_analytics' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m19:30:15.107666 [debug] [ThreadPool]: On list_bain_analytics_public_raw: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "connection_name": "list_bain_analytics_public_raw"} */
select
      'bain_analytics' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_raw'
    union all
    select
      'bain_analytics' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_raw'
    union all
    select
      'bain_analytics' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_raw'
  
[0m19:30:15.114134 [debug] [ThreadPool]: SQL status: SELECT 15 in 0.006 seconds
[0m19:30:15.114409 [debug] [ThreadPool]: SQL status: SELECT 10 in 0.006 seconds
[0m19:30:15.115861 [debug] [ThreadPool]: On list_bain_analytics_public: ROLLBACK
[0m19:30:15.117002 [debug] [ThreadPool]: On list_bain_analytics_public_raw: ROLLBACK
[0m19:30:15.117743 [debug] [ThreadPool]: On list_bain_analytics_public_raw: Close
[0m19:30:15.118010 [debug] [ThreadPool]: On list_bain_analytics_public: Close
[0m19:30:15.127282 [debug] [MainThread]: Using postgres connection "master"
[0m19:30:15.127586 [debug] [MainThread]: On master: BEGIN
[0m19:30:15.127838 [debug] [MainThread]: Opening a new connection, currently in state init
[0m19:30:15.137847 [debug] [MainThread]: SQL status: BEGIN in 0.010 seconds
[0m19:30:15.138106 [debug] [MainThread]: Using postgres connection "master"
[0m19:30:15.138419 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "connection_name": "master"} */
select distinct
        dependent_namespace.nspname as dependent_schema,
        dependent_class.relname as dependent_name,
        referenced_namespace.nspname as referenced_schema,
        referenced_class.relname as referenced_name

    -- Query for views: views are entries in pg_class with an entry in pg_rewrite, but we avoid
    -- a seq scan on pg_rewrite by leveraging the fact there is an "internal" row in pg_depend for
    -- the view...
    from pg_class as dependent_class
    join pg_namespace as dependent_namespace on dependent_namespace.oid = dependent_class.relnamespace
    join pg_depend as dependent_depend on dependent_depend.refobjid = dependent_class.oid
        and dependent_depend.classid = 'pg_rewrite'::regclass
        and dependent_depend.refclassid = 'pg_class'::regclass
        and dependent_depend.deptype = 'i'

    -- ... and via pg_depend (that has a row per column, hence the need for "distinct" above, and
    -- making sure to exclude the internal row to avoid a view appearing to depend on itself)...
    join pg_depend as joining_depend on joining_depend.objid = dependent_depend.objid
        and joining_depend.classid = 'pg_rewrite'::regclass
        and joining_depend.refclassid = 'pg_class'::regclass
        and joining_depend.refobjid != dependent_depend.refobjid

    -- ... we can find the tables they query from in pg_class, but excluding system tables. Note we
    -- don't need need to exclude _dependent_ system tables, because they only query from other
    -- system tables, and so are automatically excluded by excluding _referenced_ system tables
    join pg_class as referenced_class on referenced_class.oid = joining_depend.refobjid
    join pg_namespace as referenced_namespace on referenced_namespace.oid = referenced_class.relnamespace
        and referenced_namespace.nspname != 'information_schema'
        and referenced_namespace.nspname not like 'pg\_%'

    order by
        dependent_schema, dependent_name, referenced_schema, referenced_name;
[0m19:30:15.145627 [debug] [MainThread]: SQL status: SELECT 19 in 0.007 seconds
[0m19:30:15.149520 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '06decbc9-1bfd-415a-a35a-88ae35545da3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e2de550>]}
[0m19:30:15.149986 [debug] [MainThread]: On master: ROLLBACK
[0m19:30:15.150595 [debug] [MainThread]: Using postgres connection "master"
[0m19:30:15.150854 [debug] [MainThread]: On master: BEGIN
[0m19:30:15.151741 [debug] [MainThread]: SQL status: BEGIN in 0.001 seconds
[0m19:30:15.152012 [debug] [MainThread]: On master: COMMIT
[0m19:30:15.152265 [debug] [MainThread]: Using postgres connection "master"
[0m19:30:15.152508 [debug] [MainThread]: On master: COMMIT
[0m19:30:15.153091 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m19:30:15.153349 [debug] [MainThread]: On master: Close
[0m19:30:15.156727 [debug] [Thread-1  ]: Began running node model.bain_capital_analytics.stg_benchmarks
[0m19:30:15.157080 [debug] [Thread-2  ]: Began running node model.bain_capital_analytics.stg_cashflows
[0m19:30:15.157556 [info ] [Thread-1  ]: 1 of 54 START sql view model public.stg_benchmarks ............................. [RUN]
[0m19:30:15.157923 [debug] [Thread-3  ]: Began running node model.bain_capital_analytics.stg_dates
[0m19:30:15.158326 [info ] [Thread-2  ]: 2 of 54 START sql view model public.stg_cashflows .............................. [RUN]
[0m19:30:15.158690 [debug] [Thread-4  ]: Began running node model.bain_capital_analytics.stg_fund_structures
[0m19:30:15.159066 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_bain_analytics_public, now model.bain_capital_analytics.stg_benchmarks)
[0m19:30:15.159464 [info ] [Thread-3  ]: 3 of 54 START sql view model public.stg_dates .................................. [RUN]
[0m19:30:15.159859 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly list_bain_analytics_public_raw, now model.bain_capital_analytics.stg_cashflows)
[0m19:30:15.160246 [info ] [Thread-4  ]: 4 of 54 START sql view model public.stg_fund_structures ........................ [RUN]
[0m19:30:15.160592 [debug] [Thread-1  ]: Began compiling node model.bain_capital_analytics.stg_benchmarks
[0m19:30:15.161035 [debug] [Thread-3  ]: Acquiring new postgres connection 'model.bain_capital_analytics.stg_dates'
[0m19:30:15.161356 [debug] [Thread-2  ]: Began compiling node model.bain_capital_analytics.stg_cashflows
[0m19:30:15.161746 [debug] [Thread-4  ]: Acquiring new postgres connection 'model.bain_capital_analytics.stg_fund_structures'
[0m19:30:15.168387 [debug] [Thread-3  ]: Began compiling node model.bain_capital_analytics.stg_dates
[0m19:30:15.169962 [debug] [Thread-1  ]: Writing injected SQL for node "model.bain_capital_analytics.stg_benchmarks"
[0m19:30:15.172592 [debug] [Thread-2  ]: Writing injected SQL for node "model.bain_capital_analytics.stg_cashflows"
[0m19:30:15.172910 [debug] [Thread-4  ]: Began compiling node model.bain_capital_analytics.stg_fund_structures
[0m19:30:15.176366 [debug] [Thread-3  ]: Writing injected SQL for node "model.bain_capital_analytics.stg_dates"
[0m19:30:15.179126 [debug] [Thread-4  ]: Writing injected SQL for node "model.bain_capital_analytics.stg_fund_structures"
[0m19:30:15.179711 [debug] [Thread-1  ]: Began executing node model.bain_capital_analytics.stg_benchmarks
[0m19:30:15.180053 [debug] [Thread-3  ]: Began executing node model.bain_capital_analytics.stg_dates
[0m19:30:15.180360 [debug] [Thread-2  ]: Began executing node model.bain_capital_analytics.stg_cashflows
[0m19:30:15.205777 [debug] [Thread-4  ]: Began executing node model.bain_capital_analytics.stg_fund_structures
[0m19:30:15.214998 [debug] [Thread-1  ]: Writing runtime sql for node "model.bain_capital_analytics.stg_benchmarks"
[0m19:30:15.222161 [debug] [Thread-3  ]: Writing runtime sql for node "model.bain_capital_analytics.stg_dates"
[0m19:30:15.224790 [debug] [Thread-2  ]: Applying DROP to: "bain_analytics"."public"."stg_cashflows__dbt_backup"
[0m19:30:15.228078 [debug] [Thread-4  ]: Writing runtime sql for node "model.bain_capital_analytics.stg_fund_structures"
[0m19:30:15.231726 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.stg_cashflows"
[0m19:30:15.232190 [debug] [Thread-2  ]: On model.bain_capital_analytics.stg_cashflows: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_cashflows"} */
drop view if exists "bain_analytics"."public"."stg_cashflows__dbt_backup" cascade
[0m19:30:15.232542 [debug] [Thread-2  ]: Opening a new connection, currently in state closed
[0m19:30:15.232901 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.stg_benchmarks"
[0m19:30:15.233381 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.stg_dates"
[0m19:30:15.233700 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_benchmarks: BEGIN
[0m19:30:15.234025 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.stg_fund_structures"
[0m19:30:15.234329 [debug] [Thread-3  ]: On model.bain_capital_analytics.stg_dates: BEGIN
[0m19:30:15.234643 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m19:30:15.234953 [debug] [Thread-4  ]: On model.bain_capital_analytics.stg_fund_structures: BEGIN
[0m19:30:15.235253 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m19:30:15.235651 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m19:30:15.250031 [debug] [Thread-1  ]: SQL status: BEGIN in 0.015 seconds
[0m19:30:15.250354 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.stg_benchmarks"
[0m19:30:15.250678 [debug] [Thread-4  ]: SQL status: BEGIN in 0.015 seconds
[0m19:30:15.251004 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_benchmarks: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_benchmarks"} */

  create view "bain_analytics"."public"."stg_benchmarks__dbt_tmp"
    
    
  as (
    select distinct
    benchmark_id,
    benchmark_name,
    cast(benchmark_date as date) as benchmark_date,
    cast(return_daily as numeric(18,8)) as return_daily,
    cast(return_mtd as numeric(18,8)) as return_mtd,
    cast(return_ytd as numeric(18,8)) as return_ytd,
    cast(benchmark_level as numeric(18,4)) as benchmark_level,
    -- Anti-pattern: duplicated fiscal quarter logic
    case
        when extract(month from cast(benchmark_date as date)) between 1 and 3 then 'Q3'
        when extract(month from cast(benchmark_date as date)) between 4 and 6 then 'Q4'
        when extract(month from cast(benchmark_date as date)) between 7 and 9 then 'Q1'
        when extract(month from cast(benchmark_date as date)) between 10 and 12 then 'Q2'
    end as benchmark_fiscal_quarter
from "bain_analytics"."public_raw"."raw_benchmarks"
  );
[0m19:30:15.251309 [debug] [Thread-3  ]: SQL status: BEGIN in 0.016 seconds
[0m19:30:15.251600 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.stg_fund_structures"
[0m19:30:15.251940 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.stg_dates"
[0m19:30:15.252273 [debug] [Thread-4  ]: On model.bain_capital_analytics.stg_fund_structures: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_fund_structures"} */

  create view "bain_analytics"."public"."stg_fund_structures__dbt_tmp"
    
    
  as (
    select distinct
    fund_id,
    fund_name,
    fund_type,
    cast(vintage_year as integer) as vintage_year,
    cast(committed_capital as numeric(18,2)) as committed_capital,
    cast(management_fee_rate as numeric(8,4)) as management_fee_rate,
    cast(carry_rate as numeric(8,4)) as carry_rate,
    cast(hurdle_rate as numeric(8,4)) as hurdle_rate,
    cast(gp_commitment_pct as numeric(8,4)) as gp_commitment_pct,
    fund_currency,
    fund_status
from "bain_analytics"."public_raw"."raw_fund_structures"
  );
[0m19:30:15.252629 [debug] [Thread-3  ]: On model.bain_capital_analytics.stg_dates: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_dates"} */

  create view "bain_analytics"."public"."stg_dates__dbt_tmp"
    
    
  as (
    select
    cast(date_day as date) as date_day,
    cast(is_business_day as boolean) as is_business_day,
    cast(is_month_end as boolean) as is_month_end,
    cast(is_quarter_end as boolean) as is_quarter_end,
    cast(is_year_end as boolean) as is_year_end,
    fiscal_quarter,
    fiscal_year,
    -- Anti-pattern: PostgreSQL-specific date_trunc
    date_trunc('month', cast(date_day as date)) as month_start,
    date_trunc('quarter', cast(date_day as date)) as quarter_start,
    extract(month from cast(date_day as date)) as calendar_month,
    extract(year from cast(date_day as date)) as calendar_year
from "bain_analytics"."public_raw"."raw_dates"
  );
[0m19:30:15.252933 [debug] [Thread-2  ]: SQL status: DROP VIEW in 0.020 seconds
[0m19:30:15.254077 [debug] [Thread-2  ]: Writing runtime sql for node "model.bain_capital_analytics.stg_cashflows"
[0m19:30:15.254569 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.stg_cashflows"
[0m19:30:15.254859 [debug] [Thread-2  ]: On model.bain_capital_analytics.stg_cashflows: BEGIN
[0m19:30:15.255651 [debug] [Thread-2  ]: SQL status: BEGIN in 0.001 seconds
[0m19:30:15.255952 [debug] [Thread-3  ]: SQL status: CREATE VIEW in 0.003 seconds
[0m19:30:15.256234 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.stg_cashflows"
[0m19:30:15.262230 [debug] [Thread-4  ]: SQL status: CREATE VIEW in 0.009 seconds
[0m19:30:15.262122 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.stg_dates"
[0m19:30:15.262747 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.011 seconds
[0m19:30:15.263077 [debug] [Thread-2  ]: On model.bain_capital_analytics.stg_cashflows: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_cashflows"} */

  create view "bain_analytics"."public"."stg_cashflows__dbt_tmp"
    
    
  as (
    -- Anti-pattern: unnecessary DISTINCT
-- Anti-pattern: duplicated fiscal quarter logic
select distinct
    cashflow_id,
    fund_id,
    portfolio_id,
    cast(cashflow_date as date) as cashflow_date,
    cashflow_type,
    cast(amount as numeric(18,2)) as amount,
    currency,
    description,
    investor_id,
    -- Anti-pattern: duplicated fiscal quarter logic (same as stg_trades, stg_portfolios)
    case
        when extract(month from cast(cashflow_date as date)) between 1 and 3 then 'Q3'
        when extract(month from cast(cashflow_date as date)) between 4 and 6 then 'Q4'
        when extract(month from cast(cashflow_date as date)) between 7 and 9 then 'Q1'
        when extract(month from cast(cashflow_date as date)) between 10 and 12 then 'Q2'
    end as cashflow_fiscal_quarter,
    -- Anti-pattern: PostgreSQL-specific extract
    extract(year from cast(cashflow_date as date)) as cashflow_year
from "bain_analytics"."public_raw"."raw_cashflows"
  );
[0m19:30:15.266140 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.stg_fund_structures"
[0m19:30:15.266459 [debug] [Thread-3  ]: On model.bain_capital_analytics.stg_dates: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_dates"} */
alter table "bain_analytics"."public"."stg_dates" rename to "stg_dates__dbt_backup"
[0m19:30:15.269318 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.stg_benchmarks"
[0m19:30:15.269684 [debug] [Thread-4  ]: On model.bain_capital_analytics.stg_fund_structures: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_fund_structures"} */
alter table "bain_analytics"."public"."stg_fund_structures" rename to "stg_fund_structures__dbt_backup"
[0m19:30:15.270036 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_benchmarks: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_benchmarks"} */
alter table "bain_analytics"."public"."stg_benchmarks" rename to "stg_benchmarks__dbt_backup"
[0m19:30:15.270691 [debug] [Thread-3  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m19:30:15.273904 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.stg_dates"
[0m19:30:15.274214 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.004 seconds
[0m19:30:15.274522 [debug] [Thread-4  ]: SQL status: ALTER TABLE in 0.004 seconds
[0m19:30:15.274792 [debug] [Thread-2  ]: SQL status: CREATE VIEW in 0.005 seconds
[0m19:30:15.275076 [debug] [Thread-3  ]: On model.bain_capital_analytics.stg_dates: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_dates"} */
alter table "bain_analytics"."public"."stg_dates__dbt_tmp" rename to "stg_dates"
[0m19:30:15.277776 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.stg_benchmarks"
[0m19:30:15.280382 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.stg_fund_structures"
[0m19:30:15.283317 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.stg_cashflows"
[0m19:30:15.283680 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_benchmarks: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_benchmarks"} */
alter table "bain_analytics"."public"."stg_benchmarks__dbt_tmp" rename to "stg_benchmarks"
[0m19:30:15.284046 [debug] [Thread-4  ]: On model.bain_capital_analytics.stg_fund_structures: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_fund_structures"} */
alter table "bain_analytics"."public"."stg_fund_structures__dbt_tmp" rename to "stg_fund_structures"
[0m19:30:15.284368 [debug] [Thread-3  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m19:30:15.284668 [debug] [Thread-2  ]: On model.bain_capital_analytics.stg_cashflows: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_cashflows"} */
alter table "bain_analytics"."public"."stg_cashflows" rename to "stg_cashflows__dbt_backup"
[0m19:30:15.291324 [debug] [Thread-4  ]: SQL status: ALTER TABLE in 0.006 seconds
[0m19:30:15.291609 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.007 seconds
[0m19:30:15.299225 [debug] [Thread-3  ]: On model.bain_capital_analytics.stg_dates: COMMIT
[0m19:30:15.300356 [debug] [Thread-4  ]: On model.bain_capital_analytics.stg_fund_structures: COMMIT
[0m19:30:15.301449 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_benchmarks: COMMIT
[0m19:30:15.301769 [debug] [Thread-2  ]: SQL status: ALTER TABLE in 0.002 seconds
[0m19:30:15.302076 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.stg_dates"
[0m19:30:15.302387 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.stg_fund_structures"
[0m19:30:15.302684 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.stg_benchmarks"
[0m19:30:15.305493 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.stg_cashflows"
[0m19:30:15.305804 [debug] [Thread-3  ]: On model.bain_capital_analytics.stg_dates: COMMIT
[0m19:30:15.306115 [debug] [Thread-4  ]: On model.bain_capital_analytics.stg_fund_structures: COMMIT
[0m19:30:15.306402 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_benchmarks: COMMIT
[0m19:30:15.306694 [debug] [Thread-2  ]: On model.bain_capital_analytics.stg_cashflows: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_cashflows"} */
alter table "bain_analytics"."public"."stg_cashflows__dbt_tmp" rename to "stg_cashflows"
[0m19:30:15.308832 [debug] [Thread-2  ]: SQL status: ALTER TABLE in 0.002 seconds
[0m19:30:15.309929 [debug] [Thread-2  ]: On model.bain_capital_analytics.stg_cashflows: COMMIT
[0m19:30:15.310265 [debug] [Thread-1  ]: SQL status: COMMIT in 0.003 seconds
[0m19:30:15.310546 [debug] [Thread-4  ]: SQL status: COMMIT in 0.004 seconds
[0m19:30:15.310823 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.stg_cashflows"
[0m19:30:15.311088 [debug] [Thread-3  ]: SQL status: COMMIT in 0.004 seconds
[0m19:30:15.356367 [debug] [Thread-1  ]: Applying DROP to: "bain_analytics"."public"."stg_benchmarks__dbt_backup"
[0m19:30:15.358963 [debug] [Thread-4  ]: Applying DROP to: "bain_analytics"."public"."stg_fund_structures__dbt_backup"
[0m19:30:15.359313 [debug] [Thread-2  ]: On model.bain_capital_analytics.stg_cashflows: COMMIT
[0m19:30:15.361586 [debug] [Thread-3  ]: Applying DROP to: "bain_analytics"."public"."stg_dates__dbt_backup"
[0m19:30:15.362096 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.stg_benchmarks"
[0m19:30:15.362565 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.stg_fund_structures"
[0m19:30:15.363118 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.stg_dates"
[0m19:30:15.363476 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_benchmarks: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_benchmarks"} */
drop view if exists "bain_analytics"."public"."stg_benchmarks__dbt_backup" cascade
[0m19:30:15.363804 [debug] [Thread-4  ]: On model.bain_capital_analytics.stg_fund_structures: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_fund_structures"} */
drop view if exists "bain_analytics"."public"."stg_fund_structures__dbt_backup" cascade
[0m19:30:15.364108 [debug] [Thread-3  ]: On model.bain_capital_analytics.stg_dates: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_dates"} */
drop view if exists "bain_analytics"."public"."stg_dates__dbt_backup" cascade
[0m19:30:15.364490 [debug] [Thread-2  ]: SQL status: COMMIT in 0.002 seconds
[0m19:30:15.366852 [debug] [Thread-2  ]: Applying DROP to: "bain_analytics"."public"."stg_cashflows__dbt_backup"
[0m19:30:15.367319 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.stg_cashflows"
[0m19:30:15.367634 [debug] [Thread-4  ]: SQL status: DROP VIEW in 0.003 seconds
[0m19:30:15.367931 [debug] [Thread-2  ]: On model.bain_capital_analytics.stg_cashflows: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_cashflows"} */
drop view if exists "bain_analytics"."public"."stg_cashflows__dbt_backup" cascade
[0m19:30:15.370117 [debug] [Thread-4  ]: On model.bain_capital_analytics.stg_fund_structures: Close
[0m19:30:15.370461 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.006 seconds
[0m19:30:15.370772 [debug] [Thread-3  ]: SQL status: DROP VIEW in 0.006 seconds
[0m19:30:15.372378 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_benchmarks: Close
[0m19:30:15.372892 [debug] [Thread-2  ]: SQL status: DROP VIEW in 0.002 seconds
[0m19:30:15.374204 [debug] [Thread-3  ]: On model.bain_capital_analytics.stg_dates: Close
[0m19:30:15.375470 [debug] [Thread-2  ]: On model.bain_capital_analytics.stg_cashflows: Close
[0m19:30:15.376141 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '06decbc9-1bfd-415a-a35a-88ae35545da3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e332970>]}
[0m19:30:15.376446 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '06decbc9-1bfd-415a-a35a-88ae35545da3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e3b41c0>]}
[0m19:30:15.376802 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '06decbc9-1bfd-415a-a35a-88ae35545da3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e3c0f70>]}
[0m19:30:15.377093 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '06decbc9-1bfd-415a-a35a-88ae35545da3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e3f69d0>]}
[0m19:30:15.377545 [info ] [Thread-4  ]: 4 of 54 OK created sql view model public.stg_fund_structures ................... [[32mCREATE VIEW[0m in 0.21s]
[0m19:30:15.378198 [info ] [Thread-1  ]: 1 of 54 OK created sql view model public.stg_benchmarks ........................ [[32mCREATE VIEW[0m in 0.22s]
[0m19:30:15.378727 [info ] [Thread-3  ]: 3 of 54 OK created sql view model public.stg_dates ............................. [[32mCREATE VIEW[0m in 0.21s]
[0m19:30:15.379189 [debug] [Thread-4  ]: Finished running node model.bain_capital_analytics.stg_fund_structures
[0m19:30:15.379575 [info ] [Thread-2  ]: 2 of 54 OK created sql view model public.stg_cashflows ......................... [[32mCREATE VIEW[0m in 0.22s]
[0m19:30:15.380023 [debug] [Thread-1  ]: Finished running node model.bain_capital_analytics.stg_benchmarks
[0m19:30:15.380424 [debug] [Thread-3  ]: Finished running node model.bain_capital_analytics.stg_dates
[0m19:30:15.380757 [debug] [Thread-4  ]: Began running node model.bain_capital_analytics.stg_instruments
[0m19:30:15.381258 [debug] [Thread-2  ]: Finished running node model.bain_capital_analytics.stg_cashflows
[0m19:30:15.381670 [debug] [Thread-1  ]: Began running node model.bain_capital_analytics.stg_portfolios
[0m19:30:15.382014 [debug] [Thread-3  ]: Began running node model.bain_capital_analytics.stg_positions
[0m19:30:15.382571 [info ] [Thread-4  ]: 5 of 54 START sql view model public.stg_instruments ............................ [RUN]
[0m19:30:15.382946 [debug] [Thread-2  ]: Began running node model.bain_capital_analytics.stg_valuations
[0m19:30:15.383401 [info ] [Thread-1  ]: 6 of 54 START sql view model public.stg_portfolios ............................. [RUN]
[0m19:30:15.383901 [info ] [Thread-3  ]: 7 of 54 START sql view model public.stg_positions .............................. [RUN]
[0m19:30:15.384297 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly model.bain_capital_analytics.stg_fund_structures, now model.bain_capital_analytics.stg_instruments)
[0m19:30:15.384703 [info ] [Thread-2  ]: 8 of 54 START sql view model public.stg_valuations ............................. [RUN]
[0m19:30:15.385059 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.bain_capital_analytics.stg_benchmarks, now model.bain_capital_analytics.stg_portfolios)
[0m19:30:15.385386 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly model.bain_capital_analytics.stg_dates, now model.bain_capital_analytics.stg_positions)
[0m19:30:15.385705 [debug] [Thread-4  ]: Began compiling node model.bain_capital_analytics.stg_instruments
[0m19:30:15.386018 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly model.bain_capital_analytics.stg_cashflows, now model.bain_capital_analytics.stg_valuations)
[0m19:30:15.386321 [debug] [Thread-1  ]: Began compiling node model.bain_capital_analytics.stg_portfolios
[0m19:30:15.386611 [debug] [Thread-3  ]: Began compiling node model.bain_capital_analytics.stg_positions
[0m19:30:15.389568 [debug] [Thread-4  ]: Writing injected SQL for node "model.bain_capital_analytics.stg_instruments"
[0m19:30:15.389887 [debug] [Thread-2  ]: Began compiling node model.bain_capital_analytics.stg_valuations
[0m19:30:15.392510 [debug] [Thread-1  ]: Writing injected SQL for node "model.bain_capital_analytics.stg_portfolios"
[0m19:30:15.396369 [debug] [Thread-3  ]: Writing injected SQL for node "model.bain_capital_analytics.stg_positions"
[0m19:30:15.399107 [debug] [Thread-2  ]: Writing injected SQL for node "model.bain_capital_analytics.stg_valuations"
[0m19:30:15.399869 [debug] [Thread-4  ]: Began executing node model.bain_capital_analytics.stg_instruments
[0m19:30:15.403357 [debug] [Thread-4  ]: Writing runtime sql for node "model.bain_capital_analytics.stg_instruments"
[0m19:30:15.403879 [debug] [Thread-2  ]: Began executing node model.bain_capital_analytics.stg_valuations
[0m19:30:15.404227 [debug] [Thread-1  ]: Began executing node model.bain_capital_analytics.stg_portfolios
[0m19:30:15.404533 [debug] [Thread-3  ]: Began executing node model.bain_capital_analytics.stg_positions
[0m19:30:15.409463 [debug] [Thread-2  ]: Applying DROP to: "bain_analytics"."public"."stg_valuations__dbt_backup"
[0m19:30:15.413299 [debug] [Thread-1  ]: Writing runtime sql for node "model.bain_capital_analytics.stg_portfolios"
[0m19:30:15.413686 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.stg_instruments"
[0m19:30:15.416918 [debug] [Thread-3  ]: Writing runtime sql for node "model.bain_capital_analytics.stg_positions"
[0m19:30:15.417404 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.stg_valuations"
[0m19:30:15.417785 [debug] [Thread-4  ]: On model.bain_capital_analytics.stg_instruments: BEGIN
[0m19:30:15.418189 [debug] [Thread-2  ]: On model.bain_capital_analytics.stg_valuations: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_valuations"} */
drop view if exists "bain_analytics"."public"."stg_valuations__dbt_backup" cascade
[0m19:30:15.418522 [debug] [Thread-4  ]: Opening a new connection, currently in state closed
[0m19:30:15.418859 [debug] [Thread-2  ]: Opening a new connection, currently in state closed
[0m19:30:15.419188 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.stg_portfolios"
[0m19:30:15.419538 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.stg_positions"
[0m19:30:15.420033 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_portfolios: BEGIN
[0m19:30:15.420333 [debug] [Thread-3  ]: On model.bain_capital_analytics.stg_positions: BEGIN
[0m19:30:15.420639 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m19:30:15.420946 [debug] [Thread-3  ]: Opening a new connection, currently in state closed
[0m19:30:15.435090 [debug] [Thread-1  ]: SQL status: BEGIN in 0.014 seconds
[0m19:30:15.435416 [debug] [Thread-4  ]: SQL status: BEGIN in 0.017 seconds
[0m19:30:15.435707 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.stg_portfolios"
[0m19:30:15.436043 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.stg_instruments"
[0m19:30:15.436407 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_portfolios: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_portfolios"} */

  create view "bain_analytics"."public"."stg_portfolios__dbt_tmp"
    
    
  as (
    -- Anti-pattern: unnecessary DISTINCT when source data is already unique
-- Anti-pattern: casting in every model instead of once upstream

select distinct
    cast(portfolio_id as varchar(10)) as portfolio_id,
    cast(portfolio_name as varchar(100)) as portfolio_name,
    cast(strategy as varchar(50)) as strategy,
    cast(inception_date as date) as inception_date,
    cast(fund_id as varchar(10)) as fund_id,
    cast(manager_name as varchar(100)) as manager_name,
    cast(is_active as boolean) as is_active,
    -- Anti-pattern: duplicated fiscal quarter logic (repeated in many models)
    case
        when extract(month from cast(inception_date as date)) between 1 and 3 then 'Q3'
        when extract(month from cast(inception_date as date)) between 4 and 6 then 'Q4'
        when extract(month from cast(inception_date as date)) between 7 and 9 then 'Q1'
        when extract(month from cast(inception_date as date)) between 10 and 12 then 'Q2'
    end as inception_fiscal_quarter
from "bain_analytics"."public_raw"."raw_portfolios"
where cast(is_active as boolean) = true
  );
[0m19:30:15.436755 [debug] [Thread-3  ]: SQL status: BEGIN in 0.016 seconds
[0m19:30:15.437066 [debug] [Thread-4  ]: On model.bain_capital_analytics.stg_instruments: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_instruments"} */

  create view "bain_analytics"."public"."stg_instruments__dbt_tmp"
    
    
  as (
    -- Anti-pattern: unnecessary DISTINCT
select distinct
    instrument_id,
    instrument_name,
    instrument_type,
    sector,
    currency,
    exchange,
    issuer,
    cast(maturity_date as date) as maturity_date,
    -- Anti-pattern: PostgreSQL-specific date subtraction
    case
        when maturity_date is not null
        then cast(maturity_date as date) - current_date
        else null
    end as days_to_maturity,
    case
        when instrument_type in ('equity', 'futures') then 'liquid'
        when instrument_type in ('corporate_bond', 'government_bond', 'sovereign_bond', 'leveraged_loan') then 'semi_liquid'
        when instrument_type in ('private_equity', 'venture_capital', 'real_estate', 'real_estate_debt', 'infrastructure') then 'illiquid'
        else 'other'
    end as liquidity_class
from "bain_analytics"."public_raw"."raw_instruments"
  );
[0m19:30:15.437414 [debug] [Thread-2  ]: SQL status: DROP VIEW in 0.019 seconds
[0m19:30:15.437734 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.stg_positions"
[0m19:30:15.438863 [debug] [Thread-2  ]: Writing runtime sql for node "model.bain_capital_analytics.stg_valuations"
[0m19:30:15.439221 [debug] [Thread-3  ]: On model.bain_capital_analytics.stg_positions: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_positions"} */

  create view "bain_analytics"."public"."stg_positions__dbt_tmp"
    
    
  as (
    -- Anti-pattern: unnecessary DISTINCT
-- Anti-pattern: no filtering or partitioning strategy

select distinct
    position_id,
    portfolio_id,
    instrument_id,
    cast(position_date as date) as position_date,
    cast(quantity as numeric(18,4)) as quantity,
    cast(market_value as numeric(18,2)) as market_value,
    cast(cost_basis as numeric(18,2)) as cost_basis,
    currency,
    -- Anti-pattern: computed column that could be done downstream
    cast(market_value as numeric(18,2)) - cast(cost_basis as numeric(18,2)) as unrealized_gain_loss,
    case
        when cast(cost_basis as numeric(18,2)) != 0
        then (cast(market_value as numeric(18,2)) - cast(cost_basis as numeric(18,2))) / abs(cast(cost_basis as numeric(18,2)))
        else 0
    end as unrealized_return_pct
from "bain_analytics"."public_raw"."raw_positions"
  );
[0m19:30:15.439782 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.stg_valuations"
[0m19:30:15.440076 [debug] [Thread-2  ]: On model.bain_capital_analytics.stg_valuations: BEGIN
[0m19:30:15.440986 [debug] [Thread-2  ]: SQL status: BEGIN in 0.001 seconds
[0m19:30:15.441279 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.stg_valuations"
[0m19:30:15.441607 [debug] [Thread-2  ]: On model.bain_capital_analytics.stg_valuations: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_valuations"} */

  create view "bain_analytics"."public"."stg_valuations__dbt_tmp"
    
    
  as (
    -- Anti-pattern: unnecessary DISTINCT
select distinct
    valuation_id,
    portfolio_id,
    cast(valuation_date as date) as valuation_date,
    cast(gross_asset_value as numeric(18,2)) as gross_asset_value,
    cast(net_asset_value as numeric(18,2)) as net_asset_value,
    cast(total_liabilities as numeric(18,2)) as total_liabilities,
    cast(unrealized_pnl as numeric(18,2)) as unrealized_pnl,
    cast(realized_pnl as numeric(18,2)) as realized_pnl,
    valuation_method,
    -- Anti-pattern: duplicated fiscal quarter logic
    case
        when extract(month from cast(valuation_date as date)) between 1 and 3 then 'Q3'
        when extract(month from cast(valuation_date as date)) between 4 and 6 then 'Q4'
        when extract(month from cast(valuation_date as date)) between 7 and 9 then 'Q1'
        when extract(month from cast(valuation_date as date)) between 10 and 12 then 'Q2'
    end as valuation_fiscal_quarter
from "bain_analytics"."public_raw"."raw_valuations"
  );
[0m19:30:15.441962 [debug] [Thread-4  ]: SQL status: CREATE VIEW in 0.004 seconds
[0m19:30:15.445062 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.stg_instruments"
[0m19:30:15.445381 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.008 seconds
[0m19:30:15.445673 [debug] [Thread-3  ]: SQL status: CREATE VIEW in 0.006 seconds
[0m19:30:15.445953 [debug] [Thread-2  ]: SQL status: CREATE VIEW in 0.004 seconds
[0m19:30:15.446242 [debug] [Thread-4  ]: On model.bain_capital_analytics.stg_instruments: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_instruments"} */
alter table "bain_analytics"."public"."stg_instruments" rename to "stg_instruments__dbt_backup"
[0m19:30:15.449167 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.stg_portfolios"
[0m19:30:15.452099 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.stg_positions"
[0m19:30:15.454998 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.stg_valuations"
[0m19:30:15.455364 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_portfolios: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_portfolios"} */
alter table "bain_analytics"."public"."stg_portfolios" rename to "stg_portfolios__dbt_backup"
[0m19:30:15.455685 [debug] [Thread-3  ]: On model.bain_capital_analytics.stg_positions: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_positions"} */
alter table "bain_analytics"."public"."stg_positions" rename to "stg_positions__dbt_backup"
[0m19:30:15.455993 [debug] [Thread-2  ]: On model.bain_capital_analytics.stg_valuations: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_valuations"} */
alter table "bain_analytics"."public"."stg_valuations" rename to "stg_valuations__dbt_backup"
[0m19:30:15.457006 [debug] [Thread-4  ]: SQL status: ALTER TABLE in 0.002 seconds
[0m19:30:15.459709 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.stg_instruments"
[0m19:30:15.460026 [debug] [Thread-3  ]: SQL status: ALTER TABLE in 0.003 seconds
[0m19:30:15.460310 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.003 seconds
[0m19:30:15.460582 [debug] [Thread-2  ]: SQL status: ALTER TABLE in 0.003 seconds
[0m19:30:15.460858 [debug] [Thread-4  ]: On model.bain_capital_analytics.stg_instruments: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_instruments"} */
alter table "bain_analytics"."public"."stg_instruments__dbt_tmp" rename to "stg_instruments"
[0m19:30:15.463503 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.stg_positions"
[0m19:30:15.466167 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.stg_portfolios"
[0m19:30:15.468746 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.stg_valuations"
[0m19:30:15.469115 [debug] [Thread-3  ]: On model.bain_capital_analytics.stg_positions: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_positions"} */
alter table "bain_analytics"."public"."stg_positions__dbt_tmp" rename to "stg_positions"
[0m19:30:15.469435 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_portfolios: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_portfolios"} */
alter table "bain_analytics"."public"."stg_portfolios__dbt_tmp" rename to "stg_portfolios"
[0m19:30:15.469735 [debug] [Thread-4  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m19:30:15.470023 [debug] [Thread-2  ]: On model.bain_capital_analytics.stg_valuations: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_valuations"} */
alter table "bain_analytics"."public"."stg_valuations__dbt_tmp" rename to "stg_valuations"
[0m19:30:15.471108 [debug] [Thread-4  ]: On model.bain_capital_analytics.stg_instruments: COMMIT
[0m19:30:15.471429 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m19:30:15.471705 [debug] [Thread-3  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m19:30:15.472021 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.stg_instruments"
[0m19:30:15.473029 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_portfolios: COMMIT
[0m19:30:15.473330 [debug] [Thread-2  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m19:30:15.474357 [debug] [Thread-3  ]: On model.bain_capital_analytics.stg_positions: COMMIT
[0m19:30:15.474689 [debug] [Thread-4  ]: On model.bain_capital_analytics.stg_instruments: COMMIT
[0m19:30:15.474988 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.stg_portfolios"
[0m19:30:15.475947 [debug] [Thread-2  ]: On model.bain_capital_analytics.stg_valuations: COMMIT
[0m19:30:15.476253 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.stg_positions"
[0m19:30:15.476683 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_portfolios: COMMIT
[0m19:30:15.476982 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.stg_valuations"
[0m19:30:15.477265 [debug] [Thread-3  ]: On model.bain_capital_analytics.stg_positions: COMMIT
[0m19:30:15.477596 [debug] [Thread-2  ]: On model.bain_capital_analytics.stg_valuations: COMMIT
[0m19:30:15.478373 [debug] [Thread-4  ]: SQL status: COMMIT in 0.002 seconds
[0m19:30:15.480614 [debug] [Thread-4  ]: Applying DROP to: "bain_analytics"."public"."stg_instruments__dbt_backup"
[0m19:30:15.480929 [debug] [Thread-2  ]: SQL status: COMMIT in 0.003 seconds
[0m19:30:15.481210 [debug] [Thread-3  ]: SQL status: COMMIT in 0.003 seconds
[0m19:30:15.481664 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.stg_instruments"
[0m19:30:15.481993 [debug] [Thread-1  ]: SQL status: COMMIT in 0.004 seconds
[0m19:30:15.485126 [debug] [Thread-2  ]: Applying DROP to: "bain_analytics"."public"."stg_valuations__dbt_backup"
[0m19:30:15.487260 [debug] [Thread-3  ]: Applying DROP to: "bain_analytics"."public"."stg_positions__dbt_backup"
[0m19:30:15.487576 [debug] [Thread-4  ]: On model.bain_capital_analytics.stg_instruments: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_instruments"} */
drop view if exists "bain_analytics"."public"."stg_instruments__dbt_backup" cascade
[0m19:30:15.489666 [debug] [Thread-1  ]: Applying DROP to: "bain_analytics"."public"."stg_portfolios__dbt_backup"
[0m19:30:15.490123 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.stg_valuations"
[0m19:30:15.490630 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.stg_positions"
[0m19:30:15.491134 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.stg_portfolios"
[0m19:30:15.491443 [debug] [Thread-2  ]: On model.bain_capital_analytics.stg_valuations: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_valuations"} */
drop view if exists "bain_analytics"."public"."stg_valuations__dbt_backup" cascade
[0m19:30:15.491746 [debug] [Thread-3  ]: On model.bain_capital_analytics.stg_positions: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_positions"} */
drop view if exists "bain_analytics"."public"."stg_positions__dbt_backup" cascade
[0m19:30:15.492039 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_portfolios: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_portfolios"} */
drop view if exists "bain_analytics"."public"."stg_portfolios__dbt_backup" cascade
[0m19:30:15.495080 [debug] [Thread-2  ]: SQL status: DROP VIEW in 0.003 seconds
[0m19:30:15.496057 [debug] [Thread-2  ]: On model.bain_capital_analytics.stg_valuations: Close
[0m19:30:15.496365 [debug] [Thread-4  ]: SQL status: DROP VIEW in 0.005 seconds
[0m19:30:15.496866 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '06decbc9-1bfd-415a-a35a-88ae35545da3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ddf9be0>]}
[0m19:30:15.497838 [debug] [Thread-4  ]: On model.bain_capital_analytics.stg_instruments: Close
[0m19:30:15.498222 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.006 seconds
[0m19:30:15.498501 [debug] [Thread-3  ]: SQL status: DROP VIEW in 0.006 seconds
[0m19:30:15.499052 [info ] [Thread-2  ]: 8 of 54 OK created sql view model public.stg_valuations ........................ [[32mCREATE VIEW[0m in 0.11s]
[0m19:30:15.499496 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '06decbc9-1bfd-415a-a35a-88ae35545da3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e326130>]}
[0m19:30:15.500459 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_portfolios: Close
[0m19:30:15.501393 [debug] [Thread-3  ]: On model.bain_capital_analytics.stg_positions: Close
[0m19:30:15.501835 [debug] [Thread-2  ]: Finished running node model.bain_capital_analytics.stg_valuations
[0m19:30:15.502375 [info ] [Thread-4  ]: 5 of 54 OK created sql view model public.stg_instruments ....................... [[32mCREATE VIEW[0m in 0.12s]
[0m19:30:15.502808 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '06decbc9-1bfd-415a-a35a-88ae35545da3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ddf9250>]}
[0m19:30:15.503232 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '06decbc9-1bfd-415a-a35a-88ae35545da3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e3fcbe0>]}
[0m19:30:15.503568 [debug] [Thread-2  ]: Began running node test.bain_capital_analytics.not_null_stg_fund_structures_fund_id.a284274f31
[0m19:30:15.504079 [debug] [Thread-4  ]: Finished running node model.bain_capital_analytics.stg_instruments
[0m19:30:15.504695 [info ] [Thread-1  ]: 6 of 54 OK created sql view model public.stg_portfolios ........................ [[32mCREATE VIEW[0m in 0.12s]
[0m19:30:15.505173 [info ] [Thread-3  ]: 7 of 54 OK created sql view model public.stg_positions ......................... [[32mCREATE VIEW[0m in 0.12s]
[0m19:30:15.505529 [info ] [Thread-2  ]: 9 of 54 START test not_null_stg_fund_structures_fund_id ........................ [RUN]
[0m19:30:15.505886 [debug] [Thread-4  ]: Began running node test.bain_capital_analytics.unique_stg_fund_structures_fund_id.bb9fec42ab
[0m19:30:15.506372 [debug] [Thread-1  ]: Finished running node model.bain_capital_analytics.stg_portfolios
[0m19:30:15.506849 [debug] [Thread-3  ]: Finished running node model.bain_capital_analytics.stg_positions
[0m19:30:15.507197 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly model.bain_capital_analytics.stg_valuations, now test.bain_capital_analytics.not_null_stg_fund_structures_fund_id.a284274f31)
[0m19:30:15.507524 [info ] [Thread-4  ]: 10 of 54 START test unique_stg_fund_structures_fund_id ......................... [RUN]
[0m19:30:15.507878 [debug] [Thread-1  ]: Began running node test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_date.d5c8f88f3e
[0m19:30:15.508263 [debug] [Thread-3  ]: Began running node test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_id.ec87e4ee58
[0m19:30:15.508711 [debug] [Thread-2  ]: Began compiling node test.bain_capital_analytics.not_null_stg_fund_structures_fund_id.a284274f31
[0m19:30:15.509138 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly model.bain_capital_analytics.stg_instruments, now test.bain_capital_analytics.unique_stg_fund_structures_fund_id.bb9fec42ab)
[0m19:30:15.509469 [info ] [Thread-1  ]: 11 of 54 START test not_null_stg_benchmarks_benchmark_date ..................... [RUN]
[0m19:30:15.509794 [info ] [Thread-3  ]: 12 of 54 START test not_null_stg_benchmarks_benchmark_id ....................... [RUN]
[0m19:30:15.520423 [debug] [Thread-2  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_stg_fund_structures_fund_id.a284274f31"
[0m19:30:15.520772 [debug] [Thread-4  ]: Began compiling node test.bain_capital_analytics.unique_stg_fund_structures_fund_id.bb9fec42ab
[0m19:30:15.521135 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.bain_capital_analytics.stg_portfolios, now test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_date.d5c8f88f3e)
[0m19:30:15.521470 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly model.bain_capital_analytics.stg_positions, now test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_id.ec87e4ee58)
[0m19:30:15.527048 [debug] [Thread-4  ]: Writing injected SQL for node "test.bain_capital_analytics.unique_stg_fund_structures_fund_id.bb9fec42ab"
[0m19:30:15.527382 [debug] [Thread-1  ]: Began compiling node test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_date.d5c8f88f3e
[0m19:30:15.527714 [debug] [Thread-3  ]: Began compiling node test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_id.ec87e4ee58
[0m19:30:15.528044 [debug] [Thread-2  ]: Began executing node test.bain_capital_analytics.not_null_stg_fund_structures_fund_id.a284274f31
[0m19:30:15.532648 [debug] [Thread-1  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_date.d5c8f88f3e"
[0m19:30:15.536069 [debug] [Thread-3  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_id.ec87e4ee58"
[0m19:30:15.549014 [debug] [Thread-4  ]: Began executing node test.bain_capital_analytics.unique_stg_fund_structures_fund_id.bb9fec42ab
[0m19:30:15.551496 [debug] [Thread-2  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_stg_fund_structures_fund_id.a284274f31"
[0m19:30:15.553827 [debug] [Thread-4  ]: Writing runtime sql for node "test.bain_capital_analytics.unique_stg_fund_structures_fund_id.bb9fec42ab"
[0m19:30:15.554398 [debug] [Thread-1  ]: Began executing node test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_date.d5c8f88f3e
[0m19:30:15.554775 [debug] [Thread-2  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_fund_structures_fund_id.a284274f31"
[0m19:30:15.555072 [debug] [Thread-3  ]: Began executing node test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_id.ec87e4ee58
[0m19:30:15.557223 [debug] [Thread-1  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_date.d5c8f88f3e"
[0m19:30:15.557576 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_stg_fund_structures_fund_id.a284274f31: BEGIN
[0m19:30:15.559857 [debug] [Thread-3  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_id.ec87e4ee58"
[0m19:30:15.560217 [debug] [Thread-4  ]: Using postgres connection "test.bain_capital_analytics.unique_stg_fund_structures_fund_id.bb9fec42ab"
[0m19:30:15.560570 [debug] [Thread-2  ]: Opening a new connection, currently in state closed
[0m19:30:15.560967 [debug] [Thread-4  ]: On test.bain_capital_analytics.unique_stg_fund_structures_fund_id.bb9fec42ab: BEGIN
[0m19:30:15.561298 [debug] [Thread-1  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_date.d5c8f88f3e"
[0m19:30:15.561712 [debug] [Thread-4  ]: Opening a new connection, currently in state closed
[0m19:30:15.562051 [debug] [Thread-3  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_id.ec87e4ee58"
[0m19:30:15.563130 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_date.d5c8f88f3e: BEGIN
[0m19:30:15.563542 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_id.ec87e4ee58: BEGIN
[0m19:30:15.563848 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m19:30:15.564157 [debug] [Thread-3  ]: Opening a new connection, currently in state closed
[0m19:30:15.574310 [debug] [Thread-2  ]: SQL status: BEGIN in 0.014 seconds
[0m19:30:15.574636 [debug] [Thread-4  ]: SQL status: BEGIN in 0.013 seconds
[0m19:30:15.574935 [debug] [Thread-2  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_fund_structures_fund_id.a284274f31"
[0m19:30:15.575304 [debug] [Thread-4  ]: Using postgres connection "test.bain_capital_analytics.unique_stg_fund_structures_fund_id.bb9fec42ab"
[0m19:30:15.575630 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_stg_fund_structures_fund_id.a284274f31: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_stg_fund_structures_fund_id.a284274f31"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select fund_id
from "bain_analytics"."public"."stg_fund_structures"
where fund_id is null



  
  
      
    ) dbt_internal_test
[0m19:30:15.575959 [debug] [Thread-1  ]: SQL status: BEGIN in 0.012 seconds
[0m19:30:15.576261 [debug] [Thread-3  ]: SQL status: BEGIN in 0.012 seconds
[0m19:30:15.576559 [debug] [Thread-4  ]: On test.bain_capital_analytics.unique_stg_fund_structures_fund_id.bb9fec42ab: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.unique_stg_fund_structures_fund_id.bb9fec42ab"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

select
    fund_id as unique_field,
    count(*) as n_records

from "bain_analytics"."public"."stg_fund_structures"
where fund_id is not null
group by fund_id
having count(*) > 1



  
  
      
    ) dbt_internal_test
[0m19:30:15.576916 [debug] [Thread-1  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_date.d5c8f88f3e"
[0m19:30:15.577213 [debug] [Thread-3  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_id.ec87e4ee58"
[0m19:30:15.577566 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_date.d5c8f88f3e: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_date.d5c8f88f3e"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select benchmark_date
from "bain_analytics"."public"."stg_benchmarks"
where benchmark_date is null



  
  
      
    ) dbt_internal_test
[0m19:30:15.577901 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_id.ec87e4ee58: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_id.ec87e4ee58"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select benchmark_id
from "bain_analytics"."public"."stg_benchmarks"
where benchmark_id is null



  
  
      
    ) dbt_internal_test
[0m19:30:15.578818 [debug] [Thread-2  ]: SQL status: SELECT 1 in 0.002 seconds
[0m19:30:15.581675 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_stg_fund_structures_fund_id.a284274f31: ROLLBACK
[0m19:30:15.582152 [debug] [Thread-4  ]: SQL status: SELECT 1 in 0.005 seconds
[0m19:30:15.582505 [debug] [Thread-3  ]: SQL status: SELECT 1 in 0.004 seconds
[0m19:30:15.582828 [debug] [Thread-1  ]: SQL status: SELECT 1 in 0.005 seconds
[0m19:30:15.583149 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_stg_fund_structures_fund_id.a284274f31: Close
[0m19:30:15.584345 [debug] [Thread-4  ]: On test.bain_capital_analytics.unique_stg_fund_structures_fund_id.bb9fec42ab: ROLLBACK
[0m19:30:15.585421 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_id.ec87e4ee58: ROLLBACK
[0m19:30:15.586457 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_date.d5c8f88f3e: ROLLBACK
[0m19:30:15.586989 [info ] [Thread-2  ]: 9 of 54 PASS not_null_stg_fund_structures_fund_id .............................. [[32mPASS[0m in 0.08s]
[0m19:30:15.587558 [debug] [Thread-2  ]: Finished running node test.bain_capital_analytics.not_null_stg_fund_structures_fund_id.a284274f31
[0m19:30:15.587854 [debug] [Thread-4  ]: On test.bain_capital_analytics.unique_stg_fund_structures_fund_id.bb9fec42ab: Close
[0m19:30:15.588126 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_id.ec87e4ee58: Close
[0m19:30:15.588388 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_date.d5c8f88f3e: Close
[0m19:30:15.588698 [debug] [Thread-2  ]: Began running node test.bain_capital_analytics.not_null_stg_dates_date_day.f3ec4da188
[0m19:30:15.589211 [info ] [Thread-4  ]: 10 of 54 PASS unique_stg_fund_structures_fund_id ............................... [[32mPASS[0m in 0.08s]
[0m19:30:15.589657 [info ] [Thread-3  ]: 12 of 54 PASS not_null_stg_benchmarks_benchmark_id ............................. [[32mPASS[0m in 0.07s]
[0m19:30:15.590095 [info ] [Thread-1  ]: 11 of 54 PASS not_null_stg_benchmarks_benchmark_date ........................... [[32mPASS[0m in 0.07s]
[0m19:30:15.590418 [info ] [Thread-2  ]: 13 of 54 START test not_null_stg_dates_date_day ................................ [RUN]
[0m19:30:15.590845 [debug] [Thread-4  ]: Finished running node test.bain_capital_analytics.unique_stg_fund_structures_fund_id.bb9fec42ab
[0m19:30:15.591251 [debug] [Thread-3  ]: Finished running node test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_id.ec87e4ee58
[0m19:30:15.591650 [debug] [Thread-1  ]: Finished running node test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_date.d5c8f88f3e
[0m19:30:15.591971 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.not_null_stg_fund_structures_fund_id.a284274f31, now test.bain_capital_analytics.not_null_stg_dates_date_day.f3ec4da188)
[0m19:30:15.592315 [debug] [Thread-4  ]: Began running node test.bain_capital_analytics.unique_stg_dates_date_day.e062be8e28
[0m19:30:15.592677 [debug] [Thread-3  ]: Began running node test.bain_capital_analytics.not_null_stg_cashflows_cashflow_id.4176024898
[0m19:30:15.593044 [debug] [Thread-1  ]: Began running node test.bain_capital_analytics.not_null_stg_cashflows_fund_id.7ff8a45dde
[0m19:30:15.593369 [debug] [Thread-2  ]: Began compiling node test.bain_capital_analytics.not_null_stg_dates_date_day.f3ec4da188
[0m19:30:15.593684 [info ] [Thread-4  ]: 14 of 54 START test unique_stg_dates_date_day .................................. [RUN]
[0m19:30:15.594008 [info ] [Thread-3  ]: 15 of 54 START test not_null_stg_cashflows_cashflow_id ......................... [RUN]
[0m19:30:15.594320 [info ] [Thread-1  ]: 16 of 54 START test not_null_stg_cashflows_fund_id ............................. [RUN]
[0m19:30:15.598272 [debug] [Thread-2  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_stg_dates_date_day.f3ec4da188"
[0m19:30:15.598665 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.unique_stg_fund_structures_fund_id.bb9fec42ab, now test.bain_capital_analytics.unique_stg_dates_date_day.e062be8e28)
[0m19:30:15.599011 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_id.ec87e4ee58, now test.bain_capital_analytics.not_null_stg_cashflows_cashflow_id.4176024898)
[0m19:30:15.599330 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_date.d5c8f88f3e, now test.bain_capital_analytics.not_null_stg_cashflows_fund_id.7ff8a45dde)
[0m19:30:15.599699 [debug] [Thread-4  ]: Began compiling node test.bain_capital_analytics.unique_stg_dates_date_day.e062be8e28
[0m19:30:15.600035 [debug] [Thread-3  ]: Began compiling node test.bain_capital_analytics.not_null_stg_cashflows_cashflow_id.4176024898
[0m19:30:15.600364 [debug] [Thread-1  ]: Began compiling node test.bain_capital_analytics.not_null_stg_cashflows_fund_id.7ff8a45dde
[0m19:30:15.603808 [debug] [Thread-4  ]: Writing injected SQL for node "test.bain_capital_analytics.unique_stg_dates_date_day.e062be8e28"
[0m19:30:15.604130 [debug] [Thread-2  ]: Began executing node test.bain_capital_analytics.not_null_stg_dates_date_day.f3ec4da188
[0m19:30:15.607359 [debug] [Thread-3  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_stg_cashflows_cashflow_id.4176024898"
[0m19:30:15.610594 [debug] [Thread-1  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_stg_cashflows_fund_id.7ff8a45dde"
[0m19:30:15.612917 [debug] [Thread-2  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_stg_dates_date_day.f3ec4da188"
[0m19:30:15.613511 [debug] [Thread-4  ]: Began executing node test.bain_capital_analytics.unique_stg_dates_date_day.e062be8e28
[0m19:30:15.613828 [debug] [Thread-3  ]: Began executing node test.bain_capital_analytics.not_null_stg_cashflows_cashflow_id.4176024898
[0m19:30:15.617053 [debug] [Thread-4  ]: Writing runtime sql for node "test.bain_capital_analytics.unique_stg_dates_date_day.e062be8e28"
[0m19:30:15.617411 [debug] [Thread-1  ]: Began executing node test.bain_capital_analytics.not_null_stg_cashflows_fund_id.7ff8a45dde
[0m19:30:15.619526 [debug] [Thread-3  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_stg_cashflows_cashflow_id.4176024898"
[0m19:30:15.619931 [debug] [Thread-2  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_dates_date_day.f3ec4da188"
[0m19:30:15.622048 [debug] [Thread-1  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_stg_cashflows_fund_id.7ff8a45dde"
[0m19:30:15.622463 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_stg_dates_date_day.f3ec4da188: BEGIN
[0m19:30:15.622814 [debug] [Thread-4  ]: Using postgres connection "test.bain_capital_analytics.unique_stg_dates_date_day.e062be8e28"
[0m19:30:15.623184 [debug] [Thread-2  ]: Opening a new connection, currently in state closed
[0m19:30:15.623574 [debug] [Thread-3  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_cashflows_cashflow_id.4176024898"
[0m19:30:15.623885 [debug] [Thread-4  ]: On test.bain_capital_analytics.unique_stg_dates_date_day.e062be8e28: BEGIN
[0m19:30:15.624305 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_stg_cashflows_cashflow_id.4176024898: BEGIN
[0m19:30:15.624625 [debug] [Thread-1  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_cashflows_fund_id.7ff8a45dde"
[0m19:30:15.624925 [debug] [Thread-4  ]: Opening a new connection, currently in state closed
[0m19:30:15.625226 [debug] [Thread-3  ]: Opening a new connection, currently in state closed
[0m19:30:15.625526 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_stg_cashflows_fund_id.7ff8a45dde: BEGIN
[0m19:30:15.625995 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m19:30:15.637253 [debug] [Thread-2  ]: SQL status: BEGIN in 0.014 seconds
[0m19:30:15.637546 [debug] [Thread-2  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_dates_date_day.f3ec4da188"
[0m19:30:15.637850 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_stg_dates_date_day.f3ec4da188: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_stg_dates_date_day.f3ec4da188"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select date_day
from "bain_analytics"."public"."stg_dates"
where date_day is null



  
  
      
    ) dbt_internal_test
[0m19:30:15.638885 [debug] [Thread-4  ]: SQL status: BEGIN in 0.014 seconds
[0m19:30:15.639191 [debug] [Thread-3  ]: SQL status: BEGIN in 0.014 seconds
[0m19:30:15.639467 [debug] [Thread-4  ]: Using postgres connection "test.bain_capital_analytics.unique_stg_dates_date_day.e062be8e28"
[0m19:30:15.639732 [debug] [Thread-1  ]: SQL status: BEGIN in 0.014 seconds
[0m19:30:15.640034 [debug] [Thread-2  ]: SQL status: SELECT 1 in 0.002 seconds
[0m19:30:15.640313 [debug] [Thread-3  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_cashflows_cashflow_id.4176024898"
[0m19:30:15.640618 [debug] [Thread-4  ]: On test.bain_capital_analytics.unique_stg_dates_date_day.e062be8e28: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.unique_stg_dates_date_day.e062be8e28"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

select
    date_day as unique_field,
    count(*) as n_records

from "bain_analytics"."public"."stg_dates"
where date_day is not null
group by date_day
having count(*) > 1



  
  
      
    ) dbt_internal_test
[0m19:30:15.640932 [debug] [Thread-1  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_cashflows_fund_id.7ff8a45dde"
[0m19:30:15.642163 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_stg_dates_date_day.f3ec4da188: ROLLBACK
[0m19:30:15.642488 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_stg_cashflows_cashflow_id.4176024898: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_stg_cashflows_cashflow_id.4176024898"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select cashflow_id
from "bain_analytics"."public"."stg_cashflows"
where cashflow_id is null



  
  
      
    ) dbt_internal_test
[0m19:30:15.642852 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_stg_cashflows_fund_id.7ff8a45dde: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_stg_cashflows_fund_id.7ff8a45dde"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select fund_id
from "bain_analytics"."public"."stg_cashflows"
where fund_id is null



  
  
      
    ) dbt_internal_test
[0m19:30:15.643538 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_stg_dates_date_day.f3ec4da188: Close
[0m19:30:15.643993 [info ] [Thread-2  ]: 13 of 54 PASS not_null_stg_dates_date_day ...................................... [[32mPASS[0m in 0.05s]
[0m19:30:15.644441 [debug] [Thread-2  ]: Finished running node test.bain_capital_analytics.not_null_stg_dates_date_day.f3ec4da188
[0m19:30:15.644765 [debug] [Thread-2  ]: Began running node test.bain_capital_analytics.not_null_stg_cashflows_portfolio_id.cbd1d93e57
[0m19:30:15.645068 [debug] [Thread-4  ]: SQL status: SELECT 1 in 0.002 seconds
[0m19:30:15.645426 [info ] [Thread-2  ]: 17 of 54 START test not_null_stg_cashflows_portfolio_id ........................ [RUN]
[0m19:30:15.645741 [debug] [Thread-3  ]: SQL status: SELECT 1 in 0.003 seconds
[0m19:30:15.646825 [debug] [Thread-4  ]: On test.bain_capital_analytics.unique_stg_dates_date_day.e062be8e28: ROLLBACK
[0m19:30:15.647120 [debug] [Thread-1  ]: SQL status: SELECT 1 in 0.004 seconds
[0m19:30:15.647464 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.not_null_stg_dates_date_day.f3ec4da188, now test.bain_capital_analytics.not_null_stg_cashflows_portfolio_id.cbd1d93e57)
[0m19:30:15.648527 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_stg_cashflows_cashflow_id.4176024898: ROLLBACK
[0m19:30:15.649585 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_stg_cashflows_fund_id.7ff8a45dde: ROLLBACK
[0m19:30:15.649908 [debug] [Thread-2  ]: Began compiling node test.bain_capital_analytics.not_null_stg_cashflows_portfolio_id.cbd1d93e57
[0m19:30:15.650184 [debug] [Thread-4  ]: On test.bain_capital_analytics.unique_stg_dates_date_day.e062be8e28: Close
[0m19:30:15.654082 [debug] [Thread-2  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_stg_cashflows_portfolio_id.cbd1d93e57"
[0m19:30:15.654406 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_stg_cashflows_fund_id.7ff8a45dde: Close
[0m19:30:15.654673 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_stg_cashflows_cashflow_id.4176024898: Close
[0m19:30:15.655119 [info ] [Thread-4  ]: 14 of 54 PASS unique_stg_dates_date_day ........................................ [[32mPASS[0m in 0.06s]
[0m19:30:15.655643 [info ] [Thread-1  ]: 16 of 54 PASS not_null_stg_cashflows_fund_id ................................... [[32mPASS[0m in 0.06s]
[0m19:30:15.656159 [info ] [Thread-3  ]: 15 of 54 PASS not_null_stg_cashflows_cashflow_id ............................... [[32mPASS[0m in 0.06s]
[0m19:30:15.656647 [debug] [Thread-4  ]: Finished running node test.bain_capital_analytics.unique_stg_dates_date_day.e062be8e28
[0m19:30:15.657067 [debug] [Thread-1  ]: Finished running node test.bain_capital_analytics.not_null_stg_cashflows_fund_id.7ff8a45dde
[0m19:30:15.657340 [debug] [Thread-2  ]: Began executing node test.bain_capital_analytics.not_null_stg_cashflows_portfolio_id.cbd1d93e57
[0m19:30:15.657734 [debug] [Thread-3  ]: Finished running node test.bain_capital_analytics.not_null_stg_cashflows_cashflow_id.4176024898
[0m19:30:15.658050 [debug] [Thread-4  ]: Began running node test.bain_capital_analytics.unique_stg_cashflows_cashflow_id.359e4f4704
[0m19:30:15.658433 [debug] [Thread-1  ]: Began running node test.bain_capital_analytics.not_null_stg_valuations_portfolio_id.d5af3e5188
[0m19:30:15.660838 [debug] [Thread-2  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_stg_cashflows_portfolio_id.cbd1d93e57"
[0m19:30:15.661171 [debug] [Thread-3  ]: Began running node test.bain_capital_analytics.not_null_stg_valuations_valuation_id.88ca70781d
[0m19:30:15.661522 [info ] [Thread-4  ]: 18 of 54 START test unique_stg_cashflows_cashflow_id ........................... [RUN]
[0m19:30:15.661866 [info ] [Thread-1  ]: 19 of 54 START test not_null_stg_valuations_portfolio_id ....................... [RUN]
[0m19:30:15.662252 [info ] [Thread-3  ]: 20 of 54 START test not_null_stg_valuations_valuation_id ....................... [RUN]
[0m19:30:15.662642 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.unique_stg_dates_date_day.e062be8e28, now test.bain_capital_analytics.unique_stg_cashflows_cashflow_id.359e4f4704)
[0m19:30:15.662986 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.not_null_stg_cashflows_fund_id.7ff8a45dde, now test.bain_capital_analytics.not_null_stg_valuations_portfolio_id.d5af3e5188)
[0m19:30:15.663341 [debug] [Thread-2  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_cashflows_portfolio_id.cbd1d93e57"
[0m19:30:15.663655 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.not_null_stg_cashflows_cashflow_id.4176024898, now test.bain_capital_analytics.not_null_stg_valuations_valuation_id.88ca70781d)
[0m19:30:15.663963 [debug] [Thread-4  ]: Began compiling node test.bain_capital_analytics.unique_stg_cashflows_cashflow_id.359e4f4704
[0m19:30:15.664262 [debug] [Thread-1  ]: Began compiling node test.bain_capital_analytics.not_null_stg_valuations_portfolio_id.d5af3e5188
[0m19:30:15.664567 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_stg_cashflows_portfolio_id.cbd1d93e57: BEGIN
[0m19:30:15.664864 [debug] [Thread-3  ]: Began compiling node test.bain_capital_analytics.not_null_stg_valuations_valuation_id.88ca70781d
[0m19:30:15.668433 [debug] [Thread-4  ]: Writing injected SQL for node "test.bain_capital_analytics.unique_stg_cashflows_cashflow_id.359e4f4704"
[0m19:30:15.673064 [debug] [Thread-1  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_stg_valuations_portfolio_id.d5af3e5188"
[0m19:30:15.673379 [debug] [Thread-2  ]: Opening a new connection, currently in state closed
[0m19:30:15.676767 [debug] [Thread-3  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_stg_valuations_valuation_id.88ca70781d"
[0m19:30:15.677471 [debug] [Thread-4  ]: Began executing node test.bain_capital_analytics.unique_stg_cashflows_cashflow_id.359e4f4704
[0m19:30:15.679756 [debug] [Thread-4  ]: Writing runtime sql for node "test.bain_capital_analytics.unique_stg_cashflows_cashflow_id.359e4f4704"
[0m19:30:15.680088 [debug] [Thread-1  ]: Began executing node test.bain_capital_analytics.not_null_stg_valuations_portfolio_id.d5af3e5188
[0m19:30:15.682396 [debug] [Thread-1  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_stg_valuations_portfolio_id.d5af3e5188"
[0m19:30:15.682716 [debug] [Thread-3  ]: Began executing node test.bain_capital_analytics.not_null_stg_valuations_valuation_id.88ca70781d
[0m19:30:15.685016 [debug] [Thread-3  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_stg_valuations_valuation_id.88ca70781d"
[0m19:30:15.685370 [debug] [Thread-4  ]: Using postgres connection "test.bain_capital_analytics.unique_stg_cashflows_cashflow_id.359e4f4704"
[0m19:30:15.685760 [debug] [Thread-4  ]: On test.bain_capital_analytics.unique_stg_cashflows_cashflow_id.359e4f4704: BEGIN
[0m19:30:15.686053 [debug] [Thread-4  ]: Opening a new connection, currently in state closed
[0m19:30:15.686359 [debug] [Thread-1  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_valuations_portfolio_id.d5af3e5188"
[0m19:30:15.686771 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_stg_valuations_portfolio_id.d5af3e5188: BEGIN
[0m19:30:15.687103 [debug] [Thread-3  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_valuations_valuation_id.88ca70781d"
[0m19:30:15.687389 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m19:30:15.687724 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_stg_valuations_valuation_id.88ca70781d: BEGIN
[0m19:30:15.688105 [debug] [Thread-3  ]: Opening a new connection, currently in state closed
[0m19:30:15.688414 [debug] [Thread-2  ]: SQL status: BEGIN in 0.015 seconds
[0m19:30:15.688782 [debug] [Thread-2  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_cashflows_portfolio_id.cbd1d93e57"
[0m19:30:15.689076 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_stg_cashflows_portfolio_id.cbd1d93e57: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_stg_cashflows_portfolio_id.cbd1d93e57"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select portfolio_id
from "bain_analytics"."public"."stg_cashflows"
where portfolio_id is null



  
  
      
    ) dbt_internal_test
[0m19:30:15.692468 [debug] [Thread-2  ]: SQL status: SELECT 1 in 0.003 seconds
[0m19:30:15.695224 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_stg_cashflows_portfolio_id.cbd1d93e57: ROLLBACK
[0m19:30:15.696344 [debug] [Thread-4  ]: SQL status: BEGIN in 0.010 seconds
[0m19:30:15.697983 [debug] [Thread-1  ]: SQL status: BEGIN in 0.011 seconds
[0m19:30:15.698488 [debug] [Thread-3  ]: SQL status: BEGIN in 0.010 seconds
[0m19:30:15.698876 [debug] [Thread-4  ]: Using postgres connection "test.bain_capital_analytics.unique_stg_cashflows_cashflow_id.359e4f4704"
[0m19:30:15.699164 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_stg_cashflows_portfolio_id.cbd1d93e57: Close
[0m19:30:15.702255 [debug] [Thread-1  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_valuations_portfolio_id.d5af3e5188"
[0m19:30:15.703028 [debug] [Thread-3  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_valuations_valuation_id.88ca70781d"
[0m19:30:15.705280 [debug] [Thread-4  ]: On test.bain_capital_analytics.unique_stg_cashflows_cashflow_id.359e4f4704: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.unique_stg_cashflows_cashflow_id.359e4f4704"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

select
    cashflow_id as unique_field,
    count(*) as n_records

from "bain_analytics"."public"."stg_cashflows"
where cashflow_id is not null
group by cashflow_id
having count(*) > 1



  
  
      
    ) dbt_internal_test
[0m19:30:15.705773 [info ] [Thread-2  ]: 17 of 54 PASS not_null_stg_cashflows_portfolio_id .............................. [[32mPASS[0m in 0.06s]
[0m19:30:15.706095 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_stg_valuations_portfolio_id.d5af3e5188: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_stg_valuations_portfolio_id.d5af3e5188"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select portfolio_id
from "bain_analytics"."public"."stg_valuations"
where portfolio_id is null



  
  
      
    ) dbt_internal_test
[0m19:30:15.706412 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_stg_valuations_valuation_id.88ca70781d: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_stg_valuations_valuation_id.88ca70781d"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select valuation_id
from "bain_analytics"."public"."stg_valuations"
where valuation_id is null



  
  
      
    ) dbt_internal_test
[0m19:30:15.706882 [debug] [Thread-2  ]: Finished running node test.bain_capital_analytics.not_null_stg_cashflows_portfolio_id.cbd1d93e57
[0m19:30:15.707283 [debug] [Thread-2  ]: Began running node test.bain_capital_analytics.unique_stg_valuations_valuation_id.fce7eb13b5
[0m19:30:15.707656 [info ] [Thread-2  ]: 21 of 54 START test unique_stg_valuations_valuation_id ......................... [RUN]
[0m19:30:15.708011 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.not_null_stg_cashflows_portfolio_id.cbd1d93e57, now test.bain_capital_analytics.unique_stg_valuations_valuation_id.fce7eb13b5)
[0m19:30:15.708311 [debug] [Thread-2  ]: Began compiling node test.bain_capital_analytics.unique_stg_valuations_valuation_id.fce7eb13b5
[0m19:30:15.712583 [debug] [Thread-2  ]: Writing injected SQL for node "test.bain_capital_analytics.unique_stg_valuations_valuation_id.fce7eb13b5"
[0m19:30:15.712924 [debug] [Thread-4  ]: SQL status: SELECT 1 in 0.006 seconds
[0m19:30:15.713209 [debug] [Thread-3  ]: SQL status: SELECT 1 in 0.006 seconds
[0m19:30:15.714369 [debug] [Thread-4  ]: On test.bain_capital_analytics.unique_stg_cashflows_cashflow_id.359e4f4704: ROLLBACK
[0m19:30:15.714698 [debug] [Thread-1  ]: SQL status: SELECT 1 in 0.008 seconds
[0m19:30:15.715924 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_stg_valuations_valuation_id.88ca70781d: ROLLBACK
[0m19:30:15.716318 [debug] [Thread-2  ]: Began executing node test.bain_capital_analytics.unique_stg_valuations_valuation_id.fce7eb13b5
[0m19:30:15.717338 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_stg_valuations_portfolio_id.d5af3e5188: ROLLBACK
[0m19:30:15.717629 [debug] [Thread-4  ]: On test.bain_capital_analytics.unique_stg_cashflows_cashflow_id.359e4f4704: Close
[0m19:30:15.719939 [debug] [Thread-2  ]: Writing runtime sql for node "test.bain_capital_analytics.unique_stg_valuations_valuation_id.fce7eb13b5"
[0m19:30:15.720250 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_stg_valuations_valuation_id.88ca70781d: Close
[0m19:30:15.720752 [info ] [Thread-4  ]: 18 of 54 PASS unique_stg_cashflows_cashflow_id ................................. [[32mPASS[0m in 0.06s]
[0m19:30:15.721063 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_stg_valuations_portfolio_id.d5af3e5188: Close
[0m19:30:15.721569 [info ] [Thread-3  ]: 20 of 54 PASS not_null_stg_valuations_valuation_id ............................. [[32mPASS[0m in 0.06s]
[0m19:30:15.722019 [debug] [Thread-4  ]: Finished running node test.bain_capital_analytics.unique_stg_cashflows_cashflow_id.359e4f4704
[0m19:30:15.722425 [debug] [Thread-2  ]: Using postgres connection "test.bain_capital_analytics.unique_stg_valuations_valuation_id.fce7eb13b5"
[0m19:30:15.722826 [info ] [Thread-1  ]: 19 of 54 PASS not_null_stg_valuations_portfolio_id ............................. [[32mPASS[0m in 0.06s]
[0m19:30:15.723259 [debug] [Thread-3  ]: Finished running node test.bain_capital_analytics.not_null_stg_valuations_valuation_id.88ca70781d
[0m19:30:15.723589 [debug] [Thread-4  ]: Began running node test.bain_capital_analytics.not_null_stg_instruments_instrument_id.18bdfd2ebe
[0m19:30:15.723931 [debug] [Thread-2  ]: On test.bain_capital_analytics.unique_stg_valuations_valuation_id.fce7eb13b5: BEGIN
[0m19:30:15.724348 [debug] [Thread-1  ]: Finished running node test.bain_capital_analytics.not_null_stg_valuations_portfolio_id.d5af3e5188
[0m19:30:15.724666 [debug] [Thread-3  ]: Began running node test.bain_capital_analytics.unique_stg_instruments_instrument_id.0e70adcd34
[0m19:30:15.725015 [info ] [Thread-4  ]: 22 of 54 START test not_null_stg_instruments_instrument_id ..................... [RUN]
[0m19:30:15.725347 [debug] [Thread-2  ]: Opening a new connection, currently in state closed
[0m19:30:15.725672 [debug] [Thread-1  ]: Began running node test.bain_capital_analytics.not_null_stg_portfolios_fund_id.70b04d82bd
[0m19:30:15.726014 [info ] [Thread-3  ]: 23 of 54 START test unique_stg_instruments_instrument_id ....................... [RUN]
[0m19:30:15.726384 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.unique_stg_cashflows_cashflow_id.359e4f4704, now test.bain_capital_analytics.not_null_stg_instruments_instrument_id.18bdfd2ebe)
[0m19:30:15.726810 [info ] [Thread-1  ]: 24 of 54 START test not_null_stg_portfolios_fund_id ............................ [RUN]
[0m19:30:15.727162 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.not_null_stg_valuations_valuation_id.88ca70781d, now test.bain_capital_analytics.unique_stg_instruments_instrument_id.0e70adcd34)
[0m19:30:15.727472 [debug] [Thread-4  ]: Began compiling node test.bain_capital_analytics.not_null_stg_instruments_instrument_id.18bdfd2ebe
[0m19:30:15.727797 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.not_null_stg_valuations_portfolio_id.d5af3e5188, now test.bain_capital_analytics.not_null_stg_portfolios_fund_id.70b04d82bd)
[0m19:30:15.728111 [debug] [Thread-3  ]: Began compiling node test.bain_capital_analytics.unique_stg_instruments_instrument_id.0e70adcd34
[0m19:30:15.731550 [debug] [Thread-4  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_stg_instruments_instrument_id.18bdfd2ebe"
[0m19:30:15.731885 [debug] [Thread-1  ]: Began compiling node test.bain_capital_analytics.not_null_stg_portfolios_fund_id.70b04d82bd
[0m19:30:15.735163 [debug] [Thread-3  ]: Writing injected SQL for node "test.bain_capital_analytics.unique_stg_instruments_instrument_id.0e70adcd34"
[0m19:30:15.738774 [debug] [Thread-1  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_stg_portfolios_fund_id.70b04d82bd"
[0m19:30:15.739127 [debug] [Thread-2  ]: SQL status: BEGIN in 0.014 seconds
[0m19:30:15.739583 [debug] [Thread-2  ]: Using postgres connection "test.bain_capital_analytics.unique_stg_valuations_valuation_id.fce7eb13b5"
[0m19:30:15.739899 [debug] [Thread-4  ]: Began executing node test.bain_capital_analytics.not_null_stg_instruments_instrument_id.18bdfd2ebe
[0m19:30:15.740200 [debug] [Thread-2  ]: On test.bain_capital_analytics.unique_stg_valuations_valuation_id.fce7eb13b5: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.unique_stg_valuations_valuation_id.fce7eb13b5"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

select
    valuation_id as unique_field,
    count(*) as n_records

from "bain_analytics"."public"."stg_valuations"
where valuation_id is not null
group by valuation_id
having count(*) > 1



  
  
      
    ) dbt_internal_test
[0m19:30:15.740570 [debug] [Thread-1  ]: Began executing node test.bain_capital_analytics.not_null_stg_portfolios_fund_id.70b04d82bd
[0m19:30:15.742794 [debug] [Thread-4  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_stg_instruments_instrument_id.18bdfd2ebe"
[0m19:30:15.743118 [debug] [Thread-3  ]: Began executing node test.bain_capital_analytics.unique_stg_instruments_instrument_id.0e70adcd34
[0m19:30:15.746043 [debug] [Thread-1  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_stg_portfolios_fund_id.70b04d82bd"
[0m19:30:15.748229 [debug] [Thread-3  ]: Writing runtime sql for node "test.bain_capital_analytics.unique_stg_instruments_instrument_id.0e70adcd34"
[0m19:30:15.748571 [debug] [Thread-2  ]: SQL status: SELECT 1 in 0.005 seconds
[0m19:30:15.749069 [debug] [Thread-4  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_instruments_instrument_id.18bdfd2ebe"
[0m19:30:15.750159 [debug] [Thread-2  ]: On test.bain_capital_analytics.unique_stg_valuations_valuation_id.fce7eb13b5: ROLLBACK
[0m19:30:15.750515 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_stg_instruments_instrument_id.18bdfd2ebe: BEGIN
[0m19:30:15.750839 [debug] [Thread-1  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_portfolios_fund_id.70b04d82bd"
[0m19:30:15.751211 [debug] [Thread-3  ]: Using postgres connection "test.bain_capital_analytics.unique_stg_instruments_instrument_id.0e70adcd34"
[0m19:30:15.751499 [debug] [Thread-2  ]: On test.bain_capital_analytics.unique_stg_valuations_valuation_id.fce7eb13b5: Close
[0m19:30:15.751780 [debug] [Thread-4  ]: Opening a new connection, currently in state closed
[0m19:30:15.752076 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_stg_portfolios_fund_id.70b04d82bd: BEGIN
[0m19:30:15.752366 [debug] [Thread-3  ]: On test.bain_capital_analytics.unique_stg_instruments_instrument_id.0e70adcd34: BEGIN
[0m19:30:15.752878 [info ] [Thread-2  ]: 21 of 54 PASS unique_stg_valuations_valuation_id ............................... [[32mPASS[0m in 0.04s]
[0m19:30:15.753272 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m19:30:15.753552 [debug] [Thread-3  ]: Opening a new connection, currently in state closed
[0m19:30:15.753981 [debug] [Thread-2  ]: Finished running node test.bain_capital_analytics.unique_stg_valuations_valuation_id.fce7eb13b5
[0m19:30:15.754478 [debug] [Thread-2  ]: Began running node test.bain_capital_analytics.not_null_stg_portfolios_portfolio_id.7126a480ec
[0m19:30:15.754841 [info ] [Thread-2  ]: 25 of 54 START test not_null_stg_portfolios_portfolio_id ....................... [RUN]
[0m19:30:15.755177 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.unique_stg_valuations_valuation_id.fce7eb13b5, now test.bain_capital_analytics.not_null_stg_portfolios_portfolio_id.7126a480ec)
[0m19:30:15.755474 [debug] [Thread-2  ]: Began compiling node test.bain_capital_analytics.not_null_stg_portfolios_portfolio_id.7126a480ec
[0m19:30:15.758835 [debug] [Thread-2  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_stg_portfolios_portfolio_id.7126a480ec"
[0m19:30:15.759297 [debug] [Thread-2  ]: Began executing node test.bain_capital_analytics.not_null_stg_portfolios_portfolio_id.7126a480ec
[0m19:30:15.761465 [debug] [Thread-2  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_stg_portfolios_portfolio_id.7126a480ec"
[0m19:30:15.761915 [debug] [Thread-2  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_portfolios_portfolio_id.7126a480ec"
[0m19:30:15.762202 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_stg_portfolios_portfolio_id.7126a480ec: BEGIN
[0m19:30:15.762502 [debug] [Thread-2  ]: Opening a new connection, currently in state closed
[0m19:30:15.763076 [debug] [Thread-4  ]: SQL status: BEGIN in 0.011 seconds
[0m19:30:15.763381 [debug] [Thread-4  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_instruments_instrument_id.18bdfd2ebe"
[0m19:30:15.763683 [debug] [Thread-1  ]: SQL status: BEGIN in 0.010 seconds
[0m19:30:15.764026 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_stg_instruments_instrument_id.18bdfd2ebe: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_stg_instruments_instrument_id.18bdfd2ebe"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select instrument_id
from "bain_analytics"."public"."stg_instruments"
where instrument_id is null



  
  
      
    ) dbt_internal_test
[0m19:30:15.764344 [debug] [Thread-1  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_portfolios_fund_id.70b04d82bd"
[0m19:30:15.764635 [debug] [Thread-3  ]: SQL status: BEGIN in 0.011 seconds
[0m19:30:15.764961 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_stg_portfolios_fund_id.70b04d82bd: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_stg_portfolios_fund_id.70b04d82bd"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select fund_id
from "bain_analytics"."public"."stg_portfolios"
where fund_id is null



  
  
      
    ) dbt_internal_test
[0m19:30:15.765367 [debug] [Thread-3  ]: Using postgres connection "test.bain_capital_analytics.unique_stg_instruments_instrument_id.0e70adcd34"
[0m19:30:15.765719 [debug] [Thread-3  ]: On test.bain_capital_analytics.unique_stg_instruments_instrument_id.0e70adcd34: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.unique_stg_instruments_instrument_id.0e70adcd34"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

select
    instrument_id as unique_field,
    count(*) as n_records

from "bain_analytics"."public"."stg_instruments"
where instrument_id is not null
group by instrument_id
having count(*) > 1



  
  
      
    ) dbt_internal_test
[0m19:30:15.766775 [debug] [Thread-4  ]: SQL status: SELECT 1 in 0.002 seconds
[0m19:30:15.768120 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_stg_instruments_instrument_id.18bdfd2ebe: ROLLBACK
[0m19:30:15.768452 [debug] [Thread-3  ]: SQL status: SELECT 1 in 0.002 seconds
[0m19:30:15.768742 [debug] [Thread-1  ]: SQL status: SELECT 1 in 0.003 seconds
[0m19:30:15.769840 [debug] [Thread-3  ]: On test.bain_capital_analytics.unique_stg_instruments_instrument_id.0e70adcd34: ROLLBACK
[0m19:30:15.770140 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_stg_instruments_instrument_id.18bdfd2ebe: Close
[0m19:30:15.771136 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_stg_portfolios_fund_id.70b04d82bd: ROLLBACK
[0m19:30:15.771926 [debug] [Thread-3  ]: On test.bain_capital_analytics.unique_stg_instruments_instrument_id.0e70adcd34: Close
[0m19:30:15.772225 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_stg_portfolios_fund_id.70b04d82bd: Close
[0m19:30:15.772519 [debug] [Thread-2  ]: SQL status: BEGIN in 0.010 seconds
[0m19:30:15.771679 [info ] [Thread-4  ]: 22 of 54 PASS not_null_stg_instruments_instrument_id ........................... [[32mPASS[0m in 0.05s]
[0m19:30:15.773033 [info ] [Thread-3  ]: 23 of 54 PASS unique_stg_instruments_instrument_id ............................. [[32mPASS[0m in 0.05s]
[0m19:30:15.773504 [info ] [Thread-1  ]: 24 of 54 PASS not_null_stg_portfolios_fund_id .................................. [[32mPASS[0m in 0.05s]
[0m19:30:15.773826 [debug] [Thread-2  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_portfolios_portfolio_id.7126a480ec"
[0m19:30:15.774253 [debug] [Thread-4  ]: Finished running node test.bain_capital_analytics.not_null_stg_instruments_instrument_id.18bdfd2ebe
[0m19:30:15.774658 [debug] [Thread-3  ]: Finished running node test.bain_capital_analytics.unique_stg_instruments_instrument_id.0e70adcd34
[0m19:30:15.775055 [debug] [Thread-1  ]: Finished running node test.bain_capital_analytics.not_null_stg_portfolios_fund_id.70b04d82bd
[0m19:30:15.775366 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_stg_portfolios_portfolio_id.7126a480ec: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_stg_portfolios_portfolio_id.7126a480ec"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select portfolio_id
from "bain_analytics"."public"."stg_portfolios"
where portfolio_id is null



  
  
      
    ) dbt_internal_test
[0m19:30:15.775710 [debug] [Thread-4  ]: Began running node test.bain_capital_analytics.unique_stg_portfolios_portfolio_id.aa125b6658
[0m19:30:15.776107 [debug] [Thread-3  ]: Began running node test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c
[0m19:30:15.776482 [debug] [Thread-1  ]: Began running node test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1
[0m19:30:15.776890 [info ] [Thread-4  ]: 26 of 54 START test unique_stg_portfolios_portfolio_id ......................... [RUN]
[0m19:30:15.777218 [info ] [Thread-3  ]: 27 of 54 START test not_null_stg_positions_portfolio_id ........................ [RUN]
[0m19:30:15.777539 [info ] [Thread-1  ]: 28 of 54 START test not_null_stg_positions_position_id ......................... [RUN]
[0m19:30:15.777889 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.not_null_stg_instruments_instrument_id.18bdfd2ebe, now test.bain_capital_analytics.unique_stg_portfolios_portfolio_id.aa125b6658)
[0m19:30:15.778218 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.unique_stg_instruments_instrument_id.0e70adcd34, now test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c)
[0m19:30:15.778539 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.not_null_stg_portfolios_fund_id.70b04d82bd, now test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1)
[0m19:30:15.778841 [debug] [Thread-4  ]: Began compiling node test.bain_capital_analytics.unique_stg_portfolios_portfolio_id.aa125b6658
[0m19:30:15.779143 [debug] [Thread-2  ]: SQL status: SELECT 1 in 0.002 seconds
[0m19:30:15.779416 [debug] [Thread-3  ]: Began compiling node test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c
[0m19:30:15.779718 [debug] [Thread-1  ]: Began compiling node test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1
[0m19:30:15.783646 [debug] [Thread-4  ]: Writing injected SQL for node "test.bain_capital_analytics.unique_stg_portfolios_portfolio_id.aa125b6658"
[0m19:30:15.784759 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_stg_portfolios_portfolio_id.7126a480ec: ROLLBACK
[0m19:30:15.788244 [debug] [Thread-3  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c"
[0m19:30:15.848038 [debug] [Thread-1  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1"
[0m19:30:15.849270 [debug] [Thread-4  ]: Began executing node test.bain_capital_analytics.unique_stg_portfolios_portfolio_id.aa125b6658
[0m19:30:15.849717 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_stg_portfolios_portfolio_id.7126a480ec: Close
[0m19:30:15.850075 [debug] [Thread-1  ]: Began executing node test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1
[0m19:30:15.850368 [debug] [Thread-3  ]: Began executing node test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c
[0m19:30:15.852972 [debug] [Thread-4  ]: Writing runtime sql for node "test.bain_capital_analytics.unique_stg_portfolios_portfolio_id.aa125b6658"
[0m19:30:15.855913 [debug] [Thread-1  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1"
[0m19:30:15.853573 [info ] [Thread-2  ]: 25 of 54 PASS not_null_stg_portfolios_portfolio_id ............................. [[32mPASS[0m in 0.10s]
[0m19:30:15.858253 [debug] [Thread-3  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c"
[0m19:30:15.858953 [debug] [Thread-2  ]: Finished running node test.bain_capital_analytics.not_null_stg_portfolios_portfolio_id.7126a480ec
[0m19:30:15.859447 [debug] [Thread-4  ]: Using postgres connection "test.bain_capital_analytics.unique_stg_portfolios_portfolio_id.aa125b6658"
[0m19:30:15.860064 [debug] [Thread-2  ]: Began running node test.bain_capital_analytics.relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_.2823f12709
[0m19:30:15.860498 [debug] [Thread-1  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1"
[0m19:30:15.860873 [debug] [Thread-4  ]: On test.bain_capital_analytics.unique_stg_portfolios_portfolio_id.aa125b6658: BEGIN
[0m19:30:15.861229 [info ] [Thread-2  ]: 29 of 54 START test relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_  [RUN]
[0m19:30:15.861604 [debug] [Thread-3  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c"
[0m19:30:15.861891 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1: BEGIN
[0m19:30:15.862192 [debug] [Thread-4  ]: Opening a new connection, currently in state closed
[0m19:30:15.862564 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.not_null_stg_portfolios_portfolio_id.7126a480ec, now test.bain_capital_analytics.relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_.2823f12709)
[0m19:30:15.862883 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c: BEGIN
[0m19:30:15.863199 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m19:30:15.863659 [debug] [Thread-2  ]: Began compiling node test.bain_capital_analytics.relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_.2823f12709
[0m19:30:15.863956 [debug] [Thread-3  ]: Opening a new connection, currently in state closed
[0m19:30:15.871943 [debug] [Thread-2  ]: Writing injected SQL for node "test.bain_capital_analytics.relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_.2823f12709"
[0m19:30:15.872750 [debug] [Thread-2  ]: Began executing node test.bain_capital_analytics.relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_.2823f12709
[0m19:30:15.876086 [debug] [Thread-2  ]: Writing runtime sql for node "test.bain_capital_analytics.relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_.2823f12709"
[0m19:30:15.876493 [debug] [Thread-1  ]: SQL status: BEGIN in 0.013 seconds
[0m19:30:15.876801 [debug] [Thread-4  ]: SQL status: BEGIN in 0.015 seconds
[0m19:30:15.877189 [debug] [Thread-1  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1"
[0m19:30:15.877512 [debug] [Thread-4  ]: Using postgres connection "test.bain_capital_analytics.unique_stg_portfolios_portfolio_id.aa125b6658"
[0m19:30:15.877863 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select position_id
from "bain_analytics"."public"."stg_positions"
where position_id is null



  
  
      
    ) dbt_internal_test
[0m19:30:15.878254 [debug] [Thread-2  ]: Using postgres connection "test.bain_capital_analytics.relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_.2823f12709"
[0m19:30:15.878594 [debug] [Thread-4  ]: On test.bain_capital_analytics.unique_stg_portfolios_portfolio_id.aa125b6658: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.unique_stg_portfolios_portfolio_id.aa125b6658"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

select
    portfolio_id as unique_field,
    count(*) as n_records

from "bain_analytics"."public"."stg_portfolios"
where portfolio_id is not null
group by portfolio_id
having count(*) > 1



  
  
      
    ) dbt_internal_test
[0m19:30:15.879058 [debug] [Thread-2  ]: On test.bain_capital_analytics.relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_.2823f12709: BEGIN
[0m19:30:15.879476 [debug] [Thread-2  ]: Opening a new connection, currently in state closed
[0m19:30:15.879813 [debug] [Thread-3  ]: SQL status: BEGIN in 0.016 seconds
[0m19:30:15.880204 [debug] [Thread-3  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c"
[0m19:30:15.880529 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select portfolio_id
from "bain_analytics"."public"."stg_positions"
where portfolio_id is null



  
  
      
    ) dbt_internal_test
[0m19:30:15.880852 [debug] [Thread-1  ]: SQL status: SELECT 1 in 0.002 seconds
[0m19:30:15.882349 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1: ROLLBACK
[0m19:30:15.882817 [debug] [Thread-4  ]: SQL status: SELECT 1 in 0.003 seconds
[0m19:30:15.883132 [debug] [Thread-3  ]: SQL status: SELECT 1 in 0.002 seconds
[0m19:30:15.884337 [debug] [Thread-4  ]: On test.bain_capital_analytics.unique_stg_portfolios_portfolio_id.aa125b6658: ROLLBACK
[0m19:30:15.884671 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1: Close
[0m19:30:15.885779 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c: ROLLBACK
[0m19:30:15.886637 [debug] [Thread-4  ]: On test.bain_capital_analytics.unique_stg_portfolios_portfolio_id.aa125b6658: Close
[0m19:30:15.886358 [info ] [Thread-1  ]: 28 of 54 PASS not_null_stg_positions_position_id ............................... [[32mPASS[0m in 0.11s]
[0m19:30:15.887057 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c: Close
[0m19:30:15.887970 [debug] [Thread-1  ]: Finished running node test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1
[0m19:30:15.888284 [debug] [Thread-2  ]: SQL status: BEGIN in 0.009 seconds
[0m19:30:15.887559 [info ] [Thread-4  ]: 26 of 54 PASS unique_stg_portfolios_portfolio_id ............................... [[32mPASS[0m in 0.11s]
[0m19:30:15.888843 [info ] [Thread-3  ]: 27 of 54 PASS not_null_stg_positions_portfolio_id .............................. [[32mPASS[0m in 0.11s]
[0m19:30:15.889235 [debug] [Thread-1  ]: Began running node test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f
[0m19:30:15.889624 [debug] [Thread-2  ]: Using postgres connection "test.bain_capital_analytics.relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_.2823f12709"
[0m19:30:15.890086 [debug] [Thread-4  ]: Finished running node test.bain_capital_analytics.unique_stg_portfolios_portfolio_id.aa125b6658
[0m19:30:15.890505 [debug] [Thread-3  ]: Finished running node test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c
[0m19:30:15.890832 [info ] [Thread-1  ]: 30 of 54 START test unique_stg_positions_position_id ........................... [RUN]
[0m19:30:15.891211 [debug] [Thread-2  ]: On test.bain_capital_analytics.relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_.2823f12709: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_.2823f12709"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

with child as (
    select portfolio_id as from_field
    from "bain_analytics"."public"."stg_positions"
    where portfolio_id is not null
),

parent as (
    select portfolio_id as to_field
    from "bain_analytics"."public"."stg_portfolios"
)

select
    from_field

from child
left join parent
    on child.from_field = parent.to_field

where parent.to_field is null



  
  
      
    ) dbt_internal_test
[0m19:30:15.891595 [debug] [Thread-4  ]: Began running node model.bain_capital_analytics.int_benchmark_returns
[0m19:30:15.892224 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1, now test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f)
[0m19:30:15.892538 [debug] [Thread-3  ]: Began running node model.bain_capital_analytics.int_cashflow_enriched
[0m19:30:15.893017 [info ] [Thread-4  ]: 31 of 54 START sql view model public.int_benchmark_returns ..................... [RUN]
[0m19:30:15.893364 [debug] [Thread-1  ]: Began compiling node test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f
[0m19:30:15.893779 [info ] [Thread-3  ]: 32 of 54 START sql view model public.int_cashflow_enriched ..................... [RUN]
[0m19:30:15.894144 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.unique_stg_portfolios_portfolio_id.aa125b6658, now model.bain_capital_analytics.int_benchmark_returns)
[0m19:30:15.899913 [debug] [Thread-1  ]: Writing injected SQL for node "test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f"
[0m19:30:15.900296 [debug] [Thread-2  ]: SQL status: SELECT 1 in 0.007 seconds
[0m19:30:15.900674 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c, now model.bain_capital_analytics.int_cashflow_enriched)
[0m19:30:15.900997 [debug] [Thread-4  ]: Began compiling node model.bain_capital_analytics.int_benchmark_returns
[0m19:30:15.902299 [debug] [Thread-2  ]: On test.bain_capital_analytics.relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_.2823f12709: ROLLBACK
[0m19:30:15.902649 [debug] [Thread-3  ]: Began compiling node model.bain_capital_analytics.int_cashflow_enriched
[0m19:30:15.905807 [debug] [Thread-4  ]: Writing injected SQL for node "model.bain_capital_analytics.int_benchmark_returns"
[0m19:30:15.909223 [debug] [Thread-3  ]: Writing injected SQL for node "model.bain_capital_analytics.int_cashflow_enriched"
[0m19:30:15.909605 [debug] [Thread-1  ]: Began executing node test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f
[0m19:30:15.909959 [debug] [Thread-2  ]: On test.bain_capital_analytics.relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_.2823f12709: Close
[0m19:30:15.912359 [debug] [Thread-1  ]: Writing runtime sql for node "test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f"
[0m19:30:15.912960 [info ] [Thread-2  ]: 29 of 54 PASS relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_  [[32mPASS[0m in 0.05s]
[0m19:30:15.913332 [debug] [Thread-3  ]: Began executing node model.bain_capital_analytics.int_cashflow_enriched
[0m19:30:15.913685 [debug] [Thread-4  ]: Began executing node model.bain_capital_analytics.int_benchmark_returns
[0m19:30:15.914186 [debug] [Thread-2  ]: Finished running node test.bain_capital_analytics.relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_.2823f12709
[0m19:30:15.917667 [debug] [Thread-3  ]: Writing runtime sql for node "model.bain_capital_analytics.int_cashflow_enriched"
[0m19:30:15.922029 [debug] [Thread-4  ]: Writing runtime sql for node "model.bain_capital_analytics.int_benchmark_returns"
[0m19:30:15.922424 [debug] [Thread-2  ]: Began running node model.bain_capital_analytics.int_fund_nav
[0m19:30:15.922871 [debug] [Thread-1  ]: Using postgres connection "test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f"
[0m19:30:15.923452 [info ] [Thread-2  ]: 33 of 54 START sql view model public.int_fund_nav .............................. [RUN]
[0m19:30:15.923813 [debug] [Thread-1  ]: On test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f: BEGIN
[0m19:30:15.924267 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.int_cashflow_enriched"
[0m19:30:15.924621 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_.2823f12709, now model.bain_capital_analytics.int_fund_nav)
[0m19:30:15.924958 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.int_benchmark_returns"
[0m19:30:15.925271 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m19:30:15.925588 [debug] [Thread-3  ]: On model.bain_capital_analytics.int_cashflow_enriched: BEGIN
[0m19:30:15.925911 [debug] [Thread-2  ]: Began compiling node model.bain_capital_analytics.int_fund_nav
[0m19:30:15.926218 [debug] [Thread-4  ]: On model.bain_capital_analytics.int_benchmark_returns: BEGIN
[0m19:30:15.926633 [debug] [Thread-3  ]: Opening a new connection, currently in state closed
[0m19:30:15.929844 [debug] [Thread-2  ]: Writing injected SQL for node "model.bain_capital_analytics.int_fund_nav"
[0m19:30:15.930183 [debug] [Thread-4  ]: Opening a new connection, currently in state closed
[0m19:30:15.930833 [debug] [Thread-2  ]: Began executing node model.bain_capital_analytics.int_fund_nav
[0m19:30:15.934294 [debug] [Thread-2  ]: Writing runtime sql for node "model.bain_capital_analytics.int_fund_nav"
[0m19:30:15.934897 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.int_fund_nav"
[0m19:30:15.935190 [debug] [Thread-2  ]: On model.bain_capital_analytics.int_fund_nav: BEGIN
[0m19:30:15.935514 [debug] [Thread-1  ]: SQL status: BEGIN in 0.010 seconds
[0m19:30:15.935823 [debug] [Thread-2  ]: Opening a new connection, currently in state closed
[0m19:30:15.936125 [debug] [Thread-1  ]: Using postgres connection "test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f"
[0m19:30:15.936532 [debug] [Thread-1  ]: On test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

select
    position_id as unique_field,
    count(*) as n_records

from "bain_analytics"."public"."stg_positions"
where position_id is not null
group by position_id
having count(*) > 1



  
  
      
    ) dbt_internal_test
[0m19:30:15.938831 [debug] [Thread-1  ]: SQL status: SELECT 1 in 0.002 seconds
[0m19:30:15.939178 [debug] [Thread-3  ]: SQL status: BEGIN in 0.013 seconds
[0m19:30:15.940432 [debug] [Thread-1  ]: On test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f: ROLLBACK
[0m19:30:15.940734 [debug] [Thread-4  ]: SQL status: BEGIN in 0.011 seconds
[0m19:30:15.941057 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.int_cashflow_enriched"
[0m19:30:15.941419 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.int_benchmark_returns"
[0m19:30:15.941730 [debug] [Thread-1  ]: On test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f: Close
[0m19:30:15.942142 [debug] [Thread-3  ]: On model.bain_capital_analytics.int_cashflow_enriched: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.int_cashflow_enriched"} */

  create view "bain_analytics"."public"."int_cashflow_enriched__dbt_tmp"
    
    
  as (
    -- Pipeline C: Enriched cashflow data with fund and portfolio details
-- Anti-pattern: subquery for dedup instead of QUALIFY
-- Anti-pattern: joins repeated from other intermediate models

with cashflow_with_details as (
    select *
    from (
        select
            cf.*,
            p.portfolio_name,
            p.strategy,
            p.manager_name,
            fs.fund_name,
            fs.fund_type,
            fs.committed_capital,
            fs.management_fee_rate,
            fs.carry_rate,
            fs.hurdle_rate,
            -- Anti-pattern: subquery filter instead of QUALIFY
            row_number() over (
                partition by cf.cashflow_id
                order by cf.cashflow_date desc
            ) as rn
        from "bain_analytics"."public"."stg_cashflows" cf
        inner join "bain_analytics"."public"."stg_portfolios" p
            on cf.portfolio_id = p.portfolio_id
        inner join "bain_analytics"."public"."stg_fund_structures" fs
            on cf.fund_id = fs.fund_id
    ) sub
    where rn = 1
),

-- Anti-pattern: running totals computed here AND again downstream
cashflow_cumulative as (
    select
        *,
        sum(case when cashflow_type = 'capital_call' then amount else 0 end) over (
            partition by fund_id, portfolio_id
            order by cashflow_date
            rows between unbounded preceding and current row
        ) as cumulative_called,
        sum(case when cashflow_type = 'distribution' then amount else 0 end) over (
            partition by fund_id, portfolio_id
            order by cashflow_date
            rows between unbounded preceding and current row
        ) as cumulative_distributed,
        sum(amount) over (
            partition by fund_id, portfolio_id
            order by cashflow_date
            rows between unbounded preceding and current row
        ) as cumulative_net_cashflow
    from cashflow_with_details
)

select
    cashflow_id,
    fund_id,
    fund_name,
    fund_type,
    portfolio_id,
    portfolio_name,
    strategy,
    manager_name,
    cashflow_date,
    cashflow_type,
    amount,
    currency,
    description,
    investor_id,
    cashflow_fiscal_quarter,
    cashflow_year,
    committed_capital,
    management_fee_rate,
    carry_rate,
    hurdle_rate,
    cumulative_called,
    cumulative_distributed,
    cumulative_net_cashflow,
    case
        when committed_capital > 0
        then cumulative_called / committed_capital
        else 0
    end as pct_called
from cashflow_cumulative
  );
[0m19:30:15.942638 [debug] [Thread-4  ]: On model.bain_capital_analytics.int_benchmark_returns: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.int_benchmark_returns"} */

  create view "bain_analytics"."public"."int_benchmark_returns__dbt_tmp"
    
    
  as (
    -- Pipeline C: Benchmark returns with rolling calculations
-- Anti-pattern: heavy window functions that could be pre-computed

with benchmark_base as (
    select
        b.benchmark_id,
        b.benchmark_name,
        b.benchmark_date,
        b.return_daily,
        b.return_mtd,
        b.return_ytd,
        b.benchmark_level,
        b.benchmark_fiscal_quarter,
        d.fiscal_year,
        d.is_quarter_end,
        d.is_year_end
    from "bain_analytics"."public"."stg_benchmarks" b
    inner join "bain_analytics"."public"."stg_dates" d
        on b.benchmark_date = d.date_day
),

-- Anti-pattern: compute many overlapping windows
benchmark_with_rolling as (
    select
        bb.*,
        -- rolling 3-month return
        exp(sum(ln(1 + bb.return_mtd)) over (
            partition by bb.benchmark_id
            order by bb.benchmark_date
            rows between 2 preceding and current row
        )) - 1 as rolling_3m_return,
        -- rolling 6-month return
        exp(sum(ln(1 + bb.return_mtd)) over (
            partition by bb.benchmark_id
            order by bb.benchmark_date
            rows between 5 preceding and current row
        )) - 1 as rolling_6m_return,
        -- rolling 12-month return
        exp(sum(ln(1 + bb.return_mtd)) over (
            partition by bb.benchmark_id
            order by bb.benchmark_date
            rows between 11 preceding and current row
        )) - 1 as rolling_12m_return,
        -- Anti-pattern: volatility via window (expensive)
        stddev(bb.return_mtd) over (
            partition by bb.benchmark_id
            order by bb.benchmark_date
            rows between 11 preceding and current row
        ) as rolling_12m_volatility,
        avg(bb.return_mtd) over (
            partition by bb.benchmark_id
            order by bb.benchmark_date
            rows between 11 preceding and current row
        ) as rolling_12m_avg_return,
        lag(bb.benchmark_level) over (
            partition by bb.benchmark_id
            order by bb.benchmark_date
        ) as prev_benchmark_level
    from benchmark_base bb
)

select * from benchmark_with_rolling
  );
[0m19:30:15.943292 [info ] [Thread-1  ]: 30 of 54 PASS unique_stg_positions_position_id ................................. [[32mPASS[0m in 0.05s]
[0m19:30:15.943857 [debug] [Thread-1  ]: Finished running node test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f
[0m19:30:15.944204 [debug] [Thread-1  ]: Began running node model.bain_capital_analytics.int_irr_calculations
[0m19:30:15.944661 [debug] [Thread-2  ]: SQL status: BEGIN in 0.009 seconds
[0m19:30:15.945134 [info ] [Thread-1  ]: 34 of 54 START sql view model public.int_irr_calculations ...................... [RUN]
[0m19:30:15.945502 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.int_fund_nav"
[0m19:30:15.945872 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f, now model.bain_capital_analytics.int_irr_calculations)
[0m19:30:15.946303 [debug] [Thread-2  ]: On model.bain_capital_analytics.int_fund_nav: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.int_fund_nav"} */

  create view "bain_analytics"."public"."int_fund_nav__dbt_tmp"
    
    
  as (
    -- Pipeline C: Fund-level NAV calculation from portfolio valuations
-- Anti-pattern: late aggregation - joins everything then aggregates at the end
-- Anti-pattern: repeated joins to fund_structures and portfolios

with portfolio_valuations as (
    select
        v.portfolio_id,
        v.valuation_date,
        v.net_asset_value,
        v.gross_asset_value,
        v.total_liabilities,
        v.unrealized_pnl,
        v.realized_pnl,
        v.valuation_method,
        p.fund_id,
        p.portfolio_name,
        p.strategy,
        -- Anti-pattern: joining fund_structures again (already done in int_cashflow_enriched)
        fs.fund_name,
        fs.fund_type,
        fs.committed_capital,
        fs.management_fee_rate
    from "bain_analytics"."public"."stg_valuations" v
    inner join "bain_analytics"."public"."stg_portfolios" p
        on v.portfolio_id = p.portfolio_id
    inner join "bain_analytics"."public"."stg_fund_structures" fs
        on p.fund_id = fs.fund_id
),

-- Anti-pattern: aggregation happens here at the end after all joins
fund_level_nav as (
    select
        fund_id,
        fund_name,
        fund_type,
        committed_capital,
        management_fee_rate,
        valuation_date,
        sum(net_asset_value) as fund_nav,
        sum(gross_asset_value) as fund_gav,
        sum(total_liabilities) as fund_total_liabilities,
        sum(unrealized_pnl) as fund_unrealized_pnl,
        sum(realized_pnl) as fund_realized_pnl,
        count(distinct portfolio_id) as num_portfolios
    from portfolio_valuations
    group by
        fund_id, fund_name, fund_type, committed_capital,
        management_fee_rate, valuation_date
),

fund_nav_with_changes as (
    select
        fn.*,
        lag(fn.fund_nav) over (
            partition by fn.fund_id order by fn.valuation_date
        ) as prev_fund_nav,
        case
            when lag(fn.fund_nav) over (
                partition by fn.fund_id order by fn.valuation_date
            ) is not null
            and lag(fn.fund_nav) over (
                partition by fn.fund_id order by fn.valuation_date
            ) != 0
            then (fn.fund_nav - lag(fn.fund_nav) over (
                partition by fn.fund_id order by fn.valuation_date
            )) / lag(fn.fund_nav) over (
                partition by fn.fund_id order by fn.valuation_date
            )
            else null
        end as fund_nav_return,
        fn.fund_nav / nullif(fn.committed_capital, 0) as tvpi_gross
    from fund_level_nav fn
)

select * from fund_nav_with_changes
  );
[0m19:30:15.946714 [debug] [Thread-1  ]: Began compiling node model.bain_capital_analytics.int_irr_calculations
[0m19:30:15.950799 [debug] [Thread-1  ]: Writing injected SQL for node "model.bain_capital_analytics.int_irr_calculations"
[0m19:30:15.951153 [debug] [Thread-4  ]: SQL status: CREATE VIEW in 0.007 seconds
[0m19:30:15.951500 [debug] [Thread-3  ]: SQL status: CREATE VIEW in 0.008 seconds
[0m19:30:15.954361 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.int_benchmark_returns"
[0m19:30:15.954686 [debug] [Thread-2  ]: SQL status: CREATE VIEW in 0.008 seconds
[0m19:30:15.958533 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.int_cashflow_enriched"
[0m19:30:15.958913 [debug] [Thread-4  ]: On model.bain_capital_analytics.int_benchmark_returns: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.int_benchmark_returns"} */
alter table "bain_analytics"."public"."int_benchmark_returns__dbt_tmp" rename to "int_benchmark_returns"
[0m19:30:15.961704 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.int_fund_nav"
[0m19:30:15.962027 [debug] [Thread-1  ]: Began executing node model.bain_capital_analytics.int_irr_calculations
[0m19:30:15.962380 [debug] [Thread-3  ]: On model.bain_capital_analytics.int_cashflow_enriched: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.int_cashflow_enriched"} */
alter table "bain_analytics"."public"."int_cashflow_enriched__dbt_tmp" rename to "int_cashflow_enriched"
[0m19:30:15.962754 [debug] [Thread-2  ]: On model.bain_capital_analytics.int_fund_nav: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.int_fund_nav"} */
alter table "bain_analytics"."public"."int_fund_nav__dbt_tmp" rename to "int_fund_nav"
[0m19:30:15.966276 [debug] [Thread-1  ]: Writing runtime sql for node "model.bain_capital_analytics.int_irr_calculations"
[0m19:30:15.966656 [debug] [Thread-4  ]: SQL status: ALTER TABLE in 0.004 seconds
[0m19:30:15.967816 [debug] [Thread-4  ]: On model.bain_capital_analytics.int_benchmark_returns: COMMIT
[0m19:30:15.968134 [debug] [Thread-3  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m19:30:15.968445 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.int_benchmark_returns"
[0m19:30:15.968784 [debug] [Thread-2  ]: SQL status: ALTER TABLE in 0.002 seconds
[0m19:30:15.969733 [debug] [Thread-3  ]: On model.bain_capital_analytics.int_cashflow_enriched: COMMIT
[0m19:30:15.970098 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.int_irr_calculations"
[0m19:30:15.970397 [debug] [Thread-4  ]: On model.bain_capital_analytics.int_benchmark_returns: COMMIT
[0m19:30:15.971389 [debug] [Thread-2  ]: On model.bain_capital_analytics.int_fund_nav: COMMIT
[0m19:30:15.971709 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.int_cashflow_enriched"
[0m19:30:15.972007 [debug] [Thread-1  ]: On model.bain_capital_analytics.int_irr_calculations: BEGIN
[0m19:30:15.972336 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.int_fund_nav"
[0m19:30:15.972649 [debug] [Thread-3  ]: On model.bain_capital_analytics.int_cashflow_enriched: COMMIT
[0m19:30:15.972982 [debug] [Thread-4  ]: SQL status: COMMIT in 0.001 seconds
[0m19:30:15.973250 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m19:30:15.973544 [debug] [Thread-2  ]: On model.bain_capital_analytics.int_fund_nav: COMMIT
[0m19:30:15.975951 [debug] [Thread-4  ]: Applying DROP to: "bain_analytics"."public"."int_benchmark_returns__dbt_backup"
[0m19:30:15.976269 [debug] [Thread-3  ]: SQL status: COMMIT in 0.002 seconds
[0m19:30:15.976875 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.int_benchmark_returns"
[0m19:30:15.977200 [debug] [Thread-2  ]: SQL status: COMMIT in 0.001 seconds
[0m19:30:15.979376 [debug] [Thread-3  ]: Applying DROP to: "bain_analytics"."public"."int_cashflow_enriched__dbt_backup"
[0m19:30:15.979708 [debug] [Thread-4  ]: On model.bain_capital_analytics.int_benchmark_returns: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.int_benchmark_returns"} */
drop view if exists "bain_analytics"."public"."int_benchmark_returns__dbt_backup" cascade
[0m19:30:15.982799 [debug] [Thread-2  ]: Applying DROP to: "bain_analytics"."public"."int_fund_nav__dbt_backup"
[0m19:30:15.983313 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.int_cashflow_enriched"
[0m19:30:15.983871 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.int_fund_nav"
[0m19:30:15.984248 [debug] [Thread-1  ]: SQL status: BEGIN in 0.011 seconds
[0m19:30:15.984550 [debug] [Thread-4  ]: SQL status: DROP VIEW in 0.001 seconds
[0m19:30:15.984866 [debug] [Thread-3  ]: On model.bain_capital_analytics.int_cashflow_enriched: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.int_cashflow_enriched"} */
drop view if exists "bain_analytics"."public"."int_cashflow_enriched__dbt_backup" cascade
[0m19:30:15.985189 [debug] [Thread-2  ]: On model.bain_capital_analytics.int_fund_nav: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.int_fund_nav"} */
drop view if exists "bain_analytics"."public"."int_fund_nav__dbt_backup" cascade
[0m19:30:15.985488 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.int_irr_calculations"
[0m19:30:15.986531 [debug] [Thread-4  ]: On model.bain_capital_analytics.int_benchmark_returns: Close
[0m19:30:15.987080 [debug] [Thread-1  ]: On model.bain_capital_analytics.int_irr_calculations: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.int_irr_calculations"} */

  create view "bain_analytics"."public"."int_irr_calculations__dbt_tmp"
    
    
  as (
    -- Pipeline C: Approximate IRR calculation per fund/portfolio
-- Anti-pattern: extremely deep CTE nesting (6 levels)
-- Anti-pattern: PostgreSQL-specific date arithmetic
-- Anti-pattern: complex logic that should be a macro

with cashflow_series as (
    -- CTE level 1: get all cashflows with proper signs
    select
        cf.fund_id,
        cf.portfolio_id,
        cf.cashflow_date,
        cf.cashflow_type,
        case
            when cf.cashflow_type = 'capital_call' then -1 * abs(cf.amount)
            when cf.cashflow_type = 'distribution' then abs(cf.amount)
            when cf.cashflow_type = 'management_fee' then -1 * abs(cf.amount)
            else cf.amount
        end as signed_amount
    from "bain_analytics"."public"."stg_cashflows" cf
),

terminal_values as (
    -- CTE level 2: get latest NAV as terminal cashflow
    select
        v.portfolio_id,
        p.fund_id,
        v.valuation_date as cashflow_date,
        'terminal_value' as cashflow_type,
        v.net_asset_value as signed_amount
    from "bain_analytics"."public"."stg_valuations" v
    inner join "bain_analytics"."public"."stg_portfolios" p
        on v.portfolio_id = p.portfolio_id
    where v.valuation_date = (
        -- Anti-pattern: correlated subquery instead of window function
        select max(v2.valuation_date)
        from "bain_analytics"."public"."stg_valuations" v2
        where v2.portfolio_id = v.portfolio_id
    )
),

all_cashflows as (
    -- CTE level 3: union cashflows and terminal values
    select fund_id, portfolio_id, cashflow_date, cashflow_type, signed_amount
    from cashflow_series
    union all
    select fund_id, portfolio_id, cashflow_date, cashflow_type, signed_amount
    from terminal_values
),

cashflow_with_timing as (
    -- CTE level 4: compute time fractions
    -- Anti-pattern: PostgreSQL date subtraction
    select
        ac.*,
        min(ac.cashflow_date) over (partition by ac.fund_id, ac.portfolio_id) as first_cf_date,
        (ac.cashflow_date - min(ac.cashflow_date) over (partition by ac.fund_id, ac.portfolio_id))::numeric / 365.25 as year_fraction
    from all_cashflows ac
),

-- CTE level 5: compute simple multiples as IRR proxy
portfolio_multiples as (
    select
        fund_id,
        portfolio_id,
        min(cashflow_date) as first_cashflow_date,
        max(cashflow_date) as last_cashflow_date,
        -- Anti-pattern: PostgreSQL date subtraction
        max(cashflow_date) - min(cashflow_date) as investment_days,
        (max(cashflow_date) - min(cashflow_date))::numeric / 365.25 as investment_years,
        sum(case when cashflow_type = 'capital_call' then abs(signed_amount) else 0 end) as total_invested,
        sum(case when cashflow_type = 'distribution' then signed_amount else 0 end) as total_distributed,
        sum(case when cashflow_type = 'terminal_value' then signed_amount else 0 end) as terminal_value,
        sum(signed_amount) as net_cashflow
    from cashflow_with_timing
    group by fund_id, portfolio_id
),

-- CTE level 6: compute IRR approximation
irr_approximation as (
    select
        pm.*,
        case
            when pm.total_invested > 0
            then (pm.total_distributed + pm.terminal_value) / pm.total_invested
            else null
        end as tvpi,
        case
            when pm.total_invested > 0
            then pm.total_distributed / pm.total_invested
            else null
        end as dpi,
        case
            when pm.total_invested > 0
            then pm.terminal_value / pm.total_invested
            else null
        end as rvpi,
        -- Simplified IRR approximation: (TVPI^(1/years)) - 1
        case
            when pm.total_invested > 0 and pm.investment_years > 0
            then power(
                (pm.total_distributed + pm.terminal_value) / pm.total_invested,
                1.0 / pm.investment_years
            ) - 1
            else null
        end as approx_irr
    from portfolio_multiples pm
)

select * from irr_approximation
  );
[0m19:30:15.987552 [debug] [Thread-3  ]: SQL status: DROP VIEW in 0.001 seconds
[0m19:30:15.987869 [debug] [Thread-2  ]: SQL status: DROP VIEW in 0.001 seconds
[0m19:30:15.988363 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '06decbc9-1bfd-415a-a35a-88ae35545da3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e722f10>]}
[0m19:30:15.989387 [debug] [Thread-3  ]: On model.bain_capital_analytics.int_cashflow_enriched: Close
[0m19:30:15.990415 [debug] [Thread-2  ]: On model.bain_capital_analytics.int_fund_nav: Close
[0m19:30:15.990996 [info ] [Thread-4  ]: 31 of 54 OK created sql view model public.int_benchmark_returns ................ [[32mCREATE VIEW[0m in 0.09s]
[0m19:30:15.991508 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '06decbc9-1bfd-415a-a35a-88ae35545da3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e40c8e0>]}
[0m19:30:15.991960 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '06decbc9-1bfd-415a-a35a-88ae35545da3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e4a3370>]}
[0m19:30:15.992394 [debug] [Thread-4  ]: Finished running node model.bain_capital_analytics.int_benchmark_returns
[0m19:30:15.993070 [info ] [Thread-3  ]: 32 of 54 OK created sql view model public.int_cashflow_enriched ................ [[32mCREATE VIEW[0m in 0.09s]
[0m19:30:15.993568 [info ] [Thread-2  ]: 33 of 54 OK created sql view model public.int_fund_nav ......................... [[32mCREATE VIEW[0m in 0.07s]
[0m19:30:15.993885 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.005 seconds
[0m19:30:15.994217 [debug] [Thread-4  ]: Began running node model.bain_capital_analytics.int_valuation_enriched
[0m19:30:15.994719 [debug] [Thread-3  ]: Finished running node model.bain_capital_analytics.int_cashflow_enriched
[0m19:30:15.995214 [debug] [Thread-2  ]: Finished running node model.bain_capital_analytics.int_fund_nav
[0m19:30:15.998007 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.int_irr_calculations"
[0m19:30:15.998420 [info ] [Thread-4  ]: 35 of 54 START sql view model public.int_valuation_enriched .................... [RUN]
[0m19:30:15.998789 [debug] [Thread-3  ]: Began running node model.bain_capital_analytics.int_portfolio_attribution
[0m19:30:15.999188 [debug] [Thread-2  ]: Began running node test.bain_capital_analytics.not_null_int_benchmark_returns_benchmark_id.fa96f53b44
[0m19:30:15.999587 [debug] [Thread-1  ]: On model.bain_capital_analytics.int_irr_calculations: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.int_irr_calculations"} */
alter table "bain_analytics"."public"."int_irr_calculations__dbt_tmp" rename to "int_irr_calculations"
[0m19:30:16.000169 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly model.bain_capital_analytics.int_benchmark_returns, now model.bain_capital_analytics.int_valuation_enriched)
[0m19:30:16.000592 [info ] [Thread-3  ]: 36 of 54 START sql view model public.int_portfolio_attribution ................. [RUN]
[0m19:30:16.000940 [info ] [Thread-2  ]: 37 of 54 START test not_null_int_benchmark_returns_benchmark_id ................ [RUN]
[0m19:30:16.001314 [debug] [Thread-4  ]: Began compiling node model.bain_capital_analytics.int_valuation_enriched
[0m19:30:16.001656 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly model.bain_capital_analytics.int_cashflow_enriched, now model.bain_capital_analytics.int_portfolio_attribution)
[0m19:30:16.001972 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly model.bain_capital_analytics.int_fund_nav, now test.bain_capital_analytics.not_null_int_benchmark_returns_benchmark_id.fa96f53b44)
[0m19:30:16.002309 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m19:30:16.005509 [debug] [Thread-4  ]: Writing injected SQL for node "model.bain_capital_analytics.int_valuation_enriched"
[0m19:30:16.005876 [debug] [Thread-3  ]: Began compiling node model.bain_capital_analytics.int_portfolio_attribution
[0m19:30:16.006208 [debug] [Thread-2  ]: Began compiling node test.bain_capital_analytics.not_null_int_benchmark_returns_benchmark_id.fa96f53b44
[0m19:30:16.007242 [debug] [Thread-1  ]: On model.bain_capital_analytics.int_irr_calculations: COMMIT
[0m19:30:16.010610 [debug] [Thread-3  ]: Writing injected SQL for node "model.bain_capital_analytics.int_portfolio_attribution"
[0m19:30:16.013980 [debug] [Thread-2  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_int_benchmark_returns_benchmark_id.fa96f53b44"
[0m19:30:16.014339 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.int_irr_calculations"
[0m19:30:16.014655 [debug] [Thread-4  ]: Began executing node model.bain_capital_analytics.int_valuation_enriched
[0m19:30:16.015085 [debug] [Thread-1  ]: On model.bain_capital_analytics.int_irr_calculations: COMMIT
[0m19:30:16.018468 [debug] [Thread-4  ]: Writing runtime sql for node "model.bain_capital_analytics.int_valuation_enriched"
[0m19:30:16.018837 [debug] [Thread-3  ]: Began executing node model.bain_capital_analytics.int_portfolio_attribution
[0m19:30:16.019256 [debug] [Thread-2  ]: Began executing node test.bain_capital_analytics.not_null_int_benchmark_returns_benchmark_id.fa96f53b44
[0m19:30:16.023757 [debug] [Thread-3  ]: Writing runtime sql for node "model.bain_capital_analytics.int_portfolio_attribution"
[0m19:30:16.024109 [debug] [Thread-1  ]: SQL status: COMMIT in 0.005 seconds
[0m19:30:16.026333 [debug] [Thread-2  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_int_benchmark_returns_benchmark_id.fa96f53b44"
[0m19:30:16.026705 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.int_valuation_enriched"
[0m19:30:16.028955 [debug] [Thread-1  ]: Applying DROP to: "bain_analytics"."public"."int_irr_calculations__dbt_backup"
[0m19:30:16.029361 [debug] [Thread-4  ]: On model.bain_capital_analytics.int_valuation_enriched: BEGIN
[0m19:30:16.029712 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.int_portfolio_attribution"
[0m19:30:16.030199 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.int_irr_calculations"
[0m19:30:16.030551 [debug] [Thread-4  ]: Opening a new connection, currently in state closed
[0m19:30:16.030877 [debug] [Thread-3  ]: On model.bain_capital_analytics.int_portfolio_attribution: BEGIN
[0m19:30:16.031215 [debug] [Thread-2  ]: Using postgres connection "test.bain_capital_analytics.not_null_int_benchmark_returns_benchmark_id.fa96f53b44"
[0m19:30:16.031518 [debug] [Thread-1  ]: On model.bain_capital_analytics.int_irr_calculations: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.int_irr_calculations"} */
drop view if exists "bain_analytics"."public"."int_irr_calculations__dbt_backup" cascade
[0m19:30:16.032027 [debug] [Thread-3  ]: Opening a new connection, currently in state closed
[0m19:30:16.032386 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_int_benchmark_returns_benchmark_id.fa96f53b44: BEGIN
[0m19:30:16.032808 [debug] [Thread-2  ]: Opening a new connection, currently in state closed
[0m19:30:16.033338 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.001 seconds
[0m19:30:16.034489 [debug] [Thread-1  ]: On model.bain_capital_analytics.int_irr_calculations: Close
[0m19:30:16.035008 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '06decbc9-1bfd-415a-a35a-88ae35545da3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e198970>]}
[0m19:30:16.035566 [info ] [Thread-1  ]: 34 of 54 OK created sql view model public.int_irr_calculations ................. [[32mCREATE VIEW[0m in 0.09s]
[0m19:30:16.036030 [debug] [Thread-1  ]: Finished running node model.bain_capital_analytics.int_irr_calculations
[0m19:30:16.036367 [debug] [Thread-1  ]: Began running node test.bain_capital_analytics.not_null_int_cashflow_enriched_cashflow_id.8460e9066d
[0m19:30:16.036861 [info ] [Thread-1  ]: 38 of 54 START test not_null_int_cashflow_enriched_cashflow_id ................. [RUN]
[0m19:30:16.037325 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.bain_capital_analytics.int_irr_calculations, now test.bain_capital_analytics.not_null_int_cashflow_enriched_cashflow_id.8460e9066d)
[0m19:30:16.037668 [debug] [Thread-1  ]: Began compiling node test.bain_capital_analytics.not_null_int_cashflow_enriched_cashflow_id.8460e9066d
[0m19:30:16.041418 [debug] [Thread-1  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_int_cashflow_enriched_cashflow_id.8460e9066d"
[0m19:30:16.042155 [debug] [Thread-1  ]: Began executing node test.bain_capital_analytics.not_null_int_cashflow_enriched_cashflow_id.8460e9066d
[0m19:30:16.044514 [debug] [Thread-1  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_int_cashflow_enriched_cashflow_id.8460e9066d"
[0m19:30:16.044863 [debug] [Thread-4  ]: SQL status: BEGIN in 0.014 seconds
[0m19:30:16.045176 [debug] [Thread-2  ]: SQL status: BEGIN in 0.012 seconds
[0m19:30:16.045477 [debug] [Thread-3  ]: SQL status: BEGIN in 0.013 seconds
[0m19:30:16.045828 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.int_valuation_enriched"
[0m19:30:16.046143 [debug] [Thread-2  ]: Using postgres connection "test.bain_capital_analytics.not_null_int_benchmark_returns_benchmark_id.fa96f53b44"
[0m19:30:16.046474 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.int_portfolio_attribution"
[0m19:30:16.046824 [debug] [Thread-1  ]: Using postgres connection "test.bain_capital_analytics.not_null_int_cashflow_enriched_cashflow_id.8460e9066d"
[0m19:30:16.047212 [debug] [Thread-4  ]: On model.bain_capital_analytics.int_valuation_enriched: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.int_valuation_enriched"} */

  create view "bain_analytics"."public"."int_valuation_enriched__dbt_tmp"
    
    
  as (
    -- Pipeline C: Enriched valuation data
-- Anti-pattern: subquery for dedup instead of QUALIFY
-- Anti-pattern: repeated portfolio join
-- Anti-pattern: PostgreSQL-specific date functions

with valuation_ranked as (
    select *
    from (
        select
            v.*,
            p.portfolio_name,
            p.strategy,
            p.fund_id,
            p.manager_name,
            -- Anti-pattern: subquery dedup instead of QUALIFY
            row_number() over (
                partition by v.portfolio_id, v.valuation_date
                order by v.valuation_id desc
            ) as rn
        from "bain_analytics"."public"."stg_valuations" v
        inner join "bain_analytics"."public"."stg_portfolios" p
            on v.portfolio_id = p.portfolio_id
    ) sub
    where rn = 1
),

valuation_with_changes as (
    select
        vr.*,
        lag(vr.net_asset_value) over (
            partition by vr.portfolio_id order by vr.valuation_date
        ) as prev_nav,
        case
            when lag(vr.net_asset_value) over (
                partition by vr.portfolio_id order by vr.valuation_date
            ) is not null
            and lag(vr.net_asset_value) over (
                partition by vr.portfolio_id order by vr.valuation_date
            ) != 0
            then (vr.net_asset_value - lag(vr.net_asset_value) over (
                partition by vr.portfolio_id order by vr.valuation_date
            )) / lag(vr.net_asset_value) over (
                partition by vr.portfolio_id order by vr.valuation_date
            )
            else null
        end as nav_return_pct,
        -- Anti-pattern: PostgreSQL date subtraction
        vr.valuation_date - lag(vr.valuation_date) over (
            partition by vr.portfolio_id order by vr.valuation_date
        ) as days_between_valuations
    from valuation_ranked vr
)

select * from valuation_with_changes
  );
[0m19:30:16.047596 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_int_benchmark_returns_benchmark_id.fa96f53b44: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_int_benchmark_returns_benchmark_id.fa96f53b44"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select benchmark_id
from "bain_analytics"."public"."int_benchmark_returns"
where benchmark_id is null



  
  
      
    ) dbt_internal_test
[0m19:30:16.048003 [debug] [Thread-3  ]: On model.bain_capital_analytics.int_portfolio_attribution: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.int_portfolio_attribution"} */

  create view "bain_analytics"."public"."int_portfolio_attribution__dbt_tmp"
    
    
  as (
    -- Pipeline C: Portfolio performance attribution by sector and instrument type
-- Anti-pattern: deep CTE chain, repeated joins, late aggregation
-- Anti-pattern: same position-instrument-portfolio joins as int_daily_positions

with positions_enriched as (
    -- Anti-pattern: repeating the same 3-way join as int_daily_positions
    select
        pos.position_id,
        pos.portfolio_id,
        pos.instrument_id,
        pos.position_date,
        pos.quantity,
        pos.market_value,
        pos.cost_basis,
        pos.unrealized_gain_loss,
        i.instrument_name,
        i.instrument_type,
        i.sector,
        p.portfolio_name,
        p.strategy,
        p.fund_id
    from "bain_analytics"."public"."stg_positions" pos
    inner join "bain_analytics"."public"."stg_instruments" i
        on pos.instrument_id = i.instrument_id
    inner join "bain_analytics"."public"."stg_portfolios" p
        on pos.portfolio_id = p.portfolio_id
),

-- Anti-pattern: compute portfolio totals in a separate CTE instead of a single pass
portfolio_totals as (
    select
        portfolio_id,
        position_date,
        sum(market_value) as total_portfolio_mv,
        sum(unrealized_gain_loss) as total_portfolio_ugl
    from positions_enriched
    group by portfolio_id, position_date
),

-- Anti-pattern: sector aggregation in yet another CTE
sector_attribution as (
    select
        pe.portfolio_id,
        pe.portfolio_name,
        pe.strategy,
        pe.fund_id,
        pe.position_date,
        pe.sector,
        sum(pe.market_value) as sector_mv,
        sum(pe.unrealized_gain_loss) as sector_ugl,
        count(distinct pe.instrument_id) as num_instruments
    from positions_enriched pe
    group by
        pe.portfolio_id, pe.portfolio_name, pe.strategy,
        pe.fund_id, pe.position_date, pe.sector
),

-- Anti-pattern: joining back to get weights instead of computing in one pass
attribution_with_weights as (
    select
        sa.*,
        pt.total_portfolio_mv,
        pt.total_portfolio_ugl,
        case
            when pt.total_portfolio_mv != 0
            then sa.sector_mv / pt.total_portfolio_mv
            else 0
        end as sector_weight,
        case
            when pt.total_portfolio_ugl != 0
            then sa.sector_ugl / pt.total_portfolio_ugl
            else 0
        end as sector_contribution
    from sector_attribution sa
    inner join portfolio_totals pt
        on sa.portfolio_id = pt.portfolio_id
        and sa.position_date = pt.position_date
)

select * from attribution_with_weights
  );
[0m19:30:16.048405 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_int_cashflow_enriched_cashflow_id.8460e9066d: BEGIN
[0m19:30:16.048881 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m19:30:16.052240 [debug] [Thread-2  ]: SQL status: SELECT 1 in 0.003 seconds
[0m19:30:16.053512 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_int_benchmark_returns_benchmark_id.fa96f53b44: ROLLBACK
[0m19:30:16.053913 [debug] [Thread-4  ]: SQL status: CREATE VIEW in 0.005 seconds
[0m19:30:16.054208 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_int_benchmark_returns_benchmark_id.fa96f53b44: Close
[0m19:30:16.054501 [debug] [Thread-3  ]: SQL status: CREATE VIEW in 0.006 seconds
[0m19:30:16.058416 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.int_valuation_enriched"
[0m19:30:16.058960 [info ] [Thread-2  ]: 37 of 54 PASS not_null_int_benchmark_returns_benchmark_id ...................... [[32mPASS[0m in 0.06s]
[0m19:30:16.061733 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.int_portfolio_attribution"
[0m19:30:16.062035 [debug] [Thread-1  ]: SQL status: BEGIN in 0.013 seconds
[0m19:30:16.062353 [debug] [Thread-4  ]: On model.bain_capital_analytics.int_valuation_enriched: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.int_valuation_enriched"} */
alter table "bain_analytics"."public"."int_valuation_enriched__dbt_tmp" rename to "int_valuation_enriched"
[0m19:30:16.062810 [debug] [Thread-2  ]: Finished running node test.bain_capital_analytics.not_null_int_benchmark_returns_benchmark_id.fa96f53b44
[0m19:30:16.063123 [debug] [Thread-3  ]: On model.bain_capital_analytics.int_portfolio_attribution: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.int_portfolio_attribution"} */
alter table "bain_analytics"."public"."int_portfolio_attribution__dbt_tmp" rename to "int_portfolio_attribution"
[0m19:30:16.063424 [debug] [Thread-1  ]: Using postgres connection "test.bain_capital_analytics.not_null_int_cashflow_enriched_cashflow_id.8460e9066d"
[0m19:30:16.063812 [debug] [Thread-2  ]: Began running node test.bain_capital_analytics.unique_int_cashflow_enriched_cashflow_id.6944893c17
[0m19:30:16.064235 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_int_cashflow_enriched_cashflow_id.8460e9066d: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_int_cashflow_enriched_cashflow_id.8460e9066d"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select cashflow_id
from "bain_analytics"."public"."int_cashflow_enriched"
where cashflow_id is null



  
  
      
    ) dbt_internal_test
[0m19:30:16.064670 [debug] [Thread-4  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m19:30:16.065000 [info ] [Thread-2  ]: 39 of 54 START test unique_int_cashflow_enriched_cashflow_id ................... [RUN]
[0m19:30:16.065323 [debug] [Thread-3  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m19:30:16.066390 [debug] [Thread-4  ]: On model.bain_capital_analytics.int_valuation_enriched: COMMIT
[0m19:30:16.066754 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.not_null_int_benchmark_returns_benchmark_id.fa96f53b44, now test.bain_capital_analytics.unique_int_cashflow_enriched_cashflow_id.6944893c17)
[0m19:30:16.067672 [debug] [Thread-3  ]: On model.bain_capital_analytics.int_portfolio_attribution: COMMIT
[0m19:30:16.067979 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.int_valuation_enriched"
[0m19:30:16.068278 [debug] [Thread-2  ]: Began compiling node test.bain_capital_analytics.unique_int_cashflow_enriched_cashflow_id.6944893c17
[0m19:30:16.068577 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.int_portfolio_attribution"
[0m19:30:16.068863 [debug] [Thread-4  ]: On model.bain_capital_analytics.int_valuation_enriched: COMMIT
[0m19:30:16.072443 [debug] [Thread-2  ]: Writing injected SQL for node "test.bain_capital_analytics.unique_int_cashflow_enriched_cashflow_id.6944893c17"
[0m19:30:16.072785 [debug] [Thread-1  ]: SQL status: SELECT 1 in 0.007 seconds
[0m19:30:16.073083 [debug] [Thread-3  ]: On model.bain_capital_analytics.int_portfolio_attribution: COMMIT
[0m19:30:16.074313 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_int_cashflow_enriched_cashflow_id.8460e9066d: ROLLBACK
[0m19:30:16.074649 [debug] [Thread-4  ]: SQL status: COMMIT in 0.001 seconds
[0m19:30:16.075075 [debug] [Thread-2  ]: Began executing node test.bain_capital_analytics.unique_int_cashflow_enriched_cashflow_id.6944893c17
[0m19:30:16.077336 [debug] [Thread-4  ]: Applying DROP to: "bain_analytics"."public"."int_valuation_enriched__dbt_backup"
[0m19:30:16.077620 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_int_cashflow_enriched_cashflow_id.8460e9066d: Close
[0m19:30:16.077893 [debug] [Thread-3  ]: SQL status: COMMIT in 0.003 seconds
[0m19:30:16.080078 [debug] [Thread-2  ]: Writing runtime sql for node "test.bain_capital_analytics.unique_int_cashflow_enriched_cashflow_id.6944893c17"
[0m19:30:16.080558 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.int_valuation_enriched"
[0m19:30:16.083247 [debug] [Thread-3  ]: Applying DROP to: "bain_analytics"."public"."int_portfolio_attribution__dbt_backup"
[0m19:30:16.081040 [info ] [Thread-1  ]: 38 of 54 PASS not_null_int_cashflow_enriched_cashflow_id ....................... [[32mPASS[0m in 0.04s]
[0m19:30:16.083717 [debug] [Thread-4  ]: On model.bain_capital_analytics.int_valuation_enriched: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.int_valuation_enriched"} */
drop view if exists "bain_analytics"."public"."int_valuation_enriched__dbt_backup" cascade
[0m19:30:16.084190 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.int_portfolio_attribution"
[0m19:30:16.084657 [debug] [Thread-1  ]: Finished running node test.bain_capital_analytics.not_null_int_cashflow_enriched_cashflow_id.8460e9066d
[0m19:30:16.084992 [debug] [Thread-2  ]: Using postgres connection "test.bain_capital_analytics.unique_int_cashflow_enriched_cashflow_id.6944893c17"
[0m19:30:16.085318 [debug] [Thread-3  ]: On model.bain_capital_analytics.int_portfolio_attribution: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.int_portfolio_attribution"} */
drop view if exists "bain_analytics"."public"."int_portfolio_attribution__dbt_backup" cascade
[0m19:30:16.085650 [debug] [Thread-1  ]: Began running node test.bain_capital_analytics.not_null_int_fund_nav_fund_id.ebf0b6cc99
[0m19:30:16.085951 [debug] [Thread-4  ]: SQL status: DROP VIEW in 0.001 seconds
[0m19:30:16.086279 [debug] [Thread-2  ]: On test.bain_capital_analytics.unique_int_cashflow_enriched_cashflow_id.6944893c17: BEGIN
[0m19:30:16.086614 [info ] [Thread-1  ]: 40 of 54 START test not_null_int_fund_nav_fund_id .............................. [RUN]
[0m19:30:16.086928 [debug] [Thread-3  ]: SQL status: DROP VIEW in 0.000 seconds
[0m19:30:16.087909 [debug] [Thread-4  ]: On model.bain_capital_analytics.int_valuation_enriched: Close
[0m19:30:16.088212 [debug] [Thread-2  ]: Opening a new connection, currently in state closed
[0m19:30:16.088550 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.not_null_int_cashflow_enriched_cashflow_id.8460e9066d, now test.bain_capital_analytics.not_null_int_fund_nav_fund_id.ebf0b6cc99)
[0m19:30:16.089480 [debug] [Thread-3  ]: On model.bain_capital_analytics.int_portfolio_attribution: Close
[0m19:30:16.089963 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '06decbc9-1bfd-415a-a35a-88ae35545da3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e48a6a0>]}
[0m19:30:16.090363 [debug] [Thread-1  ]: Began compiling node test.bain_capital_analytics.not_null_int_fund_nav_fund_id.ebf0b6cc99
[0m19:30:16.090885 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '06decbc9-1bfd-415a-a35a-88ae35545da3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e4b2040>]}
[0m19:30:16.095775 [debug] [Thread-1  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_int_fund_nav_fund_id.ebf0b6cc99"
[0m19:30:16.096272 [info ] [Thread-4  ]: 35 of 54 OK created sql view model public.int_valuation_enriched ............... [[32mCREATE VIEW[0m in 0.09s]
[0m19:30:16.096850 [info ] [Thread-3  ]: 36 of 54 OK created sql view model public.int_portfolio_attribution ............ [[32mCREATE VIEW[0m in 0.09s]
[0m19:30:16.097329 [debug] [Thread-4  ]: Finished running node model.bain_capital_analytics.int_valuation_enriched
[0m19:30:16.097793 [debug] [Thread-3  ]: Finished running node model.bain_capital_analytics.int_portfolio_attribution
[0m19:30:16.098169 [debug] [Thread-4  ]: Began running node test.bain_capital_analytics.not_null_int_irr_calculations_fund_id.35702f5be3
[0m19:30:16.098489 [debug] [Thread-1  ]: Began executing node test.bain_capital_analytics.not_null_int_fund_nav_fund_id.ebf0b6cc99
[0m19:30:16.098894 [debug] [Thread-2  ]: SQL status: BEGIN in 0.011 seconds
[0m19:30:16.099250 [debug] [Thread-3  ]: Began running node test.bain_capital_analytics.not_null_int_irr_calculations_portfolio_id.5530046e4d
[0m19:30:16.099602 [info ] [Thread-4  ]: 41 of 54 START test not_null_int_irr_calculations_fund_id ...................... [RUN]
[0m19:30:16.101906 [debug] [Thread-1  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_int_fund_nav_fund_id.ebf0b6cc99"
[0m19:30:16.102237 [debug] [Thread-2  ]: Using postgres connection "test.bain_capital_analytics.unique_int_cashflow_enriched_cashflow_id.6944893c17"
[0m19:30:16.102550 [info ] [Thread-3  ]: 42 of 54 START test not_null_int_irr_calculations_portfolio_id ................. [RUN]
[0m19:30:16.102910 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly model.bain_capital_analytics.int_valuation_enriched, now test.bain_capital_analytics.not_null_int_irr_calculations_fund_id.35702f5be3)
[0m19:30:16.103299 [debug] [Thread-2  ]: On test.bain_capital_analytics.unique_int_cashflow_enriched_cashflow_id.6944893c17: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.unique_int_cashflow_enriched_cashflow_id.6944893c17"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

select
    cashflow_id as unique_field,
    count(*) as n_records

from "bain_analytics"."public"."int_cashflow_enriched"
where cashflow_id is not null
group by cashflow_id
having count(*) > 1



  
  
      
    ) dbt_internal_test
[0m19:30:16.103664 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly model.bain_capital_analytics.int_portfolio_attribution, now test.bain_capital_analytics.not_null_int_irr_calculations_portfolio_id.5530046e4d)
[0m19:30:16.103983 [debug] [Thread-4  ]: Began compiling node test.bain_capital_analytics.not_null_int_irr_calculations_fund_id.35702f5be3
[0m19:30:16.104314 [debug] [Thread-1  ]: Using postgres connection "test.bain_capital_analytics.not_null_int_fund_nav_fund_id.ebf0b6cc99"
[0m19:30:16.104633 [debug] [Thread-3  ]: Began compiling node test.bain_capital_analytics.not_null_int_irr_calculations_portfolio_id.5530046e4d
[0m19:30:16.107936 [debug] [Thread-4  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_int_irr_calculations_fund_id.35702f5be3"
[0m19:30:16.108244 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_int_fund_nav_fund_id.ebf0b6cc99: BEGIN
[0m19:30:16.111902 [debug] [Thread-3  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_int_irr_calculations_portfolio_id.5530046e4d"
[0m19:30:16.112334 [debug] [Thread-2  ]: SQL status: SELECT 1 in 0.008 seconds
[0m19:30:16.112756 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m19:30:16.114165 [debug] [Thread-2  ]: On test.bain_capital_analytics.unique_int_cashflow_enriched_cashflow_id.6944893c17: ROLLBACK
[0m19:30:16.114893 [debug] [Thread-4  ]: Began executing node test.bain_capital_analytics.not_null_int_irr_calculations_fund_id.35702f5be3
[0m19:30:16.117413 [debug] [Thread-4  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_int_irr_calculations_fund_id.35702f5be3"
[0m19:30:16.117735 [debug] [Thread-3  ]: Began executing node test.bain_capital_analytics.not_null_int_irr_calculations_portfolio_id.5530046e4d
[0m19:30:16.118035 [debug] [Thread-2  ]: On test.bain_capital_analytics.unique_int_cashflow_enriched_cashflow_id.6944893c17: Close
[0m19:30:16.120269 [debug] [Thread-3  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_int_irr_calculations_portfolio_id.5530046e4d"
[0m19:30:16.120840 [info ] [Thread-2  ]: 39 of 54 PASS unique_int_cashflow_enriched_cashflow_id ......................... [[32mPASS[0m in 0.05s]
[0m19:30:16.121229 [debug] [Thread-4  ]: Using postgres connection "test.bain_capital_analytics.not_null_int_irr_calculations_fund_id.35702f5be3"
[0m19:30:16.121718 [debug] [Thread-2  ]: Finished running node test.bain_capital_analytics.unique_int_cashflow_enriched_cashflow_id.6944893c17
[0m19:30:16.122032 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_int_irr_calculations_fund_id.35702f5be3: BEGIN
[0m19:30:16.122432 [debug] [Thread-2  ]: Began running node test.bain_capital_analytics.not_null_int_valuation_enriched_valuation_id.048a7ba03a
[0m19:30:16.122840 [debug] [Thread-3  ]: Using postgres connection "test.bain_capital_analytics.not_null_int_irr_calculations_portfolio_id.5530046e4d"
[0m19:30:16.123128 [debug] [Thread-4  ]: Opening a new connection, currently in state closed
[0m19:30:16.123477 [debug] [Thread-1  ]: SQL status: BEGIN in 0.011 seconds
[0m19:30:16.123795 [info ] [Thread-2  ]: 43 of 54 START test not_null_int_valuation_enriched_valuation_id ............... [RUN]
[0m19:30:16.124123 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_int_irr_calculations_portfolio_id.5530046e4d: BEGIN
[0m19:30:16.124514 [debug] [Thread-1  ]: Using postgres connection "test.bain_capital_analytics.not_null_int_fund_nav_fund_id.ebf0b6cc99"
[0m19:30:16.124862 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.unique_int_cashflow_enriched_cashflow_id.6944893c17, now test.bain_capital_analytics.not_null_int_valuation_enriched_valuation_id.048a7ba03a)
[0m19:30:16.125178 [debug] [Thread-3  ]: Opening a new connection, currently in state closed
[0m19:30:16.125511 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_int_fund_nav_fund_id.ebf0b6cc99: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_int_fund_nav_fund_id.ebf0b6cc99"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select fund_id
from "bain_analytics"."public"."int_fund_nav"
where fund_id is null



  
  
      
    ) dbt_internal_test
[0m19:30:16.125830 [debug] [Thread-2  ]: Began compiling node test.bain_capital_analytics.not_null_int_valuation_enriched_valuation_id.048a7ba03a
[0m19:30:16.130497 [debug] [Thread-2  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_int_valuation_enriched_valuation_id.048a7ba03a"
[0m19:30:16.130890 [debug] [Thread-1  ]: SQL status: SELECT 1 in 0.005 seconds
[0m19:30:16.132415 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_int_fund_nav_fund_id.ebf0b6cc99: ROLLBACK
[0m19:30:16.132905 [debug] [Thread-2  ]: Began executing node test.bain_capital_analytics.not_null_int_valuation_enriched_valuation_id.048a7ba03a
[0m19:30:16.133279 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_int_fund_nav_fund_id.ebf0b6cc99: Close
[0m19:30:16.135724 [debug] [Thread-2  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_int_valuation_enriched_valuation_id.048a7ba03a"
[0m19:30:16.136050 [debug] [Thread-4  ]: SQL status: BEGIN in 0.013 seconds
[0m19:30:16.136580 [info ] [Thread-1  ]: 40 of 54 PASS not_null_int_fund_nav_fund_id .................................... [[32mPASS[0m in 0.05s]
[0m19:30:16.137026 [debug] [Thread-3  ]: SQL status: BEGIN in 0.012 seconds
[0m19:30:16.137329 [debug] [Thread-4  ]: Using postgres connection "test.bain_capital_analytics.not_null_int_irr_calculations_fund_id.35702f5be3"
[0m19:30:16.137760 [debug] [Thread-1  ]: Finished running node test.bain_capital_analytics.not_null_int_fund_nav_fund_id.ebf0b6cc99
[0m19:30:16.138101 [debug] [Thread-3  ]: Using postgres connection "test.bain_capital_analytics.not_null_int_irr_calculations_portfolio_id.5530046e4d"
[0m19:30:16.138469 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_int_irr_calculations_fund_id.35702f5be3: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_int_irr_calculations_fund_id.35702f5be3"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select fund_id
from "bain_analytics"."public"."int_irr_calculations"
where fund_id is null



  
  
      
    ) dbt_internal_test
[0m19:30:16.138843 [debug] [Thread-2  ]: Using postgres connection "test.bain_capital_analytics.not_null_int_valuation_enriched_valuation_id.048a7ba03a"
[0m19:30:16.139182 [debug] [Thread-1  ]: Began running node test.bain_capital_analytics.not_null_int_portfolio_attribution_portfolio_id.3e04b7c210
[0m19:30:16.139567 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_int_irr_calculations_portfolio_id.5530046e4d: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_int_irr_calculations_portfolio_id.5530046e4d"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select portfolio_id
from "bain_analytics"."public"."int_irr_calculations"
where portfolio_id is null



  
  
      
    ) dbt_internal_test
[0m19:30:16.139931 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_int_valuation_enriched_valuation_id.048a7ba03a: BEGIN
[0m19:30:16.140249 [info ] [Thread-1  ]: 44 of 54 START test not_null_int_portfolio_attribution_portfolio_id ............ [RUN]
[0m19:30:16.140588 [debug] [Thread-2  ]: Opening a new connection, currently in state closed
[0m19:30:16.140931 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.not_null_int_fund_nav_fund_id.ebf0b6cc99, now test.bain_capital_analytics.not_null_int_portfolio_attribution_portfolio_id.3e04b7c210)
[0m19:30:16.141349 [debug] [Thread-1  ]: Began compiling node test.bain_capital_analytics.not_null_int_portfolio_attribution_portfolio_id.3e04b7c210
[0m19:30:16.145128 [debug] [Thread-1  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_int_portfolio_attribution_portfolio_id.3e04b7c210"
[0m19:30:16.145507 [debug] [Thread-3  ]: SQL status: SELECT 1 in 0.005 seconds
[0m19:30:16.146814 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_int_irr_calculations_portfolio_id.5530046e4d: ROLLBACK
[0m19:30:16.147138 [debug] [Thread-4  ]: SQL status: SELECT 1 in 0.007 seconds
[0m19:30:16.148424 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_int_irr_calculations_fund_id.35702f5be3: ROLLBACK
[0m19:30:16.148766 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_int_irr_calculations_portfolio_id.5530046e4d: Close
[0m19:30:16.149107 [debug] [Thread-1  ]: Began executing node test.bain_capital_analytics.not_null_int_portfolio_attribution_portfolio_id.3e04b7c210
[0m19:30:16.149458 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_int_irr_calculations_fund_id.35702f5be3: Close
[0m19:30:16.151900 [debug] [Thread-1  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_int_portfolio_attribution_portfolio_id.3e04b7c210"
[0m19:30:16.152239 [debug] [Thread-2  ]: SQL status: BEGIN in 0.012 seconds
[0m19:30:16.152687 [info ] [Thread-3  ]: 42 of 54 PASS not_null_int_irr_calculations_portfolio_id ....................... [[32mPASS[0m in 0.05s]
[0m19:30:16.153146 [info ] [Thread-4  ]: 41 of 54 PASS not_null_int_irr_calculations_fund_id ............................ [[32mPASS[0m in 0.05s]
[0m19:30:16.153565 [debug] [Thread-2  ]: Using postgres connection "test.bain_capital_analytics.not_null_int_valuation_enriched_valuation_id.048a7ba03a"
[0m19:30:16.154005 [debug] [Thread-3  ]: Finished running node test.bain_capital_analytics.not_null_int_irr_calculations_portfolio_id.5530046e4d
[0m19:30:16.154470 [debug] [Thread-4  ]: Finished running node test.bain_capital_analytics.not_null_int_irr_calculations_fund_id.35702f5be3
[0m19:30:16.154807 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_int_valuation_enriched_valuation_id.048a7ba03a: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_int_valuation_enriched_valuation_id.048a7ba03a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select valuation_id
from "bain_analytics"."public"."int_valuation_enriched"
where valuation_id is null



  
  
      
    ) dbt_internal_test
[0m19:30:16.155180 [debug] [Thread-1  ]: Using postgres connection "test.bain_capital_analytics.not_null_int_portfolio_attribution_portfolio_id.3e04b7c210"
[0m19:30:16.155499 [debug] [Thread-3  ]: Began running node model.bain_capital_analytics.fact_cashflow_waterfall
[0m19:30:16.156064 [debug] [Thread-4  ]: Began running node model.bain_capital_analytics.fact_fund_performance
[0m19:30:16.156354 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_int_portfolio_attribution_portfolio_id.3e04b7c210: BEGIN
[0m19:30:16.156759 [info ] [Thread-3  ]: 45 of 54 START sql view model public.fact_cashflow_waterfall ................... [RUN]
[0m19:30:16.157195 [info ] [Thread-4  ]: 46 of 54 START sql view model public.fact_fund_performance ..................... [RUN]
[0m19:30:16.157532 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m19:30:16.157916 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.not_null_int_irr_calculations_portfolio_id.5530046e4d, now model.bain_capital_analytics.fact_cashflow_waterfall)
[0m19:30:16.158268 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.not_null_int_irr_calculations_fund_id.35702f5be3, now model.bain_capital_analytics.fact_fund_performance)
[0m19:30:16.158693 [debug] [Thread-3  ]: Began compiling node model.bain_capital_analytics.fact_cashflow_waterfall
[0m19:30:16.159012 [debug] [Thread-4  ]: Began compiling node model.bain_capital_analytics.fact_fund_performance
[0m19:30:16.159319 [debug] [Thread-2  ]: SQL status: SELECT 1 in 0.003 seconds
[0m19:30:16.162682 [debug] [Thread-3  ]: Writing injected SQL for node "model.bain_capital_analytics.fact_cashflow_waterfall"
[0m19:30:16.167058 [debug] [Thread-4  ]: Writing injected SQL for node "model.bain_capital_analytics.fact_fund_performance"
[0m19:30:16.168361 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_int_valuation_enriched_valuation_id.048a7ba03a: ROLLBACK
[0m19:30:16.168712 [debug] [Thread-1  ]: SQL status: BEGIN in 0.011 seconds
[0m19:30:16.169221 [debug] [Thread-1  ]: Using postgres connection "test.bain_capital_analytics.not_null_int_portfolio_attribution_portfolio_id.3e04b7c210"
[0m19:30:16.169566 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_int_valuation_enriched_valuation_id.048a7ba03a: Close
[0m19:30:16.169961 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_int_portfolio_attribution_portfolio_id.3e04b7c210: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_int_portfolio_attribution_portfolio_id.3e04b7c210"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select portfolio_id
from "bain_analytics"."public"."int_portfolio_attribution"
where portfolio_id is null



  
  
      
    ) dbt_internal_test
[0m19:30:16.170311 [debug] [Thread-3  ]: Began executing node model.bain_capital_analytics.fact_cashflow_waterfall
[0m19:30:16.170628 [debug] [Thread-4  ]: Began executing node model.bain_capital_analytics.fact_fund_performance
[0m19:30:16.171119 [info ] [Thread-2  ]: 43 of 54 PASS not_null_int_valuation_enriched_valuation_id ..................... [[32mPASS[0m in 0.05s]
[0m19:30:16.174643 [debug] [Thread-3  ]: Writing runtime sql for node "model.bain_capital_analytics.fact_cashflow_waterfall"
[0m19:30:16.177844 [debug] [Thread-4  ]: Writing runtime sql for node "model.bain_capital_analytics.fact_fund_performance"
[0m19:30:16.178182 [debug] [Thread-1  ]: SQL status: SELECT 1 in 0.007 seconds
[0m19:30:16.178585 [debug] [Thread-2  ]: Finished running node test.bain_capital_analytics.not_null_int_valuation_enriched_valuation_id.048a7ba03a
[0m19:30:16.179818 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_int_portfolio_attribution_portfolio_id.3e04b7c210: ROLLBACK
[0m19:30:16.180219 [debug] [Thread-2  ]: Began running node model.bain_capital_analytics.report_lp_quarterly
[0m19:30:16.180680 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.fact_cashflow_waterfall"
[0m19:30:16.181001 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_int_portfolio_attribution_portfolio_id.3e04b7c210: Close
[0m19:30:16.181342 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.fact_fund_performance"
[0m19:30:16.181737 [info ] [Thread-2  ]: 47 of 54 START sql view model public.report_lp_quarterly ....................... [RUN]
[0m19:30:16.182275 [debug] [Thread-3  ]: On model.bain_capital_analytics.fact_cashflow_waterfall: BEGIN
[0m19:30:16.182757 [info ] [Thread-1  ]: 44 of 54 PASS not_null_int_portfolio_attribution_portfolio_id .................. [[32mPASS[0m in 0.04s]
[0m19:30:16.183071 [debug] [Thread-4  ]: On model.bain_capital_analytics.fact_fund_performance: BEGIN
[0m19:30:16.183398 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.not_null_int_valuation_enriched_valuation_id.048a7ba03a, now model.bain_capital_analytics.report_lp_quarterly)
[0m19:30:16.183705 [debug] [Thread-3  ]: Opening a new connection, currently in state closed
[0m19:30:16.184126 [debug] [Thread-1  ]: Finished running node test.bain_capital_analytics.not_null_int_portfolio_attribution_portfolio_id.3e04b7c210
[0m19:30:16.184431 [debug] [Thread-4  ]: Opening a new connection, currently in state closed
[0m19:30:16.184751 [debug] [Thread-2  ]: Began compiling node model.bain_capital_analytics.report_lp_quarterly
[0m19:30:16.189023 [debug] [Thread-2  ]: Writing injected SQL for node "model.bain_capital_analytics.report_lp_quarterly"
[0m19:30:16.189369 [debug] [Thread-1  ]: Began running node model.bain_capital_analytics.fact_portfolio_attribution
[0m19:30:16.189841 [info ] [Thread-1  ]: 48 of 54 START sql view model public.fact_portfolio_attribution ................ [RUN]
[0m19:30:16.190222 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.not_null_int_portfolio_attribution_portfolio_id.3e04b7c210, now model.bain_capital_analytics.fact_portfolio_attribution)
[0m19:30:16.190531 [debug] [Thread-1  ]: Began compiling node model.bain_capital_analytics.fact_portfolio_attribution
[0m19:30:16.193386 [debug] [Thread-1  ]: Writing injected SQL for node "model.bain_capital_analytics.fact_portfolio_attribution"
[0m19:30:16.193941 [debug] [Thread-2  ]: Began executing node model.bain_capital_analytics.report_lp_quarterly
[0m19:30:16.198086 [debug] [Thread-2  ]: Writing runtime sql for node "model.bain_capital_analytics.report_lp_quarterly"
[0m19:30:16.198437 [debug] [Thread-4  ]: SQL status: BEGIN in 0.014 seconds
[0m19:30:16.198793 [debug] [Thread-3  ]: SQL status: BEGIN in 0.015 seconds
[0m19:30:16.199092 [debug] [Thread-1  ]: Began executing node model.bain_capital_analytics.fact_portfolio_attribution
[0m19:30:16.199443 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.fact_fund_performance"
[0m19:30:16.199739 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.fact_cashflow_waterfall"
[0m19:30:16.203014 [debug] [Thread-1  ]: Writing runtime sql for node "model.bain_capital_analytics.fact_portfolio_attribution"
[0m19:30:16.203387 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.report_lp_quarterly"
[0m19:30:16.203793 [debug] [Thread-4  ]: On model.bain_capital_analytics.fact_fund_performance: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.fact_fund_performance"} */

  create view "bain_analytics"."public"."fact_fund_performance__dbt_tmp"
    
    
  as (
    -- Pipeline C: FACT table - Fund-level performance metrics
-- Anti-pattern: late aggregation - joins everything then aggregates
-- Anti-pattern: re-joins fund_structures (already in int_fund_nav, int_cashflow_enriched)
-- Anti-pattern: materialized as view (should be table)

with fund_nav_data as (
    select
        fn.fund_id,
        fn.fund_name,
        fn.fund_type,
        fn.committed_capital,
        fn.valuation_date,
        fn.fund_nav,
        fn.fund_gav,
        fn.fund_total_liabilities,
        fn.fund_unrealized_pnl,
        fn.fund_realized_pnl,
        fn.fund_nav_return,
        fn.tvpi_gross,
        fn.num_portfolios
    from "bain_analytics"."public"."int_fund_nav" fn
),

fund_cashflows as (
    -- Anti-pattern: re-aggregating cashflows that are already in int_cashflow_enriched
    select
        cf.fund_id,
        cf.cashflow_date,
        sum(case when cf.cashflow_type = 'capital_call' then cf.amount else 0 end) as period_calls,
        sum(case when cf.cashflow_type = 'distribution' then cf.amount else 0 end) as period_distributions,
        sum(case when cf.cashflow_type = 'management_fee' then cf.amount else 0 end) as period_fees,
        sum(cf.amount) as period_net_cashflow
    from "bain_analytics"."public"."stg_cashflows" cf
    group by cf.fund_id, cf.cashflow_date
),

fund_irr as (
    select
        irr.fund_id,
        sum(irr.total_invested) as fund_total_invested,
        sum(irr.total_distributed) as fund_total_distributed,
        sum(irr.terminal_value) as fund_terminal_value,
        -- Anti-pattern: averaging portfolio IRRs as proxy for fund IRR (incorrect but intentional)
        avg(irr.approx_irr) as fund_approx_irr,
        avg(irr.tvpi) as fund_tvpi,
        avg(irr.dpi) as fund_dpi
    from "bain_analytics"."public"."int_irr_calculations" irr
    group by irr.fund_id
),

-- Anti-pattern: joining everything together at the end
combined as (
    select
        fn.fund_id,
        fn.fund_name,
        fn.fund_type,
        fn.committed_capital,
        fn.valuation_date,
        fn.fund_nav,
        fn.fund_gav,
        fn.fund_total_liabilities,
        fn.fund_unrealized_pnl,
        fn.fund_realized_pnl,
        fn.fund_nav_return,
        fn.tvpi_gross,
        fn.num_portfolios,
        coalesce(fc.period_calls, 0) as period_calls,
        coalesce(fc.period_distributions, 0) as period_distributions,
        coalesce(fc.period_fees, 0) as period_fees,
        coalesce(fc.period_net_cashflow, 0) as period_net_cashflow,
        fi.fund_total_invested,
        fi.fund_total_distributed,
        fi.fund_approx_irr,
        fi.fund_tvpi,
        fi.fund_dpi
    from fund_nav_data fn
    left join fund_cashflows fc
        on fn.fund_id = fc.fund_id
        and fn.valuation_date = fc.cashflow_date
    left join fund_irr fi
        on fn.fund_id = fi.fund_id
)

select * from combined
  );
[0m19:30:16.204287 [debug] [Thread-3  ]: On model.bain_capital_analytics.fact_cashflow_waterfall: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.fact_cashflow_waterfall"} */

  create view "bain_analytics"."public"."fact_cashflow_waterfall__dbt_tmp"
    
    
  as (
    -- Pipeline C: FACT table - Cashflow waterfall for PE/fund reporting
-- Anti-pattern: deep CTEs, repeated joins, late aggregation
-- Anti-pattern: PostgreSQL-specific date functions

with enriched_cashflows as (
    select
        ce.cashflow_id,
        ce.fund_id,
        ce.fund_name,
        ce.fund_type,
        ce.portfolio_id,
        ce.portfolio_name,
        ce.cashflow_date,
        ce.cashflow_type,
        ce.amount,
        ce.investor_id,
        ce.committed_capital,
        ce.management_fee_rate,
        ce.carry_rate,
        ce.hurdle_rate,
        ce.cumulative_called,
        ce.cumulative_distributed,
        ce.cumulative_net_cashflow,
        ce.pct_called,
        -- Anti-pattern: duplicated fiscal quarter logic
        case
            when extract(month from ce.cashflow_date) between 1 and 3 then 'Q3'
            when extract(month from ce.cashflow_date) between 4 and 6 then 'Q4'
            when extract(month from ce.cashflow_date) between 7 and 9 then 'Q1'
            when extract(month from ce.cashflow_date) between 10 and 12 then 'Q2'
        end as fiscal_quarter,
        -- Anti-pattern: PostgreSQL extract
        extract(year from ce.cashflow_date) as calendar_year
    from "bain_analytics"."public"."int_cashflow_enriched" ce
),

-- Anti-pattern: re-joining valuations when int_valuation_enriched already has this
waterfall_with_nav as (
    select
        ecf.*,
        v.net_asset_value,
        v.gross_asset_value,
        v.unrealized_pnl as nav_unrealized_pnl,
        v.realized_pnl as nav_realized_pnl
    from enriched_cashflows ecf
    left join "bain_analytics"."public"."stg_valuations" v
        on ecf.portfolio_id = v.portfolio_id
        and ecf.cashflow_date = v.valuation_date
),

-- Anti-pattern: computing carry/waterfall in a CTE chain instead of a macro
waterfall_calculations as (
    select
        wn.*,
        -- Simplified carry calculation
        case
            when wn.cumulative_distributed > wn.cumulative_called * (1 + wn.hurdle_rate)
            then (wn.cumulative_distributed - wn.cumulative_called * (1 + wn.hurdle_rate)) * wn.carry_rate
            else 0
        end as estimated_carry,
        wn.cumulative_called * wn.management_fee_rate as annual_mgmt_fee,
        case
            when wn.cumulative_called > 0
            then wn.cumulative_distributed / wn.cumulative_called
            else 0
        end as dpi,
        case
            when wn.cumulative_called > 0 and wn.net_asset_value is not null
            then (wn.cumulative_distributed + wn.net_asset_value) / wn.cumulative_called
            else null
        end as tvpi
    from waterfall_with_nav wn
)

select * from waterfall_calculations
  );
[0m19:30:16.204762 [debug] [Thread-2  ]: On model.bain_capital_analytics.report_lp_quarterly: BEGIN
[0m19:30:16.205233 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.fact_portfolio_attribution"
[0m19:30:16.205514 [debug] [Thread-2  ]: Opening a new connection, currently in state closed
[0m19:30:16.205821 [debug] [Thread-1  ]: On model.bain_capital_analytics.fact_portfolio_attribution: BEGIN
[0m19:30:16.206224 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m19:30:16.210014 [debug] [Thread-3  ]: SQL status: CREATE VIEW in 0.005 seconds
[0m19:30:16.210371 [debug] [Thread-4  ]: SQL status: CREATE VIEW in 0.005 seconds
[0m19:30:16.213377 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.fact_cashflow_waterfall"
[0m19:30:16.216090 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.fact_fund_performance"
[0m19:30:16.216487 [debug] [Thread-3  ]: On model.bain_capital_analytics.fact_cashflow_waterfall: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.fact_cashflow_waterfall"} */
alter table "bain_analytics"."public"."fact_cashflow_waterfall__dbt_tmp" rename to "fact_cashflow_waterfall"
[0m19:30:16.216855 [debug] [Thread-4  ]: On model.bain_capital_analytics.fact_fund_performance: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.fact_fund_performance"} */
alter table "bain_analytics"."public"."fact_fund_performance__dbt_tmp" rename to "fact_fund_performance"
[0m19:30:16.217214 [debug] [Thread-1  ]: SQL status: BEGIN in 0.011 seconds
[0m19:30:16.217543 [debug] [Thread-2  ]: SQL status: BEGIN in 0.012 seconds
[0m19:30:16.217888 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.fact_portfolio_attribution"
[0m19:30:16.218188 [debug] [Thread-3  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m19:30:16.218487 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.report_lp_quarterly"
[0m19:30:16.218781 [debug] [Thread-4  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m19:30:16.219152 [debug] [Thread-1  ]: On model.bain_capital_analytics.fact_portfolio_attribution: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.fact_portfolio_attribution"} */

  create view "bain_analytics"."public"."fact_portfolio_attribution__dbt_tmp"
    
    
  as (
    -- Pipeline C: FACT table - Portfolio attribution with benchmark comparison
-- Anti-pattern: re-joins data that's already in intermediate models
-- Anti-pattern: repeated computation of sector weights

with attribution as (
    select
        pa.portfolio_id,
        pa.portfolio_name,
        pa.strategy,
        pa.fund_id,
        pa.position_date,
        pa.sector,
        pa.sector_mv,
        pa.sector_ugl,
        pa.num_instruments,
        pa.total_portfolio_mv,
        pa.total_portfolio_ugl,
        pa.sector_weight,
        pa.sector_contribution
    from "bain_analytics"."public"."int_portfolio_attribution" pa
),

-- Anti-pattern: re-joining benchmarks (could be done in intermediate)
attribution_with_benchmark as (
    select
        a.*,
        bm.benchmark_name,
        bm.return_mtd as benchmark_return,
        bm.rolling_3m_return as benchmark_3m_return,
        bm.rolling_12m_return as benchmark_12m_return
    from attribution a
    left join "bain_analytics"."public"."int_benchmark_returns" bm
        on a.position_date = bm.benchmark_date
        and bm.benchmark_id = 'BM_SP500'
),

-- Anti-pattern: computing alpha in yet another CTE
attribution_with_alpha as (
    select
        ab.*,
        -- Simplified active return
        case
            when ab.total_portfolio_mv != 0
            then (ab.sector_ugl / ab.total_portfolio_mv) - coalesce(ab.benchmark_return, 0) * ab.sector_weight
            else 0
        end as sector_active_return,
        -- Anti-pattern: re-computing portfolio-level return here
        case
            when ab.total_portfolio_mv != 0
            then ab.total_portfolio_ugl / ab.total_portfolio_mv
            else 0
        end as portfolio_return
    from attribution_with_benchmark ab
)

select * from attribution_with_alpha
  );
[0m19:30:16.220231 [debug] [Thread-3  ]: On model.bain_capital_analytics.fact_cashflow_waterfall: COMMIT
[0m19:30:16.220705 [debug] [Thread-2  ]: On model.bain_capital_analytics.report_lp_quarterly: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.report_lp_quarterly"} */

  create view "bain_analytics"."public"."report_lp_quarterly__dbt_tmp"
    
    
  as (
    -- Pipeline C: REPORT table - LP quarterly reporting
-- Anti-pattern: massive query, duplicated logic, no reuse of intermediates
-- Anti-pattern: PostgreSQL-specific date_trunc
-- Anti-pattern: re-aggregation of data already aggregated upstream

with quarterly_cashflows as (
    -- Anti-pattern: re-aggregating cashflows by quarter (already in int_cashflow_enriched)
    select
        cf.fund_id,
        cf.portfolio_id,
        -- Anti-pattern: PostgreSQL-specific date_trunc
        date_trunc('quarter', cf.cashflow_date) as quarter_start,
        cf.cashflow_fiscal_quarter as fiscal_quarter,
        cf.cashflow_year,
        sum(case when cf.cashflow_type = 'capital_call' then cf.amount else 0 end) as quarter_calls,
        sum(case when cf.cashflow_type = 'distribution' then cf.amount else 0 end) as quarter_distributions,
        sum(case when cf.cashflow_type = 'management_fee' then cf.amount else 0 end) as quarter_fees,
        sum(cf.amount) as quarter_net
    from "bain_analytics"."public"."stg_cashflows" cf
    group by
        cf.fund_id, cf.portfolio_id,
        date_trunc('quarter', cf.cashflow_date),
        cf.cashflow_fiscal_quarter, cf.cashflow_year
),

quarterly_valuations as (
    -- Anti-pattern: re-querying valuations with subquery for quarter-end
    select *
    from (
        select
            v.portfolio_id,
            v.valuation_date,
            v.net_asset_value,
            v.gross_asset_value,
            v.unrealized_pnl,
            v.realized_pnl,
            v.valuation_method,
            -- Anti-pattern: subquery dedup instead of QUALIFY
            row_number() over (
                partition by v.portfolio_id, date_trunc('quarter', v.valuation_date)
                order by v.valuation_date desc
            ) as rn
        from "bain_analytics"."public"."stg_valuations" v
    ) sub
    where rn = 1
),

-- Anti-pattern: re-joining fund structures (done in multiple places)
fund_details as (
    select
        fs.fund_id,
        fs.fund_name,
        fs.fund_type,
        fs.committed_capital,
        fs.management_fee_rate,
        fs.carry_rate,
        fs.hurdle_rate,
        fs.vintage_year,
        fs.gp_commitment_pct
    from "bain_analytics"."public"."stg_fund_structures" fs
),

-- Anti-pattern: joining everything at the end
lp_report as (
    select
        fd.fund_id,
        fd.fund_name,
        fd.fund_type,
        fd.vintage_year,
        fd.committed_capital,
        fd.management_fee_rate,
        fd.carry_rate,
        fd.hurdle_rate,
        fd.gp_commitment_pct,
        qc.portfolio_id,
        p.portfolio_name,
        p.strategy,
        qc.quarter_start,
        qc.fiscal_quarter,
        qc.cashflow_year,
        qc.quarter_calls,
        qc.quarter_distributions,
        qc.quarter_fees,
        qc.quarter_net,
        qv.net_asset_value as quarter_end_nav,
        qv.gross_asset_value as quarter_end_gav,
        qv.unrealized_pnl,
        qv.realized_pnl,
        qv.valuation_method,
        -- Anti-pattern: IRR re-joined from separate calculation
        irr.approx_irr,
        irr.tvpi,
        irr.dpi,
        irr.rvpi
    from quarterly_cashflows qc
    inner join fund_details fd
        on qc.fund_id = fd.fund_id
    inner join "bain_analytics"."public"."stg_portfolios" p
        on qc.portfolio_id = p.portfolio_id
    left join quarterly_valuations qv
        on qc.portfolio_id = qv.portfolio_id
        and date_trunc('quarter', qv.valuation_date) = qc.quarter_start
    left join "bain_analytics"."public"."int_irr_calculations" irr
        on qc.fund_id = irr.fund_id
        and qc.portfolio_id = irr.portfolio_id
)

select
    *,
    -- Anti-pattern: computed columns in final select
    case
        when committed_capital > 0
        then quarter_calls / committed_capital
        else 0
    end as quarterly_drawdown_rate,
    case
        when quarter_end_nav is not null and committed_capital > 0
        then quarter_end_nav / committed_capital
        else null
    end as nav_to_commitment_ratio
from lp_report
order by fund_id, portfolio_id, quarter_start
  );
[0m19:30:16.221857 [debug] [Thread-4  ]: On model.bain_capital_analytics.fact_fund_performance: COMMIT
[0m19:30:16.222211 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.fact_cashflow_waterfall"
[0m19:30:16.222565 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.fact_fund_performance"
[0m19:30:16.222882 [debug] [Thread-3  ]: On model.bain_capital_analytics.fact_cashflow_waterfall: COMMIT
[0m19:30:16.223178 [debug] [Thread-4  ]: On model.bain_capital_analytics.fact_fund_performance: COMMIT
[0m19:30:16.224114 [debug] [Thread-3  ]: SQL status: COMMIT in 0.001 seconds
[0m19:30:16.224428 [debug] [Thread-4  ]: SQL status: COMMIT in 0.001 seconds
[0m19:30:16.226714 [debug] [Thread-3  ]: Applying DROP to: "bain_analytics"."public"."fact_cashflow_waterfall__dbt_backup"
[0m19:30:16.227042 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.005 seconds
[0m19:30:16.229158 [debug] [Thread-4  ]: Applying DROP to: "bain_analytics"."public"."fact_fund_performance__dbt_backup"
[0m19:30:16.229466 [debug] [Thread-2  ]: SQL status: CREATE VIEW in 0.007 seconds
[0m19:30:16.229914 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.fact_cashflow_waterfall"
[0m19:30:16.276430 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.fact_portfolio_attribution"
[0m19:30:16.277064 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.fact_fund_performance"
[0m19:30:16.279892 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.report_lp_quarterly"
[0m19:30:16.280240 [debug] [Thread-3  ]: On model.bain_capital_analytics.fact_cashflow_waterfall: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.fact_cashflow_waterfall"} */
drop view if exists "bain_analytics"."public"."fact_cashflow_waterfall__dbt_backup" cascade
[0m19:30:16.280566 [debug] [Thread-1  ]: On model.bain_capital_analytics.fact_portfolio_attribution: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.fact_portfolio_attribution"} */
alter table "bain_analytics"."public"."fact_portfolio_attribution__dbt_tmp" rename to "fact_portfolio_attribution"
[0m19:30:16.280868 [debug] [Thread-4  ]: On model.bain_capital_analytics.fact_fund_performance: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.fact_fund_performance"} */
drop view if exists "bain_analytics"."public"."fact_fund_performance__dbt_backup" cascade
[0m19:30:16.281167 [debug] [Thread-2  ]: On model.bain_capital_analytics.report_lp_quarterly: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.report_lp_quarterly"} */
alter table "bain_analytics"."public"."report_lp_quarterly__dbt_tmp" rename to "report_lp_quarterly"
[0m19:30:16.282424 [debug] [Thread-4  ]: SQL status: DROP VIEW in 0.001 seconds
[0m19:30:16.282745 [debug] [Thread-3  ]: SQL status: DROP VIEW in 0.001 seconds
[0m19:30:16.283776 [debug] [Thread-4  ]: On model.bain_capital_analytics.fact_fund_performance: Close
[0m19:30:16.284069 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.003 seconds
[0m19:30:16.284378 [debug] [Thread-2  ]: SQL status: ALTER TABLE in 0.003 seconds
[0m19:30:16.285392 [debug] [Thread-3  ]: On model.bain_capital_analytics.fact_cashflow_waterfall: Close
[0m19:30:16.286530 [debug] [Thread-1  ]: On model.bain_capital_analytics.fact_portfolio_attribution: COMMIT
[0m19:30:16.286841 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '06decbc9-1bfd-415a-a35a-88ae35545da3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d235c40>]}
[0m19:30:16.287741 [debug] [Thread-2  ]: On model.bain_capital_analytics.report_lp_quarterly: COMMIT
[0m19:30:16.288089 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.fact_portfolio_attribution"
[0m19:30:16.288502 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '06decbc9-1bfd-415a-a35a-88ae35545da3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e6eb940>]}
[0m19:30:16.289030 [info ] [Thread-4  ]: 46 of 54 OK created sql view model public.fact_fund_performance ................ [[32mCREATE VIEW[0m in 0.13s]
[0m19:30:16.289345 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.report_lp_quarterly"
[0m19:30:16.289634 [debug] [Thread-1  ]: On model.bain_capital_analytics.fact_portfolio_attribution: COMMIT
[0m19:30:16.290079 [info ] [Thread-3  ]: 45 of 54 OK created sql view model public.fact_cashflow_waterfall .............. [[32mCREATE VIEW[0m in 0.13s]
[0m19:30:16.290538 [debug] [Thread-4  ]: Finished running node model.bain_capital_analytics.fact_fund_performance
[0m19:30:16.290875 [debug] [Thread-2  ]: On model.bain_capital_analytics.report_lp_quarterly: COMMIT
[0m19:30:16.291402 [debug] [Thread-3  ]: Finished running node model.bain_capital_analytics.fact_cashflow_waterfall
[0m19:30:16.292065 [debug] [Thread-4  ]: Began running node test.bain_capital_analytics.not_null_fact_fund_performance_fund_id.738d6489c4
[0m19:30:16.292390 [debug] [Thread-3  ]: Began running node test.bain_capital_analytics.not_null_fact_cashflow_waterfall_cashflow_id.7aafd60486
[0m19:30:16.292676 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m19:30:16.292968 [info ] [Thread-4  ]: 49 of 54 START test not_null_fact_fund_performance_fund_id ..................... [RUN]
[0m19:30:16.293288 [debug] [Thread-2  ]: SQL status: COMMIT in 0.002 seconds
[0m19:30:16.293594 [info ] [Thread-3  ]: 50 of 54 START test not_null_fact_cashflow_waterfall_cashflow_id ............... [RUN]
[0m19:30:16.295909 [debug] [Thread-1  ]: Applying DROP to: "bain_analytics"."public"."fact_portfolio_attribution__dbt_backup"
[0m19:30:16.296260 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly model.bain_capital_analytics.fact_fund_performance, now test.bain_capital_analytics.not_null_fact_fund_performance_fund_id.738d6489c4)
[0m19:30:16.298339 [debug] [Thread-2  ]: Applying DROP to: "bain_analytics"."public"."report_lp_quarterly__dbt_backup"
[0m19:30:16.298786 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly model.bain_capital_analytics.fact_cashflow_waterfall, now test.bain_capital_analytics.not_null_fact_cashflow_waterfall_cashflow_id.7aafd60486)
[0m19:30:16.299255 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.fact_portfolio_attribution"
[0m19:30:16.299561 [debug] [Thread-4  ]: Began compiling node test.bain_capital_analytics.not_null_fact_fund_performance_fund_id.738d6489c4
[0m19:30:16.300002 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.report_lp_quarterly"
[0m19:30:16.300307 [debug] [Thread-3  ]: Began compiling node test.bain_capital_analytics.not_null_fact_cashflow_waterfall_cashflow_id.7aafd60486
[0m19:30:16.300612 [debug] [Thread-1  ]: On model.bain_capital_analytics.fact_portfolio_attribution: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.fact_portfolio_attribution"} */
drop view if exists "bain_analytics"."public"."fact_portfolio_attribution__dbt_backup" cascade
[0m19:30:16.304246 [debug] [Thread-4  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_fact_fund_performance_fund_id.738d6489c4"
[0m19:30:16.304577 [debug] [Thread-2  ]: On model.bain_capital_analytics.report_lp_quarterly: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.report_lp_quarterly"} */
drop view if exists "bain_analytics"."public"."report_lp_quarterly__dbt_backup" cascade
[0m19:30:16.308694 [debug] [Thread-3  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_fact_cashflow_waterfall_cashflow_id.7aafd60486"
[0m19:30:16.309365 [debug] [Thread-4  ]: Began executing node test.bain_capital_analytics.not_null_fact_fund_performance_fund_id.738d6489c4
[0m19:30:16.309678 [debug] [Thread-3  ]: Began executing node test.bain_capital_analytics.not_null_fact_cashflow_waterfall_cashflow_id.7aafd60486
[0m19:30:16.311888 [debug] [Thread-4  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_fact_fund_performance_fund_id.738d6489c4"
[0m19:30:16.312181 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.003 seconds
[0m19:30:16.312490 [debug] [Thread-2  ]: SQL status: DROP VIEW in 0.003 seconds
[0m19:30:16.314603 [debug] [Thread-3  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_fact_cashflow_waterfall_cashflow_id.7aafd60486"
[0m19:30:16.315903 [debug] [Thread-1  ]: On model.bain_capital_analytics.fact_portfolio_attribution: Close
[0m19:30:16.316881 [debug] [Thread-2  ]: On model.bain_capital_analytics.report_lp_quarterly: Close
[0m19:30:16.317319 [debug] [Thread-4  ]: Using postgres connection "test.bain_capital_analytics.not_null_fact_fund_performance_fund_id.738d6489c4"
[0m19:30:16.317829 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '06decbc9-1bfd-415a-a35a-88ae35545da3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e753070>]}
[0m19:30:16.318329 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_fact_fund_performance_fund_id.738d6489c4: BEGIN
[0m19:30:16.318610 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '06decbc9-1bfd-415a-a35a-88ae35545da3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e6dfbb0>]}
[0m19:30:16.319069 [debug] [Thread-3  ]: Using postgres connection "test.bain_capital_analytics.not_null_fact_cashflow_waterfall_cashflow_id.7aafd60486"
[0m19:30:16.319499 [info ] [Thread-1  ]: 48 of 54 OK created sql view model public.fact_portfolio_attribution ........... [[32mCREATE VIEW[0m in 0.13s]
[0m19:30:16.319815 [debug] [Thread-4  ]: Opening a new connection, currently in state closed
[0m19:30:16.320334 [info ] [Thread-2  ]: 47 of 54 OK created sql view model public.report_lp_quarterly .................. [[32mCREATE VIEW[0m in 0.13s]
[0m19:30:16.320652 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_fact_cashflow_waterfall_cashflow_id.7aafd60486: BEGIN
[0m19:30:16.321070 [debug] [Thread-1  ]: Finished running node model.bain_capital_analytics.fact_portfolio_attribution
[0m19:30:16.321640 [debug] [Thread-2  ]: Finished running node model.bain_capital_analytics.report_lp_quarterly
[0m19:30:16.321970 [debug] [Thread-3  ]: Opening a new connection, currently in state closed
[0m19:30:16.322532 [debug] [Thread-1  ]: Began running node test.bain_capital_analytics.not_null_fact_portfolio_attribution_portfolio_id.f676c7df62
[0m19:30:16.323034 [info ] [Thread-1  ]: 51 of 54 START test not_null_fact_portfolio_attribution_portfolio_id ........... [RUN]
[0m19:30:16.323391 [debug] [Thread-2  ]: Began running node test.bain_capital_analytics.not_null_report_lp_quarterly_fund_id.aa355f6583
[0m19:30:16.323751 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.bain_capital_analytics.fact_portfolio_attribution, now test.bain_capital_analytics.not_null_fact_portfolio_attribution_portfolio_id.f676c7df62)
[0m19:30:16.324115 [info ] [Thread-2  ]: 52 of 54 START test not_null_report_lp_quarterly_fund_id ....................... [RUN]
[0m19:30:16.324456 [debug] [Thread-1  ]: Began compiling node test.bain_capital_analytics.not_null_fact_portfolio_attribution_portfolio_id.f676c7df62
[0m19:30:16.324787 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly model.bain_capital_analytics.report_lp_quarterly, now test.bain_capital_analytics.not_null_report_lp_quarterly_fund_id.aa355f6583)
[0m19:30:16.328591 [debug] [Thread-1  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_fact_portfolio_attribution_portfolio_id.f676c7df62"
[0m19:30:16.328918 [debug] [Thread-2  ]: Began compiling node test.bain_capital_analytics.not_null_report_lp_quarterly_fund_id.aa355f6583
[0m19:30:16.332412 [debug] [Thread-2  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_report_lp_quarterly_fund_id.aa355f6583"
[0m19:30:16.332962 [debug] [Thread-1  ]: Began executing node test.bain_capital_analytics.not_null_fact_portfolio_attribution_portfolio_id.f676c7df62
[0m19:30:16.335363 [debug] [Thread-1  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_fact_portfolio_attribution_portfolio_id.f676c7df62"
[0m19:30:16.335702 [debug] [Thread-4  ]: SQL status: BEGIN in 0.016 seconds
[0m19:30:16.335987 [debug] [Thread-3  ]: SQL status: BEGIN in 0.014 seconds
[0m19:30:16.336366 [debug] [Thread-4  ]: Using postgres connection "test.bain_capital_analytics.not_null_fact_fund_performance_fund_id.738d6489c4"
[0m19:30:16.336697 [debug] [Thread-2  ]: Began executing node test.bain_capital_analytics.not_null_report_lp_quarterly_fund_id.aa355f6583
[0m19:30:16.337026 [debug] [Thread-3  ]: Using postgres connection "test.bain_capital_analytics.not_null_fact_cashflow_waterfall_cashflow_id.7aafd60486"
[0m19:30:16.337367 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_fact_fund_performance_fund_id.738d6489c4: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_fact_fund_performance_fund_id.738d6489c4"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select fund_id
from "bain_analytics"."public"."fact_fund_performance"
where fund_id is null



  
  
      
    ) dbt_internal_test
[0m19:30:16.337701 [debug] [Thread-1  ]: Using postgres connection "test.bain_capital_analytics.not_null_fact_portfolio_attribution_portfolio_id.f676c7df62"
[0m19:30:16.340760 [debug] [Thread-2  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_report_lp_quarterly_fund_id.aa355f6583"
[0m19:30:16.341093 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_fact_cashflow_waterfall_cashflow_id.7aafd60486: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_fact_cashflow_waterfall_cashflow_id.7aafd60486"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select cashflow_id
from "bain_analytics"."public"."fact_cashflow_waterfall"
where cashflow_id is null



  
  
      
    ) dbt_internal_test
[0m19:30:16.341466 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_fact_portfolio_attribution_portfolio_id.f676c7df62: BEGIN
[0m19:30:16.341870 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m19:30:16.342337 [debug] [Thread-2  ]: Using postgres connection "test.bain_capital_analytics.not_null_report_lp_quarterly_fund_id.aa355f6583"
[0m19:30:16.342643 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_report_lp_quarterly_fund_id.aa355f6583: BEGIN
[0m19:30:16.342927 [debug] [Thread-2  ]: Opening a new connection, currently in state closed
[0m19:30:16.349709 [debug] [Thread-4  ]: SQL status: SELECT 1 in 0.008 seconds
[0m19:30:16.350941 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_fact_fund_performance_fund_id.738d6489c4: ROLLBACK
[0m19:30:16.351270 [debug] [Thread-3  ]: SQL status: SELECT 1 in 0.009 seconds
[0m19:30:16.352390 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_fact_cashflow_waterfall_cashflow_id.7aafd60486: ROLLBACK
[0m19:30:16.352728 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_fact_fund_performance_fund_id.738d6489c4: Close
[0m19:30:16.353339 [info ] [Thread-4  ]: 49 of 54 PASS not_null_fact_fund_performance_fund_id ........................... [[32mPASS[0m in 0.06s]
[0m19:30:16.353713 [debug] [Thread-2  ]: SQL status: BEGIN in 0.011 seconds
[0m19:30:16.354163 [debug] [Thread-4  ]: Finished running node test.bain_capital_analytics.not_null_fact_fund_performance_fund_id.738d6489c4
[0m19:30:16.354551 [debug] [Thread-1  ]: SQL status: BEGIN in 0.013 seconds
[0m19:30:16.354884 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_fact_cashflow_waterfall_cashflow_id.7aafd60486: Close
[0m19:30:16.355187 [debug] [Thread-2  ]: Using postgres connection "test.bain_capital_analytics.not_null_report_lp_quarterly_fund_id.aa355f6583"
[0m19:30:16.355612 [debug] [Thread-1  ]: Using postgres connection "test.bain_capital_analytics.not_null_fact_portfolio_attribution_portfolio_id.f676c7df62"
[0m19:30:16.355999 [debug] [Thread-4  ]: Began running node model.bain_capital_analytics.report_ic_dashboard
[0m19:30:16.356444 [info ] [Thread-3  ]: 50 of 54 PASS not_null_fact_cashflow_waterfall_cashflow_id ..................... [[32mPASS[0m in 0.06s]
[0m19:30:16.356782 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_report_lp_quarterly_fund_id.aa355f6583: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_report_lp_quarterly_fund_id.aa355f6583"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select fund_id
from "bain_analytics"."public"."report_lp_quarterly"
where fund_id is null



  
  
      
    ) dbt_internal_test
[0m19:30:16.357116 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_fact_portfolio_attribution_portfolio_id.f676c7df62: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_fact_portfolio_attribution_portfolio_id.f676c7df62"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select portfolio_id
from "bain_analytics"."public"."fact_portfolio_attribution"
where portfolio_id is null



  
  
      
    ) dbt_internal_test
[0m19:30:16.357557 [info ] [Thread-4  ]: 53 of 54 START sql view model public.report_ic_dashboard ....................... [RUN]
[0m19:30:16.358007 [debug] [Thread-3  ]: Finished running node test.bain_capital_analytics.not_null_fact_cashflow_waterfall_cashflow_id.7aafd60486
[0m19:30:16.358439 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.not_null_fact_fund_performance_fund_id.738d6489c4, now model.bain_capital_analytics.report_ic_dashboard)
[0m19:30:16.358823 [debug] [Thread-4  ]: Began compiling node model.bain_capital_analytics.report_ic_dashboard
[0m19:30:16.362553 [debug] [Thread-4  ]: Writing injected SQL for node "model.bain_capital_analytics.report_ic_dashboard"
[0m19:30:16.363143 [debug] [Thread-4  ]: Began executing node model.bain_capital_analytics.report_ic_dashboard
[0m19:30:16.366800 [debug] [Thread-4  ]: Writing runtime sql for node "model.bain_capital_analytics.report_ic_dashboard"
[0m19:30:16.367179 [debug] [Thread-1  ]: SQL status: SELECT 1 in 0.009 seconds
[0m19:30:16.367600 [debug] [Thread-2  ]: SQL status: SELECT 1 in 0.009 seconds
[0m19:30:16.368872 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_fact_portfolio_attribution_portfolio_id.f676c7df62: ROLLBACK
[0m19:30:16.369913 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_report_lp_quarterly_fund_id.aa355f6583: ROLLBACK
[0m19:30:16.370380 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.report_ic_dashboard"
[0m19:30:16.370694 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_report_lp_quarterly_fund_id.aa355f6583: Close
[0m19:30:16.370985 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_fact_portfolio_attribution_portfolio_id.f676c7df62: Close
[0m19:30:16.371270 [debug] [Thread-4  ]: On model.bain_capital_analytics.report_ic_dashboard: BEGIN
[0m19:30:16.371742 [info ] [Thread-2  ]: 52 of 54 PASS not_null_report_lp_quarterly_fund_id ............................. [[32mPASS[0m in 0.05s]
[0m19:30:16.372249 [info ] [Thread-1  ]: 51 of 54 PASS not_null_fact_portfolio_attribution_portfolio_id ................. [[32mPASS[0m in 0.05s]
[0m19:30:16.372579 [debug] [Thread-4  ]: Opening a new connection, currently in state closed
[0m19:30:16.373022 [debug] [Thread-2  ]: Finished running node test.bain_capital_analytics.not_null_report_lp_quarterly_fund_id.aa355f6583
[0m19:30:16.373507 [debug] [Thread-1  ]: Finished running node test.bain_capital_analytics.not_null_fact_portfolio_attribution_portfolio_id.f676c7df62
[0m19:30:16.382950 [debug] [Thread-4  ]: SQL status: BEGIN in 0.010 seconds
[0m19:30:16.383274 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.report_ic_dashboard"
[0m19:30:16.383680 [debug] [Thread-4  ]: On model.bain_capital_analytics.report_ic_dashboard: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.report_ic_dashboard"} */

  create view "bain_analytics"."public"."report_ic_dashboard__dbt_tmp"
    
    
  as (
    -- Pipeline C: REPORT table - Investment Committee dashboard
-- Anti-pattern: massive query joining many sources, no intermediate reuse
-- Anti-pattern: subquery for latest records instead of QUALIFY
-- Anti-pattern: duplicated logic from other reports

with latest_fund_performance as (
    select *
    from (
        select
            fp.*,
            -- Anti-pattern: subquery dedup instead of QUALIFY
            row_number() over (
                partition by fp.fund_id
                order by fp.valuation_date desc
            ) as rn
        from "bain_analytics"."public"."fact_fund_performance" fp
    ) sub
    where rn = 1
),

latest_portfolio_summary as (
    select *
    from (
        select
            ps.*,
            row_number() over (
                partition by ps.portfolio_id
                order by ps.position_date desc
            ) as rn
        from "bain_analytics"."public"."fact_portfolio_summary" ps
    ) sub
    where rn = 1
),

-- Anti-pattern: re-joining fund structures (already in fact_fund_performance)
fund_overview as (
    select
        lfp.fund_id,
        lfp.fund_name,
        lfp.fund_type,
        lfp.committed_capital,
        lfp.valuation_date as latest_valuation_date,
        lfp.fund_nav,
        lfp.fund_gav,
        lfp.fund_nav_return as latest_nav_return,
        lfp.tvpi_gross,
        lfp.fund_approx_irr,
        lfp.fund_tvpi,
        lfp.fund_dpi,
        lfp.num_portfolios,
        lfp.fund_total_invested,
        lfp.fund_total_distributed,
        -- Anti-pattern: re-joining fund structures
        fs.management_fee_rate,
        fs.carry_rate,
        fs.hurdle_rate,
        fs.vintage_year
    from latest_fund_performance lfp
    inner join "bain_analytics"."public"."stg_fund_structures" fs
        on lfp.fund_id = fs.fund_id
),

portfolio_details as (
    select
        lps.portfolio_id,
        lps.portfolio_name,
        lps.strategy,
        lps.fund_id,
        lps.total_market_value,
        lps.total_unrealized_pnl,
        lps.portfolio_return_pct,
        lps.num_positions,
        -- Anti-pattern: re-computing fiscal quarter
        case
            when extract(month from lps.position_date) between 1 and 3 then 'Q3'
            when extract(month from lps.position_date) between 4 and 6 then 'Q4'
            when extract(month from lps.position_date) between 7 and 9 then 'Q1'
            when extract(month from lps.position_date) between 10 and 12 then 'Q2'
        end as reporting_fiscal_quarter
    from latest_portfolio_summary lps
)

select
    fo.fund_id,
    fo.fund_name,
    fo.fund_type,
    fo.vintage_year,
    fo.committed_capital,
    fo.latest_valuation_date,
    fo.fund_nav,
    fo.fund_gav,
    fo.latest_nav_return,
    fo.tvpi_gross,
    fo.fund_approx_irr,
    fo.fund_tvpi,
    fo.fund_dpi,
    fo.num_portfolios,
    fo.fund_total_invested,
    fo.fund_total_distributed,
    fo.management_fee_rate,
    fo.carry_rate,
    fo.hurdle_rate,
    pd.portfolio_id,
    pd.portfolio_name,
    pd.strategy,
    pd.total_market_value as portfolio_mv,
    pd.total_unrealized_pnl as portfolio_unrealized_pnl,
    pd.portfolio_return_pct,
    pd.num_positions as portfolio_num_positions,
    pd.reporting_fiscal_quarter
from fund_overview fo
inner join portfolio_details pd
    on fo.fund_id = pd.fund_id
order by fo.fund_nav desc, pd.total_market_value desc
  );
[0m19:30:16.386734 [debug] [Thread-4  ]: Postgres adapter: Postgres error: relation "public.fact_portfolio_summary" does not exist
LINE 36:         from "bain_analytics"."public"."fact_portfolio_summa...
                      ^

[0m19:30:16.387091 [debug] [Thread-4  ]: On model.bain_capital_analytics.report_ic_dashboard: ROLLBACK
[0m19:30:16.387736 [debug] [Thread-4  ]: On model.bain_capital_analytics.report_ic_dashboard: Close
[0m19:30:16.409978 [debug] [Thread-4  ]: Database Error in model report_ic_dashboard (models/marts/report_ic_dashboard.sql)
  relation "public.fact_portfolio_summary" does not exist
  LINE 36:         from "bain_analytics"."public"."fact_portfolio_summa...
                        ^
  compiled code at target/run/bain_capital_analytics/models/marts/report_ic_dashboard.sql
[0m19:30:16.410480 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '06decbc9-1bfd-415a-a35a-88ae35545da3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a13ae50>]}
[0m19:30:16.411061 [error] [Thread-4  ]: 53 of 54 ERROR creating sql view model public.report_ic_dashboard .............. [[31mERROR[0m in 0.05s]
[0m19:30:16.411532 [debug] [Thread-4  ]: Finished running node model.bain_capital_analytics.report_ic_dashboard
[0m19:30:16.412001 [debug] [Thread-7  ]: Marking all children of 'model.bain_capital_analytics.report_ic_dashboard' to be skipped because of status 'error'.  Reason: Database Error in model report_ic_dashboard (models/marts/report_ic_dashboard.sql)
  relation "public.fact_portfolio_summary" does not exist
  LINE 36:         from "bain_analytics"."public"."fact_portfolio_summa...
                        ^
  compiled code at target/run/bain_capital_analytics/models/marts/report_ic_dashboard.sql.
[0m19:30:16.412626 [debug] [Thread-3  ]: Began running node test.bain_capital_analytics.not_null_report_ic_dashboard_fund_id.e430aafd84
[0m19:30:16.413031 [info ] [Thread-3  ]: 54 of 54 SKIP test not_null_report_ic_dashboard_fund_id ........................ [[33mSKIP[0m]
[0m19:30:16.413380 [debug] [Thread-3  ]: Finished running node test.bain_capital_analytics.not_null_report_ic_dashboard_fund_id.e430aafd84
[0m19:30:16.413668 [debug] [Thread-7  ]: Marking all children of 'test.bain_capital_analytics.not_null_report_ic_dashboard_fund_id.e430aafd84' to be skipped because of status 'skipped'. 
[0m19:30:16.414600 [debug] [MainThread]: Using postgres connection "master"
[0m19:30:16.414870 [debug] [MainThread]: On master: BEGIN
[0m19:30:16.415106 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m19:30:16.425978 [debug] [MainThread]: SQL status: BEGIN in 0.011 seconds
[0m19:30:16.426256 [debug] [MainThread]: On master: COMMIT
[0m19:30:16.426505 [debug] [MainThread]: Using postgres connection "master"
[0m19:30:16.426742 [debug] [MainThread]: On master: COMMIT
[0m19:30:16.427264 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m19:30:16.427516 [debug] [MainThread]: On master: Close
[0m19:30:16.427835 [debug] [MainThread]: Connection 'master' was properly closed.
[0m19:30:16.428066 [debug] [MainThread]: Connection 'test.bain_capital_analytics.not_null_fact_portfolio_attribution_portfolio_id.f676c7df62' was properly closed.
[0m19:30:16.428287 [debug] [MainThread]: Connection 'test.bain_capital_analytics.not_null_report_lp_quarterly_fund_id.aa355f6583' was properly closed.
[0m19:30:16.428504 [debug] [MainThread]: Connection 'test.bain_capital_analytics.not_null_fact_cashflow_waterfall_cashflow_id.7aafd60486' was properly closed.
[0m19:30:16.428718 [debug] [MainThread]: Connection 'model.bain_capital_analytics.report_ic_dashboard' was properly closed.
[0m19:30:16.429073 [info ] [MainThread]: 
[0m19:30:16.429344 [info ] [MainThread]: Finished running 35 data tests, 19 view models in 0 hours 0 minutes and 1.46 seconds (1.46s).
[0m19:30:16.435101 [debug] [MainThread]: Command end result
[0m19:30:16.477673 [debug] [MainThread]: Wrote artifact WritableManifest to ./target/manifest.json
[0m19:30:16.479305 [debug] [MainThread]: Wrote artifact SemanticManifest to ./target/semantic_manifest.json
[0m19:30:16.487677 [debug] [MainThread]: Wrote artifact RunExecutionResult to ./target/run_results.json
[0m19:30:16.487999 [info ] [MainThread]: 
[0m19:30:16.488308 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m19:30:16.488575 [info ] [MainThread]: 
[0m19:30:16.488897 [error] [MainThread]: [31mFailure in model report_ic_dashboard (models/marts/report_ic_dashboard.sql)[0m
[0m19:30:16.489204 [error] [MainThread]:   Database Error in model report_ic_dashboard (models/marts/report_ic_dashboard.sql)
  relation "public.fact_portfolio_summary" does not exist
  LINE 36:         from "bain_analytics"."public"."fact_portfolio_summa...
                        ^
  compiled code at target/run/bain_capital_analytics/models/marts/report_ic_dashboard.sql
[0m19:30:16.489467 [info ] [MainThread]: 
[0m19:30:16.489757 [info ] [MainThread]:   compiled code at target/compiled/bain_capital_analytics/models/marts/report_ic_dashboard.sql
[0m19:30:16.490057 [info ] [MainThread]: 
[0m19:30:16.490328 [info ] [MainThread]: Done. PASS=52 WARN=0 ERROR=1 SKIP=1 NO-OP=0 TOTAL=54
[0m19:30:16.493559 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": false, "command_wall_clock_time": 2.5053904, "process_in_blocks": "0", "process_kernel_time": 0.45464, "process_mem_max_rss": "142082048", "process_out_blocks": "0", "process_user_time": 3.563456}
[0m19:30:16.493897 [debug] [MainThread]: Command `dbt build` failed at 19:30:16.493829 after 2.51 seconds
[0m19:30:16.494224 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ba741c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10bd18280>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e367610>]}
[0m19:30:16.494554 [debug] [MainThread]: Flushing usage events
[0m19:30:18.056196 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m19:30:29.520779 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108876160>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109922730>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109922550>]}


============================== 19:30:29.524799 | e99c23a0-888a-42fd-99a1-6f1a129790e4 ==============================
[0m19:30:29.524799 [info ] [MainThread]: Running with dbt=1.11.0-b3
[0m19:30:29.525329 [debug] [MainThread]: running dbt with arguments {'log_format': 'default', 'invocation_command': 'dbt build --select tag:pipeline_c --profiles-dir . --project-dir .', 'debug': 'False', 'use_colors': 'True', 'no_print': 'None', 'partial_parse': 'True', 'send_anonymous_usage_stats': 'True', 'static_parser': 'True', 'target_path': 'None', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'printer_width': '80', 'write_json': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'quiet': 'False', 'introspect': 'True', 'log_path': 'logs', 'profiles_dir': '.', 'empty': 'False', 'cache_selected_only': 'False', 'version_check': 'True', 'use_experimental_parser': 'False'}
[0m19:30:29.724953 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'e99c23a0-888a-42fd-99a1-6f1a129790e4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a03a190>]}
[0m19:30:29.799515 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'e99c23a0-888a-42fd-99a1-6f1a129790e4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109ed8c10>]}
[0m19:30:29.800424 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m19:30:29.905668 [debug] [MainThread]: checksum: e63134dccc1251cfb572caf0e4aa952f030c125ee3634f3bf2c0a2e1bb6ae349, vars: {}, profile: , target: , version: 1.11.0b3
[0m19:30:30.143760 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m19:30:30.144245 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m19:30:30.208971 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'e99c23a0-888a-42fd-99a1-6f1a129790e4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10aa80130>]}
[0m19:30:30.334906 [debug] [MainThread]: Wrote artifact WritableManifest to ./target/manifest.json
[0m19:30:30.337167 [debug] [MainThread]: Wrote artifact SemanticManifest to ./target/semantic_manifest.json
[0m19:30:30.371810 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'e99c23a0-888a-42fd-99a1-6f1a129790e4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10aa63520>]}
[0m19:30:30.372366 [info ] [MainThread]: Found 28 models, 53 data tests, 10 seeds, 569 macros
[0m19:30:30.376148 [info ] [MainThread]: 
[0m19:30:30.376463 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m19:30:30.376719 [info ] [MainThread]: 
[0m19:30:30.377137 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m19:30:30.381931 [debug] [ThreadPool]: Acquiring new postgres connection 'list_bain_analytics'
[0m19:30:30.437687 [debug] [ThreadPool]: Using postgres connection "list_bain_analytics"
[0m19:30:30.438134 [debug] [ThreadPool]: On list_bain_analytics: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "connection_name": "list_bain_analytics"} */

    select distinct nspname from pg_namespace
  
[0m19:30:30.438415 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m19:30:30.477602 [debug] [ThreadPool]: SQL status: SELECT 5 in 0.039 seconds
[0m19:30:30.479115 [debug] [ThreadPool]: On list_bain_analytics: Close
[0m19:30:30.482816 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_bain_analytics, now list_bain_analytics_public_raw)
[0m19:30:30.489027 [debug] [ThreadPool]: Using postgres connection "list_bain_analytics_public_raw"
[0m19:30:30.489479 [debug] [ThreadPool]: Acquiring new postgres connection 'list_bain_analytics_public'
[0m19:30:30.489773 [debug] [ThreadPool]: On list_bain_analytics_public_raw: BEGIN
[0m19:30:30.492344 [debug] [ThreadPool]: Using postgres connection "list_bain_analytics_public"
[0m19:30:30.492630 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:30:30.492901 [debug] [ThreadPool]: On list_bain_analytics_public: BEGIN
[0m19:30:30.493311 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m19:30:30.505788 [debug] [ThreadPool]: SQL status: BEGIN in 0.012 seconds
[0m19:30:30.506096 [debug] [ThreadPool]: SQL status: BEGIN in 0.013 seconds
[0m19:30:30.506375 [debug] [ThreadPool]: Using postgres connection "list_bain_analytics_public"
[0m19:30:30.506637 [debug] [ThreadPool]: Using postgres connection "list_bain_analytics_public_raw"
[0m19:30:30.506912 [debug] [ThreadPool]: On list_bain_analytics_public: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "connection_name": "list_bain_analytics_public"} */
select
      'bain_analytics' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'bain_analytics' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'bain_analytics' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m19:30:30.507201 [debug] [ThreadPool]: On list_bain_analytics_public_raw: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "connection_name": "list_bain_analytics_public_raw"} */
select
      'bain_analytics' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_raw'
    union all
    select
      'bain_analytics' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_raw'
    union all
    select
      'bain_analytics' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_raw'
  
[0m19:30:30.513114 [debug] [ThreadPool]: SQL status: SELECT 20 in 0.006 seconds
[0m19:30:30.513377 [debug] [ThreadPool]: SQL status: SELECT 10 in 0.006 seconds
[0m19:30:30.514713 [debug] [ThreadPool]: On list_bain_analytics_public: ROLLBACK
[0m19:30:30.516009 [debug] [ThreadPool]: On list_bain_analytics_public_raw: ROLLBACK
[0m19:30:30.516874 [debug] [ThreadPool]: On list_bain_analytics_public_raw: Close
[0m19:30:30.517135 [debug] [ThreadPool]: On list_bain_analytics_public: Close
[0m19:30:30.526626 [debug] [MainThread]: Using postgres connection "master"
[0m19:30:30.526900 [debug] [MainThread]: On master: BEGIN
[0m19:30:30.527138 [debug] [MainThread]: Opening a new connection, currently in state init
[0m19:30:30.537705 [debug] [MainThread]: SQL status: BEGIN in 0.011 seconds
[0m19:30:30.537993 [debug] [MainThread]: Using postgres connection "master"
[0m19:30:30.538306 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "connection_name": "master"} */
select distinct
        dependent_namespace.nspname as dependent_schema,
        dependent_class.relname as dependent_name,
        referenced_namespace.nspname as referenced_schema,
        referenced_class.relname as referenced_name

    -- Query for views: views are entries in pg_class with an entry in pg_rewrite, but we avoid
    -- a seq scan on pg_rewrite by leveraging the fact there is an "internal" row in pg_depend for
    -- the view...
    from pg_class as dependent_class
    join pg_namespace as dependent_namespace on dependent_namespace.oid = dependent_class.relnamespace
    join pg_depend as dependent_depend on dependent_depend.refobjid = dependent_class.oid
        and dependent_depend.classid = 'pg_rewrite'::regclass
        and dependent_depend.refclassid = 'pg_class'::regclass
        and dependent_depend.deptype = 'i'

    -- ... and via pg_depend (that has a row per column, hence the need for "distinct" above, and
    -- making sure to exclude the internal row to avoid a view appearing to depend on itself)...
    join pg_depend as joining_depend on joining_depend.objid = dependent_depend.objid
        and joining_depend.classid = 'pg_rewrite'::regclass
        and joining_depend.refclassid = 'pg_class'::regclass
        and joining_depend.refobjid != dependent_depend.refobjid

    -- ... we can find the tables they query from in pg_class, but excluding system tables. Note we
    -- don't need need to exclude _dependent_ system tables, because they only query from other
    -- system tables, and so are automatically excluded by excluding _referenced_ system tables
    join pg_class as referenced_class on referenced_class.oid = joining_depend.refobjid
    join pg_namespace as referenced_namespace on referenced_namespace.oid = referenced_class.relnamespace
        and referenced_namespace.nspname != 'information_schema'
        and referenced_namespace.nspname not like 'pg\_%'

    order by
        dependent_schema, dependent_name, referenced_schema, referenced_name;
[0m19:30:30.545391 [debug] [MainThread]: SQL status: SELECT 38 in 0.007 seconds
[0m19:30:30.551718 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e99c23a0-888a-42fd-99a1-6f1a129790e4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ac071f0>]}
[0m19:30:30.552159 [debug] [MainThread]: On master: ROLLBACK
[0m19:30:30.552777 [debug] [MainThread]: Using postgres connection "master"
[0m19:30:30.553033 [debug] [MainThread]: On master: BEGIN
[0m19:30:30.553800 [debug] [MainThread]: SQL status: BEGIN in 0.001 seconds
[0m19:30:30.554059 [debug] [MainThread]: On master: COMMIT
[0m19:30:30.554310 [debug] [MainThread]: Using postgres connection "master"
[0m19:30:30.554552 [debug] [MainThread]: On master: COMMIT
[0m19:30:30.555081 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m19:30:30.555346 [debug] [MainThread]: On master: Close
[0m19:30:30.558403 [debug] [Thread-1  ]: Began running node model.bain_capital_analytics.stg_benchmarks
[0m19:30:30.558755 [debug] [Thread-2  ]: Began running node model.bain_capital_analytics.stg_cashflows
[0m19:30:30.559195 [info ] [Thread-1  ]: 1 of 54 START sql view model public.stg_benchmarks ............................. [RUN]
[0m19:30:30.559579 [debug] [Thread-3  ]: Began running node model.bain_capital_analytics.stg_dates
[0m19:30:30.560011 [info ] [Thread-2  ]: 2 of 54 START sql view model public.stg_cashflows .............................. [RUN]
[0m19:30:30.560375 [debug] [Thread-4  ]: Began running node model.bain_capital_analytics.stg_fund_structures
[0m19:30:30.560725 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_bain_analytics_public_raw, now model.bain_capital_analytics.stg_benchmarks)
[0m19:30:30.561119 [info ] [Thread-3  ]: 3 of 54 START sql view model public.stg_dates .................................. [RUN]
[0m19:30:30.561469 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly list_bain_analytics_public, now model.bain_capital_analytics.stg_cashflows)
[0m19:30:30.561850 [info ] [Thread-4  ]: 4 of 54 START sql view model public.stg_fund_structures ........................ [RUN]
[0m19:30:30.562175 [debug] [Thread-1  ]: Began compiling node model.bain_capital_analytics.stg_benchmarks
[0m19:30:30.562552 [debug] [Thread-3  ]: Acquiring new postgres connection 'model.bain_capital_analytics.stg_dates'
[0m19:30:30.562854 [debug] [Thread-2  ]: Began compiling node model.bain_capital_analytics.stg_cashflows
[0m19:30:30.563216 [debug] [Thread-4  ]: Acquiring new postgres connection 'model.bain_capital_analytics.stg_fund_structures'
[0m19:30:30.571014 [debug] [Thread-1  ]: Writing injected SQL for node "model.bain_capital_analytics.stg_benchmarks"
[0m19:30:30.571347 [debug] [Thread-3  ]: Began compiling node model.bain_capital_analytics.stg_dates
[0m19:30:30.573945 [debug] [Thread-2  ]: Writing injected SQL for node "model.bain_capital_analytics.stg_cashflows"
[0m19:30:30.574272 [debug] [Thread-4  ]: Began compiling node model.bain_capital_analytics.stg_fund_structures
[0m19:30:30.577915 [debug] [Thread-3  ]: Writing injected SQL for node "model.bain_capital_analytics.stg_dates"
[0m19:30:30.580430 [debug] [Thread-4  ]: Writing injected SQL for node "model.bain_capital_analytics.stg_fund_structures"
[0m19:30:30.580876 [debug] [Thread-1  ]: Began executing node model.bain_capital_analytics.stg_benchmarks
[0m19:30:30.581161 [debug] [Thread-2  ]: Began executing node model.bain_capital_analytics.stg_cashflows
[0m19:30:30.618082 [debug] [Thread-1  ]: Writing runtime sql for node "model.bain_capital_analytics.stg_benchmarks"
[0m19:30:30.620551 [debug] [Thread-2  ]: Writing runtime sql for node "model.bain_capital_analytics.stg_cashflows"
[0m19:30:30.620962 [debug] [Thread-3  ]: Began executing node model.bain_capital_analytics.stg_dates
[0m19:30:30.621371 [debug] [Thread-4  ]: Began executing node model.bain_capital_analytics.stg_fund_structures
[0m19:30:30.625660 [debug] [Thread-3  ]: Writing runtime sql for node "model.bain_capital_analytics.stg_dates"
[0m19:30:30.626079 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.stg_cashflows"
[0m19:30:30.629487 [debug] [Thread-4  ]: Writing runtime sql for node "model.bain_capital_analytics.stg_fund_structures"
[0m19:30:30.629842 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.stg_benchmarks"
[0m19:30:30.630230 [debug] [Thread-2  ]: On model.bain_capital_analytics.stg_cashflows: BEGIN
[0m19:30:30.630648 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_benchmarks: BEGIN
[0m19:30:30.631002 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.stg_dates"
[0m19:30:30.631315 [debug] [Thread-2  ]: Opening a new connection, currently in state closed
[0m19:30:30.631676 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m19:30:30.632027 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.stg_fund_structures"
[0m19:30:30.632398 [debug] [Thread-3  ]: On model.bain_capital_analytics.stg_dates: BEGIN
[0m19:30:30.632995 [debug] [Thread-4  ]: On model.bain_capital_analytics.stg_fund_structures: BEGIN
[0m19:30:30.633308 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m19:30:30.633606 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m19:30:30.648255 [debug] [Thread-1  ]: SQL status: BEGIN in 0.017 seconds
[0m19:30:30.648608 [debug] [Thread-2  ]: SQL status: BEGIN in 0.017 seconds
[0m19:30:30.648953 [debug] [Thread-3  ]: SQL status: BEGIN in 0.016 seconds
[0m19:30:30.649245 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.stg_benchmarks"
[0m19:30:30.649526 [debug] [Thread-4  ]: SQL status: BEGIN in 0.016 seconds
[0m19:30:30.649821 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.stg_cashflows"
[0m19:30:30.650120 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.stg_dates"
[0m19:30:30.650447 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_benchmarks: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_benchmarks"} */

  create view "bain_analytics"."public"."stg_benchmarks__dbt_tmp"
    
    
  as (
    select distinct
    benchmark_id,
    benchmark_name,
    cast(benchmark_date as date) as benchmark_date,
    cast(return_daily as numeric(18,8)) as return_daily,
    cast(return_mtd as numeric(18,8)) as return_mtd,
    cast(return_ytd as numeric(18,8)) as return_ytd,
    cast(benchmark_level as numeric(18,4)) as benchmark_level,
    -- Anti-pattern: duplicated fiscal quarter logic
    case
        when extract(month from cast(benchmark_date as date)) between 1 and 3 then 'Q3'
        when extract(month from cast(benchmark_date as date)) between 4 and 6 then 'Q4'
        when extract(month from cast(benchmark_date as date)) between 7 and 9 then 'Q1'
        when extract(month from cast(benchmark_date as date)) between 10 and 12 then 'Q2'
    end as benchmark_fiscal_quarter
from "bain_analytics"."public_raw"."raw_benchmarks"
  );
[0m19:30:30.650775 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.stg_fund_structures"
[0m19:30:30.651103 [debug] [Thread-2  ]: On model.bain_capital_analytics.stg_cashflows: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_cashflows"} */

  create view "bain_analytics"."public"."stg_cashflows__dbt_tmp"
    
    
  as (
    -- Anti-pattern: unnecessary DISTINCT
-- Anti-pattern: duplicated fiscal quarter logic
select distinct
    cashflow_id,
    fund_id,
    portfolio_id,
    cast(cashflow_date as date) as cashflow_date,
    cashflow_type,
    cast(amount as numeric(18,2)) as amount,
    currency,
    description,
    investor_id,
    -- Anti-pattern: duplicated fiscal quarter logic (same as stg_trades, stg_portfolios)
    case
        when extract(month from cast(cashflow_date as date)) between 1 and 3 then 'Q3'
        when extract(month from cast(cashflow_date as date)) between 4 and 6 then 'Q4'
        when extract(month from cast(cashflow_date as date)) between 7 and 9 then 'Q1'
        when extract(month from cast(cashflow_date as date)) between 10 and 12 then 'Q2'
    end as cashflow_fiscal_quarter,
    -- Anti-pattern: PostgreSQL-specific extract
    extract(year from cast(cashflow_date as date)) as cashflow_year
from "bain_analytics"."public_raw"."raw_cashflows"
  );
[0m19:30:30.651468 [debug] [Thread-3  ]: On model.bain_capital_analytics.stg_dates: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_dates"} */

  create view "bain_analytics"."public"."stg_dates__dbt_tmp"
    
    
  as (
    select
    cast(date_day as date) as date_day,
    cast(is_business_day as boolean) as is_business_day,
    cast(is_month_end as boolean) as is_month_end,
    cast(is_quarter_end as boolean) as is_quarter_end,
    cast(is_year_end as boolean) as is_year_end,
    fiscal_quarter,
    fiscal_year,
    -- Anti-pattern: PostgreSQL-specific date_trunc
    date_trunc('month', cast(date_day as date)) as month_start,
    date_trunc('quarter', cast(date_day as date)) as quarter_start,
    extract(month from cast(date_day as date)) as calendar_month,
    extract(year from cast(date_day as date)) as calendar_year
from "bain_analytics"."public_raw"."raw_dates"
  );
[0m19:30:30.651867 [debug] [Thread-4  ]: On model.bain_capital_analytics.stg_fund_structures: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_fund_structures"} */

  create view "bain_analytics"."public"."stg_fund_structures__dbt_tmp"
    
    
  as (
    select distinct
    fund_id,
    fund_name,
    fund_type,
    cast(vintage_year as integer) as vintage_year,
    cast(committed_capital as numeric(18,2)) as committed_capital,
    cast(management_fee_rate as numeric(8,4)) as management_fee_rate,
    cast(carry_rate as numeric(8,4)) as carry_rate,
    cast(hurdle_rate as numeric(8,4)) as hurdle_rate,
    cast(gp_commitment_pct as numeric(8,4)) as gp_commitment_pct,
    fund_currency,
    fund_status
from "bain_analytics"."public_raw"."raw_fund_structures"
  );
[0m19:30:30.655474 [debug] [Thread-3  ]: SQL status: CREATE VIEW in 0.003 seconds
[0m19:30:30.661685 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.stg_dates"
[0m19:30:30.662034 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.010 seconds
[0m19:30:30.662324 [debug] [Thread-2  ]: SQL status: CREATE VIEW in 0.010 seconds
[0m19:30:30.662679 [debug] [Thread-4  ]: SQL status: CREATE VIEW in 0.010 seconds
[0m19:30:30.662973 [debug] [Thread-3  ]: On model.bain_capital_analytics.stg_dates: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_dates"} */
alter table "bain_analytics"."public"."stg_dates" rename to "stg_dates__dbt_backup"
[0m19:30:30.666221 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.stg_benchmarks"
[0m19:30:30.669220 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.stg_cashflows"
[0m19:30:30.672088 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.stg_fund_structures"
[0m19:30:30.672461 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_benchmarks: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_benchmarks"} */
alter table "bain_analytics"."public"."stg_benchmarks" rename to "stg_benchmarks__dbt_backup"
[0m19:30:30.672771 [debug] [Thread-2  ]: On model.bain_capital_analytics.stg_cashflows: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_cashflows"} */
alter table "bain_analytics"."public"."stg_cashflows" rename to "stg_cashflows__dbt_backup"
[0m19:30:30.673077 [debug] [Thread-4  ]: On model.bain_capital_analytics.stg_fund_structures: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_fund_structures"} */
alter table "bain_analytics"."public"."stg_fund_structures" rename to "stg_fund_structures__dbt_backup"
[0m19:30:30.673860 [debug] [Thread-3  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m19:30:30.677096 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.stg_dates"
[0m19:30:30.677414 [debug] [Thread-4  ]: SQL status: ALTER TABLE in 0.004 seconds
[0m19:30:30.677694 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.004 seconds
[0m19:30:30.677953 [debug] [Thread-2  ]: SQL status: ALTER TABLE in 0.005 seconds
[0m19:30:30.678228 [debug] [Thread-3  ]: On model.bain_capital_analytics.stg_dates: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_dates"} */
alter table "bain_analytics"."public"."stg_dates__dbt_tmp" rename to "stg_dates"
[0m19:30:30.680824 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.stg_fund_structures"
[0m19:30:30.683491 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.stg_benchmarks"
[0m19:30:30.686148 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.stg_cashflows"
[0m19:30:30.686513 [debug] [Thread-4  ]: On model.bain_capital_analytics.stg_fund_structures: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_fund_structures"} */
alter table "bain_analytics"."public"."stg_fund_structures__dbt_tmp" rename to "stg_fund_structures"
[0m19:30:30.686830 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_benchmarks: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_benchmarks"} */
alter table "bain_analytics"."public"."stg_benchmarks__dbt_tmp" rename to "stg_benchmarks"
[0m19:30:30.687128 [debug] [Thread-2  ]: On model.bain_capital_analytics.stg_cashflows: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_cashflows"} */
alter table "bain_analytics"."public"."stg_cashflows__dbt_tmp" rename to "stg_cashflows"
[0m19:30:30.687697 [debug] [Thread-3  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m19:30:30.695037 [debug] [Thread-2  ]: SQL status: ALTER TABLE in 0.008 seconds
[0m19:30:30.700936 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.013 seconds
[0m19:30:30.701315 [debug] [Thread-4  ]: SQL status: ALTER TABLE in 0.014 seconds
[0m19:30:30.705588 [debug] [Thread-2  ]: On model.bain_capital_analytics.stg_cashflows: COMMIT
[0m19:30:30.706659 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_benchmarks: COMMIT
[0m19:30:30.709923 [debug] [Thread-3  ]: On model.bain_capital_analytics.stg_dates: COMMIT
[0m19:30:30.710944 [debug] [Thread-4  ]: On model.bain_capital_analytics.stg_fund_structures: COMMIT
[0m19:30:30.711273 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.stg_cashflows"
[0m19:30:30.711593 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.stg_benchmarks"
[0m19:30:30.711893 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.stg_dates"
[0m19:30:30.712190 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.stg_fund_structures"
[0m19:30:30.712484 [debug] [Thread-2  ]: On model.bain_capital_analytics.stg_cashflows: COMMIT
[0m19:30:30.712776 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_benchmarks: COMMIT
[0m19:30:30.713060 [debug] [Thread-3  ]: On model.bain_capital_analytics.stg_dates: COMMIT
[0m19:30:30.713343 [debug] [Thread-4  ]: On model.bain_capital_analytics.stg_fund_structures: COMMIT
[0m19:30:30.715836 [debug] [Thread-2  ]: SQL status: COMMIT in 0.002 seconds
[0m19:30:30.716180 [debug] [Thread-3  ]: SQL status: COMMIT in 0.002 seconds
[0m19:30:30.716464 [debug] [Thread-1  ]: SQL status: COMMIT in 0.003 seconds
[0m19:30:30.716740 [debug] [Thread-4  ]: SQL status: COMMIT in 0.003 seconds
[0m19:30:30.722397 [debug] [Thread-2  ]: Applying DROP to: "bain_analytics"."public"."stg_cashflows__dbt_backup"
[0m19:30:30.767763 [debug] [Thread-3  ]: Applying DROP to: "bain_analytics"."public"."stg_dates__dbt_backup"
[0m19:30:30.770273 [debug] [Thread-1  ]: Applying DROP to: "bain_analytics"."public"."stg_benchmarks__dbt_backup"
[0m19:30:30.772626 [debug] [Thread-4  ]: Applying DROP to: "bain_analytics"."public"."stg_fund_structures__dbt_backup"
[0m19:30:30.776477 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.stg_cashflows"
[0m19:30:30.776966 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.stg_dates"
[0m19:30:30.777432 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.stg_benchmarks"
[0m19:30:30.777948 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.stg_fund_structures"
[0m19:30:30.778265 [debug] [Thread-2  ]: On model.bain_capital_analytics.stg_cashflows: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_cashflows"} */
drop view if exists "bain_analytics"."public"."stg_cashflows__dbt_backup" cascade
[0m19:30:30.778579 [debug] [Thread-3  ]: On model.bain_capital_analytics.stg_dates: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_dates"} */
drop view if exists "bain_analytics"."public"."stg_dates__dbt_backup" cascade
[0m19:30:30.778888 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_benchmarks: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_benchmarks"} */
drop view if exists "bain_analytics"."public"."stg_benchmarks__dbt_backup" cascade
[0m19:30:30.779196 [debug] [Thread-4  ]: On model.bain_capital_analytics.stg_fund_structures: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_fund_structures"} */
drop view if exists "bain_analytics"."public"."stg_fund_structures__dbt_backup" cascade
[0m19:30:30.785695 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.006 seconds
[0m19:30:30.787897 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_benchmarks: Close
[0m19:30:30.788244 [debug] [Thread-3  ]: SQL status: DROP VIEW in 0.009 seconds
[0m19:30:30.788618 [debug] [Thread-4  ]: SQL status: DROP VIEW in 0.009 seconds
[0m19:30:30.790286 [debug] [Thread-3  ]: On model.bain_capital_analytics.stg_dates: Close
[0m19:30:30.791927 [debug] [Thread-4  ]: On model.bain_capital_analytics.stg_fund_structures: Close
[0m19:30:30.792244 [debug] [Thread-2  ]: SQL status: DROP VIEW in 0.013 seconds
[0m19:30:30.793738 [debug] [Thread-2  ]: On model.bain_capital_analytics.stg_cashflows: Close
[0m19:30:30.794402 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e99c23a0-888a-42fd-99a1-6f1a129790e4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b1de4c0>]}
[0m19:30:30.794694 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e99c23a0-888a-42fd-99a1-6f1a129790e4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b1f5c40>]}
[0m19:30:30.795029 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e99c23a0-888a-42fd-99a1-6f1a129790e4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b04a640>]}
[0m19:30:30.795312 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e99c23a0-888a-42fd-99a1-6f1a129790e4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b1b1fa0>]}
[0m19:30:30.795856 [info ] [Thread-3  ]: 3 of 54 OK created sql view model public.stg_dates ............................. [[32mCREATE VIEW[0m in 0.23s]
[0m19:30:30.796219 [info ] [Thread-1  ]: 1 of 54 OK created sql view model public.stg_benchmarks ........................ [[32mCREATE VIEW[0m in 0.23s]
[0m19:30:30.797634 [debug] [Thread-3  ]: Finished running node model.bain_capital_analytics.stg_dates
[0m19:30:30.796691 [info ] [Thread-4  ]: 4 of 54 OK created sql view model public.stg_fund_structures ................... [[32mCREATE VIEW[0m in 0.23s]
[0m19:30:30.797252 [info ] [Thread-2  ]: 2 of 54 OK created sql view model public.stg_cashflows ......................... [[32mCREATE VIEW[0m in 0.23s]
[0m19:30:30.798234 [debug] [Thread-1  ]: Finished running node model.bain_capital_analytics.stg_benchmarks
[0m19:30:30.798577 [debug] [Thread-3  ]: Began running node model.bain_capital_analytics.stg_instruments
[0m19:30:30.799080 [debug] [Thread-4  ]: Finished running node model.bain_capital_analytics.stg_fund_structures
[0m19:30:30.799707 [debug] [Thread-2  ]: Finished running node model.bain_capital_analytics.stg_cashflows
[0m19:30:30.800050 [debug] [Thread-1  ]: Began running node model.bain_capital_analytics.stg_portfolios
[0m19:30:30.800500 [info ] [Thread-3  ]: 5 of 54 START sql view model public.stg_instruments ............................ [RUN]
[0m19:30:30.800912 [debug] [Thread-4  ]: Began running node model.bain_capital_analytics.stg_positions
[0m19:30:30.801258 [debug] [Thread-2  ]: Began running node model.bain_capital_analytics.stg_valuations
[0m19:30:30.801797 [info ] [Thread-1  ]: 6 of 54 START sql view model public.stg_portfolios ............................. [RUN]
[0m19:30:30.802178 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly model.bain_capital_analytics.stg_dates, now model.bain_capital_analytics.stg_instruments)
[0m19:30:30.802557 [info ] [Thread-4  ]: 7 of 54 START sql view model public.stg_positions .............................. [RUN]
[0m19:30:30.802953 [info ] [Thread-2  ]: 8 of 54 START sql view model public.stg_valuations ............................. [RUN]
[0m19:30:30.803289 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.bain_capital_analytics.stg_benchmarks, now model.bain_capital_analytics.stg_portfolios)
[0m19:30:30.803602 [debug] [Thread-3  ]: Began compiling node model.bain_capital_analytics.stg_instruments
[0m19:30:30.803917 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly model.bain_capital_analytics.stg_fund_structures, now model.bain_capital_analytics.stg_positions)
[0m19:30:30.804235 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly model.bain_capital_analytics.stg_cashflows, now model.bain_capital_analytics.stg_valuations)
[0m19:30:30.804532 [debug] [Thread-1  ]: Began compiling node model.bain_capital_analytics.stg_portfolios
[0m19:30:30.807633 [debug] [Thread-3  ]: Writing injected SQL for node "model.bain_capital_analytics.stg_instruments"
[0m19:30:30.807949 [debug] [Thread-4  ]: Began compiling node model.bain_capital_analytics.stg_positions
[0m19:30:30.808235 [debug] [Thread-2  ]: Began compiling node model.bain_capital_analytics.stg_valuations
[0m19:30:30.810856 [debug] [Thread-1  ]: Writing injected SQL for node "model.bain_capital_analytics.stg_portfolios"
[0m19:30:30.814849 [debug] [Thread-4  ]: Writing injected SQL for node "model.bain_capital_analytics.stg_positions"
[0m19:30:30.817371 [debug] [Thread-2  ]: Writing injected SQL for node "model.bain_capital_analytics.stg_valuations"
[0m19:30:30.817878 [debug] [Thread-3  ]: Began executing node model.bain_capital_analytics.stg_instruments
[0m19:30:30.821463 [debug] [Thread-3  ]: Writing runtime sql for node "model.bain_capital_analytics.stg_instruments"
[0m19:30:30.821807 [debug] [Thread-1  ]: Began executing node model.bain_capital_analytics.stg_portfolios
[0m19:30:30.822099 [debug] [Thread-4  ]: Began executing node model.bain_capital_analytics.stg_positions
[0m19:30:30.825385 [debug] [Thread-1  ]: Writing runtime sql for node "model.bain_capital_analytics.stg_portfolios"
[0m19:30:30.825726 [debug] [Thread-2  ]: Began executing node model.bain_capital_analytics.stg_valuations
[0m19:30:30.828843 [debug] [Thread-4  ]: Writing runtime sql for node "model.bain_capital_analytics.stg_positions"
[0m19:30:30.829325 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.stg_instruments"
[0m19:30:30.833383 [debug] [Thread-2  ]: Writing runtime sql for node "model.bain_capital_analytics.stg_valuations"
[0m19:30:30.833847 [debug] [Thread-3  ]: On model.bain_capital_analytics.stg_instruments: BEGIN
[0m19:30:30.834208 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.stg_portfolios"
[0m19:30:30.834602 [debug] [Thread-3  ]: Opening a new connection, currently in state closed
[0m19:30:30.835007 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.stg_positions"
[0m19:30:30.835317 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_portfolios: BEGIN
[0m19:30:30.835815 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.stg_valuations"
[0m19:30:30.836113 [debug] [Thread-4  ]: On model.bain_capital_analytics.stg_positions: BEGIN
[0m19:30:30.836428 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m19:30:30.836755 [debug] [Thread-2  ]: On model.bain_capital_analytics.stg_valuations: BEGIN
[0m19:30:30.837061 [debug] [Thread-4  ]: Opening a new connection, currently in state closed
[0m19:30:30.837452 [debug] [Thread-2  ]: Opening a new connection, currently in state closed
[0m19:30:30.848836 [debug] [Thread-3  ]: SQL status: BEGIN in 0.014 seconds
[0m19:30:30.849205 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.stg_instruments"
[0m19:30:30.849605 [debug] [Thread-3  ]: On model.bain_capital_analytics.stg_instruments: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_instruments"} */

  create view "bain_analytics"."public"."stg_instruments__dbt_tmp"
    
    
  as (
    -- Anti-pattern: unnecessary DISTINCT
select distinct
    instrument_id,
    instrument_name,
    instrument_type,
    sector,
    currency,
    exchange,
    issuer,
    cast(maturity_date as date) as maturity_date,
    -- Anti-pattern: PostgreSQL-specific date subtraction
    case
        when maturity_date is not null
        then cast(maturity_date as date) - current_date
        else null
    end as days_to_maturity,
    case
        when instrument_type in ('equity', 'futures') then 'liquid'
        when instrument_type in ('corporate_bond', 'government_bond', 'sovereign_bond', 'leveraged_loan') then 'semi_liquid'
        when instrument_type in ('private_equity', 'venture_capital', 'real_estate', 'real_estate_debt', 'infrastructure') then 'illiquid'
        else 'other'
    end as liquidity_class
from "bain_analytics"."public_raw"."raw_instruments"
  );
[0m19:30:30.850194 [debug] [Thread-4  ]: SQL status: BEGIN in 0.013 seconds
[0m19:30:30.850529 [debug] [Thread-1  ]: SQL status: BEGIN in 0.014 seconds
[0m19:30:30.850820 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.stg_positions"
[0m19:30:30.851097 [debug] [Thread-2  ]: SQL status: BEGIN in 0.014 seconds
[0m19:30:30.851389 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.stg_portfolios"
[0m19:30:30.851723 [debug] [Thread-4  ]: On model.bain_capital_analytics.stg_positions: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_positions"} */

  create view "bain_analytics"."public"."stg_positions__dbt_tmp"
    
    
  as (
    -- Anti-pattern: unnecessary DISTINCT
-- Anti-pattern: no filtering or partitioning strategy

select distinct
    position_id,
    portfolio_id,
    instrument_id,
    cast(position_date as date) as position_date,
    cast(quantity as numeric(18,4)) as quantity,
    cast(market_value as numeric(18,2)) as market_value,
    cast(cost_basis as numeric(18,2)) as cost_basis,
    currency,
    -- Anti-pattern: computed column that could be done downstream
    cast(market_value as numeric(18,2)) - cast(cost_basis as numeric(18,2)) as unrealized_gain_loss,
    case
        when cast(cost_basis as numeric(18,2)) != 0
        then (cast(market_value as numeric(18,2)) - cast(cost_basis as numeric(18,2))) / abs(cast(cost_basis as numeric(18,2)))
        else 0
    end as unrealized_return_pct
from "bain_analytics"."public_raw"."raw_positions"
  );
[0m19:30:30.852048 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.stg_valuations"
[0m19:30:30.852378 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_portfolios: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_portfolios"} */

  create view "bain_analytics"."public"."stg_portfolios__dbt_tmp"
    
    
  as (
    -- Anti-pattern: unnecessary DISTINCT when source data is already unique
-- Anti-pattern: casting in every model instead of once upstream

select distinct
    cast(portfolio_id as varchar(10)) as portfolio_id,
    cast(portfolio_name as varchar(100)) as portfolio_name,
    cast(strategy as varchar(50)) as strategy,
    cast(inception_date as date) as inception_date,
    cast(fund_id as varchar(10)) as fund_id,
    cast(manager_name as varchar(100)) as manager_name,
    cast(is_active as boolean) as is_active,
    -- Anti-pattern: duplicated fiscal quarter logic (repeated in many models)
    case
        when extract(month from cast(inception_date as date)) between 1 and 3 then 'Q3'
        when extract(month from cast(inception_date as date)) between 4 and 6 then 'Q4'
        when extract(month from cast(inception_date as date)) between 7 and 9 then 'Q1'
        when extract(month from cast(inception_date as date)) between 10 and 12 then 'Q2'
    end as inception_fiscal_quarter
from "bain_analytics"."public_raw"."raw_portfolios"
where cast(is_active as boolean) = true
  );
[0m19:30:30.852814 [debug] [Thread-2  ]: On model.bain_capital_analytics.stg_valuations: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_valuations"} */

  create view "bain_analytics"."public"."stg_valuations__dbt_tmp"
    
    
  as (
    -- Anti-pattern: unnecessary DISTINCT
select distinct
    valuation_id,
    portfolio_id,
    cast(valuation_date as date) as valuation_date,
    cast(gross_asset_value as numeric(18,2)) as gross_asset_value,
    cast(net_asset_value as numeric(18,2)) as net_asset_value,
    cast(total_liabilities as numeric(18,2)) as total_liabilities,
    cast(unrealized_pnl as numeric(18,2)) as unrealized_pnl,
    cast(realized_pnl as numeric(18,2)) as realized_pnl,
    valuation_method,
    -- Anti-pattern: duplicated fiscal quarter logic
    case
        when extract(month from cast(valuation_date as date)) between 1 and 3 then 'Q3'
        when extract(month from cast(valuation_date as date)) between 4 and 6 then 'Q4'
        when extract(month from cast(valuation_date as date)) between 7 and 9 then 'Q1'
        when extract(month from cast(valuation_date as date)) between 10 and 12 then 'Q2'
    end as valuation_fiscal_quarter
from "bain_analytics"."public_raw"."raw_valuations"
  );
[0m19:30:30.853844 [debug] [Thread-3  ]: SQL status: CREATE VIEW in 0.004 seconds
[0m19:30:30.857216 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.stg_instruments"
[0m19:30:30.857528 [debug] [Thread-4  ]: SQL status: CREATE VIEW in 0.005 seconds
[0m19:30:30.857819 [debug] [Thread-3  ]: On model.bain_capital_analytics.stg_instruments: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_instruments"} */
alter table "bain_analytics"."public"."stg_instruments" rename to "stg_instruments__dbt_backup"
[0m19:30:30.858127 [debug] [Thread-2  ]: SQL status: CREATE VIEW in 0.005 seconds
[0m19:30:30.858405 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.005 seconds
[0m19:30:30.861267 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.stg_positions"
[0m19:30:30.864311 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.stg_valuations"
[0m19:30:30.864625 [debug] [Thread-3  ]: SQL status: ALTER TABLE in 0.003 seconds
[0m19:30:30.867511 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.stg_portfolios"
[0m19:30:30.867831 [debug] [Thread-4  ]: On model.bain_capital_analytics.stg_positions: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_positions"} */
alter table "bain_analytics"."public"."stg_positions" rename to "stg_positions__dbt_backup"
[0m19:30:30.868129 [debug] [Thread-2  ]: On model.bain_capital_analytics.stg_valuations: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_valuations"} */
alter table "bain_analytics"."public"."stg_valuations" rename to "stg_valuations__dbt_backup"
[0m19:30:30.870624 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.stg_instruments"
[0m19:30:30.870931 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_portfolios: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_portfolios"} */
alter table "bain_analytics"."public"."stg_portfolios" rename to "stg_portfolios__dbt_backup"
[0m19:30:30.871310 [debug] [Thread-3  ]: On model.bain_capital_analytics.stg_instruments: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_instruments"} */
alter table "bain_analytics"."public"."stg_instruments__dbt_tmp" rename to "stg_instruments"
[0m19:30:30.872323 [debug] [Thread-4  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m19:30:30.872635 [debug] [Thread-3  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m19:30:30.872940 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m19:30:30.873219 [debug] [Thread-2  ]: SQL status: ALTER TABLE in 0.002 seconds
[0m19:30:30.876806 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.stg_positions"
[0m19:30:30.877899 [debug] [Thread-3  ]: On model.bain_capital_analytics.stg_instruments: COMMIT
[0m19:30:30.880491 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.stg_portfolios"
[0m19:30:30.883128 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.stg_valuations"
[0m19:30:30.883458 [debug] [Thread-4  ]: On model.bain_capital_analytics.stg_positions: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_positions"} */
alter table "bain_analytics"."public"."stg_positions__dbt_tmp" rename to "stg_positions"
[0m19:30:30.883769 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.stg_instruments"
[0m19:30:30.884065 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_portfolios: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_portfolios"} */
alter table "bain_analytics"."public"."stg_portfolios__dbt_tmp" rename to "stg_portfolios"
[0m19:30:30.884375 [debug] [Thread-2  ]: On model.bain_capital_analytics.stg_valuations: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_valuations"} */
alter table "bain_analytics"."public"."stg_valuations__dbt_tmp" rename to "stg_valuations"
[0m19:30:30.884718 [debug] [Thread-3  ]: On model.bain_capital_analytics.stg_instruments: COMMIT
[0m19:30:30.886029 [debug] [Thread-4  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m19:30:30.886334 [debug] [Thread-2  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m19:30:30.886611 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.002 seconds
[0m19:30:30.886875 [debug] [Thread-3  ]: SQL status: COMMIT in 0.002 seconds
[0m19:30:30.887856 [debug] [Thread-4  ]: On model.bain_capital_analytics.stg_positions: COMMIT
[0m19:30:30.888920 [debug] [Thread-2  ]: On model.bain_capital_analytics.stg_valuations: COMMIT
[0m19:30:30.889893 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_portfolios: COMMIT
[0m19:30:30.892126 [debug] [Thread-3  ]: Applying DROP to: "bain_analytics"."public"."stg_instruments__dbt_backup"
[0m19:30:30.892446 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.stg_positions"
[0m19:30:30.892737 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.stg_valuations"
[0m19:30:30.893022 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.stg_portfolios"
[0m19:30:30.893470 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.stg_instruments"
[0m19:30:30.893759 [debug] [Thread-4  ]: On model.bain_capital_analytics.stg_positions: COMMIT
[0m19:30:30.894053 [debug] [Thread-2  ]: On model.bain_capital_analytics.stg_valuations: COMMIT
[0m19:30:30.894332 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_portfolios: COMMIT
[0m19:30:30.894627 [debug] [Thread-3  ]: On model.bain_capital_analytics.stg_instruments: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_instruments"} */
drop view if exists "bain_analytics"."public"."stg_instruments__dbt_backup" cascade
[0m19:30:30.896560 [debug] [Thread-2  ]: SQL status: COMMIT in 0.002 seconds
[0m19:30:30.896876 [debug] [Thread-4  ]: SQL status: COMMIT in 0.002 seconds
[0m19:30:30.897159 [debug] [Thread-1  ]: SQL status: COMMIT in 0.002 seconds
[0m19:30:30.899368 [debug] [Thread-2  ]: Applying DROP to: "bain_analytics"."public"."stg_valuations__dbt_backup"
[0m19:30:30.901591 [debug] [Thread-4  ]: Applying DROP to: "bain_analytics"."public"."stg_positions__dbt_backup"
[0m19:30:30.901917 [debug] [Thread-3  ]: SQL status: DROP VIEW in 0.007 seconds
[0m19:30:30.904894 [debug] [Thread-1  ]: Applying DROP to: "bain_analytics"."public"."stg_portfolios__dbt_backup"
[0m19:30:30.905423 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.stg_valuations"
[0m19:30:30.905895 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.stg_positions"
[0m19:30:30.906890 [debug] [Thread-3  ]: On model.bain_capital_analytics.stg_instruments: Close
[0m19:30:30.907346 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.stg_portfolios"
[0m19:30:30.907659 [debug] [Thread-2  ]: On model.bain_capital_analytics.stg_valuations: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_valuations"} */
drop view if exists "bain_analytics"."public"."stg_valuations__dbt_backup" cascade
[0m19:30:30.907967 [debug] [Thread-4  ]: On model.bain_capital_analytics.stg_positions: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_positions"} */
drop view if exists "bain_analytics"."public"."stg_positions__dbt_backup" cascade
[0m19:30:30.908326 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_portfolios: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_portfolios"} */
drop view if exists "bain_analytics"."public"."stg_portfolios__dbt_backup" cascade
[0m19:30:30.908811 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e99c23a0-888a-42fd-99a1-6f1a129790e4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b12bbb0>]}
[0m19:30:30.909468 [info ] [Thread-3  ]: 5 of 54 OK created sql view model public.stg_instruments ....................... [[32mCREATE VIEW[0m in 0.11s]
[0m19:30:30.909930 [debug] [Thread-3  ]: Finished running node model.bain_capital_analytics.stg_instruments
[0m19:30:30.910267 [debug] [Thread-3  ]: Began running node test.bain_capital_analytics.not_null_stg_dates_date_day.f3ec4da188
[0m19:30:30.910652 [info ] [Thread-3  ]: 9 of 54 START test not_null_stg_dates_date_day ................................. [RUN]
[0m19:30:30.911085 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly model.bain_capital_analytics.stg_instruments, now test.bain_capital_analytics.not_null_stg_dates_date_day.f3ec4da188)
[0m19:30:30.911410 [debug] [Thread-3  ]: Began compiling node test.bain_capital_analytics.not_null_stg_dates_date_day.f3ec4da188
[0m19:30:30.918611 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.009 seconds
[0m19:30:30.918955 [debug] [Thread-4  ]: SQL status: DROP VIEW in 0.010 seconds
[0m19:30:30.919240 [debug] [Thread-2  ]: SQL status: DROP VIEW in 0.010 seconds
[0m19:30:30.922525 [debug] [Thread-3  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_stg_dates_date_day.f3ec4da188"
[0m19:30:30.923552 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_portfolios: Close
[0m19:30:30.924499 [debug] [Thread-4  ]: On model.bain_capital_analytics.stg_positions: Close
[0m19:30:30.925427 [debug] [Thread-2  ]: On model.bain_capital_analytics.stg_valuations: Close
[0m19:30:30.925956 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e99c23a0-888a-42fd-99a1-6f1a129790e4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b1aa130>]}
[0m19:30:30.926458 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e99c23a0-888a-42fd-99a1-6f1a129790e4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b04a640>]}
[0m19:30:30.926852 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e99c23a0-888a-42fd-99a1-6f1a129790e4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b125160>]}
[0m19:30:30.927496 [info ] [Thread-1  ]: 6 of 54 OK created sql view model public.stg_portfolios ........................ [[32mCREATE VIEW[0m in 0.12s]
[0m19:30:30.927915 [info ] [Thread-4  ]: 7 of 54 OK created sql view model public.stg_positions ......................... [[32mCREATE VIEW[0m in 0.12s]
[0m19:30:30.928314 [debug] [Thread-3  ]: Began executing node test.bain_capital_analytics.not_null_stg_dates_date_day.f3ec4da188
[0m19:30:30.928717 [info ] [Thread-2  ]: 8 of 54 OK created sql view model public.stg_valuations ........................ [[32mCREATE VIEW[0m in 0.12s]
[0m19:30:30.929176 [debug] [Thread-1  ]: Finished running node model.bain_capital_analytics.stg_portfolios
[0m19:30:30.929591 [debug] [Thread-4  ]: Finished running node model.bain_capital_analytics.stg_positions
[0m19:30:30.942626 [debug] [Thread-2  ]: Finished running node model.bain_capital_analytics.stg_valuations
[0m19:30:30.945312 [debug] [Thread-3  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_stg_dates_date_day.f3ec4da188"
[0m19:30:30.945687 [debug] [Thread-1  ]: Began running node test.bain_capital_analytics.unique_stg_dates_date_day.e062be8e28
[0m19:30:30.946137 [debug] [Thread-4  ]: Began running node test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_date.d5c8f88f3e
[0m19:30:30.946648 [debug] [Thread-2  ]: Began running node test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_id.ec87e4ee58
[0m19:30:30.947288 [info ] [Thread-1  ]: 10 of 54 START test unique_stg_dates_date_day .................................. [RUN]
[0m19:30:30.947637 [info ] [Thread-4  ]: 11 of 54 START test not_null_stg_benchmarks_benchmark_date ..................... [RUN]
[0m19:30:30.947961 [info ] [Thread-2  ]: 12 of 54 START test not_null_stg_benchmarks_benchmark_id ....................... [RUN]
[0m19:30:30.948340 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.bain_capital_analytics.stg_portfolios, now test.bain_capital_analytics.unique_stg_dates_date_day.e062be8e28)
[0m19:30:30.948719 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly model.bain_capital_analytics.stg_positions, now test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_date.d5c8f88f3e)
[0m19:30:30.949090 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly model.bain_capital_analytics.stg_valuations, now test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_id.ec87e4ee58)
[0m19:30:30.949438 [debug] [Thread-3  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_dates_date_day.f3ec4da188"
[0m19:30:30.949751 [debug] [Thread-1  ]: Began compiling node test.bain_capital_analytics.unique_stg_dates_date_day.e062be8e28
[0m19:30:30.950044 [debug] [Thread-4  ]: Began compiling node test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_date.d5c8f88f3e
[0m19:30:30.950338 [debug] [Thread-2  ]: Began compiling node test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_id.ec87e4ee58
[0m19:30:30.950637 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_stg_dates_date_day.f3ec4da188: BEGIN
[0m19:30:30.956035 [debug] [Thread-1  ]: Writing injected SQL for node "test.bain_capital_analytics.unique_stg_dates_date_day.e062be8e28"
[0m19:30:30.959500 [debug] [Thread-4  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_date.d5c8f88f3e"
[0m19:30:30.963928 [debug] [Thread-2  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_id.ec87e4ee58"
[0m19:30:30.964251 [debug] [Thread-3  ]: Opening a new connection, currently in state closed
[0m19:30:30.964975 [debug] [Thread-4  ]: Began executing node test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_date.d5c8f88f3e
[0m19:30:30.965292 [debug] [Thread-1  ]: Began executing node test.bain_capital_analytics.unique_stg_dates_date_day.e062be8e28
[0m19:30:30.965686 [debug] [Thread-2  ]: Began executing node test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_id.ec87e4ee58
[0m19:30:30.968032 [debug] [Thread-4  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_date.d5c8f88f3e"
[0m19:30:30.970197 [debug] [Thread-1  ]: Writing runtime sql for node "test.bain_capital_analytics.unique_stg_dates_date_day.e062be8e28"
[0m19:30:30.972368 [debug] [Thread-2  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_id.ec87e4ee58"
[0m19:30:30.973008 [debug] [Thread-4  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_date.d5c8f88f3e"
[0m19:30:30.973352 [debug] [Thread-1  ]: Using postgres connection "test.bain_capital_analytics.unique_stg_dates_date_day.e062be8e28"
[0m19:30:30.973670 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_date.d5c8f88f3e: BEGIN
[0m19:30:30.973974 [debug] [Thread-1  ]: On test.bain_capital_analytics.unique_stg_dates_date_day.e062be8e28: BEGIN
[0m19:30:30.974315 [debug] [Thread-2  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_id.ec87e4ee58"
[0m19:30:30.974601 [debug] [Thread-4  ]: Opening a new connection, currently in state closed
[0m19:30:30.974897 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m19:30:30.975202 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_id.ec87e4ee58: BEGIN
[0m19:30:30.975749 [debug] [Thread-2  ]: Opening a new connection, currently in state closed
[0m19:30:30.976749 [debug] [Thread-3  ]: SQL status: BEGIN in 0.012 seconds
[0m19:30:30.977041 [debug] [Thread-3  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_dates_date_day.f3ec4da188"
[0m19:30:30.977338 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_stg_dates_date_day.f3ec4da188: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_stg_dates_date_day.f3ec4da188"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select date_day
from "bain_analytics"."public"."stg_dates"
where date_day is null



  
  
      
    ) dbt_internal_test
[0m19:30:30.979444 [debug] [Thread-3  ]: SQL status: SELECT 1 in 0.002 seconds
[0m19:30:30.982667 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_stg_dates_date_day.f3ec4da188: ROLLBACK
[0m19:30:30.983241 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_stg_dates_date_day.f3ec4da188: Close
[0m19:30:30.983742 [info ] [Thread-3  ]: 9 of 54 PASS not_null_stg_dates_date_day ....................................... [[32mPASS[0m in 0.07s]
[0m19:30:30.984212 [debug] [Thread-3  ]: Finished running node test.bain_capital_analytics.not_null_stg_dates_date_day.f3ec4da188
[0m19:30:30.984545 [debug] [Thread-3  ]: Began running node test.bain_capital_analytics.not_null_stg_cashflows_cashflow_id.4176024898
[0m19:30:30.984915 [info ] [Thread-3  ]: 13 of 54 START test not_null_stg_cashflows_cashflow_id ......................... [RUN]
[0m19:30:30.985267 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.not_null_stg_dates_date_day.f3ec4da188, now test.bain_capital_analytics.not_null_stg_cashflows_cashflow_id.4176024898)
[0m19:30:30.985573 [debug] [Thread-3  ]: Began compiling node test.bain_capital_analytics.not_null_stg_cashflows_cashflow_id.4176024898
[0m19:30:30.989537 [debug] [Thread-3  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_stg_cashflows_cashflow_id.4176024898"
[0m19:30:30.989926 [debug] [Thread-4  ]: SQL status: BEGIN in 0.015 seconds
[0m19:30:30.990360 [debug] [Thread-4  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_date.d5c8f88f3e"
[0m19:30:30.990704 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_date.d5c8f88f3e: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_date.d5c8f88f3e"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select benchmark_date
from "bain_analytics"."public"."stg_benchmarks"
where benchmark_date is null



  
  
      
    ) dbt_internal_test
[0m19:30:30.991022 [debug] [Thread-2  ]: SQL status: BEGIN in 0.015 seconds
[0m19:30:30.991342 [debug] [Thread-1  ]: SQL status: BEGIN in 0.016 seconds
[0m19:30:30.991668 [debug] [Thread-2  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_id.ec87e4ee58"
[0m19:30:30.991994 [debug] [Thread-1  ]: Using postgres connection "test.bain_capital_analytics.unique_stg_dates_date_day.e062be8e28"
[0m19:30:30.992306 [debug] [Thread-3  ]: Began executing node test.bain_capital_analytics.not_null_stg_cashflows_cashflow_id.4176024898
[0m19:30:30.992609 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_id.ec87e4ee58: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_id.ec87e4ee58"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select benchmark_id
from "bain_analytics"."public"."stg_benchmarks"
where benchmark_id is null



  
  
      
    ) dbt_internal_test
[0m19:30:30.992934 [debug] [Thread-1  ]: On test.bain_capital_analytics.unique_stg_dates_date_day.e062be8e28: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.unique_stg_dates_date_day.e062be8e28"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

select
    date_day as unique_field,
    count(*) as n_records

from "bain_analytics"."public"."stg_dates"
where date_day is not null
group by date_day
having count(*) > 1



  
  
      
    ) dbt_internal_test
[0m19:30:30.996001 [debug] [Thread-3  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_stg_cashflows_cashflow_id.4176024898"
[0m19:30:30.996323 [debug] [Thread-4  ]: SQL status: SELECT 1 in 0.005 seconds
[0m19:30:30.997594 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_date.d5c8f88f3e: ROLLBACK
[0m19:30:30.998030 [debug] [Thread-3  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_cashflows_cashflow_id.4176024898"
[0m19:30:30.998322 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_date.d5c8f88f3e: Close
[0m19:30:30.998667 [debug] [Thread-2  ]: SQL status: SELECT 1 in 0.002 seconds
[0m19:30:30.998953 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_stg_cashflows_cashflow_id.4176024898: BEGIN
[0m19:30:30.999248 [debug] [Thread-1  ]: SQL status: SELECT 1 in 0.003 seconds
[0m19:30:30.999720 [info ] [Thread-4  ]: 11 of 54 PASS not_null_stg_benchmarks_benchmark_date ........................... [[32mPASS[0m in 0.05s]
[0m19:30:31.000791 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_id.ec87e4ee58: ROLLBACK
[0m19:30:31.001097 [debug] [Thread-3  ]: Opening a new connection, currently in state closed
[0m19:30:31.002071 [debug] [Thread-1  ]: On test.bain_capital_analytics.unique_stg_dates_date_day.e062be8e28: ROLLBACK
[0m19:30:31.002515 [debug] [Thread-4  ]: Finished running node test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_date.d5c8f88f3e
[0m19:30:31.003015 [debug] [Thread-4  ]: Began running node test.bain_capital_analytics.not_null_stg_cashflows_fund_id.7ff8a45dde
[0m19:30:31.003332 [debug] [Thread-1  ]: On test.bain_capital_analytics.unique_stg_dates_date_day.e062be8e28: Close
[0m19:30:31.003618 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_id.ec87e4ee58: Close
[0m19:30:31.003971 [info ] [Thread-4  ]: 14 of 54 START test not_null_stg_cashflows_fund_id ............................. [RUN]
[0m19:30:31.004443 [info ] [Thread-1  ]: 10 of 54 PASS unique_stg_dates_date_day ........................................ [[32mPASS[0m in 0.06s]
[0m19:30:31.004933 [info ] [Thread-2  ]: 12 of 54 PASS not_null_stg_benchmarks_benchmark_id ............................. [[32mPASS[0m in 0.06s]
[0m19:30:31.005286 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_date.d5c8f88f3e, now test.bain_capital_analytics.not_null_stg_cashflows_fund_id.7ff8a45dde)
[0m19:30:31.005718 [debug] [Thread-1  ]: Finished running node test.bain_capital_analytics.unique_stg_dates_date_day.e062be8e28
[0m19:30:31.006127 [debug] [Thread-2  ]: Finished running node test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_id.ec87e4ee58
[0m19:30:31.006420 [debug] [Thread-4  ]: Began compiling node test.bain_capital_analytics.not_null_stg_cashflows_fund_id.7ff8a45dde
[0m19:30:31.006736 [debug] [Thread-1  ]: Began running node test.bain_capital_analytics.not_null_stg_cashflows_portfolio_id.cbd1d93e57
[0m19:30:31.007056 [debug] [Thread-2  ]: Began running node test.bain_capital_analytics.not_null_stg_fund_structures_fund_id.a284274f31
[0m19:30:31.010857 [debug] [Thread-4  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_stg_cashflows_fund_id.7ff8a45dde"
[0m19:30:31.011225 [info ] [Thread-1  ]: 15 of 54 START test not_null_stg_cashflows_portfolio_id ........................ [RUN]
[0m19:30:31.011561 [info ] [Thread-2  ]: 16 of 54 START test not_null_stg_fund_structures_fund_id ....................... [RUN]
[0m19:30:31.011994 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.unique_stg_dates_date_day.e062be8e28, now test.bain_capital_analytics.not_null_stg_cashflows_portfolio_id.cbd1d93e57)
[0m19:30:31.012298 [debug] [Thread-3  ]: SQL status: BEGIN in 0.011 seconds
[0m19:30:31.012652 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_id.ec87e4ee58, now test.bain_capital_analytics.not_null_stg_fund_structures_fund_id.a284274f31)
[0m19:30:31.012976 [debug] [Thread-1  ]: Began compiling node test.bain_capital_analytics.not_null_stg_cashflows_portfolio_id.cbd1d93e57
[0m19:30:31.013281 [debug] [Thread-4  ]: Began executing node test.bain_capital_analytics.not_null_stg_cashflows_fund_id.7ff8a45dde
[0m19:30:31.013560 [debug] [Thread-3  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_cashflows_cashflow_id.4176024898"
[0m19:30:31.013849 [debug] [Thread-2  ]: Began compiling node test.bain_capital_analytics.not_null_stg_fund_structures_fund_id.a284274f31
[0m19:30:31.017450 [debug] [Thread-1  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_stg_cashflows_portfolio_id.cbd1d93e57"
[0m19:30:31.019766 [debug] [Thread-4  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_stg_cashflows_fund_id.7ff8a45dde"
[0m19:30:31.020100 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_stg_cashflows_cashflow_id.4176024898: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_stg_cashflows_cashflow_id.4176024898"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select cashflow_id
from "bain_analytics"."public"."stg_cashflows"
where cashflow_id is null



  
  
      
    ) dbt_internal_test
[0m19:30:31.023393 [debug] [Thread-2  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_stg_fund_structures_fund_id.a284274f31"
[0m19:30:31.024021 [debug] [Thread-1  ]: Began executing node test.bain_capital_analytics.not_null_stg_cashflows_portfolio_id.cbd1d93e57
[0m19:30:31.024365 [debug] [Thread-4  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_cashflows_fund_id.7ff8a45dde"
[0m19:30:31.026599 [debug] [Thread-1  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_stg_cashflows_portfolio_id.cbd1d93e57"
[0m19:30:31.026940 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_stg_cashflows_fund_id.7ff8a45dde: BEGIN
[0m19:30:31.027253 [debug] [Thread-2  ]: Began executing node test.bain_capital_analytics.not_null_stg_fund_structures_fund_id.a284274f31
[0m19:30:31.027612 [debug] [Thread-4  ]: Opening a new connection, currently in state closed
[0m19:30:31.030626 [debug] [Thread-2  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_stg_fund_structures_fund_id.a284274f31"
[0m19:30:31.030956 [debug] [Thread-3  ]: SQL status: SELECT 1 in 0.007 seconds
[0m19:30:31.031400 [debug] [Thread-1  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_cashflows_portfolio_id.cbd1d93e57"
[0m19:30:31.032737 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_stg_cashflows_cashflow_id.4176024898: ROLLBACK
[0m19:30:31.033052 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_stg_cashflows_portfolio_id.cbd1d93e57: BEGIN
[0m19:30:31.033423 [debug] [Thread-2  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_fund_structures_fund_id.a284274f31"
[0m19:30:31.033708 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m19:30:31.033998 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_stg_cashflows_cashflow_id.4176024898: Close
[0m19:30:31.034288 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_stg_fund_structures_fund_id.a284274f31: BEGIN
[0m19:30:31.034838 [info ] [Thread-3  ]: 13 of 54 PASS not_null_stg_cashflows_cashflow_id ............................... [[32mPASS[0m in 0.05s]
[0m19:30:31.035151 [debug] [Thread-2  ]: Opening a new connection, currently in state closed
[0m19:30:31.035678 [debug] [Thread-3  ]: Finished running node test.bain_capital_analytics.not_null_stg_cashflows_cashflow_id.4176024898
[0m19:30:31.036090 [debug] [Thread-3  ]: Began running node test.bain_capital_analytics.unique_stg_cashflows_cashflow_id.359e4f4704
[0m19:30:31.036459 [info ] [Thread-3  ]: 17 of 54 START test unique_stg_cashflows_cashflow_id ........................... [RUN]
[0m19:30:31.036816 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.not_null_stg_cashflows_cashflow_id.4176024898, now test.bain_capital_analytics.unique_stg_cashflows_cashflow_id.359e4f4704)
[0m19:30:31.037117 [debug] [Thread-3  ]: Began compiling node test.bain_capital_analytics.unique_stg_cashflows_cashflow_id.359e4f4704
[0m19:30:31.040494 [debug] [Thread-3  ]: Writing injected SQL for node "test.bain_capital_analytics.unique_stg_cashflows_cashflow_id.359e4f4704"
[0m19:30:31.040981 [debug] [Thread-3  ]: Began executing node test.bain_capital_analytics.unique_stg_cashflows_cashflow_id.359e4f4704
[0m19:30:31.043146 [debug] [Thread-3  ]: Writing runtime sql for node "test.bain_capital_analytics.unique_stg_cashflows_cashflow_id.359e4f4704"
[0m19:30:31.043521 [debug] [Thread-4  ]: SQL status: BEGIN in 0.016 seconds
[0m19:30:31.043851 [debug] [Thread-4  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_cashflows_fund_id.7ff8a45dde"
[0m19:30:31.044161 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_stg_cashflows_fund_id.7ff8a45dde: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_stg_cashflows_fund_id.7ff8a45dde"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select fund_id
from "bain_analytics"."public"."stg_cashflows"
where fund_id is null



  
  
      
    ) dbt_internal_test
[0m19:30:31.044492 [debug] [Thread-2  ]: SQL status: BEGIN in 0.009 seconds
[0m19:30:31.044815 [debug] [Thread-1  ]: SQL status: BEGIN in 0.011 seconds
[0m19:30:31.045120 [debug] [Thread-2  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_fund_structures_fund_id.a284274f31"
[0m19:30:31.045449 [debug] [Thread-3  ]: Using postgres connection "test.bain_capital_analytics.unique_stg_cashflows_cashflow_id.359e4f4704"
[0m19:30:31.045729 [debug] [Thread-1  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_cashflows_portfolio_id.cbd1d93e57"
[0m19:30:31.046029 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_stg_fund_structures_fund_id.a284274f31: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_stg_fund_structures_fund_id.a284274f31"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select fund_id
from "bain_analytics"."public"."stg_fund_structures"
where fund_id is null



  
  
      
    ) dbt_internal_test
[0m19:30:31.046329 [debug] [Thread-3  ]: On test.bain_capital_analytics.unique_stg_cashflows_cashflow_id.359e4f4704: BEGIN
[0m19:30:31.046629 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_stg_cashflows_portfolio_id.cbd1d93e57: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_stg_cashflows_portfolio_id.cbd1d93e57"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select portfolio_id
from "bain_analytics"."public"."stg_cashflows"
where portfolio_id is null



  
  
      
    ) dbt_internal_test
[0m19:30:31.046974 [debug] [Thread-4  ]: SQL status: SELECT 1 in 0.002 seconds
[0m19:30:31.047247 [debug] [Thread-3  ]: Opening a new connection, currently in state closed
[0m19:30:31.048343 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_stg_cashflows_fund_id.7ff8a45dde: ROLLBACK
[0m19:30:31.048642 [debug] [Thread-2  ]: SQL status: SELECT 1 in 0.002 seconds
[0m19:30:31.049864 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_stg_fund_structures_fund_id.a284274f31: ROLLBACK
[0m19:30:31.050178 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_stg_cashflows_fund_id.7ff8a45dde: Close
[0m19:30:31.050477 [debug] [Thread-1  ]: SQL status: SELECT 1 in 0.003 seconds
[0m19:30:31.051985 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_stg_cashflows_portfolio_id.cbd1d93e57: ROLLBACK
[0m19:30:31.052301 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_stg_fund_structures_fund_id.a284274f31: Close
[0m19:30:31.050947 [info ] [Thread-4  ]: 14 of 54 PASS not_null_stg_cashflows_fund_id ................................... [[32mPASS[0m in 0.05s]
[0m19:30:31.052874 [info ] [Thread-2  ]: 16 of 54 PASS not_null_stg_fund_structures_fund_id ............................. [[32mPASS[0m in 0.04s]
[0m19:30:31.053193 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_stg_cashflows_portfolio_id.cbd1d93e57: Close
[0m19:30:31.053596 [debug] [Thread-4  ]: Finished running node test.bain_capital_analytics.not_null_stg_cashflows_fund_id.7ff8a45dde
[0m19:30:31.054002 [debug] [Thread-2  ]: Finished running node test.bain_capital_analytics.not_null_stg_fund_structures_fund_id.a284274f31
[0m19:30:31.054419 [info ] [Thread-1  ]: 15 of 54 PASS not_null_stg_cashflows_portfolio_id .............................. [[32mPASS[0m in 0.04s]
[0m19:30:31.054783 [debug] [Thread-4  ]: Began running node test.bain_capital_analytics.unique_stg_fund_structures_fund_id.bb9fec42ab
[0m19:30:31.055171 [debug] [Thread-2  ]: Began running node test.bain_capital_analytics.not_null_stg_instruments_instrument_id.18bdfd2ebe
[0m19:30:31.055630 [debug] [Thread-1  ]: Finished running node test.bain_capital_analytics.not_null_stg_cashflows_portfolio_id.cbd1d93e57
[0m19:30:31.055949 [info ] [Thread-4  ]: 18 of 54 START test unique_stg_fund_structures_fund_id ......................... [RUN]
[0m19:30:31.056304 [info ] [Thread-2  ]: 19 of 54 START test not_null_stg_instruments_instrument_id ..................... [RUN]
[0m19:30:31.056681 [debug] [Thread-1  ]: Began running node test.bain_capital_analytics.unique_stg_instruments_instrument_id.0e70adcd34
[0m19:30:31.057045 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.not_null_stg_cashflows_fund_id.7ff8a45dde, now test.bain_capital_analytics.unique_stg_fund_structures_fund_id.bb9fec42ab)
[0m19:30:31.057363 [debug] [Thread-3  ]: SQL status: BEGIN in 0.010 seconds
[0m19:30:31.057664 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.not_null_stg_fund_structures_fund_id.a284274f31, now test.bain_capital_analytics.not_null_stg_instruments_instrument_id.18bdfd2ebe)
[0m19:30:31.057977 [info ] [Thread-1  ]: 20 of 54 START test unique_stg_instruments_instrument_id ....................... [RUN]
[0m19:30:31.058315 [debug] [Thread-4  ]: Began compiling node test.bain_capital_analytics.unique_stg_fund_structures_fund_id.bb9fec42ab
[0m19:30:31.058609 [debug] [Thread-3  ]: Using postgres connection "test.bain_capital_analytics.unique_stg_cashflows_cashflow_id.359e4f4704"
[0m19:30:31.058899 [debug] [Thread-2  ]: Began compiling node test.bain_capital_analytics.not_null_stg_instruments_instrument_id.18bdfd2ebe
[0m19:30:31.059207 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.not_null_stg_cashflows_portfolio_id.cbd1d93e57, now test.bain_capital_analytics.unique_stg_instruments_instrument_id.0e70adcd34)
[0m19:30:31.062906 [debug] [Thread-4  ]: Writing injected SQL for node "test.bain_capital_analytics.unique_stg_fund_structures_fund_id.bb9fec42ab"
[0m19:30:31.063244 [debug] [Thread-3  ]: On test.bain_capital_analytics.unique_stg_cashflows_cashflow_id.359e4f4704: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.unique_stg_cashflows_cashflow_id.359e4f4704"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

select
    cashflow_id as unique_field,
    count(*) as n_records

from "bain_analytics"."public"."stg_cashflows"
where cashflow_id is not null
group by cashflow_id
having count(*) > 1



  
  
      
    ) dbt_internal_test
[0m19:30:31.066678 [debug] [Thread-2  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_stg_instruments_instrument_id.18bdfd2ebe"
[0m19:30:31.067027 [debug] [Thread-1  ]: Began compiling node test.bain_capital_analytics.unique_stg_instruments_instrument_id.0e70adcd34
[0m19:30:31.070885 [debug] [Thread-1  ]: Writing injected SQL for node "test.bain_capital_analytics.unique_stg_instruments_instrument_id.0e70adcd34"
[0m19:30:31.071252 [debug] [Thread-3  ]: SQL status: SELECT 1 in 0.004 seconds
[0m19:30:31.072518 [debug] [Thread-3  ]: On test.bain_capital_analytics.unique_stg_cashflows_cashflow_id.359e4f4704: ROLLBACK
[0m19:30:31.072871 [debug] [Thread-2  ]: Began executing node test.bain_capital_analytics.not_null_stg_instruments_instrument_id.18bdfd2ebe
[0m19:30:31.076355 [debug] [Thread-2  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_stg_instruments_instrument_id.18bdfd2ebe"
[0m19:30:31.076687 [debug] [Thread-4  ]: Began executing node test.bain_capital_analytics.unique_stg_fund_structures_fund_id.bb9fec42ab
[0m19:30:31.076977 [debug] [Thread-3  ]: On test.bain_capital_analytics.unique_stg_cashflows_cashflow_id.359e4f4704: Close
[0m19:30:31.079211 [debug] [Thread-4  ]: Writing runtime sql for node "test.bain_capital_analytics.unique_stg_fund_structures_fund_id.bb9fec42ab"
[0m19:30:31.079541 [debug] [Thread-1  ]: Began executing node test.bain_capital_analytics.unique_stg_instruments_instrument_id.0e70adcd34
[0m19:30:31.080042 [info ] [Thread-3  ]: 17 of 54 PASS unique_stg_cashflows_cashflow_id ................................. [[32mPASS[0m in 0.04s]
[0m19:30:31.080470 [debug] [Thread-2  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_instruments_instrument_id.18bdfd2ebe"
[0m19:30:31.082723 [debug] [Thread-1  ]: Writing runtime sql for node "test.bain_capital_analytics.unique_stg_instruments_instrument_id.0e70adcd34"
[0m19:30:31.083223 [debug] [Thread-3  ]: Finished running node test.bain_capital_analytics.unique_stg_cashflows_cashflow_id.359e4f4704
[0m19:30:31.083537 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_stg_instruments_instrument_id.18bdfd2ebe: BEGIN
[0m19:30:31.083875 [debug] [Thread-4  ]: Using postgres connection "test.bain_capital_analytics.unique_stg_fund_structures_fund_id.bb9fec42ab"
[0m19:30:31.084279 [debug] [Thread-3  ]: Began running node test.bain_capital_analytics.not_null_stg_portfolios_fund_id.70b04d82bd
[0m19:30:31.084633 [debug] [Thread-2  ]: Opening a new connection, currently in state closed
[0m19:30:31.084953 [debug] [Thread-4  ]: On test.bain_capital_analytics.unique_stg_fund_structures_fund_id.bb9fec42ab: BEGIN
[0m19:30:31.085281 [debug] [Thread-1  ]: Using postgres connection "test.bain_capital_analytics.unique_stg_instruments_instrument_id.0e70adcd34"
[0m19:30:31.085626 [info ] [Thread-3  ]: 21 of 54 START test not_null_stg_portfolios_fund_id ............................ [RUN]
[0m19:30:31.086045 [debug] [Thread-4  ]: Opening a new connection, currently in state closed
[0m19:30:31.086358 [debug] [Thread-1  ]: On test.bain_capital_analytics.unique_stg_instruments_instrument_id.0e70adcd34: BEGIN
[0m19:30:31.086721 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.unique_stg_cashflows_cashflow_id.359e4f4704, now test.bain_capital_analytics.not_null_stg_portfolios_fund_id.70b04d82bd)
[0m19:30:31.087107 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m19:30:31.087422 [debug] [Thread-3  ]: Began compiling node test.bain_capital_analytics.not_null_stg_portfolios_fund_id.70b04d82bd
[0m19:30:31.091284 [debug] [Thread-3  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_stg_portfolios_fund_id.70b04d82bd"
[0m19:30:31.091783 [debug] [Thread-3  ]: Began executing node test.bain_capital_analytics.not_null_stg_portfolios_fund_id.70b04d82bd
[0m19:30:31.094002 [debug] [Thread-3  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_stg_portfolios_fund_id.70b04d82bd"
[0m19:30:31.094481 [debug] [Thread-3  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_portfolios_fund_id.70b04d82bd"
[0m19:30:31.094769 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_stg_portfolios_fund_id.70b04d82bd: BEGIN
[0m19:30:31.095041 [debug] [Thread-3  ]: Opening a new connection, currently in state closed
[0m19:30:31.097165 [debug] [Thread-4  ]: SQL status: BEGIN in 0.011 seconds
[0m19:30:31.097482 [debug] [Thread-2  ]: SQL status: BEGIN in 0.013 seconds
[0m19:30:31.097766 [debug] [Thread-4  ]: Using postgres connection "test.bain_capital_analytics.unique_stg_fund_structures_fund_id.bb9fec42ab"
[0m19:30:31.098040 [debug] [Thread-1  ]: SQL status: BEGIN in 0.011 seconds
[0m19:30:31.098330 [debug] [Thread-2  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_instruments_instrument_id.18bdfd2ebe"
[0m19:30:31.098653 [debug] [Thread-4  ]: On test.bain_capital_analytics.unique_stg_fund_structures_fund_id.bb9fec42ab: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.unique_stg_fund_structures_fund_id.bb9fec42ab"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

select
    fund_id as unique_field,
    count(*) as n_records

from "bain_analytics"."public"."stg_fund_structures"
where fund_id is not null
group by fund_id
having count(*) > 1



  
  
      
    ) dbt_internal_test
[0m19:30:31.099111 [debug] [Thread-1  ]: Using postgres connection "test.bain_capital_analytics.unique_stg_instruments_instrument_id.0e70adcd34"
[0m19:30:31.099443 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_stg_instruments_instrument_id.18bdfd2ebe: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_stg_instruments_instrument_id.18bdfd2ebe"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select instrument_id
from "bain_analytics"."public"."stg_instruments"
where instrument_id is null



  
  
      
    ) dbt_internal_test
[0m19:30:31.099826 [debug] [Thread-1  ]: On test.bain_capital_analytics.unique_stg_instruments_instrument_id.0e70adcd34: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.unique_stg_instruments_instrument_id.0e70adcd34"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

select
    instrument_id as unique_field,
    count(*) as n_records

from "bain_analytics"."public"."stg_instruments"
where instrument_id is not null
group by instrument_id
having count(*) > 1



  
  
      
    ) dbt_internal_test
[0m19:30:31.102210 [debug] [Thread-4  ]: SQL status: SELECT 1 in 0.002 seconds
[0m19:30:31.102512 [debug] [Thread-2  ]: SQL status: SELECT 1 in 0.002 seconds
[0m19:30:31.102793 [debug] [Thread-1  ]: SQL status: SELECT 1 in 0.003 seconds
[0m19:30:31.104030 [debug] [Thread-4  ]: On test.bain_capital_analytics.unique_stg_fund_structures_fund_id.bb9fec42ab: ROLLBACK
[0m19:30:31.105105 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_stg_instruments_instrument_id.18bdfd2ebe: ROLLBACK
[0m19:30:31.105422 [debug] [Thread-3  ]: SQL status: BEGIN in 0.010 seconds
[0m19:30:31.106477 [debug] [Thread-1  ]: On test.bain_capital_analytics.unique_stg_instruments_instrument_id.0e70adcd34: ROLLBACK
[0m19:30:31.106858 [debug] [Thread-3  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_portfolios_fund_id.70b04d82bd"
[0m19:30:31.107187 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_stg_portfolios_fund_id.70b04d82bd: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_stg_portfolios_fund_id.70b04d82bd"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select fund_id
from "bain_analytics"."public"."stg_portfolios"
where fund_id is null



  
  
      
    ) dbt_internal_test
[0m19:30:31.107491 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_stg_instruments_instrument_id.18bdfd2ebe: Close
[0m19:30:31.107771 [debug] [Thread-1  ]: On test.bain_capital_analytics.unique_stg_instruments_instrument_id.0e70adcd34: Close
[0m19:30:31.108034 [debug] [Thread-4  ]: On test.bain_capital_analytics.unique_stg_fund_structures_fund_id.bb9fec42ab: Close
[0m19:30:31.108556 [info ] [Thread-2  ]: 19 of 54 PASS not_null_stg_instruments_instrument_id ........................... [[32mPASS[0m in 0.05s]
[0m19:30:31.109011 [info ] [Thread-1  ]: 20 of 54 PASS unique_stg_instruments_instrument_id ............................. [[32mPASS[0m in 0.05s]
[0m19:30:31.109439 [info ] [Thread-4  ]: 18 of 54 PASS unique_stg_fund_structures_fund_id ............................... [[32mPASS[0m in 0.05s]
[0m19:30:31.109867 [debug] [Thread-2  ]: Finished running node test.bain_capital_analytics.not_null_stg_instruments_instrument_id.18bdfd2ebe
[0m19:30:31.110270 [debug] [Thread-1  ]: Finished running node test.bain_capital_analytics.unique_stg_instruments_instrument_id.0e70adcd34
[0m19:30:31.110664 [debug] [Thread-4  ]: Finished running node test.bain_capital_analytics.unique_stg_fund_structures_fund_id.bb9fec42ab
[0m19:30:31.110997 [debug] [Thread-2  ]: Began running node test.bain_capital_analytics.not_null_stg_portfolios_portfolio_id.7126a480ec
[0m19:30:31.111273 [debug] [Thread-3  ]: SQL status: SELECT 1 in 0.003 seconds
[0m19:30:31.111635 [debug] [Thread-1  ]: Began running node test.bain_capital_analytics.unique_stg_portfolios_portfolio_id.aa125b6658
[0m19:30:31.111995 [debug] [Thread-4  ]: Began running node test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c
[0m19:30:31.112351 [info ] [Thread-2  ]: 22 of 54 START test not_null_stg_portfolios_portfolio_id ....................... [RUN]
[0m19:30:31.113424 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_stg_portfolios_fund_id.70b04d82bd: ROLLBACK
[0m19:30:31.113736 [info ] [Thread-1  ]: 23 of 54 START test unique_stg_portfolios_portfolio_id ......................... [RUN]
[0m19:30:31.114056 [info ] [Thread-4  ]: 24 of 54 START test not_null_stg_positions_portfolio_id ........................ [RUN]
[0m19:30:31.114406 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.not_null_stg_instruments_instrument_id.18bdfd2ebe, now test.bain_capital_analytics.not_null_stg_portfolios_portfolio_id.7126a480ec)
[0m19:30:31.114765 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.unique_stg_instruments_instrument_id.0e70adcd34, now test.bain_capital_analytics.unique_stg_portfolios_portfolio_id.aa125b6658)
[0m19:30:31.115092 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.unique_stg_fund_structures_fund_id.bb9fec42ab, now test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c)
[0m19:30:31.115366 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_stg_portfolios_fund_id.70b04d82bd: Close
[0m19:30:31.115689 [debug] [Thread-2  ]: Began compiling node test.bain_capital_analytics.not_null_stg_portfolios_portfolio_id.7126a480ec
[0m19:30:31.116010 [debug] [Thread-1  ]: Began compiling node test.bain_capital_analytics.unique_stg_portfolios_portfolio_id.aa125b6658
[0m19:30:31.116306 [debug] [Thread-4  ]: Began compiling node test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c
[0m19:30:31.121199 [debug] [Thread-2  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_stg_portfolios_portfolio_id.7126a480ec"
[0m19:30:31.121632 [info ] [Thread-3  ]: 21 of 54 PASS not_null_stg_portfolios_fund_id .................................. [[32mPASS[0m in 0.03s]
[0m19:30:31.124931 [debug] [Thread-1  ]: Writing injected SQL for node "test.bain_capital_analytics.unique_stg_portfolios_portfolio_id.aa125b6658"
[0m19:30:31.128160 [debug] [Thread-4  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c"
[0m19:30:31.128681 [debug] [Thread-3  ]: Finished running node test.bain_capital_analytics.not_null_stg_portfolios_fund_id.70b04d82bd
[0m19:30:31.129221 [debug] [Thread-3  ]: Began running node test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1
[0m19:30:31.129590 [debug] [Thread-2  ]: Began executing node test.bain_capital_analytics.not_null_stg_portfolios_portfolio_id.7126a480ec
[0m19:30:31.129919 [info ] [Thread-3  ]: 25 of 54 START test not_null_stg_positions_position_id ......................... [RUN]
[0m19:30:31.130261 [debug] [Thread-1  ]: Began executing node test.bain_capital_analytics.unique_stg_portfolios_portfolio_id.aa125b6658
[0m19:30:31.132565 [debug] [Thread-2  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_stg_portfolios_portfolio_id.7126a480ec"
[0m19:30:31.132909 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.not_null_stg_portfolios_fund_id.70b04d82bd, now test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1)
[0m19:30:31.133221 [debug] [Thread-4  ]: Began executing node test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c
[0m19:30:31.135348 [debug] [Thread-1  ]: Writing runtime sql for node "test.bain_capital_analytics.unique_stg_portfolios_portfolio_id.aa125b6658"
[0m19:30:31.135718 [debug] [Thread-3  ]: Began compiling node test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1
[0m19:30:31.137984 [debug] [Thread-4  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c"
[0m19:30:31.138392 [debug] [Thread-2  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_portfolios_portfolio_id.7126a480ec"
[0m19:30:31.142527 [debug] [Thread-3  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1"
[0m19:30:31.142949 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_stg_portfolios_portfolio_id.7126a480ec: BEGIN
[0m19:30:31.143386 [debug] [Thread-4  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c"
[0m19:30:31.143710 [debug] [Thread-1  ]: Using postgres connection "test.bain_capital_analytics.unique_stg_portfolios_portfolio_id.aa125b6658"
[0m19:30:31.143999 [debug] [Thread-2  ]: Opening a new connection, currently in state closed
[0m19:30:31.144336 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c: BEGIN
[0m19:30:31.144650 [debug] [Thread-1  ]: On test.bain_capital_analytics.unique_stg_portfolios_portfolio_id.aa125b6658: BEGIN
[0m19:30:31.144947 [debug] [Thread-3  ]: Began executing node test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1
[0m19:30:31.145333 [debug] [Thread-4  ]: Opening a new connection, currently in state closed
[0m19:30:31.145624 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m19:30:31.147790 [debug] [Thread-3  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1"
[0m19:30:31.148532 [debug] [Thread-3  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1"
[0m19:30:31.148929 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1: BEGIN
[0m19:30:31.149275 [debug] [Thread-3  ]: Opening a new connection, currently in state closed
[0m19:30:31.155567 [debug] [Thread-2  ]: SQL status: BEGIN in 0.012 seconds
[0m19:30:31.155861 [debug] [Thread-2  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_portfolios_portfolio_id.7126a480ec"
[0m19:30:31.156159 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_stg_portfolios_portfolio_id.7126a480ec: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_stg_portfolios_portfolio_id.7126a480ec"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select portfolio_id
from "bain_analytics"."public"."stg_portfolios"
where portfolio_id is null



  
  
      
    ) dbt_internal_test
[0m19:30:31.158676 [debug] [Thread-4  ]: SQL status: BEGIN in 0.013 seconds
[0m19:30:31.158997 [debug] [Thread-1  ]: SQL status: BEGIN in 0.013 seconds
[0m19:30:31.159323 [debug] [Thread-2  ]: SQL status: SELECT 1 in 0.003 seconds
[0m19:30:31.159605 [debug] [Thread-4  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c"
[0m19:30:31.159915 [debug] [Thread-3  ]: SQL status: BEGIN in 0.011 seconds
[0m19:30:31.160211 [debug] [Thread-1  ]: Using postgres connection "test.bain_capital_analytics.unique_stg_portfolios_portfolio_id.aa125b6658"
[0m19:30:31.161442 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_stg_portfolios_portfolio_id.7126a480ec: ROLLBACK
[0m19:30:31.161775 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select portfolio_id
from "bain_analytics"."public"."stg_positions"
where portfolio_id is null



  
  
      
    ) dbt_internal_test
[0m19:30:31.162095 [debug] [Thread-3  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1"
[0m19:30:31.162414 [debug] [Thread-1  ]: On test.bain_capital_analytics.unique_stg_portfolios_portfolio_id.aa125b6658: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.unique_stg_portfolios_portfolio_id.aa125b6658"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

select
    portfolio_id as unique_field,
    count(*) as n_records

from "bain_analytics"."public"."stg_portfolios"
where portfolio_id is not null
group by portfolio_id
having count(*) > 1



  
  
      
    ) dbt_internal_test
[0m19:30:31.162826 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select position_id
from "bain_analytics"."public"."stg_positions"
where position_id is null



  
  
      
    ) dbt_internal_test
[0m19:30:31.163133 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_stg_portfolios_portfolio_id.7126a480ec: Close
[0m19:30:31.163652 [info ] [Thread-2  ]: 22 of 54 PASS not_null_stg_portfolios_portfolio_id ............................. [[32mPASS[0m in 0.05s]
[0m19:30:31.164094 [debug] [Thread-2  ]: Finished running node test.bain_capital_analytics.not_null_stg_portfolios_portfolio_id.7126a480ec
[0m19:30:31.164418 [debug] [Thread-2  ]: Began running node test.bain_capital_analytics.relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_.2823f12709
[0m19:30:31.164797 [info ] [Thread-2  ]: 26 of 54 START test relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_  [RUN]
[0m19:30:31.165222 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.not_null_stg_portfolios_portfolio_id.7126a480ec, now test.bain_capital_analytics.relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_.2823f12709)
[0m19:30:31.165542 [debug] [Thread-4  ]: SQL status: SELECT 1 in 0.003 seconds
[0m19:30:31.165823 [debug] [Thread-3  ]: SQL status: SELECT 1 in 0.002 seconds
[0m19:30:31.166112 [debug] [Thread-2  ]: Began compiling node test.bain_capital_analytics.relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_.2823f12709
[0m19:30:31.166391 [debug] [Thread-1  ]: SQL status: SELECT 1 in 0.003 seconds
[0m19:30:31.167491 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c: ROLLBACK
[0m19:30:31.168511 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1: ROLLBACK
[0m19:30:31.175871 [debug] [Thread-1  ]: On test.bain_capital_analytics.unique_stg_portfolios_portfolio_id.aa125b6658: ROLLBACK
[0m19:30:31.176971 [debug] [Thread-2  ]: Writing injected SQL for node "test.bain_capital_analytics.relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_.2823f12709"
[0m19:30:31.177595 [debug] [Thread-2  ]: Began executing node test.bain_capital_analytics.relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_.2823f12709
[0m19:30:31.177903 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c: Close
[0m19:30:31.178184 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1: Close
[0m19:30:31.178448 [debug] [Thread-1  ]: On test.bain_capital_analytics.unique_stg_portfolios_portfolio_id.aa125b6658: Close
[0m19:30:31.180748 [debug] [Thread-2  ]: Writing runtime sql for node "test.bain_capital_analytics.relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_.2823f12709"
[0m19:30:31.181241 [info ] [Thread-4  ]: 24 of 54 PASS not_null_stg_positions_portfolio_id .............................. [[32mPASS[0m in 0.07s]
[0m19:30:31.181705 [info ] [Thread-3  ]: 25 of 54 PASS not_null_stg_positions_position_id ............................... [[32mPASS[0m in 0.05s]
[0m19:30:31.182184 [info ] [Thread-1  ]: 23 of 54 PASS unique_stg_portfolios_portfolio_id ............................... [[32mPASS[0m in 0.07s]
[0m19:30:31.182692 [debug] [Thread-4  ]: Finished running node test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c
[0m19:30:31.183123 [debug] [Thread-3  ]: Finished running node test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1
[0m19:30:31.183561 [debug] [Thread-1  ]: Finished running node test.bain_capital_analytics.unique_stg_portfolios_portfolio_id.aa125b6658
[0m19:30:31.183889 [debug] [Thread-4  ]: Began running node test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f
[0m19:30:31.184263 [debug] [Thread-2  ]: Using postgres connection "test.bain_capital_analytics.relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_.2823f12709"
[0m19:30:31.184670 [debug] [Thread-3  ]: Began running node test.bain_capital_analytics.not_null_stg_valuations_portfolio_id.d5af3e5188
[0m19:30:31.185032 [debug] [Thread-1  ]: Began running node test.bain_capital_analytics.not_null_stg_valuations_valuation_id.88ca70781d
[0m19:30:31.185398 [info ] [Thread-4  ]: 27 of 54 START test unique_stg_positions_position_id ........................... [RUN]
[0m19:30:31.185818 [debug] [Thread-2  ]: On test.bain_capital_analytics.relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_.2823f12709: BEGIN
[0m19:30:31.186142 [info ] [Thread-3  ]: 28 of 54 START test not_null_stg_valuations_portfolio_id ....................... [RUN]
[0m19:30:31.186481 [info ] [Thread-1  ]: 29 of 54 START test not_null_stg_valuations_valuation_id ....................... [RUN]
[0m19:30:31.186854 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c, now test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f)
[0m19:30:31.187167 [debug] [Thread-2  ]: Opening a new connection, currently in state closed
[0m19:30:31.187488 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1, now test.bain_capital_analytics.not_null_stg_valuations_portfolio_id.d5af3e5188)
[0m19:30:31.187813 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.unique_stg_portfolios_portfolio_id.aa125b6658, now test.bain_capital_analytics.not_null_stg_valuations_valuation_id.88ca70781d)
[0m19:30:31.188118 [debug] [Thread-4  ]: Began compiling node test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f
[0m19:30:31.188505 [debug] [Thread-3  ]: Began compiling node test.bain_capital_analytics.not_null_stg_valuations_portfolio_id.d5af3e5188
[0m19:30:31.188812 [debug] [Thread-1  ]: Began compiling node test.bain_capital_analytics.not_null_stg_valuations_valuation_id.88ca70781d
[0m19:30:31.192339 [debug] [Thread-4  ]: Writing injected SQL for node "test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f"
[0m19:30:31.195625 [debug] [Thread-3  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_stg_valuations_portfolio_id.d5af3e5188"
[0m19:30:31.248316 [debug] [Thread-1  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_stg_valuations_valuation_id.88ca70781d"
[0m19:30:31.248757 [debug] [Thread-2  ]: SQL status: BEGIN in 0.062 seconds
[0m19:30:31.249285 [debug] [Thread-2  ]: Using postgres connection "test.bain_capital_analytics.relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_.2823f12709"
[0m19:30:31.249688 [debug] [Thread-2  ]: On test.bain_capital_analytics.relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_.2823f12709: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_.2823f12709"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

with child as (
    select portfolio_id as from_field
    from "bain_analytics"."public"."stg_positions"
    where portfolio_id is not null
),

parent as (
    select portfolio_id as to_field
    from "bain_analytics"."public"."stg_portfolios"
)

select
    from_field

from child
left join parent
    on child.from_field = parent.to_field

where parent.to_field is null



  
  
      
    ) dbt_internal_test
[0m19:30:31.250036 [debug] [Thread-4  ]: Began executing node test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f
[0m19:30:31.252462 [debug] [Thread-4  ]: Writing runtime sql for node "test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f"
[0m19:30:31.252791 [debug] [Thread-1  ]: Began executing node test.bain_capital_analytics.not_null_stg_valuations_valuation_id.88ca70781d
[0m19:30:31.253076 [debug] [Thread-3  ]: Began executing node test.bain_capital_analytics.not_null_stg_valuations_portfolio_id.d5af3e5188
[0m19:30:31.255227 [debug] [Thread-1  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_stg_valuations_valuation_id.88ca70781d"
[0m19:30:31.257497 [debug] [Thread-3  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_stg_valuations_portfolio_id.d5af3e5188"
[0m19:30:31.257922 [debug] [Thread-2  ]: SQL status: SELECT 1 in 0.008 seconds
[0m19:30:31.258270 [debug] [Thread-4  ]: Using postgres connection "test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f"
[0m19:30:31.259599 [debug] [Thread-2  ]: On test.bain_capital_analytics.relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_.2823f12709: ROLLBACK
[0m19:30:31.259949 [debug] [Thread-1  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_valuations_valuation_id.88ca70781d"
[0m19:30:31.260245 [debug] [Thread-4  ]: On test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f: BEGIN
[0m19:30:31.260630 [debug] [Thread-3  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_valuations_portfolio_id.d5af3e5188"
[0m19:30:31.260908 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_stg_valuations_valuation_id.88ca70781d: BEGIN
[0m19:30:31.261205 [debug] [Thread-2  ]: On test.bain_capital_analytics.relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_.2823f12709: Close
[0m19:30:31.261478 [debug] [Thread-4  ]: Opening a new connection, currently in state closed
[0m19:30:31.261768 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_stg_valuations_portfolio_id.d5af3e5188: BEGIN
[0m19:30:31.262057 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m19:30:31.262538 [info ] [Thread-2  ]: 26 of 54 PASS relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_  [[32mPASS[0m in 0.10s]
[0m19:30:31.262952 [debug] [Thread-3  ]: Opening a new connection, currently in state closed
[0m19:30:31.263470 [debug] [Thread-2  ]: Finished running node test.bain_capital_analytics.relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_.2823f12709
[0m19:30:31.263904 [debug] [Thread-2  ]: Began running node test.bain_capital_analytics.unique_stg_valuations_valuation_id.fce7eb13b5
[0m19:30:31.264317 [info ] [Thread-2  ]: 30 of 54 START test unique_stg_valuations_valuation_id ......................... [RUN]
[0m19:30:31.264693 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_.2823f12709, now test.bain_capital_analytics.unique_stg_valuations_valuation_id.fce7eb13b5)
[0m19:30:31.265048 [debug] [Thread-2  ]: Began compiling node test.bain_capital_analytics.unique_stg_valuations_valuation_id.fce7eb13b5
[0m19:30:31.268654 [debug] [Thread-2  ]: Writing injected SQL for node "test.bain_capital_analytics.unique_stg_valuations_valuation_id.fce7eb13b5"
[0m19:30:31.269170 [debug] [Thread-2  ]: Began executing node test.bain_capital_analytics.unique_stg_valuations_valuation_id.fce7eb13b5
[0m19:30:31.272016 [debug] [Thread-2  ]: Writing runtime sql for node "test.bain_capital_analytics.unique_stg_valuations_valuation_id.fce7eb13b5"
[0m19:30:31.272506 [debug] [Thread-2  ]: Using postgres connection "test.bain_capital_analytics.unique_stg_valuations_valuation_id.fce7eb13b5"
[0m19:30:31.272795 [debug] [Thread-2  ]: On test.bain_capital_analytics.unique_stg_valuations_valuation_id.fce7eb13b5: BEGIN
[0m19:30:31.273068 [debug] [Thread-2  ]: Opening a new connection, currently in state closed
[0m19:30:31.274846 [debug] [Thread-4  ]: SQL status: BEGIN in 0.013 seconds
[0m19:30:31.275181 [debug] [Thread-3  ]: SQL status: BEGIN in 0.012 seconds
[0m19:30:31.275481 [debug] [Thread-4  ]: Using postgres connection "test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f"
[0m19:30:31.275770 [debug] [Thread-1  ]: SQL status: BEGIN in 0.014 seconds
[0m19:30:31.276073 [debug] [Thread-3  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_valuations_portfolio_id.d5af3e5188"
[0m19:30:31.276388 [debug] [Thread-4  ]: On test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

select
    position_id as unique_field,
    count(*) as n_records

from "bain_analytics"."public"."stg_positions"
where position_id is not null
group by position_id
having count(*) > 1



  
  
      
    ) dbt_internal_test
[0m19:30:31.276746 [debug] [Thread-1  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_valuations_valuation_id.88ca70781d"
[0m19:30:31.277101 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_stg_valuations_portfolio_id.d5af3e5188: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_stg_valuations_portfolio_id.d5af3e5188"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select portfolio_id
from "bain_analytics"."public"."stg_valuations"
where portfolio_id is null



  
  
      
    ) dbt_internal_test
[0m19:30:31.277802 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_stg_valuations_valuation_id.88ca70781d: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_stg_valuations_valuation_id.88ca70781d"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select valuation_id
from "bain_analytics"."public"."stg_valuations"
where valuation_id is null



  
  
      
    ) dbt_internal_test
[0m19:30:31.280086 [debug] [Thread-1  ]: SQL status: SELECT 1 in 0.002 seconds
[0m19:30:31.280549 [debug] [Thread-4  ]: SQL status: SELECT 1 in 0.003 seconds
[0m19:30:31.282633 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_stg_valuations_valuation_id.88ca70781d: ROLLBACK
[0m19:30:31.283042 [debug] [Thread-3  ]: SQL status: SELECT 1 in 0.005 seconds
[0m19:30:31.284304 [debug] [Thread-4  ]: On test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f: ROLLBACK
[0m19:30:31.284734 [debug] [Thread-2  ]: SQL status: BEGIN in 0.012 seconds
[0m19:30:31.285953 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_stg_valuations_portfolio_id.d5af3e5188: ROLLBACK
[0m19:30:31.286312 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_stg_valuations_valuation_id.88ca70781d: Close
[0m19:30:31.286773 [debug] [Thread-2  ]: Using postgres connection "test.bain_capital_analytics.unique_stg_valuations_valuation_id.fce7eb13b5"
[0m19:30:31.287105 [debug] [Thread-4  ]: On test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f: Close
[0m19:30:31.287789 [info ] [Thread-1  ]: 29 of 54 PASS not_null_stg_valuations_valuation_id ............................. [[32mPASS[0m in 0.10s]
[0m19:30:31.288141 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_stg_valuations_portfolio_id.d5af3e5188: Close
[0m19:30:31.288490 [debug] [Thread-2  ]: On test.bain_capital_analytics.unique_stg_valuations_valuation_id.fce7eb13b5: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.unique_stg_valuations_valuation_id.fce7eb13b5"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

select
    valuation_id as unique_field,
    count(*) as n_records

from "bain_analytics"."public"."stg_valuations"
where valuation_id is not null
group by valuation_id
having count(*) > 1



  
  
      
    ) dbt_internal_test
[0m19:30:31.289049 [info ] [Thread-4  ]: 27 of 54 PASS unique_stg_positions_position_id ................................. [[32mPASS[0m in 0.10s]
[0m19:30:31.289573 [debug] [Thread-1  ]: Finished running node test.bain_capital_analytics.not_null_stg_valuations_valuation_id.88ca70781d
[0m19:30:31.290169 [info ] [Thread-3  ]: 28 of 54 PASS not_null_stg_valuations_portfolio_id ............................. [[32mPASS[0m in 0.10s]
[0m19:30:31.290724 [debug] [Thread-4  ]: Finished running node test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f
[0m19:30:31.291159 [debug] [Thread-1  ]: Began running node model.bain_capital_analytics.int_benchmark_returns
[0m19:30:31.291604 [debug] [Thread-3  ]: Finished running node test.bain_capital_analytics.not_null_stg_valuations_portfolio_id.d5af3e5188
[0m19:30:31.292095 [debug] [Thread-4  ]: Began running node model.bain_capital_analytics.int_cashflow_enriched
[0m19:30:31.292663 [info ] [Thread-1  ]: 31 of 54 START sql view model public.int_benchmark_returns ..................... [RUN]
[0m19:30:31.293057 [debug] [Thread-2  ]: SQL status: SELECT 1 in 0.003 seconds
[0m19:30:31.293546 [debug] [Thread-3  ]: Began running node model.bain_capital_analytics.int_portfolio_attribution
[0m19:30:31.294020 [info ] [Thread-4  ]: 32 of 54 START sql view model public.int_cashflow_enriched ..................... [RUN]
[0m19:30:31.294411 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.not_null_stg_valuations_valuation_id.88ca70781d, now model.bain_capital_analytics.int_benchmark_returns)
[0m19:30:31.295594 [debug] [Thread-2  ]: On test.bain_capital_analytics.unique_stg_valuations_valuation_id.fce7eb13b5: ROLLBACK
[0m19:30:31.296092 [info ] [Thread-3  ]: 33 of 54 START sql view model public.int_portfolio_attribution ................. [RUN]
[0m19:30:31.297831 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.not_null_stg_valuations_portfolio_id.d5af3e5188, now model.bain_capital_analytics.int_portfolio_attribution)
[0m19:30:31.296499 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f, now model.bain_capital_analytics.int_cashflow_enriched)
[0m19:30:31.298364 [debug] [Thread-3  ]: Began compiling node model.bain_capital_analytics.int_portfolio_attribution
[0m19:30:31.296837 [debug] [Thread-1  ]: Began compiling node model.bain_capital_analytics.int_benchmark_returns
[0m19:30:31.298847 [debug] [Thread-2  ]: On test.bain_capital_analytics.unique_stg_valuations_valuation_id.fce7eb13b5: Close
[0m19:30:31.299151 [debug] [Thread-4  ]: Began compiling node model.bain_capital_analytics.int_cashflow_enriched
[0m19:30:31.303535 [debug] [Thread-3  ]: Writing injected SQL for node "model.bain_capital_analytics.int_portfolio_attribution"
[0m19:30:31.306683 [debug] [Thread-1  ]: Writing injected SQL for node "model.bain_capital_analytics.int_benchmark_returns"
[0m19:30:31.310574 [debug] [Thread-4  ]: Writing injected SQL for node "model.bain_capital_analytics.int_cashflow_enriched"
[0m19:30:31.311376 [info ] [Thread-2  ]: 30 of 54 PASS unique_stg_valuations_valuation_id ............................... [[32mPASS[0m in 0.05s]
[0m19:30:31.312293 [debug] [Thread-2  ]: Finished running node test.bain_capital_analytics.unique_stg_valuations_valuation_id.fce7eb13b5
[0m19:30:31.312945 [debug] [Thread-3  ]: Began executing node model.bain_capital_analytics.int_portfolio_attribution
[0m19:30:31.313285 [debug] [Thread-4  ]: Began executing node model.bain_capital_analytics.int_cashflow_enriched
[0m19:30:31.313622 [debug] [Thread-2  ]: Began running node model.bain_capital_analytics.int_fund_nav
[0m19:30:31.317140 [debug] [Thread-3  ]: Writing runtime sql for node "model.bain_capital_analytics.int_portfolio_attribution"
[0m19:30:31.317468 [debug] [Thread-1  ]: Began executing node model.bain_capital_analytics.int_benchmark_returns
[0m19:30:31.320790 [debug] [Thread-4  ]: Writing runtime sql for node "model.bain_capital_analytics.int_cashflow_enriched"
[0m19:30:31.321245 [info ] [Thread-2  ]: 34 of 54 START sql view model public.int_fund_nav .............................. [RUN]
[0m19:30:31.325689 [debug] [Thread-1  ]: Writing runtime sql for node "model.bain_capital_analytics.int_benchmark_returns"
[0m19:30:31.326196 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.unique_stg_valuations_valuation_id.fce7eb13b5, now model.bain_capital_analytics.int_fund_nav)
[0m19:30:31.326608 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.int_portfolio_attribution"
[0m19:30:31.327041 [debug] [Thread-2  ]: Began compiling node model.bain_capital_analytics.int_fund_nav
[0m19:30:31.327408 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.int_cashflow_enriched"
[0m19:30:31.327750 [debug] [Thread-3  ]: On model.bain_capital_analytics.int_portfolio_attribution: BEGIN
[0m19:30:31.331174 [debug] [Thread-2  ]: Writing injected SQL for node "model.bain_capital_analytics.int_fund_nav"
[0m19:30:31.331561 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.int_benchmark_returns"
[0m19:30:31.331889 [debug] [Thread-4  ]: On model.bain_capital_analytics.int_cashflow_enriched: BEGIN
[0m19:30:31.332220 [debug] [Thread-3  ]: Opening a new connection, currently in state closed
[0m19:30:31.332623 [debug] [Thread-1  ]: On model.bain_capital_analytics.int_benchmark_returns: BEGIN
[0m19:30:31.332931 [debug] [Thread-4  ]: Opening a new connection, currently in state closed
[0m19:30:31.333389 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m19:30:31.333711 [debug] [Thread-2  ]: Began executing node model.bain_capital_analytics.int_fund_nav
[0m19:30:31.337131 [debug] [Thread-2  ]: Writing runtime sql for node "model.bain_capital_analytics.int_fund_nav"
[0m19:30:31.337759 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.int_fund_nav"
[0m19:30:31.338069 [debug] [Thread-2  ]: On model.bain_capital_analytics.int_fund_nav: BEGIN
[0m19:30:31.338355 [debug] [Thread-2  ]: Opening a new connection, currently in state closed
[0m19:30:31.344453 [debug] [Thread-1  ]: SQL status: BEGIN in 0.011 seconds
[0m19:30:31.344817 [debug] [Thread-3  ]: SQL status: BEGIN in 0.013 seconds
[0m19:30:31.345149 [debug] [Thread-4  ]: SQL status: BEGIN in 0.012 seconds
[0m19:30:31.345479 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.int_benchmark_returns"
[0m19:30:31.345783 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.int_portfolio_attribution"
[0m19:30:31.346131 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.int_cashflow_enriched"
[0m19:30:31.346529 [debug] [Thread-1  ]: On model.bain_capital_analytics.int_benchmark_returns: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.int_benchmark_returns"} */

  create view "bain_analytics"."public"."int_benchmark_returns__dbt_tmp"
    
    
  as (
    -- Pipeline C: Benchmark returns with rolling calculations
-- Anti-pattern: heavy window functions that could be pre-computed

with benchmark_base as (
    select
        b.benchmark_id,
        b.benchmark_name,
        b.benchmark_date,
        b.return_daily,
        b.return_mtd,
        b.return_ytd,
        b.benchmark_level,
        b.benchmark_fiscal_quarter,
        d.fiscal_year,
        d.is_quarter_end,
        d.is_year_end
    from "bain_analytics"."public"."stg_benchmarks" b
    inner join "bain_analytics"."public"."stg_dates" d
        on b.benchmark_date = d.date_day
),

-- Anti-pattern: compute many overlapping windows
benchmark_with_rolling as (
    select
        bb.*,
        -- rolling 3-month return
        exp(sum(ln(1 + bb.return_mtd)) over (
            partition by bb.benchmark_id
            order by bb.benchmark_date
            rows between 2 preceding and current row
        )) - 1 as rolling_3m_return,
        -- rolling 6-month return
        exp(sum(ln(1 + bb.return_mtd)) over (
            partition by bb.benchmark_id
            order by bb.benchmark_date
            rows between 5 preceding and current row
        )) - 1 as rolling_6m_return,
        -- rolling 12-month return
        exp(sum(ln(1 + bb.return_mtd)) over (
            partition by bb.benchmark_id
            order by bb.benchmark_date
            rows between 11 preceding and current row
        )) - 1 as rolling_12m_return,
        -- Anti-pattern: volatility via window (expensive)
        stddev(bb.return_mtd) over (
            partition by bb.benchmark_id
            order by bb.benchmark_date
            rows between 11 preceding and current row
        ) as rolling_12m_volatility,
        avg(bb.return_mtd) over (
            partition by bb.benchmark_id
            order by bb.benchmark_date
            rows between 11 preceding and current row
        ) as rolling_12m_avg_return,
        lag(bb.benchmark_level) over (
            partition by bb.benchmark_id
            order by bb.benchmark_date
        ) as prev_benchmark_level
    from benchmark_base bb
)

select * from benchmark_with_rolling
  );
[0m19:30:31.346931 [debug] [Thread-2  ]: SQL status: BEGIN in 0.009 seconds
[0m19:30:31.347337 [debug] [Thread-3  ]: On model.bain_capital_analytics.int_portfolio_attribution: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.int_portfolio_attribution"} */

  create view "bain_analytics"."public"."int_portfolio_attribution__dbt_tmp"
    
    
  as (
    -- Pipeline C: Portfolio performance attribution by sector and instrument type
-- Anti-pattern: deep CTE chain, repeated joins, late aggregation
-- Anti-pattern: same position-instrument-portfolio joins as int_daily_positions

with positions_enriched as (
    -- Anti-pattern: repeating the same 3-way join as int_daily_positions
    select
        pos.position_id,
        pos.portfolio_id,
        pos.instrument_id,
        pos.position_date,
        pos.quantity,
        pos.market_value,
        pos.cost_basis,
        pos.unrealized_gain_loss,
        i.instrument_name,
        i.instrument_type,
        i.sector,
        p.portfolio_name,
        p.strategy,
        p.fund_id
    from "bain_analytics"."public"."stg_positions" pos
    inner join "bain_analytics"."public"."stg_instruments" i
        on pos.instrument_id = i.instrument_id
    inner join "bain_analytics"."public"."stg_portfolios" p
        on pos.portfolio_id = p.portfolio_id
),

-- Anti-pattern: compute portfolio totals in a separate CTE instead of a single pass
portfolio_totals as (
    select
        portfolio_id,
        position_date,
        sum(market_value) as total_portfolio_mv,
        sum(unrealized_gain_loss) as total_portfolio_ugl
    from positions_enriched
    group by portfolio_id, position_date
),

-- Anti-pattern: sector aggregation in yet another CTE
sector_attribution as (
    select
        pe.portfolio_id,
        pe.portfolio_name,
        pe.strategy,
        pe.fund_id,
        pe.position_date,
        pe.sector,
        sum(pe.market_value) as sector_mv,
        sum(pe.unrealized_gain_loss) as sector_ugl,
        count(distinct pe.instrument_id) as num_instruments
    from positions_enriched pe
    group by
        pe.portfolio_id, pe.portfolio_name, pe.strategy,
        pe.fund_id, pe.position_date, pe.sector
),

-- Anti-pattern: joining back to get weights instead of computing in one pass
attribution_with_weights as (
    select
        sa.*,
        pt.total_portfolio_mv,
        pt.total_portfolio_ugl,
        case
            when pt.total_portfolio_mv != 0
            then sa.sector_mv / pt.total_portfolio_mv
            else 0
        end as sector_weight,
        case
            when pt.total_portfolio_ugl != 0
            then sa.sector_ugl / pt.total_portfolio_ugl
            else 0
        end as sector_contribution
    from sector_attribution sa
    inner join portfolio_totals pt
        on sa.portfolio_id = pt.portfolio_id
        and sa.position_date = pt.position_date
)

select * from attribution_with_weights
  );
[0m19:30:31.347835 [debug] [Thread-4  ]: On model.bain_capital_analytics.int_cashflow_enriched: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.int_cashflow_enriched"} */

  create view "bain_analytics"."public"."int_cashflow_enriched__dbt_tmp"
    
    
  as (
    -- Pipeline C: Enriched cashflow data with fund and portfolio details
-- Anti-pattern: subquery for dedup instead of QUALIFY
-- Anti-pattern: joins repeated from other intermediate models

with cashflow_with_details as (
    select *
    from (
        select
            cf.*,
            p.portfolio_name,
            p.strategy,
            p.manager_name,
            fs.fund_name,
            fs.fund_type,
            fs.committed_capital,
            fs.management_fee_rate,
            fs.carry_rate,
            fs.hurdle_rate,
            -- Anti-pattern: subquery filter instead of QUALIFY
            row_number() over (
                partition by cf.cashflow_id
                order by cf.cashflow_date desc
            ) as rn
        from "bain_analytics"."public"."stg_cashflows" cf
        inner join "bain_analytics"."public"."stg_portfolios" p
            on cf.portfolio_id = p.portfolio_id
        inner join "bain_analytics"."public"."stg_fund_structures" fs
            on cf.fund_id = fs.fund_id
    ) sub
    where rn = 1
),

-- Anti-pattern: running totals computed here AND again downstream
cashflow_cumulative as (
    select
        *,
        sum(case when cashflow_type = 'capital_call' then amount else 0 end) over (
            partition by fund_id, portfolio_id
            order by cashflow_date
            rows between unbounded preceding and current row
        ) as cumulative_called,
        sum(case when cashflow_type = 'distribution' then amount else 0 end) over (
            partition by fund_id, portfolio_id
            order by cashflow_date
            rows between unbounded preceding and current row
        ) as cumulative_distributed,
        sum(amount) over (
            partition by fund_id, portfolio_id
            order by cashflow_date
            rows between unbounded preceding and current row
        ) as cumulative_net_cashflow
    from cashflow_with_details
)

select
    cashflow_id,
    fund_id,
    fund_name,
    fund_type,
    portfolio_id,
    portfolio_name,
    strategy,
    manager_name,
    cashflow_date,
    cashflow_type,
    amount,
    currency,
    description,
    investor_id,
    cashflow_fiscal_quarter,
    cashflow_year,
    committed_capital,
    management_fee_rate,
    carry_rate,
    hurdle_rate,
    cumulative_called,
    cumulative_distributed,
    cumulative_net_cashflow,
    case
        when committed_capital > 0
        then cumulative_called / committed_capital
        else 0
    end as pct_called
from cashflow_cumulative
  );
[0m19:30:31.348371 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.int_fund_nav"
[0m19:30:31.348852 [debug] [Thread-2  ]: On model.bain_capital_analytics.int_fund_nav: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.int_fund_nav"} */

  create view "bain_analytics"."public"."int_fund_nav__dbt_tmp"
    
    
  as (
    -- Pipeline C: Fund-level NAV calculation from portfolio valuations
-- Anti-pattern: late aggregation - joins everything then aggregates at the end
-- Anti-pattern: repeated joins to fund_structures and portfolios

with portfolio_valuations as (
    select
        v.portfolio_id,
        v.valuation_date,
        v.net_asset_value,
        v.gross_asset_value,
        v.total_liabilities,
        v.unrealized_pnl,
        v.realized_pnl,
        v.valuation_method,
        p.fund_id,
        p.portfolio_name,
        p.strategy,
        -- Anti-pattern: joining fund_structures again (already done in int_cashflow_enriched)
        fs.fund_name,
        fs.fund_type,
        fs.committed_capital,
        fs.management_fee_rate
    from "bain_analytics"."public"."stg_valuations" v
    inner join "bain_analytics"."public"."stg_portfolios" p
        on v.portfolio_id = p.portfolio_id
    inner join "bain_analytics"."public"."stg_fund_structures" fs
        on p.fund_id = fs.fund_id
),

-- Anti-pattern: aggregation happens here at the end after all joins
fund_level_nav as (
    select
        fund_id,
        fund_name,
        fund_type,
        committed_capital,
        management_fee_rate,
        valuation_date,
        sum(net_asset_value) as fund_nav,
        sum(gross_asset_value) as fund_gav,
        sum(total_liabilities) as fund_total_liabilities,
        sum(unrealized_pnl) as fund_unrealized_pnl,
        sum(realized_pnl) as fund_realized_pnl,
        count(distinct portfolio_id) as num_portfolios
    from portfolio_valuations
    group by
        fund_id, fund_name, fund_type, committed_capital,
        management_fee_rate, valuation_date
),

fund_nav_with_changes as (
    select
        fn.*,
        lag(fn.fund_nav) over (
            partition by fn.fund_id order by fn.valuation_date
        ) as prev_fund_nav,
        case
            when lag(fn.fund_nav) over (
                partition by fn.fund_id order by fn.valuation_date
            ) is not null
            and lag(fn.fund_nav) over (
                partition by fn.fund_id order by fn.valuation_date
            ) != 0
            then (fn.fund_nav - lag(fn.fund_nav) over (
                partition by fn.fund_id order by fn.valuation_date
            )) / lag(fn.fund_nav) over (
                partition by fn.fund_id order by fn.valuation_date
            )
            else null
        end as fund_nav_return,
        fn.fund_nav / nullif(fn.committed_capital, 0) as tvpi_gross
    from fund_level_nav fn
)

select * from fund_nav_with_changes
  );
[0m19:30:31.352301 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.004 seconds
[0m19:30:31.355454 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.int_benchmark_returns"
[0m19:30:31.355793 [debug] [Thread-1  ]: On model.bain_capital_analytics.int_benchmark_returns: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.int_benchmark_returns"} */
alter table "bain_analytics"."public"."int_benchmark_returns__dbt_tmp" rename to "int_benchmark_returns"
[0m19:30:31.356128 [debug] [Thread-3  ]: SQL status: CREATE VIEW in 0.007 seconds
[0m19:30:31.356459 [debug] [Thread-2  ]: SQL status: CREATE VIEW in 0.007 seconds
[0m19:30:31.356739 [debug] [Thread-4  ]: SQL status: CREATE VIEW in 0.008 seconds
[0m19:30:31.359450 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.int_portfolio_attribution"
[0m19:30:31.359779 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.003 seconds
[0m19:30:31.363387 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.int_fund_nav"
[0m19:30:31.366148 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.int_cashflow_enriched"
[0m19:30:31.366498 [debug] [Thread-3  ]: On model.bain_capital_analytics.int_portfolio_attribution: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.int_portfolio_attribution"} */
alter table "bain_analytics"."public"."int_portfolio_attribution__dbt_tmp" rename to "int_portfolio_attribution"
[0m19:30:31.367557 [debug] [Thread-1  ]: On model.bain_capital_analytics.int_benchmark_returns: COMMIT
[0m19:30:31.367885 [debug] [Thread-2  ]: On model.bain_capital_analytics.int_fund_nav: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.int_fund_nav"} */
alter table "bain_analytics"."public"."int_fund_nav__dbt_tmp" rename to "int_fund_nav"
[0m19:30:31.368203 [debug] [Thread-4  ]: On model.bain_capital_analytics.int_cashflow_enriched: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.int_cashflow_enriched"} */
alter table "bain_analytics"."public"."int_cashflow_enriched__dbt_tmp" rename to "int_cashflow_enriched"
[0m19:30:31.368560 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.int_benchmark_returns"
[0m19:30:31.368957 [debug] [Thread-1  ]: On model.bain_capital_analytics.int_benchmark_returns: COMMIT
[0m19:30:31.369278 [debug] [Thread-3  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m19:30:31.369599 [debug] [Thread-2  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m19:30:31.369909 [debug] [Thread-4  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m19:30:31.370855 [debug] [Thread-3  ]: On model.bain_capital_analytics.int_portfolio_attribution: COMMIT
[0m19:30:31.371163 [debug] [Thread-1  ]: SQL status: COMMIT in 0.002 seconds
[0m19:30:31.372102 [debug] [Thread-2  ]: On model.bain_capital_analytics.int_fund_nav: COMMIT
[0m19:30:31.373044 [debug] [Thread-4  ]: On model.bain_capital_analytics.int_cashflow_enriched: COMMIT
[0m19:30:31.373360 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.int_portfolio_attribution"
[0m19:30:31.375725 [debug] [Thread-1  ]: Applying DROP to: "bain_analytics"."public"."int_benchmark_returns__dbt_backup"
[0m19:30:31.376050 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.int_fund_nav"
[0m19:30:31.376358 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.int_cashflow_enriched"
[0m19:30:31.376669 [debug] [Thread-3  ]: On model.bain_capital_analytics.int_portfolio_attribution: COMMIT
[0m19:30:31.377116 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.int_benchmark_returns"
[0m19:30:31.377429 [debug] [Thread-2  ]: On model.bain_capital_analytics.int_fund_nav: COMMIT
[0m19:30:31.377741 [debug] [Thread-4  ]: On model.bain_capital_analytics.int_cashflow_enriched: COMMIT
[0m19:30:31.378102 [debug] [Thread-1  ]: On model.bain_capital_analytics.int_benchmark_returns: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.int_benchmark_returns"} */
drop view if exists "bain_analytics"."public"."int_benchmark_returns__dbt_backup" cascade
[0m19:30:31.378531 [debug] [Thread-3  ]: SQL status: COMMIT in 0.000 seconds
[0m19:30:31.378816 [debug] [Thread-2  ]: SQL status: COMMIT in 0.000 seconds
[0m19:30:31.379117 [debug] [Thread-4  ]: SQL status: COMMIT in 0.001 seconds
[0m19:30:31.379418 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.000 seconds
[0m19:30:31.381642 [debug] [Thread-3  ]: Applying DROP to: "bain_analytics"."public"."int_portfolio_attribution__dbt_backup"
[0m19:30:31.383840 [debug] [Thread-2  ]: Applying DROP to: "bain_analytics"."public"."int_fund_nav__dbt_backup"
[0m19:30:31.386704 [debug] [Thread-4  ]: Applying DROP to: "bain_analytics"."public"."int_cashflow_enriched__dbt_backup"
[0m19:30:31.387726 [debug] [Thread-1  ]: On model.bain_capital_analytics.int_benchmark_returns: Close
[0m19:30:31.388197 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.int_portfolio_attribution"
[0m19:30:31.388643 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.int_fund_nav"
[0m19:30:31.389097 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.int_cashflow_enriched"
[0m19:30:31.389604 [debug] [Thread-3  ]: On model.bain_capital_analytics.int_portfolio_attribution: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.int_portfolio_attribution"} */
drop view if exists "bain_analytics"."public"."int_portfolio_attribution__dbt_backup" cascade
[0m19:30:31.389959 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e99c23a0-888a-42fd-99a1-6f1a129790e4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10aca7670>]}
[0m19:30:31.390287 [debug] [Thread-2  ]: On model.bain_capital_analytics.int_fund_nav: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.int_fund_nav"} */
drop view if exists "bain_analytics"."public"."int_fund_nav__dbt_backup" cascade
[0m19:30:31.390604 [debug] [Thread-4  ]: On model.bain_capital_analytics.int_cashflow_enriched: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.int_cashflow_enriched"} */
drop view if exists "bain_analytics"."public"."int_cashflow_enriched__dbt_backup" cascade
[0m19:30:31.391326 [info ] [Thread-1  ]: 31 of 54 OK created sql view model public.int_benchmark_returns ................ [[32mCREATE VIEW[0m in 0.10s]
[0m19:30:31.391678 [debug] [Thread-3  ]: SQL status: DROP VIEW in 0.001 seconds
[0m19:30:31.392174 [debug] [Thread-1  ]: Finished running node model.bain_capital_analytics.int_benchmark_returns
[0m19:30:31.392487 [debug] [Thread-4  ]: SQL status: DROP VIEW in 0.000 seconds
[0m19:30:31.393452 [debug] [Thread-3  ]: On model.bain_capital_analytics.int_portfolio_attribution: Close
[0m19:30:31.393736 [debug] [Thread-2  ]: SQL status: DROP VIEW in 0.002 seconds
[0m19:30:31.394077 [debug] [Thread-1  ]: Began running node model.bain_capital_analytics.int_irr_calculations
[0m19:30:31.395168 [debug] [Thread-4  ]: On model.bain_capital_analytics.int_cashflow_enriched: Close
[0m19:30:31.396213 [debug] [Thread-2  ]: On model.bain_capital_analytics.int_fund_nav: Close
[0m19:30:31.396652 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e99c23a0-888a-42fd-99a1-6f1a129790e4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b1cbe20>]}
[0m19:30:31.397053 [info ] [Thread-1  ]: 35 of 54 START sql view model public.int_irr_calculations ...................... [RUN]
[0m19:30:31.397502 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e99c23a0-888a-42fd-99a1-6f1a129790e4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10afa1a30>]}
[0m19:30:31.398001 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e99c23a0-888a-42fd-99a1-6f1a129790e4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b1f8430>]}
[0m19:30:31.398446 [info ] [Thread-3  ]: 33 of 54 OK created sql view model public.int_portfolio_attribution ............ [[32mCREATE VIEW[0m in 0.10s]
[0m19:30:31.398899 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.bain_capital_analytics.int_benchmark_returns, now model.bain_capital_analytics.int_irr_calculations)
[0m19:30:31.399456 [info ] [Thread-4  ]: 32 of 54 OK created sql view model public.int_cashflow_enriched ................ [[32mCREATE VIEW[0m in 0.10s]
[0m19:30:31.399943 [info ] [Thread-2  ]: 34 of 54 OK created sql view model public.int_fund_nav ......................... [[32mCREATE VIEW[0m in 0.07s]
[0m19:30:31.400401 [debug] [Thread-3  ]: Finished running node model.bain_capital_analytics.int_portfolio_attribution
[0m19:30:31.400705 [debug] [Thread-1  ]: Began compiling node model.bain_capital_analytics.int_irr_calculations
[0m19:30:31.401112 [debug] [Thread-4  ]: Finished running node model.bain_capital_analytics.int_cashflow_enriched
[0m19:30:31.401530 [debug] [Thread-2  ]: Finished running node model.bain_capital_analytics.int_fund_nav
[0m19:30:31.401852 [debug] [Thread-3  ]: Began running node model.bain_capital_analytics.int_valuation_enriched
[0m19:30:31.405868 [debug] [Thread-1  ]: Writing injected SQL for node "model.bain_capital_analytics.int_irr_calculations"
[0m19:30:31.406288 [debug] [Thread-4  ]: Began running node test.bain_capital_analytics.not_null_int_benchmark_returns_benchmark_id.fa96f53b44
[0m19:30:31.406668 [debug] [Thread-2  ]: Began running node test.bain_capital_analytics.not_null_int_portfolio_attribution_portfolio_id.3e04b7c210
[0m19:30:31.407168 [info ] [Thread-3  ]: 36 of 54 START sql view model public.int_valuation_enriched .................... [RUN]
[0m19:30:31.407658 [info ] [Thread-4  ]: 37 of 54 START test not_null_int_benchmark_returns_benchmark_id ................ [RUN]
[0m19:30:31.408039 [info ] [Thread-2  ]: 38 of 54 START test not_null_int_portfolio_attribution_portfolio_id ............ [RUN]
[0m19:30:31.408431 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly model.bain_capital_analytics.int_portfolio_attribution, now model.bain_capital_analytics.int_valuation_enriched)
[0m19:30:31.408761 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly model.bain_capital_analytics.int_cashflow_enriched, now test.bain_capital_analytics.not_null_int_benchmark_returns_benchmark_id.fa96f53b44)
[0m19:30:31.409123 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly model.bain_capital_analytics.int_fund_nav, now test.bain_capital_analytics.not_null_int_portfolio_attribution_portfolio_id.3e04b7c210)
[0m19:30:31.409454 [debug] [Thread-3  ]: Began compiling node model.bain_capital_analytics.int_valuation_enriched
[0m19:30:31.409756 [debug] [Thread-1  ]: Began executing node model.bain_capital_analytics.int_irr_calculations
[0m19:30:31.410037 [debug] [Thread-4  ]: Began compiling node test.bain_capital_analytics.not_null_int_benchmark_returns_benchmark_id.fa96f53b44
[0m19:30:31.410332 [debug] [Thread-2  ]: Began compiling node test.bain_capital_analytics.not_null_int_portfolio_attribution_portfolio_id.3e04b7c210
[0m19:30:31.413220 [debug] [Thread-3  ]: Writing injected SQL for node "model.bain_capital_analytics.int_valuation_enriched"
[0m19:30:31.416662 [debug] [Thread-1  ]: Writing runtime sql for node "model.bain_capital_analytics.int_irr_calculations"
[0m19:30:31.420317 [debug] [Thread-4  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_int_benchmark_returns_benchmark_id.fa96f53b44"
[0m19:30:31.423623 [debug] [Thread-2  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_int_portfolio_attribution_portfolio_id.3e04b7c210"
[0m19:30:31.424417 [debug] [Thread-3  ]: Began executing node model.bain_capital_analytics.int_valuation_enriched
[0m19:30:31.424773 [debug] [Thread-2  ]: Began executing node test.bain_capital_analytics.not_null_int_portfolio_attribution_portfolio_id.3e04b7c210
[0m19:30:31.425185 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.int_irr_calculations"
[0m19:30:31.425506 [debug] [Thread-4  ]: Began executing node test.bain_capital_analytics.not_null_int_benchmark_returns_benchmark_id.fa96f53b44
[0m19:30:31.429865 [debug] [Thread-3  ]: Writing runtime sql for node "model.bain_capital_analytics.int_valuation_enriched"
[0m19:30:31.432097 [debug] [Thread-2  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_int_portfolio_attribution_portfolio_id.3e04b7c210"
[0m19:30:31.432433 [debug] [Thread-1  ]: On model.bain_capital_analytics.int_irr_calculations: BEGIN
[0m19:30:31.434636 [debug] [Thread-4  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_int_benchmark_returns_benchmark_id.fa96f53b44"
[0m19:30:31.435128 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m19:30:31.435779 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.int_valuation_enriched"
[0m19:30:31.436130 [debug] [Thread-4  ]: Using postgres connection "test.bain_capital_analytics.not_null_int_benchmark_returns_benchmark_id.fa96f53b44"
[0m19:30:31.436538 [debug] [Thread-2  ]: Using postgres connection "test.bain_capital_analytics.not_null_int_portfolio_attribution_portfolio_id.3e04b7c210"
[0m19:30:31.436831 [debug] [Thread-3  ]: On model.bain_capital_analytics.int_valuation_enriched: BEGIN
[0m19:30:31.437137 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_int_benchmark_returns_benchmark_id.fa96f53b44: BEGIN
[0m19:30:31.437448 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_int_portfolio_attribution_portfolio_id.3e04b7c210: BEGIN
[0m19:30:31.437742 [debug] [Thread-3  ]: Opening a new connection, currently in state closed
[0m19:30:31.438053 [debug] [Thread-4  ]: Opening a new connection, currently in state closed
[0m19:30:31.438360 [debug] [Thread-2  ]: Opening a new connection, currently in state closed
[0m19:30:31.443815 [debug] [Thread-1  ]: SQL status: BEGIN in 0.009 seconds
[0m19:30:31.444147 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.int_irr_calculations"
[0m19:30:31.444580 [debug] [Thread-1  ]: On model.bain_capital_analytics.int_irr_calculations: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.int_irr_calculations"} */

  create view "bain_analytics"."public"."int_irr_calculations__dbt_tmp"
    
    
  as (
    -- Pipeline C: Approximate IRR calculation per fund/portfolio
-- Anti-pattern: extremely deep CTE nesting (6 levels)
-- Anti-pattern: PostgreSQL-specific date arithmetic
-- Anti-pattern: complex logic that should be a macro

with cashflow_series as (
    -- CTE level 1: get all cashflows with proper signs
    select
        cf.fund_id,
        cf.portfolio_id,
        cf.cashflow_date,
        cf.cashflow_type,
        case
            when cf.cashflow_type = 'capital_call' then -1 * abs(cf.amount)
            when cf.cashflow_type = 'distribution' then abs(cf.amount)
            when cf.cashflow_type = 'management_fee' then -1 * abs(cf.amount)
            else cf.amount
        end as signed_amount
    from "bain_analytics"."public"."stg_cashflows" cf
),

terminal_values as (
    -- CTE level 2: get latest NAV as terminal cashflow
    select
        v.portfolio_id,
        p.fund_id,
        v.valuation_date as cashflow_date,
        'terminal_value' as cashflow_type,
        v.net_asset_value as signed_amount
    from "bain_analytics"."public"."stg_valuations" v
    inner join "bain_analytics"."public"."stg_portfolios" p
        on v.portfolio_id = p.portfolio_id
    where v.valuation_date = (
        -- Anti-pattern: correlated subquery instead of window function
        select max(v2.valuation_date)
        from "bain_analytics"."public"."stg_valuations" v2
        where v2.portfolio_id = v.portfolio_id
    )
),

all_cashflows as (
    -- CTE level 3: union cashflows and terminal values
    select fund_id, portfolio_id, cashflow_date, cashflow_type, signed_amount
    from cashflow_series
    union all
    select fund_id, portfolio_id, cashflow_date, cashflow_type, signed_amount
    from terminal_values
),

cashflow_with_timing as (
    -- CTE level 4: compute time fractions
    -- Anti-pattern: PostgreSQL date subtraction
    select
        ac.*,
        min(ac.cashflow_date) over (partition by ac.fund_id, ac.portfolio_id) as first_cf_date,
        (ac.cashflow_date - min(ac.cashflow_date) over (partition by ac.fund_id, ac.portfolio_id))::numeric / 365.25 as year_fraction
    from all_cashflows ac
),

-- CTE level 5: compute simple multiples as IRR proxy
portfolio_multiples as (
    select
        fund_id,
        portfolio_id,
        min(cashflow_date) as first_cashflow_date,
        max(cashflow_date) as last_cashflow_date,
        -- Anti-pattern: PostgreSQL date subtraction
        max(cashflow_date) - min(cashflow_date) as investment_days,
        (max(cashflow_date) - min(cashflow_date))::numeric / 365.25 as investment_years,
        sum(case when cashflow_type = 'capital_call' then abs(signed_amount) else 0 end) as total_invested,
        sum(case when cashflow_type = 'distribution' then signed_amount else 0 end) as total_distributed,
        sum(case when cashflow_type = 'terminal_value' then signed_amount else 0 end) as terminal_value,
        sum(signed_amount) as net_cashflow
    from cashflow_with_timing
    group by fund_id, portfolio_id
),

-- CTE level 6: compute IRR approximation
irr_approximation as (
    select
        pm.*,
        case
            when pm.total_invested > 0
            then (pm.total_distributed + pm.terminal_value) / pm.total_invested
            else null
        end as tvpi,
        case
            when pm.total_invested > 0
            then pm.total_distributed / pm.total_invested
            else null
        end as dpi,
        case
            when pm.total_invested > 0
            then pm.terminal_value / pm.total_invested
            else null
        end as rvpi,
        -- Simplified IRR approximation: (TVPI^(1/years)) - 1
        case
            when pm.total_invested > 0 and pm.investment_years > 0
            then power(
                (pm.total_distributed + pm.terminal_value) / pm.total_invested,
                1.0 / pm.investment_years
            ) - 1
            else null
        end as approx_irr
    from portfolio_multiples pm
)

select * from irr_approximation
  );
[0m19:30:31.448528 [debug] [Thread-4  ]: SQL status: BEGIN in 0.010 seconds
[0m19:30:31.448874 [debug] [Thread-2  ]: SQL status: BEGIN in 0.010 seconds
[0m19:30:31.449181 [debug] [Thread-4  ]: Using postgres connection "test.bain_capital_analytics.not_null_int_benchmark_returns_benchmark_id.fa96f53b44"
[0m19:30:31.449469 [debug] [Thread-3  ]: SQL status: BEGIN in 0.012 seconds
[0m19:30:31.449772 [debug] [Thread-2  ]: Using postgres connection "test.bain_capital_analytics.not_null_int_portfolio_attribution_portfolio_id.3e04b7c210"
[0m19:30:31.450096 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_int_benchmark_returns_benchmark_id.fa96f53b44: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_int_benchmark_returns_benchmark_id.fa96f53b44"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select benchmark_id
from "bain_analytics"."public"."int_benchmark_returns"
where benchmark_id is null



  
  
      
    ) dbt_internal_test
[0m19:30:31.450451 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.int_valuation_enriched"
[0m19:30:31.450820 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.006 seconds
[0m19:30:31.451144 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_int_portfolio_attribution_portfolio_id.3e04b7c210: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_int_portfolio_attribution_portfolio_id.3e04b7c210"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select portfolio_id
from "bain_analytics"."public"."int_portfolio_attribution"
where portfolio_id is null



  
  
      
    ) dbt_internal_test
[0m19:30:31.451600 [debug] [Thread-3  ]: On model.bain_capital_analytics.int_valuation_enriched: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.int_valuation_enriched"} */

  create view "bain_analytics"."public"."int_valuation_enriched__dbt_tmp"
    
    
  as (
    -- Pipeline C: Enriched valuation data
-- Anti-pattern: subquery for dedup instead of QUALIFY
-- Anti-pattern: repeated portfolio join
-- Anti-pattern: PostgreSQL-specific date functions

with valuation_ranked as (
    select *
    from (
        select
            v.*,
            p.portfolio_name,
            p.strategy,
            p.fund_id,
            p.manager_name,
            -- Anti-pattern: subquery dedup instead of QUALIFY
            row_number() over (
                partition by v.portfolio_id, v.valuation_date
                order by v.valuation_id desc
            ) as rn
        from "bain_analytics"."public"."stg_valuations" v
        inner join "bain_analytics"."public"."stg_portfolios" p
            on v.portfolio_id = p.portfolio_id
    ) sub
    where rn = 1
),

valuation_with_changes as (
    select
        vr.*,
        lag(vr.net_asset_value) over (
            partition by vr.portfolio_id order by vr.valuation_date
        ) as prev_nav,
        case
            when lag(vr.net_asset_value) over (
                partition by vr.portfolio_id order by vr.valuation_date
            ) is not null
            and lag(vr.net_asset_value) over (
                partition by vr.portfolio_id order by vr.valuation_date
            ) != 0
            then (vr.net_asset_value - lag(vr.net_asset_value) over (
                partition by vr.portfolio_id order by vr.valuation_date
            )) / lag(vr.net_asset_value) over (
                partition by vr.portfolio_id order by vr.valuation_date
            )
            else null
        end as nav_return_pct,
        -- Anti-pattern: PostgreSQL date subtraction
        vr.valuation_date - lag(vr.valuation_date) over (
            partition by vr.portfolio_id order by vr.valuation_date
        ) as days_between_valuations
    from valuation_ranked vr
)

select * from valuation_with_changes
  );
[0m19:30:31.454817 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.int_irr_calculations"
[0m19:30:31.455186 [debug] [Thread-4  ]: SQL status: SELECT 1 in 0.004 seconds
[0m19:30:31.455557 [debug] [Thread-1  ]: On model.bain_capital_analytics.int_irr_calculations: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.int_irr_calculations"} */
alter table "bain_analytics"."public"."int_irr_calculations__dbt_tmp" rename to "int_irr_calculations"
[0m19:30:31.456755 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_int_benchmark_returns_benchmark_id.fa96f53b44: ROLLBACK
[0m19:30:31.457387 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_int_benchmark_returns_benchmark_id.fa96f53b44: Close
[0m19:30:31.457912 [info ] [Thread-4  ]: 37 of 54 PASS not_null_int_benchmark_returns_benchmark_id ...................... [[32mPASS[0m in 0.05s]
[0m19:30:31.458286 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m19:30:31.458738 [debug] [Thread-4  ]: Finished running node test.bain_capital_analytics.not_null_int_benchmark_returns_benchmark_id.fa96f53b44
[0m19:30:31.459834 [debug] [Thread-1  ]: On model.bain_capital_analytics.int_irr_calculations: COMMIT
[0m19:30:31.460145 [debug] [Thread-2  ]: SQL status: SELECT 1 in 0.005 seconds
[0m19:30:31.460433 [debug] [Thread-3  ]: SQL status: CREATE VIEW in 0.005 seconds
[0m19:30:31.460775 [debug] [Thread-4  ]: Began running node test.bain_capital_analytics.not_null_int_cashflow_enriched_cashflow_id.8460e9066d
[0m19:30:31.461167 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.int_irr_calculations"
[0m19:30:31.462349 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_int_portfolio_attribution_portfolio_id.3e04b7c210: ROLLBACK
[0m19:30:31.465258 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.int_valuation_enriched"
[0m19:30:31.465669 [info ] [Thread-4  ]: 39 of 54 START test not_null_int_cashflow_enriched_cashflow_id ................. [RUN]
[0m19:30:31.466015 [debug] [Thread-1  ]: On model.bain_capital_analytics.int_irr_calculations: COMMIT
[0m19:30:31.466374 [debug] [Thread-3  ]: On model.bain_capital_analytics.int_valuation_enriched: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.int_valuation_enriched"} */
alter table "bain_analytics"."public"."int_valuation_enriched__dbt_tmp" rename to "int_valuation_enriched"
[0m19:30:31.466691 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_int_portfolio_attribution_portfolio_id.3e04b7c210: Close
[0m19:30:31.467039 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.not_null_int_benchmark_returns_benchmark_id.fa96f53b44, now test.bain_capital_analytics.not_null_int_cashflow_enriched_cashflow_id.8460e9066d)
[0m19:30:31.467587 [info ] [Thread-2  ]: 38 of 54 PASS not_null_int_portfolio_attribution_portfolio_id .................. [[32mPASS[0m in 0.06s]
[0m19:30:31.467949 [debug] [Thread-4  ]: Began compiling node test.bain_capital_analytics.not_null_int_cashflow_enriched_cashflow_id.8460e9066d
[0m19:30:31.468244 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m19:30:31.468542 [debug] [Thread-3  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m19:30:31.468963 [debug] [Thread-2  ]: Finished running node test.bain_capital_analytics.not_null_int_portfolio_attribution_portfolio_id.3e04b7c210
[0m19:30:31.473980 [debug] [Thread-4  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_int_cashflow_enriched_cashflow_id.8460e9066d"
[0m19:30:31.476313 [debug] [Thread-1  ]: Applying DROP to: "bain_analytics"."public"."int_irr_calculations__dbt_backup"
[0m19:30:31.477335 [debug] [Thread-3  ]: On model.bain_capital_analytics.int_valuation_enriched: COMMIT
[0m19:30:31.477679 [debug] [Thread-2  ]: Began running node test.bain_capital_analytics.unique_int_cashflow_enriched_cashflow_id.6944893c17
[0m19:30:31.478363 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.int_irr_calculations"
[0m19:30:31.478676 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.int_valuation_enriched"
[0m19:30:31.479317 [debug] [Thread-4  ]: Began executing node test.bain_capital_analytics.not_null_int_cashflow_enriched_cashflow_id.8460e9066d
[0m19:30:31.479038 [info ] [Thread-2  ]: 40 of 54 START test unique_int_cashflow_enriched_cashflow_id ................... [RUN]
[0m19:30:31.479696 [debug] [Thread-1  ]: On model.bain_capital_analytics.int_irr_calculations: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.int_irr_calculations"} */
drop view if exists "bain_analytics"."public"."int_irr_calculations__dbt_backup" cascade
[0m19:30:31.480001 [debug] [Thread-3  ]: On model.bain_capital_analytics.int_valuation_enriched: COMMIT
[0m19:30:31.482466 [debug] [Thread-4  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_int_cashflow_enriched_cashflow_id.8460e9066d"
[0m19:30:31.482837 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.not_null_int_portfolio_attribution_portfolio_id.3e04b7c210, now test.bain_capital_analytics.unique_int_cashflow_enriched_cashflow_id.6944893c17)
[0m19:30:31.483309 [debug] [Thread-2  ]: Began compiling node test.bain_capital_analytics.unique_int_cashflow_enriched_cashflow_id.6944893c17
[0m19:30:31.486892 [debug] [Thread-2  ]: Writing injected SQL for node "test.bain_capital_analytics.unique_int_cashflow_enriched_cashflow_id.6944893c17"
[0m19:30:31.487240 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.004 seconds
[0m19:30:31.487546 [debug] [Thread-3  ]: SQL status: COMMIT in 0.004 seconds
[0m19:30:31.488726 [debug] [Thread-1  ]: On model.bain_capital_analytics.int_irr_calculations: Close
[0m19:30:31.489084 [debug] [Thread-4  ]: Using postgres connection "test.bain_capital_analytics.not_null_int_cashflow_enriched_cashflow_id.8460e9066d"
[0m19:30:31.491353 [debug] [Thread-3  ]: Applying DROP to: "bain_analytics"."public"."int_valuation_enriched__dbt_backup"
[0m19:30:31.491829 [debug] [Thread-2  ]: Began executing node test.bain_capital_analytics.unique_int_cashflow_enriched_cashflow_id.6944893c17
[0m19:30:31.492348 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_int_cashflow_enriched_cashflow_id.8460e9066d: BEGIN
[0m19:30:31.492683 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e99c23a0-888a-42fd-99a1-6f1a129790e4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b3a2ee0>]}
[0m19:30:31.493202 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.int_valuation_enriched"
[0m19:30:31.495563 [debug] [Thread-2  ]: Writing runtime sql for node "test.bain_capital_analytics.unique_int_cashflow_enriched_cashflow_id.6944893c17"
[0m19:30:31.495882 [debug] [Thread-4  ]: Opening a new connection, currently in state closed
[0m19:30:31.496310 [debug] [Thread-3  ]: On model.bain_capital_analytics.int_valuation_enriched: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.int_valuation_enriched"} */
drop view if exists "bain_analytics"."public"."int_valuation_enriched__dbt_backup" cascade
[0m19:30:31.496811 [info ] [Thread-1  ]: 35 of 54 OK created sql view model public.int_irr_calculations ................. [[32mCREATE VIEW[0m in 0.09s]
[0m19:30:31.497549 [debug] [Thread-1  ]: Finished running node model.bain_capital_analytics.int_irr_calculations
[0m19:30:31.497900 [debug] [Thread-2  ]: Using postgres connection "test.bain_capital_analytics.unique_int_cashflow_enriched_cashflow_id.6944893c17"
[0m19:30:31.498202 [debug] [Thread-3  ]: SQL status: DROP VIEW in 0.001 seconds
[0m19:30:31.498532 [debug] [Thread-1  ]: Began running node test.bain_capital_analytics.not_null_int_fund_nav_fund_id.ebf0b6cc99
[0m19:30:31.498896 [debug] [Thread-2  ]: On test.bain_capital_analytics.unique_int_cashflow_enriched_cashflow_id.6944893c17: BEGIN
[0m19:30:31.500174 [debug] [Thread-3  ]: On model.bain_capital_analytics.int_valuation_enriched: Close
[0m19:30:31.500521 [info ] [Thread-1  ]: 41 of 54 START test not_null_int_fund_nav_fund_id .............................. [RUN]
[0m19:30:31.500868 [debug] [Thread-2  ]: Opening a new connection, currently in state closed
[0m19:30:31.501264 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.bain_capital_analytics.int_irr_calculations, now test.bain_capital_analytics.not_null_int_fund_nav_fund_id.ebf0b6cc99)
[0m19:30:31.501727 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e99c23a0-888a-42fd-99a1-6f1a129790e4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b56f2e0>]}
[0m19:30:31.502128 [debug] [Thread-1  ]: Began compiling node test.bain_capital_analytics.not_null_int_fund_nav_fund_id.ebf0b6cc99
[0m19:30:31.507575 [debug] [Thread-1  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_int_fund_nav_fund_id.ebf0b6cc99"
[0m19:30:31.502721 [info ] [Thread-3  ]: 36 of 54 OK created sql view model public.int_valuation_enriched ............... [[32mCREATE VIEW[0m in 0.09s]
[0m19:30:31.508246 [debug] [Thread-3  ]: Finished running node model.bain_capital_analytics.int_valuation_enriched
[0m19:30:31.508592 [debug] [Thread-4  ]: SQL status: BEGIN in 0.013 seconds
[0m19:30:31.508922 [debug] [Thread-3  ]: Began running node model.bain_capital_analytics.fact_portfolio_attribution
[0m19:30:31.509266 [debug] [Thread-4  ]: Using postgres connection "test.bain_capital_analytics.not_null_int_cashflow_enriched_cashflow_id.8460e9066d"
[0m19:30:31.509733 [debug] [Thread-2  ]: SQL status: BEGIN in 0.009 seconds
[0m19:30:31.510152 [info ] [Thread-3  ]: 42 of 54 START sql view model public.fact_portfolio_attribution ................ [RUN]
[0m19:30:31.510479 [debug] [Thread-1  ]: Began executing node test.bain_capital_analytics.not_null_int_fund_nav_fund_id.ebf0b6cc99
[0m19:30:31.510814 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_int_cashflow_enriched_cashflow_id.8460e9066d: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_int_cashflow_enriched_cashflow_id.8460e9066d"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select cashflow_id
from "bain_analytics"."public"."int_cashflow_enriched"
where cashflow_id is null



  
  
      
    ) dbt_internal_test
[0m19:30:31.511134 [debug] [Thread-2  ]: Using postgres connection "test.bain_capital_analytics.unique_int_cashflow_enriched_cashflow_id.6944893c17"
[0m19:30:31.511475 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly model.bain_capital_analytics.int_valuation_enriched, now model.bain_capital_analytics.fact_portfolio_attribution)
[0m19:30:31.513784 [debug] [Thread-1  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_int_fund_nav_fund_id.ebf0b6cc99"
[0m19:30:31.514161 [debug] [Thread-2  ]: On test.bain_capital_analytics.unique_int_cashflow_enriched_cashflow_id.6944893c17: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.unique_int_cashflow_enriched_cashflow_id.6944893c17"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

select
    cashflow_id as unique_field,
    count(*) as n_records

from "bain_analytics"."public"."int_cashflow_enriched"
where cashflow_id is not null
group by cashflow_id
having count(*) > 1



  
  
      
    ) dbt_internal_test
[0m19:30:31.514493 [debug] [Thread-3  ]: Began compiling node model.bain_capital_analytics.fact_portfolio_attribution
[0m19:30:31.517881 [debug] [Thread-3  ]: Writing injected SQL for node "model.bain_capital_analytics.fact_portfolio_attribution"
[0m19:30:31.518242 [debug] [Thread-4  ]: SQL status: SELECT 1 in 0.004 seconds
[0m19:30:31.518626 [debug] [Thread-1  ]: Using postgres connection "test.bain_capital_analytics.not_null_int_fund_nav_fund_id.ebf0b6cc99"
[0m19:30:31.518968 [debug] [Thread-2  ]: SQL status: SELECT 1 in 0.004 seconds
[0m19:30:31.520230 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_int_cashflow_enriched_cashflow_id.8460e9066d: ROLLBACK
[0m19:30:31.520559 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_int_fund_nav_fund_id.ebf0b6cc99: BEGIN
[0m19:30:31.521673 [debug] [Thread-2  ]: On test.bain_capital_analytics.unique_int_cashflow_enriched_cashflow_id.6944893c17: ROLLBACK
[0m19:30:31.522012 [debug] [Thread-3  ]: Began executing node model.bain_capital_analytics.fact_portfolio_attribution
[0m19:30:31.522338 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m19:30:31.522631 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_int_cashflow_enriched_cashflow_id.8460e9066d: Close
[0m19:30:31.526002 [debug] [Thread-3  ]: Writing runtime sql for node "model.bain_capital_analytics.fact_portfolio_attribution"
[0m19:30:31.526314 [debug] [Thread-2  ]: On test.bain_capital_analytics.unique_int_cashflow_enriched_cashflow_id.6944893c17: Close
[0m19:30:31.526887 [info ] [Thread-4  ]: 39 of 54 PASS not_null_int_cashflow_enriched_cashflow_id ....................... [[32mPASS[0m in 0.06s]
[0m19:30:31.527445 [info ] [Thread-2  ]: 40 of 54 PASS unique_int_cashflow_enriched_cashflow_id ......................... [[32mPASS[0m in 0.04s]
[0m19:30:31.527911 [debug] [Thread-4  ]: Finished running node test.bain_capital_analytics.not_null_int_cashflow_enriched_cashflow_id.8460e9066d
[0m19:30:31.528382 [debug] [Thread-2  ]: Finished running node test.bain_capital_analytics.unique_int_cashflow_enriched_cashflow_id.6944893c17
[0m19:30:31.528784 [debug] [Thread-4  ]: Began running node test.bain_capital_analytics.not_null_int_irr_calculations_fund_id.35702f5be3
[0m19:30:31.529197 [debug] [Thread-2  ]: Began running node test.bain_capital_analytics.not_null_int_irr_calculations_portfolio_id.5530046e4d
[0m19:30:31.529526 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.fact_portfolio_attribution"
[0m19:30:31.529891 [info ] [Thread-4  ]: 43 of 54 START test not_null_int_irr_calculations_fund_id ...................... [RUN]
[0m19:30:31.530304 [info ] [Thread-2  ]: 44 of 54 START test not_null_int_irr_calculations_portfolio_id ................. [RUN]
[0m19:30:31.530635 [debug] [Thread-3  ]: On model.bain_capital_analytics.fact_portfolio_attribution: BEGIN
[0m19:30:31.530971 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.not_null_int_cashflow_enriched_cashflow_id.8460e9066d, now test.bain_capital_analytics.not_null_int_irr_calculations_fund_id.35702f5be3)
[0m19:30:31.531315 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.unique_int_cashflow_enriched_cashflow_id.6944893c17, now test.bain_capital_analytics.not_null_int_irr_calculations_portfolio_id.5530046e4d)
[0m19:30:31.531710 [debug] [Thread-3  ]: Opening a new connection, currently in state closed
[0m19:30:31.532105 [debug] [Thread-4  ]: Began compiling node test.bain_capital_analytics.not_null_int_irr_calculations_fund_id.35702f5be3
[0m19:30:31.532418 [debug] [Thread-2  ]: Began compiling node test.bain_capital_analytics.not_null_int_irr_calculations_portfolio_id.5530046e4d
[0m19:30:31.536178 [debug] [Thread-4  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_int_irr_calculations_fund_id.35702f5be3"
[0m19:30:31.540568 [debug] [Thread-2  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_int_irr_calculations_portfolio_id.5530046e4d"
[0m19:30:31.540907 [debug] [Thread-1  ]: SQL status: BEGIN in 0.019 seconds
[0m19:30:31.541396 [debug] [Thread-1  ]: Using postgres connection "test.bain_capital_analytics.not_null_int_fund_nav_fund_id.ebf0b6cc99"
[0m19:30:31.541761 [debug] [Thread-3  ]: SQL status: BEGIN in 0.010 seconds
[0m19:30:31.542069 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_int_fund_nav_fund_id.ebf0b6cc99: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_int_fund_nav_fund_id.ebf0b6cc99"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select fund_id
from "bain_analytics"."public"."int_fund_nav"
where fund_id is null



  
  
      
    ) dbt_internal_test
[0m19:30:31.542461 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.fact_portfolio_attribution"
[0m19:30:31.542777 [debug] [Thread-4  ]: Began executing node test.bain_capital_analytics.not_null_int_irr_calculations_fund_id.35702f5be3
[0m19:30:31.543119 [debug] [Thread-2  ]: Began executing node test.bain_capital_analytics.not_null_int_irr_calculations_portfolio_id.5530046e4d
[0m19:30:31.543468 [debug] [Thread-3  ]: On model.bain_capital_analytics.fact_portfolio_attribution: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.fact_portfolio_attribution"} */

  create view "bain_analytics"."public"."fact_portfolio_attribution__dbt_tmp"
    
    
  as (
    -- Pipeline C: FACT table - Portfolio attribution with benchmark comparison
-- Anti-pattern: re-joins data that's already in intermediate models
-- Anti-pattern: repeated computation of sector weights

with attribution as (
    select
        pa.portfolio_id,
        pa.portfolio_name,
        pa.strategy,
        pa.fund_id,
        pa.position_date,
        pa.sector,
        pa.sector_mv,
        pa.sector_ugl,
        pa.num_instruments,
        pa.total_portfolio_mv,
        pa.total_portfolio_ugl,
        pa.sector_weight,
        pa.sector_contribution
    from "bain_analytics"."public"."int_portfolio_attribution" pa
),

-- Anti-pattern: re-joining benchmarks (could be done in intermediate)
attribution_with_benchmark as (
    select
        a.*,
        bm.benchmark_name,
        bm.return_mtd as benchmark_return,
        bm.rolling_3m_return as benchmark_3m_return,
        bm.rolling_12m_return as benchmark_12m_return
    from attribution a
    left join "bain_analytics"."public"."int_benchmark_returns" bm
        on a.position_date = bm.benchmark_date
        and bm.benchmark_id = 'BM_SP500'
),

-- Anti-pattern: computing alpha in yet another CTE
attribution_with_alpha as (
    select
        ab.*,
        -- Simplified active return
        case
            when ab.total_portfolio_mv != 0
            then (ab.sector_ugl / ab.total_portfolio_mv) - coalesce(ab.benchmark_return, 0) * ab.sector_weight
            else 0
        end as sector_active_return,
        -- Anti-pattern: re-computing portfolio-level return here
        case
            when ab.total_portfolio_mv != 0
            then ab.total_portfolio_ugl / ab.total_portfolio_mv
            else 0
        end as portfolio_return
    from attribution_with_benchmark ab
)

select * from attribution_with_alpha
  );
[0m19:30:31.545858 [debug] [Thread-4  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_int_irr_calculations_fund_id.35702f5be3"
[0m19:30:31.548054 [debug] [Thread-2  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_int_irr_calculations_portfolio_id.5530046e4d"
[0m19:30:31.548382 [debug] [Thread-1  ]: SQL status: SELECT 1 in 0.005 seconds
[0m19:30:31.550030 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_int_fund_nav_fund_id.ebf0b6cc99: ROLLBACK
[0m19:30:31.550497 [debug] [Thread-4  ]: Using postgres connection "test.bain_capital_analytics.not_null_int_irr_calculations_fund_id.35702f5be3"
[0m19:30:31.550846 [debug] [Thread-2  ]: Using postgres connection "test.bain_capital_analytics.not_null_int_irr_calculations_portfolio_id.5530046e4d"
[0m19:30:31.551233 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_int_fund_nav_fund_id.ebf0b6cc99: Close
[0m19:30:31.551590 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_int_irr_calculations_fund_id.35702f5be3: BEGIN
[0m19:30:31.551927 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_int_irr_calculations_portfolio_id.5530046e4d: BEGIN
[0m19:30:31.552713 [debug] [Thread-4  ]: Opening a new connection, currently in state closed
[0m19:30:31.553014 [debug] [Thread-3  ]: SQL status: CREATE VIEW in 0.004 seconds
[0m19:30:31.552462 [info ] [Thread-1  ]: 41 of 54 PASS not_null_int_fund_nav_fund_id .................................... [[32mPASS[0m in 0.05s]
[0m19:30:31.553394 [debug] [Thread-2  ]: Opening a new connection, currently in state closed
[0m19:30:31.556483 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.fact_portfolio_attribution"
[0m19:30:31.556963 [debug] [Thread-1  ]: Finished running node test.bain_capital_analytics.not_null_int_fund_nav_fund_id.ebf0b6cc99
[0m19:30:31.557380 [debug] [Thread-3  ]: On model.bain_capital_analytics.fact_portfolio_attribution: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.fact_portfolio_attribution"} */
alter table "bain_analytics"."public"."fact_portfolio_attribution__dbt_tmp" rename to "fact_portfolio_attribution"
[0m19:30:31.557741 [debug] [Thread-1  ]: Began running node test.bain_capital_analytics.not_null_int_valuation_enriched_valuation_id.048a7ba03a
[0m19:30:31.558183 [info ] [Thread-1  ]: 45 of 54 START test not_null_int_valuation_enriched_valuation_id ............... [RUN]
[0m19:30:31.558546 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.not_null_int_fund_nav_fund_id.ebf0b6cc99, now test.bain_capital_analytics.not_null_int_valuation_enriched_valuation_id.048a7ba03a)
[0m19:30:31.558846 [debug] [Thread-1  ]: Began compiling node test.bain_capital_analytics.not_null_int_valuation_enriched_valuation_id.048a7ba03a
[0m19:30:31.559164 [debug] [Thread-3  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m19:30:31.562797 [debug] [Thread-1  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_int_valuation_enriched_valuation_id.048a7ba03a"
[0m19:30:31.563874 [debug] [Thread-3  ]: On model.bain_capital_analytics.fact_portfolio_attribution: COMMIT
[0m19:30:31.564268 [debug] [Thread-4  ]: SQL status: BEGIN in 0.012 seconds
[0m19:30:31.564810 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.fact_portfolio_attribution"
[0m19:30:31.565215 [debug] [Thread-2  ]: SQL status: BEGIN in 0.012 seconds
[0m19:30:31.565573 [debug] [Thread-4  ]: Using postgres connection "test.bain_capital_analytics.not_null_int_irr_calculations_fund_id.35702f5be3"
[0m19:30:31.565915 [debug] [Thread-3  ]: On model.bain_capital_analytics.fact_portfolio_attribution: COMMIT
[0m19:30:31.566260 [debug] [Thread-1  ]: Began executing node test.bain_capital_analytics.not_null_int_valuation_enriched_valuation_id.048a7ba03a
[0m19:30:31.566545 [debug] [Thread-2  ]: Using postgres connection "test.bain_capital_analytics.not_null_int_irr_calculations_portfolio_id.5530046e4d"
[0m19:30:31.566863 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_int_irr_calculations_fund_id.35702f5be3: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_int_irr_calculations_fund_id.35702f5be3"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select fund_id
from "bain_analytics"."public"."int_irr_calculations"
where fund_id is null



  
  
      
    ) dbt_internal_test
[0m19:30:31.569241 [debug] [Thread-1  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_int_valuation_enriched_valuation_id.048a7ba03a"
[0m19:30:31.569554 [debug] [Thread-3  ]: SQL status: COMMIT in 0.002 seconds
[0m19:30:31.569847 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_int_irr_calculations_portfolio_id.5530046e4d: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_int_irr_calculations_portfolio_id.5530046e4d"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select portfolio_id
from "bain_analytics"."public"."int_irr_calculations"
where portfolio_id is null



  
  
      
    ) dbt_internal_test
[0m19:30:31.573019 [debug] [Thread-3  ]: Applying DROP to: "bain_analytics"."public"."fact_portfolio_attribution__dbt_backup"
[0m19:30:31.573576 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.fact_portfolio_attribution"
[0m19:30:31.573925 [debug] [Thread-1  ]: Using postgres connection "test.bain_capital_analytics.not_null_int_valuation_enriched_valuation_id.048a7ba03a"
[0m19:30:31.574243 [debug] [Thread-3  ]: On model.bain_capital_analytics.fact_portfolio_attribution: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.fact_portfolio_attribution"} */
drop view if exists "bain_analytics"."public"."fact_portfolio_attribution__dbt_backup" cascade
[0m19:30:31.574534 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_int_valuation_enriched_valuation_id.048a7ba03a: BEGIN
[0m19:30:31.574890 [debug] [Thread-4  ]: SQL status: SELECT 1 in 0.005 seconds
[0m19:30:31.575180 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m19:30:31.575473 [debug] [Thread-3  ]: SQL status: DROP VIEW in 0.001 seconds
[0m19:30:31.576684 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_int_irr_calculations_fund_id.35702f5be3: ROLLBACK
[0m19:30:31.577920 [debug] [Thread-3  ]: On model.bain_capital_analytics.fact_portfolio_attribution: Close
[0m19:30:31.578231 [debug] [Thread-2  ]: SQL status: SELECT 1 in 0.005 seconds
[0m19:30:31.578807 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e99c23a0-888a-42fd-99a1-6f1a129790e4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b17cd90>]}
[0m19:30:31.579973 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_int_irr_calculations_portfolio_id.5530046e4d: ROLLBACK
[0m19:30:31.580285 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_int_irr_calculations_fund_id.35702f5be3: Close
[0m19:30:31.580866 [info ] [Thread-3  ]: 42 of 54 OK created sql view model public.fact_portfolio_attribution ........... [[32mCREATE VIEW[0m in 0.07s]
[0m19:30:31.581398 [info ] [Thread-4  ]: 43 of 54 PASS not_null_int_irr_calculations_fund_id ............................ [[32mPASS[0m in 0.05s]
[0m19:30:31.581702 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_int_irr_calculations_portfolio_id.5530046e4d: Close
[0m19:30:31.582120 [debug] [Thread-3  ]: Finished running node model.bain_capital_analytics.fact_portfolio_attribution
[0m19:30:31.582643 [debug] [Thread-4  ]: Finished running node test.bain_capital_analytics.not_null_int_irr_calculations_fund_id.35702f5be3
[0m19:30:31.583110 [info ] [Thread-2  ]: 44 of 54 PASS not_null_int_irr_calculations_portfolio_id ....................... [[32mPASS[0m in 0.05s]
[0m19:30:31.583481 [debug] [Thread-3  ]: Began running node model.bain_capital_analytics.fact_cashflow_waterfall
[0m19:30:31.584165 [debug] [Thread-2  ]: Finished running node test.bain_capital_analytics.not_null_int_irr_calculations_portfolio_id.5530046e4d
[0m19:30:31.584472 [debug] [Thread-4  ]: Began running node test.bain_capital_analytics.not_null_fact_portfolio_attribution_portfolio_id.f676c7df62
[0m19:30:31.584912 [info ] [Thread-3  ]: 46 of 54 START sql view model public.fact_cashflow_waterfall ................... [RUN]
[0m19:30:31.585274 [debug] [Thread-1  ]: SQL status: BEGIN in 0.010 seconds
[0m19:30:31.585686 [info ] [Thread-4  ]: 47 of 54 START test not_null_fact_portfolio_attribution_portfolio_id ........... [RUN]
[0m19:30:31.586102 [debug] [Thread-2  ]: Began running node model.bain_capital_analytics.fact_fund_performance
[0m19:30:31.586431 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly model.bain_capital_analytics.fact_portfolio_attribution, now model.bain_capital_analytics.fact_cashflow_waterfall)
[0m19:30:31.586749 [debug] [Thread-1  ]: Using postgres connection "test.bain_capital_analytics.not_null_int_valuation_enriched_valuation_id.048a7ba03a"
[0m19:30:31.587069 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.not_null_int_irr_calculations_fund_id.35702f5be3, now test.bain_capital_analytics.not_null_fact_portfolio_attribution_portfolio_id.f676c7df62)
[0m19:30:31.587472 [info ] [Thread-2  ]: 48 of 54 START sql view model public.fact_fund_performance ..................... [RUN]
[0m19:30:31.587810 [debug] [Thread-3  ]: Began compiling node model.bain_capital_analytics.fact_cashflow_waterfall
[0m19:30:31.588125 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_int_valuation_enriched_valuation_id.048a7ba03a: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_int_valuation_enriched_valuation_id.048a7ba03a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select valuation_id
from "bain_analytics"."public"."int_valuation_enriched"
where valuation_id is null



  
  
      
    ) dbt_internal_test
[0m19:30:31.588435 [debug] [Thread-4  ]: Began compiling node test.bain_capital_analytics.not_null_fact_portfolio_attribution_portfolio_id.f676c7df62
[0m19:30:31.588755 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.not_null_int_irr_calculations_portfolio_id.5530046e4d, now model.bain_capital_analytics.fact_fund_performance)
[0m19:30:31.592283 [debug] [Thread-3  ]: Writing injected SQL for node "model.bain_capital_analytics.fact_cashflow_waterfall"
[0m19:30:31.595819 [debug] [Thread-4  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_fact_portfolio_attribution_portfolio_id.f676c7df62"
[0m19:30:31.596156 [debug] [Thread-1  ]: SQL status: SELECT 1 in 0.004 seconds
[0m19:30:31.596448 [debug] [Thread-2  ]: Began compiling node model.bain_capital_analytics.fact_fund_performance
[0m19:30:31.597726 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_int_valuation_enriched_valuation_id.048a7ba03a: ROLLBACK
[0m19:30:31.601122 [debug] [Thread-2  ]: Writing injected SQL for node "model.bain_capital_analytics.fact_fund_performance"
[0m19:30:31.601618 [debug] [Thread-4  ]: Began executing node test.bain_capital_analytics.not_null_fact_portfolio_attribution_portfolio_id.f676c7df62
[0m19:30:31.601931 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_int_valuation_enriched_valuation_id.048a7ba03a: Close
[0m19:30:31.604133 [debug] [Thread-4  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_fact_portfolio_attribution_portfolio_id.f676c7df62"
[0m19:30:31.604433 [debug] [Thread-3  ]: Began executing node model.bain_capital_analytics.fact_cashflow_waterfall
[0m19:30:31.604941 [info ] [Thread-1  ]: 45 of 54 PASS not_null_int_valuation_enriched_valuation_id ..................... [[32mPASS[0m in 0.05s]
[0m19:30:31.609480 [debug] [Thread-3  ]: Writing runtime sql for node "model.bain_capital_analytics.fact_cashflow_waterfall"
[0m19:30:31.609788 [debug] [Thread-2  ]: Began executing node model.bain_capital_analytics.fact_fund_performance
[0m19:30:31.610216 [debug] [Thread-1  ]: Finished running node test.bain_capital_analytics.not_null_int_valuation_enriched_valuation_id.048a7ba03a
[0m19:30:31.610668 [debug] [Thread-4  ]: Using postgres connection "test.bain_capital_analytics.not_null_fact_portfolio_attribution_portfolio_id.f676c7df62"
[0m19:30:31.613952 [debug] [Thread-2  ]: Writing runtime sql for node "model.bain_capital_analytics.fact_fund_performance"
[0m19:30:31.614348 [debug] [Thread-1  ]: Began running node model.bain_capital_analytics.report_lp_quarterly
[0m19:30:31.614712 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_fact_portfolio_attribution_portfolio_id.f676c7df62: BEGIN
[0m19:30:31.615096 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.fact_cashflow_waterfall"
[0m19:30:31.615579 [info ] [Thread-1  ]: 49 of 54 START sql view model public.report_lp_quarterly ....................... [RUN]
[0m19:30:31.615946 [debug] [Thread-4  ]: Opening a new connection, currently in state closed
[0m19:30:31.616267 [debug] [Thread-3  ]: On model.bain_capital_analytics.fact_cashflow_waterfall: BEGIN
[0m19:30:31.616621 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.fact_fund_performance"
[0m19:30:31.616947 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.not_null_int_valuation_enriched_valuation_id.048a7ba03a, now model.bain_capital_analytics.report_lp_quarterly)
[0m19:30:31.617355 [debug] [Thread-3  ]: Opening a new connection, currently in state closed
[0m19:30:31.617655 [debug] [Thread-2  ]: On model.bain_capital_analytics.fact_fund_performance: BEGIN
[0m19:30:31.617968 [debug] [Thread-1  ]: Began compiling node model.bain_capital_analytics.report_lp_quarterly
[0m19:30:31.618363 [debug] [Thread-2  ]: Opening a new connection, currently in state closed
[0m19:30:31.622243 [debug] [Thread-1  ]: Writing injected SQL for node "model.bain_capital_analytics.report_lp_quarterly"
[0m19:30:31.622911 [debug] [Thread-1  ]: Began executing node model.bain_capital_analytics.report_lp_quarterly
[0m19:30:31.626243 [debug] [Thread-1  ]: Writing runtime sql for node "model.bain_capital_analytics.report_lp_quarterly"
[0m19:30:31.626892 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.report_lp_quarterly"
[0m19:30:31.627290 [debug] [Thread-3  ]: SQL status: BEGIN in 0.010 seconds
[0m19:30:31.627579 [debug] [Thread-1  ]: On model.bain_capital_analytics.report_lp_quarterly: BEGIN
[0m19:30:31.627867 [debug] [Thread-4  ]: SQL status: BEGIN in 0.012 seconds
[0m19:30:31.628181 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.fact_cashflow_waterfall"
[0m19:30:31.628486 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m19:30:31.628787 [debug] [Thread-4  ]: Using postgres connection "test.bain_capital_analytics.not_null_fact_portfolio_attribution_portfolio_id.f676c7df62"
[0m19:30:31.629168 [debug] [Thread-3  ]: On model.bain_capital_analytics.fact_cashflow_waterfall: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.fact_cashflow_waterfall"} */

  create view "bain_analytics"."public"."fact_cashflow_waterfall__dbt_tmp"
    
    
  as (
    -- Pipeline C: FACT table - Cashflow waterfall for PE/fund reporting
-- Anti-pattern: deep CTEs, repeated joins, late aggregation
-- Anti-pattern: PostgreSQL-specific date functions

with enriched_cashflows as (
    select
        ce.cashflow_id,
        ce.fund_id,
        ce.fund_name,
        ce.fund_type,
        ce.portfolio_id,
        ce.portfolio_name,
        ce.cashflow_date,
        ce.cashflow_type,
        ce.amount,
        ce.investor_id,
        ce.committed_capital,
        ce.management_fee_rate,
        ce.carry_rate,
        ce.hurdle_rate,
        ce.cumulative_called,
        ce.cumulative_distributed,
        ce.cumulative_net_cashflow,
        ce.pct_called,
        -- Anti-pattern: duplicated fiscal quarter logic
        case
            when extract(month from ce.cashflow_date) between 1 and 3 then 'Q3'
            when extract(month from ce.cashflow_date) between 4 and 6 then 'Q4'
            when extract(month from ce.cashflow_date) between 7 and 9 then 'Q1'
            when extract(month from ce.cashflow_date) between 10 and 12 then 'Q2'
        end as fiscal_quarter,
        -- Anti-pattern: PostgreSQL extract
        extract(year from ce.cashflow_date) as calendar_year
    from "bain_analytics"."public"."int_cashflow_enriched" ce
),

-- Anti-pattern: re-joining valuations when int_valuation_enriched already has this
waterfall_with_nav as (
    select
        ecf.*,
        v.net_asset_value,
        v.gross_asset_value,
        v.unrealized_pnl as nav_unrealized_pnl,
        v.realized_pnl as nav_realized_pnl
    from enriched_cashflows ecf
    left join "bain_analytics"."public"."stg_valuations" v
        on ecf.portfolio_id = v.portfolio_id
        and ecf.cashflow_date = v.valuation_date
),

-- Anti-pattern: computing carry/waterfall in a CTE chain instead of a macro
waterfall_calculations as (
    select
        wn.*,
        -- Simplified carry calculation
        case
            when wn.cumulative_distributed > wn.cumulative_called * (1 + wn.hurdle_rate)
            then (wn.cumulative_distributed - wn.cumulative_called * (1 + wn.hurdle_rate)) * wn.carry_rate
            else 0
        end as estimated_carry,
        wn.cumulative_called * wn.management_fee_rate as annual_mgmt_fee,
        case
            when wn.cumulative_called > 0
            then wn.cumulative_distributed / wn.cumulative_called
            else 0
        end as dpi,
        case
            when wn.cumulative_called > 0 and wn.net_asset_value is not null
            then (wn.cumulative_distributed + wn.net_asset_value) / wn.cumulative_called
            else null
        end as tvpi
    from waterfall_with_nav wn
)

select * from waterfall_calculations
  );
[0m19:30:31.629725 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_fact_portfolio_attribution_portfolio_id.f676c7df62: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_fact_portfolio_attribution_portfolio_id.f676c7df62"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select portfolio_id
from "bain_analytics"."public"."fact_portfolio_attribution"
where portfolio_id is null



  
  
      
    ) dbt_internal_test
[0m19:30:31.630063 [debug] [Thread-2  ]: SQL status: BEGIN in 0.012 seconds
[0m19:30:31.630414 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.fact_fund_performance"
[0m19:30:31.630802 [debug] [Thread-2  ]: On model.bain_capital_analytics.fact_fund_performance: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.fact_fund_performance"} */

  create view "bain_analytics"."public"."fact_fund_performance__dbt_tmp"
    
    
  as (
    -- Pipeline C: FACT table - Fund-level performance metrics
-- Anti-pattern: late aggregation - joins everything then aggregates
-- Anti-pattern: re-joins fund_structures (already in int_fund_nav, int_cashflow_enriched)
-- Anti-pattern: materialized as view (should be table)

with fund_nav_data as (
    select
        fn.fund_id,
        fn.fund_name,
        fn.fund_type,
        fn.committed_capital,
        fn.valuation_date,
        fn.fund_nav,
        fn.fund_gav,
        fn.fund_total_liabilities,
        fn.fund_unrealized_pnl,
        fn.fund_realized_pnl,
        fn.fund_nav_return,
        fn.tvpi_gross,
        fn.num_portfolios
    from "bain_analytics"."public"."int_fund_nav" fn
),

fund_cashflows as (
    -- Anti-pattern: re-aggregating cashflows that are already in int_cashflow_enriched
    select
        cf.fund_id,
        cf.cashflow_date,
        sum(case when cf.cashflow_type = 'capital_call' then cf.amount else 0 end) as period_calls,
        sum(case when cf.cashflow_type = 'distribution' then cf.amount else 0 end) as period_distributions,
        sum(case when cf.cashflow_type = 'management_fee' then cf.amount else 0 end) as period_fees,
        sum(cf.amount) as period_net_cashflow
    from "bain_analytics"."public"."stg_cashflows" cf
    group by cf.fund_id, cf.cashflow_date
),

fund_irr as (
    select
        irr.fund_id,
        sum(irr.total_invested) as fund_total_invested,
        sum(irr.total_distributed) as fund_total_distributed,
        sum(irr.terminal_value) as fund_terminal_value,
        -- Anti-pattern: averaging portfolio IRRs as proxy for fund IRR (incorrect but intentional)
        avg(irr.approx_irr) as fund_approx_irr,
        avg(irr.tvpi) as fund_tvpi,
        avg(irr.dpi) as fund_dpi
    from "bain_analytics"."public"."int_irr_calculations" irr
    group by irr.fund_id
),

-- Anti-pattern: joining everything together at the end
combined as (
    select
        fn.fund_id,
        fn.fund_name,
        fn.fund_type,
        fn.committed_capital,
        fn.valuation_date,
        fn.fund_nav,
        fn.fund_gav,
        fn.fund_total_liabilities,
        fn.fund_unrealized_pnl,
        fn.fund_realized_pnl,
        fn.fund_nav_return,
        fn.tvpi_gross,
        fn.num_portfolios,
        coalesce(fc.period_calls, 0) as period_calls,
        coalesce(fc.period_distributions, 0) as period_distributions,
        coalesce(fc.period_fees, 0) as period_fees,
        coalesce(fc.period_net_cashflow, 0) as period_net_cashflow,
        fi.fund_total_invested,
        fi.fund_total_distributed,
        fi.fund_approx_irr,
        fi.fund_tvpi,
        fi.fund_dpi
    from fund_nav_data fn
    left join fund_cashflows fc
        on fn.fund_id = fc.fund_id
        and fn.valuation_date = fc.cashflow_date
    left join fund_irr fi
        on fn.fund_id = fi.fund_id
)

select * from combined
  );
[0m19:30:31.635156 [debug] [Thread-3  ]: SQL status: CREATE VIEW in 0.005 seconds
[0m19:30:31.638179 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.fact_cashflow_waterfall"
[0m19:30:31.638542 [debug] [Thread-3  ]: On model.bain_capital_analytics.fact_cashflow_waterfall: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.fact_cashflow_waterfall"} */
alter table "bain_analytics"."public"."fact_cashflow_waterfall__dbt_tmp" rename to "fact_cashflow_waterfall"
[0m19:30:31.638874 [debug] [Thread-2  ]: SQL status: CREATE VIEW in 0.008 seconds
[0m19:30:31.639226 [debug] [Thread-4  ]: SQL status: SELECT 1 in 0.009 seconds
[0m19:30:31.639558 [debug] [Thread-1  ]: SQL status: BEGIN in 0.011 seconds
[0m19:30:31.642323 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.fact_fund_performance"
[0m19:30:31.642649 [debug] [Thread-3  ]: SQL status: ALTER TABLE in 0.003 seconds
[0m19:30:31.643818 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_fact_portfolio_attribution_portfolio_id.f676c7df62: ROLLBACK
[0m19:30:31.644132 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.report_lp_quarterly"
[0m19:30:31.644432 [debug] [Thread-2  ]: On model.bain_capital_analytics.fact_fund_performance: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.fact_fund_performance"} */
alter table "bain_analytics"."public"."fact_fund_performance__dbt_tmp" rename to "fact_fund_performance"
[0m19:30:31.645379 [debug] [Thread-3  ]: On model.bain_capital_analytics.fact_cashflow_waterfall: COMMIT
[0m19:30:31.645876 [debug] [Thread-1  ]: On model.bain_capital_analytics.report_lp_quarterly: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.report_lp_quarterly"} */

  create view "bain_analytics"."public"."report_lp_quarterly__dbt_tmp"
    
    
  as (
    -- Pipeline C: REPORT table - LP quarterly reporting
-- Anti-pattern: massive query, duplicated logic, no reuse of intermediates
-- Anti-pattern: PostgreSQL-specific date_trunc
-- Anti-pattern: re-aggregation of data already aggregated upstream

with quarterly_cashflows as (
    -- Anti-pattern: re-aggregating cashflows by quarter (already in int_cashflow_enriched)
    select
        cf.fund_id,
        cf.portfolio_id,
        -- Anti-pattern: PostgreSQL-specific date_trunc
        date_trunc('quarter', cf.cashflow_date) as quarter_start,
        cf.cashflow_fiscal_quarter as fiscal_quarter,
        cf.cashflow_year,
        sum(case when cf.cashflow_type = 'capital_call' then cf.amount else 0 end) as quarter_calls,
        sum(case when cf.cashflow_type = 'distribution' then cf.amount else 0 end) as quarter_distributions,
        sum(case when cf.cashflow_type = 'management_fee' then cf.amount else 0 end) as quarter_fees,
        sum(cf.amount) as quarter_net
    from "bain_analytics"."public"."stg_cashflows" cf
    group by
        cf.fund_id, cf.portfolio_id,
        date_trunc('quarter', cf.cashflow_date),
        cf.cashflow_fiscal_quarter, cf.cashflow_year
),

quarterly_valuations as (
    -- Anti-pattern: re-querying valuations with subquery for quarter-end
    select *
    from (
        select
            v.portfolio_id,
            v.valuation_date,
            v.net_asset_value,
            v.gross_asset_value,
            v.unrealized_pnl,
            v.realized_pnl,
            v.valuation_method,
            -- Anti-pattern: subquery dedup instead of QUALIFY
            row_number() over (
                partition by v.portfolio_id, date_trunc('quarter', v.valuation_date)
                order by v.valuation_date desc
            ) as rn
        from "bain_analytics"."public"."stg_valuations" v
    ) sub
    where rn = 1
),

-- Anti-pattern: re-joining fund structures (done in multiple places)
fund_details as (
    select
        fs.fund_id,
        fs.fund_name,
        fs.fund_type,
        fs.committed_capital,
        fs.management_fee_rate,
        fs.carry_rate,
        fs.hurdle_rate,
        fs.vintage_year,
        fs.gp_commitment_pct
    from "bain_analytics"."public"."stg_fund_structures" fs
),

-- Anti-pattern: joining everything at the end
lp_report as (
    select
        fd.fund_id,
        fd.fund_name,
        fd.fund_type,
        fd.vintage_year,
        fd.committed_capital,
        fd.management_fee_rate,
        fd.carry_rate,
        fd.hurdle_rate,
        fd.gp_commitment_pct,
        qc.portfolio_id,
        p.portfolio_name,
        p.strategy,
        qc.quarter_start,
        qc.fiscal_quarter,
        qc.cashflow_year,
        qc.quarter_calls,
        qc.quarter_distributions,
        qc.quarter_fees,
        qc.quarter_net,
        qv.net_asset_value as quarter_end_nav,
        qv.gross_asset_value as quarter_end_gav,
        qv.unrealized_pnl,
        qv.realized_pnl,
        qv.valuation_method,
        -- Anti-pattern: IRR re-joined from separate calculation
        irr.approx_irr,
        irr.tvpi,
        irr.dpi,
        irr.rvpi
    from quarterly_cashflows qc
    inner join fund_details fd
        on qc.fund_id = fd.fund_id
    inner join "bain_analytics"."public"."stg_portfolios" p
        on qc.portfolio_id = p.portfolio_id
    left join quarterly_valuations qv
        on qc.portfolio_id = qv.portfolio_id
        and date_trunc('quarter', qv.valuation_date) = qc.quarter_start
    left join "bain_analytics"."public"."int_irr_calculations" irr
        on qc.fund_id = irr.fund_id
        and qc.portfolio_id = irr.portfolio_id
)

select
    *,
    -- Anti-pattern: computed columns in final select
    case
        when committed_capital > 0
        then quarter_calls / committed_capital
        else 0
    end as quarterly_drawdown_rate,
    case
        when quarter_end_nav is not null and committed_capital > 0
        then quarter_end_nav / committed_capital
        else null
    end as nav_to_commitment_ratio
from lp_report
order by fund_id, portfolio_id, quarter_start
  );
[0m19:30:31.646331 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_fact_portfolio_attribution_portfolio_id.f676c7df62: Close
[0m19:30:31.646668 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.fact_cashflow_waterfall"
[0m19:30:31.647216 [info ] [Thread-4  ]: 47 of 54 PASS not_null_fact_portfolio_attribution_portfolio_id ................. [[32mPASS[0m in 0.06s]
[0m19:30:31.647548 [debug] [Thread-2  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m19:30:31.647821 [debug] [Thread-3  ]: On model.bain_capital_analytics.fact_cashflow_waterfall: COMMIT
[0m19:30:31.648248 [debug] [Thread-4  ]: Finished running node test.bain_capital_analytics.not_null_fact_portfolio_attribution_portfolio_id.f676c7df62
[0m19:30:31.649408 [debug] [Thread-2  ]: On model.bain_capital_analytics.fact_fund_performance: COMMIT
[0m19:30:31.649815 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.fact_fund_performance"
[0m19:30:31.650171 [debug] [Thread-2  ]: On model.bain_capital_analytics.fact_fund_performance: COMMIT
[0m19:30:31.650504 [debug] [Thread-3  ]: SQL status: COMMIT in 0.001 seconds
[0m19:30:31.697544 [debug] [Thread-2  ]: SQL status: COMMIT in 0.047 seconds
[0m19:30:31.698945 [debug] [Thread-3  ]: Applying DROP to: "bain_analytics"."public"."fact_cashflow_waterfall__dbt_backup"
[0m19:30:31.699350 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.052 seconds
[0m19:30:31.701686 [debug] [Thread-2  ]: Applying DROP to: "bain_analytics"."public"."fact_fund_performance__dbt_backup"
[0m19:30:31.702214 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.fact_cashflow_waterfall"
[0m19:30:31.704923 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.report_lp_quarterly"
[0m19:30:31.705399 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.fact_fund_performance"
[0m19:30:31.705717 [debug] [Thread-3  ]: On model.bain_capital_analytics.fact_cashflow_waterfall: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.fact_cashflow_waterfall"} */
drop view if exists "bain_analytics"."public"."fact_cashflow_waterfall__dbt_backup" cascade
[0m19:30:31.706027 [debug] [Thread-1  ]: On model.bain_capital_analytics.report_lp_quarterly: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.report_lp_quarterly"} */
alter table "bain_analytics"."public"."report_lp_quarterly__dbt_tmp" rename to "report_lp_quarterly"
[0m19:30:31.706342 [debug] [Thread-2  ]: On model.bain_capital_analytics.fact_fund_performance: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.fact_fund_performance"} */
drop view if exists "bain_analytics"."public"."fact_fund_performance__dbt_backup" cascade
[0m19:30:31.707862 [debug] [Thread-3  ]: SQL status: DROP VIEW in 0.001 seconds
[0m19:30:31.708166 [debug] [Thread-2  ]: SQL status: DROP VIEW in 0.001 seconds
[0m19:30:31.709195 [debug] [Thread-3  ]: On model.bain_capital_analytics.fact_cashflow_waterfall: Close
[0m19:30:31.709484 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.003 seconds
[0m19:30:31.710423 [debug] [Thread-2  ]: On model.bain_capital_analytics.fact_fund_performance: Close
[0m19:30:31.711573 [debug] [Thread-1  ]: On model.bain_capital_analytics.report_lp_quarterly: COMMIT
[0m19:30:31.711890 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e99c23a0-888a-42fd-99a1-6f1a129790e4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b3fc700>]}
[0m19:30:31.712352 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.report_lp_quarterly"
[0m19:30:31.712642 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e99c23a0-888a-42fd-99a1-6f1a129790e4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b3fcfa0>]}
[0m19:30:31.713198 [info ] [Thread-3  ]: 46 of 54 OK created sql view model public.fact_cashflow_waterfall .............. [[32mCREATE VIEW[0m in 0.12s]
[0m19:30:31.713509 [debug] [Thread-1  ]: On model.bain_capital_analytics.report_lp_quarterly: COMMIT
[0m19:30:31.713957 [info ] [Thread-2  ]: 48 of 54 OK created sql view model public.fact_fund_performance ................ [[32mCREATE VIEW[0m in 0.12s]
[0m19:30:31.714436 [debug] [Thread-3  ]: Finished running node model.bain_capital_analytics.fact_cashflow_waterfall
[0m19:30:31.714900 [debug] [Thread-2  ]: Finished running node model.bain_capital_analytics.fact_fund_performance
[0m19:30:31.715495 [debug] [Thread-4  ]: Began running node test.bain_capital_analytics.not_null_fact_cashflow_waterfall_cashflow_id.7aafd60486
[0m19:30:31.715828 [debug] [Thread-3  ]: Began running node test.bain_capital_analytics.not_null_fact_fund_performance_fund_id.738d6489c4
[0m19:30:31.716147 [info ] [Thread-4  ]: 50 of 54 START test not_null_fact_cashflow_waterfall_cashflow_id ............... [RUN]
[0m19:30:31.716475 [debug] [Thread-1  ]: SQL status: COMMIT in 0.002 seconds
[0m19:30:31.716770 [info ] [Thread-3  ]: 51 of 54 START test not_null_fact_fund_performance_fund_id ..................... [RUN]
[0m19:30:31.717151 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.not_null_fact_portfolio_attribution_portfolio_id.f676c7df62, now test.bain_capital_analytics.not_null_fact_cashflow_waterfall_cashflow_id.7aafd60486)
[0m19:30:31.719443 [debug] [Thread-1  ]: Applying DROP to: "bain_analytics"."public"."report_lp_quarterly__dbt_backup"
[0m19:30:31.719765 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly model.bain_capital_analytics.fact_cashflow_waterfall, now test.bain_capital_analytics.not_null_fact_fund_performance_fund_id.738d6489c4)
[0m19:30:31.720069 [debug] [Thread-4  ]: Began compiling node test.bain_capital_analytics.not_null_fact_cashflow_waterfall_cashflow_id.7aafd60486
[0m19:30:31.720517 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.report_lp_quarterly"
[0m19:30:31.720811 [debug] [Thread-3  ]: Began compiling node test.bain_capital_analytics.not_null_fact_fund_performance_fund_id.738d6489c4
[0m19:30:31.724597 [debug] [Thread-4  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_fact_cashflow_waterfall_cashflow_id.7aafd60486"
[0m19:30:31.724945 [debug] [Thread-1  ]: On model.bain_capital_analytics.report_lp_quarterly: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.report_lp_quarterly"} */
drop view if exists "bain_analytics"."public"."report_lp_quarterly__dbt_backup" cascade
[0m19:30:31.729243 [debug] [Thread-3  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_fact_fund_performance_fund_id.738d6489c4"
[0m19:30:31.729991 [debug] [Thread-4  ]: Began executing node test.bain_capital_analytics.not_null_fact_cashflow_waterfall_cashflow_id.7aafd60486
[0m19:30:31.730304 [debug] [Thread-3  ]: Began executing node test.bain_capital_analytics.not_null_fact_fund_performance_fund_id.738d6489c4
[0m19:30:31.732661 [debug] [Thread-4  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_fact_cashflow_waterfall_cashflow_id.7aafd60486"
[0m19:30:31.732963 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.003 seconds
[0m19:30:31.735152 [debug] [Thread-3  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_fact_fund_performance_fund_id.738d6489c4"
[0m19:30:31.736296 [debug] [Thread-1  ]: On model.bain_capital_analytics.report_lp_quarterly: Close
[0m19:30:31.736854 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e99c23a0-888a-42fd-99a1-6f1a129790e4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b484430>]}
[0m19:30:31.737281 [debug] [Thread-4  ]: Using postgres connection "test.bain_capital_analytics.not_null_fact_cashflow_waterfall_cashflow_id.7aafd60486"
[0m19:30:31.737575 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_fact_cashflow_waterfall_cashflow_id.7aafd60486: BEGIN
[0m19:30:31.737901 [debug] [Thread-3  ]: Using postgres connection "test.bain_capital_analytics.not_null_fact_fund_performance_fund_id.738d6489c4"
[0m19:30:31.738335 [info ] [Thread-1  ]: 49 of 54 OK created sql view model public.report_lp_quarterly .................. [[32mCREATE VIEW[0m in 0.12s]
[0m19:30:31.738648 [debug] [Thread-4  ]: Opening a new connection, currently in state closed
[0m19:30:31.738946 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_fact_fund_performance_fund_id.738d6489c4: BEGIN
[0m19:30:31.739372 [debug] [Thread-1  ]: Finished running node model.bain_capital_analytics.report_lp_quarterly
[0m19:30:31.739783 [debug] [Thread-3  ]: Opening a new connection, currently in state closed
[0m19:30:31.740339 [debug] [Thread-2  ]: Began running node test.bain_capital_analytics.not_null_report_lp_quarterly_fund_id.aa355f6583
[0m19:30:31.740671 [info ] [Thread-2  ]: 52 of 54 START test not_null_report_lp_quarterly_fund_id ....................... [RUN]
[0m19:30:31.741018 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly model.bain_capital_analytics.fact_fund_performance, now test.bain_capital_analytics.not_null_report_lp_quarterly_fund_id.aa355f6583)
[0m19:30:31.741320 [debug] [Thread-2  ]: Began compiling node test.bain_capital_analytics.not_null_report_lp_quarterly_fund_id.aa355f6583
[0m19:30:31.745013 [debug] [Thread-2  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_report_lp_quarterly_fund_id.aa355f6583"
[0m19:30:31.745535 [debug] [Thread-2  ]: Began executing node test.bain_capital_analytics.not_null_report_lp_quarterly_fund_id.aa355f6583
[0m19:30:31.747736 [debug] [Thread-2  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_report_lp_quarterly_fund_id.aa355f6583"
[0m19:30:31.748220 [debug] [Thread-2  ]: Using postgres connection "test.bain_capital_analytics.not_null_report_lp_quarterly_fund_id.aa355f6583"
[0m19:30:31.748573 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_report_lp_quarterly_fund_id.aa355f6583: BEGIN
[0m19:30:31.748850 [debug] [Thread-2  ]: Opening a new connection, currently in state closed
[0m19:30:31.749221 [debug] [Thread-3  ]: SQL status: BEGIN in 0.009 seconds
[0m19:30:31.749626 [debug] [Thread-4  ]: SQL status: BEGIN in 0.011 seconds
[0m19:30:31.749944 [debug] [Thread-3  ]: Using postgres connection "test.bain_capital_analytics.not_null_fact_fund_performance_fund_id.738d6489c4"
[0m19:30:31.750257 [debug] [Thread-4  ]: Using postgres connection "test.bain_capital_analytics.not_null_fact_cashflow_waterfall_cashflow_id.7aafd60486"
[0m19:30:31.750579 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_fact_fund_performance_fund_id.738d6489c4: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_fact_fund_performance_fund_id.738d6489c4"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select fund_id
from "bain_analytics"."public"."fact_fund_performance"
where fund_id is null



  
  
      
    ) dbt_internal_test
[0m19:30:31.750914 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_fact_cashflow_waterfall_cashflow_id.7aafd60486: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_fact_cashflow_waterfall_cashflow_id.7aafd60486"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select cashflow_id
from "bain_analytics"."public"."fact_cashflow_waterfall"
where cashflow_id is null



  
  
      
    ) dbt_internal_test
[0m19:30:31.757635 [debug] [Thread-2  ]: SQL status: BEGIN in 0.009 seconds
[0m19:30:31.757965 [debug] [Thread-3  ]: SQL status: SELECT 1 in 0.007 seconds
[0m19:30:31.758268 [debug] [Thread-2  ]: Using postgres connection "test.bain_capital_analytics.not_null_report_lp_quarterly_fund_id.aa355f6583"
[0m19:30:31.758557 [debug] [Thread-4  ]: SQL status: SELECT 1 in 0.007 seconds
[0m19:30:31.759753 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_fact_fund_performance_fund_id.738d6489c4: ROLLBACK
[0m19:30:31.760082 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_report_lp_quarterly_fund_id.aa355f6583: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_report_lp_quarterly_fund_id.aa355f6583"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select fund_id
from "bain_analytics"."public"."report_lp_quarterly"
where fund_id is null



  
  
      
    ) dbt_internal_test
[0m19:30:31.761173 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_fact_cashflow_waterfall_cashflow_id.7aafd60486: ROLLBACK
[0m19:30:31.761761 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_fact_fund_performance_fund_id.738d6489c4: Close
[0m19:30:31.762065 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_fact_cashflow_waterfall_cashflow_id.7aafd60486: Close
[0m19:30:31.762548 [info ] [Thread-3  ]: 51 of 54 PASS not_null_fact_fund_performance_fund_id ........................... [[32mPASS[0m in 0.04s]
[0m19:30:31.763008 [info ] [Thread-4  ]: 50 of 54 PASS not_null_fact_cashflow_waterfall_cashflow_id ..................... [[32mPASS[0m in 0.05s]
[0m19:30:31.763442 [debug] [Thread-3  ]: Finished running node test.bain_capital_analytics.not_null_fact_fund_performance_fund_id.738d6489c4
[0m19:30:31.763856 [debug] [Thread-4  ]: Finished running node test.bain_capital_analytics.not_null_fact_cashflow_waterfall_cashflow_id.7aafd60486
[0m19:30:31.764443 [debug] [Thread-1  ]: Began running node model.bain_capital_analytics.report_ic_dashboard
[0m19:30:31.764868 [info ] [Thread-1  ]: 53 of 54 START sql view model public.report_ic_dashboard ....................... [RUN]
[0m19:30:31.765225 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.bain_capital_analytics.report_lp_quarterly, now model.bain_capital_analytics.report_ic_dashboard)
[0m19:30:31.765580 [debug] [Thread-1  ]: Began compiling node model.bain_capital_analytics.report_ic_dashboard
[0m19:30:31.769223 [debug] [Thread-1  ]: Writing injected SQL for node "model.bain_capital_analytics.report_ic_dashboard"
[0m19:30:31.769567 [debug] [Thread-2  ]: SQL status: SELECT 1 in 0.008 seconds
[0m19:30:31.770799 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_report_lp_quarterly_fund_id.aa355f6583: ROLLBACK
[0m19:30:31.771394 [debug] [Thread-1  ]: Began executing node model.bain_capital_analytics.report_ic_dashboard
[0m19:30:31.771696 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_report_lp_quarterly_fund_id.aa355f6583: Close
[0m19:30:31.776589 [debug] [Thread-1  ]: Writing runtime sql for node "model.bain_capital_analytics.report_ic_dashboard"
[0m19:30:31.777168 [info ] [Thread-2  ]: 52 of 54 PASS not_null_report_lp_quarterly_fund_id ............................. [[32mPASS[0m in 0.04s]
[0m19:30:31.777676 [debug] [Thread-2  ]: Finished running node test.bain_capital_analytics.not_null_report_lp_quarterly_fund_id.aa355f6583
[0m19:30:31.778154 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.report_ic_dashboard"
[0m19:30:31.778454 [debug] [Thread-1  ]: On model.bain_capital_analytics.report_ic_dashboard: BEGIN
[0m19:30:31.778735 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m19:30:31.786611 [debug] [Thread-1  ]: SQL status: BEGIN in 0.008 seconds
[0m19:30:31.787003 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.report_ic_dashboard"
[0m19:30:31.787416 [debug] [Thread-1  ]: On model.bain_capital_analytics.report_ic_dashboard: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.report_ic_dashboard"} */

  create view "bain_analytics"."public"."report_ic_dashboard__dbt_tmp"
    
    
  as (
    -- Pipeline C: REPORT table - Investment Committee dashboard
-- Anti-pattern: massive query joining many sources, no intermediate reuse
-- Anti-pattern: subquery for latest records instead of QUALIFY
-- Anti-pattern: duplicated logic from other reports

with latest_fund_performance as (
    select *
    from (
        select
            fp.*,
            -- Anti-pattern: subquery dedup instead of QUALIFY
            row_number() over (
                partition by fp.fund_id
                order by fp.valuation_date desc
            ) as rn
        from "bain_analytics"."public"."fact_fund_performance" fp
    ) sub
    where rn = 1
),

latest_portfolio_summary as (
    select *
    from (
        select
            ps.*,
            row_number() over (
                partition by ps.portfolio_id
                order by ps.position_date desc
            ) as rn
        from "bain_analytics"."public"."fact_portfolio_summary" ps
    ) sub
    where rn = 1
),

-- Anti-pattern: re-joining fund structures (already in fact_fund_performance)
fund_overview as (
    select
        lfp.fund_id,
        lfp.fund_name,
        lfp.fund_type,
        lfp.committed_capital,
        lfp.valuation_date as latest_valuation_date,
        lfp.fund_nav,
        lfp.fund_gav,
        lfp.fund_nav_return as latest_nav_return,
        lfp.tvpi_gross,
        lfp.fund_approx_irr,
        lfp.fund_tvpi,
        lfp.fund_dpi,
        lfp.num_portfolios,
        lfp.fund_total_invested,
        lfp.fund_total_distributed,
        -- Anti-pattern: re-joining fund structures
        fs.management_fee_rate,
        fs.carry_rate,
        fs.hurdle_rate,
        fs.vintage_year
    from latest_fund_performance lfp
    inner join "bain_analytics"."public"."stg_fund_structures" fs
        on lfp.fund_id = fs.fund_id
),

portfolio_details as (
    select
        lps.portfolio_id,
        lps.portfolio_name,
        lps.strategy,
        lps.fund_id,
        lps.total_market_value,
        lps.total_unrealized_pnl,
        lps.portfolio_return_pct,
        lps.num_positions,
        -- Anti-pattern: re-computing fiscal quarter
        case
            when extract(month from lps.position_date) between 1 and 3 then 'Q3'
            when extract(month from lps.position_date) between 4 and 6 then 'Q4'
            when extract(month from lps.position_date) between 7 and 9 then 'Q1'
            when extract(month from lps.position_date) between 10 and 12 then 'Q2'
        end as reporting_fiscal_quarter
    from latest_portfolio_summary lps
)

select
    fo.fund_id,
    fo.fund_name,
    fo.fund_type,
    fo.vintage_year,
    fo.committed_capital,
    fo.latest_valuation_date,
    fo.fund_nav,
    fo.fund_gav,
    fo.latest_nav_return,
    fo.tvpi_gross,
    fo.fund_approx_irr,
    fo.fund_tvpi,
    fo.fund_dpi,
    fo.num_portfolios,
    fo.fund_total_invested,
    fo.fund_total_distributed,
    fo.management_fee_rate,
    fo.carry_rate,
    fo.hurdle_rate,
    pd.portfolio_id,
    pd.portfolio_name,
    pd.strategy,
    pd.total_market_value as portfolio_mv,
    pd.total_unrealized_pnl as portfolio_unrealized_pnl,
    pd.portfolio_return_pct,
    pd.num_positions as portfolio_num_positions,
    pd.reporting_fiscal_quarter
from fund_overview fo
inner join portfolio_details pd
    on fo.fund_id = pd.fund_id
order by fo.fund_nav desc, pd.total_market_value desc
  );
[0m19:30:31.789808 [debug] [Thread-1  ]: Postgres adapter: Postgres error: relation "public.fact_portfolio_summary" does not exist
LINE 36:         from "bain_analytics"."public"."fact_portfolio_summa...
                      ^

[0m19:30:31.790129 [debug] [Thread-1  ]: On model.bain_capital_analytics.report_ic_dashboard: ROLLBACK
[0m19:30:31.790741 [debug] [Thread-1  ]: On model.bain_capital_analytics.report_ic_dashboard: Close
[0m19:30:31.812695 [debug] [Thread-1  ]: Database Error in model report_ic_dashboard (models/marts/report_ic_dashboard.sql)
  relation "public.fact_portfolio_summary" does not exist
  LINE 36:         from "bain_analytics"."public"."fact_portfolio_summa...
                        ^
  compiled code at target/run/bain_capital_analytics/models/marts/report_ic_dashboard.sql
[0m19:30:31.813216 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e99c23a0-888a-42fd-99a1-6f1a129790e4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b4cb2b0>]}
[0m19:30:31.813804 [error] [Thread-1  ]: 53 of 54 ERROR creating sql view model public.report_ic_dashboard .............. [[31mERROR[0m in 0.05s]
[0m19:30:31.814287 [debug] [Thread-1  ]: Finished running node model.bain_capital_analytics.report_ic_dashboard
[0m19:30:31.814739 [debug] [Thread-7  ]: Marking all children of 'model.bain_capital_analytics.report_ic_dashboard' to be skipped because of status 'error'.  Reason: Database Error in model report_ic_dashboard (models/marts/report_ic_dashboard.sql)
  relation "public.fact_portfolio_summary" does not exist
  LINE 36:         from "bain_analytics"."public"."fact_portfolio_summa...
                        ^
  compiled code at target/run/bain_capital_analytics/models/marts/report_ic_dashboard.sql.
[0m19:30:31.815331 [debug] [Thread-4  ]: Began running node test.bain_capital_analytics.not_null_report_ic_dashboard_fund_id.e430aafd84
[0m19:30:31.815740 [info ] [Thread-4  ]: 54 of 54 SKIP test not_null_report_ic_dashboard_fund_id ........................ [[33mSKIP[0m]
[0m19:30:31.816157 [debug] [Thread-4  ]: Finished running node test.bain_capital_analytics.not_null_report_ic_dashboard_fund_id.e430aafd84
[0m19:30:31.816491 [debug] [Thread-7  ]: Marking all children of 'test.bain_capital_analytics.not_null_report_ic_dashboard_fund_id.e430aafd84' to be skipped because of status 'skipped'. 
[0m19:30:31.817467 [debug] [MainThread]: Using postgres connection "master"
[0m19:30:31.817736 [debug] [MainThread]: On master: BEGIN
[0m19:30:31.817974 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m19:30:31.827817 [debug] [MainThread]: SQL status: BEGIN in 0.010 seconds
[0m19:30:31.828075 [debug] [MainThread]: On master: COMMIT
[0m19:30:31.828325 [debug] [MainThread]: Using postgres connection "master"
[0m19:30:31.828557 [debug] [MainThread]: On master: COMMIT
[0m19:30:31.829038 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m19:30:31.829292 [debug] [MainThread]: On master: Close
[0m19:30:31.829613 [debug] [MainThread]: Connection 'master' was properly closed.
[0m19:30:31.829848 [debug] [MainThread]: Connection 'model.bain_capital_analytics.report_ic_dashboard' was properly closed.
[0m19:30:31.830069 [debug] [MainThread]: Connection 'test.bain_capital_analytics.not_null_report_lp_quarterly_fund_id.aa355f6583' was properly closed.
[0m19:30:31.830291 [debug] [MainThread]: Connection 'test.bain_capital_analytics.not_null_fact_fund_performance_fund_id.738d6489c4' was properly closed.
[0m19:30:31.830507 [debug] [MainThread]: Connection 'test.bain_capital_analytics.not_null_fact_cashflow_waterfall_cashflow_id.7aafd60486' was properly closed.
[0m19:30:31.830872 [info ] [MainThread]: 
[0m19:30:31.831209 [info ] [MainThread]: Finished running 35 data tests, 19 view models in 0 hours 0 minutes and 1.45 seconds (1.45s).
[0m19:30:31.836810 [debug] [MainThread]: Command end result
[0m19:30:31.878721 [debug] [MainThread]: Wrote artifact WritableManifest to ./target/manifest.json
[0m19:30:31.880639 [debug] [MainThread]: Wrote artifact SemanticManifest to ./target/semantic_manifest.json
[0m19:30:31.889049 [debug] [MainThread]: Wrote artifact RunExecutionResult to ./target/run_results.json
[0m19:30:31.889398 [info ] [MainThread]: 
[0m19:30:31.889732 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m19:30:31.890011 [info ] [MainThread]: 
[0m19:30:31.890344 [error] [MainThread]: [31mFailure in model report_ic_dashboard (models/marts/report_ic_dashboard.sql)[0m
[0m19:30:31.890654 [error] [MainThread]:   Database Error in model report_ic_dashboard (models/marts/report_ic_dashboard.sql)
  relation "public.fact_portfolio_summary" does not exist
  LINE 36:         from "bain_analytics"."public"."fact_portfolio_summa...
                        ^
  compiled code at target/run/bain_capital_analytics/models/marts/report_ic_dashboard.sql
[0m19:30:31.890904 [info ] [MainThread]: 
[0m19:30:31.891203 [info ] [MainThread]:   compiled code at target/compiled/bain_capital_analytics/models/marts/report_ic_dashboard.sql
[0m19:30:31.891504 [info ] [MainThread]: 
[0m19:30:31.891791 [info ] [MainThread]: Done. PASS=52 WARN=0 ERROR=1 SKIP=1 NO-OP=0 TOTAL=54
[0m19:30:31.894862 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": false, "command_wall_clock_time": 2.4566388, "process_in_blocks": "0", "process_kernel_time": 0.384405, "process_mem_max_rss": "142393344", "process_out_blocks": "0", "process_user_time": 3.524672}
[0m19:30:31.895228 [debug] [MainThread]: Command `dbt build` failed at 19:30:31.895157 after 2.46 seconds
[0m19:30:31.895582 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108876160>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108b18220>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b249d60>]}
[0m19:30:31.895921 [debug] [MainThread]: Flushing usage events
[0m19:30:33.609202 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m19:30:41.720418 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10863e100>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1096ea9d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1096ea7f0>]}


============================== 19:30:41.724013 | b0af5ff2-0eab-40ce-a1a4-bdad63de4622 ==============================
[0m19:30:41.724013 [info ] [MainThread]: Running with dbt=1.11.0-b3
[0m19:30:41.724527 [debug] [MainThread]: running dbt with arguments {'log_format': 'default', 'indirect_selection': 'eager', 'cache_selected_only': 'False', 'no_print': 'None', 'partial_parse': 'True', 'introspect': 'True', 'write_json': 'True', 'use_experimental_parser': 'False', 'static_parser': 'True', 'use_colors': 'True', 'profiles_dir': '.', 'log_path': 'logs', 'fail_fast': 'False', 'version_check': 'True', 'quiet': 'False', 'printer_width': '80', 'target_path': 'None', 'empty': 'False', 'send_anonymous_usage_stats': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'invocation_command': 'dbt build --select tag:pipeline_c --profiles-dir . --project-dir .', 'debug': 'False', 'log_cache_events': 'False', 'warn_error': 'None'}
[0m19:30:41.921432 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'b0af5ff2-0eab-40ce-a1a4-bdad63de4622', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108999fd0>]}
[0m19:30:41.996280 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'b0af5ff2-0eab-40ce-a1a4-bdad63de4622', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10951c100>]}
[0m19:30:41.997390 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m19:30:42.101776 [debug] [MainThread]: checksum: e63134dccc1251cfb572caf0e4aa952f030c125ee3634f3bf2c0a2e1bb6ae349, vars: {}, profile: , target: , version: 1.11.0b3
[0m19:30:42.318628 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m19:30:42.319090 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m19:30:42.382499 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'b0af5ff2-0eab-40ce-a1a4-bdad63de4622', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a848130>]}
[0m19:30:42.507316 [debug] [MainThread]: Wrote artifact WritableManifest to ./target/manifest.json
[0m19:30:42.509499 [debug] [MainThread]: Wrote artifact SemanticManifest to ./target/semantic_manifest.json
[0m19:30:42.543868 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'b0af5ff2-0eab-40ce-a1a4-bdad63de4622', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a891460>]}
[0m19:30:42.544391 [info ] [MainThread]: Found 28 models, 53 data tests, 10 seeds, 569 macros
[0m19:30:42.548197 [info ] [MainThread]: 
[0m19:30:42.548509 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m19:30:42.548761 [info ] [MainThread]: 
[0m19:30:42.549317 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m19:30:42.554477 [debug] [ThreadPool]: Acquiring new postgres connection 'list_bain_analytics'
[0m19:30:42.604692 [debug] [ThreadPool]: Using postgres connection "list_bain_analytics"
[0m19:30:42.605146 [debug] [ThreadPool]: On list_bain_analytics: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "connection_name": "list_bain_analytics"} */

    select distinct nspname from pg_namespace
  
[0m19:30:42.605421 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m19:30:42.641192 [debug] [ThreadPool]: SQL status: SELECT 5 in 0.036 seconds
[0m19:30:42.642709 [debug] [ThreadPool]: On list_bain_analytics: Close
[0m19:30:42.646288 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_bain_analytics, now list_bain_analytics_public)
[0m19:30:42.653038 [debug] [ThreadPool]: Acquiring new postgres connection 'list_bain_analytics_public_raw'
[0m19:30:42.652775 [debug] [ThreadPool]: Using postgres connection "list_bain_analytics_public"
[0m19:30:42.655928 [debug] [ThreadPool]: Using postgres connection "list_bain_analytics_public_raw"
[0m19:30:42.656248 [debug] [ThreadPool]: On list_bain_analytics_public: BEGIN
[0m19:30:42.656541 [debug] [ThreadPool]: On list_bain_analytics_public_raw: BEGIN
[0m19:30:42.656815 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:30:42.657069 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m19:30:42.670031 [debug] [ThreadPool]: SQL status: BEGIN in 0.013 seconds
[0m19:30:42.670359 [debug] [ThreadPool]: Using postgres connection "list_bain_analytics_public"
[0m19:30:42.670645 [debug] [ThreadPool]: On list_bain_analytics_public: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "connection_name": "list_bain_analytics_public"} */
select
      'bain_analytics' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'bain_analytics' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'bain_analytics' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m19:30:42.671595 [debug] [ThreadPool]: SQL status: BEGIN in 0.015 seconds
[0m19:30:42.671884 [debug] [ThreadPool]: Using postgres connection "list_bain_analytics_public_raw"
[0m19:30:42.672164 [debug] [ThreadPool]: On list_bain_analytics_public_raw: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "connection_name": "list_bain_analytics_public_raw"} */
select
      'bain_analytics' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_raw'
    union all
    select
      'bain_analytics' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_raw'
    union all
    select
      'bain_analytics' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_raw'
  
[0m19:30:42.676097 [debug] [ThreadPool]: SQL status: SELECT 20 in 0.005 seconds
[0m19:30:42.677429 [debug] [ThreadPool]: On list_bain_analytics_public: ROLLBACK
[0m19:30:42.677711 [debug] [ThreadPool]: SQL status: SELECT 10 in 0.005 seconds
[0m19:30:42.678727 [debug] [ThreadPool]: On list_bain_analytics_public_raw: ROLLBACK
[0m19:30:42.679012 [debug] [ThreadPool]: On list_bain_analytics_public: Close
[0m19:30:42.679281 [debug] [ThreadPool]: On list_bain_analytics_public_raw: Close
[0m19:30:42.689244 [debug] [MainThread]: Using postgres connection "master"
[0m19:30:42.689562 [debug] [MainThread]: On master: BEGIN
[0m19:30:42.689815 [debug] [MainThread]: Opening a new connection, currently in state init
[0m19:30:42.700342 [debug] [MainThread]: SQL status: BEGIN in 0.010 seconds
[0m19:30:42.700616 [debug] [MainThread]: Using postgres connection "master"
[0m19:30:42.700938 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "connection_name": "master"} */
select distinct
        dependent_namespace.nspname as dependent_schema,
        dependent_class.relname as dependent_name,
        referenced_namespace.nspname as referenced_schema,
        referenced_class.relname as referenced_name

    -- Query for views: views are entries in pg_class with an entry in pg_rewrite, but we avoid
    -- a seq scan on pg_rewrite by leveraging the fact there is an "internal" row in pg_depend for
    -- the view...
    from pg_class as dependent_class
    join pg_namespace as dependent_namespace on dependent_namespace.oid = dependent_class.relnamespace
    join pg_depend as dependent_depend on dependent_depend.refobjid = dependent_class.oid
        and dependent_depend.classid = 'pg_rewrite'::regclass
        and dependent_depend.refclassid = 'pg_class'::regclass
        and dependent_depend.deptype = 'i'

    -- ... and via pg_depend (that has a row per column, hence the need for "distinct" above, and
    -- making sure to exclude the internal row to avoid a view appearing to depend on itself)...
    join pg_depend as joining_depend on joining_depend.objid = dependent_depend.objid
        and joining_depend.classid = 'pg_rewrite'::regclass
        and joining_depend.refclassid = 'pg_class'::regclass
        and joining_depend.refobjid != dependent_depend.refobjid

    -- ... we can find the tables they query from in pg_class, but excluding system tables. Note we
    -- don't need need to exclude _dependent_ system tables, because they only query from other
    -- system tables, and so are automatically excluded by excluding _referenced_ system tables
    join pg_class as referenced_class on referenced_class.oid = joining_depend.refobjid
    join pg_namespace as referenced_namespace on referenced_namespace.oid = referenced_class.relnamespace
        and referenced_namespace.nspname != 'information_schema'
        and referenced_namespace.nspname not like 'pg\_%'

    order by
        dependent_schema, dependent_name, referenced_schema, referenced_name;
[0m19:30:42.707553 [debug] [MainThread]: SQL status: SELECT 38 in 0.006 seconds
[0m19:30:42.713733 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b0af5ff2-0eab-40ce-a1a4-bdad63de4622', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a9a7ca0>]}
[0m19:30:42.714152 [debug] [MainThread]: On master: ROLLBACK
[0m19:30:42.714926 [debug] [MainThread]: Using postgres connection "master"
[0m19:30:42.715180 [debug] [MainThread]: On master: BEGIN
[0m19:30:42.715961 [debug] [MainThread]: SQL status: BEGIN in 0.001 seconds
[0m19:30:42.716221 [debug] [MainThread]: On master: COMMIT
[0m19:30:42.716463 [debug] [MainThread]: Using postgres connection "master"
[0m19:30:42.716707 [debug] [MainThread]: On master: COMMIT
[0m19:30:42.717204 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m19:30:42.717460 [debug] [MainThread]: On master: Close
[0m19:30:42.720598 [debug] [Thread-1  ]: Began running node model.bain_capital_analytics.stg_benchmarks
[0m19:30:42.720966 [debug] [Thread-2  ]: Began running node model.bain_capital_analytics.stg_cashflows
[0m19:30:42.721465 [info ] [Thread-1  ]: 1 of 54 START sql view model public.stg_benchmarks ............................. [RUN]
[0m19:30:42.721872 [debug] [Thread-3  ]: Began running node model.bain_capital_analytics.stg_dates
[0m19:30:42.722226 [debug] [Thread-4  ]: Began running node model.bain_capital_analytics.stg_fund_structures
[0m19:30:42.722615 [info ] [Thread-2  ]: 2 of 54 START sql view model public.stg_cashflows .............................. [RUN]
[0m19:30:42.723065 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_bain_analytics_public, now model.bain_capital_analytics.stg_benchmarks)
[0m19:30:42.723476 [info ] [Thread-3  ]: 3 of 54 START sql view model public.stg_dates .................................. [RUN]
[0m19:30:42.723877 [info ] [Thread-4  ]: 4 of 54 START sql view model public.stg_fund_structures ........................ [RUN]
[0m19:30:42.724235 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly list_bain_analytics_public_raw, now model.bain_capital_analytics.stg_cashflows)
[0m19:30:42.724565 [debug] [Thread-1  ]: Began compiling node model.bain_capital_analytics.stg_benchmarks
[0m19:30:42.724966 [debug] [Thread-3  ]: Acquiring new postgres connection 'model.bain_capital_analytics.stg_dates'
[0m19:30:42.725387 [debug] [Thread-4  ]: Acquiring new postgres connection 'model.bain_capital_analytics.stg_fund_structures'
[0m19:30:42.725698 [debug] [Thread-2  ]: Began compiling node model.bain_capital_analytics.stg_cashflows
[0m19:30:42.733772 [debug] [Thread-1  ]: Writing injected SQL for node "model.bain_capital_analytics.stg_benchmarks"
[0m19:30:42.734137 [debug] [Thread-3  ]: Began compiling node model.bain_capital_analytics.stg_dates
[0m19:30:42.734462 [debug] [Thread-4  ]: Began compiling node model.bain_capital_analytics.stg_fund_structures
[0m19:30:42.737370 [debug] [Thread-2  ]: Writing injected SQL for node "model.bain_capital_analytics.stg_cashflows"
[0m19:30:42.741169 [debug] [Thread-3  ]: Writing injected SQL for node "model.bain_capital_analytics.stg_dates"
[0m19:30:42.743713 [debug] [Thread-4  ]: Writing injected SQL for node "model.bain_capital_analytics.stg_fund_structures"
[0m19:30:42.744360 [debug] [Thread-2  ]: Began executing node model.bain_capital_analytics.stg_cashflows
[0m19:30:42.744701 [debug] [Thread-1  ]: Began executing node model.bain_capital_analytics.stg_benchmarks
[0m19:30:42.745045 [debug] [Thread-3  ]: Began executing node model.bain_capital_analytics.stg_dates
[0m19:30:42.769725 [debug] [Thread-4  ]: Began executing node model.bain_capital_analytics.stg_fund_structures
[0m19:30:42.780800 [debug] [Thread-2  ]: Writing runtime sql for node "model.bain_capital_analytics.stg_cashflows"
[0m19:30:42.781339 [debug] [Thread-1  ]: Writing runtime sql for node "model.bain_capital_analytics.stg_benchmarks"
[0m19:30:42.784896 [debug] [Thread-3  ]: Writing runtime sql for node "model.bain_capital_analytics.stg_dates"
[0m19:30:42.789183 [debug] [Thread-4  ]: Writing runtime sql for node "model.bain_capital_analytics.stg_fund_structures"
[0m19:30:42.789998 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.stg_cashflows"
[0m19:30:42.790362 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.stg_benchmarks"
[0m19:30:42.790762 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.stg_dates"
[0m19:30:42.791112 [debug] [Thread-2  ]: On model.bain_capital_analytics.stg_cashflows: BEGIN
[0m19:30:42.791452 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.stg_fund_structures"
[0m19:30:42.791758 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_benchmarks: BEGIN
[0m19:30:42.792053 [debug] [Thread-3  ]: On model.bain_capital_analytics.stg_dates: BEGIN
[0m19:30:42.792351 [debug] [Thread-2  ]: Opening a new connection, currently in state closed
[0m19:30:42.792648 [debug] [Thread-4  ]: On model.bain_capital_analytics.stg_fund_structures: BEGIN
[0m19:30:42.792932 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m19:30:42.793214 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m19:30:42.793618 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m19:30:42.809642 [debug] [Thread-1  ]: SQL status: BEGIN in 0.017 seconds
[0m19:30:42.810010 [debug] [Thread-2  ]: SQL status: BEGIN in 0.018 seconds
[0m19:30:42.810316 [debug] [Thread-3  ]: SQL status: BEGIN in 0.017 seconds
[0m19:30:42.810593 [debug] [Thread-4  ]: SQL status: BEGIN in 0.017 seconds
[0m19:30:42.810873 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.stg_benchmarks"
[0m19:30:42.811183 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.stg_cashflows"
[0m19:30:42.811476 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.stg_dates"
[0m19:30:42.811772 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.stg_fund_structures"
[0m19:30:42.812097 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_benchmarks: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_benchmarks"} */

  create view "bain_analytics"."public"."stg_benchmarks__dbt_tmp"
    
    
  as (
    select distinct
    benchmark_id,
    benchmark_name,
    cast(benchmark_date as date) as benchmark_date,
    cast(return_daily as numeric(18,8)) as return_daily,
    cast(return_mtd as numeric(18,8)) as return_mtd,
    cast(return_ytd as numeric(18,8)) as return_ytd,
    cast(benchmark_level as numeric(18,4)) as benchmark_level,
    -- Anti-pattern: duplicated fiscal quarter logic
    case
        when extract(month from cast(benchmark_date as date)) between 1 and 3 then 'Q3'
        when extract(month from cast(benchmark_date as date)) between 4 and 6 then 'Q4'
        when extract(month from cast(benchmark_date as date)) between 7 and 9 then 'Q1'
        when extract(month from cast(benchmark_date as date)) between 10 and 12 then 'Q2'
    end as benchmark_fiscal_quarter
from "bain_analytics"."public_raw"."raw_benchmarks"
  );
[0m19:30:42.812467 [debug] [Thread-2  ]: On model.bain_capital_analytics.stg_cashflows: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_cashflows"} */

  create view "bain_analytics"."public"."stg_cashflows__dbt_tmp"
    
    
  as (
    -- Anti-pattern: unnecessary DISTINCT
-- Anti-pattern: duplicated fiscal quarter logic
select distinct
    cashflow_id,
    fund_id,
    portfolio_id,
    cast(cashflow_date as date) as cashflow_date,
    cashflow_type,
    cast(amount as numeric(18,2)) as amount,
    currency,
    description,
    investor_id,
    -- Anti-pattern: duplicated fiscal quarter logic (same as stg_trades, stg_portfolios)
    case
        when extract(month from cast(cashflow_date as date)) between 1 and 3 then 'Q3'
        when extract(month from cast(cashflow_date as date)) between 4 and 6 then 'Q4'
        when extract(month from cast(cashflow_date as date)) between 7 and 9 then 'Q1'
        when extract(month from cast(cashflow_date as date)) between 10 and 12 then 'Q2'
    end as cashflow_fiscal_quarter,
    -- Anti-pattern: PostgreSQL-specific extract
    extract(year from cast(cashflow_date as date)) as cashflow_year
from "bain_analytics"."public_raw"."raw_cashflows"
  );
[0m19:30:42.812840 [debug] [Thread-3  ]: On model.bain_capital_analytics.stg_dates: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_dates"} */

  create view "bain_analytics"."public"."stg_dates__dbt_tmp"
    
    
  as (
    select
    cast(date_day as date) as date_day,
    cast(is_business_day as boolean) as is_business_day,
    cast(is_month_end as boolean) as is_month_end,
    cast(is_quarter_end as boolean) as is_quarter_end,
    cast(is_year_end as boolean) as is_year_end,
    fiscal_quarter,
    fiscal_year,
    -- Anti-pattern: PostgreSQL-specific date_trunc
    date_trunc('month', cast(date_day as date)) as month_start,
    date_trunc('quarter', cast(date_day as date)) as quarter_start,
    extract(month from cast(date_day as date)) as calendar_month,
    extract(year from cast(date_day as date)) as calendar_year
from "bain_analytics"."public_raw"."raw_dates"
  );
[0m19:30:42.813193 [debug] [Thread-4  ]: On model.bain_capital_analytics.stg_fund_structures: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_fund_structures"} */

  create view "bain_analytics"."public"."stg_fund_structures__dbt_tmp"
    
    
  as (
    select distinct
    fund_id,
    fund_name,
    fund_type,
    cast(vintage_year as integer) as vintage_year,
    cast(committed_capital as numeric(18,2)) as committed_capital,
    cast(management_fee_rate as numeric(8,4)) as management_fee_rate,
    cast(carry_rate as numeric(8,4)) as carry_rate,
    cast(hurdle_rate as numeric(8,4)) as hurdle_rate,
    cast(gp_commitment_pct as numeric(8,4)) as gp_commitment_pct,
    fund_currency,
    fund_status
from "bain_analytics"."public_raw"."raw_fund_structures"
  );
[0m19:30:42.816615 [debug] [Thread-3  ]: SQL status: CREATE VIEW in 0.003 seconds
[0m19:30:42.822828 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.stg_dates"
[0m19:30:42.823200 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.010 seconds
[0m19:30:42.823506 [debug] [Thread-2  ]: SQL status: CREATE VIEW in 0.010 seconds
[0m19:30:42.823783 [debug] [Thread-4  ]: SQL status: CREATE VIEW in 0.010 seconds
[0m19:30:42.824061 [debug] [Thread-3  ]: On model.bain_capital_analytics.stg_dates: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_dates"} */
alter table "bain_analytics"."public"."stg_dates" rename to "stg_dates__dbt_backup"
[0m19:30:42.827140 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.stg_benchmarks"
[0m19:30:42.830027 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.stg_cashflows"
[0m19:30:42.832998 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.stg_fund_structures"
[0m19:30:42.833402 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_benchmarks: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_benchmarks"} */
alter table "bain_analytics"."public"."stg_benchmarks" rename to "stg_benchmarks__dbt_backup"
[0m19:30:42.833736 [debug] [Thread-2  ]: On model.bain_capital_analytics.stg_cashflows: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_cashflows"} */
alter table "bain_analytics"."public"."stg_cashflows" rename to "stg_cashflows__dbt_backup"
[0m19:30:42.834057 [debug] [Thread-4  ]: On model.bain_capital_analytics.stg_fund_structures: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_fund_structures"} */
alter table "bain_analytics"."public"."stg_fund_structures" rename to "stg_fund_structures__dbt_backup"
[0m19:30:42.834621 [debug] [Thread-3  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m19:30:42.837872 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.stg_dates"
[0m19:30:42.838199 [debug] [Thread-4  ]: SQL status: ALTER TABLE in 0.004 seconds
[0m19:30:42.838492 [debug] [Thread-2  ]: SQL status: ALTER TABLE in 0.004 seconds
[0m19:30:42.838769 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.004 seconds
[0m19:30:42.839057 [debug] [Thread-3  ]: On model.bain_capital_analytics.stg_dates: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_dates"} */
alter table "bain_analytics"."public"."stg_dates__dbt_tmp" rename to "stg_dates"
[0m19:30:42.841726 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.stg_fund_structures"
[0m19:30:42.844330 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.stg_cashflows"
[0m19:30:42.846862 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.stg_benchmarks"
[0m19:30:42.847234 [debug] [Thread-4  ]: On model.bain_capital_analytics.stg_fund_structures: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_fund_structures"} */
alter table "bain_analytics"."public"."stg_fund_structures__dbt_tmp" rename to "stg_fund_structures"
[0m19:30:42.847571 [debug] [Thread-2  ]: On model.bain_capital_analytics.stg_cashflows: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_cashflows"} */
alter table "bain_analytics"."public"."stg_cashflows__dbt_tmp" rename to "stg_cashflows"
[0m19:30:42.847883 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_benchmarks: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_benchmarks"} */
alter table "bain_analytics"."public"."stg_benchmarks__dbt_tmp" rename to "stg_benchmarks"
[0m19:30:42.848516 [debug] [Thread-3  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m19:30:42.855561 [debug] [Thread-4  ]: SQL status: ALTER TABLE in 0.007 seconds
[0m19:30:42.861363 [debug] [Thread-2  ]: SQL status: ALTER TABLE in 0.013 seconds
[0m19:30:42.865543 [debug] [Thread-4  ]: On model.bain_capital_analytics.stg_fund_structures: COMMIT
[0m19:30:42.865870 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.018 seconds
[0m19:30:42.869495 [debug] [Thread-3  ]: On model.bain_capital_analytics.stg_dates: COMMIT
[0m19:30:42.870538 [debug] [Thread-2  ]: On model.bain_capital_analytics.stg_cashflows: COMMIT
[0m19:30:42.870862 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.stg_fund_structures"
[0m19:30:42.871835 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_benchmarks: COMMIT
[0m19:30:42.872138 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.stg_dates"
[0m19:30:42.872431 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.stg_cashflows"
[0m19:30:42.872716 [debug] [Thread-4  ]: On model.bain_capital_analytics.stg_fund_structures: COMMIT
[0m19:30:42.873021 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.stg_benchmarks"
[0m19:30:42.873307 [debug] [Thread-3  ]: On model.bain_capital_analytics.stg_dates: COMMIT
[0m19:30:42.873588 [debug] [Thread-2  ]: On model.bain_capital_analytics.stg_cashflows: COMMIT
[0m19:30:42.873923 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_benchmarks: COMMIT
[0m19:30:42.876568 [debug] [Thread-4  ]: SQL status: COMMIT in 0.003 seconds
[0m19:30:42.882249 [debug] [Thread-3  ]: SQL status: COMMIT in 0.008 seconds
[0m19:30:42.882593 [debug] [Thread-2  ]: SQL status: COMMIT in 0.008 seconds
[0m19:30:42.882898 [debug] [Thread-1  ]: SQL status: COMMIT in 0.009 seconds
[0m19:30:42.883167 [debug] [Thread-4  ]: Applying DROP to: "bain_analytics"."public"."stg_fund_structures__dbt_backup"
[0m19:30:42.886403 [debug] [Thread-3  ]: Applying DROP to: "bain_analytics"."public"."stg_dates__dbt_backup"
[0m19:30:42.929582 [debug] [Thread-2  ]: Applying DROP to: "bain_analytics"."public"."stg_cashflows__dbt_backup"
[0m19:30:42.931960 [debug] [Thread-1  ]: Applying DROP to: "bain_analytics"."public"."stg_benchmarks__dbt_backup"
[0m19:30:42.936225 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.stg_fund_structures"
[0m19:30:42.936781 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.stg_dates"
[0m19:30:42.937262 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.stg_cashflows"
[0m19:30:42.937723 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.stg_benchmarks"
[0m19:30:42.938043 [debug] [Thread-4  ]: On model.bain_capital_analytics.stg_fund_structures: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_fund_structures"} */
drop view if exists "bain_analytics"."public"."stg_fund_structures__dbt_backup" cascade
[0m19:30:42.938360 [debug] [Thread-3  ]: On model.bain_capital_analytics.stg_dates: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_dates"} */
drop view if exists "bain_analytics"."public"."stg_dates__dbt_backup" cascade
[0m19:30:42.938666 [debug] [Thread-2  ]: On model.bain_capital_analytics.stg_cashflows: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_cashflows"} */
drop view if exists "bain_analytics"."public"."stg_cashflows__dbt_backup" cascade
[0m19:30:42.938976 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_benchmarks: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_benchmarks"} */
drop view if exists "bain_analytics"."public"."stg_benchmarks__dbt_backup" cascade
[0m19:30:42.946531 [debug] [Thread-3  ]: SQL status: DROP VIEW in 0.007 seconds
[0m19:30:42.948779 [debug] [Thread-3  ]: On model.bain_capital_analytics.stg_dates: Close
[0m19:30:42.949127 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.010 seconds
[0m19:30:42.949495 [debug] [Thread-4  ]: SQL status: DROP VIEW in 0.010 seconds
[0m19:30:42.950532 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_benchmarks: Close
[0m19:30:42.951408 [debug] [Thread-2  ]: SQL status: DROP VIEW in 0.012 seconds
[0m19:30:42.952983 [debug] [Thread-4  ]: On model.bain_capital_analytics.stg_fund_structures: Close
[0m19:30:42.954263 [debug] [Thread-2  ]: On model.bain_capital_analytics.stg_cashflows: Close
[0m19:30:42.954902 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b0af5ff2-0eab-40ce-a1a4-bdad63de4622', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10af74400>]}
[0m19:30:42.955200 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b0af5ff2-0eab-40ce-a1a4-bdad63de4622', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10af88ee0>]}
[0m19:30:42.955547 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b0af5ff2-0eab-40ce-a1a4-bdad63de4622', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10af1db20>]}
[0m19:30:42.955999 [info ] [Thread-3  ]: 3 of 54 OK created sql view model public.stg_dates ............................. [[32mCREATE VIEW[0m in 0.23s]
[0m19:30:42.956312 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b0af5ff2-0eab-40ce-a1a4-bdad63de4622', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10af0b040>]}
[0m19:30:42.956813 [info ] [Thread-1  ]: 1 of 54 OK created sql view model public.stg_benchmarks ........................ [[32mCREATE VIEW[0m in 0.23s]
[0m19:30:42.957318 [info ] [Thread-4  ]: 4 of 54 OK created sql view model public.stg_fund_structures ................... [[32mCREATE VIEW[0m in 0.23s]
[0m19:30:42.957776 [debug] [Thread-3  ]: Finished running node model.bain_capital_analytics.stg_dates
[0m19:30:42.958278 [debug] [Thread-1  ]: Finished running node model.bain_capital_analytics.stg_benchmarks
[0m19:30:42.958693 [info ] [Thread-2  ]: 2 of 54 OK created sql view model public.stg_cashflows ......................... [[32mCREATE VIEW[0m in 0.23s]
[0m19:30:42.959154 [debug] [Thread-4  ]: Finished running node model.bain_capital_analytics.stg_fund_structures
[0m19:30:42.959496 [debug] [Thread-3  ]: Began running node model.bain_capital_analytics.stg_instruments
[0m19:30:42.959907 [debug] [Thread-1  ]: Began running node model.bain_capital_analytics.stg_portfolios
[0m19:30:42.960469 [debug] [Thread-2  ]: Finished running node model.bain_capital_analytics.stg_cashflows
[0m19:30:42.960856 [debug] [Thread-4  ]: Began running node model.bain_capital_analytics.stg_positions
[0m19:30:42.961295 [info ] [Thread-3  ]: 5 of 54 START sql view model public.stg_instruments ............................ [RUN]
[0m19:30:42.961760 [info ] [Thread-1  ]: 6 of 54 START sql view model public.stg_portfolios ............................. [RUN]
[0m19:30:42.962132 [debug] [Thread-2  ]: Began running node model.bain_capital_analytics.stg_valuations
[0m19:30:42.962552 [info ] [Thread-4  ]: 7 of 54 START sql view model public.stg_positions .............................. [RUN]
[0m19:30:42.962941 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly model.bain_capital_analytics.stg_dates, now model.bain_capital_analytics.stg_instruments)
[0m19:30:42.963376 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.bain_capital_analytics.stg_benchmarks, now model.bain_capital_analytics.stg_portfolios)
[0m19:30:42.963766 [info ] [Thread-2  ]: 8 of 54 START sql view model public.stg_valuations ............................. [RUN]
[0m19:30:42.964111 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly model.bain_capital_analytics.stg_fund_structures, now model.bain_capital_analytics.stg_positions)
[0m19:30:42.964426 [debug] [Thread-3  ]: Began compiling node model.bain_capital_analytics.stg_instruments
[0m19:30:42.964723 [debug] [Thread-1  ]: Began compiling node model.bain_capital_analytics.stg_portfolios
[0m19:30:42.965033 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly model.bain_capital_analytics.stg_cashflows, now model.bain_capital_analytics.stg_valuations)
[0m19:30:42.965335 [debug] [Thread-4  ]: Began compiling node model.bain_capital_analytics.stg_positions
[0m19:30:42.968531 [debug] [Thread-3  ]: Writing injected SQL for node "model.bain_capital_analytics.stg_instruments"
[0m19:30:42.971144 [debug] [Thread-1  ]: Writing injected SQL for node "model.bain_capital_analytics.stg_portfolios"
[0m19:30:42.971476 [debug] [Thread-2  ]: Began compiling node model.bain_capital_analytics.stg_valuations
[0m19:30:42.973971 [debug] [Thread-4  ]: Writing injected SQL for node "model.bain_capital_analytics.stg_positions"
[0m19:30:42.977908 [debug] [Thread-2  ]: Writing injected SQL for node "model.bain_capital_analytics.stg_valuations"
[0m19:30:42.978541 [debug] [Thread-1  ]: Began executing node model.bain_capital_analytics.stg_portfolios
[0m19:30:42.978858 [debug] [Thread-3  ]: Began executing node model.bain_capital_analytics.stg_instruments
[0m19:30:42.979145 [debug] [Thread-4  ]: Began executing node model.bain_capital_analytics.stg_positions
[0m19:30:42.982609 [debug] [Thread-1  ]: Writing runtime sql for node "model.bain_capital_analytics.stg_portfolios"
[0m19:30:42.982932 [debug] [Thread-2  ]: Began executing node model.bain_capital_analytics.stg_valuations
[0m19:30:42.986291 [debug] [Thread-3  ]: Writing runtime sql for node "model.bain_capital_analytics.stg_instruments"
[0m19:30:42.989427 [debug] [Thread-4  ]: Writing runtime sql for node "model.bain_capital_analytics.stg_positions"
[0m19:30:42.992663 [debug] [Thread-2  ]: Writing runtime sql for node "model.bain_capital_analytics.stg_valuations"
[0m19:30:42.993257 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.stg_portfolios"
[0m19:30:42.993586 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_portfolios: BEGIN
[0m19:30:42.993954 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m19:30:42.994439 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.stg_positions"
[0m19:30:42.994798 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.stg_valuations"
[0m19:30:42.995126 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.stg_instruments"
[0m19:30:42.995415 [debug] [Thread-4  ]: On model.bain_capital_analytics.stg_positions: BEGIN
[0m19:30:42.995716 [debug] [Thread-2  ]: On model.bain_capital_analytics.stg_valuations: BEGIN
[0m19:30:42.996016 [debug] [Thread-3  ]: On model.bain_capital_analytics.stg_instruments: BEGIN
[0m19:30:42.996298 [debug] [Thread-4  ]: Opening a new connection, currently in state closed
[0m19:30:42.996586 [debug] [Thread-2  ]: Opening a new connection, currently in state closed
[0m19:30:42.996870 [debug] [Thread-3  ]: Opening a new connection, currently in state closed
[0m19:30:43.005500 [debug] [Thread-1  ]: SQL status: BEGIN in 0.012 seconds
[0m19:30:43.005811 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.stg_portfolios"
[0m19:30:43.006140 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_portfolios: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_portfolios"} */

  create view "bain_analytics"."public"."stg_portfolios__dbt_tmp"
    
    
  as (
    -- Anti-pattern: unnecessary DISTINCT when source data is already unique
-- Anti-pattern: casting in every model instead of once upstream

select distinct
    cast(portfolio_id as varchar(10)) as portfolio_id,
    cast(portfolio_name as varchar(100)) as portfolio_name,
    cast(strategy as varchar(50)) as strategy,
    cast(inception_date as date) as inception_date,
    cast(fund_id as varchar(10)) as fund_id,
    cast(manager_name as varchar(100)) as manager_name,
    cast(is_active as boolean) as is_active,
    -- Anti-pattern: duplicated fiscal quarter logic (repeated in many models)
    case
        when extract(month from cast(inception_date as date)) between 1 and 3 then 'Q3'
        when extract(month from cast(inception_date as date)) between 4 and 6 then 'Q4'
        when extract(month from cast(inception_date as date)) between 7 and 9 then 'Q1'
        when extract(month from cast(inception_date as date)) between 10 and 12 then 'Q2'
    end as inception_fiscal_quarter
from "bain_analytics"."public_raw"."raw_portfolios"
where cast(is_active as boolean) = true
  );
[0m19:30:43.009257 [debug] [Thread-2  ]: SQL status: BEGIN in 0.013 seconds
[0m19:30:43.009572 [debug] [Thread-4  ]: SQL status: BEGIN in 0.013 seconds
[0m19:30:43.009870 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.stg_valuations"
[0m19:30:43.010149 [debug] [Thread-3  ]: SQL status: BEGIN in 0.013 seconds
[0m19:30:43.010441 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.stg_positions"
[0m19:30:43.010771 [debug] [Thread-2  ]: On model.bain_capital_analytics.stg_valuations: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_valuations"} */

  create view "bain_analytics"."public"."stg_valuations__dbt_tmp"
    
    
  as (
    -- Anti-pattern: unnecessary DISTINCT
select distinct
    valuation_id,
    portfolio_id,
    cast(valuation_date as date) as valuation_date,
    cast(gross_asset_value as numeric(18,2)) as gross_asset_value,
    cast(net_asset_value as numeric(18,2)) as net_asset_value,
    cast(total_liabilities as numeric(18,2)) as total_liabilities,
    cast(unrealized_pnl as numeric(18,2)) as unrealized_pnl,
    cast(realized_pnl as numeric(18,2)) as realized_pnl,
    valuation_method,
    -- Anti-pattern: duplicated fiscal quarter logic
    case
        when extract(month from cast(valuation_date as date)) between 1 and 3 then 'Q3'
        when extract(month from cast(valuation_date as date)) between 4 and 6 then 'Q4'
        when extract(month from cast(valuation_date as date)) between 7 and 9 then 'Q1'
        when extract(month from cast(valuation_date as date)) between 10 and 12 then 'Q2'
    end as valuation_fiscal_quarter
from "bain_analytics"."public_raw"."raw_valuations"
  );
[0m19:30:43.011097 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.stg_instruments"
[0m19:30:43.011413 [debug] [Thread-4  ]: On model.bain_capital_analytics.stg_positions: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_positions"} */

  create view "bain_analytics"."public"."stg_positions__dbt_tmp"
    
    
  as (
    -- Anti-pattern: unnecessary DISTINCT
-- Anti-pattern: no filtering or partitioning strategy

select distinct
    position_id,
    portfolio_id,
    instrument_id,
    cast(position_date as date) as position_date,
    cast(quantity as numeric(18,4)) as quantity,
    cast(market_value as numeric(18,2)) as market_value,
    cast(cost_basis as numeric(18,2)) as cost_basis,
    currency,
    -- Anti-pattern: computed column that could be done downstream
    cast(market_value as numeric(18,2)) - cast(cost_basis as numeric(18,2)) as unrealized_gain_loss,
    case
        when cast(cost_basis as numeric(18,2)) != 0
        then (cast(market_value as numeric(18,2)) - cast(cost_basis as numeric(18,2))) / abs(cast(cost_basis as numeric(18,2)))
        else 0
    end as unrealized_return_pct
from "bain_analytics"."public_raw"."raw_positions"
  );
[0m19:30:43.011810 [debug] [Thread-3  ]: On model.bain_capital_analytics.stg_instruments: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_instruments"} */

  create view "bain_analytics"."public"."stg_instruments__dbt_tmp"
    
    
  as (
    -- Anti-pattern: unnecessary DISTINCT
select distinct
    instrument_id,
    instrument_name,
    instrument_type,
    sector,
    currency,
    exchange,
    issuer,
    cast(maturity_date as date) as maturity_date,
    -- Anti-pattern: PostgreSQL-specific date subtraction
    case
        when maturity_date is not null
        then cast(maturity_date as date) - current_date
        else null
    end as days_to_maturity,
    case
        when instrument_type in ('equity', 'futures') then 'liquid'
        when instrument_type in ('corporate_bond', 'government_bond', 'sovereign_bond', 'leveraged_loan') then 'semi_liquid'
        when instrument_type in ('private_equity', 'venture_capital', 'real_estate', 'real_estate_debt', 'infrastructure') then 'illiquid'
        else 'other'
    end as liquidity_class
from "bain_analytics"."public_raw"."raw_instruments"
  );
[0m19:30:43.013000 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.007 seconds
[0m19:30:43.017058 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.stg_portfolios"
[0m19:30:43.017394 [debug] [Thread-2  ]: SQL status: CREATE VIEW in 0.006 seconds
[0m19:30:43.017687 [debug] [Thread-4  ]: SQL status: CREATE VIEW in 0.006 seconds
[0m19:30:43.017958 [debug] [Thread-3  ]: SQL status: CREATE VIEW in 0.006 seconds
[0m19:30:43.018241 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_portfolios: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_portfolios"} */
alter table "bain_analytics"."public"."stg_portfolios" rename to "stg_portfolios__dbt_backup"
[0m19:30:43.021111 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.stg_valuations"
[0m19:30:43.023876 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.stg_positions"
[0m19:30:43.026664 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.stg_instruments"
[0m19:30:43.027018 [debug] [Thread-2  ]: On model.bain_capital_analytics.stg_valuations: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_valuations"} */
alter table "bain_analytics"."public"."stg_valuations" rename to "stg_valuations__dbt_backup"
[0m19:30:43.027328 [debug] [Thread-4  ]: On model.bain_capital_analytics.stg_positions: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_positions"} */
alter table "bain_analytics"."public"."stg_positions" rename to "stg_positions__dbt_backup"
[0m19:30:43.027631 [debug] [Thread-3  ]: On model.bain_capital_analytics.stg_instruments: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_instruments"} */
alter table "bain_analytics"."public"."stg_instruments" rename to "stg_instruments__dbt_backup"
[0m19:30:43.027950 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m19:30:43.030497 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.stg_portfolios"
[0m19:30:43.030804 [debug] [Thread-4  ]: SQL status: ALTER TABLE in 0.003 seconds
[0m19:30:43.031083 [debug] [Thread-3  ]: SQL status: ALTER TABLE in 0.003 seconds
[0m19:30:43.031352 [debug] [Thread-2  ]: SQL status: ALTER TABLE in 0.003 seconds
[0m19:30:43.031624 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_portfolios: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_portfolios"} */
alter table "bain_analytics"."public"."stg_portfolios__dbt_tmp" rename to "stg_portfolios"
[0m19:30:43.034189 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.stg_positions"
[0m19:30:43.037496 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.stg_instruments"
[0m19:30:43.039943 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.stg_valuations"
[0m19:30:43.040294 [debug] [Thread-4  ]: On model.bain_capital_analytics.stg_positions: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_positions"} */
alter table "bain_analytics"."public"."stg_positions__dbt_tmp" rename to "stg_positions"
[0m19:30:43.040609 [debug] [Thread-3  ]: On model.bain_capital_analytics.stg_instruments: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_instruments"} */
alter table "bain_analytics"."public"."stg_instruments__dbt_tmp" rename to "stg_instruments"
[0m19:30:43.040910 [debug] [Thread-2  ]: On model.bain_capital_analytics.stg_valuations: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_valuations"} */
alter table "bain_analytics"."public"."stg_valuations__dbt_tmp" rename to "stg_valuations"
[0m19:30:43.041218 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m19:30:43.042316 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_portfolios: COMMIT
[0m19:30:43.042622 [debug] [Thread-2  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m19:30:43.042894 [debug] [Thread-3  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m19:30:43.043160 [debug] [Thread-4  ]: SQL status: ALTER TABLE in 0.002 seconds
[0m19:30:43.043440 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.stg_portfolios"
[0m19:30:43.044493 [debug] [Thread-2  ]: On model.bain_capital_analytics.stg_valuations: COMMIT
[0m19:30:43.045450 [debug] [Thread-3  ]: On model.bain_capital_analytics.stg_instruments: COMMIT
[0m19:30:43.046432 [debug] [Thread-4  ]: On model.bain_capital_analytics.stg_positions: COMMIT
[0m19:30:43.046739 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_portfolios: COMMIT
[0m19:30:43.047037 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.stg_valuations"
[0m19:30:43.047326 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.stg_instruments"
[0m19:30:43.047611 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.stg_positions"
[0m19:30:43.047932 [debug] [Thread-2  ]: On model.bain_capital_analytics.stg_valuations: COMMIT
[0m19:30:43.048228 [debug] [Thread-3  ]: On model.bain_capital_analytics.stg_instruments: COMMIT
[0m19:30:43.048513 [debug] [Thread-4  ]: On model.bain_capital_analytics.stg_positions: COMMIT
[0m19:30:43.050783 [debug] [Thread-1  ]: SQL status: COMMIT in 0.003 seconds
[0m19:30:43.053068 [debug] [Thread-1  ]: Applying DROP to: "bain_analytics"."public"."stg_portfolios__dbt_backup"
[0m19:30:43.053394 [debug] [Thread-4  ]: SQL status: COMMIT in 0.005 seconds
[0m19:30:43.053690 [debug] [Thread-2  ]: SQL status: COMMIT in 0.005 seconds
[0m19:30:43.053967 [debug] [Thread-3  ]: SQL status: COMMIT in 0.005 seconds
[0m19:30:43.054428 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.stg_portfolios"
[0m19:30:43.056643 [debug] [Thread-4  ]: Applying DROP to: "bain_analytics"."public"."stg_positions__dbt_backup"
[0m19:30:43.058819 [debug] [Thread-2  ]: Applying DROP to: "bain_analytics"."public"."stg_valuations__dbt_backup"
[0m19:30:43.061648 [debug] [Thread-3  ]: Applying DROP to: "bain_analytics"."public"."stg_instruments__dbt_backup"
[0m19:30:43.061973 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_portfolios: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_portfolios"} */
drop view if exists "bain_analytics"."public"."stg_portfolios__dbt_backup" cascade
[0m19:30:43.062457 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.stg_positions"
[0m19:30:43.062914 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.stg_valuations"
[0m19:30:43.063369 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.stg_instruments"
[0m19:30:43.063725 [debug] [Thread-4  ]: On model.bain_capital_analytics.stg_positions: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_positions"} */
drop view if exists "bain_analytics"."public"."stg_positions__dbt_backup" cascade
[0m19:30:43.064042 [debug] [Thread-2  ]: On model.bain_capital_analytics.stg_valuations: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_valuations"} */
drop view if exists "bain_analytics"."public"."stg_valuations__dbt_backup" cascade
[0m19:30:43.064348 [debug] [Thread-3  ]: On model.bain_capital_analytics.stg_instruments: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_instruments"} */
drop view if exists "bain_analytics"."public"."stg_instruments__dbt_backup" cascade
[0m19:30:43.069047 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.005 seconds
[0m19:30:43.070120 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_portfolios: Close
[0m19:30:43.070636 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b0af5ff2-0eab-40ce-a1a4-bdad63de4622', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10aeef0a0>]}
[0m19:30:43.070958 [debug] [Thread-4  ]: SQL status: DROP VIEW in 0.006 seconds
[0m19:30:43.071240 [debug] [Thread-3  ]: SQL status: DROP VIEW in 0.006 seconds
[0m19:30:43.071510 [debug] [Thread-2  ]: SQL status: DROP VIEW in 0.007 seconds
[0m19:30:43.072020 [info ] [Thread-1  ]: 6 of 54 OK created sql view model public.stg_portfolios ........................ [[32mCREATE VIEW[0m in 0.11s]
[0m19:30:43.072994 [debug] [Thread-4  ]: On model.bain_capital_analytics.stg_positions: Close
[0m19:30:43.073909 [debug] [Thread-3  ]: On model.bain_capital_analytics.stg_instruments: Close
[0m19:30:43.074819 [debug] [Thread-2  ]: On model.bain_capital_analytics.stg_valuations: Close
[0m19:30:43.075262 [debug] [Thread-1  ]: Finished running node model.bain_capital_analytics.stg_portfolios
[0m19:30:43.075703 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b0af5ff2-0eab-40ce-a1a4-bdad63de4622', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10af1db20>]}
[0m19:30:43.076108 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b0af5ff2-0eab-40ce-a1a4-bdad63de4622', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10af74400>]}
[0m19:30:43.076508 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b0af5ff2-0eab-40ce-a1a4-bdad63de4622', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10aeeffd0>]}
[0m19:30:43.076839 [debug] [Thread-1  ]: Began running node test.bain_capital_analytics.not_null_stg_dates_date_day.f3ec4da188
[0m19:30:43.077485 [info ] [Thread-4  ]: 7 of 54 OK created sql view model public.stg_positions ......................... [[32mCREATE VIEW[0m in 0.11s]
[0m19:30:43.077982 [info ] [Thread-3  ]: 5 of 54 OK created sql view model public.stg_instruments ....................... [[32mCREATE VIEW[0m in 0.11s]
[0m19:30:43.078459 [info ] [Thread-2  ]: 8 of 54 OK created sql view model public.stg_valuations ........................ [[32mCREATE VIEW[0m in 0.11s]
[0m19:30:43.078803 [info ] [Thread-1  ]: 9 of 54 START test not_null_stg_dates_date_day ................................. [RUN]
[0m19:30:43.079250 [debug] [Thread-4  ]: Finished running node model.bain_capital_analytics.stg_positions
[0m19:30:43.079656 [debug] [Thread-3  ]: Finished running node model.bain_capital_analytics.stg_instruments
[0m19:30:43.080061 [debug] [Thread-2  ]: Finished running node model.bain_capital_analytics.stg_valuations
[0m19:30:43.080392 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.bain_capital_analytics.stg_portfolios, now test.bain_capital_analytics.not_null_stg_dates_date_day.f3ec4da188)
[0m19:30:43.080723 [debug] [Thread-4  ]: Began running node test.bain_capital_analytics.unique_stg_dates_date_day.e062be8e28
[0m19:30:43.081102 [debug] [Thread-3  ]: Began running node test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_date.d5c8f88f3e
[0m19:30:43.081581 [debug] [Thread-2  ]: Began running node test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_id.ec87e4ee58
[0m19:30:43.082009 [debug] [Thread-1  ]: Began compiling node test.bain_capital_analytics.not_null_stg_dates_date_day.f3ec4da188
[0m19:30:43.082426 [info ] [Thread-4  ]: 10 of 54 START test unique_stg_dates_date_day .................................. [RUN]
[0m19:30:43.082765 [info ] [Thread-3  ]: 11 of 54 START test not_null_stg_benchmarks_benchmark_date ..................... [RUN]
[0m19:30:43.083195 [info ] [Thread-2  ]: 12 of 54 START test not_null_stg_benchmarks_benchmark_id ....................... [RUN]
[0m19:30:43.093891 [debug] [Thread-1  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_stg_dates_date_day.f3ec4da188"
[0m19:30:43.094290 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly model.bain_capital_analytics.stg_positions, now test.bain_capital_analytics.unique_stg_dates_date_day.e062be8e28)
[0m19:30:43.094653 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly model.bain_capital_analytics.stg_instruments, now test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_date.d5c8f88f3e)
[0m19:30:43.094987 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly model.bain_capital_analytics.stg_valuations, now test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_id.ec87e4ee58)
[0m19:30:43.095400 [debug] [Thread-4  ]: Began compiling node test.bain_capital_analytics.unique_stg_dates_date_day.e062be8e28
[0m19:30:43.095710 [debug] [Thread-3  ]: Began compiling node test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_date.d5c8f88f3e
[0m19:30:43.096021 [debug] [Thread-2  ]: Began compiling node test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_id.ec87e4ee58
[0m19:30:43.101526 [debug] [Thread-4  ]: Writing injected SQL for node "test.bain_capital_analytics.unique_stg_dates_date_day.e062be8e28"
[0m19:30:43.105031 [debug] [Thread-3  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_date.d5c8f88f3e"
[0m19:30:43.105362 [debug] [Thread-1  ]: Began executing node test.bain_capital_analytics.not_null_stg_dates_date_day.f3ec4da188
[0m19:30:43.108650 [debug] [Thread-2  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_id.ec87e4ee58"
[0m19:30:43.125042 [debug] [Thread-1  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_stg_dates_date_day.f3ec4da188"
[0m19:30:43.125618 [debug] [Thread-4  ]: Began executing node test.bain_capital_analytics.unique_stg_dates_date_day.e062be8e28
[0m19:30:43.125936 [debug] [Thread-3  ]: Began executing node test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_date.d5c8f88f3e
[0m19:30:43.128154 [debug] [Thread-4  ]: Writing runtime sql for node "test.bain_capital_analytics.unique_stg_dates_date_day.e062be8e28"
[0m19:30:43.130353 [debug] [Thread-3  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_date.d5c8f88f3e"
[0m19:30:43.130769 [debug] [Thread-1  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_dates_date_day.f3ec4da188"
[0m19:30:43.131150 [debug] [Thread-2  ]: Began executing node test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_id.ec87e4ee58
[0m19:30:43.131536 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_stg_dates_date_day.f3ec4da188: BEGIN
[0m19:30:43.134155 [debug] [Thread-2  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_id.ec87e4ee58"
[0m19:30:43.134540 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m19:30:43.134912 [debug] [Thread-4  ]: Using postgres connection "test.bain_capital_analytics.unique_stg_dates_date_day.e062be8e28"
[0m19:30:43.135259 [debug] [Thread-3  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_date.d5c8f88f3e"
[0m19:30:43.135789 [debug] [Thread-4  ]: On test.bain_capital_analytics.unique_stg_dates_date_day.e062be8e28: BEGIN
[0m19:30:43.136116 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_date.d5c8f88f3e: BEGIN
[0m19:30:43.136475 [debug] [Thread-2  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_id.ec87e4ee58"
[0m19:30:43.136769 [debug] [Thread-4  ]: Opening a new connection, currently in state closed
[0m19:30:43.137073 [debug] [Thread-3  ]: Opening a new connection, currently in state closed
[0m19:30:43.137377 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_id.ec87e4ee58: BEGIN
[0m19:30:43.137873 [debug] [Thread-2  ]: Opening a new connection, currently in state closed
[0m19:30:43.147323 [debug] [Thread-1  ]: SQL status: BEGIN in 0.013 seconds
[0m19:30:43.147635 [debug] [Thread-1  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_dates_date_day.f3ec4da188"
[0m19:30:43.147946 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_stg_dates_date_day.f3ec4da188: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_stg_dates_date_day.f3ec4da188"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select date_day
from "bain_analytics"."public"."stg_dates"
where date_day is null



  
  
      
    ) dbt_internal_test
[0m19:30:43.149582 [debug] [Thread-4  ]: SQL status: BEGIN in 0.013 seconds
[0m19:30:43.149899 [debug] [Thread-1  ]: SQL status: SELECT 1 in 0.002 seconds
[0m19:30:43.150198 [debug] [Thread-3  ]: SQL status: BEGIN in 0.013 seconds
[0m19:30:43.150471 [debug] [Thread-2  ]: SQL status: BEGIN in 0.013 seconds
[0m19:30:43.150741 [debug] [Thread-4  ]: Using postgres connection "test.bain_capital_analytics.unique_stg_dates_date_day.e062be8e28"
[0m19:30:43.153666 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_stg_dates_date_day.f3ec4da188: ROLLBACK
[0m19:30:43.154005 [debug] [Thread-3  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_date.d5c8f88f3e"
[0m19:30:43.154305 [debug] [Thread-2  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_id.ec87e4ee58"
[0m19:30:43.154634 [debug] [Thread-4  ]: On test.bain_capital_analytics.unique_stg_dates_date_day.e062be8e28: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.unique_stg_dates_date_day.e062be8e28"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

select
    date_day as unique_field,
    count(*) as n_records

from "bain_analytics"."public"."stg_dates"
where date_day is not null
group by date_day
having count(*) > 1



  
  
      
    ) dbt_internal_test
[0m19:30:43.155010 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_date.d5c8f88f3e: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_date.d5c8f88f3e"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select benchmark_date
from "bain_analytics"."public"."stg_benchmarks"
where benchmark_date is null



  
  
      
    ) dbt_internal_test
[0m19:30:43.155370 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_id.ec87e4ee58: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_id.ec87e4ee58"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select benchmark_id
from "bain_analytics"."public"."stg_benchmarks"
where benchmark_id is null



  
  
      
    ) dbt_internal_test
[0m19:30:43.155660 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_stg_dates_date_day.f3ec4da188: Close
[0m19:30:43.156273 [info ] [Thread-1  ]: 9 of 54 PASS not_null_stg_dates_date_day ....................................... [[32mPASS[0m in 0.08s]
[0m19:30:43.156737 [debug] [Thread-1  ]: Finished running node test.bain_capital_analytics.not_null_stg_dates_date_day.f3ec4da188
[0m19:30:43.157069 [debug] [Thread-1  ]: Began running node test.bain_capital_analytics.not_null_stg_fund_structures_fund_id.a284274f31
[0m19:30:43.157437 [info ] [Thread-1  ]: 13 of 54 START test not_null_stg_fund_structures_fund_id ....................... [RUN]
[0m19:30:43.157807 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.not_null_stg_dates_date_day.f3ec4da188, now test.bain_capital_analytics.not_null_stg_fund_structures_fund_id.a284274f31)
[0m19:30:43.158132 [debug] [Thread-2  ]: SQL status: SELECT 1 in 0.002 seconds
[0m19:30:43.158420 [debug] [Thread-3  ]: SQL status: SELECT 1 in 0.002 seconds
[0m19:30:43.158717 [debug] [Thread-4  ]: SQL status: SELECT 1 in 0.003 seconds
[0m19:30:43.159003 [debug] [Thread-1  ]: Began compiling node test.bain_capital_analytics.not_null_stg_fund_structures_fund_id.a284274f31
[0m19:30:43.160132 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_id.ec87e4ee58: ROLLBACK
[0m19:30:43.161152 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_date.d5c8f88f3e: ROLLBACK
[0m19:30:43.162151 [debug] [Thread-4  ]: On test.bain_capital_analytics.unique_stg_dates_date_day.e062be8e28: ROLLBACK
[0m19:30:43.166233 [debug] [Thread-1  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_stg_fund_structures_fund_id.a284274f31"
[0m19:30:43.166901 [debug] [Thread-1  ]: Began executing node test.bain_capital_analytics.not_null_stg_fund_structures_fund_id.a284274f31
[0m19:30:43.167220 [debug] [Thread-4  ]: On test.bain_capital_analytics.unique_stg_dates_date_day.e062be8e28: Close
[0m19:30:43.167499 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_date.d5c8f88f3e: Close
[0m19:30:43.167764 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_id.ec87e4ee58: Close
[0m19:30:43.170037 [debug] [Thread-1  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_stg_fund_structures_fund_id.a284274f31"
[0m19:30:43.170506 [info ] [Thread-4  ]: 10 of 54 PASS unique_stg_dates_date_day ........................................ [[32mPASS[0m in 0.08s]
[0m19:30:43.170973 [info ] [Thread-3  ]: 11 of 54 PASS not_null_stg_benchmarks_benchmark_date ........................... [[32mPASS[0m in 0.08s]
[0m19:30:43.171429 [info ] [Thread-2  ]: 12 of 54 PASS not_null_stg_benchmarks_benchmark_id ............................. [[32mPASS[0m in 0.08s]
[0m19:30:43.171955 [debug] [Thread-4  ]: Finished running node test.bain_capital_analytics.unique_stg_dates_date_day.e062be8e28
[0m19:30:43.172368 [debug] [Thread-3  ]: Finished running node test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_date.d5c8f88f3e
[0m19:30:43.172818 [debug] [Thread-2  ]: Finished running node test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_id.ec87e4ee58
[0m19:30:43.173168 [debug] [Thread-1  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_fund_structures_fund_id.a284274f31"
[0m19:30:43.173485 [debug] [Thread-4  ]: Began running node test.bain_capital_analytics.unique_stg_fund_structures_fund_id.bb9fec42ab
[0m19:30:43.173864 [debug] [Thread-3  ]: Began running node test.bain_capital_analytics.not_null_stg_cashflows_cashflow_id.4176024898
[0m19:30:43.174231 [debug] [Thread-2  ]: Began running node test.bain_capital_analytics.not_null_stg_cashflows_fund_id.7ff8a45dde
[0m19:30:43.174571 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_stg_fund_structures_fund_id.a284274f31: BEGIN
[0m19:30:43.174959 [info ] [Thread-4  ]: 14 of 54 START test unique_stg_fund_structures_fund_id ......................... [RUN]
[0m19:30:43.175319 [info ] [Thread-3  ]: 15 of 54 START test not_null_stg_cashflows_cashflow_id ......................... [RUN]
[0m19:30:43.175675 [info ] [Thread-2  ]: 16 of 54 START test not_null_stg_cashflows_fund_id ............................. [RUN]
[0m19:30:43.176002 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m19:30:43.176349 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.unique_stg_dates_date_day.e062be8e28, now test.bain_capital_analytics.unique_stg_fund_structures_fund_id.bb9fec42ab)
[0m19:30:43.176680 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_date.d5c8f88f3e, now test.bain_capital_analytics.not_null_stg_cashflows_cashflow_id.4176024898)
[0m19:30:43.177006 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_id.ec87e4ee58, now test.bain_capital_analytics.not_null_stg_cashflows_fund_id.7ff8a45dde)
[0m19:30:43.177416 [debug] [Thread-4  ]: Began compiling node test.bain_capital_analytics.unique_stg_fund_structures_fund_id.bb9fec42ab
[0m19:30:43.177713 [debug] [Thread-3  ]: Began compiling node test.bain_capital_analytics.not_null_stg_cashflows_cashflow_id.4176024898
[0m19:30:43.178033 [debug] [Thread-2  ]: Began compiling node test.bain_capital_analytics.not_null_stg_cashflows_fund_id.7ff8a45dde
[0m19:30:43.182657 [debug] [Thread-4  ]: Writing injected SQL for node "test.bain_capital_analytics.unique_stg_fund_structures_fund_id.bb9fec42ab"
[0m19:30:43.186070 [debug] [Thread-3  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_stg_cashflows_cashflow_id.4176024898"
[0m19:30:43.189333 [debug] [Thread-2  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_stg_cashflows_fund_id.7ff8a45dde"
[0m19:30:43.189965 [debug] [Thread-3  ]: Began executing node test.bain_capital_analytics.not_null_stg_cashflows_cashflow_id.4176024898
[0m19:30:43.190287 [debug] [Thread-4  ]: Began executing node test.bain_capital_analytics.unique_stg_fund_structures_fund_id.bb9fec42ab
[0m19:30:43.192537 [debug] [Thread-3  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_stg_cashflows_cashflow_id.4176024898"
[0m19:30:43.192872 [debug] [Thread-1  ]: SQL status: BEGIN in 0.017 seconds
[0m19:30:43.195140 [debug] [Thread-4  ]: Writing runtime sql for node "test.bain_capital_analytics.unique_stg_fund_structures_fund_id.bb9fec42ab"
[0m19:30:43.195456 [debug] [Thread-2  ]: Began executing node test.bain_capital_analytics.not_null_stg_cashflows_fund_id.7ff8a45dde
[0m19:30:43.195817 [debug] [Thread-1  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_fund_structures_fund_id.a284274f31"
[0m19:30:43.198893 [debug] [Thread-2  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_stg_cashflows_fund_id.7ff8a45dde"
[0m19:30:43.199262 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_stg_fund_structures_fund_id.a284274f31: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_stg_fund_structures_fund_id.a284274f31"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select fund_id
from "bain_analytics"."public"."stg_fund_structures"
where fund_id is null



  
  
      
    ) dbt_internal_test
[0m19:30:43.199693 [debug] [Thread-3  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_cashflows_cashflow_id.4176024898"
[0m19:30:43.200105 [debug] [Thread-4  ]: Using postgres connection "test.bain_capital_analytics.unique_stg_fund_structures_fund_id.bb9fec42ab"
[0m19:30:43.200396 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_stg_cashflows_cashflow_id.4176024898: BEGIN
[0m19:30:43.200739 [debug] [Thread-4  ]: On test.bain_capital_analytics.unique_stg_fund_structures_fund_id.bb9fec42ab: BEGIN
[0m19:30:43.201035 [debug] [Thread-3  ]: Opening a new connection, currently in state closed
[0m19:30:43.201363 [debug] [Thread-2  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_cashflows_fund_id.7ff8a45dde"
[0m19:30:43.201645 [debug] [Thread-4  ]: Opening a new connection, currently in state closed
[0m19:30:43.202039 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_stg_cashflows_fund_id.7ff8a45dde: BEGIN
[0m19:30:43.202431 [debug] [Thread-2  ]: Opening a new connection, currently in state closed
[0m19:30:43.203020 [debug] [Thread-1  ]: SQL status: SELECT 1 in 0.003 seconds
[0m19:30:43.204190 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_stg_fund_structures_fund_id.a284274f31: ROLLBACK
[0m19:30:43.205167 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_stg_fund_structures_fund_id.a284274f31: Close
[0m19:30:43.205631 [info ] [Thread-1  ]: 13 of 54 PASS not_null_stg_fund_structures_fund_id ............................. [[32mPASS[0m in 0.05s]
[0m19:30:43.206073 [debug] [Thread-1  ]: Finished running node test.bain_capital_analytics.not_null_stg_fund_structures_fund_id.a284274f31
[0m19:30:43.206395 [debug] [Thread-1  ]: Began running node test.bain_capital_analytics.not_null_stg_cashflows_portfolio_id.cbd1d93e57
[0m19:30:43.206755 [info ] [Thread-1  ]: 17 of 54 START test not_null_stg_cashflows_portfolio_id ........................ [RUN]
[0m19:30:43.207094 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.not_null_stg_fund_structures_fund_id.a284274f31, now test.bain_capital_analytics.not_null_stg_cashflows_portfolio_id.cbd1d93e57)
[0m19:30:43.207391 [debug] [Thread-1  ]: Began compiling node test.bain_capital_analytics.not_null_stg_cashflows_portfolio_id.cbd1d93e57
[0m19:30:43.211007 [debug] [Thread-1  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_stg_cashflows_portfolio_id.cbd1d93e57"
[0m19:30:43.211452 [debug] [Thread-1  ]: Began executing node test.bain_capital_analytics.not_null_stg_cashflows_portfolio_id.cbd1d93e57
[0m19:30:43.213631 [debug] [Thread-1  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_stg_cashflows_portfolio_id.cbd1d93e57"
[0m19:30:43.214165 [debug] [Thread-1  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_cashflows_portfolio_id.cbd1d93e57"
[0m19:30:43.214470 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_stg_cashflows_portfolio_id.cbd1d93e57: BEGIN
[0m19:30:43.214746 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m19:30:43.215036 [debug] [Thread-2  ]: SQL status: BEGIN in 0.013 seconds
[0m19:30:43.215407 [debug] [Thread-3  ]: SQL status: BEGIN in 0.014 seconds
[0m19:30:43.215798 [debug] [Thread-4  ]: SQL status: BEGIN in 0.014 seconds
[0m19:30:43.216091 [debug] [Thread-2  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_cashflows_fund_id.7ff8a45dde"
[0m19:30:43.216397 [debug] [Thread-3  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_cashflows_cashflow_id.4176024898"
[0m19:30:43.216695 [debug] [Thread-4  ]: Using postgres connection "test.bain_capital_analytics.unique_stg_fund_structures_fund_id.bb9fec42ab"
[0m19:30:43.217004 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_stg_cashflows_fund_id.7ff8a45dde: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_stg_cashflows_fund_id.7ff8a45dde"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select fund_id
from "bain_analytics"."public"."stg_cashflows"
where fund_id is null



  
  
      
    ) dbt_internal_test
[0m19:30:43.217327 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_stg_cashflows_cashflow_id.4176024898: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_stg_cashflows_cashflow_id.4176024898"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select cashflow_id
from "bain_analytics"."public"."stg_cashflows"
where cashflow_id is null



  
  
      
    ) dbt_internal_test
[0m19:30:43.217648 [debug] [Thread-4  ]: On test.bain_capital_analytics.unique_stg_fund_structures_fund_id.bb9fec42ab: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.unique_stg_fund_structures_fund_id.bb9fec42ab"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

select
    fund_id as unique_field,
    count(*) as n_records

from "bain_analytics"."public"."stg_fund_structures"
where fund_id is not null
group by fund_id
having count(*) > 1



  
  
      
    ) dbt_internal_test
[0m19:30:43.220378 [debug] [Thread-3  ]: SQL status: SELECT 1 in 0.002 seconds
[0m19:30:43.220682 [debug] [Thread-4  ]: SQL status: SELECT 1 in 0.003 seconds
[0m19:30:43.220965 [debug] [Thread-2  ]: SQL status: SELECT 1 in 0.003 seconds
[0m19:30:43.222063 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_stg_cashflows_cashflow_id.4176024898: ROLLBACK
[0m19:30:43.223070 [debug] [Thread-4  ]: On test.bain_capital_analytics.unique_stg_fund_structures_fund_id.bb9fec42ab: ROLLBACK
[0m19:30:43.224068 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_stg_cashflows_fund_id.7ff8a45dde: ROLLBACK
[0m19:30:43.224392 [debug] [Thread-1  ]: SQL status: BEGIN in 0.010 seconds
[0m19:30:43.224772 [debug] [Thread-1  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_cashflows_portfolio_id.cbd1d93e57"
[0m19:30:43.225086 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_stg_cashflows_portfolio_id.cbd1d93e57: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_stg_cashflows_portfolio_id.cbd1d93e57"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select portfolio_id
from "bain_analytics"."public"."stg_cashflows"
where portfolio_id is null



  
  
      
    ) dbt_internal_test
[0m19:30:43.225390 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_stg_cashflows_cashflow_id.4176024898: Close
[0m19:30:43.225662 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_stg_cashflows_fund_id.7ff8a45dde: Close
[0m19:30:43.225954 [debug] [Thread-4  ]: On test.bain_capital_analytics.unique_stg_fund_structures_fund_id.bb9fec42ab: Close
[0m19:30:43.226448 [info ] [Thread-3  ]: 15 of 54 PASS not_null_stg_cashflows_cashflow_id ............................... [[32mPASS[0m in 0.05s]
[0m19:30:43.226915 [info ] [Thread-2  ]: 16 of 54 PASS not_null_stg_cashflows_fund_id ................................... [[32mPASS[0m in 0.05s]
[0m19:30:43.227392 [debug] [Thread-3  ]: Finished running node test.bain_capital_analytics.not_null_stg_cashflows_cashflow_id.4176024898
[0m19:30:43.227802 [info ] [Thread-4  ]: 14 of 54 PASS unique_stg_fund_structures_fund_id ............................... [[32mPASS[0m in 0.05s]
[0m19:30:43.228243 [debug] [Thread-2  ]: Finished running node test.bain_capital_analytics.not_null_stg_cashflows_fund_id.7ff8a45dde
[0m19:30:43.228547 [debug] [Thread-1  ]: SQL status: SELECT 1 in 0.003 seconds
[0m19:30:43.228856 [debug] [Thread-3  ]: Began running node test.bain_capital_analytics.unique_stg_cashflows_cashflow_id.359e4f4704
[0m19:30:43.229345 [debug] [Thread-4  ]: Finished running node test.bain_capital_analytics.unique_stg_fund_structures_fund_id.bb9fec42ab
[0m19:30:43.229701 [debug] [Thread-2  ]: Began running node test.bain_capital_analytics.not_null_stg_portfolios_fund_id.70b04d82bd
[0m19:30:43.230809 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_stg_cashflows_portfolio_id.cbd1d93e57: ROLLBACK
[0m19:30:43.231137 [info ] [Thread-3  ]: 18 of 54 START test unique_stg_cashflows_cashflow_id ........................... [RUN]
[0m19:30:43.231484 [debug] [Thread-4  ]: Began running node test.bain_capital_analytics.not_null_stg_portfolios_portfolio_id.7126a480ec
[0m19:30:43.231833 [info ] [Thread-2  ]: 19 of 54 START test not_null_stg_portfolios_fund_id ............................ [RUN]
[0m19:30:43.232269 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.not_null_stg_cashflows_cashflow_id.4176024898, now test.bain_capital_analytics.unique_stg_cashflows_cashflow_id.359e4f4704)
[0m19:30:43.232606 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_stg_cashflows_portfolio_id.cbd1d93e57: Close
[0m19:30:43.232906 [info ] [Thread-4  ]: 20 of 54 START test not_null_stg_portfolios_portfolio_id ....................... [RUN]
[0m19:30:43.233262 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.not_null_stg_cashflows_fund_id.7ff8a45dde, now test.bain_capital_analytics.not_null_stg_portfolios_fund_id.70b04d82bd)
[0m19:30:43.233574 [debug] [Thread-3  ]: Began compiling node test.bain_capital_analytics.unique_stg_cashflows_cashflow_id.359e4f4704
[0m19:30:43.234006 [info ] [Thread-1  ]: 17 of 54 PASS not_null_stg_cashflows_portfolio_id .............................. [[32mPASS[0m in 0.03s]
[0m19:30:43.234333 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.unique_stg_fund_structures_fund_id.bb9fec42ab, now test.bain_capital_analytics.not_null_stg_portfolios_portfolio_id.7126a480ec)
[0m19:30:43.234634 [debug] [Thread-2  ]: Began compiling node test.bain_capital_analytics.not_null_stg_portfolios_fund_id.70b04d82bd
[0m19:30:43.238179 [debug] [Thread-3  ]: Writing injected SQL for node "test.bain_capital_analytics.unique_stg_cashflows_cashflow_id.359e4f4704"
[0m19:30:43.238619 [debug] [Thread-1  ]: Finished running node test.bain_capital_analytics.not_null_stg_cashflows_portfolio_id.cbd1d93e57
[0m19:30:43.238913 [debug] [Thread-4  ]: Began compiling node test.bain_capital_analytics.not_null_stg_portfolios_portfolio_id.7126a480ec
[0m19:30:43.242210 [debug] [Thread-2  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_stg_portfolios_fund_id.70b04d82bd"
[0m19:30:43.242609 [debug] [Thread-1  ]: Began running node test.bain_capital_analytics.unique_stg_portfolios_portfolio_id.aa125b6658
[0m19:30:43.245974 [debug] [Thread-4  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_stg_portfolios_portfolio_id.7126a480ec"
[0m19:30:43.246383 [info ] [Thread-1  ]: 21 of 54 START test unique_stg_portfolios_portfolio_id ......................... [RUN]
[0m19:30:43.246856 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.not_null_stg_cashflows_portfolio_id.cbd1d93e57, now test.bain_capital_analytics.unique_stg_portfolios_portfolio_id.aa125b6658)
[0m19:30:43.247184 [debug] [Thread-2  ]: Began executing node test.bain_capital_analytics.not_null_stg_portfolios_fund_id.70b04d82bd
[0m19:30:43.247506 [debug] [Thread-1  ]: Began compiling node test.bain_capital_analytics.unique_stg_portfolios_portfolio_id.aa125b6658
[0m19:30:43.247817 [debug] [Thread-3  ]: Began executing node test.bain_capital_analytics.unique_stg_cashflows_cashflow_id.359e4f4704
[0m19:30:43.251307 [debug] [Thread-2  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_stg_portfolios_fund_id.70b04d82bd"
[0m19:30:43.254510 [debug] [Thread-1  ]: Writing injected SQL for node "test.bain_capital_analytics.unique_stg_portfolios_portfolio_id.aa125b6658"
[0m19:30:43.254808 [debug] [Thread-4  ]: Began executing node test.bain_capital_analytics.not_null_stg_portfolios_portfolio_id.7126a480ec
[0m19:30:43.256935 [debug] [Thread-3  ]: Writing runtime sql for node "test.bain_capital_analytics.unique_stg_cashflows_cashflow_id.359e4f4704"
[0m19:30:43.259243 [debug] [Thread-4  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_stg_portfolios_portfolio_id.7126a480ec"
[0m19:30:43.259665 [debug] [Thread-2  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_portfolios_fund_id.70b04d82bd"
[0m19:30:43.260036 [debug] [Thread-1  ]: Began executing node test.bain_capital_analytics.unique_stg_portfolios_portfolio_id.aa125b6658
[0m19:30:43.260416 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_stg_portfolios_fund_id.70b04d82bd: BEGIN
[0m19:30:43.260755 [debug] [Thread-3  ]: Using postgres connection "test.bain_capital_analytics.unique_stg_cashflows_cashflow_id.359e4f4704"
[0m19:30:43.262921 [debug] [Thread-1  ]: Writing runtime sql for node "test.bain_capital_analytics.unique_stg_portfolios_portfolio_id.aa125b6658"
[0m19:30:43.263255 [debug] [Thread-2  ]: Opening a new connection, currently in state closed
[0m19:30:43.263580 [debug] [Thread-4  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_portfolios_portfolio_id.7126a480ec"
[0m19:30:43.263887 [debug] [Thread-3  ]: On test.bain_capital_analytics.unique_stg_cashflows_cashflow_id.359e4f4704: BEGIN
[0m19:30:43.264377 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_stg_portfolios_portfolio_id.7126a480ec: BEGIN
[0m19:30:43.264693 [debug] [Thread-3  ]: Opening a new connection, currently in state closed
[0m19:30:43.265005 [debug] [Thread-1  ]: Using postgres connection "test.bain_capital_analytics.unique_stg_portfolios_portfolio_id.aa125b6658"
[0m19:30:43.265309 [debug] [Thread-4  ]: Opening a new connection, currently in state closed
[0m19:30:43.265719 [debug] [Thread-1  ]: On test.bain_capital_analytics.unique_stg_portfolios_portfolio_id.aa125b6658: BEGIN
[0m19:30:43.266125 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m19:30:43.275577 [debug] [Thread-2  ]: SQL status: BEGIN in 0.012 seconds
[0m19:30:43.275910 [debug] [Thread-2  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_portfolios_fund_id.70b04d82bd"
[0m19:30:43.276213 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_stg_portfolios_fund_id.70b04d82bd: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_stg_portfolios_fund_id.70b04d82bd"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select fund_id
from "bain_analytics"."public"."stg_portfolios"
where fund_id is null



  
  
      
    ) dbt_internal_test
[0m19:30:43.277299 [debug] [Thread-3  ]: SQL status: BEGIN in 0.013 seconds
[0m19:30:43.277619 [debug] [Thread-1  ]: SQL status: BEGIN in 0.011 seconds
[0m19:30:43.277907 [debug] [Thread-4  ]: SQL status: BEGIN in 0.013 seconds
[0m19:30:43.278194 [debug] [Thread-3  ]: Using postgres connection "test.bain_capital_analytics.unique_stg_cashflows_cashflow_id.359e4f4704"
[0m19:30:43.278483 [debug] [Thread-1  ]: Using postgres connection "test.bain_capital_analytics.unique_stg_portfolios_portfolio_id.aa125b6658"
[0m19:30:43.278788 [debug] [Thread-2  ]: SQL status: SELECT 1 in 0.002 seconds
[0m19:30:43.279067 [debug] [Thread-4  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_portfolios_portfolio_id.7126a480ec"
[0m19:30:43.279380 [debug] [Thread-3  ]: On test.bain_capital_analytics.unique_stg_cashflows_cashflow_id.359e4f4704: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.unique_stg_cashflows_cashflow_id.359e4f4704"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

select
    cashflow_id as unique_field,
    count(*) as n_records

from "bain_analytics"."public"."stg_cashflows"
where cashflow_id is not null
group by cashflow_id
having count(*) > 1



  
  
      
    ) dbt_internal_test
[0m19:30:43.279712 [debug] [Thread-1  ]: On test.bain_capital_analytics.unique_stg_portfolios_portfolio_id.aa125b6658: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.unique_stg_portfolios_portfolio_id.aa125b6658"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

select
    portfolio_id as unique_field,
    count(*) as n_records

from "bain_analytics"."public"."stg_portfolios"
where portfolio_id is not null
group by portfolio_id
having count(*) > 1



  
  
      
    ) dbt_internal_test
[0m19:30:43.280951 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_stg_portfolios_fund_id.70b04d82bd: ROLLBACK
[0m19:30:43.281276 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_stg_portfolios_portfolio_id.7126a480ec: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_stg_portfolios_portfolio_id.7126a480ec"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select portfolio_id
from "bain_analytics"."public"."stg_portfolios"
where portfolio_id is null



  
  
      
    ) dbt_internal_test
[0m19:30:43.281885 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_stg_portfolios_fund_id.70b04d82bd: Close
[0m19:30:43.282607 [info ] [Thread-2  ]: 19 of 54 PASS not_null_stg_portfolios_fund_id .................................. [[32mPASS[0m in 0.05s]
[0m19:30:43.283086 [debug] [Thread-2  ]: Finished running node test.bain_capital_analytics.not_null_stg_portfolios_fund_id.70b04d82bd
[0m19:30:43.283396 [debug] [Thread-4  ]: SQL status: SELECT 1 in 0.002 seconds
[0m19:30:43.283733 [debug] [Thread-2  ]: Began running node test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c
[0m19:30:43.284026 [debug] [Thread-3  ]: SQL status: SELECT 1 in 0.002 seconds
[0m19:30:43.284310 [debug] [Thread-1  ]: SQL status: SELECT 1 in 0.003 seconds
[0m19:30:43.285567 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_stg_portfolios_portfolio_id.7126a480ec: ROLLBACK
[0m19:30:43.285916 [info ] [Thread-2  ]: 22 of 54 START test not_null_stg_positions_portfolio_id ........................ [RUN]
[0m19:30:43.286983 [debug] [Thread-3  ]: On test.bain_capital_analytics.unique_stg_cashflows_cashflow_id.359e4f4704: ROLLBACK
[0m19:30:43.288025 [debug] [Thread-1  ]: On test.bain_capital_analytics.unique_stg_portfolios_portfolio_id.aa125b6658: ROLLBACK
[0m19:30:43.288417 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.not_null_stg_portfolios_fund_id.70b04d82bd, now test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c)
[0m19:30:43.288724 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_stg_portfolios_portfolio_id.7126a480ec: Close
[0m19:30:43.289074 [debug] [Thread-2  ]: Began compiling node test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c
[0m19:30:43.289370 [debug] [Thread-3  ]: On test.bain_capital_analytics.unique_stg_cashflows_cashflow_id.359e4f4704: Close
[0m19:30:43.289649 [debug] [Thread-1  ]: On test.bain_capital_analytics.unique_stg_portfolios_portfolio_id.aa125b6658: Close
[0m19:30:43.290105 [info ] [Thread-4  ]: 20 of 54 PASS not_null_stg_portfolios_portfolio_id ............................. [[32mPASS[0m in 0.06s]
[0m19:30:43.294146 [debug] [Thread-2  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c"
[0m19:30:43.294645 [info ] [Thread-3  ]: 18 of 54 PASS unique_stg_cashflows_cashflow_id ................................. [[32mPASS[0m in 0.06s]
[0m19:30:43.295100 [info ] [Thread-1  ]: 21 of 54 PASS unique_stg_portfolios_portfolio_id ............................... [[32mPASS[0m in 0.05s]
[0m19:30:43.295545 [debug] [Thread-4  ]: Finished running node test.bain_capital_analytics.not_null_stg_portfolios_portfolio_id.7126a480ec
[0m19:30:43.296048 [debug] [Thread-3  ]: Finished running node test.bain_capital_analytics.unique_stg_cashflows_cashflow_id.359e4f4704
[0m19:30:43.296493 [debug] [Thread-1  ]: Finished running node test.bain_capital_analytics.unique_stg_portfolios_portfolio_id.aa125b6658
[0m19:30:43.296837 [debug] [Thread-4  ]: Began running node test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1
[0m19:30:43.297247 [debug] [Thread-3  ]: Began running node test.bain_capital_analytics.relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_.2823f12709
[0m19:30:43.297558 [debug] [Thread-2  ]: Began executing node test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c
[0m19:30:43.297916 [debug] [Thread-1  ]: Began running node test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f
[0m19:30:43.298350 [info ] [Thread-4  ]: 23 of 54 START test not_null_stg_positions_position_id ......................... [RUN]
[0m19:30:43.298714 [info ] [Thread-3  ]: 24 of 54 START test relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_  [RUN]
[0m19:30:43.302689 [debug] [Thread-2  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c"
[0m19:30:43.303041 [info ] [Thread-1  ]: 25 of 54 START test unique_stg_positions_position_id ........................... [RUN]
[0m19:30:43.303410 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.not_null_stg_portfolios_portfolio_id.7126a480ec, now test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1)
[0m19:30:43.303746 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.unique_stg_cashflows_cashflow_id.359e4f4704, now test.bain_capital_analytics.relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_.2823f12709)
[0m19:30:43.304156 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.unique_stg_portfolios_portfolio_id.aa125b6658, now test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f)
[0m19:30:43.304476 [debug] [Thread-4  ]: Began compiling node test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1
[0m19:30:43.304801 [debug] [Thread-3  ]: Began compiling node test.bain_capital_analytics.relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_.2823f12709
[0m19:30:43.305163 [debug] [Thread-2  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c"
[0m19:30:43.305464 [debug] [Thread-1  ]: Began compiling node test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f
[0m19:30:43.308986 [debug] [Thread-4  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1"
[0m19:30:43.315903 [debug] [Thread-3  ]: Writing injected SQL for node "test.bain_capital_analytics.relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_.2823f12709"
[0m19:30:43.316212 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c: BEGIN
[0m19:30:43.319668 [debug] [Thread-1  ]: Writing injected SQL for node "test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f"
[0m19:30:43.320135 [debug] [Thread-2  ]: Opening a new connection, currently in state closed
[0m19:30:43.320685 [debug] [Thread-3  ]: Began executing node test.bain_capital_analytics.relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_.2823f12709
[0m19:30:43.322945 [debug] [Thread-3  ]: Writing runtime sql for node "test.bain_capital_analytics.relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_.2823f12709"
[0m19:30:43.323323 [debug] [Thread-4  ]: Began executing node test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1
[0m19:30:43.326763 [debug] [Thread-4  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1"
[0m19:30:43.327086 [debug] [Thread-1  ]: Began executing node test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f
[0m19:30:43.327525 [debug] [Thread-3  ]: Using postgres connection "test.bain_capital_analytics.relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_.2823f12709"
[0m19:30:43.329731 [debug] [Thread-1  ]: Writing runtime sql for node "test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f"
[0m19:30:43.330090 [debug] [Thread-3  ]: On test.bain_capital_analytics.relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_.2823f12709: BEGIN
[0m19:30:43.330444 [debug] [Thread-4  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1"
[0m19:30:43.330827 [debug] [Thread-3  ]: Opening a new connection, currently in state closed
[0m19:30:43.331139 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1: BEGIN
[0m19:30:43.331463 [debug] [Thread-2  ]: SQL status: BEGIN in 0.011 seconds
[0m19:30:43.331902 [debug] [Thread-1  ]: Using postgres connection "test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f"
[0m19:30:43.332267 [debug] [Thread-4  ]: Opening a new connection, currently in state closed
[0m19:30:43.332641 [debug] [Thread-2  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c"
[0m19:30:43.332959 [debug] [Thread-1  ]: On test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f: BEGIN
[0m19:30:43.333376 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select portfolio_id
from "bain_analytics"."public"."stg_positions"
where portfolio_id is null



  
  
      
    ) dbt_internal_test
[0m19:30:43.333710 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m19:30:43.336658 [debug] [Thread-2  ]: SQL status: SELECT 1 in 0.003 seconds
[0m19:30:43.337885 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c: ROLLBACK
[0m19:30:43.338467 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c: Close
[0m19:30:43.338945 [info ] [Thread-2  ]: 22 of 54 PASS not_null_stg_positions_portfolio_id .............................. [[32mPASS[0m in 0.05s]
[0m19:30:43.339392 [debug] [Thread-2  ]: Finished running node test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c
[0m19:30:43.339722 [debug] [Thread-2  ]: Began running node test.bain_capital_analytics.not_null_stg_instruments_instrument_id.18bdfd2ebe
[0m19:30:43.340093 [info ] [Thread-2  ]: 26 of 54 START test not_null_stg_instruments_instrument_id ..................... [RUN]
[0m19:30:43.340433 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c, now test.bain_capital_analytics.not_null_stg_instruments_instrument_id.18bdfd2ebe)
[0m19:30:43.340737 [debug] [Thread-2  ]: Began compiling node test.bain_capital_analytics.not_null_stg_instruments_instrument_id.18bdfd2ebe
[0m19:30:43.344385 [debug] [Thread-2  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_stg_instruments_instrument_id.18bdfd2ebe"
[0m19:30:43.344883 [debug] [Thread-2  ]: Began executing node test.bain_capital_analytics.not_null_stg_instruments_instrument_id.18bdfd2ebe
[0m19:30:43.347148 [debug] [Thread-2  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_stg_instruments_instrument_id.18bdfd2ebe"
[0m19:30:43.347480 [debug] [Thread-1  ]: SQL status: BEGIN in 0.014 seconds
[0m19:30:43.347785 [debug] [Thread-4  ]: SQL status: BEGIN in 0.016 seconds
[0m19:30:43.348156 [debug] [Thread-3  ]: SQL status: BEGIN in 0.017 seconds
[0m19:30:43.348455 [debug] [Thread-1  ]: Using postgres connection "test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f"
[0m19:30:43.348772 [debug] [Thread-4  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1"
[0m19:30:43.349147 [debug] [Thread-3  ]: Using postgres connection "test.bain_capital_analytics.relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_.2823f12709"
[0m19:30:43.349485 [debug] [Thread-1  ]: On test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

select
    position_id as unique_field,
    count(*) as n_records

from "bain_analytics"."public"."stg_positions"
where position_id is not null
group by position_id
having count(*) > 1



  
  
      
    ) dbt_internal_test
[0m19:30:43.349833 [debug] [Thread-2  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_instruments_instrument_id.18bdfd2ebe"
[0m19:30:43.350158 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select position_id
from "bain_analytics"."public"."stg_positions"
where position_id is null



  
  
      
    ) dbt_internal_test
[0m19:30:43.350516 [debug] [Thread-3  ]: On test.bain_capital_analytics.relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_.2823f12709: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_.2823f12709"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

with child as (
    select portfolio_id as from_field
    from "bain_analytics"."public"."stg_positions"
    where portfolio_id is not null
),

parent as (
    select portfolio_id as to_field
    from "bain_analytics"."public"."stg_portfolios"
)

select
    from_field

from child
left join parent
    on child.from_field = parent.to_field

where parent.to_field is null



  
  
      
    ) dbt_internal_test
[0m19:30:43.350875 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_stg_instruments_instrument_id.18bdfd2ebe: BEGIN
[0m19:30:43.351233 [debug] [Thread-2  ]: Opening a new connection, currently in state closed
[0m19:30:43.352973 [debug] [Thread-4  ]: SQL status: SELECT 1 in 0.002 seconds
[0m19:30:43.353281 [debug] [Thread-1  ]: SQL status: SELECT 1 in 0.002 seconds
[0m19:30:43.354409 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1: ROLLBACK
[0m19:30:43.355425 [debug] [Thread-1  ]: On test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f: ROLLBACK
[0m19:30:43.355747 [debug] [Thread-3  ]: SQL status: SELECT 1 in 0.005 seconds
[0m19:30:43.356836 [debug] [Thread-3  ]: On test.bain_capital_analytics.relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_.2823f12709: ROLLBACK
[0m19:30:43.357131 [debug] [Thread-1  ]: On test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f: Close
[0m19:30:43.357408 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1: Close
[0m19:30:43.358155 [debug] [Thread-3  ]: On test.bain_capital_analytics.relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_.2823f12709: Close
[0m19:30:43.357901 [info ] [Thread-1  ]: 25 of 54 PASS unique_stg_positions_position_id ................................. [[32mPASS[0m in 0.05s]
[0m19:30:43.358685 [info ] [Thread-4  ]: 23 of 54 PASS not_null_stg_positions_position_id ............................... [[32mPASS[0m in 0.06s]
[0m19:30:43.359176 [info ] [Thread-3  ]: 24 of 54 PASS relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_  [[32mPASS[0m in 0.06s]
[0m19:30:43.359625 [debug] [Thread-1  ]: Finished running node test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f
[0m19:30:43.359936 [debug] [Thread-2  ]: SQL status: BEGIN in 0.009 seconds
[0m19:30:43.360332 [debug] [Thread-4  ]: Finished running node test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1
[0m19:30:43.360742 [debug] [Thread-3  ]: Finished running node test.bain_capital_analytics.relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_.2823f12709
[0m19:30:43.361069 [debug] [Thread-1  ]: Began running node test.bain_capital_analytics.unique_stg_instruments_instrument_id.0e70adcd34
[0m19:30:43.361432 [debug] [Thread-2  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_instruments_instrument_id.18bdfd2ebe"
[0m19:30:43.361773 [debug] [Thread-4  ]: Began running node test.bain_capital_analytics.not_null_stg_valuations_portfolio_id.d5af3e5188
[0m19:30:43.362150 [debug] [Thread-3  ]: Began running node test.bain_capital_analytics.not_null_stg_valuations_valuation_id.88ca70781d
[0m19:30:43.362509 [info ] [Thread-1  ]: 27 of 54 START test unique_stg_instruments_instrument_id ....................... [RUN]
[0m19:30:43.362856 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_stg_instruments_instrument_id.18bdfd2ebe: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_stg_instruments_instrument_id.18bdfd2ebe"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select instrument_id
from "bain_analytics"."public"."stg_instruments"
where instrument_id is null



  
  
      
    ) dbt_internal_test
[0m19:30:43.363204 [info ] [Thread-4  ]: 28 of 54 START test not_null_stg_valuations_portfolio_id ....................... [RUN]
[0m19:30:43.363546 [info ] [Thread-3  ]: 29 of 54 START test not_null_stg_valuations_valuation_id ....................... [RUN]
[0m19:30:43.363909 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f, now test.bain_capital_analytics.unique_stg_instruments_instrument_id.0e70adcd34)
[0m19:30:43.364296 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1, now test.bain_capital_analytics.not_null_stg_valuations_portfolio_id.d5af3e5188)
[0m19:30:43.364633 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_.2823f12709, now test.bain_capital_analytics.not_null_stg_valuations_valuation_id.88ca70781d)
[0m19:30:43.364947 [debug] [Thread-1  ]: Began compiling node test.bain_capital_analytics.unique_stg_instruments_instrument_id.0e70adcd34
[0m19:30:43.365240 [debug] [Thread-4  ]: Began compiling node test.bain_capital_analytics.not_null_stg_valuations_portfolio_id.d5af3e5188
[0m19:30:43.365582 [debug] [Thread-3  ]: Began compiling node test.bain_capital_analytics.not_null_stg_valuations_valuation_id.88ca70781d
[0m19:30:43.369206 [debug] [Thread-1  ]: Writing injected SQL for node "test.bain_capital_analytics.unique_stg_instruments_instrument_id.0e70adcd34"
[0m19:30:43.369533 [debug] [Thread-2  ]: SQL status: SELECT 1 in 0.005 seconds
[0m19:30:43.372920 [debug] [Thread-4  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_stg_valuations_portfolio_id.d5af3e5188"
[0m19:30:43.377364 [debug] [Thread-3  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_stg_valuations_valuation_id.88ca70781d"
[0m19:30:43.378635 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_stg_instruments_instrument_id.18bdfd2ebe: ROLLBACK
[0m19:30:43.379232 [debug] [Thread-1  ]: Began executing node test.bain_capital_analytics.unique_stg_instruments_instrument_id.0e70adcd34
[0m19:30:43.379553 [debug] [Thread-4  ]: Began executing node test.bain_capital_analytics.not_null_stg_valuations_portfolio_id.d5af3e5188
[0m19:30:43.379848 [debug] [Thread-3  ]: Began executing node test.bain_capital_analytics.not_null_stg_valuations_valuation_id.88ca70781d
[0m19:30:43.427582 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_stg_instruments_instrument_id.18bdfd2ebe: Close
[0m19:30:43.429909 [debug] [Thread-1  ]: Writing runtime sql for node "test.bain_capital_analytics.unique_stg_instruments_instrument_id.0e70adcd34"
[0m19:30:43.432269 [debug] [Thread-4  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_stg_valuations_portfolio_id.d5af3e5188"
[0m19:30:43.434506 [debug] [Thread-3  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_stg_valuations_valuation_id.88ca70781d"
[0m19:30:43.435156 [info ] [Thread-2  ]: 26 of 54 PASS not_null_stg_instruments_instrument_id ........................... [[32mPASS[0m in 0.09s]
[0m19:30:43.435780 [debug] [Thread-2  ]: Finished running node test.bain_capital_analytics.not_null_stg_instruments_instrument_id.18bdfd2ebe
[0m19:30:43.436119 [debug] [Thread-2  ]: Began running node test.bain_capital_analytics.unique_stg_valuations_valuation_id.fce7eb13b5
[0m19:30:43.436433 [info ] [Thread-2  ]: 30 of 54 START test unique_stg_valuations_valuation_id ......................... [RUN]
[0m19:30:43.436839 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.not_null_stg_instruments_instrument_id.18bdfd2ebe, now test.bain_capital_analytics.unique_stg_valuations_valuation_id.fce7eb13b5)
[0m19:30:43.437170 [debug] [Thread-2  ]: Began compiling node test.bain_capital_analytics.unique_stg_valuations_valuation_id.fce7eb13b5
[0m19:30:43.437538 [debug] [Thread-3  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_valuations_valuation_id.88ca70781d"
[0m19:30:43.437869 [debug] [Thread-1  ]: Using postgres connection "test.bain_capital_analytics.unique_stg_instruments_instrument_id.0e70adcd34"
[0m19:30:43.441409 [debug] [Thread-2  ]: Writing injected SQL for node "test.bain_capital_analytics.unique_stg_valuations_valuation_id.fce7eb13b5"
[0m19:30:43.441766 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_stg_valuations_valuation_id.88ca70781d: BEGIN
[0m19:30:43.442099 [debug] [Thread-4  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_valuations_portfolio_id.d5af3e5188"
[0m19:30:43.442407 [debug] [Thread-1  ]: On test.bain_capital_analytics.unique_stg_instruments_instrument_id.0e70adcd34: BEGIN
[0m19:30:43.442767 [debug] [Thread-3  ]: Opening a new connection, currently in state closed
[0m19:30:43.443109 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_stg_valuations_portfolio_id.d5af3e5188: BEGIN
[0m19:30:43.443421 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m19:30:43.443742 [debug] [Thread-2  ]: Began executing node test.bain_capital_analytics.unique_stg_valuations_valuation_id.fce7eb13b5
[0m19:30:43.444137 [debug] [Thread-4  ]: Opening a new connection, currently in state closed
[0m19:30:43.446481 [debug] [Thread-2  ]: Writing runtime sql for node "test.bain_capital_analytics.unique_stg_valuations_valuation_id.fce7eb13b5"
[0m19:30:43.447092 [debug] [Thread-2  ]: Using postgres connection "test.bain_capital_analytics.unique_stg_valuations_valuation_id.fce7eb13b5"
[0m19:30:43.447394 [debug] [Thread-2  ]: On test.bain_capital_analytics.unique_stg_valuations_valuation_id.fce7eb13b5: BEGIN
[0m19:30:43.447669 [debug] [Thread-2  ]: Opening a new connection, currently in state closed
[0m19:30:43.457298 [debug] [Thread-3  ]: SQL status: BEGIN in 0.015 seconds
[0m19:30:43.457614 [debug] [Thread-1  ]: SQL status: BEGIN in 0.014 seconds
[0m19:30:43.457965 [debug] [Thread-4  ]: SQL status: BEGIN in 0.014 seconds
[0m19:30:43.458272 [debug] [Thread-3  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_valuations_valuation_id.88ca70781d"
[0m19:30:43.458589 [debug] [Thread-1  ]: Using postgres connection "test.bain_capital_analytics.unique_stg_instruments_instrument_id.0e70adcd34"
[0m19:30:43.458890 [debug] [Thread-2  ]: SQL status: BEGIN in 0.011 seconds
[0m19:30:43.459214 [debug] [Thread-4  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_valuations_portfolio_id.d5af3e5188"
[0m19:30:43.459543 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_stg_valuations_valuation_id.88ca70781d: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_stg_valuations_valuation_id.88ca70781d"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select valuation_id
from "bain_analytics"."public"."stg_valuations"
where valuation_id is null



  
  
      
    ) dbt_internal_test
[0m19:30:43.459894 [debug] [Thread-1  ]: On test.bain_capital_analytics.unique_stg_instruments_instrument_id.0e70adcd34: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.unique_stg_instruments_instrument_id.0e70adcd34"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

select
    instrument_id as unique_field,
    count(*) as n_records

from "bain_analytics"."public"."stg_instruments"
where instrument_id is not null
group by instrument_id
having count(*) > 1



  
  
      
    ) dbt_internal_test
[0m19:30:43.460223 [debug] [Thread-2  ]: Using postgres connection "test.bain_capital_analytics.unique_stg_valuations_valuation_id.fce7eb13b5"
[0m19:30:43.460555 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_stg_valuations_portfolio_id.d5af3e5188: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_stg_valuations_portfolio_id.d5af3e5188"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select portfolio_id
from "bain_analytics"."public"."stg_valuations"
where portfolio_id is null



  
  
      
    ) dbt_internal_test
[0m19:30:43.460977 [debug] [Thread-2  ]: On test.bain_capital_analytics.unique_stg_valuations_valuation_id.fce7eb13b5: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.unique_stg_valuations_valuation_id.fce7eb13b5"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

select
    valuation_id as unique_field,
    count(*) as n_records

from "bain_analytics"."public"."stg_valuations"
where valuation_id is not null
group by valuation_id
having count(*) > 1



  
  
      
    ) dbt_internal_test
[0m19:30:43.463412 [debug] [Thread-4  ]: SQL status: SELECT 1 in 0.002 seconds
[0m19:30:43.464661 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_stg_valuations_portfolio_id.d5af3e5188: ROLLBACK
[0m19:30:43.465008 [debug] [Thread-2  ]: SQL status: SELECT 1 in 0.004 seconds
[0m19:30:43.465299 [debug] [Thread-3  ]: SQL status: SELECT 1 in 0.004 seconds
[0m19:30:43.465660 [debug] [Thread-1  ]: SQL status: SELECT 1 in 0.005 seconds
[0m19:30:43.466738 [debug] [Thread-2  ]: On test.bain_capital_analytics.unique_stg_valuations_valuation_id.fce7eb13b5: ROLLBACK
[0m19:30:43.467033 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_stg_valuations_portfolio_id.d5af3e5188: Close
[0m19:30:43.468027 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_stg_valuations_valuation_id.88ca70781d: ROLLBACK
[0m19:30:43.469008 [debug] [Thread-1  ]: On test.bain_capital_analytics.unique_stg_instruments_instrument_id.0e70adcd34: ROLLBACK
[0m19:30:43.469519 [info ] [Thread-4  ]: 28 of 54 PASS not_null_stg_valuations_portfolio_id ............................. [[32mPASS[0m in 0.11s]
[0m19:30:43.469828 [debug] [Thread-2  ]: On test.bain_capital_analytics.unique_stg_valuations_valuation_id.fce7eb13b5: Close
[0m19:30:43.470286 [debug] [Thread-4  ]: Finished running node test.bain_capital_analytics.not_null_stg_valuations_portfolio_id.d5af3e5188
[0m19:30:43.470581 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_stg_valuations_valuation_id.88ca70781d: Close
[0m19:30:43.470851 [debug] [Thread-1  ]: On test.bain_capital_analytics.unique_stg_instruments_instrument_id.0e70adcd34: Close
[0m19:30:43.471278 [info ] [Thread-2  ]: 30 of 54 PASS unique_stg_valuations_valuation_id ............................... [[32mPASS[0m in 0.03s]
[0m19:30:43.471628 [debug] [Thread-4  ]: Began running node model.bain_capital_analytics.int_benchmark_returns
[0m19:30:43.472118 [info ] [Thread-3  ]: 29 of 54 PASS not_null_stg_valuations_valuation_id ............................. [[32mPASS[0m in 0.11s]
[0m19:30:43.472558 [info ] [Thread-1  ]: 27 of 54 PASS unique_stg_instruments_instrument_id ............................. [[32mPASS[0m in 0.11s]
[0m19:30:43.472984 [debug] [Thread-2  ]: Finished running node test.bain_capital_analytics.unique_stg_valuations_valuation_id.fce7eb13b5
[0m19:30:43.473391 [info ] [Thread-4  ]: 31 of 54 START sql view model public.int_benchmark_returns ..................... [RUN]
[0m19:30:43.473818 [debug] [Thread-3  ]: Finished running node test.bain_capital_analytics.not_null_stg_valuations_valuation_id.88ca70781d
[0m19:30:43.474219 [debug] [Thread-1  ]: Finished running node test.bain_capital_analytics.unique_stg_instruments_instrument_id.0e70adcd34
[0m19:30:43.474553 [debug] [Thread-2  ]: Began running node model.bain_capital_analytics.int_cashflow_enriched
[0m19:30:43.474923 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.not_null_stg_valuations_portfolio_id.d5af3e5188, now model.bain_capital_analytics.int_benchmark_returns)
[0m19:30:43.475564 [debug] [Thread-3  ]: Began running node model.bain_capital_analytics.int_fund_nav
[0m19:30:43.475958 [info ] [Thread-2  ]: 32 of 54 START sql view model public.int_cashflow_enriched ..................... [RUN]
[0m19:30:43.476309 [debug] [Thread-1  ]: Began running node model.bain_capital_analytics.int_irr_calculations
[0m19:30:43.476597 [debug] [Thread-4  ]: Began compiling node model.bain_capital_analytics.int_benchmark_returns
[0m19:30:43.476968 [info ] [Thread-3  ]: 33 of 54 START sql view model public.int_fund_nav .............................. [RUN]
[0m19:30:43.477312 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.unique_stg_valuations_valuation_id.fce7eb13b5, now model.bain_capital_analytics.int_cashflow_enriched)
[0m19:30:43.477689 [info ] [Thread-1  ]: 34 of 54 START sql view model public.int_irr_calculations ...................... [RUN]
[0m19:30:43.482059 [debug] [Thread-4  ]: Writing injected SQL for node "model.bain_capital_analytics.int_benchmark_returns"
[0m19:30:43.482483 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.not_null_stg_valuations_valuation_id.88ca70781d, now model.bain_capital_analytics.int_fund_nav)
[0m19:30:43.482890 [debug] [Thread-2  ]: Began compiling node model.bain_capital_analytics.int_cashflow_enriched
[0m19:30:43.483215 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.unique_stg_instruments_instrument_id.0e70adcd34, now model.bain_capital_analytics.int_irr_calculations)
[0m19:30:43.483589 [debug] [Thread-3  ]: Began compiling node model.bain_capital_analytics.int_fund_nav
[0m19:30:43.486913 [debug] [Thread-2  ]: Writing injected SQL for node "model.bain_capital_analytics.int_cashflow_enriched"
[0m19:30:43.487258 [debug] [Thread-1  ]: Began compiling node model.bain_capital_analytics.int_irr_calculations
[0m19:30:43.490345 [debug] [Thread-3  ]: Writing injected SQL for node "model.bain_capital_analytics.int_fund_nav"
[0m19:30:43.490729 [debug] [Thread-4  ]: Began executing node model.bain_capital_analytics.int_benchmark_returns
[0m19:30:43.494105 [debug] [Thread-1  ]: Writing injected SQL for node "model.bain_capital_analytics.int_irr_calculations"
[0m19:30:43.497369 [debug] [Thread-4  ]: Writing runtime sql for node "model.bain_capital_analytics.int_benchmark_returns"
[0m19:30:43.497670 [debug] [Thread-2  ]: Began executing node model.bain_capital_analytics.int_cashflow_enriched
[0m19:30:43.498107 [debug] [Thread-3  ]: Began executing node model.bain_capital_analytics.int_fund_nav
[0m19:30:43.502452 [debug] [Thread-2  ]: Writing runtime sql for node "model.bain_capital_analytics.int_cashflow_enriched"
[0m19:30:43.502813 [debug] [Thread-1  ]: Began executing node model.bain_capital_analytics.int_irr_calculations
[0m19:30:43.505842 [debug] [Thread-3  ]: Writing runtime sql for node "model.bain_capital_analytics.int_fund_nav"
[0m19:30:43.506315 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.int_benchmark_returns"
[0m19:30:43.509437 [debug] [Thread-1  ]: Writing runtime sql for node "model.bain_capital_analytics.int_irr_calculations"
[0m19:30:43.509892 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.int_cashflow_enriched"
[0m19:30:43.510191 [debug] [Thread-4  ]: On model.bain_capital_analytics.int_benchmark_returns: BEGIN
[0m19:30:43.510612 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.int_fund_nav"
[0m19:30:43.510927 [debug] [Thread-2  ]: On model.bain_capital_analytics.int_cashflow_enriched: BEGIN
[0m19:30:43.511262 [debug] [Thread-4  ]: Opening a new connection, currently in state closed
[0m19:30:43.511590 [debug] [Thread-3  ]: On model.bain_capital_analytics.int_fund_nav: BEGIN
[0m19:30:43.511911 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.int_irr_calculations"
[0m19:30:43.512212 [debug] [Thread-2  ]: Opening a new connection, currently in state closed
[0m19:30:43.512621 [debug] [Thread-3  ]: Opening a new connection, currently in state closed
[0m19:30:43.512928 [debug] [Thread-1  ]: On model.bain_capital_analytics.int_irr_calculations: BEGIN
[0m19:30:43.513406 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m19:30:43.526373 [debug] [Thread-1  ]: SQL status: BEGIN in 0.013 seconds
[0m19:30:43.526719 [debug] [Thread-2  ]: SQL status: BEGIN in 0.014 seconds
[0m19:30:43.527011 [debug] [Thread-4  ]: SQL status: BEGIN in 0.016 seconds
[0m19:30:43.527285 [debug] [Thread-3  ]: SQL status: BEGIN in 0.015 seconds
[0m19:30:43.527561 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.int_irr_calculations"
[0m19:30:43.527860 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.int_cashflow_enriched"
[0m19:30:43.528155 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.int_benchmark_returns"
[0m19:30:43.528438 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.int_fund_nav"
[0m19:30:43.528869 [debug] [Thread-1  ]: On model.bain_capital_analytics.int_irr_calculations: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.int_irr_calculations"} */

  create view "bain_analytics"."public"."int_irr_calculations__dbt_tmp"
    
    
  as (
    -- Pipeline C: Approximate IRR calculation per fund/portfolio
-- Anti-pattern: extremely deep CTE nesting (6 levels)
-- Anti-pattern: PostgreSQL-specific date arithmetic
-- Anti-pattern: complex logic that should be a macro

with cashflow_series as (
    -- CTE level 1: get all cashflows with proper signs
    select
        cf.fund_id,
        cf.portfolio_id,
        cf.cashflow_date,
        cf.cashflow_type,
        case
            when cf.cashflow_type = 'capital_call' then -1 * abs(cf.amount)
            when cf.cashflow_type = 'distribution' then abs(cf.amount)
            when cf.cashflow_type = 'management_fee' then -1 * abs(cf.amount)
            else cf.amount
        end as signed_amount
    from "bain_analytics"."public"."stg_cashflows" cf
),

terminal_values as (
    -- CTE level 2: get latest NAV as terminal cashflow
    select
        v.portfolio_id,
        p.fund_id,
        v.valuation_date as cashflow_date,
        'terminal_value' as cashflow_type,
        v.net_asset_value as signed_amount
    from "bain_analytics"."public"."stg_valuations" v
    inner join "bain_analytics"."public"."stg_portfolios" p
        on v.portfolio_id = p.portfolio_id
    where v.valuation_date = (
        -- Anti-pattern: correlated subquery instead of window function
        select max(v2.valuation_date)
        from "bain_analytics"."public"."stg_valuations" v2
        where v2.portfolio_id = v.portfolio_id
    )
),

all_cashflows as (
    -- CTE level 3: union cashflows and terminal values
    select fund_id, portfolio_id, cashflow_date, cashflow_type, signed_amount
    from cashflow_series
    union all
    select fund_id, portfolio_id, cashflow_date, cashflow_type, signed_amount
    from terminal_values
),

cashflow_with_timing as (
    -- CTE level 4: compute time fractions
    -- Anti-pattern: PostgreSQL date subtraction
    select
        ac.*,
        min(ac.cashflow_date) over (partition by ac.fund_id, ac.portfolio_id) as first_cf_date,
        (ac.cashflow_date - min(ac.cashflow_date) over (partition by ac.fund_id, ac.portfolio_id))::numeric / 365.25 as year_fraction
    from all_cashflows ac
),

-- CTE level 5: compute simple multiples as IRR proxy
portfolio_multiples as (
    select
        fund_id,
        portfolio_id,
        min(cashflow_date) as first_cashflow_date,
        max(cashflow_date) as last_cashflow_date,
        -- Anti-pattern: PostgreSQL date subtraction
        max(cashflow_date) - min(cashflow_date) as investment_days,
        (max(cashflow_date) - min(cashflow_date))::numeric / 365.25 as investment_years,
        sum(case when cashflow_type = 'capital_call' then abs(signed_amount) else 0 end) as total_invested,
        sum(case when cashflow_type = 'distribution' then signed_amount else 0 end) as total_distributed,
        sum(case when cashflow_type = 'terminal_value' then signed_amount else 0 end) as terminal_value,
        sum(signed_amount) as net_cashflow
    from cashflow_with_timing
    group by fund_id, portfolio_id
),

-- CTE level 6: compute IRR approximation
irr_approximation as (
    select
        pm.*,
        case
            when pm.total_invested > 0
            then (pm.total_distributed + pm.terminal_value) / pm.total_invested
            else null
        end as tvpi,
        case
            when pm.total_invested > 0
            then pm.total_distributed / pm.total_invested
            else null
        end as dpi,
        case
            when pm.total_invested > 0
            then pm.terminal_value / pm.total_invested
            else null
        end as rvpi,
        -- Simplified IRR approximation: (TVPI^(1/years)) - 1
        case
            when pm.total_invested > 0 and pm.investment_years > 0
            then power(
                (pm.total_distributed + pm.terminal_value) / pm.total_invested,
                1.0 / pm.investment_years
            ) - 1
            else null
        end as approx_irr
    from portfolio_multiples pm
)

select * from irr_approximation
  );
[0m19:30:43.529395 [debug] [Thread-2  ]: On model.bain_capital_analytics.int_cashflow_enriched: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.int_cashflow_enriched"} */

  create view "bain_analytics"."public"."int_cashflow_enriched__dbt_tmp"
    
    
  as (
    -- Pipeline C: Enriched cashflow data with fund and portfolio details
-- Anti-pattern: subquery for dedup instead of QUALIFY
-- Anti-pattern: joins repeated from other intermediate models

with cashflow_with_details as (
    select *
    from (
        select
            cf.*,
            p.portfolio_name,
            p.strategy,
            p.manager_name,
            fs.fund_name,
            fs.fund_type,
            fs.committed_capital,
            fs.management_fee_rate,
            fs.carry_rate,
            fs.hurdle_rate,
            -- Anti-pattern: subquery filter instead of QUALIFY
            row_number() over (
                partition by cf.cashflow_id
                order by cf.cashflow_date desc
            ) as rn
        from "bain_analytics"."public"."stg_cashflows" cf
        inner join "bain_analytics"."public"."stg_portfolios" p
            on cf.portfolio_id = p.portfolio_id
        inner join "bain_analytics"."public"."stg_fund_structures" fs
            on cf.fund_id = fs.fund_id
    ) sub
    where rn = 1
),

-- Anti-pattern: running totals computed here AND again downstream
cashflow_cumulative as (
    select
        *,
        sum(case when cashflow_type = 'capital_call' then amount else 0 end) over (
            partition by fund_id, portfolio_id
            order by cashflow_date
            rows between unbounded preceding and current row
        ) as cumulative_called,
        sum(case when cashflow_type = 'distribution' then amount else 0 end) over (
            partition by fund_id, portfolio_id
            order by cashflow_date
            rows between unbounded preceding and current row
        ) as cumulative_distributed,
        sum(amount) over (
            partition by fund_id, portfolio_id
            order by cashflow_date
            rows between unbounded preceding and current row
        ) as cumulative_net_cashflow
    from cashflow_with_details
)

select
    cashflow_id,
    fund_id,
    fund_name,
    fund_type,
    portfolio_id,
    portfolio_name,
    strategy,
    manager_name,
    cashflow_date,
    cashflow_type,
    amount,
    currency,
    description,
    investor_id,
    cashflow_fiscal_quarter,
    cashflow_year,
    committed_capital,
    management_fee_rate,
    carry_rate,
    hurdle_rate,
    cumulative_called,
    cumulative_distributed,
    cumulative_net_cashflow,
    case
        when committed_capital > 0
        then cumulative_called / committed_capital
        else 0
    end as pct_called
from cashflow_cumulative
  );
[0m19:30:43.529875 [debug] [Thread-4  ]: On model.bain_capital_analytics.int_benchmark_returns: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.int_benchmark_returns"} */

  create view "bain_analytics"."public"."int_benchmark_returns__dbt_tmp"
    
    
  as (
    -- Pipeline C: Benchmark returns with rolling calculations
-- Anti-pattern: heavy window functions that could be pre-computed

with benchmark_base as (
    select
        b.benchmark_id,
        b.benchmark_name,
        b.benchmark_date,
        b.return_daily,
        b.return_mtd,
        b.return_ytd,
        b.benchmark_level,
        b.benchmark_fiscal_quarter,
        d.fiscal_year,
        d.is_quarter_end,
        d.is_year_end
    from "bain_analytics"."public"."stg_benchmarks" b
    inner join "bain_analytics"."public"."stg_dates" d
        on b.benchmark_date = d.date_day
),

-- Anti-pattern: compute many overlapping windows
benchmark_with_rolling as (
    select
        bb.*,
        -- rolling 3-month return
        exp(sum(ln(1 + bb.return_mtd)) over (
            partition by bb.benchmark_id
            order by bb.benchmark_date
            rows between 2 preceding and current row
        )) - 1 as rolling_3m_return,
        -- rolling 6-month return
        exp(sum(ln(1 + bb.return_mtd)) over (
            partition by bb.benchmark_id
            order by bb.benchmark_date
            rows between 5 preceding and current row
        )) - 1 as rolling_6m_return,
        -- rolling 12-month return
        exp(sum(ln(1 + bb.return_mtd)) over (
            partition by bb.benchmark_id
            order by bb.benchmark_date
            rows between 11 preceding and current row
        )) - 1 as rolling_12m_return,
        -- Anti-pattern: volatility via window (expensive)
        stddev(bb.return_mtd) over (
            partition by bb.benchmark_id
            order by bb.benchmark_date
            rows between 11 preceding and current row
        ) as rolling_12m_volatility,
        avg(bb.return_mtd) over (
            partition by bb.benchmark_id
            order by bb.benchmark_date
            rows between 11 preceding and current row
        ) as rolling_12m_avg_return,
        lag(bb.benchmark_level) over (
            partition by bb.benchmark_id
            order by bb.benchmark_date
        ) as prev_benchmark_level
    from benchmark_base bb
)

select * from benchmark_with_rolling
  );
[0m19:30:43.530351 [debug] [Thread-3  ]: On model.bain_capital_analytics.int_fund_nav: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.int_fund_nav"} */

  create view "bain_analytics"."public"."int_fund_nav__dbt_tmp"
    
    
  as (
    -- Pipeline C: Fund-level NAV calculation from portfolio valuations
-- Anti-pattern: late aggregation - joins everything then aggregates at the end
-- Anti-pattern: repeated joins to fund_structures and portfolios

with portfolio_valuations as (
    select
        v.portfolio_id,
        v.valuation_date,
        v.net_asset_value,
        v.gross_asset_value,
        v.total_liabilities,
        v.unrealized_pnl,
        v.realized_pnl,
        v.valuation_method,
        p.fund_id,
        p.portfolio_name,
        p.strategy,
        -- Anti-pattern: joining fund_structures again (already done in int_cashflow_enriched)
        fs.fund_name,
        fs.fund_type,
        fs.committed_capital,
        fs.management_fee_rate
    from "bain_analytics"."public"."stg_valuations" v
    inner join "bain_analytics"."public"."stg_portfolios" p
        on v.portfolio_id = p.portfolio_id
    inner join "bain_analytics"."public"."stg_fund_structures" fs
        on p.fund_id = fs.fund_id
),

-- Anti-pattern: aggregation happens here at the end after all joins
fund_level_nav as (
    select
        fund_id,
        fund_name,
        fund_type,
        committed_capital,
        management_fee_rate,
        valuation_date,
        sum(net_asset_value) as fund_nav,
        sum(gross_asset_value) as fund_gav,
        sum(total_liabilities) as fund_total_liabilities,
        sum(unrealized_pnl) as fund_unrealized_pnl,
        sum(realized_pnl) as fund_realized_pnl,
        count(distinct portfolio_id) as num_portfolios
    from portfolio_valuations
    group by
        fund_id, fund_name, fund_type, committed_capital,
        management_fee_rate, valuation_date
),

fund_nav_with_changes as (
    select
        fn.*,
        lag(fn.fund_nav) over (
            partition by fn.fund_id order by fn.valuation_date
        ) as prev_fund_nav,
        case
            when lag(fn.fund_nav) over (
                partition by fn.fund_id order by fn.valuation_date
            ) is not null
            and lag(fn.fund_nav) over (
                partition by fn.fund_id order by fn.valuation_date
            ) != 0
            then (fn.fund_nav - lag(fn.fund_nav) over (
                partition by fn.fund_id order by fn.valuation_date
            )) / lag(fn.fund_nav) over (
                partition by fn.fund_id order by fn.valuation_date
            )
            else null
        end as fund_nav_return,
        fn.fund_nav / nullif(fn.committed_capital, 0) as tvpi_gross
    from fund_level_nav fn
)

select * from fund_nav_with_changes
  );
[0m19:30:43.537541 [debug] [Thread-4  ]: SQL status: CREATE VIEW in 0.007 seconds
[0m19:30:43.540462 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.int_benchmark_returns"
[0m19:30:43.540776 [debug] [Thread-3  ]: SQL status: CREATE VIEW in 0.010 seconds
[0m19:30:43.541068 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.010 seconds
[0m19:30:43.541367 [debug] [Thread-4  ]: On model.bain_capital_analytics.int_benchmark_returns: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.int_benchmark_returns"} */
alter table "bain_analytics"."public"."int_benchmark_returns__dbt_tmp" rename to "int_benchmark_returns"
[0m19:30:43.541655 [debug] [Thread-2  ]: SQL status: CREATE VIEW in 0.011 seconds
[0m19:30:43.544405 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.int_fund_nav"
[0m19:30:43.547184 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.int_irr_calculations"
[0m19:30:43.550949 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.int_cashflow_enriched"
[0m19:30:43.551290 [debug] [Thread-4  ]: SQL status: ALTER TABLE in 0.004 seconds
[0m19:30:43.551595 [debug] [Thread-3  ]: On model.bain_capital_analytics.int_fund_nav: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.int_fund_nav"} */
alter table "bain_analytics"."public"."int_fund_nav__dbt_tmp" rename to "int_fund_nav"
[0m19:30:43.551919 [debug] [Thread-1  ]: On model.bain_capital_analytics.int_irr_calculations: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.int_irr_calculations"} */
alter table "bain_analytics"."public"."int_irr_calculations__dbt_tmp" rename to "int_irr_calculations"
[0m19:30:43.552238 [debug] [Thread-2  ]: On model.bain_capital_analytics.int_cashflow_enriched: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.int_cashflow_enriched"} */
alter table "bain_analytics"."public"."int_cashflow_enriched__dbt_tmp" rename to "int_cashflow_enriched"
[0m19:30:43.553308 [debug] [Thread-4  ]: On model.bain_capital_analytics.int_benchmark_returns: COMMIT
[0m19:30:43.553746 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.int_benchmark_returns"
[0m19:30:43.554061 [debug] [Thread-4  ]: On model.bain_capital_analytics.int_benchmark_returns: COMMIT
[0m19:30:43.554646 [debug] [Thread-3  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m19:30:43.554958 [debug] [Thread-2  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m19:30:43.555250 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.002 seconds
[0m19:30:43.556187 [debug] [Thread-3  ]: On model.bain_capital_analytics.int_fund_nav: COMMIT
[0m19:30:43.556487 [debug] [Thread-4  ]: SQL status: COMMIT in 0.002 seconds
[0m19:30:43.557375 [debug] [Thread-2  ]: On model.bain_capital_analytics.int_cashflow_enriched: COMMIT
[0m19:30:43.558265 [debug] [Thread-1  ]: On model.bain_capital_analytics.int_irr_calculations: COMMIT
[0m19:30:43.558570 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.int_fund_nav"
[0m19:30:43.560782 [debug] [Thread-4  ]: Applying DROP to: "bain_analytics"."public"."int_benchmark_returns__dbt_backup"
[0m19:30:43.561105 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.int_cashflow_enriched"
[0m19:30:43.561400 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.int_irr_calculations"
[0m19:30:43.561687 [debug] [Thread-3  ]: On model.bain_capital_analytics.int_fund_nav: COMMIT
[0m19:30:43.562146 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.int_benchmark_returns"
[0m19:30:43.562448 [debug] [Thread-2  ]: On model.bain_capital_analytics.int_cashflow_enriched: COMMIT
[0m19:30:43.562736 [debug] [Thread-1  ]: On model.bain_capital_analytics.int_irr_calculations: COMMIT
[0m19:30:43.563073 [debug] [Thread-4  ]: On model.bain_capital_analytics.int_benchmark_returns: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.int_benchmark_returns"} */
drop view if exists "bain_analytics"."public"."int_benchmark_returns__dbt_backup" cascade
[0m19:30:43.564323 [debug] [Thread-4  ]: SQL status: DROP VIEW in 0.001 seconds
[0m19:30:43.564626 [debug] [Thread-3  ]: SQL status: COMMIT in 0.002 seconds
[0m19:30:43.565683 [debug] [Thread-4  ]: On model.bain_capital_analytics.int_benchmark_returns: Close
[0m19:30:43.566017 [debug] [Thread-2  ]: SQL status: COMMIT in 0.003 seconds
[0m19:30:43.568162 [debug] [Thread-3  ]: Applying DROP to: "bain_analytics"."public"."int_fund_nav__dbt_backup"
[0m19:30:43.568452 [debug] [Thread-1  ]: SQL status: COMMIT in 0.005 seconds
[0m19:30:43.568985 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b0af5ff2-0eab-40ce-a1a4-bdad63de4622', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1101d9fd0>]}
[0m19:30:43.571071 [debug] [Thread-2  ]: Applying DROP to: "bain_analytics"."public"."int_cashflow_enriched__dbt_backup"
[0m19:30:43.571580 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.int_fund_nav"
[0m19:30:43.573662 [debug] [Thread-1  ]: Applying DROP to: "bain_analytics"."public"."int_irr_calculations__dbt_backup"
[0m19:30:43.574237 [info ] [Thread-4  ]: 31 of 54 OK created sql view model public.int_benchmark_returns ................ [[32mCREATE VIEW[0m in 0.09s]
[0m19:30:43.574729 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.int_cashflow_enriched"
[0m19:30:43.575061 [debug] [Thread-3  ]: On model.bain_capital_analytics.int_fund_nav: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.int_fund_nav"} */
drop view if exists "bain_analytics"."public"."int_fund_nav__dbt_backup" cascade
[0m19:30:43.575520 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.int_irr_calculations"
[0m19:30:43.575971 [debug] [Thread-4  ]: Finished running node model.bain_capital_analytics.int_benchmark_returns
[0m19:30:43.576291 [debug] [Thread-2  ]: On model.bain_capital_analytics.int_cashflow_enriched: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.int_cashflow_enriched"} */
drop view if exists "bain_analytics"."public"."int_cashflow_enriched__dbt_backup" cascade
[0m19:30:43.576647 [debug] [Thread-1  ]: On model.bain_capital_analytics.int_irr_calculations: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.int_irr_calculations"} */
drop view if exists "bain_analytics"."public"."int_irr_calculations__dbt_backup" cascade
[0m19:30:43.577001 [debug] [Thread-4  ]: Began running node model.bain_capital_analytics.int_valuation_enriched
[0m19:30:43.577603 [info ] [Thread-4  ]: 35 of 54 START sql view model public.int_valuation_enriched .................... [RUN]
[0m19:30:43.577979 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly model.bain_capital_analytics.int_benchmark_returns, now model.bain_capital_analytics.int_valuation_enriched)
[0m19:30:43.578296 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.001 seconds
[0m19:30:43.578588 [debug] [Thread-2  ]: SQL status: DROP VIEW in 0.001 seconds
[0m19:30:43.578865 [debug] [Thread-3  ]: SQL status: DROP VIEW in 0.002 seconds
[0m19:30:43.579146 [debug] [Thread-4  ]: Began compiling node model.bain_capital_analytics.int_valuation_enriched
[0m19:30:43.580120 [debug] [Thread-1  ]: On model.bain_capital_analytics.int_irr_calculations: Close
[0m19:30:43.581041 [debug] [Thread-2  ]: On model.bain_capital_analytics.int_cashflow_enriched: Close
[0m19:30:43.581949 [debug] [Thread-3  ]: On model.bain_capital_analytics.int_fund_nav: Close
[0m19:30:43.586246 [debug] [Thread-4  ]: Writing injected SQL for node "model.bain_capital_analytics.int_valuation_enriched"
[0m19:30:43.586865 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b0af5ff2-0eab-40ce-a1a4-bdad63de4622', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11030ba60>]}
[0m19:30:43.587149 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b0af5ff2-0eab-40ce-a1a4-bdad63de4622', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1102e45e0>]}
[0m19:30:43.587615 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b0af5ff2-0eab-40ce-a1a4-bdad63de4622', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109e1f370>]}
[0m19:30:43.588146 [info ] [Thread-2  ]: 32 of 54 OK created sql view model public.int_cashflow_enriched ................ [[32mCREATE VIEW[0m in 0.11s]
[0m19:30:43.588695 [info ] [Thread-1  ]: 34 of 54 OK created sql view model public.int_irr_calculations ................. [[32mCREATE VIEW[0m in 0.10s]
[0m19:30:43.589232 [info ] [Thread-3  ]: 33 of 54 OK created sql view model public.int_fund_nav ......................... [[32mCREATE VIEW[0m in 0.11s]
[0m19:30:43.589763 [debug] [Thread-2  ]: Finished running node model.bain_capital_analytics.int_cashflow_enriched
[0m19:30:43.590055 [debug] [Thread-4  ]: Began executing node model.bain_capital_analytics.int_valuation_enriched
[0m19:30:43.590460 [debug] [Thread-1  ]: Finished running node model.bain_capital_analytics.int_irr_calculations
[0m19:30:43.590861 [debug] [Thread-3  ]: Finished running node model.bain_capital_analytics.int_fund_nav
[0m19:30:43.591201 [debug] [Thread-2  ]: Began running node model.bain_capital_analytics.int_portfolio_attribution
[0m19:30:43.594513 [debug] [Thread-4  ]: Writing runtime sql for node "model.bain_capital_analytics.int_valuation_enriched"
[0m19:30:43.594933 [debug] [Thread-1  ]: Began running node test.bain_capital_analytics.not_null_int_benchmark_returns_benchmark_id.fa96f53b44
[0m19:30:43.595303 [debug] [Thread-3  ]: Began running node test.bain_capital_analytics.not_null_int_cashflow_enriched_cashflow_id.8460e9066d
[0m19:30:43.595788 [info ] [Thread-2  ]: 36 of 54 START sql view model public.int_portfolio_attribution ................. [RUN]
[0m19:30:43.596233 [info ] [Thread-1  ]: 37 of 54 START test not_null_int_benchmark_returns_benchmark_id ................ [RUN]
[0m19:30:43.596599 [info ] [Thread-3  ]: 38 of 54 START test not_null_int_cashflow_enriched_cashflow_id ................. [RUN]
[0m19:30:43.596982 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly model.bain_capital_analytics.int_cashflow_enriched, now model.bain_capital_analytics.int_portfolio_attribution)
[0m19:30:43.597344 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.int_valuation_enriched"
[0m19:30:43.597662 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.bain_capital_analytics.int_irr_calculations, now test.bain_capital_analytics.not_null_int_benchmark_returns_benchmark_id.fa96f53b44)
[0m19:30:43.597981 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly model.bain_capital_analytics.int_fund_nav, now test.bain_capital_analytics.not_null_int_cashflow_enriched_cashflow_id.8460e9066d)
[0m19:30:43.598286 [debug] [Thread-2  ]: Began compiling node model.bain_capital_analytics.int_portfolio_attribution
[0m19:30:43.598584 [debug] [Thread-4  ]: On model.bain_capital_analytics.int_valuation_enriched: BEGIN
[0m19:30:43.598974 [debug] [Thread-1  ]: Began compiling node test.bain_capital_analytics.not_null_int_benchmark_returns_benchmark_id.fa96f53b44
[0m19:30:43.599278 [debug] [Thread-3  ]: Began compiling node test.bain_capital_analytics.not_null_int_cashflow_enriched_cashflow_id.8460e9066d
[0m19:30:43.602449 [debug] [Thread-2  ]: Writing injected SQL for node "model.bain_capital_analytics.int_portfolio_attribution"
[0m19:30:43.602771 [debug] [Thread-4  ]: Opening a new connection, currently in state closed
[0m19:30:43.606116 [debug] [Thread-1  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_int_benchmark_returns_benchmark_id.fa96f53b44"
[0m19:30:43.609434 [debug] [Thread-3  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_int_cashflow_enriched_cashflow_id.8460e9066d"
[0m19:30:43.610071 [debug] [Thread-2  ]: Began executing node model.bain_capital_analytics.int_portfolio_attribution
[0m19:30:43.614380 [debug] [Thread-2  ]: Writing runtime sql for node "model.bain_capital_analytics.int_portfolio_attribution"
[0m19:30:43.614832 [debug] [Thread-1  ]: Began executing node test.bain_capital_analytics.not_null_int_benchmark_returns_benchmark_id.fa96f53b44
[0m19:30:43.615149 [debug] [Thread-3  ]: Began executing node test.bain_capital_analytics.not_null_int_cashflow_enriched_cashflow_id.8460e9066d
[0m19:30:43.617444 [debug] [Thread-1  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_int_benchmark_returns_benchmark_id.fa96f53b44"
[0m19:30:43.619626 [debug] [Thread-3  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_int_cashflow_enriched_cashflow_id.8460e9066d"
[0m19:30:43.619966 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.int_portfolio_attribution"
[0m19:30:43.620436 [debug] [Thread-2  ]: On model.bain_capital_analytics.int_portfolio_attribution: BEGIN
[0m19:30:43.620795 [debug] [Thread-2  ]: Opening a new connection, currently in state closed
[0m19:30:43.621136 [debug] [Thread-1  ]: Using postgres connection "test.bain_capital_analytics.not_null_int_benchmark_returns_benchmark_id.fa96f53b44"
[0m19:30:43.621563 [debug] [Thread-4  ]: SQL status: BEGIN in 0.019 seconds
[0m19:30:43.621905 [debug] [Thread-3  ]: Using postgres connection "test.bain_capital_analytics.not_null_int_cashflow_enriched_cashflow_id.8460e9066d"
[0m19:30:43.622201 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_int_benchmark_returns_benchmark_id.fa96f53b44: BEGIN
[0m19:30:43.622519 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.int_valuation_enriched"
[0m19:30:43.622825 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_int_cashflow_enriched_cashflow_id.8460e9066d: BEGIN
[0m19:30:43.623131 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m19:30:43.623506 [debug] [Thread-4  ]: On model.bain_capital_analytics.int_valuation_enriched: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.int_valuation_enriched"} */

  create view "bain_analytics"."public"."int_valuation_enriched__dbt_tmp"
    
    
  as (
    -- Pipeline C: Enriched valuation data
-- Anti-pattern: subquery for dedup instead of QUALIFY
-- Anti-pattern: repeated portfolio join
-- Anti-pattern: PostgreSQL-specific date functions

with valuation_ranked as (
    select *
    from (
        select
            v.*,
            p.portfolio_name,
            p.strategy,
            p.fund_id,
            p.manager_name,
            -- Anti-pattern: subquery dedup instead of QUALIFY
            row_number() over (
                partition by v.portfolio_id, v.valuation_date
                order by v.valuation_id desc
            ) as rn
        from "bain_analytics"."public"."stg_valuations" v
        inner join "bain_analytics"."public"."stg_portfolios" p
            on v.portfolio_id = p.portfolio_id
    ) sub
    where rn = 1
),

valuation_with_changes as (
    select
        vr.*,
        lag(vr.net_asset_value) over (
            partition by vr.portfolio_id order by vr.valuation_date
        ) as prev_nav,
        case
            when lag(vr.net_asset_value) over (
                partition by vr.portfolio_id order by vr.valuation_date
            ) is not null
            and lag(vr.net_asset_value) over (
                partition by vr.portfolio_id order by vr.valuation_date
            ) != 0
            then (vr.net_asset_value - lag(vr.net_asset_value) over (
                partition by vr.portfolio_id order by vr.valuation_date
            )) / lag(vr.net_asset_value) over (
                partition by vr.portfolio_id order by vr.valuation_date
            )
            else null
        end as nav_return_pct,
        -- Anti-pattern: PostgreSQL date subtraction
        vr.valuation_date - lag(vr.valuation_date) over (
            partition by vr.portfolio_id order by vr.valuation_date
        ) as days_between_valuations
    from valuation_ranked vr
)

select * from valuation_with_changes
  );
[0m19:30:43.623870 [debug] [Thread-3  ]: Opening a new connection, currently in state closed
[0m19:30:43.630363 [debug] [Thread-2  ]: SQL status: BEGIN in 0.010 seconds
[0m19:30:43.630674 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.int_portfolio_attribution"
[0m19:30:43.631080 [debug] [Thread-2  ]: On model.bain_capital_analytics.int_portfolio_attribution: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.int_portfolio_attribution"} */

  create view "bain_analytics"."public"."int_portfolio_attribution__dbt_tmp"
    
    
  as (
    -- Pipeline C: Portfolio performance attribution by sector and instrument type
-- Anti-pattern: deep CTE chain, repeated joins, late aggregation
-- Anti-pattern: same position-instrument-portfolio joins as int_daily_positions

with positions_enriched as (
    -- Anti-pattern: repeating the same 3-way join as int_daily_positions
    select
        pos.position_id,
        pos.portfolio_id,
        pos.instrument_id,
        pos.position_date,
        pos.quantity,
        pos.market_value,
        pos.cost_basis,
        pos.unrealized_gain_loss,
        i.instrument_name,
        i.instrument_type,
        i.sector,
        p.portfolio_name,
        p.strategy,
        p.fund_id
    from "bain_analytics"."public"."stg_positions" pos
    inner join "bain_analytics"."public"."stg_instruments" i
        on pos.instrument_id = i.instrument_id
    inner join "bain_analytics"."public"."stg_portfolios" p
        on pos.portfolio_id = p.portfolio_id
),

-- Anti-pattern: compute portfolio totals in a separate CTE instead of a single pass
portfolio_totals as (
    select
        portfolio_id,
        position_date,
        sum(market_value) as total_portfolio_mv,
        sum(unrealized_gain_loss) as total_portfolio_ugl
    from positions_enriched
    group by portfolio_id, position_date
),

-- Anti-pattern: sector aggregation in yet another CTE
sector_attribution as (
    select
        pe.portfolio_id,
        pe.portfolio_name,
        pe.strategy,
        pe.fund_id,
        pe.position_date,
        pe.sector,
        sum(pe.market_value) as sector_mv,
        sum(pe.unrealized_gain_loss) as sector_ugl,
        count(distinct pe.instrument_id) as num_instruments
    from positions_enriched pe
    group by
        pe.portfolio_id, pe.portfolio_name, pe.strategy,
        pe.fund_id, pe.position_date, pe.sector
),

-- Anti-pattern: joining back to get weights instead of computing in one pass
attribution_with_weights as (
    select
        sa.*,
        pt.total_portfolio_mv,
        pt.total_portfolio_ugl,
        case
            when pt.total_portfolio_mv != 0
            then sa.sector_mv / pt.total_portfolio_mv
            else 0
        end as sector_weight,
        case
            when pt.total_portfolio_ugl != 0
            then sa.sector_ugl / pt.total_portfolio_ugl
            else 0
        end as sector_contribution
    from sector_attribution sa
    inner join portfolio_totals pt
        on sa.portfolio_id = pt.portfolio_id
        and sa.position_date = pt.position_date
)

select * from attribution_with_weights
  );
[0m19:30:43.631505 [debug] [Thread-4  ]: SQL status: CREATE VIEW in 0.007 seconds
[0m19:30:43.634331 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.int_valuation_enriched"
[0m19:30:43.634690 [debug] [Thread-4  ]: On model.bain_capital_analytics.int_valuation_enriched: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.int_valuation_enriched"} */
alter table "bain_analytics"."public"."int_valuation_enriched__dbt_tmp" rename to "int_valuation_enriched"
[0m19:30:43.635419 [debug] [Thread-1  ]: SQL status: BEGIN in 0.012 seconds
[0m19:30:43.635731 [debug] [Thread-1  ]: Using postgres connection "test.bain_capital_analytics.not_null_int_benchmark_returns_benchmark_id.fa96f53b44"
[0m19:30:43.636031 [debug] [Thread-4  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m19:30:43.636310 [debug] [Thread-3  ]: SQL status: BEGIN in 0.012 seconds
[0m19:30:43.636599 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_int_benchmark_returns_benchmark_id.fa96f53b44: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_int_benchmark_returns_benchmark_id.fa96f53b44"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select benchmark_id
from "bain_analytics"."public"."int_benchmark_returns"
where benchmark_id is null



  
  
      
    ) dbt_internal_test
[0m19:30:43.637651 [debug] [Thread-4  ]: On model.bain_capital_analytics.int_valuation_enriched: COMMIT
[0m19:30:43.637969 [debug] [Thread-3  ]: Using postgres connection "test.bain_capital_analytics.not_null_int_cashflow_enriched_cashflow_id.8460e9066d"
[0m19:30:43.638284 [debug] [Thread-2  ]: SQL status: CREATE VIEW in 0.006 seconds
[0m19:30:43.638619 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.int_valuation_enriched"
[0m19:30:43.638935 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_int_cashflow_enriched_cashflow_id.8460e9066d: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_int_cashflow_enriched_cashflow_id.8460e9066d"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select cashflow_id
from "bain_analytics"."public"."int_cashflow_enriched"
where cashflow_id is null



  
  
      
    ) dbt_internal_test
[0m19:30:43.641488 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.int_portfolio_attribution"
[0m19:30:43.641811 [debug] [Thread-1  ]: SQL status: SELECT 1 in 0.003 seconds
[0m19:30:43.642099 [debug] [Thread-4  ]: On model.bain_capital_analytics.int_valuation_enriched: COMMIT
[0m19:30:43.642447 [debug] [Thread-2  ]: On model.bain_capital_analytics.int_portfolio_attribution: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.int_portfolio_attribution"} */
alter table "bain_analytics"."public"."int_portfolio_attribution__dbt_tmp" rename to "int_portfolio_attribution"
[0m19:30:43.643659 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_int_benchmark_returns_benchmark_id.fa96f53b44: ROLLBACK
[0m19:30:43.644354 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_int_benchmark_returns_benchmark_id.fa96f53b44: Close
[0m19:30:43.644853 [info ] [Thread-1  ]: 37 of 54 PASS not_null_int_benchmark_returns_benchmark_id ...................... [[32mPASS[0m in 0.05s]
[0m19:30:43.645191 [debug] [Thread-4  ]: SQL status: COMMIT in 0.001 seconds
[0m19:30:43.645474 [debug] [Thread-2  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m19:30:43.645876 [debug] [Thread-1  ]: Finished running node test.bain_capital_analytics.not_null_int_benchmark_returns_benchmark_id.fa96f53b44
[0m19:30:43.648081 [debug] [Thread-4  ]: Applying DROP to: "bain_analytics"."public"."int_valuation_enriched__dbt_backup"
[0m19:30:43.648411 [debug] [Thread-3  ]: SQL status: SELECT 1 in 0.006 seconds
[0m19:30:43.649380 [debug] [Thread-2  ]: On model.bain_capital_analytics.int_portfolio_attribution: COMMIT
[0m19:30:43.649742 [debug] [Thread-1  ]: Began running node test.bain_capital_analytics.unique_int_cashflow_enriched_cashflow_id.6944893c17
[0m19:30:43.650273 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.int_valuation_enriched"
[0m19:30:43.651383 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_int_cashflow_enriched_cashflow_id.8460e9066d: ROLLBACK
[0m19:30:43.651706 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.int_portfolio_attribution"
[0m19:30:43.652030 [info ] [Thread-1  ]: 39 of 54 START test unique_int_cashflow_enriched_cashflow_id ................... [RUN]
[0m19:30:43.652375 [debug] [Thread-4  ]: On model.bain_capital_analytics.int_valuation_enriched: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.int_valuation_enriched"} */
drop view if exists "bain_analytics"."public"."int_valuation_enriched__dbt_backup" cascade
[0m19:30:43.652727 [debug] [Thread-2  ]: On model.bain_capital_analytics.int_portfolio_attribution: COMMIT
[0m19:30:43.653084 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.not_null_int_benchmark_returns_benchmark_id.fa96f53b44, now test.bain_capital_analytics.unique_int_cashflow_enriched_cashflow_id.6944893c17)
[0m19:30:43.653389 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_int_cashflow_enriched_cashflow_id.8460e9066d: Close
[0m19:30:43.653752 [debug] [Thread-1  ]: Began compiling node test.bain_capital_analytics.unique_int_cashflow_enriched_cashflow_id.6944893c17
[0m19:30:43.654206 [info ] [Thread-3  ]: 38 of 54 PASS not_null_int_cashflow_enriched_cashflow_id ....................... [[32mPASS[0m in 0.06s]
[0m19:30:43.654522 [debug] [Thread-4  ]: SQL status: DROP VIEW in 0.001 seconds
[0m19:30:43.659294 [debug] [Thread-1  ]: Writing injected SQL for node "test.bain_capital_analytics.unique_int_cashflow_enriched_cashflow_id.6944893c17"
[0m19:30:43.659608 [debug] [Thread-2  ]: SQL status: COMMIT in 0.006 seconds
[0m19:30:43.660068 [debug] [Thread-3  ]: Finished running node test.bain_capital_analytics.not_null_int_cashflow_enriched_cashflow_id.8460e9066d
[0m19:30:43.661107 [debug] [Thread-4  ]: On model.bain_capital_analytics.int_valuation_enriched: Close
[0m19:30:43.663373 [debug] [Thread-2  ]: Applying DROP to: "bain_analytics"."public"."int_portfolio_attribution__dbt_backup"
[0m19:30:43.663714 [debug] [Thread-3  ]: Began running node test.bain_capital_analytics.not_null_int_irr_calculations_fund_id.35702f5be3
[0m19:30:43.664282 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b0af5ff2-0eab-40ce-a1a4-bdad63de4622', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10af10f70>]}
[0m19:30:43.664745 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.int_portfolio_attribution"
[0m19:30:43.665038 [debug] [Thread-1  ]: Began executing node test.bain_capital_analytics.unique_int_cashflow_enriched_cashflow_id.6944893c17
[0m19:30:43.665352 [info ] [Thread-3  ]: 40 of 54 START test not_null_int_irr_calculations_fund_id ...................... [RUN]
[0m19:30:43.665861 [debug] [Thread-2  ]: On model.bain_capital_analytics.int_portfolio_attribution: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.int_portfolio_attribution"} */
drop view if exists "bain_analytics"."public"."int_portfolio_attribution__dbt_backup" cascade
[0m19:30:43.666355 [info ] [Thread-4  ]: 35 of 54 OK created sql view model public.int_valuation_enriched ............... [[32mCREATE VIEW[0m in 0.09s]
[0m19:30:43.668649 [debug] [Thread-1  ]: Writing runtime sql for node "test.bain_capital_analytics.unique_int_cashflow_enriched_cashflow_id.6944893c17"
[0m19:30:43.668999 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.not_null_int_cashflow_enriched_cashflow_id.8460e9066d, now test.bain_capital_analytics.not_null_int_irr_calculations_fund_id.35702f5be3)
[0m19:30:43.669477 [debug] [Thread-4  ]: Finished running node model.bain_capital_analytics.int_valuation_enriched
[0m19:30:43.669850 [debug] [Thread-2  ]: SQL status: DROP VIEW in 0.001 seconds
[0m19:30:43.670179 [debug] [Thread-3  ]: Began compiling node test.bain_capital_analytics.not_null_int_irr_calculations_fund_id.35702f5be3
[0m19:30:43.670548 [debug] [Thread-4  ]: Began running node test.bain_capital_analytics.not_null_int_irr_calculations_portfolio_id.5530046e4d
[0m19:30:43.671611 [debug] [Thread-2  ]: On model.bain_capital_analytics.int_portfolio_attribution: Close
[0m19:30:43.672039 [debug] [Thread-1  ]: Using postgres connection "test.bain_capital_analytics.unique_int_cashflow_enriched_cashflow_id.6944893c17"
[0m19:30:43.675444 [debug] [Thread-3  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_int_irr_calculations_fund_id.35702f5be3"
[0m19:30:43.675780 [info ] [Thread-4  ]: 41 of 54 START test not_null_int_irr_calculations_portfolio_id ................. [RUN]
[0m19:30:43.676272 [debug] [Thread-1  ]: On test.bain_capital_analytics.unique_int_cashflow_enriched_cashflow_id.6944893c17: BEGIN
[0m19:30:43.676574 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b0af5ff2-0eab-40ce-a1a4-bdad63de4622', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110193bb0>]}
[0m19:30:43.676990 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly model.bain_capital_analytics.int_valuation_enriched, now test.bain_capital_analytics.not_null_int_irr_calculations_portfolio_id.5530046e4d)
[0m19:30:43.677323 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m19:30:43.677699 [debug] [Thread-3  ]: Began executing node test.bain_capital_analytics.not_null_int_irr_calculations_fund_id.35702f5be3
[0m19:30:43.678003 [debug] [Thread-4  ]: Began compiling node test.bain_capital_analytics.not_null_int_irr_calculations_portfolio_id.5530046e4d
[0m19:30:43.678430 [info ] [Thread-2  ]: 36 of 54 OK created sql view model public.int_portfolio_attribution ............ [[32mCREATE VIEW[0m in 0.08s]
[0m19:30:43.680885 [debug] [Thread-3  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_int_irr_calculations_fund_id.35702f5be3"
[0m19:30:43.684527 [debug] [Thread-4  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_int_irr_calculations_portfolio_id.5530046e4d"
[0m19:30:43.685051 [debug] [Thread-2  ]: Finished running node model.bain_capital_analytics.int_portfolio_attribution
[0m19:30:43.685593 [debug] [Thread-2  ]: Began running node test.bain_capital_analytics.not_null_int_fund_nav_fund_id.ebf0b6cc99
[0m19:30:43.686068 [info ] [Thread-2  ]: 42 of 54 START test not_null_int_fund_nav_fund_id .............................. [RUN]
[0m19:30:43.686516 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly model.bain_capital_analytics.int_portfolio_attribution, now test.bain_capital_analytics.not_null_int_fund_nav_fund_id.ebf0b6cc99)
[0m19:30:43.686867 [debug] [Thread-4  ]: Began executing node test.bain_capital_analytics.not_null_int_irr_calculations_portfolio_id.5530046e4d
[0m19:30:43.687186 [debug] [Thread-2  ]: Began compiling node test.bain_capital_analytics.not_null_int_fund_nav_fund_id.ebf0b6cc99
[0m19:30:43.687543 [debug] [Thread-3  ]: Using postgres connection "test.bain_capital_analytics.not_null_int_irr_calculations_fund_id.35702f5be3"
[0m19:30:43.687841 [debug] [Thread-1  ]: SQL status: BEGIN in 0.011 seconds
[0m19:30:43.691323 [debug] [Thread-4  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_int_irr_calculations_portfolio_id.5530046e4d"
[0m19:30:43.694848 [debug] [Thread-2  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_int_fund_nav_fund_id.ebf0b6cc99"
[0m19:30:43.695188 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_int_irr_calculations_fund_id.35702f5be3: BEGIN
[0m19:30:43.695504 [debug] [Thread-1  ]: Using postgres connection "test.bain_capital_analytics.unique_int_cashflow_enriched_cashflow_id.6944893c17"
[0m19:30:43.695963 [debug] [Thread-3  ]: Opening a new connection, currently in state closed
[0m19:30:43.696369 [debug] [Thread-1  ]: On test.bain_capital_analytics.unique_int_cashflow_enriched_cashflow_id.6944893c17: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.unique_int_cashflow_enriched_cashflow_id.6944893c17"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

select
    cashflow_id as unique_field,
    count(*) as n_records

from "bain_analytics"."public"."int_cashflow_enriched"
where cashflow_id is not null
group by cashflow_id
having count(*) > 1



  
  
      
    ) dbt_internal_test
[0m19:30:43.696871 [debug] [Thread-2  ]: Began executing node test.bain_capital_analytics.not_null_int_fund_nav_fund_id.ebf0b6cc99
[0m19:30:43.697247 [debug] [Thread-4  ]: Using postgres connection "test.bain_capital_analytics.not_null_int_irr_calculations_portfolio_id.5530046e4d"
[0m19:30:43.699568 [debug] [Thread-2  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_int_fund_nav_fund_id.ebf0b6cc99"
[0m19:30:43.699892 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_int_irr_calculations_portfolio_id.5530046e4d: BEGIN
[0m19:30:43.700258 [debug] [Thread-4  ]: Opening a new connection, currently in state closed
[0m19:30:43.700714 [debug] [Thread-2  ]: Using postgres connection "test.bain_capital_analytics.not_null_int_fund_nav_fund_id.ebf0b6cc99"
[0m19:30:43.701010 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_int_fund_nav_fund_id.ebf0b6cc99: BEGIN
[0m19:30:43.701286 [debug] [Thread-2  ]: Opening a new connection, currently in state closed
[0m19:30:43.701904 [debug] [Thread-1  ]: SQL status: SELECT 1 in 0.005 seconds
[0m19:30:43.703176 [debug] [Thread-1  ]: On test.bain_capital_analytics.unique_int_cashflow_enriched_cashflow_id.6944893c17: ROLLBACK
[0m19:30:43.703762 [debug] [Thread-1  ]: On test.bain_capital_analytics.unique_int_cashflow_enriched_cashflow_id.6944893c17: Close
[0m19:30:43.704255 [info ] [Thread-1  ]: 39 of 54 PASS unique_int_cashflow_enriched_cashflow_id ......................... [[32mPASS[0m in 0.05s]
[0m19:30:43.704807 [debug] [Thread-1  ]: Finished running node test.bain_capital_analytics.unique_int_cashflow_enriched_cashflow_id.6944893c17
[0m19:30:43.705145 [debug] [Thread-1  ]: Began running node test.bain_capital_analytics.not_null_int_valuation_enriched_valuation_id.048a7ba03a
[0m19:30:43.705473 [debug] [Thread-3  ]: SQL status: BEGIN in 0.010 seconds
[0m19:30:43.705806 [info ] [Thread-1  ]: 43 of 54 START test not_null_int_valuation_enriched_valuation_id ............... [RUN]
[0m19:30:43.706298 [debug] [Thread-3  ]: Using postgres connection "test.bain_capital_analytics.not_null_int_irr_calculations_fund_id.35702f5be3"
[0m19:30:43.706651 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.unique_int_cashflow_enriched_cashflow_id.6944893c17, now test.bain_capital_analytics.not_null_int_valuation_enriched_valuation_id.048a7ba03a)
[0m19:30:43.706986 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_int_irr_calculations_fund_id.35702f5be3: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_int_irr_calculations_fund_id.35702f5be3"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select fund_id
from "bain_analytics"."public"."int_irr_calculations"
where fund_id is null



  
  
      
    ) dbt_internal_test
[0m19:30:43.707319 [debug] [Thread-1  ]: Began compiling node test.bain_capital_analytics.not_null_int_valuation_enriched_valuation_id.048a7ba03a
[0m19:30:43.711220 [debug] [Thread-1  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_int_valuation_enriched_valuation_id.048a7ba03a"
[0m19:30:43.711852 [debug] [Thread-1  ]: Began executing node test.bain_capital_analytics.not_null_int_valuation_enriched_valuation_id.048a7ba03a
[0m19:30:43.712171 [debug] [Thread-4  ]: SQL status: BEGIN in 0.012 seconds
[0m19:30:43.712493 [debug] [Thread-3  ]: SQL status: SELECT 1 in 0.005 seconds
[0m19:30:43.712786 [debug] [Thread-2  ]: SQL status: BEGIN in 0.011 seconds
[0m19:30:43.715190 [debug] [Thread-1  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_int_valuation_enriched_valuation_id.048a7ba03a"
[0m19:30:43.715570 [debug] [Thread-4  ]: Using postgres connection "test.bain_capital_analytics.not_null_int_irr_calculations_portfolio_id.5530046e4d"
[0m19:30:43.716878 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_int_irr_calculations_fund_id.35702f5be3: ROLLBACK
[0m19:30:43.717213 [debug] [Thread-2  ]: Using postgres connection "test.bain_capital_analytics.not_null_int_fund_nav_fund_id.ebf0b6cc99"
[0m19:30:43.717655 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_int_irr_calculations_portfolio_id.5530046e4d: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_int_irr_calculations_portfolio_id.5530046e4d"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select portfolio_id
from "bain_analytics"."public"."int_irr_calculations"
where portfolio_id is null



  
  
      
    ) dbt_internal_test
[0m19:30:43.718080 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_int_fund_nav_fund_id.ebf0b6cc99: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_int_fund_nav_fund_id.ebf0b6cc99"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select fund_id
from "bain_analytics"."public"."int_fund_nav"
where fund_id is null



  
  
      
    ) dbt_internal_test
[0m19:30:43.718398 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_int_irr_calculations_fund_id.35702f5be3: Close
[0m19:30:43.718744 [debug] [Thread-1  ]: Using postgres connection "test.bain_capital_analytics.not_null_int_valuation_enriched_valuation_id.048a7ba03a"
[0m19:30:43.719319 [info ] [Thread-3  ]: 40 of 54 PASS not_null_int_irr_calculations_fund_id ............................ [[32mPASS[0m in 0.05s]
[0m19:30:43.719673 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_int_valuation_enriched_valuation_id.048a7ba03a: BEGIN
[0m19:30:43.720108 [debug] [Thread-3  ]: Finished running node test.bain_capital_analytics.not_null_int_irr_calculations_fund_id.35702f5be3
[0m19:30:43.720410 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m19:30:43.720765 [debug] [Thread-3  ]: Began running node test.bain_capital_analytics.not_null_int_portfolio_attribution_portfolio_id.3e04b7c210
[0m19:30:43.721254 [info ] [Thread-3  ]: 44 of 54 START test not_null_int_portfolio_attribution_portfolio_id ............ [RUN]
[0m19:30:43.721623 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.not_null_int_irr_calculations_fund_id.35702f5be3, now test.bain_capital_analytics.not_null_int_portfolio_attribution_portfolio_id.3e04b7c210)
[0m19:30:43.721926 [debug] [Thread-3  ]: Began compiling node test.bain_capital_analytics.not_null_int_portfolio_attribution_portfolio_id.3e04b7c210
[0m19:30:43.726776 [debug] [Thread-3  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_int_portfolio_attribution_portfolio_id.3e04b7c210"
[0m19:30:43.727156 [debug] [Thread-2  ]: SQL status: SELECT 1 in 0.008 seconds
[0m19:30:43.727540 [debug] [Thread-4  ]: SQL status: SELECT 1 in 0.008 seconds
[0m19:30:43.728754 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_int_fund_nav_fund_id.ebf0b6cc99: ROLLBACK
[0m19:30:43.729838 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_int_irr_calculations_portfolio_id.5530046e4d: ROLLBACK
[0m19:30:43.730282 [debug] [Thread-3  ]: Began executing node test.bain_capital_analytics.not_null_int_portfolio_attribution_portfolio_id.3e04b7c210
[0m19:30:43.730576 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_int_fund_nav_fund_id.ebf0b6cc99: Close
[0m19:30:43.730890 [debug] [Thread-1  ]: SQL status: BEGIN in 0.010 seconds
[0m19:30:43.731201 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_int_irr_calculations_portfolio_id.5530046e4d: Close
[0m19:30:43.733664 [debug] [Thread-3  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_int_portfolio_attribution_portfolio_id.3e04b7c210"
[0m19:30:43.734444 [debug] [Thread-1  ]: Using postgres connection "test.bain_capital_analytics.not_null_int_valuation_enriched_valuation_id.048a7ba03a"
[0m19:30:43.734178 [info ] [Thread-2  ]: 42 of 54 PASS not_null_int_fund_nav_fund_id .................................... [[32mPASS[0m in 0.05s]
[0m19:30:43.734989 [info ] [Thread-4  ]: 41 of 54 PASS not_null_int_irr_calculations_portfolio_id ....................... [[32mPASS[0m in 0.06s]
[0m19:30:43.735409 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_int_valuation_enriched_valuation_id.048a7ba03a: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_int_valuation_enriched_valuation_id.048a7ba03a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select valuation_id
from "bain_analytics"."public"."int_valuation_enriched"
where valuation_id is null



  
  
      
    ) dbt_internal_test
[0m19:30:43.735880 [debug] [Thread-2  ]: Finished running node test.bain_capital_analytics.not_null_int_fund_nav_fund_id.ebf0b6cc99
[0m19:30:43.736317 [debug] [Thread-4  ]: Finished running node test.bain_capital_analytics.not_null_int_irr_calculations_portfolio_id.5530046e4d
[0m19:30:43.736737 [debug] [Thread-2  ]: Began running node model.bain_capital_analytics.fact_cashflow_waterfall
[0m19:30:43.737086 [debug] [Thread-3  ]: Using postgres connection "test.bain_capital_analytics.not_null_int_portfolio_attribution_portfolio_id.3e04b7c210"
[0m19:30:43.737746 [info ] [Thread-2  ]: 45 of 54 START sql view model public.fact_cashflow_waterfall ................... [RUN]
[0m19:30:43.738097 [debug] [Thread-4  ]: Began running node model.bain_capital_analytics.fact_fund_performance
[0m19:30:43.738412 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_int_portfolio_attribution_portfolio_id.3e04b7c210: BEGIN
[0m19:30:43.738777 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.not_null_int_fund_nav_fund_id.ebf0b6cc99, now model.bain_capital_analytics.fact_cashflow_waterfall)
[0m19:30:43.739179 [info ] [Thread-4  ]: 46 of 54 START sql view model public.fact_fund_performance ..................... [RUN]
[0m19:30:43.739510 [debug] [Thread-3  ]: Opening a new connection, currently in state closed
[0m19:30:43.739819 [debug] [Thread-2  ]: Began compiling node model.bain_capital_analytics.fact_cashflow_waterfall
[0m19:30:43.740142 [debug] [Thread-1  ]: SQL status: SELECT 1 in 0.003 seconds
[0m19:30:43.740464 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.not_null_int_irr_calculations_portfolio_id.5530046e4d, now model.bain_capital_analytics.fact_fund_performance)
[0m19:30:43.743878 [debug] [Thread-2  ]: Writing injected SQL for node "model.bain_capital_analytics.fact_cashflow_waterfall"
[0m19:30:43.745092 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_int_valuation_enriched_valuation_id.048a7ba03a: ROLLBACK
[0m19:30:43.745425 [debug] [Thread-4  ]: Began compiling node model.bain_capital_analytics.fact_fund_performance
[0m19:30:43.748838 [debug] [Thread-4  ]: Writing injected SQL for node "model.bain_capital_analytics.fact_fund_performance"
[0m19:30:43.749374 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_int_valuation_enriched_valuation_id.048a7ba03a: Close
[0m19:30:43.750430 [debug] [Thread-3  ]: SQL status: BEGIN in 0.011 seconds
[0m19:30:43.750769 [debug] [Thread-2  ]: Began executing node model.bain_capital_analytics.fact_cashflow_waterfall
[0m19:30:43.750067 [info ] [Thread-1  ]: 43 of 54 PASS not_null_int_valuation_enriched_valuation_id ..................... [[32mPASS[0m in 0.04s]
[0m19:30:43.751173 [debug] [Thread-3  ]: Using postgres connection "test.bain_capital_analytics.not_null_int_portfolio_attribution_portfolio_id.3e04b7c210"
[0m19:30:43.755019 [debug] [Thread-2  ]: Writing runtime sql for node "model.bain_capital_analytics.fact_cashflow_waterfall"
[0m19:30:43.755519 [debug] [Thread-1  ]: Finished running node test.bain_capital_analytics.not_null_int_valuation_enriched_valuation_id.048a7ba03a
[0m19:30:43.755852 [debug] [Thread-4  ]: Began executing node model.bain_capital_analytics.fact_fund_performance
[0m19:30:43.756176 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_int_portfolio_attribution_portfolio_id.3e04b7c210: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_int_portfolio_attribution_portfolio_id.3e04b7c210"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select portfolio_id
from "bain_analytics"."public"."int_portfolio_attribution"
where portfolio_id is null



  
  
      
    ) dbt_internal_test
[0m19:30:43.756621 [debug] [Thread-1  ]: Began running node model.bain_capital_analytics.report_lp_quarterly
[0m19:30:43.760974 [debug] [Thread-4  ]: Writing runtime sql for node "model.bain_capital_analytics.fact_fund_performance"
[0m19:30:43.761388 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.fact_cashflow_waterfall"
[0m19:30:43.761800 [info ] [Thread-1  ]: 47 of 54 START sql view model public.report_lp_quarterly ....................... [RUN]
[0m19:30:43.762230 [debug] [Thread-2  ]: On model.bain_capital_analytics.fact_cashflow_waterfall: BEGIN
[0m19:30:43.762615 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.not_null_int_valuation_enriched_valuation_id.048a7ba03a, now model.bain_capital_analytics.report_lp_quarterly)
[0m19:30:43.762930 [debug] [Thread-2  ]: Opening a new connection, currently in state closed
[0m19:30:43.763271 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.fact_fund_performance"
[0m19:30:43.763577 [debug] [Thread-1  ]: Began compiling node model.bain_capital_analytics.report_lp_quarterly
[0m19:30:43.763978 [debug] [Thread-4  ]: On model.bain_capital_analytics.fact_fund_performance: BEGIN
[0m19:30:43.768132 [debug] [Thread-1  ]: Writing injected SQL for node "model.bain_capital_analytics.report_lp_quarterly"
[0m19:30:43.768516 [debug] [Thread-3  ]: SQL status: SELECT 1 in 0.007 seconds
[0m19:30:43.768837 [debug] [Thread-4  ]: Opening a new connection, currently in state closed
[0m19:30:43.770178 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_int_portfolio_attribution_portfolio_id.3e04b7c210: ROLLBACK
[0m19:30:43.770749 [debug] [Thread-1  ]: Began executing node model.bain_capital_analytics.report_lp_quarterly
[0m19:30:43.771069 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_int_portfolio_attribution_portfolio_id.3e04b7c210: Close
[0m19:30:43.774447 [debug] [Thread-1  ]: Writing runtime sql for node "model.bain_capital_analytics.report_lp_quarterly"
[0m19:30:43.775040 [info ] [Thread-3  ]: 44 of 54 PASS not_null_int_portfolio_attribution_portfolio_id .................. [[32mPASS[0m in 0.05s]
[0m19:30:43.775396 [debug] [Thread-2  ]: SQL status: BEGIN in 0.012 seconds
[0m19:30:43.775896 [debug] [Thread-3  ]: Finished running node test.bain_capital_analytics.not_null_int_portfolio_attribution_portfolio_id.3e04b7c210
[0m19:30:43.776224 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.fact_cashflow_waterfall"
[0m19:30:43.776926 [debug] [Thread-2  ]: On model.bain_capital_analytics.fact_cashflow_waterfall: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.fact_cashflow_waterfall"} */

  create view "bain_analytics"."public"."fact_cashflow_waterfall__dbt_tmp"
    
    
  as (
    -- Pipeline C: FACT table - Cashflow waterfall for PE/fund reporting
-- Anti-pattern: deep CTEs, repeated joins, late aggregation
-- Anti-pattern: PostgreSQL-specific date functions

with enriched_cashflows as (
    select
        ce.cashflow_id,
        ce.fund_id,
        ce.fund_name,
        ce.fund_type,
        ce.portfolio_id,
        ce.portfolio_name,
        ce.cashflow_date,
        ce.cashflow_type,
        ce.amount,
        ce.investor_id,
        ce.committed_capital,
        ce.management_fee_rate,
        ce.carry_rate,
        ce.hurdle_rate,
        ce.cumulative_called,
        ce.cumulative_distributed,
        ce.cumulative_net_cashflow,
        ce.pct_called,
        -- Anti-pattern: duplicated fiscal quarter logic
        case
            when extract(month from ce.cashflow_date) between 1 and 3 then 'Q3'
            when extract(month from ce.cashflow_date) between 4 and 6 then 'Q4'
            when extract(month from ce.cashflow_date) between 7 and 9 then 'Q1'
            when extract(month from ce.cashflow_date) between 10 and 12 then 'Q2'
        end as fiscal_quarter,
        -- Anti-pattern: PostgreSQL extract
        extract(year from ce.cashflow_date) as calendar_year
    from "bain_analytics"."public"."int_cashflow_enriched" ce
),

-- Anti-pattern: re-joining valuations when int_valuation_enriched already has this
waterfall_with_nav as (
    select
        ecf.*,
        v.net_asset_value,
        v.gross_asset_value,
        v.unrealized_pnl as nav_unrealized_pnl,
        v.realized_pnl as nav_realized_pnl
    from enriched_cashflows ecf
    left join "bain_analytics"."public"."stg_valuations" v
        on ecf.portfolio_id = v.portfolio_id
        and ecf.cashflow_date = v.valuation_date
),

-- Anti-pattern: computing carry/waterfall in a CTE chain instead of a macro
waterfall_calculations as (
    select
        wn.*,
        -- Simplified carry calculation
        case
            when wn.cumulative_distributed > wn.cumulative_called * (1 + wn.hurdle_rate)
            then (wn.cumulative_distributed - wn.cumulative_called * (1 + wn.hurdle_rate)) * wn.carry_rate
            else 0
        end as estimated_carry,
        wn.cumulative_called * wn.management_fee_rate as annual_mgmt_fee,
        case
            when wn.cumulative_called > 0
            then wn.cumulative_distributed / wn.cumulative_called
            else 0
        end as dpi,
        case
            when wn.cumulative_called > 0 and wn.net_asset_value is not null
            then (wn.cumulative_distributed + wn.net_asset_value) / wn.cumulative_called
            else null
        end as tvpi
    from waterfall_with_nav wn
)

select * from waterfall_calculations
  );
[0m19:30:43.777488 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.report_lp_quarterly"
[0m19:30:43.777886 [debug] [Thread-4  ]: SQL status: BEGIN in 0.009 seconds
[0m19:30:43.778212 [debug] [Thread-3  ]: Began running node model.bain_capital_analytics.fact_portfolio_attribution
[0m19:30:43.778553 [debug] [Thread-1  ]: On model.bain_capital_analytics.report_lp_quarterly: BEGIN
[0m19:30:43.778873 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.fact_fund_performance"
[0m19:30:43.779293 [info ] [Thread-3  ]: 48 of 54 START sql view model public.fact_portfolio_attribution ................ [RUN]
[0m19:30:43.779625 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m19:30:43.780039 [debug] [Thread-4  ]: On model.bain_capital_analytics.fact_fund_performance: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.fact_fund_performance"} */

  create view "bain_analytics"."public"."fact_fund_performance__dbt_tmp"
    
    
  as (
    -- Pipeline C: FACT table - Fund-level performance metrics
-- Anti-pattern: late aggregation - joins everything then aggregates
-- Anti-pattern: re-joins fund_structures (already in int_fund_nav, int_cashflow_enriched)
-- Anti-pattern: materialized as view (should be table)

with fund_nav_data as (
    select
        fn.fund_id,
        fn.fund_name,
        fn.fund_type,
        fn.committed_capital,
        fn.valuation_date,
        fn.fund_nav,
        fn.fund_gav,
        fn.fund_total_liabilities,
        fn.fund_unrealized_pnl,
        fn.fund_realized_pnl,
        fn.fund_nav_return,
        fn.tvpi_gross,
        fn.num_portfolios
    from "bain_analytics"."public"."int_fund_nav" fn
),

fund_cashflows as (
    -- Anti-pattern: re-aggregating cashflows that are already in int_cashflow_enriched
    select
        cf.fund_id,
        cf.cashflow_date,
        sum(case when cf.cashflow_type = 'capital_call' then cf.amount else 0 end) as period_calls,
        sum(case when cf.cashflow_type = 'distribution' then cf.amount else 0 end) as period_distributions,
        sum(case when cf.cashflow_type = 'management_fee' then cf.amount else 0 end) as period_fees,
        sum(cf.amount) as period_net_cashflow
    from "bain_analytics"."public"."stg_cashflows" cf
    group by cf.fund_id, cf.cashflow_date
),

fund_irr as (
    select
        irr.fund_id,
        sum(irr.total_invested) as fund_total_invested,
        sum(irr.total_distributed) as fund_total_distributed,
        sum(irr.terminal_value) as fund_terminal_value,
        -- Anti-pattern: averaging portfolio IRRs as proxy for fund IRR (incorrect but intentional)
        avg(irr.approx_irr) as fund_approx_irr,
        avg(irr.tvpi) as fund_tvpi,
        avg(irr.dpi) as fund_dpi
    from "bain_analytics"."public"."int_irr_calculations" irr
    group by irr.fund_id
),

-- Anti-pattern: joining everything together at the end
combined as (
    select
        fn.fund_id,
        fn.fund_name,
        fn.fund_type,
        fn.committed_capital,
        fn.valuation_date,
        fn.fund_nav,
        fn.fund_gav,
        fn.fund_total_liabilities,
        fn.fund_unrealized_pnl,
        fn.fund_realized_pnl,
        fn.fund_nav_return,
        fn.tvpi_gross,
        fn.num_portfolios,
        coalesce(fc.period_calls, 0) as period_calls,
        coalesce(fc.period_distributions, 0) as period_distributions,
        coalesce(fc.period_fees, 0) as period_fees,
        coalesce(fc.period_net_cashflow, 0) as period_net_cashflow,
        fi.fund_total_invested,
        fi.fund_total_distributed,
        fi.fund_approx_irr,
        fi.fund_tvpi,
        fi.fund_dpi
    from fund_nav_data fn
    left join fund_cashflows fc
        on fn.fund_id = fc.fund_id
        and fn.valuation_date = fc.cashflow_date
    left join fund_irr fi
        on fn.fund_id = fi.fund_id
)

select * from combined
  );
[0m19:30:43.780487 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.not_null_int_portfolio_attribution_portfolio_id.3e04b7c210, now model.bain_capital_analytics.fact_portfolio_attribution)
[0m19:30:43.780936 [debug] [Thread-3  ]: Began compiling node model.bain_capital_analytics.fact_portfolio_attribution
[0m19:30:43.784319 [debug] [Thread-3  ]: Writing injected SQL for node "model.bain_capital_analytics.fact_portfolio_attribution"
[0m19:30:43.784683 [debug] [Thread-2  ]: SQL status: CREATE VIEW in 0.006 seconds
[0m19:30:43.787560 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.fact_cashflow_waterfall"
[0m19:30:43.787891 [debug] [Thread-4  ]: SQL status: CREATE VIEW in 0.007 seconds
[0m19:30:43.788196 [debug] [Thread-2  ]: On model.bain_capital_analytics.fact_cashflow_waterfall: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.fact_cashflow_waterfall"} */
alter table "bain_analytics"."public"."fact_cashflow_waterfall__dbt_tmp" rename to "fact_cashflow_waterfall"
[0m19:30:43.790921 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.fact_fund_performance"
[0m19:30:43.791252 [debug] [Thread-1  ]: SQL status: BEGIN in 0.012 seconds
[0m19:30:43.791608 [debug] [Thread-3  ]: Began executing node model.bain_capital_analytics.fact_portfolio_attribution
[0m19:30:43.791928 [debug] [Thread-4  ]: On model.bain_capital_analytics.fact_fund_performance: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.fact_fund_performance"} */
alter table "bain_analytics"."public"."fact_fund_performance__dbt_tmp" rename to "fact_fund_performance"
[0m19:30:43.792258 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.report_lp_quarterly"
[0m19:30:43.792581 [debug] [Thread-2  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m19:30:43.796874 [debug] [Thread-3  ]: Writing runtime sql for node "model.bain_capital_analytics.fact_portfolio_attribution"
[0m19:30:43.797393 [debug] [Thread-1  ]: On model.bain_capital_analytics.report_lp_quarterly: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.report_lp_quarterly"} */

  create view "bain_analytics"."public"."report_lp_quarterly__dbt_tmp"
    
    
  as (
    -- Pipeline C: REPORT table - LP quarterly reporting
-- Anti-pattern: massive query, duplicated logic, no reuse of intermediates
-- Anti-pattern: PostgreSQL-specific date_trunc
-- Anti-pattern: re-aggregation of data already aggregated upstream

with quarterly_cashflows as (
    -- Anti-pattern: re-aggregating cashflows by quarter (already in int_cashflow_enriched)
    select
        cf.fund_id,
        cf.portfolio_id,
        -- Anti-pattern: PostgreSQL-specific date_trunc
        date_trunc('quarter', cf.cashflow_date) as quarter_start,
        cf.cashflow_fiscal_quarter as fiscal_quarter,
        cf.cashflow_year,
        sum(case when cf.cashflow_type = 'capital_call' then cf.amount else 0 end) as quarter_calls,
        sum(case when cf.cashflow_type = 'distribution' then cf.amount else 0 end) as quarter_distributions,
        sum(case when cf.cashflow_type = 'management_fee' then cf.amount else 0 end) as quarter_fees,
        sum(cf.amount) as quarter_net
    from "bain_analytics"."public"."stg_cashflows" cf
    group by
        cf.fund_id, cf.portfolio_id,
        date_trunc('quarter', cf.cashflow_date),
        cf.cashflow_fiscal_quarter, cf.cashflow_year
),

quarterly_valuations as (
    -- Anti-pattern: re-querying valuations with subquery for quarter-end
    select *
    from (
        select
            v.portfolio_id,
            v.valuation_date,
            v.net_asset_value,
            v.gross_asset_value,
            v.unrealized_pnl,
            v.realized_pnl,
            v.valuation_method,
            -- Anti-pattern: subquery dedup instead of QUALIFY
            row_number() over (
                partition by v.portfolio_id, date_trunc('quarter', v.valuation_date)
                order by v.valuation_date desc
            ) as rn
        from "bain_analytics"."public"."stg_valuations" v
    ) sub
    where rn = 1
),

-- Anti-pattern: re-joining fund structures (done in multiple places)
fund_details as (
    select
        fs.fund_id,
        fs.fund_name,
        fs.fund_type,
        fs.committed_capital,
        fs.management_fee_rate,
        fs.carry_rate,
        fs.hurdle_rate,
        fs.vintage_year,
        fs.gp_commitment_pct
    from "bain_analytics"."public"."stg_fund_structures" fs
),

-- Anti-pattern: joining everything at the end
lp_report as (
    select
        fd.fund_id,
        fd.fund_name,
        fd.fund_type,
        fd.vintage_year,
        fd.committed_capital,
        fd.management_fee_rate,
        fd.carry_rate,
        fd.hurdle_rate,
        fd.gp_commitment_pct,
        qc.portfolio_id,
        p.portfolio_name,
        p.strategy,
        qc.quarter_start,
        qc.fiscal_quarter,
        qc.cashflow_year,
        qc.quarter_calls,
        qc.quarter_distributions,
        qc.quarter_fees,
        qc.quarter_net,
        qv.net_asset_value as quarter_end_nav,
        qv.gross_asset_value as quarter_end_gav,
        qv.unrealized_pnl,
        qv.realized_pnl,
        qv.valuation_method,
        -- Anti-pattern: IRR re-joined from separate calculation
        irr.approx_irr,
        irr.tvpi,
        irr.dpi,
        irr.rvpi
    from quarterly_cashflows qc
    inner join fund_details fd
        on qc.fund_id = fd.fund_id
    inner join "bain_analytics"."public"."stg_portfolios" p
        on qc.portfolio_id = p.portfolio_id
    left join quarterly_valuations qv
        on qc.portfolio_id = qv.portfolio_id
        and date_trunc('quarter', qv.valuation_date) = qc.quarter_start
    left join "bain_analytics"."public"."int_irr_calculations" irr
        on qc.fund_id = irr.fund_id
        and qc.portfolio_id = irr.portfolio_id
)

select
    *,
    -- Anti-pattern: computed columns in final select
    case
        when committed_capital > 0
        then quarter_calls / committed_capital
        else 0
    end as quarterly_drawdown_rate,
    case
        when quarter_end_nav is not null and committed_capital > 0
        then quarter_end_nav / committed_capital
        else null
    end as nav_to_commitment_ratio
from lp_report
order by fund_id, portfolio_id, quarter_start
  );
[0m19:30:43.798663 [debug] [Thread-2  ]: On model.bain_capital_analytics.fact_cashflow_waterfall: COMMIT
[0m19:30:43.799000 [debug] [Thread-4  ]: SQL status: ALTER TABLE in 0.002 seconds
[0m19:30:43.799437 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.fact_cashflow_waterfall"
[0m19:30:43.800435 [debug] [Thread-4  ]: On model.bain_capital_analytics.fact_fund_performance: COMMIT
[0m19:30:43.800782 [debug] [Thread-2  ]: On model.bain_capital_analytics.fact_cashflow_waterfall: COMMIT
[0m19:30:43.801125 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.fact_portfolio_attribution"
[0m19:30:43.801443 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.fact_fund_performance"
[0m19:30:43.801792 [debug] [Thread-3  ]: On model.bain_capital_analytics.fact_portfolio_attribution: BEGIN
[0m19:30:43.802105 [debug] [Thread-4  ]: On model.bain_capital_analytics.fact_fund_performance: COMMIT
[0m19:30:43.802408 [debug] [Thread-3  ]: Opening a new connection, currently in state closed
[0m19:30:43.802705 [debug] [Thread-2  ]: SQL status: COMMIT in 0.001 seconds
[0m19:30:43.805082 [debug] [Thread-2  ]: Applying DROP to: "bain_analytics"."public"."fact_cashflow_waterfall__dbt_backup"
[0m19:30:43.805419 [debug] [Thread-4  ]: SQL status: COMMIT in 0.002 seconds
[0m19:30:43.805773 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.006 seconds
[0m19:30:43.806291 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.fact_cashflow_waterfall"
[0m19:30:43.808376 [debug] [Thread-4  ]: Applying DROP to: "bain_analytics"."public"."fact_fund_performance__dbt_backup"
[0m19:30:43.810962 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.report_lp_quarterly"
[0m19:30:43.811302 [debug] [Thread-2  ]: On model.bain_capital_analytics.fact_cashflow_waterfall: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.fact_cashflow_waterfall"} */
drop view if exists "bain_analytics"."public"."fact_cashflow_waterfall__dbt_backup" cascade
[0m19:30:43.811795 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.fact_fund_performance"
[0m19:30:43.812111 [debug] [Thread-3  ]: SQL status: BEGIN in 0.010 seconds
[0m19:30:43.812424 [debug] [Thread-1  ]: On model.bain_capital_analytics.report_lp_quarterly: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.report_lp_quarterly"} */
alter table "bain_analytics"."public"."report_lp_quarterly__dbt_tmp" rename to "report_lp_quarterly"
[0m19:30:43.812797 [debug] [Thread-4  ]: On model.bain_capital_analytics.fact_fund_performance: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.fact_fund_performance"} */
drop view if exists "bain_analytics"."public"."fact_fund_performance__dbt_backup" cascade
[0m19:30:43.813118 [debug] [Thread-2  ]: SQL status: DROP VIEW in 0.000 seconds
[0m19:30:43.813394 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.fact_portfolio_attribution"
[0m19:30:43.814481 [debug] [Thread-2  ]: On model.bain_capital_analytics.fact_cashflow_waterfall: Close
[0m19:30:43.814788 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m19:30:43.815187 [debug] [Thread-3  ]: On model.bain_capital_analytics.fact_portfolio_attribution: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.fact_portfolio_attribution"} */

  create view "bain_analytics"."public"."fact_portfolio_attribution__dbt_tmp"
    
    
  as (
    -- Pipeline C: FACT table - Portfolio attribution with benchmark comparison
-- Anti-pattern: re-joins data that's already in intermediate models
-- Anti-pattern: repeated computation of sector weights

with attribution as (
    select
        pa.portfolio_id,
        pa.portfolio_name,
        pa.strategy,
        pa.fund_id,
        pa.position_date,
        pa.sector,
        pa.sector_mv,
        pa.sector_ugl,
        pa.num_instruments,
        pa.total_portfolio_mv,
        pa.total_portfolio_ugl,
        pa.sector_weight,
        pa.sector_contribution
    from "bain_analytics"."public"."int_portfolio_attribution" pa
),

-- Anti-pattern: re-joining benchmarks (could be done in intermediate)
attribution_with_benchmark as (
    select
        a.*,
        bm.benchmark_name,
        bm.return_mtd as benchmark_return,
        bm.rolling_3m_return as benchmark_3m_return,
        bm.rolling_12m_return as benchmark_12m_return
    from attribution a
    left join "bain_analytics"."public"."int_benchmark_returns" bm
        on a.position_date = bm.benchmark_date
        and bm.benchmark_id = 'BM_SP500'
),

-- Anti-pattern: computing alpha in yet another CTE
attribution_with_alpha as (
    select
        ab.*,
        -- Simplified active return
        case
            when ab.total_portfolio_mv != 0
            then (ab.sector_ugl / ab.total_portfolio_mv) - coalesce(ab.benchmark_return, 0) * ab.sector_weight
            else 0
        end as sector_active_return,
        -- Anti-pattern: re-computing portfolio-level return here
        case
            when ab.total_portfolio_mv != 0
            then ab.total_portfolio_ugl / ab.total_portfolio_mv
            else 0
        end as portfolio_return
    from attribution_with_benchmark ab
)

select * from attribution_with_alpha
  );
[0m19:30:43.815543 [debug] [Thread-4  ]: SQL status: DROP VIEW in 0.002 seconds
[0m19:30:43.816690 [debug] [Thread-1  ]: On model.bain_capital_analytics.report_lp_quarterly: COMMIT
[0m19:30:43.817021 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b0af5ff2-0eab-40ce-a1a4-bdad63de4622', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110330730>]}
[0m19:30:43.818057 [debug] [Thread-4  ]: On model.bain_capital_analytics.fact_fund_performance: Close
[0m19:30:43.818370 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.report_lp_quarterly"
[0m19:30:43.818940 [info ] [Thread-2  ]: 45 of 54 OK created sql view model public.fact_cashflow_waterfall .............. [[32mCREATE VIEW[0m in 0.08s]
[0m19:30:43.819432 [debug] [Thread-1  ]: On model.bain_capital_analytics.report_lp_quarterly: COMMIT
[0m19:30:43.819737 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b0af5ff2-0eab-40ce-a1a4-bdad63de4622', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110155700>]}
[0m19:30:43.820183 [debug] [Thread-2  ]: Finished running node model.bain_capital_analytics.fact_cashflow_waterfall
[0m19:30:43.820704 [info ] [Thread-4  ]: 46 of 54 OK created sql view model public.fact_fund_performance ................ [[32mCREATE VIEW[0m in 0.08s]
[0m19:30:43.821303 [debug] [Thread-4  ]: Finished running node model.bain_capital_analytics.fact_fund_performance
[0m19:30:43.821627 [debug] [Thread-3  ]: SQL status: CREATE VIEW in 0.004 seconds
[0m19:30:43.821931 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m19:30:43.822391 [debug] [Thread-2  ]: Began running node test.bain_capital_analytics.not_null_fact_cashflow_waterfall_cashflow_id.7aafd60486
[0m19:30:43.825141 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.fact_portfolio_attribution"
[0m19:30:43.828182 [debug] [Thread-1  ]: Applying DROP to: "bain_analytics"."public"."report_lp_quarterly__dbt_backup"
[0m19:30:43.828484 [debug] [Thread-4  ]: Began running node test.bain_capital_analytics.not_null_fact_fund_performance_fund_id.738d6489c4
[0m19:30:43.828802 [info ] [Thread-2  ]: 49 of 54 START test not_null_fact_cashflow_waterfall_cashflow_id ............... [RUN]
[0m19:30:43.829177 [debug] [Thread-3  ]: On model.bain_capital_analytics.fact_portfolio_attribution: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.fact_portfolio_attribution"} */
alter table "bain_analytics"."public"."fact_portfolio_attribution__dbt_tmp" rename to "fact_portfolio_attribution"
[0m19:30:43.829727 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.report_lp_quarterly"
[0m19:30:43.830071 [info ] [Thread-4  ]: 50 of 54 START test not_null_fact_fund_performance_fund_id ..................... [RUN]
[0m19:30:43.830445 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly model.bain_capital_analytics.fact_cashflow_waterfall, now test.bain_capital_analytics.not_null_fact_cashflow_waterfall_cashflow_id.7aafd60486)
[0m19:30:43.830813 [debug] [Thread-1  ]: On model.bain_capital_analytics.report_lp_quarterly: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.report_lp_quarterly"} */
drop view if exists "bain_analytics"."public"."report_lp_quarterly__dbt_backup" cascade
[0m19:30:43.831173 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly model.bain_capital_analytics.fact_fund_performance, now test.bain_capital_analytics.not_null_fact_fund_performance_fund_id.738d6489c4)
[0m19:30:43.831513 [debug] [Thread-3  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m19:30:43.831836 [debug] [Thread-2  ]: Began compiling node test.bain_capital_analytics.not_null_fact_cashflow_waterfall_cashflow_id.7aafd60486
[0m19:30:43.832185 [debug] [Thread-4  ]: Began compiling node test.bain_capital_analytics.not_null_fact_fund_performance_fund_id.738d6489c4
[0m19:30:43.833203 [debug] [Thread-3  ]: On model.bain_capital_analytics.fact_portfolio_attribution: COMMIT
[0m19:30:43.833493 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.001 seconds
[0m19:30:43.884573 [debug] [Thread-2  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_fact_cashflow_waterfall_cashflow_id.7aafd60486"
[0m19:30:43.888234 [debug] [Thread-4  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_fact_fund_performance_fund_id.738d6489c4"
[0m19:30:43.888630 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.fact_portfolio_attribution"
[0m19:30:43.889802 [debug] [Thread-1  ]: On model.bain_capital_analytics.report_lp_quarterly: Close
[0m19:30:43.890270 [debug] [Thread-3  ]: On model.bain_capital_analytics.fact_portfolio_attribution: COMMIT
[0m19:30:43.890862 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b0af5ff2-0eab-40ce-a1a4-bdad63de4622', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11004b160>]}
[0m19:30:43.891332 [debug] [Thread-2  ]: Began executing node test.bain_capital_analytics.not_null_fact_cashflow_waterfall_cashflow_id.7aafd60486
[0m19:30:43.891834 [info ] [Thread-1  ]: 47 of 54 OK created sql view model public.report_lp_quarterly .................. [[32mCREATE VIEW[0m in 0.13s]
[0m19:30:43.894207 [debug] [Thread-2  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_fact_cashflow_waterfall_cashflow_id.7aafd60486"
[0m19:30:43.894562 [debug] [Thread-3  ]: SQL status: COMMIT in 0.004 seconds
[0m19:30:43.894986 [debug] [Thread-1  ]: Finished running node model.bain_capital_analytics.report_lp_quarterly
[0m19:30:43.895274 [debug] [Thread-4  ]: Began executing node test.bain_capital_analytics.not_null_fact_fund_performance_fund_id.738d6489c4
[0m19:30:43.897542 [debug] [Thread-3  ]: Applying DROP to: "bain_analytics"."public"."fact_portfolio_attribution__dbt_backup"
[0m19:30:43.898071 [debug] [Thread-1  ]: Began running node test.bain_capital_analytics.not_null_report_lp_quarterly_fund_id.aa355f6583
[0m19:30:43.900328 [debug] [Thread-4  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_fact_fund_performance_fund_id.738d6489c4"
[0m19:30:43.900825 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.fact_portfolio_attribution"
[0m19:30:43.901182 [debug] [Thread-2  ]: Using postgres connection "test.bain_capital_analytics.not_null_fact_cashflow_waterfall_cashflow_id.7aafd60486"
[0m19:30:43.901496 [info ] [Thread-1  ]: 51 of 54 START test not_null_report_lp_quarterly_fund_id ....................... [RUN]
[0m19:30:43.901899 [debug] [Thread-3  ]: On model.bain_capital_analytics.fact_portfolio_attribution: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.fact_portfolio_attribution"} */
drop view if exists "bain_analytics"."public"."fact_portfolio_attribution__dbt_backup" cascade
[0m19:30:43.902244 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_fact_cashflow_waterfall_cashflow_id.7aafd60486: BEGIN
[0m19:30:43.902597 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.bain_capital_analytics.report_lp_quarterly, now test.bain_capital_analytics.not_null_report_lp_quarterly_fund_id.aa355f6583)
[0m19:30:43.902942 [debug] [Thread-4  ]: Using postgres connection "test.bain_capital_analytics.not_null_fact_fund_performance_fund_id.738d6489c4"
[0m19:30:43.903270 [debug] [Thread-2  ]: Opening a new connection, currently in state closed
[0m19:30:43.903574 [debug] [Thread-1  ]: Began compiling node test.bain_capital_analytics.not_null_report_lp_quarterly_fund_id.aa355f6583
[0m19:30:43.903879 [debug] [Thread-3  ]: SQL status: DROP VIEW in 0.001 seconds
[0m19:30:43.904154 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_fact_fund_performance_fund_id.738d6489c4: BEGIN
[0m19:30:43.908663 [debug] [Thread-1  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_report_lp_quarterly_fund_id.aa355f6583"
[0m19:30:43.909841 [debug] [Thread-3  ]: On model.bain_capital_analytics.fact_portfolio_attribution: Close
[0m19:30:43.910152 [debug] [Thread-4  ]: Opening a new connection, currently in state closed
[0m19:30:43.910742 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b0af5ff2-0eab-40ce-a1a4-bdad63de4622', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ad475b0>]}
[0m19:30:43.911283 [debug] [Thread-1  ]: Began executing node test.bain_capital_analytics.not_null_report_lp_quarterly_fund_id.aa355f6583
[0m19:30:43.913633 [debug] [Thread-1  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_report_lp_quarterly_fund_id.aa355f6583"
[0m19:30:43.914119 [info ] [Thread-3  ]: 48 of 54 OK created sql view model public.fact_portfolio_attribution ........... [[32mCREATE VIEW[0m in 0.13s]
[0m19:30:43.914709 [debug] [Thread-3  ]: Finished running node model.bain_capital_analytics.fact_portfolio_attribution
[0m19:30:43.915047 [debug] [Thread-2  ]: SQL status: BEGIN in 0.012 seconds
[0m19:30:43.915464 [debug] [Thread-2  ]: Using postgres connection "test.bain_capital_analytics.not_null_fact_cashflow_waterfall_cashflow_id.7aafd60486"
[0m19:30:43.915895 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_fact_cashflow_waterfall_cashflow_id.7aafd60486: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_fact_cashflow_waterfall_cashflow_id.7aafd60486"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select cashflow_id
from "bain_analytics"."public"."fact_cashflow_waterfall"
where cashflow_id is null



  
  
      
    ) dbt_internal_test
[0m19:30:43.916344 [debug] [Thread-3  ]: Began running node test.bain_capital_analytics.not_null_fact_portfolio_attribution_portfolio_id.f676c7df62
[0m19:30:43.916682 [debug] [Thread-1  ]: Using postgres connection "test.bain_capital_analytics.not_null_report_lp_quarterly_fund_id.aa355f6583"
[0m19:30:43.917000 [info ] [Thread-3  ]: 52 of 54 START test not_null_fact_portfolio_attribution_portfolio_id ........... [RUN]
[0m19:30:43.917333 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_report_lp_quarterly_fund_id.aa355f6583: BEGIN
[0m19:30:43.917676 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly model.bain_capital_analytics.fact_portfolio_attribution, now test.bain_capital_analytics.not_null_fact_portfolio_attribution_portfolio_id.f676c7df62)
[0m19:30:43.917970 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m19:30:43.918261 [debug] [Thread-3  ]: Began compiling node test.bain_capital_analytics.not_null_fact_portfolio_attribution_portfolio_id.f676c7df62
[0m19:30:43.921721 [debug] [Thread-3  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_fact_portfolio_attribution_portfolio_id.f676c7df62"
[0m19:30:43.922048 [debug] [Thread-4  ]: SQL status: BEGIN in 0.012 seconds
[0m19:30:43.922403 [debug] [Thread-4  ]: Using postgres connection "test.bain_capital_analytics.not_null_fact_fund_performance_fund_id.738d6489c4"
[0m19:30:43.922725 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_fact_fund_performance_fund_id.738d6489c4: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_fact_fund_performance_fund_id.738d6489c4"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select fund_id
from "bain_analytics"."public"."fact_fund_performance"
where fund_id is null



  
  
      
    ) dbt_internal_test
[0m19:30:43.923114 [debug] [Thread-3  ]: Began executing node test.bain_capital_analytics.not_null_fact_portfolio_attribution_portfolio_id.f676c7df62
[0m19:30:43.923428 [debug] [Thread-2  ]: SQL status: SELECT 1 in 0.007 seconds
[0m19:30:43.925662 [debug] [Thread-3  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_fact_portfolio_attribution_portfolio_id.f676c7df62"
[0m19:30:43.926894 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_fact_cashflow_waterfall_cashflow_id.7aafd60486: ROLLBACK
[0m19:30:43.927227 [debug] [Thread-1  ]: SQL status: BEGIN in 0.009 seconds
[0m19:30:43.927629 [debug] [Thread-1  ]: Using postgres connection "test.bain_capital_analytics.not_null_report_lp_quarterly_fund_id.aa355f6583"
[0m19:30:43.927948 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_report_lp_quarterly_fund_id.aa355f6583: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_report_lp_quarterly_fund_id.aa355f6583"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select fund_id
from "bain_analytics"."public"."report_lp_quarterly"
where fund_id is null



  
  
      
    ) dbt_internal_test
[0m19:30:43.928264 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_fact_cashflow_waterfall_cashflow_id.7aafd60486: Close
[0m19:30:43.928679 [debug] [Thread-3  ]: Using postgres connection "test.bain_capital_analytics.not_null_fact_portfolio_attribution_portfolio_id.f676c7df62"
[0m19:30:43.929161 [info ] [Thread-2  ]: 49 of 54 PASS not_null_fact_cashflow_waterfall_cashflow_id ..................... [[32mPASS[0m in 0.10s]
[0m19:30:43.929490 [debug] [Thread-4  ]: SQL status: SELECT 1 in 0.006 seconds
[0m19:30:43.929787 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_fact_portfolio_attribution_portfolio_id.f676c7df62: BEGIN
[0m19:30:43.930207 [debug] [Thread-2  ]: Finished running node test.bain_capital_analytics.not_null_fact_cashflow_waterfall_cashflow_id.7aafd60486
[0m19:30:43.931322 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_fact_fund_performance_fund_id.738d6489c4: ROLLBACK
[0m19:30:43.931637 [debug] [Thread-3  ]: Opening a new connection, currently in state closed
[0m19:30:43.932327 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_fact_fund_performance_fund_id.738d6489c4: Close
[0m19:30:43.932803 [info ] [Thread-4  ]: 50 of 54 PASS not_null_fact_fund_performance_fund_id ........................... [[32mPASS[0m in 0.10s]
[0m19:30:43.933253 [debug] [Thread-4  ]: Finished running node test.bain_capital_analytics.not_null_fact_fund_performance_fund_id.738d6489c4
[0m19:30:43.933754 [debug] [Thread-2  ]: Began running node model.bain_capital_analytics.report_ic_dashboard
[0m19:30:43.934187 [info ] [Thread-2  ]: 53 of 54 START sql view model public.report_ic_dashboard ....................... [RUN]
[0m19:30:43.934542 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.not_null_fact_cashflow_waterfall_cashflow_id.7aafd60486, now model.bain_capital_analytics.report_ic_dashboard)
[0m19:30:43.934849 [debug] [Thread-2  ]: Began compiling node model.bain_capital_analytics.report_ic_dashboard
[0m19:30:43.938440 [debug] [Thread-2  ]: Writing injected SQL for node "model.bain_capital_analytics.report_ic_dashboard"
[0m19:30:43.938782 [debug] [Thread-1  ]: SQL status: SELECT 1 in 0.010 seconds
[0m19:30:43.939996 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_report_lp_quarterly_fund_id.aa355f6583: ROLLBACK
[0m19:30:43.940530 [debug] [Thread-2  ]: Began executing node model.bain_capital_analytics.report_ic_dashboard
[0m19:30:43.940830 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_report_lp_quarterly_fund_id.aa355f6583: Close
[0m19:30:43.941158 [debug] [Thread-3  ]: SQL status: BEGIN in 0.010 seconds
[0m19:30:43.946091 [debug] [Thread-2  ]: Writing runtime sql for node "model.bain_capital_analytics.report_ic_dashboard"
[0m19:30:43.946869 [debug] [Thread-3  ]: Using postgres connection "test.bain_capital_analytics.not_null_fact_portfolio_attribution_portfolio_id.f676c7df62"
[0m19:30:43.946611 [info ] [Thread-1  ]: 51 of 54 PASS not_null_report_lp_quarterly_fund_id ............................. [[32mPASS[0m in 0.04s]
[0m19:30:43.947359 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_fact_portfolio_attribution_portfolio_id.f676c7df62: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_fact_portfolio_attribution_portfolio_id.f676c7df62"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select portfolio_id
from "bain_analytics"."public"."fact_portfolio_attribution"
where portfolio_id is null



  
  
      
    ) dbt_internal_test
[0m19:30:43.947818 [debug] [Thread-1  ]: Finished running node test.bain_capital_analytics.not_null_report_lp_quarterly_fund_id.aa355f6583
[0m19:30:43.948418 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.report_ic_dashboard"
[0m19:30:43.948788 [debug] [Thread-2  ]: On model.bain_capital_analytics.report_ic_dashboard: BEGIN
[0m19:30:43.949085 [debug] [Thread-2  ]: Opening a new connection, currently in state closed
[0m19:30:43.954265 [debug] [Thread-3  ]: SQL status: SELECT 1 in 0.006 seconds
[0m19:30:43.955462 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_fact_portfolio_attribution_portfolio_id.f676c7df62: ROLLBACK
[0m19:30:43.956042 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_fact_portfolio_attribution_portfolio_id.f676c7df62: Close
[0m19:30:43.956546 [info ] [Thread-3  ]: 52 of 54 PASS not_null_fact_portfolio_attribution_portfolio_id ................. [[32mPASS[0m in 0.04s]
[0m19:30:43.956895 [debug] [Thread-2  ]: SQL status: BEGIN in 0.008 seconds
[0m19:30:43.957318 [debug] [Thread-3  ]: Finished running node test.bain_capital_analytics.not_null_fact_portfolio_attribution_portfolio_id.f676c7df62
[0m19:30:43.957645 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.report_ic_dashboard"
[0m19:30:43.958170 [debug] [Thread-2  ]: On model.bain_capital_analytics.report_ic_dashboard: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.report_ic_dashboard"} */

  create view "bain_analytics"."public"."report_ic_dashboard__dbt_tmp"
    
    
  as (
    -- Pipeline C: REPORT table - Investment Committee dashboard
-- Anti-pattern: massive query joining many sources, no intermediate reuse
-- Anti-pattern: subquery for latest records instead of QUALIFY
-- Anti-pattern: duplicated logic from other reports

with latest_fund_performance as (
    select *
    from (
        select
            fp.*,
            -- Anti-pattern: subquery dedup instead of QUALIFY
            row_number() over (
                partition by fp.fund_id
                order by fp.valuation_date desc
            ) as rn
        from "bain_analytics"."public"."fact_fund_performance" fp
    ) sub
    where rn = 1
),

latest_portfolio_summary as (
    select *
    from (
        select
            ps.*,
            row_number() over (
                partition by ps.portfolio_id
                order by ps.position_date desc
            ) as rn
        from "bain_analytics"."public"."fact_portfolio_summary" ps
    ) sub
    where rn = 1
),

-- Anti-pattern: re-joining fund structures (already in fact_fund_performance)
fund_overview as (
    select
        lfp.fund_id,
        lfp.fund_name,
        lfp.fund_type,
        lfp.committed_capital,
        lfp.valuation_date as latest_valuation_date,
        lfp.fund_nav,
        lfp.fund_gav,
        lfp.fund_nav_return as latest_nav_return,
        lfp.tvpi_gross,
        lfp.fund_approx_irr,
        lfp.fund_tvpi,
        lfp.fund_dpi,
        lfp.num_portfolios,
        lfp.fund_total_invested,
        lfp.fund_total_distributed,
        -- Anti-pattern: re-joining fund structures
        fs.management_fee_rate,
        fs.carry_rate,
        fs.hurdle_rate,
        fs.vintage_year
    from latest_fund_performance lfp
    inner join "bain_analytics"."public"."stg_fund_structures" fs
        on lfp.fund_id = fs.fund_id
),

portfolio_details as (
    select
        lps.portfolio_id,
        lps.portfolio_name,
        lps.strategy,
        lps.fund_id,
        lps.total_market_value,
        lps.total_unrealized_pnl,
        lps.portfolio_return_pct,
        lps.num_positions,
        -- Anti-pattern: re-computing fiscal quarter
        case
            when extract(month from lps.position_date) between 1 and 3 then 'Q3'
            when extract(month from lps.position_date) between 4 and 6 then 'Q4'
            when extract(month from lps.position_date) between 7 and 9 then 'Q1'
            when extract(month from lps.position_date) between 10 and 12 then 'Q2'
        end as reporting_fiscal_quarter
    from latest_portfolio_summary lps
)

select
    fo.fund_id,
    fo.fund_name,
    fo.fund_type,
    fo.vintage_year,
    fo.committed_capital,
    fo.latest_valuation_date,
    fo.fund_nav,
    fo.fund_gav,
    fo.latest_nav_return,
    fo.tvpi_gross,
    fo.fund_approx_irr,
    fo.fund_tvpi,
    fo.fund_dpi,
    fo.num_portfolios,
    fo.fund_total_invested,
    fo.fund_total_distributed,
    fo.management_fee_rate,
    fo.carry_rate,
    fo.hurdle_rate,
    pd.portfolio_id,
    pd.portfolio_name,
    pd.strategy,
    pd.total_market_value as portfolio_mv,
    pd.total_unrealized_pnl as portfolio_unrealized_pnl,
    pd.portfolio_return_pct,
    pd.num_positions as portfolio_num_positions,
    pd.reporting_fiscal_quarter
from fund_overview fo
inner join portfolio_details pd
    on fo.fund_id = pd.fund_id
order by fo.fund_nav desc, pd.total_market_value desc
  );
[0m19:30:43.960304 [debug] [Thread-2  ]: Postgres adapter: Postgres error: relation "public.fact_portfolio_summary" does not exist
LINE 36:         from "bain_analytics"."public"."fact_portfolio_summa...
                      ^

[0m19:30:43.960629 [debug] [Thread-2  ]: On model.bain_capital_analytics.report_ic_dashboard: ROLLBACK
[0m19:30:43.961263 [debug] [Thread-2  ]: On model.bain_capital_analytics.report_ic_dashboard: Close
[0m19:30:43.981657 [debug] [Thread-2  ]: Database Error in model report_ic_dashboard (models/marts/report_ic_dashboard.sql)
  relation "public.fact_portfolio_summary" does not exist
  LINE 36:         from "bain_analytics"."public"."fact_portfolio_summa...
                        ^
  compiled code at target/run/bain_capital_analytics/models/marts/report_ic_dashboard.sql
[0m19:30:43.982138 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b0af5ff2-0eab-40ce-a1a4-bdad63de4622', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10afc35e0>]}
[0m19:30:43.982762 [error] [Thread-2  ]: 53 of 54 ERROR creating sql view model public.report_ic_dashboard .............. [[31mERROR[0m in 0.05s]
[0m19:30:43.983239 [debug] [Thread-2  ]: Finished running node model.bain_capital_analytics.report_ic_dashboard
[0m19:30:43.983678 [debug] [Thread-7  ]: Marking all children of 'model.bain_capital_analytics.report_ic_dashboard' to be skipped because of status 'error'.  Reason: Database Error in model report_ic_dashboard (models/marts/report_ic_dashboard.sql)
  relation "public.fact_portfolio_summary" does not exist
  LINE 36:         from "bain_analytics"."public"."fact_portfolio_summa...
                        ^
  compiled code at target/run/bain_capital_analytics/models/marts/report_ic_dashboard.sql.
[0m19:30:43.984345 [debug] [Thread-4  ]: Began running node test.bain_capital_analytics.not_null_report_ic_dashboard_fund_id.e430aafd84
[0m19:30:43.984769 [info ] [Thread-4  ]: 54 of 54 SKIP test not_null_report_ic_dashboard_fund_id ........................ [[33mSKIP[0m]
[0m19:30:43.985136 [debug] [Thread-4  ]: Finished running node test.bain_capital_analytics.not_null_report_ic_dashboard_fund_id.e430aafd84
[0m19:30:43.985434 [debug] [Thread-7  ]: Marking all children of 'test.bain_capital_analytics.not_null_report_ic_dashboard_fund_id.e430aafd84' to be skipped because of status 'skipped'. 
[0m19:30:43.986378 [debug] [MainThread]: Using postgres connection "master"
[0m19:30:43.986650 [debug] [MainThread]: On master: BEGIN
[0m19:30:43.986896 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m19:30:43.994920 [debug] [MainThread]: SQL status: BEGIN in 0.008 seconds
[0m19:30:43.995199 [debug] [MainThread]: On master: COMMIT
[0m19:30:43.995456 [debug] [MainThread]: Using postgres connection "master"
[0m19:30:43.995698 [debug] [MainThread]: On master: COMMIT
[0m19:30:43.996126 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m19:30:43.996379 [debug] [MainThread]: On master: Close
[0m19:30:43.996711 [debug] [MainThread]: Connection 'master' was properly closed.
[0m19:30:43.996945 [debug] [MainThread]: Connection 'test.bain_capital_analytics.not_null_report_lp_quarterly_fund_id.aa355f6583' was properly closed.
[0m19:30:43.997168 [debug] [MainThread]: Connection 'model.bain_capital_analytics.report_ic_dashboard' was properly closed.
[0m19:30:43.997387 [debug] [MainThread]: Connection 'test.bain_capital_analytics.not_null_fact_portfolio_attribution_portfolio_id.f676c7df62' was properly closed.
[0m19:30:43.997611 [debug] [MainThread]: Connection 'test.bain_capital_analytics.not_null_fact_fund_performance_fund_id.738d6489c4' was properly closed.
[0m19:30:43.997975 [info ] [MainThread]: 
[0m19:30:43.998251 [info ] [MainThread]: Finished running 35 data tests, 19 view models in 0 hours 0 minutes and 1.45 seconds (1.45s).
[0m19:30:44.004016 [debug] [MainThread]: Command end result
[0m19:30:44.046005 [debug] [MainThread]: Wrote artifact WritableManifest to ./target/manifest.json
[0m19:30:44.047670 [debug] [MainThread]: Wrote artifact SemanticManifest to ./target/semantic_manifest.json
[0m19:30:44.055756 [debug] [MainThread]: Wrote artifact RunExecutionResult to ./target/run_results.json
[0m19:30:44.056073 [info ] [MainThread]: 
[0m19:30:44.056392 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m19:30:44.056666 [info ] [MainThread]: 
[0m19:30:44.056987 [error] [MainThread]: [31mFailure in model report_ic_dashboard (models/marts/report_ic_dashboard.sql)[0m
[0m19:30:44.057308 [error] [MainThread]:   Database Error in model report_ic_dashboard (models/marts/report_ic_dashboard.sql)
  relation "public.fact_portfolio_summary" does not exist
  LINE 36:         from "bain_analytics"."public"."fact_portfolio_summa...
                        ^
  compiled code at target/run/bain_capital_analytics/models/marts/report_ic_dashboard.sql
[0m19:30:44.057559 [info ] [MainThread]: 
[0m19:30:44.057857 [info ] [MainThread]:   compiled code at target/compiled/bain_capital_analytics/models/marts/report_ic_dashboard.sql
[0m19:30:44.058166 [info ] [MainThread]: 
[0m19:30:44.058453 [info ] [MainThread]: Done. PASS=52 WARN=0 ERROR=1 SKIP=1 NO-OP=0 TOTAL=54
[0m19:30:44.061336 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": false, "command_wall_clock_time": 2.4188023, "process_in_blocks": "0", "process_kernel_time": 0.367084, "process_mem_max_rss": "141836288", "process_out_blocks": "0", "process_user_time": 3.510514}
[0m19:30:44.061700 [debug] [MainThread]: Command `dbt build` failed at 19:30:44.061627 after 2.42 seconds
[0m19:30:44.062059 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10863e100>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108999fd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10951c100>]}
[0m19:30:44.062402 [debug] [MainThread]: Flushing usage events
[0m19:30:45.804874 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m19:31:08.908156 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108279190>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109326700>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109326520>]}


============================== 19:31:08.913154 | b797888c-1388-4168-8810-42273e5eb40c ==============================
[0m19:31:08.913154 [info ] [MainThread]: Running with dbt=1.11.0-b3
[0m19:31:08.913687 [debug] [MainThread]: running dbt with arguments {'indirect_selection': 'eager', 'static_parser': 'True', 'log_format': 'default', 'use_colors': 'True', 'fail_fast': 'False', 'invocation_command': 'dbt build --select tag:pipeline_a --profiles-dir . --project-dir .', 'version_check': 'True', 'cache_selected_only': 'False', 'printer_width': '80', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'send_anonymous_usage_stats': 'True', 'debug': 'False', 'target_path': 'None', 'partial_parse': 'True', 'log_path': 'logs', 'write_json': 'True', 'empty': 'False', 'profiles_dir': '.', 'warn_error': 'None', 'quiet': 'False', 'use_experimental_parser': 'False', 'log_cache_events': 'False', 'no_print': 'None'}
[0m19:31:09.130525 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'b797888c-1388-4168-8810-42273e5eb40c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106b28310>]}
[0m19:31:09.205617 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'b797888c-1388-4168-8810-42273e5eb40c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108bc5220>]}
[0m19:31:09.207050 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m19:31:09.318279 [debug] [MainThread]: checksum: e63134dccc1251cfb572caf0e4aa952f030c125ee3634f3bf2c0a2e1bb6ae349, vars: {}, profile: , target: , version: 1.11.0b3
[0m19:31:09.556521 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m19:31:09.557587 [debug] [MainThread]: Partial parsing: updated file: bain_capital_analytics://models/marts/_marts.yml
[0m19:31:10.034370 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'b797888c-1388-4168-8810-42273e5eb40c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a8e9130>]}
[0m19:31:10.156133 [debug] [MainThread]: Wrote artifact WritableManifest to ./target/manifest.json
[0m19:31:10.158604 [debug] [MainThread]: Wrote artifact SemanticManifest to ./target/semantic_manifest.json
[0m19:31:10.195391 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'b797888c-1388-4168-8810-42273e5eb40c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109af3d00>]}
[0m19:31:10.195940 [info ] [MainThread]: Found 28 models, 53 data tests, 10 seeds, 569 macros
[0m19:31:10.198570 [info ] [MainThread]: 
[0m19:31:10.198889 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m19:31:10.199283 [info ] [MainThread]: 
[0m19:31:10.199798 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m19:31:10.203989 [debug] [ThreadPool]: Acquiring new postgres connection 'list_bain_analytics'
[0m19:31:10.306608 [debug] [ThreadPool]: Using postgres connection "list_bain_analytics"
[0m19:31:10.307108 [debug] [ThreadPool]: On list_bain_analytics: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "connection_name": "list_bain_analytics"} */

    select distinct nspname from pg_namespace
  
[0m19:31:10.307391 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m19:31:10.357384 [debug] [ThreadPool]: SQL status: SELECT 5 in 0.050 seconds
[0m19:31:10.358871 [debug] [ThreadPool]: On list_bain_analytics: Close
[0m19:31:10.362641 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_bain_analytics, now list_bain_analytics_public_raw)
[0m19:31:10.363245 [debug] [ThreadPool]: Acquiring new postgres connection 'list_bain_analytics_public'
[0m19:31:10.369830 [debug] [ThreadPool]: Using postgres connection "list_bain_analytics_public_raw"
[0m19:31:10.372474 [debug] [ThreadPool]: Using postgres connection "list_bain_analytics_public"
[0m19:31:10.372763 [debug] [ThreadPool]: On list_bain_analytics_public_raw: BEGIN
[0m19:31:10.373021 [debug] [ThreadPool]: On list_bain_analytics_public: BEGIN
[0m19:31:10.373274 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:31:10.373510 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m19:31:10.388029 [debug] [ThreadPool]: SQL status: BEGIN in 0.015 seconds
[0m19:31:10.388304 [debug] [ThreadPool]: Using postgres connection "list_bain_analytics_public_raw"
[0m19:31:10.388644 [debug] [ThreadPool]: On list_bain_analytics_public_raw: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "connection_name": "list_bain_analytics_public_raw"} */
select
      'bain_analytics' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_raw'
    union all
    select
      'bain_analytics' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_raw'
    union all
    select
      'bain_analytics' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_raw'
  
[0m19:31:10.389197 [debug] [ThreadPool]: SQL status: BEGIN in 0.016 seconds
[0m19:31:10.389444 [debug] [ThreadPool]: Using postgres connection "list_bain_analytics_public"
[0m19:31:10.389707 [debug] [ThreadPool]: On list_bain_analytics_public: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "connection_name": "list_bain_analytics_public"} */
select
      'bain_analytics' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'bain_analytics' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'bain_analytics' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m19:31:10.394338 [debug] [ThreadPool]: SQL status: SELECT 20 in 0.004 seconds
[0m19:31:10.394625 [debug] [ThreadPool]: SQL status: SELECT 10 in 0.006 seconds
[0m19:31:10.396103 [debug] [ThreadPool]: On list_bain_analytics_public: ROLLBACK
[0m19:31:10.397179 [debug] [ThreadPool]: On list_bain_analytics_public_raw: ROLLBACK
[0m19:31:10.398119 [debug] [ThreadPool]: On list_bain_analytics_public: Close
[0m19:31:10.398379 [debug] [ThreadPool]: On list_bain_analytics_public_raw: Close
[0m19:31:10.408304 [debug] [MainThread]: Using postgres connection "master"
[0m19:31:10.408633 [debug] [MainThread]: On master: BEGIN
[0m19:31:10.408900 [debug] [MainThread]: Opening a new connection, currently in state init
[0m19:31:10.419027 [debug] [MainThread]: SQL status: BEGIN in 0.010 seconds
[0m19:31:10.419320 [debug] [MainThread]: Using postgres connection "master"
[0m19:31:10.419642 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "connection_name": "master"} */
select distinct
        dependent_namespace.nspname as dependent_schema,
        dependent_class.relname as dependent_name,
        referenced_namespace.nspname as referenced_schema,
        referenced_class.relname as referenced_name

    -- Query for views: views are entries in pg_class with an entry in pg_rewrite, but we avoid
    -- a seq scan on pg_rewrite by leveraging the fact there is an "internal" row in pg_depend for
    -- the view...
    from pg_class as dependent_class
    join pg_namespace as dependent_namespace on dependent_namespace.oid = dependent_class.relnamespace
    join pg_depend as dependent_depend on dependent_depend.refobjid = dependent_class.oid
        and dependent_depend.classid = 'pg_rewrite'::regclass
        and dependent_depend.refclassid = 'pg_class'::regclass
        and dependent_depend.deptype = 'i'

    -- ... and via pg_depend (that has a row per column, hence the need for "distinct" above, and
    -- making sure to exclude the internal row to avoid a view appearing to depend on itself)...
    join pg_depend as joining_depend on joining_depend.objid = dependent_depend.objid
        and joining_depend.classid = 'pg_rewrite'::regclass
        and joining_depend.refclassid = 'pg_class'::regclass
        and joining_depend.refobjid != dependent_depend.refobjid

    -- ... we can find the tables they query from in pg_class, but excluding system tables. Note we
    -- don't need need to exclude _dependent_ system tables, because they only query from other
    -- system tables, and so are automatically excluded by excluding _referenced_ system tables
    join pg_class as referenced_class on referenced_class.oid = joining_depend.refobjid
    join pg_namespace as referenced_namespace on referenced_namespace.oid = referenced_class.relnamespace
        and referenced_namespace.nspname != 'information_schema'
        and referenced_namespace.nspname not like 'pg\_%'

    order by
        dependent_schema, dependent_name, referenced_schema, referenced_name;
[0m19:31:10.426652 [debug] [MainThread]: SQL status: SELECT 38 in 0.007 seconds
[0m19:31:10.433139 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b797888c-1388-4168-8810-42273e5eb40c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10aa53490>]}
[0m19:31:10.433690 [debug] [MainThread]: On master: ROLLBACK
[0m19:31:10.434349 [debug] [MainThread]: Using postgres connection "master"
[0m19:31:10.434613 [debug] [MainThread]: On master: BEGIN
[0m19:31:10.435495 [debug] [MainThread]: SQL status: BEGIN in 0.001 seconds
[0m19:31:10.435760 [debug] [MainThread]: On master: COMMIT
[0m19:31:10.436039 [debug] [MainThread]: Using postgres connection "master"
[0m19:31:10.436278 [debug] [MainThread]: On master: COMMIT
[0m19:31:10.436862 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m19:31:10.437131 [debug] [MainThread]: On master: Close
[0m19:31:10.440513 [debug] [Thread-1  ]: Began running node model.bain_capital_analytics.stg_portfolios
[0m19:31:10.440876 [debug] [Thread-2  ]: Began running node model.bain_capital_analytics.stg_positions
[0m19:31:10.441332 [info ] [Thread-1  ]: 1 of 14 START sql view model public.stg_portfolios ............................. [RUN]
[0m19:31:10.441780 [info ] [Thread-2  ]: 2 of 14 START sql view model public.stg_positions .............................. [RUN]
[0m19:31:10.442200 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_bain_analytics_public_raw, now model.bain_capital_analytics.stg_portfolios)
[0m19:31:10.442533 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly list_bain_analytics_public, now model.bain_capital_analytics.stg_positions)
[0m19:31:10.442857 [debug] [Thread-1  ]: Began compiling node model.bain_capital_analytics.stg_portfolios
[0m19:31:10.443156 [debug] [Thread-2  ]: Began compiling node model.bain_capital_analytics.stg_positions
[0m19:31:10.451290 [debug] [Thread-1  ]: Writing injected SQL for node "model.bain_capital_analytics.stg_portfolios"
[0m19:31:10.453957 [debug] [Thread-2  ]: Writing injected SQL for node "model.bain_capital_analytics.stg_positions"
[0m19:31:10.454757 [debug] [Thread-1  ]: Began executing node model.bain_capital_analytics.stg_portfolios
[0m19:31:10.455080 [debug] [Thread-2  ]: Began executing node model.bain_capital_analytics.stg_positions
[0m19:31:10.505397 [debug] [Thread-2  ]: Writing runtime sql for node "model.bain_capital_analytics.stg_positions"
[0m19:31:10.507486 [debug] [Thread-1  ]: Writing runtime sql for node "model.bain_capital_analytics.stg_portfolios"
[0m19:31:10.508166 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.stg_positions"
[0m19:31:10.508535 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.stg_portfolios"
[0m19:31:10.508841 [debug] [Thread-2  ]: On model.bain_capital_analytics.stg_positions: BEGIN
[0m19:31:10.509144 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_portfolios: BEGIN
[0m19:31:10.509454 [debug] [Thread-2  ]: Opening a new connection, currently in state closed
[0m19:31:10.509758 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m19:31:10.523408 [debug] [Thread-1  ]: SQL status: BEGIN in 0.014 seconds
[0m19:31:10.523763 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.stg_portfolios"
[0m19:31:10.524083 [debug] [Thread-2  ]: SQL status: BEGIN in 0.015 seconds
[0m19:31:10.524425 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_portfolios: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_portfolios"} */

  create view "bain_analytics"."public"."stg_portfolios__dbt_tmp"
    
    
  as (
    -- Anti-pattern: unnecessary DISTINCT when source data is already unique
-- Anti-pattern: casting in every model instead of once upstream

select distinct
    cast(portfolio_id as varchar(10)) as portfolio_id,
    cast(portfolio_name as varchar(100)) as portfolio_name,
    cast(strategy as varchar(50)) as strategy,
    cast(inception_date as date) as inception_date,
    cast(fund_id as varchar(10)) as fund_id,
    cast(manager_name as varchar(100)) as manager_name,
    cast(is_active as boolean) as is_active,
    -- Anti-pattern: duplicated fiscal quarter logic (repeated in many models)
    case
        when extract(month from cast(inception_date as date)) between 1 and 3 then 'Q3'
        when extract(month from cast(inception_date as date)) between 4 and 6 then 'Q4'
        when extract(month from cast(inception_date as date)) between 7 and 9 then 'Q1'
        when extract(month from cast(inception_date as date)) between 10 and 12 then 'Q2'
    end as inception_fiscal_quarter
from "bain_analytics"."public_raw"."raw_portfolios"
where cast(is_active as boolean) = true
  );
[0m19:31:10.524773 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.stg_positions"
[0m19:31:10.525167 [debug] [Thread-2  ]: On model.bain_capital_analytics.stg_positions: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_positions"} */

  create view "bain_analytics"."public"."stg_positions__dbt_tmp"
    
    
  as (
    -- Anti-pattern: unnecessary DISTINCT
-- Anti-pattern: no filtering or partitioning strategy

select distinct
    position_id,
    portfolio_id,
    instrument_id,
    cast(position_date as date) as position_date,
    cast(quantity as numeric(18,4)) as quantity,
    cast(market_value as numeric(18,2)) as market_value,
    cast(cost_basis as numeric(18,2)) as cost_basis,
    currency,
    -- Anti-pattern: computed column that could be done downstream
    cast(market_value as numeric(18,2)) - cast(cost_basis as numeric(18,2)) as unrealized_gain_loss,
    case
        when cast(cost_basis as numeric(18,2)) != 0
        then (cast(market_value as numeric(18,2)) - cast(cost_basis as numeric(18,2))) / abs(cast(cost_basis as numeric(18,2)))
        else 0
    end as unrealized_return_pct
from "bain_analytics"."public_raw"."raw_positions"
  );
[0m19:31:10.530494 [debug] [Thread-2  ]: SQL status: CREATE VIEW in 0.005 seconds
[0m19:31:10.536667 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.stg_positions"
[0m19:31:10.536997 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.012 seconds
[0m19:31:10.537301 [debug] [Thread-2  ]: On model.bain_capital_analytics.stg_positions: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_positions"} */
alter table "bain_analytics"."public"."stg_positions" rename to "stg_positions__dbt_backup"
[0m19:31:10.540367 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.stg_portfolios"
[0m19:31:10.540723 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_portfolios: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_portfolios"} */
alter table "bain_analytics"."public"."stg_portfolios" rename to "stg_portfolios__dbt_backup"
[0m19:31:10.541727 [debug] [Thread-2  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m19:31:10.542025 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m19:31:10.544715 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.stg_positions"
[0m19:31:10.548162 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.stg_portfolios"
[0m19:31:10.548485 [debug] [Thread-2  ]: On model.bain_capital_analytics.stg_positions: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_positions"} */
alter table "bain_analytics"."public"."stg_positions__dbt_tmp" rename to "stg_positions"
[0m19:31:10.548888 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_portfolios: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_portfolios"} */
alter table "bain_analytics"."public"."stg_portfolios__dbt_tmp" rename to "stg_portfolios"
[0m19:31:10.549930 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m19:31:10.550236 [debug] [Thread-2  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m19:31:10.563745 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_portfolios: COMMIT
[0m19:31:10.564768 [debug] [Thread-2  ]: On model.bain_capital_analytics.stg_positions: COMMIT
[0m19:31:10.565091 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.stg_portfolios"
[0m19:31:10.565396 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.stg_positions"
[0m19:31:10.565697 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_portfolios: COMMIT
[0m19:31:10.565999 [debug] [Thread-2  ]: On model.bain_capital_analytics.stg_positions: COMMIT
[0m19:31:10.567950 [debug] [Thread-1  ]: SQL status: COMMIT in 0.002 seconds
[0m19:31:10.568266 [debug] [Thread-2  ]: SQL status: COMMIT in 0.002 seconds
[0m19:31:10.574140 [debug] [Thread-1  ]: Applying DROP to: "bain_analytics"."public"."stg_portfolios__dbt_backup"
[0m19:31:10.576443 [debug] [Thread-2  ]: Applying DROP to: "bain_analytics"."public"."stg_positions__dbt_backup"
[0m19:31:10.580004 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.stg_portfolios"
[0m19:31:10.580488 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.stg_positions"
[0m19:31:10.580808 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_portfolios: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_portfolios"} */
drop view if exists "bain_analytics"."public"."stg_portfolios__dbt_backup" cascade
[0m19:31:10.581116 [debug] [Thread-2  ]: On model.bain_capital_analytics.stg_positions: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_positions"} */
drop view if exists "bain_analytics"."public"."stg_positions__dbt_backup" cascade
[0m19:31:10.586805 [debug] [Thread-2  ]: SQL status: DROP VIEW in 0.005 seconds
[0m19:31:10.589017 [debug] [Thread-2  ]: On model.bain_capital_analytics.stg_positions: Close
[0m19:31:10.590849 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b797888c-1388-4168-8810-42273e5eb40c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109a545b0>]}
[0m19:31:10.591432 [info ] [Thread-2  ]: 2 of 14 OK created sql view model public.stg_positions ......................... [[32mCREATE VIEW[0m in 0.15s]
[0m19:31:10.591917 [debug] [Thread-2  ]: Finished running node model.bain_capital_analytics.stg_positions
[0m19:31:10.592706 [debug] [Thread-4  ]: Began running node test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c
[0m19:31:10.593039 [debug] [Thread-3  ]: Began running node test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1
[0m19:31:10.593368 [info ] [Thread-4  ]: 3 of 14 START test not_null_stg_positions_portfolio_id ......................... [RUN]
[0m19:31:10.593702 [debug] [Thread-2  ]: Began running node test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f
[0m19:31:10.594017 [info ] [Thread-3  ]: 4 of 14 START test not_null_stg_positions_position_id .......................... [RUN]
[0m19:31:10.594474 [debug] [Thread-4  ]: Acquiring new postgres connection 'test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c'
[0m19:31:10.594792 [info ] [Thread-2  ]: 5 of 14 START test unique_stg_positions_position_id ............................ [RUN]
[0m19:31:10.595197 [debug] [Thread-3  ]: Acquiring new postgres connection 'test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1'
[0m19:31:10.595519 [debug] [Thread-4  ]: Began compiling node test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c
[0m19:31:10.595828 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.014 seconds
[0m19:31:10.596163 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly model.bain_capital_analytics.stg_positions, now test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f)
[0m19:31:10.596500 [debug] [Thread-3  ]: Began compiling node test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1
[0m19:31:10.607172 [debug] [Thread-4  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c"
[0m19:31:10.608374 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_portfolios: Close
[0m19:31:10.608741 [debug] [Thread-2  ]: Began compiling node test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f
[0m19:31:10.613362 [debug] [Thread-3  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1"
[0m19:31:10.618796 [debug] [Thread-2  ]: Writing injected SQL for node "test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f"
[0m19:31:10.619341 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b797888c-1388-4168-8810-42273e5eb40c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ae02820>]}
[0m19:31:10.620403 [debug] [Thread-4  ]: Began executing node test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c
[0m19:31:10.620125 [info ] [Thread-1  ]: 1 of 14 OK created sql view model public.stg_portfolios ........................ [[32mCREATE VIEW[0m in 0.18s]
[0m19:31:10.626193 [debug] [Thread-1  ]: Finished running node model.bain_capital_analytics.stg_portfolios
[0m19:31:10.632487 [debug] [Thread-3  ]: Began executing node test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1
[0m19:31:10.636549 [debug] [Thread-4  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c"
[0m19:31:10.638833 [debug] [Thread-3  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1"
[0m19:31:10.639150 [debug] [Thread-2  ]: Began executing node test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f
[0m19:31:10.639668 [debug] [Thread-1  ]: Began running node test.bain_capital_analytics.not_null_stg_portfolios_fund_id.70b04d82bd
[0m19:31:10.642035 [debug] [Thread-2  ]: Writing runtime sql for node "test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f"
[0m19:31:10.642371 [info ] [Thread-1  ]: 6 of 14 START test not_null_stg_portfolios_fund_id ............................. [RUN]
[0m19:31:10.642880 [debug] [Thread-4  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c"
[0m19:31:10.643219 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.bain_capital_analytics.stg_portfolios, now test.bain_capital_analytics.not_null_stg_portfolios_fund_id.70b04d82bd)
[0m19:31:10.643555 [debug] [Thread-3  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1"
[0m19:31:10.643893 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c: BEGIN
[0m19:31:10.644201 [debug] [Thread-1  ]: Began compiling node test.bain_capital_analytics.not_null_stg_portfolios_fund_id.70b04d82bd
[0m19:31:10.644532 [debug] [Thread-2  ]: Using postgres connection "test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f"
[0m19:31:10.644854 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1: BEGIN
[0m19:31:10.645153 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m19:31:10.649336 [debug] [Thread-1  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_stg_portfolios_fund_id.70b04d82bd"
[0m19:31:10.649678 [debug] [Thread-2  ]: On test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f: BEGIN
[0m19:31:10.649981 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m19:31:10.650447 [debug] [Thread-2  ]: Opening a new connection, currently in state closed
[0m19:31:10.650976 [debug] [Thread-1  ]: Began executing node test.bain_capital_analytics.not_null_stg_portfolios_fund_id.70b04d82bd
[0m19:31:10.653262 [debug] [Thread-1  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_stg_portfolios_fund_id.70b04d82bd"
[0m19:31:10.653770 [debug] [Thread-1  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_portfolios_fund_id.70b04d82bd"
[0m19:31:10.654064 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_stg_portfolios_fund_id.70b04d82bd: BEGIN
[0m19:31:10.654343 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m19:31:10.664554 [debug] [Thread-3  ]: SQL status: BEGIN in 0.015 seconds
[0m19:31:10.664885 [debug] [Thread-3  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1"
[0m19:31:10.665195 [debug] [Thread-2  ]: SQL status: BEGIN in 0.015 seconds
[0m19:31:10.665505 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select position_id
from "bain_analytics"."public"."stg_positions"
where position_id is null



  
  
      
    ) dbt_internal_test
[0m19:31:10.665844 [debug] [Thread-4  ]: SQL status: BEGIN in 0.021 seconds
[0m19:31:10.666128 [debug] [Thread-1  ]: SQL status: BEGIN in 0.012 seconds
[0m19:31:10.666428 [debug] [Thread-2  ]: Using postgres connection "test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f"
[0m19:31:10.666775 [debug] [Thread-4  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c"
[0m19:31:10.667088 [debug] [Thread-1  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_portfolios_fund_id.70b04d82bd"
[0m19:31:10.667398 [debug] [Thread-2  ]: On test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

select
    position_id as unique_field,
    count(*) as n_records

from "bain_analytics"."public"."stg_positions"
where position_id is not null
group by position_id
having count(*) > 1



  
  
      
    ) dbt_internal_test
[0m19:31:10.667718 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select portfolio_id
from "bain_analytics"."public"."stg_positions"
where portfolio_id is null



  
  
      
    ) dbt_internal_test
[0m19:31:10.668033 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_stg_portfolios_fund_id.70b04d82bd: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_stg_portfolios_fund_id.70b04d82bd"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select fund_id
from "bain_analytics"."public"."stg_portfolios"
where fund_id is null



  
  
      
    ) dbt_internal_test
[0m19:31:10.669495 [debug] [Thread-3  ]: SQL status: SELECT 1 in 0.003 seconds
[0m19:31:10.672315 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1: ROLLBACK
[0m19:31:10.672675 [debug] [Thread-4  ]: SQL status: SELECT 1 in 0.004 seconds
[0m19:31:10.673800 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c: ROLLBACK
[0m19:31:10.674123 [debug] [Thread-2  ]: SQL status: SELECT 1 in 0.006 seconds
[0m19:31:10.674403 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1: Close
[0m19:31:10.674698 [debug] [Thread-1  ]: SQL status: SELECT 1 in 0.006 seconds
[0m19:31:10.675737 [debug] [Thread-2  ]: On test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f: ROLLBACK
[0m19:31:10.676036 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c: Close
[0m19:31:10.676507 [info ] [Thread-3  ]: 4 of 14 PASS not_null_stg_positions_position_id ................................ [[32mPASS[0m in 0.08s]
[0m19:31:10.677529 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_stg_portfolios_fund_id.70b04d82bd: ROLLBACK
[0m19:31:10.678022 [info ] [Thread-4  ]: 3 of 14 PASS not_null_stg_positions_portfolio_id ............................... [[32mPASS[0m in 0.08s]
[0m19:31:10.678329 [debug] [Thread-2  ]: On test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f: Close
[0m19:31:10.678733 [debug] [Thread-3  ]: Finished running node test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1
[0m19:31:10.679186 [debug] [Thread-4  ]: Finished running node test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c
[0m19:31:10.679483 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_stg_portfolios_fund_id.70b04d82bd: Close
[0m19:31:10.679900 [info ] [Thread-2  ]: 5 of 14 PASS unique_stg_positions_position_id .................................. [[32mPASS[0m in 0.08s]
[0m19:31:10.680245 [debug] [Thread-3  ]: Began running node test.bain_capital_analytics.not_null_stg_portfolios_portfolio_id.7126a480ec
[0m19:31:10.680623 [debug] [Thread-4  ]: Began running node test.bain_capital_analytics.relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_.2823f12709
[0m19:31:10.681095 [info ] [Thread-1  ]: 6 of 14 PASS not_null_stg_portfolios_fund_id ................................... [[32mPASS[0m in 0.04s]
[0m19:31:10.681525 [debug] [Thread-2  ]: Finished running node test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f
[0m19:31:10.681837 [info ] [Thread-3  ]: 7 of 14 START test not_null_stg_portfolios_portfolio_id ........................ [RUN]
[0m19:31:10.682161 [info ] [Thread-4  ]: 8 of 14 START test relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_  [RUN]
[0m19:31:10.682653 [debug] [Thread-1  ]: Finished running node test.bain_capital_analytics.not_null_stg_portfolios_fund_id.70b04d82bd
[0m19:31:10.682975 [debug] [Thread-2  ]: Began running node test.bain_capital_analytics.unique_stg_portfolios_portfolio_id.aa125b6658
[0m19:31:10.683341 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1, now test.bain_capital_analytics.not_null_stg_portfolios_portfolio_id.7126a480ec)
[0m19:31:10.683675 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c, now test.bain_capital_analytics.relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_.2823f12709)
[0m19:31:10.684064 [info ] [Thread-2  ]: 9 of 14 START test unique_stg_portfolios_portfolio_id .......................... [RUN]
[0m19:31:10.684393 [debug] [Thread-3  ]: Began compiling node test.bain_capital_analytics.not_null_stg_portfolios_portfolio_id.7126a480ec
[0m19:31:10.684768 [debug] [Thread-4  ]: Began compiling node test.bain_capital_analytics.relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_.2823f12709
[0m19:31:10.685126 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f, now test.bain_capital_analytics.unique_stg_portfolios_portfolio_id.aa125b6658)
[0m19:31:10.688927 [debug] [Thread-3  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_stg_portfolios_portfolio_id.7126a480ec"
[0m19:31:10.695422 [debug] [Thread-4  ]: Writing injected SQL for node "test.bain_capital_analytics.relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_.2823f12709"
[0m19:31:10.695924 [debug] [Thread-2  ]: Began compiling node test.bain_capital_analytics.unique_stg_portfolios_portfolio_id.aa125b6658
[0m19:31:10.699940 [debug] [Thread-2  ]: Writing injected SQL for node "test.bain_capital_analytics.unique_stg_portfolios_portfolio_id.aa125b6658"
[0m19:31:10.700447 [debug] [Thread-4  ]: Began executing node test.bain_capital_analytics.relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_.2823f12709
[0m19:31:10.700763 [debug] [Thread-3  ]: Began executing node test.bain_capital_analytics.not_null_stg_portfolios_portfolio_id.7126a480ec
[0m19:31:10.701061 [debug] [Thread-2  ]: Began executing node test.bain_capital_analytics.unique_stg_portfolios_portfolio_id.aa125b6658
[0m19:31:10.703466 [debug] [Thread-4  ]: Writing runtime sql for node "test.bain_capital_analytics.relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_.2823f12709"
[0m19:31:10.706736 [debug] [Thread-3  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_stg_portfolios_portfolio_id.7126a480ec"
[0m19:31:10.708869 [debug] [Thread-2  ]: Writing runtime sql for node "test.bain_capital_analytics.unique_stg_portfolios_portfolio_id.aa125b6658"
[0m19:31:10.709514 [debug] [Thread-4  ]: Using postgres connection "test.bain_capital_analytics.relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_.2823f12709"
[0m19:31:10.709860 [debug] [Thread-3  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_portfolios_portfolio_id.7126a480ec"
[0m19:31:10.710165 [debug] [Thread-4  ]: On test.bain_capital_analytics.relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_.2823f12709: BEGIN
[0m19:31:10.710496 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_stg_portfolios_portfolio_id.7126a480ec: BEGIN
[0m19:31:10.710830 [debug] [Thread-2  ]: Using postgres connection "test.bain_capital_analytics.unique_stg_portfolios_portfolio_id.aa125b6658"
[0m19:31:10.711139 [debug] [Thread-4  ]: Opening a new connection, currently in state closed
[0m19:31:10.711443 [debug] [Thread-3  ]: Opening a new connection, currently in state closed
[0m19:31:10.711817 [debug] [Thread-2  ]: On test.bain_capital_analytics.unique_stg_portfolios_portfolio_id.aa125b6658: BEGIN
[0m19:31:10.712300 [debug] [Thread-2  ]: Opening a new connection, currently in state closed
[0m19:31:10.724720 [debug] [Thread-2  ]: SQL status: BEGIN in 0.012 seconds
[0m19:31:10.725049 [debug] [Thread-4  ]: SQL status: BEGIN in 0.014 seconds
[0m19:31:10.725348 [debug] [Thread-2  ]: Using postgres connection "test.bain_capital_analytics.unique_stg_portfolios_portfolio_id.aa125b6658"
[0m19:31:10.725690 [debug] [Thread-4  ]: Using postgres connection "test.bain_capital_analytics.relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_.2823f12709"
[0m19:31:10.726022 [debug] [Thread-2  ]: On test.bain_capital_analytics.unique_stg_portfolios_portfolio_id.aa125b6658: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.unique_stg_portfolios_portfolio_id.aa125b6658"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

select
    portfolio_id as unique_field,
    count(*) as n_records

from "bain_analytics"."public"."stg_portfolios"
where portfolio_id is not null
group by portfolio_id
having count(*) > 1



  
  
      
    ) dbt_internal_test
[0m19:31:10.726376 [debug] [Thread-4  ]: On test.bain_capital_analytics.relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_.2823f12709: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_.2823f12709"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

with child as (
    select portfolio_id as from_field
    from "bain_analytics"."public"."stg_positions"
    where portfolio_id is not null
),

parent as (
    select portfolio_id as to_field
    from "bain_analytics"."public"."stg_portfolios"
)

select
    from_field

from child
left join parent
    on child.from_field = parent.to_field

where parent.to_field is null



  
  
      
    ) dbt_internal_test
[0m19:31:10.726717 [debug] [Thread-3  ]: SQL status: BEGIN in 0.015 seconds
[0m19:31:10.727091 [debug] [Thread-3  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_portfolios_portfolio_id.7126a480ec"
[0m19:31:10.727409 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_stg_portfolios_portfolio_id.7126a480ec: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_stg_portfolios_portfolio_id.7126a480ec"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select portfolio_id
from "bain_analytics"."public"."stg_portfolios"
where portfolio_id is null



  
  
      
    ) dbt_internal_test
[0m19:31:10.729897 [debug] [Thread-2  ]: SQL status: SELECT 1 in 0.003 seconds
[0m19:31:10.730208 [debug] [Thread-3  ]: SQL status: SELECT 1 in 0.002 seconds
[0m19:31:10.731603 [debug] [Thread-2  ]: On test.bain_capital_analytics.unique_stg_portfolios_portfolio_id.aa125b6658: ROLLBACK
[0m19:31:10.731969 [debug] [Thread-4  ]: SQL status: SELECT 1 in 0.005 seconds
[0m19:31:10.733081 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_stg_portfolios_portfolio_id.7126a480ec: ROLLBACK
[0m19:31:10.734202 [debug] [Thread-4  ]: On test.bain_capital_analytics.relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_.2823f12709: ROLLBACK
[0m19:31:10.734522 [debug] [Thread-2  ]: On test.bain_capital_analytics.unique_stg_portfolios_portfolio_id.aa125b6658: Close
[0m19:31:10.735340 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_stg_portfolios_portfolio_id.7126a480ec: Close
[0m19:31:10.735084 [info ] [Thread-2  ]: 9 of 14 PASS unique_stg_portfolios_portfolio_id ................................ [[32mPASS[0m in 0.05s]
[0m19:31:10.735738 [debug] [Thread-4  ]: On test.bain_capital_analytics.relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_.2823f12709: Close
[0m19:31:10.736171 [info ] [Thread-3  ]: 7 of 14 PASS not_null_stg_portfolios_portfolio_id .............................. [[32mPASS[0m in 0.05s]
[0m19:31:10.736635 [debug] [Thread-2  ]: Finished running node test.bain_capital_analytics.unique_stg_portfolios_portfolio_id.aa125b6658
[0m19:31:10.737085 [info ] [Thread-4  ]: 8 of 14 PASS relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_  [[32mPASS[0m in 0.05s]
[0m19:31:10.737527 [debug] [Thread-3  ]: Finished running node test.bain_capital_analytics.not_null_stg_portfolios_portfolio_id.7126a480ec
[0m19:31:10.738082 [debug] [Thread-4  ]: Finished running node test.bain_capital_analytics.relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_.2823f12709
[0m19:31:10.738814 [debug] [Thread-1  ]: Began running node model.bain_capital_analytics.fact_portfolio_summary
[0m19:31:10.739300 [info ] [Thread-1  ]: 10 of 14 START sql view model public.fact_portfolio_summary .................... [RUN]
[0m19:31:10.739747 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.not_null_stg_portfolios_fund_id.70b04d82bd, now model.bain_capital_analytics.fact_portfolio_summary)
[0m19:31:10.740091 [debug] [Thread-1  ]: Began compiling node model.bain_capital_analytics.fact_portfolio_summary
[0m19:31:10.743424 [debug] [Thread-1  ]: Writing injected SQL for node "model.bain_capital_analytics.fact_portfolio_summary"
[0m19:31:10.744094 [debug] [Thread-1  ]: Began executing node model.bain_capital_analytics.fact_portfolio_summary
[0m19:31:10.747489 [debug] [Thread-1  ]: Writing runtime sql for node "model.bain_capital_analytics.fact_portfolio_summary"
[0m19:31:10.748026 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.fact_portfolio_summary"
[0m19:31:10.748334 [debug] [Thread-1  ]: On model.bain_capital_analytics.fact_portfolio_summary: BEGIN
[0m19:31:10.748620 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m19:31:10.756865 [debug] [Thread-1  ]: SQL status: BEGIN in 0.008 seconds
[0m19:31:10.757276 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.fact_portfolio_summary"
[0m19:31:10.757659 [debug] [Thread-1  ]: On model.bain_capital_analytics.fact_portfolio_summary: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.fact_portfolio_summary"} */

  create view "bain_analytics"."public"."fact_portfolio_summary__dbt_tmp"
    
    
  as (
    -- Pipeline A: FACT table - Portfolio summary with positions
-- Anti-pattern: unnecessary DISTINCT on already-unique aggregation
-- Anti-pattern: late filtering (filters at the end instead of upstream)
-- Anti-pattern: materialized as view (should be table)

select distinct
    p.portfolio_id,
    p.portfolio_name,
    p.strategy,
    p.fund_id,
    p.manager_name,
    pos.position_date,
    count(distinct pos.instrument_id) as num_positions,
    sum(pos.market_value) as total_market_value,
    sum(pos.cost_basis) as total_cost_basis,
    sum(pos.unrealized_gain_loss) as total_unrealized_pnl,
    case
        when sum(pos.cost_basis) != 0
        then sum(pos.unrealized_gain_loss) / abs(sum(pos.cost_basis))
        else 0
    end as portfolio_return_pct,
    max(pos.market_value) as largest_position_mv,
    min(pos.market_value) as smallest_position_mv
from "bain_analytics"."public"."stg_portfolios" p
inner join "bain_analytics"."public"."stg_positions" pos
    on p.portfolio_id = pos.portfolio_id
-- Anti-pattern: filter at the end instead of in staging
where p.is_active = true
group by
    p.portfolio_id,
    p.portfolio_name,
    p.strategy,
    p.fund_id,
    p.manager_name,
    pos.position_date
  );
[0m19:31:10.762407 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.004 seconds
[0m19:31:10.765549 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.fact_portfolio_summary"
[0m19:31:10.765915 [debug] [Thread-1  ]: On model.bain_capital_analytics.fact_portfolio_summary: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.fact_portfolio_summary"} */
alter table "bain_analytics"."public"."fact_portfolio_summary__dbt_tmp" rename to "fact_portfolio_summary"
[0m19:31:10.766790 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m19:31:10.767782 [debug] [Thread-1  ]: On model.bain_capital_analytics.fact_portfolio_summary: COMMIT
[0m19:31:10.768092 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.fact_portfolio_summary"
[0m19:31:10.768374 [debug] [Thread-1  ]: On model.bain_capital_analytics.fact_portfolio_summary: COMMIT
[0m19:31:10.769518 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m19:31:10.773040 [debug] [Thread-1  ]: Applying DROP to: "bain_analytics"."public"."fact_portfolio_summary__dbt_backup"
[0m19:31:10.779454 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.fact_portfolio_summary"
[0m19:31:10.783038 [debug] [Thread-1  ]: On model.bain_capital_analytics.fact_portfolio_summary: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.fact_portfolio_summary"} */
drop view if exists "bain_analytics"."public"."fact_portfolio_summary__dbt_backup" cascade
[0m19:31:10.783848 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.000 seconds
[0m19:31:10.784950 [debug] [Thread-1  ]: On model.bain_capital_analytics.fact_portfolio_summary: Close
[0m19:31:10.785493 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b797888c-1388-4168-8810-42273e5eb40c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10af19880>]}
[0m19:31:10.786069 [info ] [Thread-1  ]: 10 of 14 OK created sql view model public.fact_portfolio_summary ............... [[32mCREATE VIEW[0m in 0.05s]
[0m19:31:10.786537 [debug] [Thread-1  ]: Finished running node model.bain_capital_analytics.fact_portfolio_summary
[0m19:31:10.787246 [debug] [Thread-3  ]: Began running node test.bain_capital_analytics.not_null_fact_portfolio_summary_portfolio_id.98891ba523
[0m19:31:10.787616 [debug] [Thread-4  ]: Began running node test.bain_capital_analytics.not_null_fact_portfolio_summary_position_date.f6861b4961
[0m19:31:10.787999 [info ] [Thread-3  ]: 11 of 14 START test not_null_fact_portfolio_summary_portfolio_id ............... [RUN]
[0m19:31:10.788426 [info ] [Thread-4  ]: 12 of 14 START test not_null_fact_portfolio_summary_position_date .............. [RUN]
[0m19:31:10.788844 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.not_null_stg_portfolios_portfolio_id.7126a480ec, now test.bain_capital_analytics.not_null_fact_portfolio_summary_portfolio_id.98891ba523)
[0m19:31:10.789206 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_.2823f12709, now test.bain_capital_analytics.not_null_fact_portfolio_summary_position_date.f6861b4961)
[0m19:31:10.789526 [debug] [Thread-3  ]: Began compiling node test.bain_capital_analytics.not_null_fact_portfolio_summary_portfolio_id.98891ba523
[0m19:31:10.789819 [debug] [Thread-4  ]: Began compiling node test.bain_capital_analytics.not_null_fact_portfolio_summary_position_date.f6861b4961
[0m19:31:10.793710 [debug] [Thread-3  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_fact_portfolio_summary_portfolio_id.98891ba523"
[0m19:31:10.797179 [debug] [Thread-4  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_fact_portfolio_summary_position_date.f6861b4961"
[0m19:31:10.797857 [debug] [Thread-4  ]: Began executing node test.bain_capital_analytics.not_null_fact_portfolio_summary_position_date.f6861b4961
[0m19:31:10.798202 [debug] [Thread-3  ]: Began executing node test.bain_capital_analytics.not_null_fact_portfolio_summary_portfolio_id.98891ba523
[0m19:31:10.800612 [debug] [Thread-4  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_fact_portfolio_summary_position_date.f6861b4961"
[0m19:31:10.802914 [debug] [Thread-3  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_fact_portfolio_summary_portfolio_id.98891ba523"
[0m19:31:10.803514 [debug] [Thread-4  ]: Using postgres connection "test.bain_capital_analytics.not_null_fact_portfolio_summary_position_date.f6861b4961"
[0m19:31:10.803867 [debug] [Thread-3  ]: Using postgres connection "test.bain_capital_analytics.not_null_fact_portfolio_summary_portfolio_id.98891ba523"
[0m19:31:10.804178 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_fact_portfolio_summary_position_date.f6861b4961: BEGIN
[0m19:31:10.804475 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_fact_portfolio_summary_portfolio_id.98891ba523: BEGIN
[0m19:31:10.804788 [debug] [Thread-4  ]: Opening a new connection, currently in state closed
[0m19:31:10.805099 [debug] [Thread-3  ]: Opening a new connection, currently in state closed
[0m19:31:10.815413 [debug] [Thread-3  ]: SQL status: BEGIN in 0.010 seconds
[0m19:31:10.815786 [debug] [Thread-4  ]: SQL status: BEGIN in 0.011 seconds
[0m19:31:10.816100 [debug] [Thread-3  ]: Using postgres connection "test.bain_capital_analytics.not_null_fact_portfolio_summary_portfolio_id.98891ba523"
[0m19:31:10.816398 [debug] [Thread-4  ]: Using postgres connection "test.bain_capital_analytics.not_null_fact_portfolio_summary_position_date.f6861b4961"
[0m19:31:10.816724 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_fact_portfolio_summary_portfolio_id.98891ba523: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_fact_portfolio_summary_portfolio_id.98891ba523"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select portfolio_id
from "bain_analytics"."public"."fact_portfolio_summary"
where portfolio_id is null



  
  
      
    ) dbt_internal_test
[0m19:31:10.817061 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_fact_portfolio_summary_position_date.f6861b4961: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_fact_portfolio_summary_position_date.f6861b4961"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select position_date
from "bain_analytics"."public"."fact_portfolio_summary"
where position_date is null



  
  
      
    ) dbt_internal_test
[0m19:31:10.820951 [debug] [Thread-4  ]: SQL status: SELECT 1 in 0.004 seconds
[0m19:31:10.821293 [debug] [Thread-3  ]: SQL status: SELECT 1 in 0.004 seconds
[0m19:31:10.822585 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_fact_portfolio_summary_position_date.f6861b4961: ROLLBACK
[0m19:31:10.823644 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_fact_portfolio_summary_portfolio_id.98891ba523: ROLLBACK
[0m19:31:10.824233 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_fact_portfolio_summary_portfolio_id.98891ba523: Close
[0m19:31:10.824608 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_fact_portfolio_summary_position_date.f6861b4961: Close
[0m19:31:10.825219 [info ] [Thread-3  ]: 11 of 14 PASS not_null_fact_portfolio_summary_portfolio_id ..................... [[32mPASS[0m in 0.04s]
[0m19:31:10.825736 [info ] [Thread-4  ]: 12 of 14 PASS not_null_fact_portfolio_summary_position_date .................... [[32mPASS[0m in 0.04s]
[0m19:31:10.826209 [debug] [Thread-3  ]: Finished running node test.bain_capital_analytics.not_null_fact_portfolio_summary_portfolio_id.98891ba523
[0m19:31:10.826641 [debug] [Thread-4  ]: Finished running node test.bain_capital_analytics.not_null_fact_portfolio_summary_position_date.f6861b4961
[0m19:31:10.827335 [debug] [Thread-1  ]: Began running node model.bain_capital_analytics.report_portfolio_overview
[0m19:31:10.827819 [info ] [Thread-1  ]: 13 of 14 START sql view model public.report_portfolio_overview ................. [RUN]
[0m19:31:10.828245 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.bain_capital_analytics.fact_portfolio_summary, now model.bain_capital_analytics.report_portfolio_overview)
[0m19:31:10.828586 [debug] [Thread-1  ]: Began compiling node model.bain_capital_analytics.report_portfolio_overview
[0m19:31:10.831978 [debug] [Thread-1  ]: Writing injected SQL for node "model.bain_capital_analytics.report_portfolio_overview"
[0m19:31:10.832811 [debug] [Thread-1  ]: Began executing node model.bain_capital_analytics.report_portfolio_overview
[0m19:31:10.837419 [debug] [Thread-1  ]: Writing runtime sql for node "model.bain_capital_analytics.report_portfolio_overview"
[0m19:31:10.837977 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.report_portfolio_overview"
[0m19:31:10.838279 [debug] [Thread-1  ]: On model.bain_capital_analytics.report_portfolio_overview: BEGIN
[0m19:31:10.838562 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m19:31:10.846683 [debug] [Thread-1  ]: SQL status: BEGIN in 0.008 seconds
[0m19:31:10.847000 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.report_portfolio_overview"
[0m19:31:10.847348 [debug] [Thread-1  ]: On model.bain_capital_analytics.report_portfolio_overview: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.report_portfolio_overview"} */

  create view "bain_analytics"."public"."report_portfolio_overview__dbt_tmp"
    
    
  as (
    -- Pipeline A: REPORT table - Portfolio overview for management reporting
-- Anti-pattern: re-aggregates from fact instead of using fact directly in some cases
-- Anti-pattern: subquery instead of QUALIFY for latest date

select
    fps.portfolio_id,
    fps.portfolio_name,
    fps.strategy,
    fps.manager_name,
    fps.position_date as reporting_date,
    fps.num_positions,
    fps.total_market_value,
    fps.total_cost_basis,
    fps.total_unrealized_pnl,
    fps.portfolio_return_pct,
    fps.largest_position_mv,
    fps.smallest_position_mv,
    -- Anti-pattern: duplicated fiscal quarter logic AGAIN
    case
        when extract(month from fps.position_date) between 1 and 3 then 'Q3'
        when extract(month from fps.position_date) between 4 and 6 then 'Q4'
        when extract(month from fps.position_date) between 7 and 9 then 'Q1'
        when extract(month from fps.position_date) between 10 and 12 then 'Q2'
    end as fiscal_quarter,
    case
        when extract(month from fps.position_date) >= 7
        then extract(year from fps.position_date) + 1
        else extract(year from fps.position_date)
    end as fiscal_year
from "bain_analytics"."public"."fact_portfolio_summary" fps
where fps.position_date = (
    -- Anti-pattern: correlated subquery instead of window function / QUALIFY
    select max(fps2.position_date)
    from "bain_analytics"."public"."fact_portfolio_summary" fps2
    where fps2.portfolio_id = fps.portfolio_id
)
order by fps.total_market_value desc
  );
[0m19:31:10.851775 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.004 seconds
[0m19:31:10.854757 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.report_portfolio_overview"
[0m19:31:10.855176 [debug] [Thread-1  ]: On model.bain_capital_analytics.report_portfolio_overview: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.report_portfolio_overview"} */
alter table "bain_analytics"."public"."report_portfolio_overview__dbt_tmp" rename to "report_portfolio_overview"
[0m19:31:10.856093 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m19:31:10.857096 [debug] [Thread-1  ]: On model.bain_capital_analytics.report_portfolio_overview: COMMIT
[0m19:31:10.857406 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.report_portfolio_overview"
[0m19:31:10.857700 [debug] [Thread-1  ]: On model.bain_capital_analytics.report_portfolio_overview: COMMIT
[0m19:31:10.858564 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m19:31:10.860881 [debug] [Thread-1  ]: Applying DROP to: "bain_analytics"."public"."report_portfolio_overview__dbt_backup"
[0m19:31:10.861375 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.report_portfolio_overview"
[0m19:31:10.861681 [debug] [Thread-1  ]: On model.bain_capital_analytics.report_portfolio_overview: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.report_portfolio_overview"} */
drop view if exists "bain_analytics"."public"."report_portfolio_overview__dbt_backup" cascade
[0m19:31:10.862265 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.000 seconds
[0m19:31:10.863311 [debug] [Thread-1  ]: On model.bain_capital_analytics.report_portfolio_overview: Close
[0m19:31:10.863825 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b797888c-1388-4168-8810-42273e5eb40c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10af2d1f0>]}
[0m19:31:10.864373 [info ] [Thread-1  ]: 13 of 14 OK created sql view model public.report_portfolio_overview ............ [[32mCREATE VIEW[0m in 0.04s]
[0m19:31:10.864841 [debug] [Thread-1  ]: Finished running node model.bain_capital_analytics.report_portfolio_overview
[0m19:31:10.865575 [debug] [Thread-3  ]: Began running node test.bain_capital_analytics.not_null_report_portfolio_overview_portfolio_id.4930122a4f
[0m19:31:10.866017 [info ] [Thread-3  ]: 14 of 14 START test not_null_report_portfolio_overview_portfolio_id ............ [RUN]
[0m19:31:10.866407 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.not_null_fact_portfolio_summary_portfolio_id.98891ba523, now test.bain_capital_analytics.not_null_report_portfolio_overview_portfolio_id.4930122a4f)
[0m19:31:10.866734 [debug] [Thread-3  ]: Began compiling node test.bain_capital_analytics.not_null_report_portfolio_overview_portfolio_id.4930122a4f
[0m19:31:10.870557 [debug] [Thread-3  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_report_portfolio_overview_portfolio_id.4930122a4f"
[0m19:31:10.871185 [debug] [Thread-3  ]: Began executing node test.bain_capital_analytics.not_null_report_portfolio_overview_portfolio_id.4930122a4f
[0m19:31:10.873507 [debug] [Thread-3  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_report_portfolio_overview_portfolio_id.4930122a4f"
[0m19:31:10.874032 [debug] [Thread-3  ]: Using postgres connection "test.bain_capital_analytics.not_null_report_portfolio_overview_portfolio_id.4930122a4f"
[0m19:31:10.874336 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_report_portfolio_overview_portfolio_id.4930122a4f: BEGIN
[0m19:31:10.874639 [debug] [Thread-3  ]: Opening a new connection, currently in state closed
[0m19:31:10.883900 [debug] [Thread-3  ]: SQL status: BEGIN in 0.009 seconds
[0m19:31:10.884343 [debug] [Thread-3  ]: Using postgres connection "test.bain_capital_analytics.not_null_report_portfolio_overview_portfolio_id.4930122a4f"
[0m19:31:10.884725 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_report_portfolio_overview_portfolio_id.4930122a4f: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_report_portfolio_overview_portfolio_id.4930122a4f"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select portfolio_id
from "bain_analytics"."public"."report_portfolio_overview"
where portfolio_id is null



  
  
      
    ) dbt_internal_test
[0m19:31:10.890617 [debug] [Thread-3  ]: SQL status: SELECT 1 in 0.006 seconds
[0m19:31:10.891914 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_report_portfolio_overview_portfolio_id.4930122a4f: ROLLBACK
[0m19:31:10.892557 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_report_portfolio_overview_portfolio_id.4930122a4f: Close
[0m19:31:10.893110 [info ] [Thread-3  ]: 14 of 14 PASS not_null_report_portfolio_overview_portfolio_id .................. [[32mPASS[0m in 0.03s]
[0m19:31:10.893596 [debug] [Thread-3  ]: Finished running node test.bain_capital_analytics.not_null_report_portfolio_overview_portfolio_id.4930122a4f
[0m19:31:10.894583 [debug] [MainThread]: Using postgres connection "master"
[0m19:31:10.894856 [debug] [MainThread]: On master: BEGIN
[0m19:31:10.895099 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m19:31:10.903946 [debug] [MainThread]: SQL status: BEGIN in 0.009 seconds
[0m19:31:10.904245 [debug] [MainThread]: On master: COMMIT
[0m19:31:10.904501 [debug] [MainThread]: Using postgres connection "master"
[0m19:31:10.904743 [debug] [MainThread]: On master: COMMIT
[0m19:31:10.905240 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m19:31:10.905557 [debug] [MainThread]: On master: Close
[0m19:31:10.905917 [debug] [MainThread]: Connection 'master' was properly closed.
[0m19:31:10.906162 [debug] [MainThread]: Connection 'model.bain_capital_analytics.report_portfolio_overview' was properly closed.
[0m19:31:10.906390 [debug] [MainThread]: Connection 'test.bain_capital_analytics.unique_stg_portfolios_portfolio_id.aa125b6658' was properly closed.
[0m19:31:10.906626 [debug] [MainThread]: Connection 'test.bain_capital_analytics.not_null_fact_portfolio_summary_position_date.f6861b4961' was properly closed.
[0m19:31:10.906846 [debug] [MainThread]: Connection 'test.bain_capital_analytics.not_null_report_portfolio_overview_portfolio_id.4930122a4f' was properly closed.
[0m19:31:10.907179 [info ] [MainThread]: 
[0m19:31:10.907468 [info ] [MainThread]: Finished running 10 data tests, 4 view models in 0 hours 0 minutes and 0.71 seconds (0.71s).
[0m19:31:10.909399 [debug] [MainThread]: Command end result
[0m19:31:10.952865 [debug] [MainThread]: Wrote artifact WritableManifest to ./target/manifest.json
[0m19:31:10.954706 [debug] [MainThread]: Wrote artifact SemanticManifest to ./target/semantic_manifest.json
[0m19:31:10.960969 [debug] [MainThread]: Wrote artifact RunExecutionResult to ./target/run_results.json
[0m19:31:10.961257 [info ] [MainThread]: 
[0m19:31:10.961587 [info ] [MainThread]: [32mCompleted successfully[0m
[0m19:31:10.961863 [info ] [MainThread]: 
[0m19:31:10.962153 [info ] [MainThread]: Done. PASS=14 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=14
[0m19:31:10.964850 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 2.1398501, "process_in_blocks": "0", "process_kernel_time": 0.372239, "process_mem_max_rss": "148324352", "process_out_blocks": "0", "process_user_time": 3.028462}
[0m19:31:10.965199 [debug] [MainThread]: Command `dbt build` succeeded at 19:31:10.965131 after 2.14 seconds
[0m19:31:10.965531 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108279190>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10aeb1e80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10861df10>]}
[0m19:31:10.965963 [debug] [MainThread]: Flushing usage events
[0m19:31:14.477820 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m19:31:16.116203 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c02a160>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d0d6730>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d0d6550>]}


============================== 19:31:16.119681 | 290a654a-b3cb-45e1-85a4-20dad7e7d2ab ==============================
[0m19:31:16.119681 [info ] [MainThread]: Running with dbt=1.11.0-b3
[0m19:31:16.120166 [debug] [MainThread]: running dbt with arguments {'warn_error': 'None', 'version_check': 'True', 'profiles_dir': '.', 'debug': 'False', 'no_print': 'None', 'printer_width': '80', 'log_format': 'default', 'indirect_selection': 'eager', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'quiet': 'False', 'log_cache_events': 'False', 'partial_parse': 'True', 'introspect': 'True', 'write_json': 'True', 'target_path': 'None', 'invocation_command': 'dbt build --select tag:pipeline_b --profiles-dir . --project-dir .', 'use_colors': 'True', 'log_path': 'logs', 'empty': 'False', 'cache_selected_only': 'False', 'send_anonymous_usage_stats': 'True', 'fail_fast': 'False', 'static_parser': 'True', 'use_experimental_parser': 'False'}
[0m19:31:16.313156 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '290a654a-b3cb-45e1-85a4-20dad7e7d2ab', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d7f2190>]}
[0m19:31:16.387770 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '290a654a-b3cb-45e1-85a4-20dad7e7d2ab', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d68ec10>]}
[0m19:31:16.388726 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m19:31:16.490474 [debug] [MainThread]: checksum: e63134dccc1251cfb572caf0e4aa952f030c125ee3634f3bf2c0a2e1bb6ae349, vars: {}, profile: , target: , version: 1.11.0b3
[0m19:31:16.727338 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m19:31:16.727794 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m19:31:16.791169 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '290a654a-b3cb-45e1-85a4-20dad7e7d2ab', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e2ae130>]}
[0m19:31:16.923042 [debug] [MainThread]: Wrote artifact WritableManifest to ./target/manifest.json
[0m19:31:16.925001 [debug] [MainThread]: Wrote artifact SemanticManifest to ./target/semantic_manifest.json
[0m19:31:16.953525 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '290a654a-b3cb-45e1-85a4-20dad7e7d2ab', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e217400>]}
[0m19:31:16.954058 [info ] [MainThread]: Found 28 models, 53 data tests, 10 seeds, 569 macros
[0m19:31:16.957306 [info ] [MainThread]: 
[0m19:31:16.957618 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m19:31:16.957870 [info ] [MainThread]: 
[0m19:31:16.958292 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m19:31:16.962622 [debug] [ThreadPool]: Acquiring new postgres connection 'list_bain_analytics'
[0m19:31:17.011559 [debug] [ThreadPool]: Using postgres connection "list_bain_analytics"
[0m19:31:17.011952 [debug] [ThreadPool]: On list_bain_analytics: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "connection_name": "list_bain_analytics"} */

    select distinct nspname from pg_namespace
  
[0m19:31:17.012212 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m19:31:17.040101 [debug] [ThreadPool]: SQL status: SELECT 5 in 0.028 seconds
[0m19:31:17.041348 [debug] [ThreadPool]: On list_bain_analytics: Close
[0m19:31:17.044707 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_bain_analytics, now list_bain_analytics_public)
[0m19:31:17.045223 [debug] [ThreadPool]: Acquiring new postgres connection 'list_bain_analytics_public_raw'
[0m19:31:17.051037 [debug] [ThreadPool]: Using postgres connection "list_bain_analytics_public"
[0m19:31:17.053366 [debug] [ThreadPool]: Using postgres connection "list_bain_analytics_public_raw"
[0m19:31:17.053710 [debug] [ThreadPool]: On list_bain_analytics_public: BEGIN
[0m19:31:17.053980 [debug] [ThreadPool]: On list_bain_analytics_public_raw: BEGIN
[0m19:31:17.054239 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:31:17.054483 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m19:31:17.068047 [debug] [ThreadPool]: SQL status: BEGIN in 0.014 seconds
[0m19:31:17.068361 [debug] [ThreadPool]: SQL status: BEGIN in 0.014 seconds
[0m19:31:17.068656 [debug] [ThreadPool]: Using postgres connection "list_bain_analytics_public_raw"
[0m19:31:17.068940 [debug] [ThreadPool]: Using postgres connection "list_bain_analytics_public"
[0m19:31:17.069229 [debug] [ThreadPool]: On list_bain_analytics_public_raw: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "connection_name": "list_bain_analytics_public_raw"} */
select
      'bain_analytics' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_raw'
    union all
    select
      'bain_analytics' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_raw'
    union all
    select
      'bain_analytics' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_raw'
  
[0m19:31:17.069532 [debug] [ThreadPool]: On list_bain_analytics_public: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "connection_name": "list_bain_analytics_public"} */
select
      'bain_analytics' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'bain_analytics' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'bain_analytics' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m19:31:17.074333 [debug] [ThreadPool]: SQL status: SELECT 13 in 0.004 seconds
[0m19:31:17.074647 [debug] [ThreadPool]: SQL status: SELECT 10 in 0.005 seconds
[0m19:31:17.075880 [debug] [ThreadPool]: On list_bain_analytics_public: ROLLBACK
[0m19:31:17.076909 [debug] [ThreadPool]: On list_bain_analytics_public_raw: ROLLBACK
[0m19:31:17.077542 [debug] [ThreadPool]: On list_bain_analytics_public_raw: Close
[0m19:31:17.077834 [debug] [ThreadPool]: On list_bain_analytics_public: Close
[0m19:31:17.086974 [debug] [MainThread]: Using postgres connection "master"
[0m19:31:17.087281 [debug] [MainThread]: On master: BEGIN
[0m19:31:17.087528 [debug] [MainThread]: Opening a new connection, currently in state init
[0m19:31:17.098739 [debug] [MainThread]: SQL status: BEGIN in 0.011 seconds
[0m19:31:17.099172 [debug] [MainThread]: Using postgres connection "master"
[0m19:31:17.099509 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "connection_name": "master"} */
select distinct
        dependent_namespace.nspname as dependent_schema,
        dependent_class.relname as dependent_name,
        referenced_namespace.nspname as referenced_schema,
        referenced_class.relname as referenced_name

    -- Query for views: views are entries in pg_class with an entry in pg_rewrite, but we avoid
    -- a seq scan on pg_rewrite by leveraging the fact there is an "internal" row in pg_depend for
    -- the view...
    from pg_class as dependent_class
    join pg_namespace as dependent_namespace on dependent_namespace.oid = dependent_class.relnamespace
    join pg_depend as dependent_depend on dependent_depend.refobjid = dependent_class.oid
        and dependent_depend.classid = 'pg_rewrite'::regclass
        and dependent_depend.refclassid = 'pg_class'::regclass
        and dependent_depend.deptype = 'i'

    -- ... and via pg_depend (that has a row per column, hence the need for "distinct" above, and
    -- making sure to exclude the internal row to avoid a view appearing to depend on itself)...
    join pg_depend as joining_depend on joining_depend.objid = dependent_depend.objid
        and joining_depend.classid = 'pg_rewrite'::regclass
        and joining_depend.refclassid = 'pg_class'::regclass
        and joining_depend.refobjid != dependent_depend.refobjid

    -- ... we can find the tables they query from in pg_class, but excluding system tables. Note we
    -- don't need need to exclude _dependent_ system tables, because they only query from other
    -- system tables, and so are automatically excluded by excluding _referenced_ system tables
    join pg_class as referenced_class on referenced_class.oid = joining_depend.refobjid
    join pg_namespace as referenced_namespace on referenced_namespace.oid = referenced_class.relnamespace
        and referenced_namespace.nspname != 'information_schema'
        and referenced_namespace.nspname not like 'pg\_%'

    order by
        dependent_schema, dependent_name, referenced_schema, referenced_name;
[0m19:31:17.104105 [debug] [MainThread]: SQL status: SELECT 15 in 0.004 seconds
[0m19:31:17.107427 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '290a654a-b3cb-45e1-85a4-20dad7e7d2ab', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e43e4f0>]}
[0m19:31:17.107849 [debug] [MainThread]: On master: ROLLBACK
[0m19:31:17.108527 [debug] [MainThread]: Using postgres connection "master"
[0m19:31:17.108837 [debug] [MainThread]: On master: BEGIN
[0m19:31:17.109681 [debug] [MainThread]: SQL status: BEGIN in 0.001 seconds
[0m19:31:17.109949 [debug] [MainThread]: On master: COMMIT
[0m19:31:17.110204 [debug] [MainThread]: Using postgres connection "master"
[0m19:31:17.110446 [debug] [MainThread]: On master: COMMIT
[0m19:31:17.110950 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m19:31:17.111234 [debug] [MainThread]: On master: Close
[0m19:31:17.113423 [debug] [Thread-1  ]: Began running node model.bain_capital_analytics.stg_benchmarks
[0m19:31:17.113808 [debug] [Thread-2  ]: Began running node model.bain_capital_analytics.stg_counterparties
[0m19:31:17.114581 [debug] [Thread-3  ]: Began running node model.bain_capital_analytics.stg_dates
[0m19:31:17.115068 [debug] [Thread-4  ]: Began running node model.bain_capital_analytics.stg_instruments
[0m19:31:17.114306 [info ] [Thread-1  ]: 1 of 40 START sql view model public.stg_benchmarks ............................. [RUN]
[0m19:31:17.115568 [info ] [Thread-2  ]: 2 of 40 START sql view model public.stg_counterparties ......................... [RUN]
[0m19:31:17.116176 [info ] [Thread-3  ]: 3 of 40 START sql view model public.stg_dates .................................. [RUN]
[0m19:31:17.116656 [info ] [Thread-4  ]: 4 of 40 START sql view model public.stg_instruments ............................ [RUN]
[0m19:31:17.117104 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_bain_analytics_public, now model.bain_capital_analytics.stg_benchmarks)
[0m19:31:17.117456 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly list_bain_analytics_public_raw, now model.bain_capital_analytics.stg_counterparties)
[0m19:31:17.117855 [debug] [Thread-3  ]: Acquiring new postgres connection 'model.bain_capital_analytics.stg_dates'
[0m19:31:17.118243 [debug] [Thread-4  ]: Acquiring new postgres connection 'model.bain_capital_analytics.stg_instruments'
[0m19:31:17.118564 [debug] [Thread-1  ]: Began compiling node model.bain_capital_analytics.stg_benchmarks
[0m19:31:17.118862 [debug] [Thread-2  ]: Began compiling node model.bain_capital_analytics.stg_counterparties
[0m19:31:17.119160 [debug] [Thread-3  ]: Began compiling node model.bain_capital_analytics.stg_dates
[0m19:31:17.119455 [debug] [Thread-4  ]: Began compiling node model.bain_capital_analytics.stg_instruments
[0m19:31:17.127262 [debug] [Thread-1  ]: Writing injected SQL for node "model.bain_capital_analytics.stg_benchmarks"
[0m19:31:17.131192 [debug] [Thread-2  ]: Writing injected SQL for node "model.bain_capital_analytics.stg_counterparties"
[0m19:31:17.134201 [debug] [Thread-3  ]: Writing injected SQL for node "model.bain_capital_analytics.stg_dates"
[0m19:31:17.136914 [debug] [Thread-4  ]: Writing injected SQL for node "model.bain_capital_analytics.stg_instruments"
[0m19:31:17.137767 [debug] [Thread-1  ]: Began executing node model.bain_capital_analytics.stg_benchmarks
[0m19:31:17.143884 [debug] [Thread-4  ]: Began executing node model.bain_capital_analytics.stg_instruments
[0m19:31:17.150554 [debug] [Thread-2  ]: Began executing node model.bain_capital_analytics.stg_counterparties
[0m19:31:17.150889 [debug] [Thread-3  ]: Began executing node model.bain_capital_analytics.stg_dates
[0m19:31:17.180780 [debug] [Thread-1  ]: Writing runtime sql for node "model.bain_capital_analytics.stg_benchmarks"
[0m19:31:17.184250 [debug] [Thread-2  ]: Writing runtime sql for node "model.bain_capital_analytics.stg_counterparties"
[0m19:31:17.184794 [debug] [Thread-4  ]: Writing runtime sql for node "model.bain_capital_analytics.stg_instruments"
[0m19:31:17.188084 [debug] [Thread-3  ]: Writing runtime sql for node "model.bain_capital_analytics.stg_dates"
[0m19:31:17.188940 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.stg_counterparties"
[0m19:31:17.189340 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.stg_dates"
[0m19:31:17.189693 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.stg_instruments"
[0m19:31:17.190014 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.stg_benchmarks"
[0m19:31:17.190297 [debug] [Thread-2  ]: On model.bain_capital_analytics.stg_counterparties: BEGIN
[0m19:31:17.190594 [debug] [Thread-3  ]: On model.bain_capital_analytics.stg_dates: BEGIN
[0m19:31:17.190888 [debug] [Thread-4  ]: On model.bain_capital_analytics.stg_instruments: BEGIN
[0m19:31:17.191196 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_benchmarks: BEGIN
[0m19:31:17.191513 [debug] [Thread-2  ]: Opening a new connection, currently in state closed
[0m19:31:17.191818 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m19:31:17.192117 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m19:31:17.192411 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m19:31:17.208901 [debug] [Thread-3  ]: SQL status: BEGIN in 0.017 seconds
[0m19:31:17.209286 [debug] [Thread-1  ]: SQL status: BEGIN in 0.017 seconds
[0m19:31:17.209611 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.stg_dates"
[0m19:31:17.209901 [debug] [Thread-4  ]: SQL status: BEGIN in 0.018 seconds
[0m19:31:17.210232 [debug] [Thread-2  ]: SQL status: BEGIN in 0.019 seconds
[0m19:31:17.210534 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.stg_benchmarks"
[0m19:31:17.210874 [debug] [Thread-3  ]: On model.bain_capital_analytics.stg_dates: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_dates"} */

  create view "bain_analytics"."public"."stg_dates__dbt_tmp"
    
    
  as (
    select
    cast(date_day as date) as date_day,
    cast(is_business_day as boolean) as is_business_day,
    cast(is_month_end as boolean) as is_month_end,
    cast(is_quarter_end as boolean) as is_quarter_end,
    cast(is_year_end as boolean) as is_year_end,
    fiscal_quarter,
    fiscal_year,
    -- Anti-pattern: PostgreSQL-specific date_trunc
    date_trunc('month', cast(date_day as date)) as month_start,
    date_trunc('quarter', cast(date_day as date)) as quarter_start,
    extract(month from cast(date_day as date)) as calendar_month,
    extract(year from cast(date_day as date)) as calendar_year
from "bain_analytics"."public_raw"."raw_dates"
  );
[0m19:31:17.211201 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.stg_instruments"
[0m19:31:17.211493 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.stg_counterparties"
[0m19:31:17.211819 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_benchmarks: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_benchmarks"} */

  create view "bain_analytics"."public"."stg_benchmarks__dbt_tmp"
    
    
  as (
    select distinct
    benchmark_id,
    benchmark_name,
    cast(benchmark_date as date) as benchmark_date,
    cast(return_daily as numeric(18,8)) as return_daily,
    cast(return_mtd as numeric(18,8)) as return_mtd,
    cast(return_ytd as numeric(18,8)) as return_ytd,
    cast(benchmark_level as numeric(18,4)) as benchmark_level,
    -- Anti-pattern: duplicated fiscal quarter logic
    case
        when extract(month from cast(benchmark_date as date)) between 1 and 3 then 'Q3'
        when extract(month from cast(benchmark_date as date)) between 4 and 6 then 'Q4'
        when extract(month from cast(benchmark_date as date)) between 7 and 9 then 'Q1'
        when extract(month from cast(benchmark_date as date)) between 10 and 12 then 'Q2'
    end as benchmark_fiscal_quarter
from "bain_analytics"."public_raw"."raw_benchmarks"
  );
[0m19:31:17.212266 [debug] [Thread-4  ]: On model.bain_capital_analytics.stg_instruments: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_instruments"} */

  create view "bain_analytics"."public"."stg_instruments__dbt_tmp"
    
    
  as (
    -- Anti-pattern: unnecessary DISTINCT
select distinct
    instrument_id,
    instrument_name,
    instrument_type,
    sector,
    currency,
    exchange,
    issuer,
    cast(maturity_date as date) as maturity_date,
    -- Anti-pattern: PostgreSQL-specific date subtraction
    case
        when maturity_date is not null
        then cast(maturity_date as date) - current_date
        else null
    end as days_to_maturity,
    case
        when instrument_type in ('equity', 'futures') then 'liquid'
        when instrument_type in ('corporate_bond', 'government_bond', 'sovereign_bond', 'leveraged_loan') then 'semi_liquid'
        when instrument_type in ('private_equity', 'venture_capital', 'real_estate', 'real_estate_debt', 'infrastructure') then 'illiquid'
        else 'other'
    end as liquidity_class
from "bain_analytics"."public_raw"."raw_instruments"
  );
[0m19:31:17.212687 [debug] [Thread-2  ]: On model.bain_capital_analytics.stg_counterparties: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_counterparties"} */

  create view "bain_analytics"."public"."stg_counterparties__dbt_tmp"
    
    
  as (
    select distinct
    counterparty_id,
    counterparty_name,
    counterparty_type,
    country,
    credit_rating,
    cast(is_active as boolean) as is_active
from "bain_analytics"."public_raw"."raw_counterparties"
where cast(is_active as boolean) = true
  );
[0m19:31:17.215288 [debug] [Thread-3  ]: SQL status: CREATE VIEW in 0.003 seconds
[0m19:31:17.221645 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.stg_dates"
[0m19:31:17.222019 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.009 seconds
[0m19:31:17.222322 [debug] [Thread-4  ]: SQL status: CREATE VIEW in 0.009 seconds
[0m19:31:17.222614 [debug] [Thread-3  ]: On model.bain_capital_analytics.stg_dates: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_dates"} */
alter table "bain_analytics"."public"."stg_dates" rename to "stg_dates__dbt_backup"
[0m19:31:17.222900 [debug] [Thread-2  ]: SQL status: CREATE VIEW in 0.010 seconds
[0m19:31:17.226004 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.stg_benchmarks"
[0m19:31:17.229534 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.stg_instruments"
[0m19:31:17.232698 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.stg_counterparties"
[0m19:31:17.233047 [debug] [Thread-3  ]: SQL status: ALTER TABLE in 0.003 seconds
[0m19:31:17.233345 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_benchmarks: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_benchmarks"} */
alter table "bain_analytics"."public"."stg_benchmarks" rename to "stg_benchmarks__dbt_backup"
[0m19:31:17.233650 [debug] [Thread-4  ]: On model.bain_capital_analytics.stg_instruments: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_instruments"} */
alter table "bain_analytics"."public"."stg_instruments" rename to "stg_instruments__dbt_backup"
[0m19:31:17.233949 [debug] [Thread-2  ]: On model.bain_capital_analytics.stg_counterparties: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_counterparties"} */
alter table "bain_analytics"."public"."stg_counterparties" rename to "stg_counterparties__dbt_backup"
[0m19:31:17.236475 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.stg_dates"
[0m19:31:17.236905 [debug] [Thread-3  ]: On model.bain_capital_analytics.stg_dates: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_dates"} */
alter table "bain_analytics"."public"."stg_dates__dbt_tmp" rename to "stg_dates"
[0m19:31:17.238301 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.002 seconds
[0m19:31:17.240813 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.stg_benchmarks"
[0m19:31:17.241129 [debug] [Thread-4  ]: SQL status: ALTER TABLE in 0.004 seconds
[0m19:31:17.241416 [debug] [Thread-3  ]: SQL status: ALTER TABLE in 0.004 seconds
[0m19:31:17.241696 [debug] [Thread-2  ]: SQL status: ALTER TABLE in 0.005 seconds
[0m19:31:17.241994 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_benchmarks: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_benchmarks"} */
alter table "bain_analytics"."public"."stg_benchmarks__dbt_tmp" rename to "stg_benchmarks"
[0m19:31:17.244834 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.stg_instruments"
[0m19:31:17.261044 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.stg_counterparties"
[0m19:31:17.262682 [debug] [Thread-3  ]: On model.bain_capital_analytics.stg_dates: COMMIT
[0m19:31:17.263090 [debug] [Thread-4  ]: On model.bain_capital_analytics.stg_instruments: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_instruments"} */
alter table "bain_analytics"."public"."stg_instruments__dbt_tmp" rename to "stg_instruments"
[0m19:31:17.263449 [debug] [Thread-2  ]: On model.bain_capital_analytics.stg_counterparties: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_counterparties"} */
alter table "bain_analytics"."public"."stg_counterparties__dbt_tmp" rename to "stg_counterparties"
[0m19:31:17.263770 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.stg_dates"
[0m19:31:17.264154 [debug] [Thread-3  ]: On model.bain_capital_analytics.stg_dates: COMMIT
[0m19:31:17.264597 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.002 seconds
[0m19:31:17.265617 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_benchmarks: COMMIT
[0m19:31:17.266023 [debug] [Thread-4  ]: SQL status: ALTER TABLE in 0.002 seconds
[0m19:31:17.266340 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.stg_benchmarks"
[0m19:31:17.266617 [debug] [Thread-2  ]: SQL status: ALTER TABLE in 0.003 seconds
[0m19:31:17.266934 [debug] [Thread-3  ]: SQL status: COMMIT in 0.002 seconds
[0m19:31:17.268000 [debug] [Thread-4  ]: On model.bain_capital_analytics.stg_instruments: COMMIT
[0m19:31:17.268320 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_benchmarks: COMMIT
[0m19:31:17.269329 [debug] [Thread-2  ]: On model.bain_capital_analytics.stg_counterparties: COMMIT
[0m19:31:17.316515 [debug] [Thread-3  ]: Applying DROP to: "bain_analytics"."public"."stg_dates__dbt_backup"
[0m19:31:17.316950 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.stg_instruments"
[0m19:31:17.317416 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.stg_counterparties"
[0m19:31:17.321133 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.stg_dates"
[0m19:31:17.321509 [debug] [Thread-1  ]: SQL status: COMMIT in 0.004 seconds
[0m19:31:17.321817 [debug] [Thread-4  ]: On model.bain_capital_analytics.stg_instruments: COMMIT
[0m19:31:17.322114 [debug] [Thread-2  ]: On model.bain_capital_analytics.stg_counterparties: COMMIT
[0m19:31:17.322411 [debug] [Thread-3  ]: On model.bain_capital_analytics.stg_dates: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_dates"} */
drop view if exists "bain_analytics"."public"."stg_dates__dbt_backup" cascade
[0m19:31:17.324748 [debug] [Thread-1  ]: Applying DROP to: "bain_analytics"."public"."stg_benchmarks__dbt_backup"
[0m19:31:17.325359 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.stg_benchmarks"
[0m19:31:17.325690 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_benchmarks: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_benchmarks"} */
drop view if exists "bain_analytics"."public"."stg_benchmarks__dbt_backup" cascade
[0m19:31:17.326588 [debug] [Thread-4  ]: SQL status: COMMIT in 0.001 seconds
[0m19:31:17.326891 [debug] [Thread-2  ]: SQL status: COMMIT in 0.002 seconds
[0m19:31:17.329172 [debug] [Thread-4  ]: Applying DROP to: "bain_analytics"."public"."stg_instruments__dbt_backup"
[0m19:31:17.331319 [debug] [Thread-2  ]: Applying DROP to: "bain_analytics"."public"."stg_counterparties__dbt_backup"
[0m19:31:17.331657 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.006 seconds
[0m19:31:17.331972 [debug] [Thread-3  ]: SQL status: DROP VIEW in 0.007 seconds
[0m19:31:17.332509 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.stg_instruments"
[0m19:31:17.332983 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.stg_counterparties"
[0m19:31:17.335168 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_benchmarks: Close
[0m19:31:17.336170 [debug] [Thread-3  ]: On model.bain_capital_analytics.stg_dates: Close
[0m19:31:17.336489 [debug] [Thread-4  ]: On model.bain_capital_analytics.stg_instruments: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_instruments"} */
drop view if exists "bain_analytics"."public"."stg_instruments__dbt_backup" cascade
[0m19:31:17.336805 [debug] [Thread-2  ]: On model.bain_capital_analytics.stg_counterparties: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_counterparties"} */
drop view if exists "bain_analytics"."public"."stg_counterparties__dbt_backup" cascade
[0m19:31:17.338605 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '290a654a-b3cb-45e1-85a4-20dad7e7d2ab', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e9250d0>]}
[0m19:31:17.338902 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '290a654a-b3cb-45e1-85a4-20dad7e7d2ab', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e925460>]}
[0m19:31:17.339512 [info ] [Thread-3  ]: 3 of 40 OK created sql view model public.stg_dates ............................. [[32mCREATE VIEW[0m in 0.22s]
[0m19:31:17.339975 [info ] [Thread-1  ]: 1 of 40 OK created sql view model public.stg_benchmarks ........................ [[32mCREATE VIEW[0m in 0.22s]
[0m19:31:17.340426 [debug] [Thread-3  ]: Finished running node model.bain_capital_analytics.stg_dates
[0m19:31:17.340842 [debug] [Thread-1  ]: Finished running node model.bain_capital_analytics.stg_benchmarks
[0m19:31:17.341193 [debug] [Thread-3  ]: Began running node model.bain_capital_analytics.stg_portfolios
[0m19:31:17.341480 [debug] [Thread-2  ]: SQL status: DROP VIEW in 0.003 seconds
[0m19:31:17.341782 [debug] [Thread-4  ]: SQL status: DROP VIEW in 0.003 seconds
[0m19:31:17.342204 [debug] [Thread-1  ]: Began running node model.bain_capital_analytics.stg_positions
[0m19:31:17.342737 [info ] [Thread-3  ]: 5 of 40 START sql view model public.stg_portfolios ............................. [RUN]
[0m19:31:17.343883 [debug] [Thread-2  ]: On model.bain_capital_analytics.stg_counterparties: Close
[0m19:31:17.344875 [debug] [Thread-4  ]: On model.bain_capital_analytics.stg_instruments: Close
[0m19:31:17.345278 [info ] [Thread-1  ]: 6 of 40 START sql view model public.stg_positions .............................. [RUN]
[0m19:31:17.345668 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly model.bain_capital_analytics.stg_dates, now model.bain_capital_analytics.stg_portfolios)
[0m19:31:17.346117 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '290a654a-b3cb-45e1-85a4-20dad7e7d2ab', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e863370>]}
[0m19:31:17.346624 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '290a654a-b3cb-45e1-85a4-20dad7e7d2ab', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e9cfeb0>]}
[0m19:31:17.347018 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.bain_capital_analytics.stg_benchmarks, now model.bain_capital_analytics.stg_positions)
[0m19:31:17.347378 [debug] [Thread-3  ]: Began compiling node model.bain_capital_analytics.stg_portfolios
[0m19:31:17.347961 [info ] [Thread-4  ]: 4 of 40 OK created sql view model public.stg_instruments ....................... [[32mCREATE VIEW[0m in 0.23s]
[0m19:31:17.348406 [info ] [Thread-2  ]: 2 of 40 OK created sql view model public.stg_counterparties .................... [[32mCREATE VIEW[0m in 0.23s]
[0m19:31:17.348714 [debug] [Thread-1  ]: Began compiling node model.bain_capital_analytics.stg_positions
[0m19:31:17.351818 [debug] [Thread-3  ]: Writing injected SQL for node "model.bain_capital_analytics.stg_portfolios"
[0m19:31:17.352306 [debug] [Thread-4  ]: Finished running node model.bain_capital_analytics.stg_instruments
[0m19:31:17.352741 [debug] [Thread-2  ]: Finished running node model.bain_capital_analytics.stg_counterparties
[0m19:31:17.356648 [debug] [Thread-1  ]: Writing injected SQL for node "model.bain_capital_analytics.stg_positions"
[0m19:31:17.357081 [debug] [Thread-4  ]: Began running node model.bain_capital_analytics.stg_trades
[0m19:31:17.357480 [debug] [Thread-2  ]: Began running node test.bain_capital_analytics.not_null_stg_dates_date_day.f3ec4da188
[0m19:31:17.358109 [info ] [Thread-4  ]: 7 of 40 START sql view model public.stg_trades ................................. [RUN]
[0m19:31:17.358497 [debug] [Thread-3  ]: Began executing node model.bain_capital_analytics.stg_portfolios
[0m19:31:17.358831 [info ] [Thread-2  ]: 8 of 40 START test not_null_stg_dates_date_day ................................. [RUN]
[0m19:31:17.359247 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly model.bain_capital_analytics.stg_instruments, now model.bain_capital_analytics.stg_trades)
[0m19:31:17.359575 [debug] [Thread-1  ]: Began executing node model.bain_capital_analytics.stg_positions
[0m19:31:17.362866 [debug] [Thread-3  ]: Writing runtime sql for node "model.bain_capital_analytics.stg_portfolios"
[0m19:31:17.363211 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly model.bain_capital_analytics.stg_counterparties, now test.bain_capital_analytics.not_null_stg_dates_date_day.f3ec4da188)
[0m19:31:17.363523 [debug] [Thread-4  ]: Began compiling node model.bain_capital_analytics.stg_trades
[0m19:31:17.366764 [debug] [Thread-1  ]: Writing runtime sql for node "model.bain_capital_analytics.stg_positions"
[0m19:31:17.367198 [debug] [Thread-2  ]: Began compiling node test.bain_capital_analytics.not_null_stg_dates_date_day.f3ec4da188
[0m19:31:17.369979 [debug] [Thread-4  ]: Writing injected SQL for node "model.bain_capital_analytics.stg_trades"
[0m19:31:17.370446 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.stg_portfolios"
[0m19:31:17.380208 [debug] [Thread-2  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_stg_dates_date_day.f3ec4da188"
[0m19:31:17.380651 [debug] [Thread-3  ]: On model.bain_capital_analytics.stg_portfolios: BEGIN
[0m19:31:17.381014 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.stg_positions"
[0m19:31:17.381428 [debug] [Thread-3  ]: Opening a new connection, currently in state closed
[0m19:31:17.381757 [debug] [Thread-4  ]: Began executing node model.bain_capital_analytics.stg_trades
[0m19:31:17.382038 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_positions: BEGIN
[0m19:31:17.382555 [debug] [Thread-2  ]: Began executing node test.bain_capital_analytics.not_null_stg_dates_date_day.f3ec4da188
[0m19:31:17.386744 [debug] [Thread-4  ]: Writing runtime sql for node "model.bain_capital_analytics.stg_trades"
[0m19:31:17.387065 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m19:31:17.399165 [debug] [Thread-3  ]: SQL status: BEGIN in 0.018 seconds
[0m19:31:17.402819 [debug] [Thread-2  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_stg_dates_date_day.f3ec4da188"
[0m19:31:17.403416 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.stg_portfolios"
[0m19:31:17.403876 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.stg_trades"
[0m19:31:17.404247 [debug] [Thread-3  ]: On model.bain_capital_analytics.stg_portfolios: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_portfolios"} */

  create view "bain_analytics"."public"."stg_portfolios__dbt_tmp"
    
    
  as (
    -- Anti-pattern: unnecessary DISTINCT when source data is already unique
-- Anti-pattern: casting in every model instead of once upstream

select distinct
    cast(portfolio_id as varchar(10)) as portfolio_id,
    cast(portfolio_name as varchar(100)) as portfolio_name,
    cast(strategy as varchar(50)) as strategy,
    cast(inception_date as date) as inception_date,
    cast(fund_id as varchar(10)) as fund_id,
    cast(manager_name as varchar(100)) as manager_name,
    cast(is_active as boolean) as is_active,
    -- Anti-pattern: duplicated fiscal quarter logic (repeated in many models)
    case
        when extract(month from cast(inception_date as date)) between 1 and 3 then 'Q3'
        when extract(month from cast(inception_date as date)) between 4 and 6 then 'Q4'
        when extract(month from cast(inception_date as date)) between 7 and 9 then 'Q1'
        when extract(month from cast(inception_date as date)) between 10 and 12 then 'Q2'
    end as inception_fiscal_quarter
from "bain_analytics"."public_raw"."raw_portfolios"
where cast(is_active as boolean) = true
  );
[0m19:31:17.404610 [debug] [Thread-4  ]: On model.bain_capital_analytics.stg_trades: BEGIN
[0m19:31:17.404997 [debug] [Thread-4  ]: Opening a new connection, currently in state closed
[0m19:31:17.405348 [debug] [Thread-2  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_dates_date_day.f3ec4da188"
[0m19:31:17.405742 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_stg_dates_date_day.f3ec4da188: BEGIN
[0m19:31:17.406040 [debug] [Thread-2  ]: Opening a new connection, currently in state closed
[0m19:31:17.412547 [debug] [Thread-3  ]: SQL status: CREATE VIEW in 0.008 seconds
[0m19:31:17.415979 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.stg_portfolios"
[0m19:31:17.416343 [debug] [Thread-3  ]: On model.bain_capital_analytics.stg_portfolios: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_portfolios"} */
alter table "bain_analytics"."public"."stg_portfolios" rename to "stg_portfolios__dbt_backup"
[0m19:31:17.416840 [debug] [Thread-2  ]: SQL status: BEGIN in 0.011 seconds
[0m19:31:17.417186 [debug] [Thread-2  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_dates_date_day.f3ec4da188"
[0m19:31:17.417510 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_stg_dates_date_day.f3ec4da188: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_stg_dates_date_day.f3ec4da188"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select date_day
from "bain_analytics"."public"."stg_dates"
where date_day is null



  
  
      
    ) dbt_internal_test
[0m19:31:17.417831 [debug] [Thread-4  ]: SQL status: BEGIN in 0.013 seconds
[0m19:31:17.418145 [debug] [Thread-3  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m19:31:17.418454 [debug] [Thread-1  ]: SQL status: BEGIN in 0.031 seconds
[0m19:31:17.418758 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.stg_trades"
[0m19:31:17.421575 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.stg_portfolios"
[0m19:31:17.421889 [debug] [Thread-2  ]: SQL status: SELECT 1 in 0.003 seconds
[0m19:31:17.422168 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.stg_positions"
[0m19:31:17.422509 [debug] [Thread-4  ]: On model.bain_capital_analytics.stg_trades: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_trades"} */

  create view "bain_analytics"."public"."stg_trades__dbt_tmp"
    
    
  as (
    -- Anti-pattern: unnecessary DISTINCT on already-unique trade_id
-- Anti-pattern: heavy casting repeated everywhere

select distinct
    trade_id,
    portfolio_id,
    instrument_id,
    counterparty_id,
    cast(trade_date as date) as trade_date,
    cast(settlement_date as date) as settlement_date,
    trade_type,
    cast(quantity as numeric(18,4)) as quantity,
    cast(price as numeric(18,6)) as price,
    cast(notional_amount as numeric(18,2)) as notional_amount,
    cast(commission as numeric(18,2)) as commission,
    currency,
    status,
    -- Anti-pattern: duplicated fiscal quarter logic
    case
        when extract(month from cast(trade_date as date)) between 1 and 3 then 'Q3'
        when extract(month from cast(trade_date as date)) between 4 and 6 then 'Q4'
        when extract(month from cast(trade_date as date)) between 7 and 9 then 'Q1'
        when extract(month from cast(trade_date as date)) between 10 and 12 then 'Q2'
    end as trade_fiscal_quarter,
    -- Anti-pattern: PostgreSQL-specific date arithmetic
    cast(settlement_date as date) - cast(trade_date as date) as settlement_days
from "bain_analytics"."public_raw"."raw_trades"
where status = 'settled'
  );
[0m19:31:17.422869 [debug] [Thread-3  ]: On model.bain_capital_analytics.stg_portfolios: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_portfolios"} */
alter table "bain_analytics"."public"."stg_portfolios__dbt_tmp" rename to "stg_portfolios"
[0m19:31:17.425651 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_stg_dates_date_day.f3ec4da188: ROLLBACK
[0m19:31:17.426025 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_positions: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_positions"} */

  create view "bain_analytics"."public"."stg_positions__dbt_tmp"
    
    
  as (
    -- Anti-pattern: unnecessary DISTINCT
-- Anti-pattern: no filtering or partitioning strategy

select distinct
    position_id,
    portfolio_id,
    instrument_id,
    cast(position_date as date) as position_date,
    cast(quantity as numeric(18,4)) as quantity,
    cast(market_value as numeric(18,2)) as market_value,
    cast(cost_basis as numeric(18,2)) as cost_basis,
    currency,
    -- Anti-pattern: computed column that could be done downstream
    cast(market_value as numeric(18,2)) - cast(cost_basis as numeric(18,2)) as unrealized_gain_loss,
    case
        when cast(cost_basis as numeric(18,2)) != 0
        then (cast(market_value as numeric(18,2)) - cast(cost_basis as numeric(18,2))) / abs(cast(cost_basis as numeric(18,2)))
        else 0
    end as unrealized_return_pct
from "bain_analytics"."public_raw"."raw_positions"
  );
[0m19:31:17.427153 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_stg_dates_date_day.f3ec4da188: Close
[0m19:31:17.427656 [info ] [Thread-2  ]: 8 of 40 PASS not_null_stg_dates_date_day ....................................... [[32mPASS[0m in 0.06s]
[0m19:31:17.427993 [debug] [Thread-3  ]: SQL status: ALTER TABLE in 0.002 seconds
[0m19:31:17.428416 [debug] [Thread-2  ]: Finished running node test.bain_capital_analytics.not_null_stg_dates_date_day.f3ec4da188
[0m19:31:17.429446 [debug] [Thread-3  ]: On model.bain_capital_analytics.stg_portfolios: COMMIT
[0m19:31:17.429789 [debug] [Thread-2  ]: Began running node test.bain_capital_analytics.unique_stg_dates_date_day.e062be8e28
[0m19:31:17.430156 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.stg_portfolios"
[0m19:31:17.430477 [info ] [Thread-2  ]: 9 of 40 START test unique_stg_dates_date_day ................................... [RUN]
[0m19:31:17.430794 [debug] [Thread-3  ]: On model.bain_capital_analytics.stg_portfolios: COMMIT
[0m19:31:17.431125 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.not_null_stg_dates_date_day.f3ec4da188, now test.bain_capital_analytics.unique_stg_dates_date_day.e062be8e28)
[0m19:31:17.431461 [debug] [Thread-2  ]: Began compiling node test.bain_capital_analytics.unique_stg_dates_date_day.e062be8e28
[0m19:31:17.431766 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.005 seconds
[0m19:31:17.437506 [debug] [Thread-2  ]: Writing injected SQL for node "test.bain_capital_analytics.unique_stg_dates_date_day.e062be8e28"
[0m19:31:17.437818 [debug] [Thread-4  ]: SQL status: CREATE VIEW in 0.011 seconds
[0m19:31:17.438097 [debug] [Thread-3  ]: SQL status: COMMIT in 0.007 seconds
[0m19:31:17.442190 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.stg_positions"
[0m19:31:17.445139 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.stg_trades"
[0m19:31:17.447341 [debug] [Thread-3  ]: Applying DROP to: "bain_analytics"."public"."stg_portfolios__dbt_backup"
[0m19:31:17.447704 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_positions: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_positions"} */
alter table "bain_analytics"."public"."stg_positions" rename to "stg_positions__dbt_backup"
[0m19:31:17.448071 [debug] [Thread-4  ]: On model.bain_capital_analytics.stg_trades: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_trades"} */
alter table "bain_analytics"."public"."stg_trades" rename to "stg_trades__dbt_backup"
[0m19:31:17.448434 [debug] [Thread-2  ]: Began executing node test.bain_capital_analytics.unique_stg_dates_date_day.e062be8e28
[0m19:31:17.448892 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.stg_portfolios"
[0m19:31:17.451299 [debug] [Thread-2  ]: Writing runtime sql for node "test.bain_capital_analytics.unique_stg_dates_date_day.e062be8e28"
[0m19:31:17.451644 [debug] [Thread-4  ]: SQL status: ALTER TABLE in 0.002 seconds
[0m19:31:17.451944 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.003 seconds
[0m19:31:17.452270 [debug] [Thread-3  ]: On model.bain_capital_analytics.stg_portfolios: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_portfolios"} */
drop view if exists "bain_analytics"."public"."stg_portfolios__dbt_backup" cascade
[0m19:31:17.454988 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.stg_trades"
[0m19:31:17.457578 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.stg_positions"
[0m19:31:17.457966 [debug] [Thread-4  ]: On model.bain_capital_analytics.stg_trades: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_trades"} */
alter table "bain_analytics"."public"."stg_trades__dbt_tmp" rename to "stg_trades"
[0m19:31:17.458302 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_positions: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_positions"} */
alter table "bain_analytics"."public"."stg_positions__dbt_tmp" rename to "stg_positions"
[0m19:31:17.458611 [debug] [Thread-2  ]: Using postgres connection "test.bain_capital_analytics.unique_stg_dates_date_day.e062be8e28"
[0m19:31:17.458960 [debug] [Thread-2  ]: On test.bain_capital_analytics.unique_stg_dates_date_day.e062be8e28: BEGIN
[0m19:31:17.459238 [debug] [Thread-2  ]: Opening a new connection, currently in state closed
[0m19:31:17.460210 [debug] [Thread-4  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m19:31:17.461241 [debug] [Thread-4  ]: On model.bain_capital_analytics.stg_trades: COMMIT
[0m19:31:17.461554 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.003 seconds
[0m19:31:17.461843 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.stg_trades"
[0m19:31:17.463829 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_positions: COMMIT
[0m19:31:17.464149 [debug] [Thread-3  ]: SQL status: DROP VIEW in 0.006 seconds
[0m19:31:17.464435 [debug] [Thread-4  ]: On model.bain_capital_analytics.stg_trades: COMMIT
[0m19:31:17.464738 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.stg_positions"
[0m19:31:17.465787 [debug] [Thread-3  ]: On model.bain_capital_analytics.stg_portfolios: Close
[0m19:31:17.466152 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_positions: COMMIT
[0m19:31:17.466699 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '290a654a-b3cb-45e1-85a4-20dad7e7d2ab', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e832b80>]}
[0m19:31:17.467051 [debug] [Thread-4  ]: SQL status: COMMIT in 0.001 seconds
[0m19:31:17.470024 [debug] [Thread-4  ]: Applying DROP to: "bain_analytics"."public"."stg_trades__dbt_backup"
[0m19:31:17.470618 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.stg_trades"
[0m19:31:17.470952 [debug] [Thread-2  ]: SQL status: BEGIN in 0.012 seconds
[0m19:31:17.467623 [info ] [Thread-3  ]: 5 of 40 OK created sql view model public.stg_portfolios ........................ [[32mCREATE VIEW[0m in 0.12s]
[0m19:31:17.471357 [debug] [Thread-1  ]: SQL status: COMMIT in 0.004 seconds
[0m19:31:17.471649 [debug] [Thread-4  ]: On model.bain_capital_analytics.stg_trades: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_trades"} */
drop view if exists "bain_analytics"."public"."stg_trades__dbt_backup" cascade
[0m19:31:17.471948 [debug] [Thread-2  ]: Using postgres connection "test.bain_capital_analytics.unique_stg_dates_date_day.e062be8e28"
[0m19:31:17.472380 [debug] [Thread-3  ]: Finished running node model.bain_capital_analytics.stg_portfolios
[0m19:31:17.474578 [debug] [Thread-1  ]: Applying DROP to: "bain_analytics"."public"."stg_positions__dbt_backup"
[0m19:31:17.474937 [debug] [Thread-2  ]: On test.bain_capital_analytics.unique_stg_dates_date_day.e062be8e28: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.unique_stg_dates_date_day.e062be8e28"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

select
    date_day as unique_field,
    count(*) as n_records

from "bain_analytics"."public"."stg_dates"
where date_day is not null
group by date_day
having count(*) > 1



  
  
      
    ) dbt_internal_test
[0m19:31:17.475304 [debug] [Thread-3  ]: Began running node test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_date.d5c8f88f3e
[0m19:31:17.475838 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.stg_positions"
[0m19:31:17.476296 [info ] [Thread-3  ]: 10 of 40 START test not_null_stg_benchmarks_benchmark_date ..................... [RUN]
[0m19:31:17.476631 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_positions: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_positions"} */
drop view if exists "bain_analytics"."public"."stg_positions__dbt_backup" cascade
[0m19:31:17.476982 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly model.bain_capital_analytics.stg_portfolios, now test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_date.d5c8f88f3e)
[0m19:31:17.477293 [debug] [Thread-4  ]: SQL status: DROP VIEW in 0.002 seconds
[0m19:31:17.477616 [debug] [Thread-3  ]: Began compiling node test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_date.d5c8f88f3e
[0m19:31:17.478658 [debug] [Thread-4  ]: On model.bain_capital_analytics.stg_trades: Close
[0m19:31:17.478963 [debug] [Thread-2  ]: SQL status: SELECT 1 in 0.003 seconds
[0m19:31:17.482651 [debug] [Thread-3  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_date.d5c8f88f3e"
[0m19:31:17.482982 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.005 seconds
[0m19:31:17.483436 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '290a654a-b3cb-45e1-85a4-20dad7e7d2ab', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ead8d60>]}
[0m19:31:17.484545 [debug] [Thread-2  ]: On test.bain_capital_analytics.unique_stg_dates_date_day.e062be8e28: ROLLBACK
[0m19:31:17.485617 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_positions: Close
[0m19:31:17.486189 [info ] [Thread-4  ]: 7 of 40 OK created sql view model public.stg_trades ............................ [[32mCREATE VIEW[0m in 0.12s]
[0m19:31:17.486727 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '290a654a-b3cb-45e1-85a4-20dad7e7d2ab', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ea05cd0>]}
[0m19:31:17.487063 [debug] [Thread-3  ]: Began executing node test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_date.d5c8f88f3e
[0m19:31:17.487485 [debug] [Thread-4  ]: Finished running node model.bain_capital_analytics.stg_trades
[0m19:31:17.487766 [debug] [Thread-2  ]: On test.bain_capital_analytics.unique_stg_dates_date_day.e062be8e28: Close
[0m19:31:17.488289 [info ] [Thread-1  ]: 6 of 40 OK created sql view model public.stg_positions ......................... [[32mCREATE VIEW[0m in 0.14s]
[0m19:31:17.490615 [debug] [Thread-3  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_date.d5c8f88f3e"
[0m19:31:17.490954 [debug] [Thread-4  ]: Began running node test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_id.ec87e4ee58
[0m19:31:17.491576 [info ] [Thread-2  ]: 9 of 40 PASS unique_stg_dates_date_day ......................................... [[32mPASS[0m in 0.06s]
[0m19:31:17.492039 [debug] [Thread-1  ]: Finished running node model.bain_capital_analytics.stg_positions
[0m19:31:17.492429 [info ] [Thread-4  ]: 11 of 40 START test not_null_stg_benchmarks_benchmark_id ....................... [RUN]
[0m19:31:17.492911 [debug] [Thread-2  ]: Finished running node test.bain_capital_analytics.unique_stg_dates_date_day.e062be8e28
[0m19:31:17.493241 [debug] [Thread-1  ]: Began running node test.bain_capital_analytics.not_null_stg_counterparties_counterparty_id.4754302940
[0m19:31:17.493574 [debug] [Thread-3  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_date.d5c8f88f3e"
[0m19:31:17.493960 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly model.bain_capital_analytics.stg_trades, now test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_id.ec87e4ee58)
[0m19:31:17.494393 [debug] [Thread-2  ]: Began running node test.bain_capital_analytics.not_null_stg_instruments_instrument_id.18bdfd2ebe
[0m19:31:17.494750 [info ] [Thread-1  ]: 12 of 40 START test not_null_stg_counterparties_counterparty_id ................ [RUN]
[0m19:31:17.495085 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_date.d5c8f88f3e: BEGIN
[0m19:31:17.495403 [debug] [Thread-4  ]: Began compiling node test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_id.ec87e4ee58
[0m19:31:17.495716 [info ] [Thread-2  ]: 13 of 40 START test not_null_stg_instruments_instrument_id ..................... [RUN]
[0m19:31:17.496078 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.bain_capital_analytics.stg_positions, now test.bain_capital_analytics.not_null_stg_counterparties_counterparty_id.4754302940)
[0m19:31:17.496384 [debug] [Thread-3  ]: Opening a new connection, currently in state closed
[0m19:31:17.500023 [debug] [Thread-4  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_id.ec87e4ee58"
[0m19:31:17.500376 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.unique_stg_dates_date_day.e062be8e28, now test.bain_capital_analytics.not_null_stg_instruments_instrument_id.18bdfd2ebe)
[0m19:31:17.500696 [debug] [Thread-1  ]: Began compiling node test.bain_capital_analytics.not_null_stg_counterparties_counterparty_id.4754302940
[0m19:31:17.501187 [debug] [Thread-2  ]: Began compiling node test.bain_capital_analytics.not_null_stg_instruments_instrument_id.18bdfd2ebe
[0m19:31:17.505547 [debug] [Thread-1  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_stg_counterparties_counterparty_id.4754302940"
[0m19:31:17.508769 [debug] [Thread-2  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_stg_instruments_instrument_id.18bdfd2ebe"
[0m19:31:17.509136 [debug] [Thread-4  ]: Began executing node test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_id.ec87e4ee58
[0m19:31:17.511424 [debug] [Thread-4  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_id.ec87e4ee58"
[0m19:31:17.511768 [debug] [Thread-3  ]: SQL status: BEGIN in 0.015 seconds
[0m19:31:17.512216 [debug] [Thread-3  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_date.d5c8f88f3e"
[0m19:31:17.512546 [debug] [Thread-2  ]: Began executing node test.bain_capital_analytics.not_null_stg_instruments_instrument_id.18bdfd2ebe
[0m19:31:17.512863 [debug] [Thread-1  ]: Began executing node test.bain_capital_analytics.not_null_stg_counterparties_counterparty_id.4754302940
[0m19:31:17.513199 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_date.d5c8f88f3e: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_date.d5c8f88f3e"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select benchmark_date
from "bain_analytics"."public"."stg_benchmarks"
where benchmark_date is null



  
  
      
    ) dbt_internal_test
[0m19:31:17.515338 [debug] [Thread-2  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_stg_instruments_instrument_id.18bdfd2ebe"
[0m19:31:17.515713 [debug] [Thread-4  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_id.ec87e4ee58"
[0m19:31:17.517904 [debug] [Thread-1  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_stg_counterparties_counterparty_id.4754302940"
[0m19:31:17.518369 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_id.ec87e4ee58: BEGIN
[0m19:31:17.518749 [debug] [Thread-4  ]: Opening a new connection, currently in state closed
[0m19:31:17.519086 [debug] [Thread-2  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_instruments_instrument_id.18bdfd2ebe"
[0m19:31:17.519506 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_stg_instruments_instrument_id.18bdfd2ebe: BEGIN
[0m19:31:17.519840 [debug] [Thread-1  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_counterparties_counterparty_id.4754302940"
[0m19:31:17.520125 [debug] [Thread-2  ]: Opening a new connection, currently in state closed
[0m19:31:17.520464 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_stg_counterparties_counterparty_id.4754302940: BEGIN
[0m19:31:17.520812 [debug] [Thread-3  ]: SQL status: SELECT 1 in 0.003 seconds
[0m19:31:17.521180 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m19:31:17.522452 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_date.d5c8f88f3e: ROLLBACK
[0m19:31:17.523272 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_date.d5c8f88f3e: Close
[0m19:31:17.523760 [info ] [Thread-3  ]: 10 of 40 PASS not_null_stg_benchmarks_benchmark_date ........................... [[32mPASS[0m in 0.05s]
[0m19:31:17.524213 [debug] [Thread-3  ]: Finished running node test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_date.d5c8f88f3e
[0m19:31:17.524539 [debug] [Thread-3  ]: Began running node test.bain_capital_analytics.unique_stg_counterparties_counterparty_id.d712ebd057
[0m19:31:17.524901 [info ] [Thread-3  ]: 14 of 40 START test unique_stg_counterparties_counterparty_id .................. [RUN]
[0m19:31:17.525245 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_date.d5c8f88f3e, now test.bain_capital_analytics.unique_stg_counterparties_counterparty_id.d712ebd057)
[0m19:31:17.525545 [debug] [Thread-3  ]: Began compiling node test.bain_capital_analytics.unique_stg_counterparties_counterparty_id.d712ebd057
[0m19:31:17.529231 [debug] [Thread-3  ]: Writing injected SQL for node "test.bain_capital_analytics.unique_stg_counterparties_counterparty_id.d712ebd057"
[0m19:31:17.529783 [debug] [Thread-3  ]: Began executing node test.bain_capital_analytics.unique_stg_counterparties_counterparty_id.d712ebd057
[0m19:31:17.533008 [debug] [Thread-3  ]: Writing runtime sql for node "test.bain_capital_analytics.unique_stg_counterparties_counterparty_id.d712ebd057"
[0m19:31:17.533430 [debug] [Thread-4  ]: SQL status: BEGIN in 0.015 seconds
[0m19:31:17.533765 [debug] [Thread-4  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_id.ec87e4ee58"
[0m19:31:17.534088 [debug] [Thread-2  ]: SQL status: BEGIN in 0.014 seconds
[0m19:31:17.534423 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_id.ec87e4ee58: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_id.ec87e4ee58"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select benchmark_id
from "bain_analytics"."public"."stg_benchmarks"
where benchmark_id is null



  
  
      
    ) dbt_internal_test
[0m19:31:17.534757 [debug] [Thread-1  ]: SQL status: BEGIN in 0.014 seconds
[0m19:31:17.535074 [debug] [Thread-2  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_instruments_instrument_id.18bdfd2ebe"
[0m19:31:17.535423 [debug] [Thread-3  ]: Using postgres connection "test.bain_capital_analytics.unique_stg_counterparties_counterparty_id.d712ebd057"
[0m19:31:17.535759 [debug] [Thread-1  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_counterparties_counterparty_id.4754302940"
[0m19:31:17.536089 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_stg_instruments_instrument_id.18bdfd2ebe: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_stg_instruments_instrument_id.18bdfd2ebe"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select instrument_id
from "bain_analytics"."public"."stg_instruments"
where instrument_id is null



  
  
      
    ) dbt_internal_test
[0m19:31:17.536404 [debug] [Thread-3  ]: On test.bain_capital_analytics.unique_stg_counterparties_counterparty_id.d712ebd057: BEGIN
[0m19:31:17.536727 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_stg_counterparties_counterparty_id.4754302940: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_stg_counterparties_counterparty_id.4754302940"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select counterparty_id
from "bain_analytics"."public"."stg_counterparties"
where counterparty_id is null



  
  
      
    ) dbt_internal_test
[0m19:31:17.537090 [debug] [Thread-3  ]: Opening a new connection, currently in state closed
[0m19:31:17.537642 [debug] [Thread-4  ]: SQL status: SELECT 1 in 0.002 seconds
[0m19:31:17.538806 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_id.ec87e4ee58: ROLLBACK
[0m19:31:17.539150 [debug] [Thread-2  ]: SQL status: SELECT 1 in 0.002 seconds
[0m19:31:17.539469 [debug] [Thread-1  ]: SQL status: SELECT 1 in 0.002 seconds
[0m19:31:17.540563 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_stg_instruments_instrument_id.18bdfd2ebe: ROLLBACK
[0m19:31:17.540874 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_id.ec87e4ee58: Close
[0m19:31:17.541877 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_stg_counterparties_counterparty_id.4754302940: ROLLBACK
[0m19:31:17.542406 [info ] [Thread-4  ]: 11 of 40 PASS not_null_stg_benchmarks_benchmark_id ............................. [[32mPASS[0m in 0.05s]
[0m19:31:17.542879 [debug] [Thread-4  ]: Finished running node test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_id.ec87e4ee58
[0m19:31:17.543164 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_stg_instruments_instrument_id.18bdfd2ebe: Close
[0m19:31:17.543444 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_stg_counterparties_counterparty_id.4754302940: Close
[0m19:31:17.543781 [debug] [Thread-4  ]: Began running node test.bain_capital_analytics.unique_stg_instruments_instrument_id.0e70adcd34
[0m19:31:17.544304 [info ] [Thread-2  ]: 13 of 40 PASS not_null_stg_instruments_instrument_id ........................... [[32mPASS[0m in 0.04s]
[0m19:31:17.544769 [info ] [Thread-1  ]: 12 of 40 PASS not_null_stg_counterparties_counterparty_id ...................... [[32mPASS[0m in 0.05s]
[0m19:31:17.545114 [info ] [Thread-4  ]: 15 of 40 START test unique_stg_instruments_instrument_id ....................... [RUN]
[0m19:31:17.545611 [debug] [Thread-2  ]: Finished running node test.bain_capital_analytics.not_null_stg_instruments_instrument_id.18bdfd2ebe
[0m19:31:17.546034 [debug] [Thread-1  ]: Finished running node test.bain_capital_analytics.not_null_stg_counterparties_counterparty_id.4754302940
[0m19:31:17.546338 [debug] [Thread-3  ]: SQL status: BEGIN in 0.009 seconds
[0m19:31:17.546669 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_id.ec87e4ee58, now test.bain_capital_analytics.unique_stg_instruments_instrument_id.0e70adcd34)
[0m19:31:17.547008 [debug] [Thread-2  ]: Began running node test.bain_capital_analytics.not_null_stg_portfolios_fund_id.70b04d82bd
[0m19:31:17.547390 [debug] [Thread-1  ]: Began running node test.bain_capital_analytics.not_null_stg_portfolios_portfolio_id.7126a480ec
[0m19:31:17.547745 [debug] [Thread-3  ]: Using postgres connection "test.bain_capital_analytics.unique_stg_counterparties_counterparty_id.d712ebd057"
[0m19:31:17.548051 [debug] [Thread-4  ]: Began compiling node test.bain_capital_analytics.unique_stg_instruments_instrument_id.0e70adcd34
[0m19:31:17.548368 [info ] [Thread-2  ]: 16 of 40 START test not_null_stg_portfolios_fund_id ............................ [RUN]
[0m19:31:17.548698 [info ] [Thread-1  ]: 17 of 40 START test not_null_stg_portfolios_portfolio_id ....................... [RUN]
[0m19:31:17.549091 [debug] [Thread-3  ]: On test.bain_capital_analytics.unique_stg_counterparties_counterparty_id.d712ebd057: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.unique_stg_counterparties_counterparty_id.d712ebd057"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

select
    counterparty_id as unique_field,
    count(*) as n_records

from "bain_analytics"."public"."stg_counterparties"
where counterparty_id is not null
group by counterparty_id
having count(*) > 1



  
  
      
    ) dbt_internal_test
[0m19:31:17.552962 [debug] [Thread-4  ]: Writing injected SQL for node "test.bain_capital_analytics.unique_stg_instruments_instrument_id.0e70adcd34"
[0m19:31:17.553326 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.not_null_stg_instruments_instrument_id.18bdfd2ebe, now test.bain_capital_analytics.not_null_stg_portfolios_fund_id.70b04d82bd)
[0m19:31:17.553650 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.not_null_stg_counterparties_counterparty_id.4754302940, now test.bain_capital_analytics.not_null_stg_portfolios_portfolio_id.7126a480ec)
[0m19:31:17.554063 [debug] [Thread-2  ]: Began compiling node test.bain_capital_analytics.not_null_stg_portfolios_fund_id.70b04d82bd
[0m19:31:17.554356 [debug] [Thread-1  ]: Began compiling node test.bain_capital_analytics.not_null_stg_portfolios_portfolio_id.7126a480ec
[0m19:31:17.557755 [debug] [Thread-2  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_stg_portfolios_fund_id.70b04d82bd"
[0m19:31:17.558093 [debug] [Thread-3  ]: SQL status: SELECT 1 in 0.004 seconds
[0m19:31:17.561399 [debug] [Thread-1  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_stg_portfolios_portfolio_id.7126a480ec"
[0m19:31:17.561734 [debug] [Thread-4  ]: Began executing node test.bain_capital_analytics.unique_stg_instruments_instrument_id.0e70adcd34
[0m19:31:17.562933 [debug] [Thread-3  ]: On test.bain_capital_analytics.unique_stg_counterparties_counterparty_id.d712ebd057: ROLLBACK
[0m19:31:17.565270 [debug] [Thread-4  ]: Writing runtime sql for node "test.bain_capital_analytics.unique_stg_instruments_instrument_id.0e70adcd34"
[0m19:31:17.565736 [debug] [Thread-2  ]: Began executing node test.bain_capital_analytics.not_null_stg_portfolios_fund_id.70b04d82bd
[0m19:31:17.566044 [debug] [Thread-3  ]: On test.bain_capital_analytics.unique_stg_counterparties_counterparty_id.d712ebd057: Close
[0m19:31:17.566328 [debug] [Thread-1  ]: Began executing node test.bain_capital_analytics.not_null_stg_portfolios_portfolio_id.7126a480ec
[0m19:31:17.568561 [debug] [Thread-2  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_stg_portfolios_fund_id.70b04d82bd"
[0m19:31:17.569127 [info ] [Thread-3  ]: 14 of 40 PASS unique_stg_counterparties_counterparty_id ........................ [[32mPASS[0m in 0.04s]
[0m19:31:17.572190 [debug] [Thread-1  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_stg_portfolios_portfolio_id.7126a480ec"
[0m19:31:17.572535 [debug] [Thread-4  ]: Using postgres connection "test.bain_capital_analytics.unique_stg_instruments_instrument_id.0e70adcd34"
[0m19:31:17.573058 [debug] [Thread-3  ]: Finished running node test.bain_capital_analytics.unique_stg_counterparties_counterparty_id.d712ebd057
[0m19:31:17.573475 [debug] [Thread-4  ]: On test.bain_capital_analytics.unique_stg_instruments_instrument_id.0e70adcd34: BEGIN
[0m19:31:17.573813 [debug] [Thread-2  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_portfolios_fund_id.70b04d82bd"
[0m19:31:17.574130 [debug] [Thread-3  ]: Began running node test.bain_capital_analytics.unique_stg_portfolios_portfolio_id.aa125b6658
[0m19:31:17.574532 [debug] [Thread-4  ]: Opening a new connection, currently in state closed
[0m19:31:17.574862 [debug] [Thread-1  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_portfolios_portfolio_id.7126a480ec"
[0m19:31:17.575227 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_stg_portfolios_fund_id.70b04d82bd: BEGIN
[0m19:31:17.575546 [info ] [Thread-3  ]: 18 of 40 START test unique_stg_portfolios_portfolio_id ......................... [RUN]
[0m19:31:17.575970 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_stg_portfolios_portfolio_id.7126a480ec: BEGIN
[0m19:31:17.576260 [debug] [Thread-2  ]: Opening a new connection, currently in state closed
[0m19:31:17.576605 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.unique_stg_counterparties_counterparty_id.d712ebd057, now test.bain_capital_analytics.unique_stg_portfolios_portfolio_id.aa125b6658)
[0m19:31:17.576922 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m19:31:17.577328 [debug] [Thread-3  ]: Began compiling node test.bain_capital_analytics.unique_stg_portfolios_portfolio_id.aa125b6658
[0m19:31:17.581024 [debug] [Thread-3  ]: Writing injected SQL for node "test.bain_capital_analytics.unique_stg_portfolios_portfolio_id.aa125b6658"
[0m19:31:17.581523 [debug] [Thread-3  ]: Began executing node test.bain_capital_analytics.unique_stg_portfolios_portfolio_id.aa125b6658
[0m19:31:17.583892 [debug] [Thread-3  ]: Writing runtime sql for node "test.bain_capital_analytics.unique_stg_portfolios_portfolio_id.aa125b6658"
[0m19:31:17.584372 [debug] [Thread-3  ]: Using postgres connection "test.bain_capital_analytics.unique_stg_portfolios_portfolio_id.aa125b6658"
[0m19:31:17.584666 [debug] [Thread-3  ]: On test.bain_capital_analytics.unique_stg_portfolios_portfolio_id.aa125b6658: BEGIN
[0m19:31:17.584944 [debug] [Thread-3  ]: Opening a new connection, currently in state closed
[0m19:31:17.585926 [debug] [Thread-4  ]: SQL status: BEGIN in 0.011 seconds
[0m19:31:17.586229 [debug] [Thread-4  ]: Using postgres connection "test.bain_capital_analytics.unique_stg_instruments_instrument_id.0e70adcd34"
[0m19:31:17.586597 [debug] [Thread-4  ]: On test.bain_capital_analytics.unique_stg_instruments_instrument_id.0e70adcd34: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.unique_stg_instruments_instrument_id.0e70adcd34"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

select
    instrument_id as unique_field,
    count(*) as n_records

from "bain_analytics"."public"."stg_instruments"
where instrument_id is not null
group by instrument_id
having count(*) > 1



  
  
      
    ) dbt_internal_test
[0m19:31:17.587261 [debug] [Thread-2  ]: SQL status: BEGIN in 0.011 seconds
[0m19:31:17.587565 [debug] [Thread-1  ]: SQL status: BEGIN in 0.011 seconds
[0m19:31:17.587835 [debug] [Thread-2  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_portfolios_fund_id.70b04d82bd"
[0m19:31:17.588141 [debug] [Thread-1  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_portfolios_portfolio_id.7126a480ec"
[0m19:31:17.588462 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_stg_portfolios_fund_id.70b04d82bd: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_stg_portfolios_fund_id.70b04d82bd"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select fund_id
from "bain_analytics"."public"."stg_portfolios"
where fund_id is null



  
  
      
    ) dbt_internal_test
[0m19:31:17.588796 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_stg_portfolios_portfolio_id.7126a480ec: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_stg_portfolios_portfolio_id.7126a480ec"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select portfolio_id
from "bain_analytics"."public"."stg_portfolios"
where portfolio_id is null



  
  
      
    ) dbt_internal_test
[0m19:31:17.589577 [debug] [Thread-4  ]: SQL status: SELECT 1 in 0.003 seconds
[0m19:31:17.590803 [debug] [Thread-4  ]: On test.bain_capital_analytics.unique_stg_instruments_instrument_id.0e70adcd34: ROLLBACK
[0m19:31:17.591131 [debug] [Thread-1  ]: SQL status: SELECT 1 in 0.002 seconds
[0m19:31:17.591438 [debug] [Thread-2  ]: SQL status: SELECT 1 in 0.002 seconds
[0m19:31:17.592495 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_stg_portfolios_portfolio_id.7126a480ec: ROLLBACK
[0m19:31:17.592805 [debug] [Thread-4  ]: On test.bain_capital_analytics.unique_stg_instruments_instrument_id.0e70adcd34: Close
[0m19:31:17.593806 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_stg_portfolios_fund_id.70b04d82bd: ROLLBACK
[0m19:31:17.594348 [info ] [Thread-4  ]: 15 of 40 PASS unique_stg_instruments_instrument_id ............................. [[32mPASS[0m in 0.05s]
[0m19:31:17.594663 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_stg_portfolios_portfolio_id.7126a480ec: Close
[0m19:31:17.594971 [debug] [Thread-3  ]: SQL status: BEGIN in 0.010 seconds
[0m19:31:17.595265 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_stg_portfolios_fund_id.70b04d82bd: Close
[0m19:31:17.595691 [debug] [Thread-4  ]: Finished running node test.bain_capital_analytics.unique_stg_instruments_instrument_id.0e70adcd34
[0m19:31:17.596156 [info ] [Thread-1  ]: 17 of 40 PASS not_null_stg_portfolios_portfolio_id ............................. [[32mPASS[0m in 0.04s]
[0m19:31:17.596477 [debug] [Thread-3  ]: Using postgres connection "test.bain_capital_analytics.unique_stg_portfolios_portfolio_id.aa125b6658"
[0m19:31:17.596943 [info ] [Thread-2  ]: 16 of 40 PASS not_null_stg_portfolios_fund_id .................................. [[32mPASS[0m in 0.04s]
[0m19:31:17.597294 [debug] [Thread-4  ]: Began running node test.bain_capital_analytics.not_null_stg_trades_instrument_id.15cdc65a72
[0m19:31:17.597767 [debug] [Thread-1  ]: Finished running node test.bain_capital_analytics.not_null_stg_portfolios_portfolio_id.7126a480ec
[0m19:31:17.598085 [debug] [Thread-3  ]: On test.bain_capital_analytics.unique_stg_portfolios_portfolio_id.aa125b6658: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.unique_stg_portfolios_portfolio_id.aa125b6658"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

select
    portfolio_id as unique_field,
    count(*) as n_records

from "bain_analytics"."public"."stg_portfolios"
where portfolio_id is not null
group by portfolio_id
having count(*) > 1



  
  
      
    ) dbt_internal_test
[0m19:31:17.598509 [debug] [Thread-2  ]: Finished running node test.bain_capital_analytics.not_null_stg_portfolios_fund_id.70b04d82bd
[0m19:31:17.598831 [info ] [Thread-4  ]: 19 of 40 START test not_null_stg_trades_instrument_id .......................... [RUN]
[0m19:31:17.599203 [debug] [Thread-1  ]: Began running node test.bain_capital_analytics.not_null_stg_trades_portfolio_id.2becbd2a0b
[0m19:31:17.599635 [debug] [Thread-2  ]: Began running node test.bain_capital_analytics.not_null_stg_trades_trade_id.f81937320b
[0m19:31:17.599985 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.unique_stg_instruments_instrument_id.0e70adcd34, now test.bain_capital_analytics.not_null_stg_trades_instrument_id.15cdc65a72)
[0m19:31:17.600338 [info ] [Thread-1  ]: 20 of 40 START test not_null_stg_trades_portfolio_id ........................... [RUN]
[0m19:31:17.600665 [info ] [Thread-2  ]: 21 of 40 START test not_null_stg_trades_trade_id ............................... [RUN]
[0m19:31:17.600977 [debug] [Thread-4  ]: Began compiling node test.bain_capital_analytics.not_null_stg_trades_instrument_id.15cdc65a72
[0m19:31:17.601295 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.not_null_stg_portfolios_portfolio_id.7126a480ec, now test.bain_capital_analytics.not_null_stg_trades_portfolio_id.2becbd2a0b)
[0m19:31:17.601620 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.not_null_stg_portfolios_fund_id.70b04d82bd, now test.bain_capital_analytics.not_null_stg_trades_trade_id.f81937320b)
[0m19:31:17.605332 [debug] [Thread-4  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_stg_trades_instrument_id.15cdc65a72"
[0m19:31:17.605660 [debug] [Thread-3  ]: SQL status: SELECT 1 in 0.006 seconds
[0m19:31:17.605947 [debug] [Thread-1  ]: Began compiling node test.bain_capital_analytics.not_null_stg_trades_portfolio_id.2becbd2a0b
[0m19:31:17.606256 [debug] [Thread-2  ]: Began compiling node test.bain_capital_analytics.not_null_stg_trades_trade_id.f81937320b
[0m19:31:17.607379 [debug] [Thread-3  ]: On test.bain_capital_analytics.unique_stg_portfolios_portfolio_id.aa125b6658: ROLLBACK
[0m19:31:17.610904 [debug] [Thread-1  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_stg_trades_portfolio_id.2becbd2a0b"
[0m19:31:17.615219 [debug] [Thread-2  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_stg_trades_trade_id.f81937320b"
[0m19:31:17.615626 [debug] [Thread-4  ]: Began executing node test.bain_capital_analytics.not_null_stg_trades_instrument_id.15cdc65a72
[0m19:31:17.616002 [debug] [Thread-3  ]: On test.bain_capital_analytics.unique_stg_portfolios_portfolio_id.aa125b6658: Close
[0m19:31:17.618339 [debug] [Thread-4  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_stg_trades_instrument_id.15cdc65a72"
[0m19:31:17.618923 [info ] [Thread-3  ]: 18 of 40 PASS unique_stg_portfolios_portfolio_id ............................... [[32mPASS[0m in 0.04s]
[0m19:31:17.619257 [debug] [Thread-2  ]: Began executing node test.bain_capital_analytics.not_null_stg_trades_trade_id.f81937320b
[0m19:31:17.619553 [debug] [Thread-1  ]: Began executing node test.bain_capital_analytics.not_null_stg_trades_portfolio_id.2becbd2a0b
[0m19:31:17.620063 [debug] [Thread-3  ]: Finished running node test.bain_capital_analytics.unique_stg_portfolios_portfolio_id.aa125b6658
[0m19:31:17.622250 [debug] [Thread-2  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_stg_trades_trade_id.f81937320b"
[0m19:31:17.624411 [debug] [Thread-1  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_stg_trades_portfolio_id.2becbd2a0b"
[0m19:31:17.624776 [debug] [Thread-4  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_trades_instrument_id.15cdc65a72"
[0m19:31:17.625100 [debug] [Thread-3  ]: Began running node test.bain_capital_analytics.unique_stg_trades_trade_id.f973ed6ffd
[0m19:31:17.625600 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_stg_trades_instrument_id.15cdc65a72: BEGIN
[0m19:31:17.626284 [debug] [Thread-2  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_trades_trade_id.f81937320b"
[0m19:31:17.625985 [info ] [Thread-3  ]: 22 of 40 START test unique_stg_trades_trade_id ................................. [RUN]
[0m19:31:17.626675 [debug] [Thread-4  ]: Opening a new connection, currently in state closed
[0m19:31:17.626997 [debug] [Thread-1  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_trades_portfolio_id.2becbd2a0b"
[0m19:31:17.627296 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_stg_trades_trade_id.f81937320b: BEGIN
[0m19:31:17.627641 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.unique_stg_portfolios_portfolio_id.aa125b6658, now test.bain_capital_analytics.unique_stg_trades_trade_id.f973ed6ffd)
[0m19:31:17.628059 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_stg_trades_portfolio_id.2becbd2a0b: BEGIN
[0m19:31:17.628359 [debug] [Thread-2  ]: Opening a new connection, currently in state closed
[0m19:31:17.628667 [debug] [Thread-3  ]: Began compiling node test.bain_capital_analytics.unique_stg_trades_trade_id.f973ed6ffd
[0m19:31:17.628965 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m19:31:17.632558 [debug] [Thread-3  ]: Writing injected SQL for node "test.bain_capital_analytics.unique_stg_trades_trade_id.f973ed6ffd"
[0m19:31:17.633237 [debug] [Thread-3  ]: Began executing node test.bain_capital_analytics.unique_stg_trades_trade_id.f973ed6ffd
[0m19:31:17.635655 [debug] [Thread-3  ]: Writing runtime sql for node "test.bain_capital_analytics.unique_stg_trades_trade_id.f973ed6ffd"
[0m19:31:17.636166 [debug] [Thread-3  ]: Using postgres connection "test.bain_capital_analytics.unique_stg_trades_trade_id.f973ed6ffd"
[0m19:31:17.636457 [debug] [Thread-3  ]: On test.bain_capital_analytics.unique_stg_trades_trade_id.f973ed6ffd: BEGIN
[0m19:31:17.636736 [debug] [Thread-3  ]: Opening a new connection, currently in state closed
[0m19:31:17.637963 [debug] [Thread-2  ]: SQL status: BEGIN in 0.010 seconds
[0m19:31:17.638286 [debug] [Thread-4  ]: SQL status: BEGIN in 0.012 seconds
[0m19:31:17.638584 [debug] [Thread-2  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_trades_trade_id.f81937320b"
[0m19:31:17.638893 [debug] [Thread-4  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_trades_instrument_id.15cdc65a72"
[0m19:31:17.639209 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_stg_trades_trade_id.f81937320b: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_stg_trades_trade_id.f81937320b"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select trade_id
from "bain_analytics"."public"."stg_trades"
where trade_id is null



  
  
      
    ) dbt_internal_test
[0m19:31:17.639544 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_stg_trades_instrument_id.15cdc65a72: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_stg_trades_instrument_id.15cdc65a72"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select instrument_id
from "bain_analytics"."public"."stg_trades"
where instrument_id is null



  
  
      
    ) dbt_internal_test
[0m19:31:17.641096 [debug] [Thread-1  ]: SQL status: BEGIN in 0.012 seconds
[0m19:31:17.641393 [debug] [Thread-1  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_trades_portfolio_id.2becbd2a0b"
[0m19:31:17.641697 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_stg_trades_portfolio_id.2becbd2a0b: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_stg_trades_portfolio_id.2becbd2a0b"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select portfolio_id
from "bain_analytics"."public"."stg_trades"
where portfolio_id is null



  
  
      
    ) dbt_internal_test
[0m19:31:17.642543 [debug] [Thread-4  ]: SQL status: SELECT 1 in 0.003 seconds
[0m19:31:17.642836 [debug] [Thread-2  ]: SQL status: SELECT 1 in 0.003 seconds
[0m19:31:17.644051 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_stg_trades_instrument_id.15cdc65a72: ROLLBACK
[0m19:31:17.645093 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_stg_trades_trade_id.f81937320b: ROLLBACK
[0m19:31:17.645398 [debug] [Thread-1  ]: SQL status: SELECT 1 in 0.003 seconds
[0m19:31:17.646565 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_stg_trades_portfolio_id.2becbd2a0b: ROLLBACK
[0m19:31:17.646880 [debug] [Thread-3  ]: SQL status: BEGIN in 0.010 seconds
[0m19:31:17.647178 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_stg_trades_instrument_id.15cdc65a72: Close
[0m19:31:17.647472 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_stg_trades_trade_id.f81937320b: Close
[0m19:31:17.647759 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_stg_trades_portfolio_id.2becbd2a0b: Close
[0m19:31:17.648042 [debug] [Thread-3  ]: Using postgres connection "test.bain_capital_analytics.unique_stg_trades_trade_id.f973ed6ffd"
[0m19:31:17.648520 [info ] [Thread-4  ]: 19 of 40 PASS not_null_stg_trades_instrument_id ................................ [[32mPASS[0m in 0.05s]
[0m19:31:17.648989 [info ] [Thread-2  ]: 21 of 40 PASS not_null_stg_trades_trade_id ..................................... [[32mPASS[0m in 0.05s]
[0m19:31:17.649381 [debug] [Thread-3  ]: On test.bain_capital_analytics.unique_stg_trades_trade_id.f973ed6ffd: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.unique_stg_trades_trade_id.f973ed6ffd"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

select
    trade_id as unique_field,
    count(*) as n_records

from "bain_analytics"."public"."stg_trades"
where trade_id is not null
group by trade_id
having count(*) > 1



  
  
      
    ) dbt_internal_test
[0m19:31:17.649832 [info ] [Thread-1  ]: 20 of 40 PASS not_null_stg_trades_portfolio_id ................................. [[32mPASS[0m in 0.05s]
[0m19:31:17.650295 [debug] [Thread-4  ]: Finished running node test.bain_capital_analytics.not_null_stg_trades_instrument_id.15cdc65a72
[0m19:31:17.650703 [debug] [Thread-2  ]: Finished running node test.bain_capital_analytics.not_null_stg_trades_trade_id.f81937320b
[0m19:31:17.651155 [debug] [Thread-1  ]: Finished running node test.bain_capital_analytics.not_null_stg_trades_portfolio_id.2becbd2a0b
[0m19:31:17.651495 [debug] [Thread-4  ]: Began running node test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c
[0m19:31:17.651877 [debug] [Thread-2  ]: Began running node test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1
[0m19:31:17.652241 [debug] [Thread-1  ]: Began running node test.bain_capital_analytics.relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_.2823f12709
[0m19:31:17.652591 [info ] [Thread-4  ]: 23 of 40 START test not_null_stg_positions_portfolio_id ........................ [RUN]
[0m19:31:17.652928 [info ] [Thread-2  ]: 24 of 40 START test not_null_stg_positions_position_id ......................... [RUN]
[0m19:31:17.653258 [info ] [Thread-1  ]: 25 of 40 START test relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_  [RUN]
[0m19:31:17.653619 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.not_null_stg_trades_instrument_id.15cdc65a72, now test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c)
[0m19:31:17.653948 [debug] [Thread-3  ]: SQL status: SELECT 1 in 0.003 seconds
[0m19:31:17.654249 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.not_null_stg_trades_trade_id.f81937320b, now test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1)
[0m19:31:17.654574 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.not_null_stg_trades_portfolio_id.2becbd2a0b, now test.bain_capital_analytics.relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_.2823f12709)
[0m19:31:17.654888 [debug] [Thread-4  ]: Began compiling node test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c
[0m19:31:17.655963 [debug] [Thread-3  ]: On test.bain_capital_analytics.unique_stg_trades_trade_id.f973ed6ffd: ROLLBACK
[0m19:31:17.656272 [debug] [Thread-2  ]: Began compiling node test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1
[0m19:31:17.656570 [debug] [Thread-1  ]: Began compiling node test.bain_capital_analytics.relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_.2823f12709
[0m19:31:17.661429 [debug] [Thread-4  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c"
[0m19:31:17.664814 [debug] [Thread-2  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1"
[0m19:31:17.665132 [debug] [Thread-3  ]: On test.bain_capital_analytics.unique_stg_trades_trade_id.f973ed6ffd: Close
[0m19:31:17.671997 [debug] [Thread-1  ]: Writing injected SQL for node "test.bain_capital_analytics.relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_.2823f12709"
[0m19:31:17.672701 [info ] [Thread-3  ]: 22 of 40 PASS unique_stg_trades_trade_id ....................................... [[32mPASS[0m in 0.05s]
[0m19:31:17.673174 [debug] [Thread-3  ]: Finished running node test.bain_capital_analytics.unique_stg_trades_trade_id.f973ed6ffd
[0m19:31:17.673526 [debug] [Thread-3  ]: Began running node test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f
[0m19:31:17.673906 [debug] [Thread-4  ]: Began executing node test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c
[0m19:31:17.674237 [info ] [Thread-3  ]: 26 of 40 START test unique_stg_positions_position_id ........................... [RUN]
[0m19:31:17.674711 [debug] [Thread-1  ]: Began executing node test.bain_capital_analytics.relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_.2823f12709
[0m19:31:17.677077 [debug] [Thread-4  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c"
[0m19:31:17.677373 [debug] [Thread-2  ]: Began executing node test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1
[0m19:31:17.677713 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.unique_stg_trades_trade_id.f973ed6ffd, now test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f)
[0m19:31:17.679851 [debug] [Thread-1  ]: Writing runtime sql for node "test.bain_capital_analytics.relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_.2823f12709"
[0m19:31:17.683108 [debug] [Thread-2  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1"
[0m19:31:17.683424 [debug] [Thread-3  ]: Began compiling node test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f
[0m19:31:17.683952 [debug] [Thread-4  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c"
[0m19:31:17.687238 [debug] [Thread-3  ]: Writing injected SQL for node "test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f"
[0m19:31:17.687611 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c: BEGIN
[0m19:31:17.687967 [debug] [Thread-2  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1"
[0m19:31:17.688291 [debug] [Thread-1  ]: Using postgres connection "test.bain_capital_analytics.relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_.2823f12709"
[0m19:31:17.688627 [debug] [Thread-4  ]: Opening a new connection, currently in state closed
[0m19:31:17.688950 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1: BEGIN
[0m19:31:17.689282 [debug] [Thread-1  ]: On test.bain_capital_analytics.relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_.2823f12709: BEGIN
[0m19:31:17.689694 [debug] [Thread-3  ]: Began executing node test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f
[0m19:31:17.689984 [debug] [Thread-2  ]: Opening a new connection, currently in state closed
[0m19:31:17.690284 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m19:31:17.692422 [debug] [Thread-3  ]: Writing runtime sql for node "test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f"
[0m19:31:17.693094 [debug] [Thread-3  ]: Using postgres connection "test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f"
[0m19:31:17.693401 [debug] [Thread-3  ]: On test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f: BEGIN
[0m19:31:17.693678 [debug] [Thread-3  ]: Opening a new connection, currently in state closed
[0m19:31:17.698594 [debug] [Thread-4  ]: SQL status: BEGIN in 0.010 seconds
[0m19:31:17.699163 [debug] [Thread-4  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c"
[0m19:31:17.699709 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select portfolio_id
from "bain_analytics"."public"."stg_positions"
where portfolio_id is null



  
  
      
    ) dbt_internal_test
[0m19:31:17.702407 [debug] [Thread-4  ]: SQL status: SELECT 1 in 0.002 seconds
[0m19:31:17.703737 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c: ROLLBACK
[0m19:31:17.704454 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c: Close
[0m19:31:17.704794 [debug] [Thread-1  ]: SQL status: BEGIN in 0.014 seconds
[0m19:31:17.705132 [debug] [Thread-3  ]: SQL status: BEGIN in 0.011 seconds
[0m19:31:17.705432 [debug] [Thread-2  ]: SQL status: BEGIN in 0.015 seconds
[0m19:31:17.705893 [info ] [Thread-4  ]: 23 of 40 PASS not_null_stg_positions_portfolio_id .............................. [[32mPASS[0m in 0.05s]
[0m19:31:17.706229 [debug] [Thread-1  ]: Using postgres connection "test.bain_capital_analytics.relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_.2823f12709"
[0m19:31:17.706542 [debug] [Thread-3  ]: Using postgres connection "test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f"
[0m19:31:17.706838 [debug] [Thread-2  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1"
[0m19:31:17.707273 [debug] [Thread-4  ]: Finished running node test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c
[0m19:31:17.707605 [debug] [Thread-1  ]: On test.bain_capital_analytics.relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_.2823f12709: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_.2823f12709"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

with child as (
    select portfolio_id as from_field
    from "bain_analytics"."public"."stg_positions"
    where portfolio_id is not null
),

parent as (
    select portfolio_id as to_field
    from "bain_analytics"."public"."stg_portfolios"
)

select
    from_field

from child
left join parent
    on child.from_field = parent.to_field

where parent.to_field is null



  
  
      
    ) dbt_internal_test
[0m19:31:17.707944 [debug] [Thread-3  ]: On test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

select
    position_id as unique_field,
    count(*) as n_records

from "bain_analytics"."public"."stg_positions"
where position_id is not null
group by position_id
having count(*) > 1



  
  
      
    ) dbt_internal_test
[0m19:31:17.708274 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select position_id
from "bain_analytics"."public"."stg_positions"
where position_id is null



  
  
      
    ) dbt_internal_test
[0m19:31:17.708631 [debug] [Thread-4  ]: Began running node model.bain_capital_analytics.fact_trade_activity
[0m19:31:17.709323 [info ] [Thread-4  ]: 27 of 40 START sql view model public.fact_trade_activity ....................... [RUN]
[0m19:31:17.709705 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c, now model.bain_capital_analytics.fact_trade_activity)
[0m19:31:17.710012 [debug] [Thread-4  ]: Began compiling node model.bain_capital_analytics.fact_trade_activity
[0m19:31:17.713967 [debug] [Thread-4  ]: Writing injected SQL for node "model.bain_capital_analytics.fact_trade_activity"
[0m19:31:17.714354 [debug] [Thread-2  ]: SQL status: SELECT 1 in 0.005 seconds
[0m19:31:17.714679 [debug] [Thread-3  ]: SQL status: SELECT 1 in 0.006 seconds
[0m19:31:17.715884 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1: ROLLBACK
[0m19:31:17.716192 [debug] [Thread-1  ]: SQL status: SELECT 1 in 0.007 seconds
[0m19:31:17.717472 [debug] [Thread-3  ]: On test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f: ROLLBACK
[0m19:31:17.718915 [debug] [Thread-1  ]: On test.bain_capital_analytics.relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_.2823f12709: ROLLBACK
[0m19:31:17.719289 [debug] [Thread-4  ]: Began executing node model.bain_capital_analytics.fact_trade_activity
[0m19:31:17.719604 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1: Close
[0m19:31:17.723180 [debug] [Thread-4  ]: Writing runtime sql for node "model.bain_capital_analytics.fact_trade_activity"
[0m19:31:17.723526 [debug] [Thread-1  ]: On test.bain_capital_analytics.relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_.2823f12709: Close
[0m19:31:17.723810 [debug] [Thread-3  ]: On test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f: Close
[0m19:31:17.724319 [info ] [Thread-2  ]: 24 of 40 PASS not_null_stg_positions_position_id ............................... [[32mPASS[0m in 0.07s]
[0m19:31:17.724922 [info ] [Thread-1  ]: 25 of 40 PASS relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_  [[32mPASS[0m in 0.07s]
[0m19:31:17.725974 [debug] [Thread-2  ]: Finished running node test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1
[0m19:31:17.725526 [info ] [Thread-3  ]: 26 of 40 PASS unique_stg_positions_position_id ................................. [[32mPASS[0m in 0.05s]
[0m19:31:17.726405 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.fact_trade_activity"
[0m19:31:17.726844 [debug] [Thread-1  ]: Finished running node test.bain_capital_analytics.relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_.2823f12709
[0m19:31:17.727237 [debug] [Thread-2  ]: Began running node model.bain_capital_analytics.int_trade_enriched
[0m19:31:17.727729 [debug] [Thread-3  ]: Finished running node test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f
[0m19:31:17.728044 [debug] [Thread-4  ]: On model.bain_capital_analytics.fact_trade_activity: BEGIN
[0m19:31:17.728552 [info ] [Thread-2  ]: 28 of 40 START sql view model public.int_trade_enriched ........................ [RUN]
[0m19:31:17.729037 [debug] [Thread-4  ]: Opening a new connection, currently in state closed
[0m19:31:17.729344 [debug] [Thread-1  ]: Began running node model.bain_capital_analytics.int_daily_positions
[0m19:31:17.729708 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1, now model.bain_capital_analytics.int_trade_enriched)
[0m19:31:17.730229 [info ] [Thread-1  ]: 29 of 40 START sql view model public.int_daily_positions ....................... [RUN]
[0m19:31:17.730570 [debug] [Thread-2  ]: Began compiling node model.bain_capital_analytics.int_trade_enriched
[0m19:31:17.730916 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_.2823f12709, now model.bain_capital_analytics.int_daily_positions)
[0m19:31:17.734944 [debug] [Thread-2  ]: Writing injected SQL for node "model.bain_capital_analytics.int_trade_enriched"
[0m19:31:17.735330 [debug] [Thread-1  ]: Began compiling node model.bain_capital_analytics.int_daily_positions
[0m19:31:17.740200 [debug] [Thread-1  ]: Writing injected SQL for node "model.bain_capital_analytics.int_daily_positions"
[0m19:31:17.740897 [debug] [Thread-2  ]: Began executing node model.bain_capital_analytics.int_trade_enriched
[0m19:31:17.744430 [debug] [Thread-2  ]: Writing runtime sql for node "model.bain_capital_analytics.int_trade_enriched"
[0m19:31:17.744917 [debug] [Thread-4  ]: SQL status: BEGIN in 0.016 seconds
[0m19:31:17.745319 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.fact_trade_activity"
[0m19:31:17.745694 [debug] [Thread-1  ]: Began executing node model.bain_capital_analytics.int_daily_positions
[0m19:31:17.746104 [debug] [Thread-4  ]: On model.bain_capital_analytics.fact_trade_activity: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.fact_trade_activity"} */

  create view "bain_analytics"."public"."fact_trade_activity__dbt_tmp"
    
    
  as (
    -- Pipeline B: FACT table - Trade activity detail
-- Anti-pattern: repeats the SAME 3-table join as fact_portfolio_pnl and int_trade_enriched
-- Anti-pattern: could use int_trade_enriched but re-does everything

select
    t.trade_id,
    t.portfolio_id,
    t.instrument_id,
    t.counterparty_id,
    t.trade_date,
    t.settlement_date,
    t.trade_type,
    t.quantity,
    t.price,
    t.notional_amount,
    t.commission,
    t.currency,
    t.settlement_days,
    -- Anti-pattern: re-joining instruments (done in int_trade_enriched)
    i.instrument_name,
    i.instrument_type,
    i.sector,
    i.liquidity_class,
    -- Anti-pattern: re-joining counterparties (done in int_trade_enriched)
    c.counterparty_name,
    c.counterparty_type,
    c.credit_rating,
    -- Anti-pattern: re-joining portfolios (done in int_trade_enriched)
    p.portfolio_name,
    p.strategy,
    p.fund_id,
    p.manager_name,
    -- Anti-pattern: re-joining dates
    d.fiscal_quarter,
    d.fiscal_year,
    d.is_month_end,
    -- Anti-pattern: duplicated fiscal quarter logic
    case
        when extract(month from t.trade_date) between 1 and 3 then 'Q3'
        when extract(month from t.trade_date) between 4 and 6 then 'Q4'
        when extract(month from t.trade_date) between 7 and 9 then 'Q1'
        when extract(month from t.trade_date) between 10 and 12 then 'Q2'
    end as computed_fiscal_quarter,
    -- Anti-pattern: window functions recomputed (already in int_trade_enriched)
    sum(t.notional_amount) over (
        partition by t.portfolio_id
        order by t.trade_date
        rows between unbounded preceding and current row
    ) as running_notional,
    count(*) over (
        partition by t.portfolio_id, date_trunc('month', t.trade_date)
    ) as monthly_trade_count,
    sum(t.commission) over (
        partition by t.portfolio_id, date_trunc('month', t.trade_date)
    ) as monthly_commissions
from "bain_analytics"."public"."stg_trades" t
inner join "bain_analytics"."public"."stg_instruments" i
    on t.instrument_id = i.instrument_id
inner join "bain_analytics"."public"."stg_counterparties" c
    on t.counterparty_id = c.counterparty_id
inner join "bain_analytics"."public"."stg_portfolios" p
    on t.portfolio_id = p.portfolio_id
inner join "bain_analytics"."public"."stg_dates" d
    on t.trade_date = d.date_day
  );
[0m19:31:17.746556 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.int_trade_enriched"
[0m19:31:17.750452 [debug] [Thread-1  ]: Writing runtime sql for node "model.bain_capital_analytics.int_daily_positions"
[0m19:31:17.750885 [debug] [Thread-2  ]: On model.bain_capital_analytics.int_trade_enriched: BEGIN
[0m19:31:17.751310 [debug] [Thread-2  ]: Opening a new connection, currently in state closed
[0m19:31:17.751872 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.int_daily_positions"
[0m19:31:17.752223 [debug] [Thread-1  ]: On model.bain_capital_analytics.int_daily_positions: BEGIN
[0m19:31:17.752518 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m19:31:17.756495 [debug] [Thread-4  ]: SQL status: CREATE VIEW in 0.006 seconds
[0m19:31:17.759691 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.fact_trade_activity"
[0m19:31:17.760145 [debug] [Thread-4  ]: On model.bain_capital_analytics.fact_trade_activity: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.fact_trade_activity"} */
alter table "bain_analytics"."public"."fact_trade_activity__dbt_tmp" rename to "fact_trade_activity"
[0m19:31:17.760625 [debug] [Thread-1  ]: SQL status: BEGIN in 0.008 seconds
[0m19:31:17.760969 [debug] [Thread-2  ]: SQL status: BEGIN in 0.010 seconds
[0m19:31:17.761290 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.int_daily_positions"
[0m19:31:17.761603 [debug] [Thread-4  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m19:31:17.761909 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.int_trade_enriched"
[0m19:31:17.762308 [debug] [Thread-1  ]: On model.bain_capital_analytics.int_daily_positions: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.int_daily_positions"} */

  create view "bain_analytics"."public"."int_daily_positions__dbt_tmp"
    
    
  as (
    -- Pipeline B: Daily position snapshots with PnL calculations
-- Anti-pattern: deep CTE nesting
-- Anti-pattern: repeated joins to same dimension tables

with position_base as (
    select
        pos.position_id,
        pos.portfolio_id,
        pos.instrument_id,
        pos.position_date,
        pos.quantity,
        pos.market_value,
        pos.cost_basis,
        pos.unrealized_gain_loss,
        pos.unrealized_return_pct,
        pos.currency
    from "bain_analytics"."public"."stg_positions" pos
),

-- Anti-pattern: CTE level 2 - join instruments (same join as int_trade_enriched)
position_with_instruments as (
    select
        pb.*,
        i.instrument_name,
        i.instrument_type,
        i.sector,
        i.liquidity_class
    from position_base pb
    inner join "bain_analytics"."public"."stg_instruments" i
        on pb.instrument_id = i.instrument_id
),

-- Anti-pattern: CTE level 3 - join portfolios (same join as int_trade_enriched)
position_with_portfolio as (
    select
        pwi.*,
        p.portfolio_name,
        p.strategy,
        p.fund_id
    from position_with_instruments pwi
    inner join "bain_analytics"."public"."stg_portfolios" p
        on pwi.portfolio_id = p.portfolio_id
),

-- Anti-pattern: CTE level 4 - join dates
position_with_dates as (
    select
        pwp.*,
        d.is_business_day,
        d.is_month_end,
        d.is_quarter_end,
        d.fiscal_quarter,
        d.fiscal_year
    from position_with_portfolio pwp
    inner join "bain_analytics"."public"."stg_dates" d
        on pwp.position_date = d.date_day
),

-- Anti-pattern: CTE level 5 - compute window functions
position_with_analytics as (
    select
        pwd.*,
        -- Anti-pattern: multiple window functions on same partition
        lag(pwd.market_value) over (
            partition by pwd.portfolio_id, pwd.instrument_id
            order by pwd.position_date
        ) as prev_market_value,
        pwd.market_value - coalesce(
            lag(pwd.market_value) over (
                partition by pwd.portfolio_id, pwd.instrument_id
                order by pwd.position_date
            ), pwd.cost_basis
        ) as daily_pnl,
        sum(pwd.market_value) over (
            partition by pwd.portfolio_id, pwd.position_date
        ) as portfolio_total_mv,
        case
            when sum(pwd.market_value) over (partition by pwd.portfolio_id, pwd.position_date) != 0
            then pwd.market_value / sum(pwd.market_value) over (partition by pwd.portfolio_id, pwd.position_date)
            else 0
        end as weight_in_portfolio
    from position_with_dates pwd
)

select * from position_with_analytics
  );
[0m19:31:17.763482 [debug] [Thread-4  ]: On model.bain_capital_analytics.fact_trade_activity: COMMIT
[0m19:31:17.763914 [debug] [Thread-2  ]: On model.bain_capital_analytics.int_trade_enriched: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.int_trade_enriched"} */

  create view "bain_analytics"."public"."int_trade_enriched__dbt_tmp"
    
    
  as (
    -- Pipeline B: Enriched trade data with instrument and counterparty details
-- Anti-pattern: subquery for dedup instead of QUALIFY (Snowflake)
-- Anti-pattern: heavy join that will be repeated in multiple downstream models

with latest_trades as (
    -- Anti-pattern: subquery to filter row_number instead of QUALIFY
    select *
    from (
        select
            t.*,
            i.instrument_name,
            i.instrument_type,
            i.sector,
            i.liquidity_class,
            c.counterparty_name,
            c.counterparty_type,
            c.credit_rating,
            p.portfolio_name,
            p.strategy,
            p.manager_name,
            -- Anti-pattern: duplicated fiscal quarter logic AGAIN
            case
                when extract(month from t.trade_date) between 1 and 3 then 'Q3'
                when extract(month from t.trade_date) between 4 and 6 then 'Q4'
                when extract(month from t.trade_date) between 7 and 9 then 'Q1'
                when extract(month from t.trade_date) between 10 and 12 then 'Q2'
            end as fiscal_quarter,
            row_number() over (
                partition by t.portfolio_id, t.instrument_id, t.trade_date
                order by t.trade_id desc
            ) as rn
        from "bain_analytics"."public"."stg_trades" t
        -- Anti-pattern: these 3 joins are repeated in fact_portfolio_pnl and fact_trade_activity
        inner join "bain_analytics"."public"."stg_instruments" i
            on t.instrument_id = i.instrument_id
        inner join "bain_analytics"."public"."stg_counterparties" c
            on t.counterparty_id = c.counterparty_id
        inner join "bain_analytics"."public"."stg_portfolios" p
            on t.portfolio_id = p.portfolio_id
    ) sub
    where rn = 1
)

select
    trade_id,
    portfolio_id,
    portfolio_name,
    strategy,
    manager_name,
    instrument_id,
    instrument_name,
    instrument_type,
    sector,
    liquidity_class,
    counterparty_id,
    counterparty_name,
    counterparty_type,
    credit_rating,
    trade_date,
    settlement_date,
    trade_type,
    quantity,
    price,
    notional_amount,
    commission,
    currency,
    fiscal_quarter,
    settlement_days,
    -- Anti-pattern: running total computed here AND again in downstream models
    sum(notional_amount) over (
        partition by portfolio_id
        order by trade_date
        rows between unbounded preceding and current row
    ) as cumulative_notional
from latest_trades
  );
[0m19:31:17.764381 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.fact_trade_activity"
[0m19:31:17.764740 [debug] [Thread-4  ]: On model.bain_capital_analytics.fact_trade_activity: COMMIT
[0m19:31:17.766189 [debug] [Thread-4  ]: SQL status: COMMIT in 0.001 seconds
[0m19:31:17.769038 [debug] [Thread-4  ]: Applying DROP to: "bain_analytics"."public"."fact_trade_activity__dbt_backup"
[0m19:31:17.769592 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.fact_trade_activity"
[0m19:31:17.769913 [debug] [Thread-4  ]: On model.bain_capital_analytics.fact_trade_activity: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.fact_trade_activity"} */
drop view if exists "bain_analytics"."public"."fact_trade_activity__dbt_backup" cascade
[0m19:31:17.770256 [debug] [Thread-2  ]: SQL status: CREATE VIEW in 0.006 seconds
[0m19:31:17.770598 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.006 seconds
[0m19:31:17.770918 [debug] [Thread-4  ]: SQL status: DROP VIEW in 0.000 seconds
[0m19:31:17.774496 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.int_trade_enriched"
[0m19:31:17.827392 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.int_daily_positions"
[0m19:31:17.828710 [debug] [Thread-4  ]: On model.bain_capital_analytics.fact_trade_activity: Close
[0m19:31:17.829062 [debug] [Thread-2  ]: On model.bain_capital_analytics.int_trade_enriched: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.int_trade_enriched"} */
alter table "bain_analytics"."public"."int_trade_enriched__dbt_tmp" rename to "int_trade_enriched"
[0m19:31:17.829386 [debug] [Thread-1  ]: On model.bain_capital_analytics.int_daily_positions: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.int_daily_positions"} */
alter table "bain_analytics"."public"."int_daily_positions__dbt_tmp" rename to "int_daily_positions"
[0m19:31:17.829974 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '290a654a-b3cb-45e1-85a4-20dad7e7d2ab', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ec15e50>]}
[0m19:31:17.830651 [info ] [Thread-4  ]: 27 of 40 OK created sql view model public.fact_trade_activity .................. [[32mCREATE VIEW[0m in 0.12s]
[0m19:31:17.831076 [debug] [Thread-2  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m19:31:17.831556 [debug] [Thread-4  ]: Finished running node model.bain_capital_analytics.fact_trade_activity
[0m19:31:17.831861 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.002 seconds
[0m19:31:17.833015 [debug] [Thread-2  ]: On model.bain_capital_analytics.int_trade_enriched: COMMIT
[0m19:31:17.834322 [debug] [Thread-1  ]: On model.bain_capital_analytics.int_daily_positions: COMMIT
[0m19:31:17.834800 [debug] [Thread-3  ]: Began running node test.bain_capital_analytics.not_null_fact_trade_activity_trade_id.6ec5fc5e45
[0m19:31:17.835124 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.int_trade_enriched"
[0m19:31:17.835421 [debug] [Thread-4  ]: Began running node test.bain_capital_analytics.unique_fact_trade_activity_trade_id.e03d2f9a00
[0m19:31:17.835738 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.int_daily_positions"
[0m19:31:17.836066 [info ] [Thread-3  ]: 30 of 40 START test not_null_fact_trade_activity_trade_id ...................... [RUN]
[0m19:31:17.836393 [debug] [Thread-2  ]: On model.bain_capital_analytics.int_trade_enriched: COMMIT
[0m19:31:17.836698 [info ] [Thread-4  ]: 31 of 40 START test unique_fact_trade_activity_trade_id ........................ [RUN]
[0m19:31:17.837011 [debug] [Thread-1  ]: On model.bain_capital_analytics.int_daily_positions: COMMIT
[0m19:31:17.837364 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f, now test.bain_capital_analytics.not_null_fact_trade_activity_trade_id.6ec5fc5e45)
[0m19:31:17.837777 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly model.bain_capital_analytics.fact_trade_activity, now test.bain_capital_analytics.unique_fact_trade_activity_trade_id.e03d2f9a00)
[0m19:31:17.838176 [debug] [Thread-3  ]: Began compiling node test.bain_capital_analytics.not_null_fact_trade_activity_trade_id.6ec5fc5e45
[0m19:31:17.838473 [debug] [Thread-4  ]: Began compiling node test.bain_capital_analytics.unique_fact_trade_activity_trade_id.e03d2f9a00
[0m19:31:17.838801 [debug] [Thread-2  ]: SQL status: COMMIT in 0.001 seconds
[0m19:31:17.842713 [debug] [Thread-3  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_fact_trade_activity_trade_id.6ec5fc5e45"
[0m19:31:17.843061 [debug] [Thread-1  ]: SQL status: COMMIT in 0.005 seconds
[0m19:31:17.846634 [debug] [Thread-4  ]: Writing injected SQL for node "test.bain_capital_analytics.unique_fact_trade_activity_trade_id.e03d2f9a00"
[0m19:31:17.848931 [debug] [Thread-2  ]: Applying DROP to: "bain_analytics"."public"."int_trade_enriched__dbt_backup"
[0m19:31:17.851397 [debug] [Thread-1  ]: Applying DROP to: "bain_analytics"."public"."int_daily_positions__dbt_backup"
[0m19:31:17.852004 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.int_trade_enriched"
[0m19:31:17.852613 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.int_daily_positions"
[0m19:31:17.852933 [debug] [Thread-3  ]: Began executing node test.bain_capital_analytics.not_null_fact_trade_activity_trade_id.6ec5fc5e45
[0m19:31:17.853263 [debug] [Thread-2  ]: On model.bain_capital_analytics.int_trade_enriched: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.int_trade_enriched"} */
drop view if exists "bain_analytics"."public"."int_trade_enriched__dbt_backup" cascade
[0m19:31:17.853581 [debug] [Thread-4  ]: Began executing node test.bain_capital_analytics.unique_fact_trade_activity_trade_id.e03d2f9a00
[0m19:31:17.853878 [debug] [Thread-1  ]: On model.bain_capital_analytics.int_daily_positions: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.int_daily_positions"} */
drop view if exists "bain_analytics"."public"."int_daily_positions__dbt_backup" cascade
[0m19:31:17.856899 [debug] [Thread-3  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_fact_trade_activity_trade_id.6ec5fc5e45"
[0m19:31:17.859167 [debug] [Thread-4  ]: Writing runtime sql for node "test.bain_capital_analytics.unique_fact_trade_activity_trade_id.e03d2f9a00"
[0m19:31:17.859510 [debug] [Thread-2  ]: SQL status: DROP VIEW in 0.002 seconds
[0m19:31:17.860779 [debug] [Thread-2  ]: On model.bain_capital_analytics.int_trade_enriched: Close
[0m19:31:17.861127 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.001 seconds
[0m19:31:17.861684 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '290a654a-b3cb-45e1-85a4-20dad7e7d2ab', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10eb8dcd0>]}
[0m19:31:17.862056 [debug] [Thread-4  ]: Using postgres connection "test.bain_capital_analytics.unique_fact_trade_activity_trade_id.e03d2f9a00"
[0m19:31:17.863052 [debug] [Thread-1  ]: On model.bain_capital_analytics.int_daily_positions: Close
[0m19:31:17.863404 [debug] [Thread-3  ]: Using postgres connection "test.bain_capital_analytics.not_null_fact_trade_activity_trade_id.6ec5fc5e45"
[0m19:31:17.863792 [debug] [Thread-4  ]: On test.bain_capital_analytics.unique_fact_trade_activity_trade_id.e03d2f9a00: BEGIN
[0m19:31:17.864256 [info ] [Thread-2  ]: 28 of 40 OK created sql view model public.int_trade_enriched ................... [[32mCREATE VIEW[0m in 0.13s]
[0m19:31:17.864765 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_fact_trade_activity_trade_id.6ec5fc5e45: BEGIN
[0m19:31:17.865058 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '290a654a-b3cb-45e1-85a4-20dad7e7d2ab', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ea42be0>]}
[0m19:31:17.865363 [debug] [Thread-4  ]: Opening a new connection, currently in state closed
[0m19:31:17.865827 [debug] [Thread-2  ]: Finished running node model.bain_capital_analytics.int_trade_enriched
[0m19:31:17.866140 [debug] [Thread-3  ]: Opening a new connection, currently in state closed
[0m19:31:17.866756 [info ] [Thread-1  ]: 29 of 40 OK created sql view model public.int_daily_positions .................. [[32mCREATE VIEW[0m in 0.13s]
[0m19:31:17.867390 [debug] [Thread-2  ]: Began running node test.bain_capital_analytics.not_null_int_trade_enriched_trade_id.020f969dc8
[0m19:31:17.867839 [debug] [Thread-1  ]: Finished running node model.bain_capital_analytics.int_daily_positions
[0m19:31:17.868177 [info ] [Thread-2  ]: 32 of 40 START test not_null_int_trade_enriched_trade_id ....................... [RUN]
[0m19:31:17.868551 [debug] [Thread-1  ]: Began running node test.bain_capital_analytics.unique_int_trade_enriched_trade_id.9cdb3dc82a
[0m19:31:17.868954 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly model.bain_capital_analytics.int_trade_enriched, now test.bain_capital_analytics.not_null_int_trade_enriched_trade_id.020f969dc8)
[0m19:31:17.869330 [info ] [Thread-1  ]: 33 of 40 START test unique_int_trade_enriched_trade_id ......................... [RUN]
[0m19:31:17.869669 [debug] [Thread-2  ]: Began compiling node test.bain_capital_analytics.not_null_int_trade_enriched_trade_id.020f969dc8
[0m19:31:17.870004 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.bain_capital_analytics.int_daily_positions, now test.bain_capital_analytics.unique_int_trade_enriched_trade_id.9cdb3dc82a)
[0m19:31:17.873648 [debug] [Thread-2  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_int_trade_enriched_trade_id.020f969dc8"
[0m19:31:17.873968 [debug] [Thread-1  ]: Began compiling node test.bain_capital_analytics.unique_int_trade_enriched_trade_id.9cdb3dc82a
[0m19:31:17.877471 [debug] [Thread-1  ]: Writing injected SQL for node "test.bain_capital_analytics.unique_int_trade_enriched_trade_id.9cdb3dc82a"
[0m19:31:17.878006 [debug] [Thread-1  ]: Began executing node test.bain_capital_analytics.unique_int_trade_enriched_trade_id.9cdb3dc82a
[0m19:31:17.878326 [debug] [Thread-2  ]: Began executing node test.bain_capital_analytics.not_null_int_trade_enriched_trade_id.020f969dc8
[0m19:31:17.880636 [debug] [Thread-1  ]: Writing runtime sql for node "test.bain_capital_analytics.unique_int_trade_enriched_trade_id.9cdb3dc82a"
[0m19:31:17.880958 [debug] [Thread-3  ]: SQL status: BEGIN in 0.015 seconds
[0m19:31:17.881279 [debug] [Thread-4  ]: SQL status: BEGIN in 0.016 seconds
[0m19:31:17.883438 [debug] [Thread-2  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_int_trade_enriched_trade_id.020f969dc8"
[0m19:31:17.883881 [debug] [Thread-3  ]: Using postgres connection "test.bain_capital_analytics.not_null_fact_trade_activity_trade_id.6ec5fc5e45"
[0m19:31:17.884224 [debug] [Thread-4  ]: Using postgres connection "test.bain_capital_analytics.unique_fact_trade_activity_trade_id.e03d2f9a00"
[0m19:31:17.884667 [debug] [Thread-1  ]: Using postgres connection "test.bain_capital_analytics.unique_int_trade_enriched_trade_id.9cdb3dc82a"
[0m19:31:17.885021 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_fact_trade_activity_trade_id.6ec5fc5e45: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_fact_trade_activity_trade_id.6ec5fc5e45"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select trade_id
from "bain_analytics"."public"."fact_trade_activity"
where trade_id is null



  
  
      
    ) dbt_internal_test
[0m19:31:17.885381 [debug] [Thread-4  ]: On test.bain_capital_analytics.unique_fact_trade_activity_trade_id.e03d2f9a00: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.unique_fact_trade_activity_trade_id.e03d2f9a00"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

select
    trade_id as unique_field,
    count(*) as n_records

from "bain_analytics"."public"."fact_trade_activity"
where trade_id is not null
group by trade_id
having count(*) > 1



  
  
      
    ) dbt_internal_test
[0m19:31:17.885728 [debug] [Thread-1  ]: On test.bain_capital_analytics.unique_int_trade_enriched_trade_id.9cdb3dc82a: BEGIN
[0m19:31:17.886080 [debug] [Thread-2  ]: Using postgres connection "test.bain_capital_analytics.not_null_int_trade_enriched_trade_id.020f969dc8"
[0m19:31:17.886463 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m19:31:17.886812 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_int_trade_enriched_trade_id.020f969dc8: BEGIN
[0m19:31:17.887212 [debug] [Thread-2  ]: Opening a new connection, currently in state closed
[0m19:31:17.892803 [debug] [Thread-4  ]: SQL status: SELECT 1 in 0.006 seconds
[0m19:31:17.893117 [debug] [Thread-3  ]: SQL status: SELECT 1 in 0.007 seconds
[0m19:31:17.894362 [debug] [Thread-4  ]: On test.bain_capital_analytics.unique_fact_trade_activity_trade_id.e03d2f9a00: ROLLBACK
[0m19:31:17.895411 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_fact_trade_activity_trade_id.6ec5fc5e45: ROLLBACK
[0m19:31:17.896059 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_fact_trade_activity_trade_id.6ec5fc5e45: Close
[0m19:31:17.896427 [debug] [Thread-4  ]: On test.bain_capital_analytics.unique_fact_trade_activity_trade_id.e03d2f9a00: Close
[0m19:31:17.897243 [debug] [Thread-1  ]: SQL status: BEGIN in 0.011 seconds
[0m19:31:17.896968 [info ] [Thread-3  ]: 30 of 40 PASS not_null_fact_trade_activity_trade_id ............................ [[32mPASS[0m in 0.06s]
[0m19:31:17.898017 [debug] [Thread-1  ]: Using postgres connection "test.bain_capital_analytics.unique_int_trade_enriched_trade_id.9cdb3dc82a"
[0m19:31:17.897688 [info ] [Thread-4  ]: 31 of 40 PASS unique_fact_trade_activity_trade_id .............................. [[32mPASS[0m in 0.06s]
[0m19:31:17.898565 [debug] [Thread-3  ]: Finished running node test.bain_capital_analytics.not_null_fact_trade_activity_trade_id.6ec5fc5e45
[0m19:31:17.898889 [debug] [Thread-1  ]: On test.bain_capital_analytics.unique_int_trade_enriched_trade_id.9cdb3dc82a: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.unique_int_trade_enriched_trade_id.9cdb3dc82a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

select
    trade_id as unique_field,
    count(*) as n_records

from "bain_analytics"."public"."int_trade_enriched"
where trade_id is not null
group by trade_id
having count(*) > 1



  
  
      
    ) dbt_internal_test
[0m19:31:17.899239 [debug] [Thread-2  ]: SQL status: BEGIN in 0.012 seconds
[0m19:31:17.899714 [debug] [Thread-4  ]: Finished running node test.bain_capital_analytics.unique_fact_trade_activity_trade_id.e03d2f9a00
[0m19:31:17.900062 [debug] [Thread-3  ]: Began running node test.bain_capital_analytics.not_null_int_daily_positions_position_id.198d23a5e6
[0m19:31:17.900467 [debug] [Thread-2  ]: Using postgres connection "test.bain_capital_analytics.not_null_int_trade_enriched_trade_id.020f969dc8"
[0m19:31:17.900858 [info ] [Thread-3  ]: 34 of 40 START test not_null_int_daily_positions_position_id ................... [RUN]
[0m19:31:17.901213 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_int_trade_enriched_trade_id.020f969dc8: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_int_trade_enriched_trade_id.020f969dc8"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select trade_id
from "bain_analytics"."public"."int_trade_enriched"
where trade_id is null



  
  
      
    ) dbt_internal_test
[0m19:31:17.901568 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.not_null_fact_trade_activity_trade_id.6ec5fc5e45, now test.bain_capital_analytics.not_null_int_daily_positions_position_id.198d23a5e6)
[0m19:31:17.901922 [debug] [Thread-3  ]: Began compiling node test.bain_capital_analytics.not_null_int_daily_positions_position_id.198d23a5e6
[0m19:31:17.907070 [debug] [Thread-3  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_int_daily_positions_position_id.198d23a5e6"
[0m19:31:17.907457 [debug] [Thread-2  ]: SQL status: SELECT 1 in 0.006 seconds
[0m19:31:17.907744 [debug] [Thread-1  ]: SQL status: SELECT 1 in 0.007 seconds
[0m19:31:17.909065 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_int_trade_enriched_trade_id.020f969dc8: ROLLBACK
[0m19:31:17.910130 [debug] [Thread-1  ]: On test.bain_capital_analytics.unique_int_trade_enriched_trade_id.9cdb3dc82a: ROLLBACK
[0m19:31:17.910565 [debug] [Thread-3  ]: Began executing node test.bain_capital_analytics.not_null_int_daily_positions_position_id.198d23a5e6
[0m19:31:17.910878 [debug] [Thread-1  ]: On test.bain_capital_analytics.unique_int_trade_enriched_trade_id.9cdb3dc82a: Close
[0m19:31:17.911174 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_int_trade_enriched_trade_id.020f969dc8: Close
[0m19:31:17.913595 [debug] [Thread-3  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_int_daily_positions_position_id.198d23a5e6"
[0m19:31:17.914108 [info ] [Thread-1  ]: 33 of 40 PASS unique_int_trade_enriched_trade_id ............................... [[32mPASS[0m in 0.04s]
[0m19:31:17.914596 [info ] [Thread-2  ]: 32 of 40 PASS not_null_int_trade_enriched_trade_id ............................. [[32mPASS[0m in 0.05s]
[0m19:31:17.915326 [debug] [Thread-1  ]: Finished running node test.bain_capital_analytics.unique_int_trade_enriched_trade_id.9cdb3dc82a
[0m19:31:17.915827 [debug] [Thread-2  ]: Finished running node test.bain_capital_analytics.not_null_int_trade_enriched_trade_id.020f969dc8
[0m19:31:17.916406 [debug] [Thread-3  ]: Using postgres connection "test.bain_capital_analytics.not_null_int_daily_positions_position_id.198d23a5e6"
[0m19:31:17.916715 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_int_daily_positions_position_id.198d23a5e6: BEGIN
[0m19:31:17.917004 [debug] [Thread-3  ]: Opening a new connection, currently in state closed
[0m19:31:17.924992 [debug] [Thread-3  ]: SQL status: BEGIN in 0.008 seconds
[0m19:31:17.925355 [debug] [Thread-3  ]: Using postgres connection "test.bain_capital_analytics.not_null_int_daily_positions_position_id.198d23a5e6"
[0m19:31:17.925671 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_int_daily_positions_position_id.198d23a5e6: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_int_daily_positions_position_id.198d23a5e6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select position_id
from "bain_analytics"."public"."int_daily_positions"
where position_id is null



  
  
      
    ) dbt_internal_test
[0m19:31:17.931571 [debug] [Thread-3  ]: SQL status: SELECT 1 in 0.006 seconds
[0m19:31:17.932902 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_int_daily_positions_position_id.198d23a5e6: ROLLBACK
[0m19:31:17.933468 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_int_daily_positions_position_id.198d23a5e6: Close
[0m19:31:17.934002 [info ] [Thread-3  ]: 34 of 40 PASS not_null_int_daily_positions_position_id ......................... [[32mPASS[0m in 0.03s]
[0m19:31:17.934454 [debug] [Thread-3  ]: Finished running node test.bain_capital_analytics.not_null_int_daily_positions_position_id.198d23a5e6
[0m19:31:17.935089 [debug] [Thread-4  ]: Began running node model.bain_capital_analytics.fact_portfolio_pnl
[0m19:31:17.935563 [info ] [Thread-4  ]: 35 of 40 START sql view model public.fact_portfolio_pnl ........................ [RUN]
[0m19:31:17.935951 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.unique_fact_trade_activity_trade_id.e03d2f9a00, now model.bain_capital_analytics.fact_portfolio_pnl)
[0m19:31:17.936258 [debug] [Thread-4  ]: Began compiling node model.bain_capital_analytics.fact_portfolio_pnl
[0m19:31:17.940385 [debug] [Thread-4  ]: Writing injected SQL for node "model.bain_capital_analytics.fact_portfolio_pnl"
[0m19:31:17.941004 [debug] [Thread-4  ]: Began executing node model.bain_capital_analytics.fact_portfolio_pnl
[0m19:31:17.944484 [debug] [Thread-4  ]: Writing runtime sql for node "model.bain_capital_analytics.fact_portfolio_pnl"
[0m19:31:17.945010 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.fact_portfolio_pnl"
[0m19:31:17.945313 [debug] [Thread-4  ]: On model.bain_capital_analytics.fact_portfolio_pnl: BEGIN
[0m19:31:17.945598 [debug] [Thread-4  ]: Opening a new connection, currently in state closed
[0m19:31:17.953870 [debug] [Thread-4  ]: SQL status: BEGIN in 0.008 seconds
[0m19:31:17.954212 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.fact_portfolio_pnl"
[0m19:31:17.954610 [debug] [Thread-4  ]: On model.bain_capital_analytics.fact_portfolio_pnl: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.fact_portfolio_pnl"} */

  create view "bain_analytics"."public"."fact_portfolio_pnl__dbt_tmp"
    
    
  as (
    -- Pipeline B: FACT table - Portfolio PnL by date
-- Anti-pattern: repeats the same heavy 3-table join as int_trade_enriched
-- Anti-pattern: late aggregation after expensive joins
-- Anti-pattern: materialized as view (should be table/incremental)

with trade_pnl as (
    -- Anti-pattern: re-joining trades to instruments and portfolios
    -- (same join already done in int_trade_enriched)
    select
        t.portfolio_id,
        t.trade_date,
        t.instrument_id,
        t.trade_type,
        t.notional_amount,
        t.commission,
        i.instrument_name,
        i.instrument_type,
        i.sector,
        p.portfolio_name,
        p.strategy,
        p.fund_id,
        d.fiscal_quarter,
        d.fiscal_year,
        d.is_month_end,
        d.is_quarter_end
    from "bain_analytics"."public"."stg_trades" t
    inner join "bain_analytics"."public"."stg_instruments" i
        on t.instrument_id = i.instrument_id
    inner join "bain_analytics"."public"."stg_portfolios" p
        on t.portfolio_id = p.portfolio_id
    inner join "bain_analytics"."public"."stg_dates" d
        on t.trade_date = d.date_day
),

position_pnl as (
    select
        dp.portfolio_id,
        dp.position_date,
        dp.portfolio_name,
        dp.strategy,
        dp.fund_id,
        dp.fiscal_quarter,
        dp.fiscal_year,
        sum(dp.daily_pnl) as position_daily_pnl,
        sum(dp.market_value) as total_market_value,
        count(distinct dp.instrument_id) as num_positions
    from "bain_analytics"."public"."int_daily_positions" dp
    group by
        dp.portfolio_id, dp.position_date, dp.portfolio_name,
        dp.strategy, dp.fund_id, dp.fiscal_quarter, dp.fiscal_year
),

-- Anti-pattern: aggregating trades separately then joining back
trade_activity as (
    select
        portfolio_id,
        trade_date,
        sum(notional_amount) as total_traded_notional,
        sum(commission) as total_commissions,
        count(*) as num_trades
    from trade_pnl
    group by portfolio_id, trade_date
)

select
    pp.portfolio_id,
    pp.portfolio_name,
    pp.strategy,
    pp.fund_id,
    pp.position_date as pnl_date,
    pp.fiscal_quarter,
    pp.fiscal_year,
    pp.position_daily_pnl,
    pp.total_market_value,
    pp.num_positions,
    coalesce(ta.total_traded_notional, 0) as total_traded_notional,
    coalesce(ta.total_commissions, 0) as total_commissions,
    coalesce(ta.num_trades, 0) as num_trades,
    -- Anti-pattern: running total recomputed here (already in int_trade_enriched)
    sum(pp.position_daily_pnl) over (
        partition by pp.portfolio_id
        order by pp.position_date
        rows between unbounded preceding and current row
    ) as cumulative_pnl
from position_pnl pp
left join trade_activity ta
    on pp.portfolio_id = ta.portfolio_id
    and pp.position_date = ta.trade_date
  );
[0m19:31:17.960885 [debug] [Thread-4  ]: SQL status: CREATE VIEW in 0.006 seconds
[0m19:31:17.963839 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.fact_portfolio_pnl"
[0m19:31:17.964161 [debug] [Thread-4  ]: On model.bain_capital_analytics.fact_portfolio_pnl: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.fact_portfolio_pnl"} */
alter table "bain_analytics"."public"."fact_portfolio_pnl__dbt_tmp" rename to "fact_portfolio_pnl"
[0m19:31:17.965251 [debug] [Thread-4  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m19:31:17.966296 [debug] [Thread-4  ]: On model.bain_capital_analytics.fact_portfolio_pnl: COMMIT
[0m19:31:17.966617 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.fact_portfolio_pnl"
[0m19:31:17.966913 [debug] [Thread-4  ]: On model.bain_capital_analytics.fact_portfolio_pnl: COMMIT
[0m19:31:17.968002 [debug] [Thread-4  ]: SQL status: COMMIT in 0.001 seconds
[0m19:31:17.971492 [debug] [Thread-4  ]: Applying DROP to: "bain_analytics"."public"."fact_portfolio_pnl__dbt_backup"
[0m19:31:17.971968 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.fact_portfolio_pnl"
[0m19:31:17.972279 [debug] [Thread-4  ]: On model.bain_capital_analytics.fact_portfolio_pnl: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.fact_portfolio_pnl"} */
drop view if exists "bain_analytics"."public"."fact_portfolio_pnl__dbt_backup" cascade
[0m19:31:17.972958 [debug] [Thread-4  ]: SQL status: DROP VIEW in 0.000 seconds
[0m19:31:17.973972 [debug] [Thread-4  ]: On model.bain_capital_analytics.fact_portfolio_pnl: Close
[0m19:31:17.974507 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '290a654a-b3cb-45e1-85a4-20dad7e7d2ab', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e861700>]}
[0m19:31:17.975077 [info ] [Thread-4  ]: 35 of 40 OK created sql view model public.fact_portfolio_pnl ................... [[32mCREATE VIEW[0m in 0.04s]
[0m19:31:17.975540 [debug] [Thread-4  ]: Finished running node model.bain_capital_analytics.fact_portfolio_pnl
[0m19:31:17.976278 [debug] [Thread-2  ]: Began running node test.bain_capital_analytics.assert_pnl_balanced
[0m19:31:17.976640 [debug] [Thread-3  ]: Began running node test.bain_capital_analytics.not_null_fact_portfolio_pnl_pnl_date.1a8f6bfde4
[0m19:31:17.976966 [info ] [Thread-2  ]: 36 of 40 START test assert_pnl_balanced ........................................ [RUN]
[0m19:31:17.977326 [debug] [Thread-1  ]: Began running node test.bain_capital_analytics.not_null_fact_portfolio_pnl_portfolio_id.f71baa71b4
[0m19:31:17.977656 [info ] [Thread-3  ]: 37 of 40 START test not_null_fact_portfolio_pnl_pnl_date ....................... [RUN]
[0m19:31:17.978066 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.not_null_int_trade_enriched_trade_id.020f969dc8, now test.bain_capital_analytics.assert_pnl_balanced)
[0m19:31:17.978406 [info ] [Thread-1  ]: 38 of 40 START test not_null_fact_portfolio_pnl_portfolio_id ................... [RUN]
[0m19:31:17.978761 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.not_null_int_daily_positions_position_id.198d23a5e6, now test.bain_capital_analytics.not_null_fact_portfolio_pnl_pnl_date.1a8f6bfde4)
[0m19:31:17.979082 [debug] [Thread-2  ]: Began compiling node test.bain_capital_analytics.assert_pnl_balanced
[0m19:31:17.979402 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.unique_int_trade_enriched_trade_id.9cdb3dc82a, now test.bain_capital_analytics.not_null_fact_portfolio_pnl_portfolio_id.f71baa71b4)
[0m19:31:17.979718 [debug] [Thread-3  ]: Began compiling node test.bain_capital_analytics.not_null_fact_portfolio_pnl_pnl_date.1a8f6bfde4
[0m19:31:17.982815 [debug] [Thread-2  ]: Writing injected SQL for node "test.bain_capital_analytics.assert_pnl_balanced"
[0m19:31:17.983144 [debug] [Thread-1  ]: Began compiling node test.bain_capital_analytics.not_null_fact_portfolio_pnl_portfolio_id.f71baa71b4
[0m19:31:17.986725 [debug] [Thread-3  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_fact_portfolio_pnl_pnl_date.1a8f6bfde4"
[0m19:31:17.990309 [debug] [Thread-1  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_fact_portfolio_pnl_portfolio_id.f71baa71b4"
[0m19:31:17.990912 [debug] [Thread-2  ]: Began executing node test.bain_capital_analytics.assert_pnl_balanced
[0m19:31:17.991253 [debug] [Thread-3  ]: Began executing node test.bain_capital_analytics.not_null_fact_portfolio_pnl_pnl_date.1a8f6bfde4
[0m19:31:17.993573 [debug] [Thread-2  ]: Writing runtime sql for node "test.bain_capital_analytics.assert_pnl_balanced"
[0m19:31:17.993895 [debug] [Thread-1  ]: Began executing node test.bain_capital_analytics.not_null_fact_portfolio_pnl_portfolio_id.f71baa71b4
[0m19:31:17.996023 [debug] [Thread-3  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_fact_portfolio_pnl_pnl_date.1a8f6bfde4"
[0m19:31:17.999238 [debug] [Thread-1  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_fact_portfolio_pnl_portfolio_id.f71baa71b4"
[0m19:31:17.999806 [debug] [Thread-2  ]: Using postgres connection "test.bain_capital_analytics.assert_pnl_balanced"
[0m19:31:18.000119 [debug] [Thread-2  ]: On test.bain_capital_analytics.assert_pnl_balanced: BEGIN
[0m19:31:18.000453 [debug] [Thread-3  ]: Using postgres connection "test.bain_capital_analytics.not_null_fact_portfolio_pnl_pnl_date.1a8f6bfde4"
[0m19:31:18.000791 [debug] [Thread-2  ]: Opening a new connection, currently in state closed
[0m19:31:18.001110 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_fact_portfolio_pnl_pnl_date.1a8f6bfde4: BEGIN
[0m19:31:18.001456 [debug] [Thread-1  ]: Using postgres connection "test.bain_capital_analytics.not_null_fact_portfolio_pnl_portfolio_id.f71baa71b4"
[0m19:31:18.001857 [debug] [Thread-3  ]: Opening a new connection, currently in state closed
[0m19:31:18.002164 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_fact_portfolio_pnl_portfolio_id.f71baa71b4: BEGIN
[0m19:31:18.002552 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m19:31:18.013074 [debug] [Thread-3  ]: SQL status: BEGIN in 0.011 seconds
[0m19:31:18.013514 [debug] [Thread-2  ]: SQL status: BEGIN in 0.013 seconds
[0m19:31:18.013820 [debug] [Thread-3  ]: Using postgres connection "test.bain_capital_analytics.not_null_fact_portfolio_pnl_pnl_date.1a8f6bfde4"
[0m19:31:18.014167 [debug] [Thread-2  ]: Using postgres connection "test.bain_capital_analytics.assert_pnl_balanced"
[0m19:31:18.014483 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_fact_portfolio_pnl_pnl_date.1a8f6bfde4: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_fact_portfolio_pnl_pnl_date.1a8f6bfde4"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select pnl_date
from "bain_analytics"."public"."fact_portfolio_pnl"
where pnl_date is null



  
  
      
    ) dbt_internal_test
[0m19:31:18.014790 [debug] [Thread-1  ]: SQL status: BEGIN in 0.012 seconds
[0m19:31:18.015100 [debug] [Thread-2  ]: On test.bain_capital_analytics.assert_pnl_balanced: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.assert_pnl_balanced"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  -- Custom test: Ensure total PnL across all portfolios is reasonable
-- (not wildly negative, which would indicate a data or logic error)

select
    pnl_date,
    sum(position_daily_pnl) as total_daily_pnl
from "bain_analytics"."public"."fact_portfolio_pnl"
group by pnl_date
having sum(position_daily_pnl) < -100000000  -- flag if total daily loss exceeds $100M
  
  
      
    ) dbt_internal_test
[0m19:31:18.015445 [debug] [Thread-1  ]: Using postgres connection "test.bain_capital_analytics.not_null_fact_portfolio_pnl_portfolio_id.f71baa71b4"
[0m19:31:18.015831 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_fact_portfolio_pnl_portfolio_id.f71baa71b4: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_fact_portfolio_pnl_portfolio_id.f71baa71b4"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select portfolio_id
from "bain_analytics"."public"."fact_portfolio_pnl"
where portfolio_id is null



  
  
      
    ) dbt_internal_test
[0m19:31:18.022412 [debug] [Thread-3  ]: SQL status: SELECT 1 in 0.007 seconds
[0m19:31:18.022733 [debug] [Thread-1  ]: SQL status: SELECT 1 in 0.007 seconds
[0m19:31:18.023988 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_fact_portfolio_pnl_pnl_date.1a8f6bfde4: ROLLBACK
[0m19:31:18.024320 [debug] [Thread-2  ]: SQL status: SELECT 1 in 0.009 seconds
[0m19:31:18.025432 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_fact_portfolio_pnl_portfolio_id.f71baa71b4: ROLLBACK
[0m19:31:18.026493 [debug] [Thread-2  ]: On test.bain_capital_analytics.assert_pnl_balanced: ROLLBACK
[0m19:31:18.026815 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_fact_portfolio_pnl_pnl_date.1a8f6bfde4: Close
[0m19:31:18.027381 [info ] [Thread-3  ]: 37 of 40 PASS not_null_fact_portfolio_pnl_pnl_date ............................. [[32mPASS[0m in 0.05s]
[0m19:31:18.027727 [debug] [Thread-2  ]: On test.bain_capital_analytics.assert_pnl_balanced: Close
[0m19:31:18.028009 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_fact_portfolio_pnl_portfolio_id.f71baa71b4: Close
[0m19:31:18.028431 [debug] [Thread-3  ]: Finished running node test.bain_capital_analytics.not_null_fact_portfolio_pnl_pnl_date.1a8f6bfde4
[0m19:31:18.028912 [info ] [Thread-2  ]: 36 of 40 PASS assert_pnl_balanced .............................................. [[32mPASS[0m in 0.05s]
[0m19:31:18.029418 [info ] [Thread-1  ]: 38 of 40 PASS not_null_fact_portfolio_pnl_portfolio_id ......................... [[32mPASS[0m in 0.05s]
[0m19:31:18.029934 [debug] [Thread-2  ]: Finished running node test.bain_capital_analytics.assert_pnl_balanced
[0m19:31:18.030349 [debug] [Thread-1  ]: Finished running node test.bain_capital_analytics.not_null_fact_portfolio_pnl_portfolio_id.f71baa71b4
[0m19:31:18.031002 [debug] [Thread-4  ]: Began running node model.bain_capital_analytics.report_daily_pnl
[0m19:31:18.031483 [info ] [Thread-4  ]: 39 of 40 START sql view model public.report_daily_pnl .......................... [RUN]
[0m19:31:18.031858 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly model.bain_capital_analytics.fact_portfolio_pnl, now model.bain_capital_analytics.report_daily_pnl)
[0m19:31:18.032170 [debug] [Thread-4  ]: Began compiling node model.bain_capital_analytics.report_daily_pnl
[0m19:31:18.035410 [debug] [Thread-4  ]: Writing injected SQL for node "model.bain_capital_analytics.report_daily_pnl"
[0m19:31:18.035976 [debug] [Thread-4  ]: Began executing node model.bain_capital_analytics.report_daily_pnl
[0m19:31:18.039345 [debug] [Thread-4  ]: Writing runtime sql for node "model.bain_capital_analytics.report_daily_pnl"
[0m19:31:18.039831 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.report_daily_pnl"
[0m19:31:18.040127 [debug] [Thread-4  ]: On model.bain_capital_analytics.report_daily_pnl: BEGIN
[0m19:31:18.040404 [debug] [Thread-4  ]: Opening a new connection, currently in state closed
[0m19:31:18.048647 [debug] [Thread-4  ]: SQL status: BEGIN in 0.008 seconds
[0m19:31:18.048991 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.report_daily_pnl"
[0m19:31:18.049347 [debug] [Thread-4  ]: On model.bain_capital_analytics.report_daily_pnl: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.report_daily_pnl"} */

  create view "bain_analytics"."public"."report_daily_pnl__dbt_tmp"
    
    
  as (
    -- Pipeline B: REPORT table - Daily PnL report for portfolio managers
-- Anti-pattern: subquery for latest-only instead of QUALIFY
-- Anti-pattern: re-aggregation from fact that's already aggregated

with latest_pnl as (
    select *
    from (
        select
            fpnl.*,
            -- Anti-pattern: subquery dedup instead of QUALIFY
            row_number() over (
                partition by fpnl.portfolio_id
                order by fpnl.pnl_date desc
            ) as rn
        from "bain_analytics"."public"."fact_portfolio_pnl" fpnl
    ) sub
    where rn <= 5  -- last 5 dates per portfolio
),

-- Anti-pattern: re-joining to get benchmark data that should be part of the pipeline
pnl_with_benchmark as (
    select
        lp.*,
        bm.return_mtd as benchmark_return_mtd,
        bm.return_ytd as benchmark_return_ytd,
        bm.benchmark_name
    from latest_pnl lp
    left join "bain_analytics"."public"."stg_benchmarks" bm
        on lp.pnl_date = bm.benchmark_date
        and bm.benchmark_id = 'BM_SP500'
)

select
    portfolio_id,
    portfolio_name,
    strategy,
    pnl_date,
    fiscal_quarter,
    position_daily_pnl,
    cumulative_pnl,
    total_market_value,
    num_positions,
    total_traded_notional,
    total_commissions,
    num_trades,
    benchmark_name,
    benchmark_return_mtd,
    benchmark_return_ytd,
    -- Anti-pattern: computing return inline instead of upstream
    case
        when total_market_value != 0
        then position_daily_pnl / total_market_value
        else 0
    end as daily_return_pct
from pnl_with_benchmark
order by portfolio_id, pnl_date desc
  );
[0m19:31:18.054657 [debug] [Thread-4  ]: SQL status: CREATE VIEW in 0.005 seconds
[0m19:31:18.057587 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.report_daily_pnl"
[0m19:31:18.057929 [debug] [Thread-4  ]: On model.bain_capital_analytics.report_daily_pnl: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.report_daily_pnl"} */
alter table "bain_analytics"."public"."report_daily_pnl__dbt_tmp" rename to "report_daily_pnl"
[0m19:31:18.058925 [debug] [Thread-4  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m19:31:18.059914 [debug] [Thread-4  ]: On model.bain_capital_analytics.report_daily_pnl: COMMIT
[0m19:31:18.060229 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.report_daily_pnl"
[0m19:31:18.060512 [debug] [Thread-4  ]: On model.bain_capital_analytics.report_daily_pnl: COMMIT
[0m19:31:18.061391 [debug] [Thread-4  ]: SQL status: COMMIT in 0.001 seconds
[0m19:31:18.063581 [debug] [Thread-4  ]: Applying DROP to: "bain_analytics"."public"."report_daily_pnl__dbt_backup"
[0m19:31:18.064106 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.report_daily_pnl"
[0m19:31:18.064413 [debug] [Thread-4  ]: On model.bain_capital_analytics.report_daily_pnl: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.report_daily_pnl"} */
drop view if exists "bain_analytics"."public"."report_daily_pnl__dbt_backup" cascade
[0m19:31:18.064978 [debug] [Thread-4  ]: SQL status: DROP VIEW in 0.000 seconds
[0m19:31:18.066053 [debug] [Thread-4  ]: On model.bain_capital_analytics.report_daily_pnl: Close
[0m19:31:18.066571 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '290a654a-b3cb-45e1-85a4-20dad7e7d2ab', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e49c9a0>]}
[0m19:31:18.067119 [info ] [Thread-4  ]: 39 of 40 OK created sql view model public.report_daily_pnl ..................... [[32mCREATE VIEW[0m in 0.03s]
[0m19:31:18.067581 [debug] [Thread-4  ]: Finished running node model.bain_capital_analytics.report_daily_pnl
[0m19:31:18.068141 [debug] [Thread-2  ]: Began running node test.bain_capital_analytics.not_null_report_daily_pnl_portfolio_id.37974cbf9b
[0m19:31:18.068536 [info ] [Thread-2  ]: 40 of 40 START test not_null_report_daily_pnl_portfolio_id ..................... [RUN]
[0m19:31:18.068959 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.assert_pnl_balanced, now test.bain_capital_analytics.not_null_report_daily_pnl_portfolio_id.37974cbf9b)
[0m19:31:18.069272 [debug] [Thread-2  ]: Began compiling node test.bain_capital_analytics.not_null_report_daily_pnl_portfolio_id.37974cbf9b
[0m19:31:18.074433 [debug] [Thread-2  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_report_daily_pnl_portfolio_id.37974cbf9b"
[0m19:31:18.075049 [debug] [Thread-2  ]: Began executing node test.bain_capital_analytics.not_null_report_daily_pnl_portfolio_id.37974cbf9b
[0m19:31:18.077337 [debug] [Thread-2  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_report_daily_pnl_portfolio_id.37974cbf9b"
[0m19:31:18.077844 [debug] [Thread-2  ]: Using postgres connection "test.bain_capital_analytics.not_null_report_daily_pnl_portfolio_id.37974cbf9b"
[0m19:31:18.078144 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_report_daily_pnl_portfolio_id.37974cbf9b: BEGIN
[0m19:31:18.078431 [debug] [Thread-2  ]: Opening a new connection, currently in state closed
[0m19:31:18.087717 [debug] [Thread-2  ]: SQL status: BEGIN in 0.009 seconds
[0m19:31:18.088030 [debug] [Thread-2  ]: Using postgres connection "test.bain_capital_analytics.not_null_report_daily_pnl_portfolio_id.37974cbf9b"
[0m19:31:18.088334 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_report_daily_pnl_portfolio_id.37974cbf9b: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_report_daily_pnl_portfolio_id.37974cbf9b"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select portfolio_id
from "bain_analytics"."public"."report_daily_pnl"
where portfolio_id is null



  
  
      
    ) dbt_internal_test
[0m19:31:18.098454 [debug] [Thread-2  ]: SQL status: SELECT 1 in 0.010 seconds
[0m19:31:18.099879 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_report_daily_pnl_portfolio_id.37974cbf9b: ROLLBACK
[0m19:31:18.100533 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_report_daily_pnl_portfolio_id.37974cbf9b: Close
[0m19:31:18.101066 [info ] [Thread-2  ]: 40 of 40 PASS not_null_report_daily_pnl_portfolio_id ........................... [[32mPASS[0m in 0.03s]
[0m19:31:18.101538 [debug] [Thread-2  ]: Finished running node test.bain_capital_analytics.not_null_report_daily_pnl_portfolio_id.37974cbf9b
[0m19:31:18.102663 [debug] [MainThread]: Using postgres connection "master"
[0m19:31:18.102936 [debug] [MainThread]: On master: BEGIN
[0m19:31:18.103181 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m19:31:18.111788 [debug] [MainThread]: SQL status: BEGIN in 0.009 seconds
[0m19:31:18.112104 [debug] [MainThread]: On master: COMMIT
[0m19:31:18.112358 [debug] [MainThread]: Using postgres connection "master"
[0m19:31:18.112597 [debug] [MainThread]: On master: COMMIT
[0m19:31:18.113102 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m19:31:18.113389 [debug] [MainThread]: On master: Close
[0m19:31:18.113728 [debug] [MainThread]: Connection 'master' was properly closed.
[0m19:31:18.113972 [debug] [MainThread]: Connection 'test.bain_capital_analytics.not_null_fact_portfolio_pnl_portfolio_id.f71baa71b4' was properly closed.
[0m19:31:18.114211 [debug] [MainThread]: Connection 'test.bain_capital_analytics.not_null_report_daily_pnl_portfolio_id.37974cbf9b' was properly closed.
[0m19:31:18.114436 [debug] [MainThread]: Connection 'test.bain_capital_analytics.not_null_fact_portfolio_pnl_pnl_date.1a8f6bfde4' was properly closed.
[0m19:31:18.114662 [debug] [MainThread]: Connection 'model.bain_capital_analytics.report_daily_pnl' was properly closed.
[0m19:31:18.115030 [info ] [MainThread]: 
[0m19:31:18.115338 [info ] [MainThread]: Finished running 28 data tests, 12 view models in 0 hours 0 minutes and 1.16 seconds (1.16s).
[0m19:31:18.119986 [debug] [MainThread]: Command end result
[0m19:31:18.163714 [debug] [MainThread]: Wrote artifact WritableManifest to ./target/manifest.json
[0m19:31:18.165593 [debug] [MainThread]: Wrote artifact SemanticManifest to ./target/semantic_manifest.json
[0m19:31:18.173217 [debug] [MainThread]: Wrote artifact RunExecutionResult to ./target/run_results.json
[0m19:31:18.173540 [info ] [MainThread]: 
[0m19:31:18.173871 [info ] [MainThread]: [32mCompleted successfully[0m
[0m19:31:18.174178 [info ] [MainThread]: 
[0m19:31:18.174468 [info ] [MainThread]: Done. PASS=40 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=40
[0m19:31:18.177064 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 2.1378446, "process_in_blocks": "0", "process_kernel_time": 0.34672, "process_mem_max_rss": "141656064", "process_out_blocks": "0", "process_user_time": 3.181848}
[0m19:31:18.177415 [debug] [MainThread]: Command `dbt build` succeeded at 19:31:18.177347 after 2.14 seconds
[0m19:31:18.177741 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c02a160>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d7f2340>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e217400>]}
[0m19:31:18.178065 [debug] [MainThread]: Flushing usage events
[0m19:31:20.415047 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m19:31:22.033036 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10823e160>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1092ea730>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1092ea550>]}


============================== 19:31:22.036923 | b681c8a7-b3f4-41ea-b625-4a93cae2ea4b ==============================
[0m19:31:22.036923 [info ] [MainThread]: Running with dbt=1.11.0-b3
[0m19:31:22.037430 [debug] [MainThread]: running dbt with arguments {'send_anonymous_usage_stats': 'True', 'invocation_command': 'dbt build --select tag:pipeline_c --profiles-dir . --project-dir .', 'cache_selected_only': 'False', 'profiles_dir': '.', 'log_cache_events': 'False', 'warn_error': 'None', 'version_check': 'True', 'log_path': 'logs', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'printer_width': '80', 'indirect_selection': 'eager', 'use_experimental_parser': 'False', 'partial_parse': 'True', 'fail_fast': 'False', 'no_print': 'None', 'empty': 'False', 'debug': 'False', 'write_json': 'True', 'quiet': 'False', 'use_colors': 'True', 'log_format': 'default', 'target_path': 'None', 'introspect': 'True', 'static_parser': 'True'}
[0m19:31:22.234188 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'b681c8a7-b3f4-41ea-b625-4a93cae2ea4b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109a22190>]}
[0m19:31:22.309380 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'b681c8a7-b3f4-41ea-b625-4a93cae2ea4b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1098a0c10>]}
[0m19:31:22.310290 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m19:31:22.413420 [debug] [MainThread]: checksum: e63134dccc1251cfb572caf0e4aa952f030c125ee3634f3bf2c0a2e1bb6ae349, vars: {}, profile: , target: , version: 1.11.0b3
[0m19:31:22.636553 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m19:31:22.636999 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m19:31:22.701922 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'b681c8a7-b3f4-41ea-b625-4a93cae2ea4b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a4c2130>]}
[0m19:31:22.827763 [debug] [MainThread]: Wrote artifact WritableManifest to ./target/manifest.json
[0m19:31:22.829668 [debug] [MainThread]: Wrote artifact SemanticManifest to ./target/semantic_manifest.json
[0m19:31:22.859087 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'b681c8a7-b3f4-41ea-b625-4a93cae2ea4b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a42b400>]}
[0m19:31:22.859624 [info ] [MainThread]: Found 28 models, 53 data tests, 10 seeds, 569 macros
[0m19:31:22.863492 [info ] [MainThread]: 
[0m19:31:22.863800 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m19:31:22.864055 [info ] [MainThread]: 
[0m19:31:22.864474 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m19:31:22.869653 [debug] [ThreadPool]: Acquiring new postgres connection 'list_bain_analytics'
[0m19:31:22.914085 [debug] [ThreadPool]: Using postgres connection "list_bain_analytics"
[0m19:31:22.914489 [debug] [ThreadPool]: On list_bain_analytics: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "connection_name": "list_bain_analytics"} */

    select distinct nspname from pg_namespace
  
[0m19:31:22.914756 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m19:31:22.945361 [debug] [ThreadPool]: SQL status: SELECT 5 in 0.031 seconds
[0m19:31:22.946622 [debug] [ThreadPool]: On list_bain_analytics: Close
[0m19:31:22.950169 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_bain_analytics, now list_bain_analytics_public_raw)
[0m19:31:22.950716 [debug] [ThreadPool]: Acquiring new postgres connection 'list_bain_analytics_public'
[0m19:31:22.956735 [debug] [ThreadPool]: Using postgres connection "list_bain_analytics_public_raw"
[0m19:31:22.958922 [debug] [ThreadPool]: Using postgres connection "list_bain_analytics_public"
[0m19:31:22.959250 [debug] [ThreadPool]: On list_bain_analytics_public_raw: BEGIN
[0m19:31:22.959522 [debug] [ThreadPool]: On list_bain_analytics_public: BEGIN
[0m19:31:22.959782 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:31:22.960029 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m19:31:22.971527 [debug] [ThreadPool]: SQL status: BEGIN in 0.012 seconds
[0m19:31:22.971866 [debug] [ThreadPool]: SQL status: BEGIN in 0.012 seconds
[0m19:31:22.972166 [debug] [ThreadPool]: Using postgres connection "list_bain_analytics_public_raw"
[0m19:31:22.972439 [debug] [ThreadPool]: Using postgres connection "list_bain_analytics_public"
[0m19:31:22.972730 [debug] [ThreadPool]: On list_bain_analytics_public_raw: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "connection_name": "list_bain_analytics_public_raw"} */
select
      'bain_analytics' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_raw'
    union all
    select
      'bain_analytics' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_raw'
    union all
    select
      'bain_analytics' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_raw'
  
[0m19:31:22.973022 [debug] [ThreadPool]: On list_bain_analytics_public: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "connection_name": "list_bain_analytics_public"} */
select
      'bain_analytics' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'bain_analytics' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'bain_analytics' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m19:31:22.976803 [debug] [ThreadPool]: SQL status: SELECT 15 in 0.003 seconds
[0m19:31:22.977118 [debug] [ThreadPool]: SQL status: SELECT 10 in 0.004 seconds
[0m19:31:22.978495 [debug] [ThreadPool]: On list_bain_analytics_public: ROLLBACK
[0m19:31:22.979617 [debug] [ThreadPool]: On list_bain_analytics_public_raw: ROLLBACK
[0m19:31:22.980234 [debug] [ThreadPool]: On list_bain_analytics_public_raw: Close
[0m19:31:22.980501 [debug] [ThreadPool]: On list_bain_analytics_public: Close
[0m19:31:22.990024 [debug] [MainThread]: Using postgres connection "master"
[0m19:31:22.990319 [debug] [MainThread]: On master: BEGIN
[0m19:31:22.990560 [debug] [MainThread]: Opening a new connection, currently in state init
[0m19:31:22.998567 [debug] [MainThread]: SQL status: BEGIN in 0.008 seconds
[0m19:31:22.999070 [debug] [MainThread]: Using postgres connection "master"
[0m19:31:22.999539 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "connection_name": "master"} */
select distinct
        dependent_namespace.nspname as dependent_schema,
        dependent_class.relname as dependent_name,
        referenced_namespace.nspname as referenced_schema,
        referenced_class.relname as referenced_name

    -- Query for views: views are entries in pg_class with an entry in pg_rewrite, but we avoid
    -- a seq scan on pg_rewrite by leveraging the fact there is an "internal" row in pg_depend for
    -- the view...
    from pg_class as dependent_class
    join pg_namespace as dependent_namespace on dependent_namespace.oid = dependent_class.relnamespace
    join pg_depend as dependent_depend on dependent_depend.refobjid = dependent_class.oid
        and dependent_depend.classid = 'pg_rewrite'::regclass
        and dependent_depend.refclassid = 'pg_class'::regclass
        and dependent_depend.deptype = 'i'

    -- ... and via pg_depend (that has a row per column, hence the need for "distinct" above, and
    -- making sure to exclude the internal row to avoid a view appearing to depend on itself)...
    join pg_depend as joining_depend on joining_depend.objid = dependent_depend.objid
        and joining_depend.classid = 'pg_rewrite'::regclass
        and joining_depend.refclassid = 'pg_class'::regclass
        and joining_depend.refobjid != dependent_depend.refobjid

    -- ... we can find the tables they query from in pg_class, but excluding system tables. Note we
    -- don't need need to exclude _dependent_ system tables, because they only query from other
    -- system tables, and so are automatically excluded by excluding _referenced_ system tables
    join pg_class as referenced_class on referenced_class.oid = joining_depend.refobjid
    join pg_namespace as referenced_namespace on referenced_namespace.oid = referenced_class.relnamespace
        and referenced_namespace.nspname != 'information_schema'
        and referenced_namespace.nspname not like 'pg\_%'

    order by
        dependent_schema, dependent_name, referenced_schema, referenced_name;
[0m19:31:23.003758 [debug] [MainThread]: SQL status: SELECT 30 in 0.004 seconds
[0m19:31:23.008963 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b681c8a7-b3f4-41ea-b625-4a93cae2ea4b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a60f6d0>]}
[0m19:31:23.009388 [debug] [MainThread]: On master: ROLLBACK
[0m19:31:23.009961 [debug] [MainThread]: Using postgres connection "master"
[0m19:31:23.010241 [debug] [MainThread]: On master: BEGIN
[0m19:31:23.010995 [debug] [MainThread]: SQL status: BEGIN in 0.001 seconds
[0m19:31:23.011257 [debug] [MainThread]: On master: COMMIT
[0m19:31:23.011514 [debug] [MainThread]: Using postgres connection "master"
[0m19:31:23.011751 [debug] [MainThread]: On master: COMMIT
[0m19:31:23.012230 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m19:31:23.012517 [debug] [MainThread]: On master: Close
[0m19:31:23.014672 [debug] [Thread-1  ]: Began running node model.bain_capital_analytics.stg_benchmarks
[0m19:31:23.015133 [debug] [Thread-2  ]: Began running node model.bain_capital_analytics.stg_cashflows
[0m19:31:23.015613 [info ] [Thread-1  ]: 1 of 57 START sql view model public.stg_benchmarks ............................. [RUN]
[0m19:31:23.015993 [debug] [Thread-3  ]: Began running node model.bain_capital_analytics.stg_dates
[0m19:31:23.016409 [info ] [Thread-2  ]: 2 of 57 START sql view model public.stg_cashflows .............................. [RUN]
[0m19:31:23.016767 [debug] [Thread-4  ]: Began running node model.bain_capital_analytics.stg_fund_structures
[0m19:31:23.017134 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_bain_analytics_public_raw, now model.bain_capital_analytics.stg_benchmarks)
[0m19:31:23.017539 [info ] [Thread-3  ]: 3 of 57 START sql view model public.stg_dates .................................. [RUN]
[0m19:31:23.017889 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly list_bain_analytics_public, now model.bain_capital_analytics.stg_cashflows)
[0m19:31:23.018264 [info ] [Thread-4  ]: 4 of 57 START sql view model public.stg_fund_structures ........................ [RUN]
[0m19:31:23.018582 [debug] [Thread-1  ]: Began compiling node model.bain_capital_analytics.stg_benchmarks
[0m19:31:23.018962 [debug] [Thread-3  ]: Acquiring new postgres connection 'model.bain_capital_analytics.stg_dates'
[0m19:31:23.019251 [debug] [Thread-2  ]: Began compiling node model.bain_capital_analytics.stg_cashflows
[0m19:31:23.019607 [debug] [Thread-4  ]: Acquiring new postgres connection 'model.bain_capital_analytics.stg_fund_structures'
[0m19:31:23.028486 [debug] [Thread-1  ]: Writing injected SQL for node "model.bain_capital_analytics.stg_benchmarks"
[0m19:31:23.028801 [debug] [Thread-3  ]: Began compiling node model.bain_capital_analytics.stg_dates
[0m19:31:23.031565 [debug] [Thread-2  ]: Writing injected SQL for node "model.bain_capital_analytics.stg_cashflows"
[0m19:31:23.031926 [debug] [Thread-4  ]: Began compiling node model.bain_capital_analytics.stg_fund_structures
[0m19:31:23.034572 [debug] [Thread-3  ]: Writing injected SQL for node "model.bain_capital_analytics.stg_dates"
[0m19:31:23.037346 [debug] [Thread-4  ]: Writing injected SQL for node "model.bain_capital_analytics.stg_fund_structures"
[0m19:31:23.038027 [debug] [Thread-3  ]: Began executing node model.bain_capital_analytics.stg_dates
[0m19:31:23.038360 [debug] [Thread-2  ]: Began executing node model.bain_capital_analytics.stg_cashflows
[0m19:31:23.038662 [debug] [Thread-4  ]: Began executing node model.bain_capital_analytics.stg_fund_structures
[0m19:31:23.038939 [debug] [Thread-1  ]: Began executing node model.bain_capital_analytics.stg_benchmarks
[0m19:31:23.084986 [debug] [Thread-2  ]: Writing runtime sql for node "model.bain_capital_analytics.stg_cashflows"
[0m19:31:23.085994 [debug] [Thread-3  ]: Writing runtime sql for node "model.bain_capital_analytics.stg_dates"
[0m19:31:23.086924 [debug] [Thread-4  ]: Writing runtime sql for node "model.bain_capital_analytics.stg_fund_structures"
[0m19:31:23.090335 [debug] [Thread-1  ]: Writing runtime sql for node "model.bain_capital_analytics.stg_benchmarks"
[0m19:31:23.091131 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.stg_dates"
[0m19:31:23.091528 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.stg_fund_structures"
[0m19:31:23.091890 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.stg_cashflows"
[0m19:31:23.092188 [debug] [Thread-3  ]: On model.bain_capital_analytics.stg_dates: BEGIN
[0m19:31:23.092530 [debug] [Thread-4  ]: On model.bain_capital_analytics.stg_fund_structures: BEGIN
[0m19:31:23.092886 [debug] [Thread-2  ]: On model.bain_capital_analytics.stg_cashflows: BEGIN
[0m19:31:23.093237 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.stg_benchmarks"
[0m19:31:23.093533 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m19:31:23.093834 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m19:31:23.094118 [debug] [Thread-2  ]: Opening a new connection, currently in state closed
[0m19:31:23.094404 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_benchmarks: BEGIN
[0m19:31:23.095019 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m19:31:23.111774 [debug] [Thread-1  ]: SQL status: BEGIN in 0.017 seconds
[0m19:31:23.112116 [debug] [Thread-2  ]: SQL status: BEGIN in 0.018 seconds
[0m19:31:23.112413 [debug] [Thread-3  ]: SQL status: BEGIN in 0.019 seconds
[0m19:31:23.112694 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.stg_benchmarks"
[0m19:31:23.112968 [debug] [Thread-4  ]: SQL status: BEGIN in 0.019 seconds
[0m19:31:23.113270 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.stg_cashflows"
[0m19:31:23.113552 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.stg_dates"
[0m19:31:23.113876 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_benchmarks: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_benchmarks"} */

  create view "bain_analytics"."public"."stg_benchmarks__dbt_tmp"
    
    
  as (
    select distinct
    benchmark_id,
    benchmark_name,
    cast(benchmark_date as date) as benchmark_date,
    cast(return_daily as numeric(18,8)) as return_daily,
    cast(return_mtd as numeric(18,8)) as return_mtd,
    cast(return_ytd as numeric(18,8)) as return_ytd,
    cast(benchmark_level as numeric(18,4)) as benchmark_level,
    -- Anti-pattern: duplicated fiscal quarter logic
    case
        when extract(month from cast(benchmark_date as date)) between 1 and 3 then 'Q3'
        when extract(month from cast(benchmark_date as date)) between 4 and 6 then 'Q4'
        when extract(month from cast(benchmark_date as date)) between 7 and 9 then 'Q1'
        when extract(month from cast(benchmark_date as date)) between 10 and 12 then 'Q2'
    end as benchmark_fiscal_quarter
from "bain_analytics"."public_raw"."raw_benchmarks"
  );
[0m19:31:23.114196 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.stg_fund_structures"
[0m19:31:23.114517 [debug] [Thread-2  ]: On model.bain_capital_analytics.stg_cashflows: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_cashflows"} */

  create view "bain_analytics"."public"."stg_cashflows__dbt_tmp"
    
    
  as (
    -- Anti-pattern: unnecessary DISTINCT
-- Anti-pattern: duplicated fiscal quarter logic
select distinct
    cashflow_id,
    fund_id,
    portfolio_id,
    cast(cashflow_date as date) as cashflow_date,
    cashflow_type,
    cast(amount as numeric(18,2)) as amount,
    currency,
    description,
    investor_id,
    -- Anti-pattern: duplicated fiscal quarter logic (same as stg_trades, stg_portfolios)
    case
        when extract(month from cast(cashflow_date as date)) between 1 and 3 then 'Q3'
        when extract(month from cast(cashflow_date as date)) between 4 and 6 then 'Q4'
        when extract(month from cast(cashflow_date as date)) between 7 and 9 then 'Q1'
        when extract(month from cast(cashflow_date as date)) between 10 and 12 then 'Q2'
    end as cashflow_fiscal_quarter,
    -- Anti-pattern: PostgreSQL-specific extract
    extract(year from cast(cashflow_date as date)) as cashflow_year
from "bain_analytics"."public_raw"."raw_cashflows"
  );
[0m19:31:23.114876 [debug] [Thread-3  ]: On model.bain_capital_analytics.stg_dates: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_dates"} */

  create view "bain_analytics"."public"."stg_dates__dbt_tmp"
    
    
  as (
    select
    cast(date_day as date) as date_day,
    cast(is_business_day as boolean) as is_business_day,
    cast(is_month_end as boolean) as is_month_end,
    cast(is_quarter_end as boolean) as is_quarter_end,
    cast(is_year_end as boolean) as is_year_end,
    fiscal_quarter,
    fiscal_year,
    -- Anti-pattern: PostgreSQL-specific date_trunc
    date_trunc('month', cast(date_day as date)) as month_start,
    date_trunc('quarter', cast(date_day as date)) as quarter_start,
    extract(month from cast(date_day as date)) as calendar_month,
    extract(year from cast(date_day as date)) as calendar_year
from "bain_analytics"."public_raw"."raw_dates"
  );
[0m19:31:23.115266 [debug] [Thread-4  ]: On model.bain_capital_analytics.stg_fund_structures: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_fund_structures"} */

  create view "bain_analytics"."public"."stg_fund_structures__dbt_tmp"
    
    
  as (
    select distinct
    fund_id,
    fund_name,
    fund_type,
    cast(vintage_year as integer) as vintage_year,
    cast(committed_capital as numeric(18,2)) as committed_capital,
    cast(management_fee_rate as numeric(8,4)) as management_fee_rate,
    cast(carry_rate as numeric(8,4)) as carry_rate,
    cast(hurdle_rate as numeric(8,4)) as hurdle_rate,
    cast(gp_commitment_pct as numeric(8,4)) as gp_commitment_pct,
    fund_currency,
    fund_status
from "bain_analytics"."public_raw"."raw_fund_structures"
  );
[0m19:31:23.118431 [debug] [Thread-3  ]: SQL status: CREATE VIEW in 0.003 seconds
[0m19:31:23.124333 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.stg_dates"
[0m19:31:23.124683 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.009 seconds
[0m19:31:23.125005 [debug] [Thread-2  ]: SQL status: CREATE VIEW in 0.009 seconds
[0m19:31:23.125299 [debug] [Thread-4  ]: SQL status: CREATE VIEW in 0.010 seconds
[0m19:31:23.125594 [debug] [Thread-3  ]: On model.bain_capital_analytics.stg_dates: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_dates"} */
alter table "bain_analytics"."public"."stg_dates" rename to "stg_dates__dbt_backup"
[0m19:31:23.128673 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.stg_benchmarks"
[0m19:31:23.132229 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.stg_cashflows"
[0m19:31:23.135188 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.stg_fund_structures"
[0m19:31:23.135552 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_benchmarks: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_benchmarks"} */
alter table "bain_analytics"."public"."stg_benchmarks" rename to "stg_benchmarks__dbt_backup"
[0m19:31:23.135869 [debug] [Thread-2  ]: On model.bain_capital_analytics.stg_cashflows: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_cashflows"} */
alter table "bain_analytics"."public"."stg_cashflows" rename to "stg_cashflows__dbt_backup"
[0m19:31:23.136175 [debug] [Thread-4  ]: On model.bain_capital_analytics.stg_fund_structures: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_fund_structures"} */
alter table "bain_analytics"."public"."stg_fund_structures" rename to "stg_fund_structures__dbt_backup"
[0m19:31:23.136809 [debug] [Thread-3  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m19:31:23.139347 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.stg_dates"
[0m19:31:23.139654 [debug] [Thread-2  ]: SQL status: ALTER TABLE in 0.003 seconds
[0m19:31:23.139945 [debug] [Thread-4  ]: SQL status: ALTER TABLE in 0.003 seconds
[0m19:31:23.140219 [debug] [Thread-3  ]: On model.bain_capital_analytics.stg_dates: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_dates"} */
alter table "bain_analytics"."public"."stg_dates__dbt_tmp" rename to "stg_dates"
[0m19:31:23.140494 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.004 seconds
[0m19:31:23.143089 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.stg_cashflows"
[0m19:31:23.145637 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.stg_fund_structures"
[0m19:31:23.148801 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.stg_benchmarks"
[0m19:31:23.149183 [debug] [Thread-2  ]: On model.bain_capital_analytics.stg_cashflows: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_cashflows"} */
alter table "bain_analytics"."public"."stg_cashflows__dbt_tmp" rename to "stg_cashflows"
[0m19:31:23.149484 [debug] [Thread-3  ]: SQL status: ALTER TABLE in 0.004 seconds
[0m19:31:23.149790 [debug] [Thread-4  ]: On model.bain_capital_analytics.stg_fund_structures: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_fund_structures"} */
alter table "bain_analytics"."public"."stg_fund_structures__dbt_tmp" rename to "stg_fund_structures"
[0m19:31:23.150099 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_benchmarks: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_benchmarks"} */
alter table "bain_analytics"."public"."stg_benchmarks__dbt_tmp" rename to "stg_benchmarks"
[0m19:31:23.156727 [debug] [Thread-2  ]: SQL status: ALTER TABLE in 0.006 seconds
[0m19:31:23.205375 [debug] [Thread-3  ]: On model.bain_capital_analytics.stg_dates: COMMIT
[0m19:31:23.206818 [debug] [Thread-2  ]: On model.bain_capital_analytics.stg_cashflows: COMMIT
[0m19:31:23.207188 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.stg_dates"
[0m19:31:23.207493 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.stg_cashflows"
[0m19:31:23.207787 [debug] [Thread-3  ]: On model.bain_capital_analytics.stg_dates: COMMIT
[0m19:31:23.208120 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.002 seconds
[0m19:31:23.208435 [debug] [Thread-4  ]: SQL status: ALTER TABLE in 0.003 seconds
[0m19:31:23.208729 [debug] [Thread-2  ]: On model.bain_capital_analytics.stg_cashflows: COMMIT
[0m19:31:23.209800 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_benchmarks: COMMIT
[0m19:31:23.210801 [debug] [Thread-4  ]: On model.bain_capital_analytics.stg_fund_structures: COMMIT
[0m19:31:23.211140 [debug] [Thread-3  ]: SQL status: COMMIT in 0.002 seconds
[0m19:31:23.211456 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.stg_benchmarks"
[0m19:31:23.211761 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.stg_fund_structures"
[0m19:31:23.217929 [debug] [Thread-2  ]: SQL status: COMMIT in 0.007 seconds
[0m19:31:23.218318 [debug] [Thread-3  ]: Applying DROP to: "bain_analytics"."public"."stg_dates__dbt_backup"
[0m19:31:23.218616 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_benchmarks: COMMIT
[0m19:31:23.218986 [debug] [Thread-4  ]: On model.bain_capital_analytics.stg_fund_structures: COMMIT
[0m19:31:23.221277 [debug] [Thread-2  ]: Applying DROP to: "bain_analytics"."public"."stg_cashflows__dbt_backup"
[0m19:31:23.224927 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.stg_dates"
[0m19:31:23.225505 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.stg_cashflows"
[0m19:31:23.225818 [debug] [Thread-3  ]: On model.bain_capital_analytics.stg_dates: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_dates"} */
drop view if exists "bain_analytics"."public"."stg_dates__dbt_backup" cascade
[0m19:31:23.226127 [debug] [Thread-2  ]: On model.bain_capital_analytics.stg_cashflows: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_cashflows"} */
drop view if exists "bain_analytics"."public"."stg_cashflows__dbt_backup" cascade
[0m19:31:23.226786 [debug] [Thread-4  ]: SQL status: COMMIT in 0.001 seconds
[0m19:31:23.229074 [debug] [Thread-4  ]: Applying DROP to: "bain_analytics"."public"."stg_fund_structures__dbt_backup"
[0m19:31:23.229387 [debug] [Thread-1  ]: SQL status: COMMIT in 0.004 seconds
[0m19:31:23.229827 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.stg_fund_structures"
[0m19:31:23.230131 [debug] [Thread-2  ]: SQL status: DROP VIEW in 0.004 seconds
[0m19:31:23.232464 [debug] [Thread-1  ]: Applying DROP to: "bain_analytics"."public"."stg_benchmarks__dbt_backup"
[0m19:31:23.232813 [debug] [Thread-4  ]: On model.bain_capital_analytics.stg_fund_structures: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_fund_structures"} */
drop view if exists "bain_analytics"."public"."stg_fund_structures__dbt_backup" cascade
[0m19:31:23.235138 [debug] [Thread-2  ]: On model.bain_capital_analytics.stg_cashflows: Close
[0m19:31:23.235468 [debug] [Thread-3  ]: SQL status: DROP VIEW in 0.009 seconds
[0m19:31:23.235924 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.stg_benchmarks"
[0m19:31:23.237604 [debug] [Thread-3  ]: On model.bain_capital_analytics.stg_dates: Close
[0m19:31:23.238437 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_benchmarks: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_benchmarks"} */
drop view if exists "bain_analytics"."public"."stg_benchmarks__dbt_backup" cascade
[0m19:31:23.238784 [debug] [Thread-4  ]: SQL status: DROP VIEW in 0.003 seconds
[0m19:31:23.240122 [debug] [Thread-4  ]: On model.bain_capital_analytics.stg_fund_structures: Close
[0m19:31:23.240443 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b681c8a7-b3f4-41ea-b625-4a93cae2ea4b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ab4cdc0>]}
[0m19:31:23.240737 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b681c8a7-b3f4-41ea-b625-4a93cae2ea4b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10abda850>]}
[0m19:31:23.241179 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b681c8a7-b3f4-41ea-b625-4a93cae2ea4b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10aa88fa0>]}
[0m19:31:23.241746 [info ] [Thread-2  ]: 2 of 57 OK created sql view model public.stg_cashflows ......................... [[32mCREATE VIEW[0m in 0.22s]
[0m19:31:23.242072 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.003 seconds
[0m19:31:23.242527 [info ] [Thread-3  ]: 3 of 57 OK created sql view model public.stg_dates ............................. [[32mCREATE VIEW[0m in 0.22s]
[0m19:31:23.242998 [info ] [Thread-4  ]: 4 of 57 OK created sql view model public.stg_fund_structures ................... [[32mCREATE VIEW[0m in 0.22s]
[0m19:31:23.243462 [debug] [Thread-2  ]: Finished running node model.bain_capital_analytics.stg_cashflows
[0m19:31:23.244427 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_benchmarks: Close
[0m19:31:23.244847 [debug] [Thread-3  ]: Finished running node model.bain_capital_analytics.stg_dates
[0m19:31:23.245252 [debug] [Thread-4  ]: Finished running node model.bain_capital_analytics.stg_fund_structures
[0m19:31:23.245595 [debug] [Thread-2  ]: Began running node model.bain_capital_analytics.stg_instruments
[0m19:31:23.246245 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b681c8a7-b3f4-41ea-b625-4a93cae2ea4b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ac2d670>]}
[0m19:31:23.246574 [debug] [Thread-3  ]: Began running node model.bain_capital_analytics.stg_portfolios
[0m19:31:23.246936 [debug] [Thread-4  ]: Began running node model.bain_capital_analytics.stg_positions
[0m19:31:23.247459 [info ] [Thread-2  ]: 5 of 57 START sql view model public.stg_instruments ............................ [RUN]
[0m19:31:23.248055 [info ] [Thread-1  ]: 1 of 57 OK created sql view model public.stg_benchmarks ........................ [[32mCREATE VIEW[0m in 0.23s]
[0m19:31:23.248447 [info ] [Thread-3  ]: 6 of 57 START sql view model public.stg_portfolios ............................. [RUN]
[0m19:31:23.248844 [info ] [Thread-4  ]: 7 of 57 START sql view model public.stg_positions .............................. [RUN]
[0m19:31:23.249378 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly model.bain_capital_analytics.stg_cashflows, now model.bain_capital_analytics.stg_instruments)
[0m19:31:23.249808 [debug] [Thread-1  ]: Finished running node model.bain_capital_analytics.stg_benchmarks
[0m19:31:23.250126 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly model.bain_capital_analytics.stg_dates, now model.bain_capital_analytics.stg_portfolios)
[0m19:31:23.250440 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly model.bain_capital_analytics.stg_fund_structures, now model.bain_capital_analytics.stg_positions)
[0m19:31:23.250747 [debug] [Thread-2  ]: Began compiling node model.bain_capital_analytics.stg_instruments
[0m19:31:23.251065 [debug] [Thread-1  ]: Began running node model.bain_capital_analytics.stg_valuations
[0m19:31:23.251415 [debug] [Thread-3  ]: Began compiling node model.bain_capital_analytics.stg_portfolios
[0m19:31:23.251798 [debug] [Thread-4  ]: Began compiling node model.bain_capital_analytics.stg_positions
[0m19:31:23.256124 [debug] [Thread-2  ]: Writing injected SQL for node "model.bain_capital_analytics.stg_instruments"
[0m19:31:23.256539 [info ] [Thread-1  ]: 8 of 57 START sql view model public.stg_valuations ............................. [RUN]
[0m19:31:23.259138 [debug] [Thread-3  ]: Writing injected SQL for node "model.bain_capital_analytics.stg_portfolios"
[0m19:31:23.261588 [debug] [Thread-4  ]: Writing injected SQL for node "model.bain_capital_analytics.stg_positions"
[0m19:31:23.262031 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.bain_capital_analytics.stg_benchmarks, now model.bain_capital_analytics.stg_valuations)
[0m19:31:23.262520 [debug] [Thread-1  ]: Began compiling node model.bain_capital_analytics.stg_valuations
[0m19:31:23.265088 [debug] [Thread-1  ]: Writing injected SQL for node "model.bain_capital_analytics.stg_valuations"
[0m19:31:23.265566 [debug] [Thread-2  ]: Began executing node model.bain_capital_analytics.stg_instruments
[0m19:31:23.265944 [debug] [Thread-4  ]: Began executing node model.bain_capital_analytics.stg_positions
[0m19:31:23.266253 [debug] [Thread-3  ]: Began executing node model.bain_capital_analytics.stg_portfolios
[0m19:31:23.269602 [debug] [Thread-2  ]: Writing runtime sql for node "model.bain_capital_analytics.stg_instruments"
[0m19:31:23.272900 [debug] [Thread-4  ]: Writing runtime sql for node "model.bain_capital_analytics.stg_positions"
[0m19:31:23.273214 [debug] [Thread-1  ]: Began executing node model.bain_capital_analytics.stg_valuations
[0m19:31:23.277264 [debug] [Thread-3  ]: Writing runtime sql for node "model.bain_capital_analytics.stg_portfolios"
[0m19:31:23.280570 [debug] [Thread-1  ]: Writing runtime sql for node "model.bain_capital_analytics.stg_valuations"
[0m19:31:23.281041 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.stg_instruments"
[0m19:31:23.281433 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.stg_positions"
[0m19:31:23.281729 [debug] [Thread-2  ]: On model.bain_capital_analytics.stg_instruments: BEGIN
[0m19:31:23.282095 [debug] [Thread-4  ]: On model.bain_capital_analytics.stg_positions: BEGIN
[0m19:31:23.282446 [debug] [Thread-2  ]: Opening a new connection, currently in state closed
[0m19:31:23.282767 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.stg_valuations"
[0m19:31:23.283077 [debug] [Thread-4  ]: Opening a new connection, currently in state closed
[0m19:31:23.283395 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.stg_portfolios"
[0m19:31:23.283819 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_valuations: BEGIN
[0m19:31:23.284211 [debug] [Thread-3  ]: On model.bain_capital_analytics.stg_portfolios: BEGIN
[0m19:31:23.284509 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m19:31:23.284840 [debug] [Thread-3  ]: Opening a new connection, currently in state closed
[0m19:31:23.300936 [debug] [Thread-2  ]: SQL status: BEGIN in 0.018 seconds
[0m19:31:23.301280 [debug] [Thread-4  ]: SQL status: BEGIN in 0.018 seconds
[0m19:31:23.301570 [debug] [Thread-1  ]: SQL status: BEGIN in 0.017 seconds
[0m19:31:23.301849 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.stg_instruments"
[0m19:31:23.302120 [debug] [Thread-3  ]: SQL status: BEGIN in 0.017 seconds
[0m19:31:23.302406 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.stg_positions"
[0m19:31:23.302693 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.stg_valuations"
[0m19:31:23.303019 [debug] [Thread-2  ]: On model.bain_capital_analytics.stg_instruments: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_instruments"} */

  create view "bain_analytics"."public"."stg_instruments__dbt_tmp"
    
    
  as (
    -- Anti-pattern: unnecessary DISTINCT
select distinct
    instrument_id,
    instrument_name,
    instrument_type,
    sector,
    currency,
    exchange,
    issuer,
    cast(maturity_date as date) as maturity_date,
    -- Anti-pattern: PostgreSQL-specific date subtraction
    case
        when maturity_date is not null
        then cast(maturity_date as date) - current_date
        else null
    end as days_to_maturity,
    case
        when instrument_type in ('equity', 'futures') then 'liquid'
        when instrument_type in ('corporate_bond', 'government_bond', 'sovereign_bond', 'leveraged_loan') then 'semi_liquid'
        when instrument_type in ('private_equity', 'venture_capital', 'real_estate', 'real_estate_debt', 'infrastructure') then 'illiquid'
        else 'other'
    end as liquidity_class
from "bain_analytics"."public_raw"."raw_instruments"
  );
[0m19:31:23.303342 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.stg_portfolios"
[0m19:31:23.303657 [debug] [Thread-4  ]: On model.bain_capital_analytics.stg_positions: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_positions"} */

  create view "bain_analytics"."public"."stg_positions__dbt_tmp"
    
    
  as (
    -- Anti-pattern: unnecessary DISTINCT
-- Anti-pattern: no filtering or partitioning strategy

select distinct
    position_id,
    portfolio_id,
    instrument_id,
    cast(position_date as date) as position_date,
    cast(quantity as numeric(18,4)) as quantity,
    cast(market_value as numeric(18,2)) as market_value,
    cast(cost_basis as numeric(18,2)) as cost_basis,
    currency,
    -- Anti-pattern: computed column that could be done downstream
    cast(market_value as numeric(18,2)) - cast(cost_basis as numeric(18,2)) as unrealized_gain_loss,
    case
        when cast(cost_basis as numeric(18,2)) != 0
        then (cast(market_value as numeric(18,2)) - cast(cost_basis as numeric(18,2))) / abs(cast(cost_basis as numeric(18,2)))
        else 0
    end as unrealized_return_pct
from "bain_analytics"."public_raw"."raw_positions"
  );
[0m19:31:23.304007 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_valuations: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_valuations"} */

  create view "bain_analytics"."public"."stg_valuations__dbt_tmp"
    
    
  as (
    -- Anti-pattern: unnecessary DISTINCT
select distinct
    valuation_id,
    portfolio_id,
    cast(valuation_date as date) as valuation_date,
    cast(gross_asset_value as numeric(18,2)) as gross_asset_value,
    cast(net_asset_value as numeric(18,2)) as net_asset_value,
    cast(total_liabilities as numeric(18,2)) as total_liabilities,
    cast(unrealized_pnl as numeric(18,2)) as unrealized_pnl,
    cast(realized_pnl as numeric(18,2)) as realized_pnl,
    valuation_method,
    -- Anti-pattern: duplicated fiscal quarter logic
    case
        when extract(month from cast(valuation_date as date)) between 1 and 3 then 'Q3'
        when extract(month from cast(valuation_date as date)) between 4 and 6 then 'Q4'
        when extract(month from cast(valuation_date as date)) between 7 and 9 then 'Q1'
        when extract(month from cast(valuation_date as date)) between 10 and 12 then 'Q2'
    end as valuation_fiscal_quarter
from "bain_analytics"."public_raw"."raw_valuations"
  );
[0m19:31:23.304413 [debug] [Thread-3  ]: On model.bain_capital_analytics.stg_portfolios: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_portfolios"} */

  create view "bain_analytics"."public"."stg_portfolios__dbt_tmp"
    
    
  as (
    -- Anti-pattern: unnecessary DISTINCT when source data is already unique
-- Anti-pattern: casting in every model instead of once upstream

select distinct
    cast(portfolio_id as varchar(10)) as portfolio_id,
    cast(portfolio_name as varchar(100)) as portfolio_name,
    cast(strategy as varchar(50)) as strategy,
    cast(inception_date as date) as inception_date,
    cast(fund_id as varchar(10)) as fund_id,
    cast(manager_name as varchar(100)) as manager_name,
    cast(is_active as boolean) as is_active,
    -- Anti-pattern: duplicated fiscal quarter logic (repeated in many models)
    case
        when extract(month from cast(inception_date as date)) between 1 and 3 then 'Q3'
        when extract(month from cast(inception_date as date)) between 4 and 6 then 'Q4'
        when extract(month from cast(inception_date as date)) between 7 and 9 then 'Q1'
        when extract(month from cast(inception_date as date)) between 10 and 12 then 'Q2'
    end as inception_fiscal_quarter
from "bain_analytics"."public_raw"."raw_portfolios"
where cast(is_active as boolean) = true
  );
[0m19:31:23.310258 [debug] [Thread-2  ]: SQL status: CREATE VIEW in 0.006 seconds
[0m19:31:23.313619 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.stg_instruments"
[0m19:31:23.313940 [debug] [Thread-4  ]: SQL status: CREATE VIEW in 0.009 seconds
[0m19:31:23.314230 [debug] [Thread-3  ]: SQL status: CREATE VIEW in 0.009 seconds
[0m19:31:23.314497 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.010 seconds
[0m19:31:23.314781 [debug] [Thread-2  ]: On model.bain_capital_analytics.stg_instruments: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_instruments"} */
alter table "bain_analytics"."public"."stg_instruments" rename to "stg_instruments__dbt_backup"
[0m19:31:23.317828 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.stg_positions"
[0m19:31:23.320784 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.stg_portfolios"
[0m19:31:23.324346 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.stg_valuations"
[0m19:31:23.324700 [debug] [Thread-4  ]: On model.bain_capital_analytics.stg_positions: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_positions"} */
alter table "bain_analytics"."public"."stg_positions" rename to "stg_positions__dbt_backup"
[0m19:31:23.325011 [debug] [Thread-3  ]: On model.bain_capital_analytics.stg_portfolios: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_portfolios"} */
alter table "bain_analytics"."public"."stg_portfolios" rename to "stg_portfolios__dbt_backup"
[0m19:31:23.325318 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_valuations: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_valuations"} */
alter table "bain_analytics"."public"."stg_valuations" rename to "stg_valuations__dbt_backup"
[0m19:31:23.325665 [debug] [Thread-2  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m19:31:23.328517 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.stg_instruments"
[0m19:31:23.328849 [debug] [Thread-4  ]: SQL status: ALTER TABLE in 0.003 seconds
[0m19:31:23.329147 [debug] [Thread-3  ]: SQL status: ALTER TABLE in 0.003 seconds
[0m19:31:23.329429 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.003 seconds
[0m19:31:23.329730 [debug] [Thread-2  ]: On model.bain_capital_analytics.stg_instruments: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_instruments"} */
alter table "bain_analytics"."public"."stg_instruments__dbt_tmp" rename to "stg_instruments"
[0m19:31:23.332539 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.stg_positions"
[0m19:31:23.335204 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.stg_portfolios"
[0m19:31:23.337746 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.stg_valuations"
[0m19:31:23.338103 [debug] [Thread-4  ]: On model.bain_capital_analytics.stg_positions: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_positions"} */
alter table "bain_analytics"."public"."stg_positions__dbt_tmp" rename to "stg_positions"
[0m19:31:23.338413 [debug] [Thread-3  ]: On model.bain_capital_analytics.stg_portfolios: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_portfolios"} */
alter table "bain_analytics"."public"."stg_portfolios__dbt_tmp" rename to "stg_portfolios"
[0m19:31:23.338708 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_valuations: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_valuations"} */
alter table "bain_analytics"."public"."stg_valuations__dbt_tmp" rename to "stg_valuations"
[0m19:31:23.339081 [debug] [Thread-2  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m19:31:23.340137 [debug] [Thread-2  ]: On model.bain_capital_analytics.stg_instruments: COMMIT
[0m19:31:23.340450 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.stg_instruments"
[0m19:31:23.340743 [debug] [Thread-2  ]: On model.bain_capital_analytics.stg_instruments: COMMIT
[0m19:31:23.341028 [debug] [Thread-4  ]: SQL status: ALTER TABLE in 0.002 seconds
[0m19:31:23.341339 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.002 seconds
[0m19:31:23.341641 [debug] [Thread-3  ]: SQL status: ALTER TABLE in 0.003 seconds
[0m19:31:23.342679 [debug] [Thread-4  ]: On model.bain_capital_analytics.stg_positions: COMMIT
[0m19:31:23.343645 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_valuations: COMMIT
[0m19:31:23.343961 [debug] [Thread-2  ]: SQL status: COMMIT in 0.003 seconds
[0m19:31:23.345002 [debug] [Thread-3  ]: On model.bain_capital_analytics.stg_portfolios: COMMIT
[0m19:31:23.345321 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.stg_positions"
[0m19:31:23.345623 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.stg_valuations"
[0m19:31:23.347955 [debug] [Thread-2  ]: Applying DROP to: "bain_analytics"."public"."stg_instruments__dbt_backup"
[0m19:31:23.348272 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.stg_portfolios"
[0m19:31:23.348562 [debug] [Thread-4  ]: On model.bain_capital_analytics.stg_positions: COMMIT
[0m19:31:23.348848 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_valuations: COMMIT
[0m19:31:23.349349 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.stg_instruments"
[0m19:31:23.349668 [debug] [Thread-3  ]: On model.bain_capital_analytics.stg_portfolios: COMMIT
[0m19:31:23.350050 [debug] [Thread-2  ]: On model.bain_capital_analytics.stg_instruments: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_instruments"} */
drop view if exists "bain_analytics"."public"."stg_instruments__dbt_backup" cascade
[0m19:31:23.351150 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m19:31:23.351458 [debug] [Thread-4  ]: SQL status: COMMIT in 0.001 seconds
[0m19:31:23.351736 [debug] [Thread-3  ]: SQL status: COMMIT in 0.001 seconds
[0m19:31:23.354744 [debug] [Thread-1  ]: Applying DROP to: "bain_analytics"."public"."stg_valuations__dbt_backup"
[0m19:31:23.355051 [debug] [Thread-2  ]: SQL status: DROP VIEW in 0.005 seconds
[0m19:31:23.357217 [debug] [Thread-4  ]: Applying DROP to: "bain_analytics"."public"."stg_positions__dbt_backup"
[0m19:31:23.359385 [debug] [Thread-3  ]: Applying DROP to: "bain_analytics"."public"."stg_portfolios__dbt_backup"
[0m19:31:23.359843 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.stg_valuations"
[0m19:31:23.360881 [debug] [Thread-2  ]: On model.bain_capital_analytics.stg_instruments: Close
[0m19:31:23.361363 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.stg_positions"
[0m19:31:23.361819 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.stg_portfolios"
[0m19:31:23.362129 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_valuations: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_valuations"} */
drop view if exists "bain_analytics"."public"."stg_valuations__dbt_backup" cascade
[0m19:31:23.362466 [debug] [Thread-4  ]: On model.bain_capital_analytics.stg_positions: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_positions"} */
drop view if exists "bain_analytics"."public"."stg_positions__dbt_backup" cascade
[0m19:31:23.362945 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b681c8a7-b3f4-41ea-b625-4a93cae2ea4b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107cca430>]}
[0m19:31:23.363264 [debug] [Thread-3  ]: On model.bain_capital_analytics.stg_portfolios: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_portfolios"} */
drop view if exists "bain_analytics"."public"."stg_portfolios__dbt_backup" cascade
[0m19:31:23.363859 [info ] [Thread-2  ]: 5 of 57 OK created sql view model public.stg_instruments ....................... [[32mCREATE VIEW[0m in 0.11s]
[0m19:31:23.364350 [debug] [Thread-2  ]: Finished running node model.bain_capital_analytics.stg_instruments
[0m19:31:23.364689 [debug] [Thread-2  ]: Began running node test.bain_capital_analytics.not_null_stg_cashflows_cashflow_id.4176024898
[0m19:31:23.365087 [info ] [Thread-2  ]: 9 of 57 START test not_null_stg_cashflows_cashflow_id .......................... [RUN]
[0m19:31:23.365530 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly model.bain_capital_analytics.stg_instruments, now test.bain_capital_analytics.not_null_stg_cashflows_cashflow_id.4176024898)
[0m19:31:23.365939 [debug] [Thread-2  ]: Began compiling node test.bain_capital_analytics.not_null_stg_cashflows_cashflow_id.4176024898
[0m19:31:23.366265 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.003 seconds
[0m19:31:23.372720 [debug] [Thread-3  ]: SQL status: DROP VIEW in 0.009 seconds
[0m19:31:23.373751 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_valuations: Close
[0m19:31:23.374038 [debug] [Thread-4  ]: SQL status: DROP VIEW in 0.010 seconds
[0m19:31:23.378290 [debug] [Thread-2  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_stg_cashflows_cashflow_id.4176024898"
[0m19:31:23.379320 [debug] [Thread-3  ]: On model.bain_capital_analytics.stg_portfolios: Close
[0m19:31:23.380309 [debug] [Thread-4  ]: On model.bain_capital_analytics.stg_positions: Close
[0m19:31:23.380740 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b681c8a7-b3f4-41ea-b625-4a93cae2ea4b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ab60c40>]}
[0m19:31:23.381295 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b681c8a7-b3f4-41ea-b625-4a93cae2ea4b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ab419a0>]}
[0m19:31:23.381802 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b681c8a7-b3f4-41ea-b625-4a93cae2ea4b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10aa88fa0>]}
[0m19:31:23.382264 [info ] [Thread-1  ]: 8 of 57 OK created sql view model public.stg_valuations ........................ [[32mCREATE VIEW[0m in 0.12s]
[0m19:31:23.382912 [info ] [Thread-3  ]: 6 of 57 OK created sql view model public.stg_portfolios ........................ [[32mCREATE VIEW[0m in 0.13s]
[0m19:31:23.383231 [debug] [Thread-2  ]: Began executing node test.bain_capital_analytics.not_null_stg_cashflows_cashflow_id.4176024898
[0m19:31:23.383667 [info ] [Thread-4  ]: 7 of 57 OK created sql view model public.stg_positions ......................... [[32mCREATE VIEW[0m in 0.13s]
[0m19:31:23.384123 [debug] [Thread-1  ]: Finished running node model.bain_capital_analytics.stg_valuations
[0m19:31:23.384534 [debug] [Thread-3  ]: Finished running node model.bain_capital_analytics.stg_portfolios
[0m19:31:23.397548 [debug] [Thread-4  ]: Finished running node model.bain_capital_analytics.stg_positions
[0m19:31:23.400277 [debug] [Thread-2  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_stg_cashflows_cashflow_id.4176024898"
[0m19:31:23.400657 [debug] [Thread-1  ]: Began running node test.bain_capital_analytics.not_null_stg_cashflows_fund_id.7ff8a45dde
[0m19:31:23.401105 [debug] [Thread-3  ]: Began running node test.bain_capital_analytics.not_null_stg_cashflows_portfolio_id.cbd1d93e57
[0m19:31:23.401622 [debug] [Thread-4  ]: Began running node test.bain_capital_analytics.unique_stg_cashflows_cashflow_id.359e4f4704
[0m19:31:23.402266 [info ] [Thread-1  ]: 10 of 57 START test not_null_stg_cashflows_fund_id ............................. [RUN]
[0m19:31:23.402651 [info ] [Thread-3  ]: 11 of 57 START test not_null_stg_cashflows_portfolio_id ........................ [RUN]
[0m19:31:23.403020 [info ] [Thread-4  ]: 12 of 57 START test unique_stg_cashflows_cashflow_id ........................... [RUN]
[0m19:31:23.403422 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.bain_capital_analytics.stg_valuations, now test.bain_capital_analytics.not_null_stg_cashflows_fund_id.7ff8a45dde)
[0m19:31:23.403791 [debug] [Thread-2  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_cashflows_cashflow_id.4176024898"
[0m19:31:23.404118 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly model.bain_capital_analytics.stg_portfolios, now test.bain_capital_analytics.not_null_stg_cashflows_portfolio_id.cbd1d93e57)
[0m19:31:23.404534 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly model.bain_capital_analytics.stg_positions, now test.bain_capital_analytics.unique_stg_cashflows_cashflow_id.359e4f4704)
[0m19:31:23.404848 [debug] [Thread-1  ]: Began compiling node test.bain_capital_analytics.not_null_stg_cashflows_fund_id.7ff8a45dde
[0m19:31:23.405158 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_stg_cashflows_cashflow_id.4176024898: BEGIN
[0m19:31:23.405471 [debug] [Thread-3  ]: Began compiling node test.bain_capital_analytics.not_null_stg_cashflows_portfolio_id.cbd1d93e57
[0m19:31:23.405770 [debug] [Thread-4  ]: Began compiling node test.bain_capital_analytics.unique_stg_cashflows_cashflow_id.359e4f4704
[0m19:31:23.410374 [debug] [Thread-1  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_stg_cashflows_fund_id.7ff8a45dde"
[0m19:31:23.410701 [debug] [Thread-2  ]: Opening a new connection, currently in state closed
[0m19:31:23.414118 [debug] [Thread-3  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_stg_cashflows_portfolio_id.cbd1d93e57"
[0m19:31:23.419223 [debug] [Thread-4  ]: Writing injected SQL for node "test.bain_capital_analytics.unique_stg_cashflows_cashflow_id.359e4f4704"
[0m19:31:23.419851 [debug] [Thread-1  ]: Began executing node test.bain_capital_analytics.not_null_stg_cashflows_fund_id.7ff8a45dde
[0m19:31:23.422065 [debug] [Thread-1  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_stg_cashflows_fund_id.7ff8a45dde"
[0m19:31:23.422512 [debug] [Thread-3  ]: Began executing node test.bain_capital_analytics.not_null_stg_cashflows_portfolio_id.cbd1d93e57
[0m19:31:23.422823 [debug] [Thread-4  ]: Began executing node test.bain_capital_analytics.unique_stg_cashflows_cashflow_id.359e4f4704
[0m19:31:23.424946 [debug] [Thread-3  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_stg_cashflows_portfolio_id.cbd1d93e57"
[0m19:31:23.427131 [debug] [Thread-4  ]: Writing runtime sql for node "test.bain_capital_analytics.unique_stg_cashflows_cashflow_id.359e4f4704"
[0m19:31:23.427590 [debug] [Thread-1  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_cashflows_fund_id.7ff8a45dde"
[0m19:31:23.427962 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_stg_cashflows_fund_id.7ff8a45dde: BEGIN
[0m19:31:23.428269 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m19:31:23.428762 [debug] [Thread-3  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_cashflows_portfolio_id.cbd1d93e57"
[0m19:31:23.429113 [debug] [Thread-4  ]: Using postgres connection "test.bain_capital_analytics.unique_stg_cashflows_cashflow_id.359e4f4704"
[0m19:31:23.429409 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_stg_cashflows_portfolio_id.cbd1d93e57: BEGIN
[0m19:31:23.429734 [debug] [Thread-4  ]: On test.bain_capital_analytics.unique_stg_cashflows_cashflow_id.359e4f4704: BEGIN
[0m19:31:23.430035 [debug] [Thread-3  ]: Opening a new connection, currently in state closed
[0m19:31:23.430326 [debug] [Thread-4  ]: Opening a new connection, currently in state closed
[0m19:31:23.430634 [debug] [Thread-2  ]: SQL status: BEGIN in 0.020 seconds
[0m19:31:23.431097 [debug] [Thread-2  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_cashflows_cashflow_id.4176024898"
[0m19:31:23.431403 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_stg_cashflows_cashflow_id.4176024898: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_stg_cashflows_cashflow_id.4176024898"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select cashflow_id
from "bain_analytics"."public"."stg_cashflows"
where cashflow_id is null



  
  
      
    ) dbt_internal_test
[0m19:31:23.433660 [debug] [Thread-2  ]: SQL status: SELECT 1 in 0.002 seconds
[0m19:31:23.437367 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_stg_cashflows_cashflow_id.4176024898: ROLLBACK
[0m19:31:23.438065 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_stg_cashflows_cashflow_id.4176024898: Close
[0m19:31:23.438386 [debug] [Thread-1  ]: SQL status: BEGIN in 0.010 seconds
[0m19:31:23.438882 [info ] [Thread-2  ]: 9 of 57 PASS not_null_stg_cashflows_cashflow_id ................................ [[32mPASS[0m in 0.07s]
[0m19:31:23.439206 [debug] [Thread-1  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_cashflows_fund_id.7ff8a45dde"
[0m19:31:23.439693 [debug] [Thread-2  ]: Finished running node test.bain_capital_analytics.not_null_stg_cashflows_cashflow_id.4176024898
[0m19:31:23.440017 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_stg_cashflows_fund_id.7ff8a45dde: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_stg_cashflows_fund_id.7ff8a45dde"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select fund_id
from "bain_analytics"."public"."stg_cashflows"
where fund_id is null



  
  
      
    ) dbt_internal_test
[0m19:31:23.440350 [debug] [Thread-4  ]: SQL status: BEGIN in 0.010 seconds
[0m19:31:23.440642 [debug] [Thread-3  ]: SQL status: BEGIN in 0.011 seconds
[0m19:31:23.440972 [debug] [Thread-2  ]: Began running node test.bain_capital_analytics.not_null_stg_dates_date_day.f3ec4da188
[0m19:31:23.441368 [debug] [Thread-4  ]: Using postgres connection "test.bain_capital_analytics.unique_stg_cashflows_cashflow_id.359e4f4704"
[0m19:31:23.441663 [debug] [Thread-3  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_cashflows_portfolio_id.cbd1d93e57"
[0m19:31:23.441969 [info ] [Thread-2  ]: 13 of 57 START test not_null_stg_dates_date_day ................................ [RUN]
[0m19:31:23.442319 [debug] [Thread-4  ]: On test.bain_capital_analytics.unique_stg_cashflows_cashflow_id.359e4f4704: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.unique_stg_cashflows_cashflow_id.359e4f4704"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

select
    cashflow_id as unique_field,
    count(*) as n_records

from "bain_analytics"."public"."stg_cashflows"
where cashflow_id is not null
group by cashflow_id
having count(*) > 1



  
  
      
    ) dbt_internal_test
[0m19:31:23.442659 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_stg_cashflows_portfolio_id.cbd1d93e57: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_stg_cashflows_portfolio_id.cbd1d93e57"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select portfolio_id
from "bain_analytics"."public"."stg_cashflows"
where portfolio_id is null



  
  
      
    ) dbt_internal_test
[0m19:31:23.443014 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.not_null_stg_cashflows_cashflow_id.4176024898, now test.bain_capital_analytics.not_null_stg_dates_date_day.f3ec4da188)
[0m19:31:23.443380 [debug] [Thread-2  ]: Began compiling node test.bain_capital_analytics.not_null_stg_dates_date_day.f3ec4da188
[0m19:31:23.443681 [debug] [Thread-1  ]: SQL status: SELECT 1 in 0.002 seconds
[0m19:31:23.447514 [debug] [Thread-2  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_stg_dates_date_day.f3ec4da188"
[0m19:31:23.447864 [debug] [Thread-4  ]: SQL status: SELECT 1 in 0.005 seconds
[0m19:31:23.448963 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_stg_cashflows_fund_id.7ff8a45dde: ROLLBACK
[0m19:31:23.449342 [debug] [Thread-3  ]: SQL status: SELECT 1 in 0.006 seconds
[0m19:31:23.450437 [debug] [Thread-4  ]: On test.bain_capital_analytics.unique_stg_cashflows_cashflow_id.359e4f4704: ROLLBACK
[0m19:31:23.451534 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_stg_cashflows_portfolio_id.cbd1d93e57: ROLLBACK
[0m19:31:23.451849 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_stg_cashflows_fund_id.7ff8a45dde: Close
[0m19:31:23.452142 [debug] [Thread-2  ]: Began executing node test.bain_capital_analytics.not_null_stg_dates_date_day.f3ec4da188
[0m19:31:23.454925 [debug] [Thread-2  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_stg_dates_date_day.f3ec4da188"
[0m19:31:23.452635 [info ] [Thread-1  ]: 10 of 57 PASS not_null_stg_cashflows_fund_id ................................... [[32mPASS[0m in 0.05s]
[0m19:31:23.455323 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_stg_cashflows_portfolio_id.cbd1d93e57: Close
[0m19:31:23.455649 [debug] [Thread-4  ]: On test.bain_capital_analytics.unique_stg_cashflows_cashflow_id.359e4f4704: Close
[0m19:31:23.456083 [debug] [Thread-1  ]: Finished running node test.bain_capital_analytics.not_null_stg_cashflows_fund_id.7ff8a45dde
[0m19:31:23.456513 [info ] [Thread-3  ]: 11 of 57 PASS not_null_stg_cashflows_portfolio_id .............................. [[32mPASS[0m in 0.05s]
[0m19:31:23.457014 [info ] [Thread-4  ]: 12 of 57 PASS unique_stg_cashflows_cashflow_id ................................. [[32mPASS[0m in 0.05s]
[0m19:31:23.457354 [debug] [Thread-2  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_dates_date_day.f3ec4da188"
[0m19:31:23.457657 [debug] [Thread-1  ]: Began running node test.bain_capital_analytics.unique_stg_dates_date_day.e062be8e28
[0m19:31:23.458104 [debug] [Thread-3  ]: Finished running node test.bain_capital_analytics.not_null_stg_cashflows_portfolio_id.cbd1d93e57
[0m19:31:23.458500 [debug] [Thread-4  ]: Finished running node test.bain_capital_analytics.unique_stg_cashflows_cashflow_id.359e4f4704
[0m19:31:23.458794 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_stg_dates_date_day.f3ec4da188: BEGIN
[0m19:31:23.459103 [info ] [Thread-1  ]: 14 of 57 START test unique_stg_dates_date_day .................................. [RUN]
[0m19:31:23.459453 [debug] [Thread-3  ]: Began running node test.bain_capital_analytics.not_null_stg_fund_structures_fund_id.a284274f31
[0m19:31:23.459815 [debug] [Thread-4  ]: Began running node test.bain_capital_analytics.unique_stg_fund_structures_fund_id.bb9fec42ab
[0m19:31:23.460135 [debug] [Thread-2  ]: Opening a new connection, currently in state closed
[0m19:31:23.460456 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.not_null_stg_cashflows_fund_id.7ff8a45dde, now test.bain_capital_analytics.unique_stg_dates_date_day.e062be8e28)
[0m19:31:23.460771 [info ] [Thread-3  ]: 15 of 57 START test not_null_stg_fund_structures_fund_id ....................... [RUN]
[0m19:31:23.461107 [info ] [Thread-4  ]: 16 of 57 START test unique_stg_fund_structures_fund_id ......................... [RUN]
[0m19:31:23.461525 [debug] [Thread-1  ]: Began compiling node test.bain_capital_analytics.unique_stg_dates_date_day.e062be8e28
[0m19:31:23.461852 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.not_null_stg_cashflows_portfolio_id.cbd1d93e57, now test.bain_capital_analytics.not_null_stg_fund_structures_fund_id.a284274f31)
[0m19:31:23.462195 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.unique_stg_cashflows_cashflow_id.359e4f4704, now test.bain_capital_analytics.unique_stg_fund_structures_fund_id.bb9fec42ab)
[0m19:31:23.465664 [debug] [Thread-1  ]: Writing injected SQL for node "test.bain_capital_analytics.unique_stg_dates_date_day.e062be8e28"
[0m19:31:23.466011 [debug] [Thread-3  ]: Began compiling node test.bain_capital_analytics.not_null_stg_fund_structures_fund_id.a284274f31
[0m19:31:23.466307 [debug] [Thread-4  ]: Began compiling node test.bain_capital_analytics.unique_stg_fund_structures_fund_id.bb9fec42ab
[0m19:31:23.469773 [debug] [Thread-3  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_stg_fund_structures_fund_id.a284274f31"
[0m19:31:23.473054 [debug] [Thread-4  ]: Writing injected SQL for node "test.bain_capital_analytics.unique_stg_fund_structures_fund_id.bb9fec42ab"
[0m19:31:23.473401 [debug] [Thread-2  ]: SQL status: BEGIN in 0.013 seconds
[0m19:31:23.473764 [debug] [Thread-1  ]: Began executing node test.bain_capital_analytics.unique_stg_dates_date_day.e062be8e28
[0m19:31:23.474138 [debug] [Thread-2  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_dates_date_day.f3ec4da188"
[0m19:31:23.477339 [debug] [Thread-1  ]: Writing runtime sql for node "test.bain_capital_analytics.unique_stg_dates_date_day.e062be8e28"
[0m19:31:23.477663 [debug] [Thread-3  ]: Began executing node test.bain_capital_analytics.not_null_stg_fund_structures_fund_id.a284274f31
[0m19:31:23.477970 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_stg_dates_date_day.f3ec4da188: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_stg_dates_date_day.f3ec4da188"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select date_day
from "bain_analytics"."public"."stg_dates"
where date_day is null



  
  
      
    ) dbt_internal_test
[0m19:31:23.478257 [debug] [Thread-4  ]: Began executing node test.bain_capital_analytics.unique_stg_fund_structures_fund_id.bb9fec42ab
[0m19:31:23.480443 [debug] [Thread-3  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_stg_fund_structures_fund_id.a284274f31"
[0m19:31:23.482754 [debug] [Thread-4  ]: Writing runtime sql for node "test.bain_capital_analytics.unique_stg_fund_structures_fund_id.bb9fec42ab"
[0m19:31:23.483109 [debug] [Thread-1  ]: Using postgres connection "test.bain_capital_analytics.unique_stg_dates_date_day.e062be8e28"
[0m19:31:23.483409 [debug] [Thread-2  ]: SQL status: SELECT 1 in 0.003 seconds
[0m19:31:23.483837 [debug] [Thread-1  ]: On test.bain_capital_analytics.unique_stg_dates_date_day.e062be8e28: BEGIN
[0m19:31:23.484179 [debug] [Thread-3  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_fund_structures_fund_id.a284274f31"
[0m19:31:23.485344 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_stg_dates_date_day.f3ec4da188: ROLLBACK
[0m19:31:23.485692 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m19:31:23.486029 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_stg_fund_structures_fund_id.a284274f31: BEGIN
[0m19:31:23.486385 [debug] [Thread-4  ]: Using postgres connection "test.bain_capital_analytics.unique_stg_fund_structures_fund_id.bb9fec42ab"
[0m19:31:23.486839 [debug] [Thread-3  ]: Opening a new connection, currently in state closed
[0m19:31:23.487144 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_stg_dates_date_day.f3ec4da188: Close
[0m19:31:23.487430 [debug] [Thread-4  ]: On test.bain_capital_analytics.unique_stg_fund_structures_fund_id.bb9fec42ab: BEGIN
[0m19:31:23.488264 [debug] [Thread-4  ]: Opening a new connection, currently in state closed
[0m19:31:23.488018 [info ] [Thread-2  ]: 13 of 57 PASS not_null_stg_dates_date_day ...................................... [[32mPASS[0m in 0.04s]
[0m19:31:23.488888 [debug] [Thread-2  ]: Finished running node test.bain_capital_analytics.not_null_stg_dates_date_day.f3ec4da188
[0m19:31:23.489217 [debug] [Thread-2  ]: Began running node test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_date.d5c8f88f3e
[0m19:31:23.489575 [info ] [Thread-2  ]: 17 of 57 START test not_null_stg_benchmarks_benchmark_date ..................... [RUN]
[0m19:31:23.489923 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.not_null_stg_dates_date_day.f3ec4da188, now test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_date.d5c8f88f3e)
[0m19:31:23.490229 [debug] [Thread-2  ]: Began compiling node test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_date.d5c8f88f3e
[0m19:31:23.493881 [debug] [Thread-2  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_date.d5c8f88f3e"
[0m19:31:23.494392 [debug] [Thread-2  ]: Began executing node test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_date.d5c8f88f3e
[0m19:31:23.496683 [debug] [Thread-2  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_date.d5c8f88f3e"
[0m19:31:23.497291 [debug] [Thread-2  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_date.d5c8f88f3e"
[0m19:31:23.497590 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_date.d5c8f88f3e: BEGIN
[0m19:31:23.497919 [debug] [Thread-1  ]: SQL status: BEGIN in 0.012 seconds
[0m19:31:23.498250 [debug] [Thread-4  ]: SQL status: BEGIN in 0.010 seconds
[0m19:31:23.498563 [debug] [Thread-3  ]: SQL status: BEGIN in 0.012 seconds
[0m19:31:23.498854 [debug] [Thread-2  ]: Opening a new connection, currently in state closed
[0m19:31:23.499188 [debug] [Thread-1  ]: Using postgres connection "test.bain_capital_analytics.unique_stg_dates_date_day.e062be8e28"
[0m19:31:23.499534 [debug] [Thread-4  ]: Using postgres connection "test.bain_capital_analytics.unique_stg_fund_structures_fund_id.bb9fec42ab"
[0m19:31:23.499845 [debug] [Thread-3  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_fund_structures_fund_id.a284274f31"
[0m19:31:23.500252 [debug] [Thread-1  ]: On test.bain_capital_analytics.unique_stg_dates_date_day.e062be8e28: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.unique_stg_dates_date_day.e062be8e28"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

select
    date_day as unique_field,
    count(*) as n_records

from "bain_analytics"."public"."stg_dates"
where date_day is not null
group by date_day
having count(*) > 1



  
  
      
    ) dbt_internal_test
[0m19:31:23.500577 [debug] [Thread-4  ]: On test.bain_capital_analytics.unique_stg_fund_structures_fund_id.bb9fec42ab: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.unique_stg_fund_structures_fund_id.bb9fec42ab"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

select
    fund_id as unique_field,
    count(*) as n_records

from "bain_analytics"."public"."stg_fund_structures"
where fund_id is not null
group by fund_id
having count(*) > 1



  
  
      
    ) dbt_internal_test
[0m19:31:23.500908 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_stg_fund_structures_fund_id.a284274f31: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_stg_fund_structures_fund_id.a284274f31"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select fund_id
from "bain_analytics"."public"."stg_fund_structures"
where fund_id is null



  
  
      
    ) dbt_internal_test
[0m19:31:23.503300 [debug] [Thread-1  ]: SQL status: SELECT 1 in 0.002 seconds
[0m19:31:23.503625 [debug] [Thread-3  ]: SQL status: SELECT 1 in 0.002 seconds
[0m19:31:23.504844 [debug] [Thread-1  ]: On test.bain_capital_analytics.unique_stg_dates_date_day.e062be8e28: ROLLBACK
[0m19:31:23.505160 [debug] [Thread-4  ]: SQL status: SELECT 1 in 0.004 seconds
[0m19:31:23.506177 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_stg_fund_structures_fund_id.a284274f31: ROLLBACK
[0m19:31:23.507291 [debug] [Thread-4  ]: On test.bain_capital_analytics.unique_stg_fund_structures_fund_id.bb9fec42ab: ROLLBACK
[0m19:31:23.507592 [debug] [Thread-1  ]: On test.bain_capital_analytics.unique_stg_dates_date_day.e062be8e28: Close
[0m19:31:23.508363 [debug] [Thread-4  ]: On test.bain_capital_analytics.unique_stg_fund_structures_fund_id.bb9fec42ab: Close
[0m19:31:23.508660 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_stg_fund_structures_fund_id.a284274f31: Close
[0m19:31:23.508123 [info ] [Thread-1  ]: 14 of 57 PASS unique_stg_dates_date_day ........................................ [[32mPASS[0m in 0.05s]
[0m19:31:23.509204 [info ] [Thread-4  ]: 16 of 57 PASS unique_stg_fund_structures_fund_id ............................... [[32mPASS[0m in 0.05s]
[0m19:31:23.509641 [info ] [Thread-3  ]: 15 of 57 PASS not_null_stg_fund_structures_fund_id ............................. [[32mPASS[0m in 0.05s]
[0m19:31:23.509946 [debug] [Thread-2  ]: SQL status: BEGIN in 0.011 seconds
[0m19:31:23.510354 [debug] [Thread-1  ]: Finished running node test.bain_capital_analytics.unique_stg_dates_date_day.e062be8e28
[0m19:31:23.510763 [debug] [Thread-4  ]: Finished running node test.bain_capital_analytics.unique_stg_fund_structures_fund_id.bb9fec42ab
[0m19:31:23.511163 [debug] [Thread-3  ]: Finished running node test.bain_capital_analytics.not_null_stg_fund_structures_fund_id.a284274f31
[0m19:31:23.511457 [debug] [Thread-2  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_date.d5c8f88f3e"
[0m19:31:23.511790 [debug] [Thread-1  ]: Began running node test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_id.ec87e4ee58
[0m19:31:23.512198 [debug] [Thread-4  ]: Began running node test.bain_capital_analytics.not_null_stg_instruments_instrument_id.18bdfd2ebe
[0m19:31:23.512583 [debug] [Thread-3  ]: Began running node test.bain_capital_analytics.unique_stg_instruments_instrument_id.0e70adcd34
[0m19:31:23.512942 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_date.d5c8f88f3e: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_date.d5c8f88f3e"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select benchmark_date
from "bain_analytics"."public"."stg_benchmarks"
where benchmark_date is null



  
  
      
    ) dbt_internal_test
[0m19:31:23.513290 [info ] [Thread-1  ]: 18 of 57 START test not_null_stg_benchmarks_benchmark_id ....................... [RUN]
[0m19:31:23.513611 [info ] [Thread-4  ]: 19 of 57 START test not_null_stg_instruments_instrument_id ..................... [RUN]
[0m19:31:23.513925 [info ] [Thread-3  ]: 20 of 57 START test unique_stg_instruments_instrument_id ....................... [RUN]
[0m19:31:23.514306 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.unique_stg_dates_date_day.e062be8e28, now test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_id.ec87e4ee58)
[0m19:31:23.514637 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.unique_stg_fund_structures_fund_id.bb9fec42ab, now test.bain_capital_analytics.not_null_stg_instruments_instrument_id.18bdfd2ebe)
[0m19:31:23.514959 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.not_null_stg_fund_structures_fund_id.a284274f31, now test.bain_capital_analytics.unique_stg_instruments_instrument_id.0e70adcd34)
[0m19:31:23.515261 [debug] [Thread-1  ]: Began compiling node test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_id.ec87e4ee58
[0m19:31:23.515551 [debug] [Thread-4  ]: Began compiling node test.bain_capital_analytics.not_null_stg_instruments_instrument_id.18bdfd2ebe
[0m19:31:23.515868 [debug] [Thread-3  ]: Began compiling node test.bain_capital_analytics.unique_stg_instruments_instrument_id.0e70adcd34
[0m19:31:23.520047 [debug] [Thread-1  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_id.ec87e4ee58"
[0m19:31:23.520435 [debug] [Thread-2  ]: SQL status: SELECT 1 in 0.006 seconds
[0m19:31:23.525062 [debug] [Thread-4  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_stg_instruments_instrument_id.18bdfd2ebe"
[0m19:31:23.528346 [debug] [Thread-3  ]: Writing injected SQL for node "test.bain_capital_analytics.unique_stg_instruments_instrument_id.0e70adcd34"
[0m19:31:23.529614 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_date.d5c8f88f3e: ROLLBACK
[0m19:31:23.530204 [debug] [Thread-3  ]: Began executing node test.bain_capital_analytics.unique_stg_instruments_instrument_id.0e70adcd34
[0m19:31:23.530509 [debug] [Thread-1  ]: Began executing node test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_id.ec87e4ee58
[0m19:31:23.530800 [debug] [Thread-4  ]: Began executing node test.bain_capital_analytics.not_null_stg_instruments_instrument_id.18bdfd2ebe
[0m19:31:23.533216 [debug] [Thread-3  ]: Writing runtime sql for node "test.bain_capital_analytics.unique_stg_instruments_instrument_id.0e70adcd34"
[0m19:31:23.533513 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_date.d5c8f88f3e: Close
[0m19:31:23.535673 [debug] [Thread-1  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_id.ec87e4ee58"
[0m19:31:23.537804 [debug] [Thread-4  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_stg_instruments_instrument_id.18bdfd2ebe"
[0m19:31:23.538356 [info ] [Thread-2  ]: 17 of 57 PASS not_null_stg_benchmarks_benchmark_date ........................... [[32mPASS[0m in 0.05s]
[0m19:31:23.538873 [debug] [Thread-3  ]: Using postgres connection "test.bain_capital_analytics.unique_stg_instruments_instrument_id.0e70adcd34"
[0m19:31:23.539326 [debug] [Thread-2  ]: Finished running node test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_date.d5c8f88f3e
[0m19:31:23.539694 [debug] [Thread-3  ]: On test.bain_capital_analytics.unique_stg_instruments_instrument_id.0e70adcd34: BEGIN
[0m19:31:23.540015 [debug] [Thread-1  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_id.ec87e4ee58"
[0m19:31:23.540364 [debug] [Thread-2  ]: Began running node test.bain_capital_analytics.not_null_stg_valuations_portfolio_id.d5af3e5188
[0m19:31:23.540749 [debug] [Thread-4  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_instruments_instrument_id.18bdfd2ebe"
[0m19:31:23.541037 [debug] [Thread-3  ]: Opening a new connection, currently in state closed
[0m19:31:23.541343 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_id.ec87e4ee58: BEGIN
[0m19:31:23.541659 [info ] [Thread-2  ]: 21 of 57 START test not_null_stg_valuations_portfolio_id ....................... [RUN]
[0m19:31:23.541984 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_stg_instruments_instrument_id.18bdfd2ebe: BEGIN
[0m19:31:23.542360 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m19:31:23.542693 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_date.d5c8f88f3e, now test.bain_capital_analytics.not_null_stg_valuations_portfolio_id.d5af3e5188)
[0m19:31:23.542999 [debug] [Thread-4  ]: Opening a new connection, currently in state closed
[0m19:31:23.543372 [debug] [Thread-2  ]: Began compiling node test.bain_capital_analytics.not_null_stg_valuations_portfolio_id.d5af3e5188
[0m19:31:23.547794 [debug] [Thread-2  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_stg_valuations_portfolio_id.d5af3e5188"
[0m19:31:23.548283 [debug] [Thread-2  ]: Began executing node test.bain_capital_analytics.not_null_stg_valuations_portfolio_id.d5af3e5188
[0m19:31:23.550625 [debug] [Thread-2  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_stg_valuations_portfolio_id.d5af3e5188"
[0m19:31:23.551130 [debug] [Thread-2  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_valuations_portfolio_id.d5af3e5188"
[0m19:31:23.551429 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_stg_valuations_portfolio_id.d5af3e5188: BEGIN
[0m19:31:23.551702 [debug] [Thread-2  ]: Opening a new connection, currently in state closed
[0m19:31:23.553297 [debug] [Thread-3  ]: SQL status: BEGIN in 0.012 seconds
[0m19:31:23.553594 [debug] [Thread-3  ]: Using postgres connection "test.bain_capital_analytics.unique_stg_instruments_instrument_id.0e70adcd34"
[0m19:31:23.553885 [debug] [Thread-1  ]: SQL status: BEGIN in 0.012 seconds
[0m19:31:23.554186 [debug] [Thread-4  ]: SQL status: BEGIN in 0.011 seconds
[0m19:31:23.554497 [debug] [Thread-3  ]: On test.bain_capital_analytics.unique_stg_instruments_instrument_id.0e70adcd34: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.unique_stg_instruments_instrument_id.0e70adcd34"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

select
    instrument_id as unique_field,
    count(*) as n_records

from "bain_analytics"."public"."stg_instruments"
where instrument_id is not null
group by instrument_id
having count(*) > 1



  
  
      
    ) dbt_internal_test
[0m19:31:23.554811 [debug] [Thread-1  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_id.ec87e4ee58"
[0m19:31:23.555111 [debug] [Thread-4  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_instruments_instrument_id.18bdfd2ebe"
[0m19:31:23.555456 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_id.ec87e4ee58: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_id.ec87e4ee58"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select benchmark_id
from "bain_analytics"."public"."stg_benchmarks"
where benchmark_id is null



  
  
      
    ) dbt_internal_test
[0m19:31:23.555778 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_stg_instruments_instrument_id.18bdfd2ebe: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_stg_instruments_instrument_id.18bdfd2ebe"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select instrument_id
from "bain_analytics"."public"."stg_instruments"
where instrument_id is null



  
  
      
    ) dbt_internal_test
[0m19:31:23.557990 [debug] [Thread-4  ]: SQL status: SELECT 1 in 0.002 seconds
[0m19:31:23.558279 [debug] [Thread-3  ]: SQL status: SELECT 1 in 0.003 seconds
[0m19:31:23.558568 [debug] [Thread-1  ]: SQL status: SELECT 1 in 0.002 seconds
[0m19:31:23.559729 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_stg_instruments_instrument_id.18bdfd2ebe: ROLLBACK
[0m19:31:23.560790 [debug] [Thread-3  ]: On test.bain_capital_analytics.unique_stg_instruments_instrument_id.0e70adcd34: ROLLBACK
[0m19:31:23.561097 [debug] [Thread-2  ]: SQL status: BEGIN in 0.009 seconds
[0m19:31:23.562059 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_id.ec87e4ee58: ROLLBACK
[0m19:31:23.562430 [debug] [Thread-2  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_valuations_portfolio_id.d5af3e5188"
[0m19:31:23.562744 [debug] [Thread-3  ]: On test.bain_capital_analytics.unique_stg_instruments_instrument_id.0e70adcd34: Close
[0m19:31:23.563042 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_stg_valuations_portfolio_id.d5af3e5188: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_stg_valuations_portfolio_id.d5af3e5188"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select portfolio_id
from "bain_analytics"."public"."stg_valuations"
where portfolio_id is null



  
  
      
    ) dbt_internal_test
[0m19:31:23.563335 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_stg_instruments_instrument_id.18bdfd2ebe: Close
[0m19:31:23.563635 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_id.ec87e4ee58: Close
[0m19:31:23.564121 [info ] [Thread-3  ]: 20 of 57 PASS unique_stg_instruments_instrument_id ............................. [[32mPASS[0m in 0.05s]
[0m19:31:23.564607 [info ] [Thread-4  ]: 19 of 57 PASS not_null_stg_instruments_instrument_id ........................... [[32mPASS[0m in 0.05s]
[0m19:31:23.565018 [info ] [Thread-1  ]: 18 of 57 PASS not_null_stg_benchmarks_benchmark_id ............................. [[32mPASS[0m in 0.05s]
[0m19:31:23.565460 [debug] [Thread-3  ]: Finished running node test.bain_capital_analytics.unique_stg_instruments_instrument_id.0e70adcd34
[0m19:31:23.565935 [debug] [Thread-4  ]: Finished running node test.bain_capital_analytics.not_null_stg_instruments_instrument_id.18bdfd2ebe
[0m19:31:23.566345 [debug] [Thread-1  ]: Finished running node test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_id.ec87e4ee58
[0m19:31:23.566626 [debug] [Thread-2  ]: SQL status: SELECT 1 in 0.003 seconds
[0m19:31:23.566952 [debug] [Thread-3  ]: Began running node test.bain_capital_analytics.not_null_stg_valuations_valuation_id.88ca70781d
[0m19:31:23.567332 [debug] [Thread-4  ]: Began running node test.bain_capital_analytics.unique_stg_valuations_valuation_id.fce7eb13b5
[0m19:31:23.567695 [debug] [Thread-1  ]: Began running node test.bain_capital_analytics.not_null_stg_portfolios_fund_id.70b04d82bd
[0m19:31:23.568755 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_stg_valuations_portfolio_id.d5af3e5188: ROLLBACK
[0m19:31:23.569167 [info ] [Thread-3  ]: 22 of 57 START test not_null_stg_valuations_valuation_id ....................... [RUN]
[0m19:31:23.569491 [info ] [Thread-4  ]: 23 of 57 START test unique_stg_valuations_valuation_id ......................... [RUN]
[0m19:31:23.569809 [info ] [Thread-1  ]: 24 of 57 START test not_null_stg_portfolios_fund_id ............................ [RUN]
[0m19:31:23.570195 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.unique_stg_instruments_instrument_id.0e70adcd34, now test.bain_capital_analytics.not_null_stg_valuations_valuation_id.88ca70781d)
[0m19:31:23.570514 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_stg_valuations_portfolio_id.d5af3e5188: Close
[0m19:31:23.570821 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.not_null_stg_instruments_instrument_id.18bdfd2ebe, now test.bain_capital_analytics.unique_stg_valuations_valuation_id.fce7eb13b5)
[0m19:31:23.571138 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.not_null_stg_benchmarks_benchmark_id.ec87e4ee58, now test.bain_capital_analytics.not_null_stg_portfolios_fund_id.70b04d82bd)
[0m19:31:23.571442 [debug] [Thread-3  ]: Began compiling node test.bain_capital_analytics.not_null_stg_valuations_valuation_id.88ca70781d
[0m19:31:23.571902 [info ] [Thread-2  ]: 21 of 57 PASS not_null_stg_valuations_portfolio_id ............................. [[32mPASS[0m in 0.03s]
[0m19:31:23.572200 [debug] [Thread-4  ]: Began compiling node test.bain_capital_analytics.unique_stg_valuations_valuation_id.fce7eb13b5
[0m19:31:23.572478 [debug] [Thread-1  ]: Began compiling node test.bain_capital_analytics.not_null_stg_portfolios_fund_id.70b04d82bd
[0m19:31:23.576152 [debug] [Thread-3  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_stg_valuations_valuation_id.88ca70781d"
[0m19:31:23.576602 [debug] [Thread-2  ]: Finished running node test.bain_capital_analytics.not_null_stg_valuations_portfolio_id.d5af3e5188
[0m19:31:23.579872 [debug] [Thread-4  ]: Writing injected SQL for node "test.bain_capital_analytics.unique_stg_valuations_valuation_id.fce7eb13b5"
[0m19:31:23.583184 [debug] [Thread-1  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_stg_portfolios_fund_id.70b04d82bd"
[0m19:31:23.583622 [debug] [Thread-2  ]: Began running node test.bain_capital_analytics.not_null_stg_portfolios_portfolio_id.7126a480ec
[0m19:31:23.584233 [info ] [Thread-2  ]: 25 of 57 START test not_null_stg_portfolios_portfolio_id ....................... [RUN]
[0m19:31:23.584593 [debug] [Thread-3  ]: Began executing node test.bain_capital_analytics.not_null_stg_valuations_valuation_id.88ca70781d
[0m19:31:23.584955 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.not_null_stg_valuations_portfolio_id.d5af3e5188, now test.bain_capital_analytics.not_null_stg_portfolios_portfolio_id.7126a480ec)
[0m19:31:23.585284 [debug] [Thread-4  ]: Began executing node test.bain_capital_analytics.unique_stg_valuations_valuation_id.fce7eb13b5
[0m19:31:23.587469 [debug] [Thread-3  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_stg_valuations_valuation_id.88ca70781d"
[0m19:31:23.587803 [debug] [Thread-2  ]: Began compiling node test.bain_capital_analytics.not_null_stg_portfolios_portfolio_id.7126a480ec
[0m19:31:23.588096 [debug] [Thread-1  ]: Began executing node test.bain_capital_analytics.not_null_stg_portfolios_fund_id.70b04d82bd
[0m19:31:23.591271 [debug] [Thread-4  ]: Writing runtime sql for node "test.bain_capital_analytics.unique_stg_valuations_valuation_id.fce7eb13b5"
[0m19:31:23.594812 [debug] [Thread-2  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_stg_portfolios_portfolio_id.7126a480ec"
[0m19:31:23.597012 [debug] [Thread-1  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_stg_portfolios_fund_id.70b04d82bd"
[0m19:31:23.597476 [debug] [Thread-3  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_valuations_valuation_id.88ca70781d"
[0m19:31:23.597943 [debug] [Thread-4  ]: Using postgres connection "test.bain_capital_analytics.unique_stg_valuations_valuation_id.fce7eb13b5"
[0m19:31:23.598277 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_stg_valuations_valuation_id.88ca70781d: BEGIN
[0m19:31:23.598612 [debug] [Thread-4  ]: On test.bain_capital_analytics.unique_stg_valuations_valuation_id.fce7eb13b5: BEGIN
[0m19:31:23.598941 [debug] [Thread-2  ]: Began executing node test.bain_capital_analytics.not_null_stg_portfolios_portfolio_id.7126a480ec
[0m19:31:23.599261 [debug] [Thread-3  ]: Opening a new connection, currently in state closed
[0m19:31:23.599591 [debug] [Thread-1  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_portfolios_fund_id.70b04d82bd"
[0m19:31:23.599873 [debug] [Thread-4  ]: Opening a new connection, currently in state closed
[0m19:31:23.602096 [debug] [Thread-2  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_stg_portfolios_portfolio_id.7126a480ec"
[0m19:31:23.602519 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_stg_portfolios_fund_id.70b04d82bd: BEGIN
[0m19:31:23.602973 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m19:31:23.603431 [debug] [Thread-2  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_portfolios_portfolio_id.7126a480ec"
[0m19:31:23.603721 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_stg_portfolios_portfolio_id.7126a480ec: BEGIN
[0m19:31:23.603998 [debug] [Thread-2  ]: Opening a new connection, currently in state closed
[0m19:31:23.617303 [debug] [Thread-4  ]: SQL status: BEGIN in 0.017 seconds
[0m19:31:23.617629 [debug] [Thread-3  ]: SQL status: BEGIN in 0.018 seconds
[0m19:31:23.617940 [debug] [Thread-1  ]: SQL status: BEGIN in 0.015 seconds
[0m19:31:23.618229 [debug] [Thread-4  ]: Using postgres connection "test.bain_capital_analytics.unique_stg_valuations_valuation_id.fce7eb13b5"
[0m19:31:23.618509 [debug] [Thread-2  ]: SQL status: BEGIN in 0.015 seconds
[0m19:31:23.618794 [debug] [Thread-3  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_valuations_valuation_id.88ca70781d"
[0m19:31:23.619072 [debug] [Thread-1  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_portfolios_fund_id.70b04d82bd"
[0m19:31:23.619376 [debug] [Thread-4  ]: On test.bain_capital_analytics.unique_stg_valuations_valuation_id.fce7eb13b5: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.unique_stg_valuations_valuation_id.fce7eb13b5"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

select
    valuation_id as unique_field,
    count(*) as n_records

from "bain_analytics"."public"."stg_valuations"
where valuation_id is not null
group by valuation_id
having count(*) > 1



  
  
      
    ) dbt_internal_test
[0m19:31:23.619675 [debug] [Thread-2  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_portfolios_portfolio_id.7126a480ec"
[0m19:31:23.619973 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_stg_valuations_valuation_id.88ca70781d: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_stg_valuations_valuation_id.88ca70781d"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select valuation_id
from "bain_analytics"."public"."stg_valuations"
where valuation_id is null



  
  
      
    ) dbt_internal_test
[0m19:31:23.620280 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_stg_portfolios_fund_id.70b04d82bd: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_stg_portfolios_fund_id.70b04d82bd"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select fund_id
from "bain_analytics"."public"."stg_portfolios"
where fund_id is null



  
  
      
    ) dbt_internal_test
[0m19:31:23.620638 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_stg_portfolios_portfolio_id.7126a480ec: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_stg_portfolios_portfolio_id.7126a480ec"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select portfolio_id
from "bain_analytics"."public"."stg_portfolios"
where portfolio_id is null



  
  
      
    ) dbt_internal_test
[0m19:31:23.624456 [debug] [Thread-2  ]: SQL status: SELECT 1 in 0.003 seconds
[0m19:31:23.624762 [debug] [Thread-3  ]: SQL status: SELECT 1 in 0.004 seconds
[0m19:31:23.625052 [debug] [Thread-1  ]: SQL status: SELECT 1 in 0.004 seconds
[0m19:31:23.625325 [debug] [Thread-4  ]: SQL status: SELECT 1 in 0.005 seconds
[0m19:31:23.626527 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_stg_portfolios_portfolio_id.7126a480ec: ROLLBACK
[0m19:31:23.627552 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_stg_valuations_valuation_id.88ca70781d: ROLLBACK
[0m19:31:23.628545 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_stg_portfolios_fund_id.70b04d82bd: ROLLBACK
[0m19:31:23.629528 [debug] [Thread-4  ]: On test.bain_capital_analytics.unique_stg_valuations_valuation_id.fce7eb13b5: ROLLBACK
[0m19:31:23.630426 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_stg_portfolios_portfolio_id.7126a480ec: Close
[0m19:31:23.630720 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_stg_valuations_valuation_id.88ca70781d: Close
[0m19:31:23.630999 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_stg_portfolios_fund_id.70b04d82bd: Close
[0m19:31:23.631265 [debug] [Thread-4  ]: On test.bain_capital_analytics.unique_stg_valuations_valuation_id.fce7eb13b5: Close
[0m19:31:23.631713 [info ] [Thread-2  ]: 25 of 57 PASS not_null_stg_portfolios_portfolio_id ............................. [[32mPASS[0m in 0.05s]
[0m19:31:23.632159 [info ] [Thread-3  ]: 22 of 57 PASS not_null_stg_valuations_valuation_id ............................. [[32mPASS[0m in 0.06s]
[0m19:31:23.632630 [info ] [Thread-1  ]: 24 of 57 PASS not_null_stg_portfolios_fund_id .................................. [[32mPASS[0m in 0.06s]
[0m19:31:23.633050 [info ] [Thread-4  ]: 23 of 57 PASS unique_stg_valuations_valuation_id ............................... [[32mPASS[0m in 0.06s]
[0m19:31:23.633489 [debug] [Thread-2  ]: Finished running node test.bain_capital_analytics.not_null_stg_portfolios_portfolio_id.7126a480ec
[0m19:31:23.633890 [debug] [Thread-3  ]: Finished running node test.bain_capital_analytics.not_null_stg_valuations_valuation_id.88ca70781d
[0m19:31:23.634284 [debug] [Thread-1  ]: Finished running node test.bain_capital_analytics.not_null_stg_portfolios_fund_id.70b04d82bd
[0m19:31:23.634717 [debug] [Thread-4  ]: Finished running node test.bain_capital_analytics.unique_stg_valuations_valuation_id.fce7eb13b5
[0m19:31:23.635067 [debug] [Thread-2  ]: Began running node test.bain_capital_analytics.unique_stg_portfolios_portfolio_id.aa125b6658
[0m19:31:23.635404 [debug] [Thread-3  ]: Began running node test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c
[0m19:31:23.635824 [debug] [Thread-1  ]: Began running node test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1
[0m19:31:23.636200 [debug] [Thread-4  ]: Began running node test.bain_capital_analytics.relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_.2823f12709
[0m19:31:23.636583 [info ] [Thread-2  ]: 26 of 57 START test unique_stg_portfolios_portfolio_id ......................... [RUN]
[0m19:31:23.636942 [info ] [Thread-3  ]: 27 of 57 START test not_null_stg_positions_portfolio_id ........................ [RUN]
[0m19:31:23.637267 [info ] [Thread-1  ]: 28 of 57 START test not_null_stg_positions_position_id ......................... [RUN]
[0m19:31:23.637588 [info ] [Thread-4  ]: 29 of 57 START test relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_  [RUN]
[0m19:31:23.637956 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.not_null_stg_portfolios_portfolio_id.7126a480ec, now test.bain_capital_analytics.unique_stg_portfolios_portfolio_id.aa125b6658)
[0m19:31:23.638288 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.not_null_stg_valuations_valuation_id.88ca70781d, now test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c)
[0m19:31:23.638605 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.not_null_stg_portfolios_fund_id.70b04d82bd, now test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1)
[0m19:31:23.638923 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.unique_stg_valuations_valuation_id.fce7eb13b5, now test.bain_capital_analytics.relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_.2823f12709)
[0m19:31:23.639229 [debug] [Thread-2  ]: Began compiling node test.bain_capital_analytics.unique_stg_portfolios_portfolio_id.aa125b6658
[0m19:31:23.639513 [debug] [Thread-3  ]: Began compiling node test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c
[0m19:31:23.639799 [debug] [Thread-1  ]: Began compiling node test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1
[0m19:31:23.640091 [debug] [Thread-4  ]: Began compiling node test.bain_capital_analytics.relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_.2823f12709
[0m19:31:23.643846 [debug] [Thread-2  ]: Writing injected SQL for node "test.bain_capital_analytics.unique_stg_portfolios_portfolio_id.aa125b6658"
[0m19:31:23.647222 [debug] [Thread-3  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c"
[0m19:31:23.651697 [debug] [Thread-1  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1"
[0m19:31:23.658337 [debug] [Thread-4  ]: Writing injected SQL for node "test.bain_capital_analytics.relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_.2823f12709"
[0m19:31:23.659099 [debug] [Thread-2  ]: Began executing node test.bain_capital_analytics.unique_stg_portfolios_portfolio_id.aa125b6658
[0m19:31:23.661367 [debug] [Thread-2  ]: Writing runtime sql for node "test.bain_capital_analytics.unique_stg_portfolios_portfolio_id.aa125b6658"
[0m19:31:23.661688 [debug] [Thread-3  ]: Began executing node test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c
[0m19:31:23.661990 [debug] [Thread-4  ]: Began executing node test.bain_capital_analytics.relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_.2823f12709
[0m19:31:23.662325 [debug] [Thread-1  ]: Began executing node test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1
[0m19:31:23.664569 [debug] [Thread-3  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c"
[0m19:31:23.666839 [debug] [Thread-4  ]: Writing runtime sql for node "test.bain_capital_analytics.relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_.2823f12709"
[0m19:31:23.669867 [debug] [Thread-1  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1"
[0m19:31:23.670236 [debug] [Thread-2  ]: Using postgres connection "test.bain_capital_analytics.unique_stg_portfolios_portfolio_id.aa125b6658"
[0m19:31:23.670785 [debug] [Thread-2  ]: On test.bain_capital_analytics.unique_stg_portfolios_portfolio_id.aa125b6658: BEGIN
[0m19:31:23.671131 [debug] [Thread-3  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c"
[0m19:31:23.671429 [debug] [Thread-2  ]: Opening a new connection, currently in state closed
[0m19:31:23.671779 [debug] [Thread-4  ]: Using postgres connection "test.bain_capital_analytics.relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_.2823f12709"
[0m19:31:23.672081 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c: BEGIN
[0m19:31:23.672525 [debug] [Thread-1  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1"
[0m19:31:23.672824 [debug] [Thread-4  ]: On test.bain_capital_analytics.relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_.2823f12709: BEGIN
[0m19:31:23.673113 [debug] [Thread-3  ]: Opening a new connection, currently in state closed
[0m19:31:23.673413 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1: BEGIN
[0m19:31:23.673708 [debug] [Thread-4  ]: Opening a new connection, currently in state closed
[0m19:31:23.674081 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m19:31:23.685513 [debug] [Thread-2  ]: SQL status: BEGIN in 0.014 seconds
[0m19:31:23.685815 [debug] [Thread-2  ]: Using postgres connection "test.bain_capital_analytics.unique_stg_portfolios_portfolio_id.aa125b6658"
[0m19:31:23.686118 [debug] [Thread-2  ]: On test.bain_capital_analytics.unique_stg_portfolios_portfolio_id.aa125b6658: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.unique_stg_portfolios_portfolio_id.aa125b6658"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

select
    portfolio_id as unique_field,
    count(*) as n_records

from "bain_analytics"."public"."stg_portfolios"
where portfolio_id is not null
group by portfolio_id
having count(*) > 1



  
  
      
    ) dbt_internal_test
[0m19:31:23.687287 [debug] [Thread-4  ]: SQL status: BEGIN in 0.014 seconds
[0m19:31:23.687610 [debug] [Thread-3  ]: SQL status: BEGIN in 0.014 seconds
[0m19:31:23.687914 [debug] [Thread-4  ]: Using postgres connection "test.bain_capital_analytics.relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_.2823f12709"
[0m19:31:23.688186 [debug] [Thread-1  ]: SQL status: BEGIN in 0.014 seconds
[0m19:31:23.688471 [debug] [Thread-3  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c"
[0m19:31:23.688781 [debug] [Thread-4  ]: On test.bain_capital_analytics.relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_.2823f12709: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_.2823f12709"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

with child as (
    select portfolio_id as from_field
    from "bain_analytics"."public"."stg_positions"
    where portfolio_id is not null
),

parent as (
    select portfolio_id as to_field
    from "bain_analytics"."public"."stg_portfolios"
)

select
    from_field

from child
left join parent
    on child.from_field = parent.to_field

where parent.to_field is null



  
  
      
    ) dbt_internal_test
[0m19:31:23.689086 [debug] [Thread-1  ]: Using postgres connection "test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1"
[0m19:31:23.689377 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select portfolio_id
from "bain_analytics"."public"."stg_positions"
where portfolio_id is null



  
  
      
    ) dbt_internal_test
[0m19:31:23.689703 [debug] [Thread-2  ]: SQL status: SELECT 1 in 0.003 seconds
[0m19:31:23.690022 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select position_id
from "bain_analytics"."public"."stg_positions"
where position_id is null



  
  
      
    ) dbt_internal_test
[0m19:31:23.691288 [debug] [Thread-2  ]: On test.bain_capital_analytics.unique_stg_portfolios_portfolio_id.aa125b6658: ROLLBACK
[0m19:31:23.692022 [debug] [Thread-2  ]: On test.bain_capital_analytics.unique_stg_portfolios_portfolio_id.aa125b6658: Close
[0m19:31:23.692487 [info ] [Thread-2  ]: 26 of 57 PASS unique_stg_portfolios_portfolio_id ............................... [[32mPASS[0m in 0.05s]
[0m19:31:23.692826 [debug] [Thread-3  ]: SQL status: SELECT 1 in 0.002 seconds
[0m19:31:23.693229 [debug] [Thread-2  ]: Finished running node test.bain_capital_analytics.unique_stg_portfolios_portfolio_id.aa125b6658
[0m19:31:23.693528 [debug] [Thread-1  ]: SQL status: SELECT 1 in 0.002 seconds
[0m19:31:23.694592 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c: ROLLBACK
[0m19:31:23.694904 [debug] [Thread-4  ]: SQL status: SELECT 1 in 0.005 seconds
[0m19:31:23.695230 [debug] [Thread-2  ]: Began running node test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f
[0m19:31:23.696310 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1: ROLLBACK
[0m19:31:23.697502 [debug] [Thread-4  ]: On test.bain_capital_analytics.relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_.2823f12709: ROLLBACK
[0m19:31:23.697807 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c: Close
[0m19:31:23.698109 [info ] [Thread-2  ]: 30 of 57 START test unique_stg_positions_position_id ........................... [RUN]
[0m19:31:23.698620 [info ] [Thread-3  ]: 27 of 57 PASS not_null_stg_positions_portfolio_id .............................. [[32mPASS[0m in 0.06s]
[0m19:31:23.698915 [debug] [Thread-4  ]: On test.bain_capital_analytics.relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_.2823f12709: Close
[0m19:31:23.699273 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.unique_stg_portfolios_portfolio_id.aa125b6658, now test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f)
[0m19:31:23.699543 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1: Close
[0m19:31:23.699939 [debug] [Thread-3  ]: Finished running node test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c
[0m19:31:23.700363 [info ] [Thread-4  ]: 29 of 57 PASS relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_  [[32mPASS[0m in 0.06s]
[0m19:31:23.700665 [debug] [Thread-2  ]: Began compiling node test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f
[0m19:31:23.701073 [info ] [Thread-1  ]: 28 of 57 PASS not_null_stg_positions_position_id ............................... [[32mPASS[0m in 0.06s]
[0m19:31:23.701402 [debug] [Thread-3  ]: Began running node model.bain_capital_analytics.int_benchmark_returns
[0m19:31:23.701859 [debug] [Thread-4  ]: Finished running node test.bain_capital_analytics.relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_.2823f12709
[0m19:31:23.754053 [debug] [Thread-2  ]: Writing injected SQL for node "test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f"
[0m19:31:23.754587 [debug] [Thread-1  ]: Finished running node test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1
[0m19:31:23.755021 [info ] [Thread-3  ]: 31 of 57 START sql view model public.int_benchmark_returns ..................... [RUN]
[0m19:31:23.755392 [debug] [Thread-4  ]: Began running node model.bain_capital_analytics.int_cashflow_enriched
[0m19:31:23.755856 [debug] [Thread-1  ]: Began running node model.bain_capital_analytics.int_fund_nav
[0m19:31:23.756263 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.not_null_stg_positions_portfolio_id.281f76311c, now model.bain_capital_analytics.int_benchmark_returns)
[0m19:31:23.756721 [info ] [Thread-4  ]: 32 of 57 START sql view model public.int_cashflow_enriched ..................... [RUN]
[0m19:31:23.757135 [info ] [Thread-1  ]: 33 of 57 START sql view model public.int_fund_nav .............................. [RUN]
[0m19:31:23.757449 [debug] [Thread-2  ]: Began executing node test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f
[0m19:31:23.757751 [debug] [Thread-3  ]: Began compiling node model.bain_capital_analytics.int_benchmark_returns
[0m19:31:23.758099 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.relationships_stg_positions_portfolio_id__portfolio_id__ref_stg_portfolios_.2823f12709, now model.bain_capital_analytics.int_cashflow_enriched)
[0m19:31:23.758437 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.not_null_stg_positions_position_id.931382b0a1, now model.bain_capital_analytics.int_fund_nav)
[0m19:31:23.760843 [debug] [Thread-2  ]: Writing runtime sql for node "test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f"
[0m19:31:23.763834 [debug] [Thread-3  ]: Writing injected SQL for node "model.bain_capital_analytics.int_benchmark_returns"
[0m19:31:23.764152 [debug] [Thread-4  ]: Began compiling node model.bain_capital_analytics.int_cashflow_enriched
[0m19:31:23.764446 [debug] [Thread-1  ]: Began compiling node model.bain_capital_analytics.int_fund_nav
[0m19:31:23.767939 [debug] [Thread-4  ]: Writing injected SQL for node "model.bain_capital_analytics.int_cashflow_enriched"
[0m19:31:23.771078 [debug] [Thread-1  ]: Writing injected SQL for node "model.bain_capital_analytics.int_fund_nav"
[0m19:31:23.771612 [debug] [Thread-2  ]: Using postgres connection "test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f"
[0m19:31:23.771988 [debug] [Thread-3  ]: Began executing node model.bain_capital_analytics.int_benchmark_returns
[0m19:31:23.772374 [debug] [Thread-2  ]: On test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f: BEGIN
[0m19:31:23.776658 [debug] [Thread-3  ]: Writing runtime sql for node "model.bain_capital_analytics.int_benchmark_returns"
[0m19:31:23.776992 [debug] [Thread-4  ]: Began executing node model.bain_capital_analytics.int_cashflow_enriched
[0m19:31:23.777296 [debug] [Thread-2  ]: Opening a new connection, currently in state closed
[0m19:31:23.777611 [debug] [Thread-1  ]: Began executing node model.bain_capital_analytics.int_fund_nav
[0m19:31:23.780793 [debug] [Thread-4  ]: Writing runtime sql for node "model.bain_capital_analytics.int_cashflow_enriched"
[0m19:31:23.781287 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.int_benchmark_returns"
[0m19:31:23.784546 [debug] [Thread-1  ]: Writing runtime sql for node "model.bain_capital_analytics.int_fund_nav"
[0m19:31:23.784948 [debug] [Thread-3  ]: On model.bain_capital_analytics.int_benchmark_returns: BEGIN
[0m19:31:23.785351 [debug] [Thread-3  ]: Opening a new connection, currently in state closed
[0m19:31:23.785826 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.int_cashflow_enriched"
[0m19:31:23.786159 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.int_fund_nav"
[0m19:31:23.786449 [debug] [Thread-4  ]: On model.bain_capital_analytics.int_cashflow_enriched: BEGIN
[0m19:31:23.786774 [debug] [Thread-1  ]: On model.bain_capital_analytics.int_fund_nav: BEGIN
[0m19:31:23.787097 [debug] [Thread-4  ]: Opening a new connection, currently in state closed
[0m19:31:23.787393 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m19:31:23.791478 [debug] [Thread-2  ]: SQL status: BEGIN in 0.014 seconds
[0m19:31:23.791773 [debug] [Thread-2  ]: Using postgres connection "test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f"
[0m19:31:23.792083 [debug] [Thread-2  ]: On test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

select
    position_id as unique_field,
    count(*) as n_records

from "bain_analytics"."public"."stg_positions"
where position_id is not null
group by position_id
having count(*) > 1



  
  
      
    ) dbt_internal_test
[0m19:31:23.794929 [debug] [Thread-3  ]: SQL status: BEGIN in 0.010 seconds
[0m19:31:23.795234 [debug] [Thread-2  ]: SQL status: SELECT 1 in 0.003 seconds
[0m19:31:23.795513 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.int_benchmark_returns"
[0m19:31:23.796733 [debug] [Thread-2  ]: On test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f: ROLLBACK
[0m19:31:23.797202 [debug] [Thread-3  ]: On model.bain_capital_analytics.int_benchmark_returns: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.int_benchmark_returns"} */

  create view "bain_analytics"."public"."int_benchmark_returns__dbt_tmp"
    
    
  as (
    -- Pipeline C: Benchmark returns with rolling calculations
-- Anti-pattern: heavy window functions that could be pre-computed

with benchmark_base as (
    select
        b.benchmark_id,
        b.benchmark_name,
        b.benchmark_date,
        b.return_daily,
        b.return_mtd,
        b.return_ytd,
        b.benchmark_level,
        b.benchmark_fiscal_quarter,
        d.fiscal_year,
        d.is_quarter_end,
        d.is_year_end
    from "bain_analytics"."public"."stg_benchmarks" b
    inner join "bain_analytics"."public"."stg_dates" d
        on b.benchmark_date = d.date_day
),

-- Anti-pattern: compute many overlapping windows
benchmark_with_rolling as (
    select
        bb.*,
        -- rolling 3-month return
        exp(sum(ln(1 + bb.return_mtd)) over (
            partition by bb.benchmark_id
            order by bb.benchmark_date
            rows between 2 preceding and current row
        )) - 1 as rolling_3m_return,
        -- rolling 6-month return
        exp(sum(ln(1 + bb.return_mtd)) over (
            partition by bb.benchmark_id
            order by bb.benchmark_date
            rows between 5 preceding and current row
        )) - 1 as rolling_6m_return,
        -- rolling 12-month return
        exp(sum(ln(1 + bb.return_mtd)) over (
            partition by bb.benchmark_id
            order by bb.benchmark_date
            rows between 11 preceding and current row
        )) - 1 as rolling_12m_return,
        -- Anti-pattern: volatility via window (expensive)
        stddev(bb.return_mtd) over (
            partition by bb.benchmark_id
            order by bb.benchmark_date
            rows between 11 preceding and current row
        ) as rolling_12m_volatility,
        avg(bb.return_mtd) over (
            partition by bb.benchmark_id
            order by bb.benchmark_date
            rows between 11 preceding and current row
        ) as rolling_12m_avg_return,
        lag(bb.benchmark_level) over (
            partition by bb.benchmark_id
            order by bb.benchmark_date
        ) as prev_benchmark_level
    from benchmark_base bb
)

select * from benchmark_with_rolling
  );
[0m19:31:23.797692 [debug] [Thread-1  ]: SQL status: BEGIN in 0.010 seconds
[0m19:31:23.798020 [debug] [Thread-4  ]: SQL status: BEGIN in 0.011 seconds
[0m19:31:23.798302 [debug] [Thread-2  ]: On test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f: Close
[0m19:31:23.798589 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.int_fund_nav"
[0m19:31:23.798882 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.int_cashflow_enriched"
[0m19:31:23.799546 [info ] [Thread-2  ]: 30 of 57 PASS unique_stg_positions_position_id ................................. [[32mPASS[0m in 0.10s]
[0m19:31:23.799969 [debug] [Thread-1  ]: On model.bain_capital_analytics.int_fund_nav: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.int_fund_nav"} */

  create view "bain_analytics"."public"."int_fund_nav__dbt_tmp"
    
    
  as (
    -- Pipeline C: Fund-level NAV calculation from portfolio valuations
-- Anti-pattern: late aggregation - joins everything then aggregates at the end
-- Anti-pattern: repeated joins to fund_structures and portfolios

with portfolio_valuations as (
    select
        v.portfolio_id,
        v.valuation_date,
        v.net_asset_value,
        v.gross_asset_value,
        v.total_liabilities,
        v.unrealized_pnl,
        v.realized_pnl,
        v.valuation_method,
        p.fund_id,
        p.portfolio_name,
        p.strategy,
        -- Anti-pattern: joining fund_structures again (already done in int_cashflow_enriched)
        fs.fund_name,
        fs.fund_type,
        fs.committed_capital,
        fs.management_fee_rate
    from "bain_analytics"."public"."stg_valuations" v
    inner join "bain_analytics"."public"."stg_portfolios" p
        on v.portfolio_id = p.portfolio_id
    inner join "bain_analytics"."public"."stg_fund_structures" fs
        on p.fund_id = fs.fund_id
),

-- Anti-pattern: aggregation happens here at the end after all joins
fund_level_nav as (
    select
        fund_id,
        fund_name,
        fund_type,
        committed_capital,
        management_fee_rate,
        valuation_date,
        sum(net_asset_value) as fund_nav,
        sum(gross_asset_value) as fund_gav,
        sum(total_liabilities) as fund_total_liabilities,
        sum(unrealized_pnl) as fund_unrealized_pnl,
        sum(realized_pnl) as fund_realized_pnl,
        count(distinct portfolio_id) as num_portfolios
    from portfolio_valuations
    group by
        fund_id, fund_name, fund_type, committed_capital,
        management_fee_rate, valuation_date
),

fund_nav_with_changes as (
    select
        fn.*,
        lag(fn.fund_nav) over (
            partition by fn.fund_id order by fn.valuation_date
        ) as prev_fund_nav,
        case
            when lag(fn.fund_nav) over (
                partition by fn.fund_id order by fn.valuation_date
            ) is not null
            and lag(fn.fund_nav) over (
                partition by fn.fund_id order by fn.valuation_date
            ) != 0
            then (fn.fund_nav - lag(fn.fund_nav) over (
                partition by fn.fund_id order by fn.valuation_date
            )) / lag(fn.fund_nav) over (
                partition by fn.fund_id order by fn.valuation_date
            )
            else null
        end as fund_nav_return,
        fn.fund_nav / nullif(fn.committed_capital, 0) as tvpi_gross
    from fund_level_nav fn
)

select * from fund_nav_with_changes
  );
[0m19:31:23.800447 [debug] [Thread-4  ]: On model.bain_capital_analytics.int_cashflow_enriched: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.int_cashflow_enriched"} */

  create view "bain_analytics"."public"."int_cashflow_enriched__dbt_tmp"
    
    
  as (
    -- Pipeline C: Enriched cashflow data with fund and portfolio details
-- Anti-pattern: subquery for dedup instead of QUALIFY
-- Anti-pattern: joins repeated from other intermediate models

with cashflow_with_details as (
    select *
    from (
        select
            cf.*,
            p.portfolio_name,
            p.strategy,
            p.manager_name,
            fs.fund_name,
            fs.fund_type,
            fs.committed_capital,
            fs.management_fee_rate,
            fs.carry_rate,
            fs.hurdle_rate,
            -- Anti-pattern: subquery filter instead of QUALIFY
            row_number() over (
                partition by cf.cashflow_id
                order by cf.cashflow_date desc
            ) as rn
        from "bain_analytics"."public"."stg_cashflows" cf
        inner join "bain_analytics"."public"."stg_portfolios" p
            on cf.portfolio_id = p.portfolio_id
        inner join "bain_analytics"."public"."stg_fund_structures" fs
            on cf.fund_id = fs.fund_id
    ) sub
    where rn = 1
),

-- Anti-pattern: running totals computed here AND again downstream
cashflow_cumulative as (
    select
        *,
        sum(case when cashflow_type = 'capital_call' then amount else 0 end) over (
            partition by fund_id, portfolio_id
            order by cashflow_date
            rows between unbounded preceding and current row
        ) as cumulative_called,
        sum(case when cashflow_type = 'distribution' then amount else 0 end) over (
            partition by fund_id, portfolio_id
            order by cashflow_date
            rows between unbounded preceding and current row
        ) as cumulative_distributed,
        sum(amount) over (
            partition by fund_id, portfolio_id
            order by cashflow_date
            rows between unbounded preceding and current row
        ) as cumulative_net_cashflow
    from cashflow_with_details
)

select
    cashflow_id,
    fund_id,
    fund_name,
    fund_type,
    portfolio_id,
    portfolio_name,
    strategy,
    manager_name,
    cashflow_date,
    cashflow_type,
    amount,
    currency,
    description,
    investor_id,
    cashflow_fiscal_quarter,
    cashflow_year,
    committed_capital,
    management_fee_rate,
    carry_rate,
    hurdle_rate,
    cumulative_called,
    cumulative_distributed,
    cumulative_net_cashflow,
    case
        when committed_capital > 0
        then cumulative_called / committed_capital
        else 0
    end as pct_called
from cashflow_cumulative
  );
[0m19:31:23.800957 [debug] [Thread-2  ]: Finished running node test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f
[0m19:31:23.801368 [debug] [Thread-2  ]: Began running node model.bain_capital_analytics.int_irr_calculations
[0m19:31:23.801865 [info ] [Thread-2  ]: 34 of 57 START sql view model public.int_irr_calculations ...................... [RUN]
[0m19:31:23.802252 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.unique_stg_positions_position_id.b28d4a237f, now model.bain_capital_analytics.int_irr_calculations)
[0m19:31:23.802575 [debug] [Thread-3  ]: SQL status: CREATE VIEW in 0.005 seconds
[0m19:31:23.802941 [debug] [Thread-2  ]: Began compiling node model.bain_capital_analytics.int_irr_calculations
[0m19:31:23.805890 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.int_benchmark_returns"
[0m19:31:23.809594 [debug] [Thread-2  ]: Writing injected SQL for node "model.bain_capital_analytics.int_irr_calculations"
[0m19:31:23.809935 [debug] [Thread-4  ]: SQL status: CREATE VIEW in 0.009 seconds
[0m19:31:23.810219 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.009 seconds
[0m19:31:23.810510 [debug] [Thread-3  ]: On model.bain_capital_analytics.int_benchmark_returns: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.int_benchmark_returns"} */
alter table "bain_analytics"."public"."int_benchmark_returns__dbt_tmp" rename to "int_benchmark_returns"
[0m19:31:23.813181 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.int_cashflow_enriched"
[0m19:31:23.816646 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.int_fund_nav"
[0m19:31:23.817073 [debug] [Thread-4  ]: On model.bain_capital_analytics.int_cashflow_enriched: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.int_cashflow_enriched"} */
alter table "bain_analytics"."public"."int_cashflow_enriched__dbt_tmp" rename to "int_cashflow_enriched"
[0m19:31:23.817398 [debug] [Thread-1  ]: On model.bain_capital_analytics.int_fund_nav: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.int_fund_nav"} */
alter table "bain_analytics"."public"."int_fund_nav__dbt_tmp" rename to "int_fund_nav"
[0m19:31:23.817699 [debug] [Thread-2  ]: Began executing node model.bain_capital_analytics.int_irr_calculations
[0m19:31:23.818061 [debug] [Thread-3  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m19:31:23.821411 [debug] [Thread-2  ]: Writing runtime sql for node "model.bain_capital_analytics.int_irr_calculations"
[0m19:31:23.821720 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.004 seconds
[0m19:31:23.822838 [debug] [Thread-3  ]: On model.bain_capital_analytics.int_benchmark_returns: COMMIT
[0m19:31:23.823133 [debug] [Thread-4  ]: SQL status: ALTER TABLE in 0.005 seconds
[0m19:31:23.824120 [debug] [Thread-1  ]: On model.bain_capital_analytics.int_fund_nav: COMMIT
[0m19:31:23.824430 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.int_benchmark_returns"
[0m19:31:23.825458 [debug] [Thread-4  ]: On model.bain_capital_analytics.int_cashflow_enriched: COMMIT
[0m19:31:23.825811 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.int_irr_calculations"
[0m19:31:23.826100 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.int_fund_nav"
[0m19:31:23.826401 [debug] [Thread-3  ]: On model.bain_capital_analytics.int_benchmark_returns: COMMIT
[0m19:31:23.826708 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.int_cashflow_enriched"
[0m19:31:23.827006 [debug] [Thread-2  ]: On model.bain_capital_analytics.int_irr_calculations: BEGIN
[0m19:31:23.827301 [debug] [Thread-1  ]: On model.bain_capital_analytics.int_fund_nav: COMMIT
[0m19:31:23.827628 [debug] [Thread-4  ]: On model.bain_capital_analytics.int_cashflow_enriched: COMMIT
[0m19:31:23.827918 [debug] [Thread-2  ]: Opening a new connection, currently in state closed
[0m19:31:23.828486 [debug] [Thread-3  ]: SQL status: COMMIT in 0.001 seconds
[0m19:31:23.830698 [debug] [Thread-3  ]: Applying DROP to: "bain_analytics"."public"."int_benchmark_returns__dbt_backup"
[0m19:31:23.831024 [debug] [Thread-4  ]: SQL status: COMMIT in 0.003 seconds
[0m19:31:23.831471 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.int_benchmark_returns"
[0m19:31:23.831762 [debug] [Thread-1  ]: SQL status: COMMIT in 0.004 seconds
[0m19:31:23.834027 [debug] [Thread-4  ]: Applying DROP to: "bain_analytics"."public"."int_cashflow_enriched__dbt_backup"
[0m19:31:23.834347 [debug] [Thread-3  ]: On model.bain_capital_analytics.int_benchmark_returns: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.int_benchmark_returns"} */
drop view if exists "bain_analytics"."public"."int_benchmark_returns__dbt_backup" cascade
[0m19:31:23.836438 [debug] [Thread-1  ]: Applying DROP to: "bain_analytics"."public"."int_fund_nav__dbt_backup"
[0m19:31:23.837725 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.int_cashflow_enriched"
[0m19:31:23.838040 [debug] [Thread-2  ]: SQL status: BEGIN in 0.010 seconds
[0m19:31:23.838509 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.int_fund_nav"
[0m19:31:23.838826 [debug] [Thread-3  ]: SQL status: DROP VIEW in 0.000 seconds
[0m19:31:23.839117 [debug] [Thread-4  ]: On model.bain_capital_analytics.int_cashflow_enriched: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.int_cashflow_enriched"} */
drop view if exists "bain_analytics"."public"."int_cashflow_enriched__dbt_backup" cascade
[0m19:31:23.839420 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.int_irr_calculations"
[0m19:31:23.839713 [debug] [Thread-1  ]: On model.bain_capital_analytics.int_fund_nav: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.int_fund_nav"} */
drop view if exists "bain_analytics"."public"."int_fund_nav__dbt_backup" cascade
[0m19:31:23.840713 [debug] [Thread-3  ]: On model.bain_capital_analytics.int_benchmark_returns: Close
[0m19:31:23.841186 [debug] [Thread-2  ]: On model.bain_capital_analytics.int_irr_calculations: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.int_irr_calculations"} */

  create view "bain_analytics"."public"."int_irr_calculations__dbt_tmp"
    
    
  as (
    -- Pipeline C: Approximate IRR calculation per fund/portfolio
-- Anti-pattern: extremely deep CTE nesting (6 levels)
-- Anti-pattern: PostgreSQL-specific date arithmetic
-- Anti-pattern: complex logic that should be a macro

with cashflow_series as (
    -- CTE level 1: get all cashflows with proper signs
    select
        cf.fund_id,
        cf.portfolio_id,
        cf.cashflow_date,
        cf.cashflow_type,
        case
            when cf.cashflow_type = 'capital_call' then -1 * abs(cf.amount)
            when cf.cashflow_type = 'distribution' then abs(cf.amount)
            when cf.cashflow_type = 'management_fee' then -1 * abs(cf.amount)
            else cf.amount
        end as signed_amount
    from "bain_analytics"."public"."stg_cashflows" cf
),

terminal_values as (
    -- CTE level 2: get latest NAV as terminal cashflow
    select
        v.portfolio_id,
        p.fund_id,
        v.valuation_date as cashflow_date,
        'terminal_value' as cashflow_type,
        v.net_asset_value as signed_amount
    from "bain_analytics"."public"."stg_valuations" v
    inner join "bain_analytics"."public"."stg_portfolios" p
        on v.portfolio_id = p.portfolio_id
    where v.valuation_date = (
        -- Anti-pattern: correlated subquery instead of window function
        select max(v2.valuation_date)
        from "bain_analytics"."public"."stg_valuations" v2
        where v2.portfolio_id = v.portfolio_id
    )
),

all_cashflows as (
    -- CTE level 3: union cashflows and terminal values
    select fund_id, portfolio_id, cashflow_date, cashflow_type, signed_amount
    from cashflow_series
    union all
    select fund_id, portfolio_id, cashflow_date, cashflow_type, signed_amount
    from terminal_values
),

cashflow_with_timing as (
    -- CTE level 4: compute time fractions
    -- Anti-pattern: PostgreSQL date subtraction
    select
        ac.*,
        min(ac.cashflow_date) over (partition by ac.fund_id, ac.portfolio_id) as first_cf_date,
        (ac.cashflow_date - min(ac.cashflow_date) over (partition by ac.fund_id, ac.portfolio_id))::numeric / 365.25 as year_fraction
    from all_cashflows ac
),

-- CTE level 5: compute simple multiples as IRR proxy
portfolio_multiples as (
    select
        fund_id,
        portfolio_id,
        min(cashflow_date) as first_cashflow_date,
        max(cashflow_date) as last_cashflow_date,
        -- Anti-pattern: PostgreSQL date subtraction
        max(cashflow_date) - min(cashflow_date) as investment_days,
        (max(cashflow_date) - min(cashflow_date))::numeric / 365.25 as investment_years,
        sum(case when cashflow_type = 'capital_call' then abs(signed_amount) else 0 end) as total_invested,
        sum(case when cashflow_type = 'distribution' then signed_amount else 0 end) as total_distributed,
        sum(case when cashflow_type = 'terminal_value' then signed_amount else 0 end) as terminal_value,
        sum(signed_amount) as net_cashflow
    from cashflow_with_timing
    group by fund_id, portfolio_id
),

-- CTE level 6: compute IRR approximation
irr_approximation as (
    select
        pm.*,
        case
            when pm.total_invested > 0
            then (pm.total_distributed + pm.terminal_value) / pm.total_invested
            else null
        end as tvpi,
        case
            when pm.total_invested > 0
            then pm.total_distributed / pm.total_invested
            else null
        end as dpi,
        case
            when pm.total_invested > 0
            then pm.terminal_value / pm.total_invested
            else null
        end as rvpi,
        -- Simplified IRR approximation: (TVPI^(1/years)) - 1
        case
            when pm.total_invested > 0 and pm.investment_years > 0
            then power(
                (pm.total_distributed + pm.terminal_value) / pm.total_invested,
                1.0 / pm.investment_years
            ) - 1
            else null
        end as approx_irr
    from portfolio_multiples pm
)

select * from irr_approximation
  );
[0m19:31:23.841629 [debug] [Thread-4  ]: SQL status: DROP VIEW in 0.001 seconds
[0m19:31:23.842142 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b681c8a7-b3f4-41ea-b625-4a93cae2ea4b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10af58340>]}
[0m19:31:23.842457 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.001 seconds
[0m19:31:23.843380 [debug] [Thread-4  ]: On model.bain_capital_analytics.int_cashflow_enriched: Close
[0m19:31:23.844448 [debug] [Thread-1  ]: On model.bain_capital_analytics.int_fund_nav: Close
[0m19:31:23.844903 [info ] [Thread-3  ]: 31 of 57 OK created sql view model public.int_benchmark_returns ................ [[32mCREATE VIEW[0m in 0.09s]
[0m19:31:23.845372 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b681c8a7-b3f4-41ea-b625-4a93cae2ea4b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ae03520>]}
[0m19:31:23.845920 [debug] [Thread-3  ]: Finished running node model.bain_capital_analytics.int_benchmark_returns
[0m19:31:23.846203 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b681c8a7-b3f4-41ea-b625-4a93cae2ea4b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ade57c0>]}
[0m19:31:23.846709 [info ] [Thread-4  ]: 32 of 57 OK created sql view model public.int_cashflow_enriched ................ [[32mCREATE VIEW[0m in 0.09s]
[0m19:31:23.847055 [debug] [Thread-3  ]: Began running node model.bain_capital_analytics.int_valuation_enriched
[0m19:31:23.847643 [info ] [Thread-1  ]: 33 of 57 OK created sql view model public.int_fund_nav ......................... [[32mCREATE VIEW[0m in 0.09s]
[0m19:31:23.848089 [debug] [Thread-4  ]: Finished running node model.bain_capital_analytics.int_cashflow_enriched
[0m19:31:23.848462 [info ] [Thread-3  ]: 35 of 57 START sql view model public.int_valuation_enriched .................... [RUN]
[0m19:31:23.848885 [debug] [Thread-1  ]: Finished running node model.bain_capital_analytics.int_fund_nav
[0m19:31:23.849302 [debug] [Thread-4  ]: Began running node model.bain_capital_analytics.fact_portfolio_summary
[0m19:31:23.849660 [debug] [Thread-2  ]: SQL status: CREATE VIEW in 0.007 seconds
[0m19:31:23.850045 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly model.bain_capital_analytics.int_benchmark_returns, now model.bain_capital_analytics.int_valuation_enriched)
[0m19:31:23.850392 [debug] [Thread-1  ]: Began running node model.bain_capital_analytics.int_portfolio_attribution
[0m19:31:23.850814 [info ] [Thread-4  ]: 36 of 57 START sql view model public.fact_portfolio_summary .................... [RUN]
[0m19:31:23.853502 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.int_irr_calculations"
[0m19:31:23.853821 [debug] [Thread-3  ]: Began compiling node model.bain_capital_analytics.int_valuation_enriched
[0m19:31:23.854283 [info ] [Thread-1  ]: 37 of 57 START sql view model public.int_portfolio_attribution ................. [RUN]
[0m19:31:23.854631 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly model.bain_capital_analytics.int_cashflow_enriched, now model.bain_capital_analytics.fact_portfolio_summary)
[0m19:31:23.854943 [debug] [Thread-2  ]: On model.bain_capital_analytics.int_irr_calculations: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.int_irr_calculations"} */
alter table "bain_analytics"."public"."int_irr_calculations__dbt_tmp" rename to "int_irr_calculations"
[0m19:31:23.858055 [debug] [Thread-3  ]: Writing injected SQL for node "model.bain_capital_analytics.int_valuation_enriched"
[0m19:31:23.858398 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.bain_capital_analytics.int_fund_nav, now model.bain_capital_analytics.int_portfolio_attribution)
[0m19:31:23.858698 [debug] [Thread-4  ]: Began compiling node model.bain_capital_analytics.fact_portfolio_summary
[0m19:31:23.859103 [debug] [Thread-1  ]: Began compiling node model.bain_capital_analytics.int_portfolio_attribution
[0m19:31:23.861940 [debug] [Thread-4  ]: Writing injected SQL for node "model.bain_capital_analytics.fact_portfolio_summary"
[0m19:31:23.862269 [debug] [Thread-2  ]: SQL status: ALTER TABLE in 0.003 seconds
[0m19:31:23.865396 [debug] [Thread-1  ]: Writing injected SQL for node "model.bain_capital_analytics.int_portfolio_attribution"
[0m19:31:23.866600 [debug] [Thread-2  ]: On model.bain_capital_analytics.int_irr_calculations: COMMIT
[0m19:31:23.866930 [debug] [Thread-3  ]: Began executing node model.bain_capital_analytics.int_valuation_enriched
[0m19:31:23.867278 [debug] [Thread-4  ]: Began executing node model.bain_capital_analytics.fact_portfolio_summary
[0m19:31:23.867582 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.int_irr_calculations"
[0m19:31:23.870839 [debug] [Thread-3  ]: Writing runtime sql for node "model.bain_capital_analytics.int_valuation_enriched"
[0m19:31:23.875127 [debug] [Thread-4  ]: Writing runtime sql for node "model.bain_capital_analytics.fact_portfolio_summary"
[0m19:31:23.875454 [debug] [Thread-1  ]: Began executing node model.bain_capital_analytics.int_portfolio_attribution
[0m19:31:23.875744 [debug] [Thread-2  ]: On model.bain_capital_analytics.int_irr_calculations: COMMIT
[0m19:31:23.879041 [debug] [Thread-1  ]: Writing runtime sql for node "model.bain_capital_analytics.int_portfolio_attribution"
[0m19:31:23.879524 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.int_valuation_enriched"
[0m19:31:23.879866 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.fact_portfolio_summary"
[0m19:31:23.880160 [debug] [Thread-3  ]: On model.bain_capital_analytics.int_valuation_enriched: BEGIN
[0m19:31:23.880487 [debug] [Thread-4  ]: On model.bain_capital_analytics.fact_portfolio_summary: BEGIN
[0m19:31:23.880784 [debug] [Thread-3  ]: Opening a new connection, currently in state closed
[0m19:31:23.881094 [debug] [Thread-2  ]: SQL status: COMMIT in 0.002 seconds
[0m19:31:23.881408 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.int_portfolio_attribution"
[0m19:31:23.881682 [debug] [Thread-4  ]: Opening a new connection, currently in state closed
[0m19:31:23.884041 [debug] [Thread-2  ]: Applying DROP to: "bain_analytics"."public"."int_irr_calculations__dbt_backup"
[0m19:31:23.884370 [debug] [Thread-1  ]: On model.bain_capital_analytics.int_portfolio_attribution: BEGIN
[0m19:31:23.884964 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.int_irr_calculations"
[0m19:31:23.885269 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m19:31:23.885589 [debug] [Thread-2  ]: On model.bain_capital_analytics.int_irr_calculations: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.int_irr_calculations"} */
drop view if exists "bain_analytics"."public"."int_irr_calculations__dbt_backup" cascade
[0m19:31:23.886681 [debug] [Thread-2  ]: SQL status: DROP VIEW in 0.001 seconds
[0m19:31:23.887724 [debug] [Thread-2  ]: On model.bain_capital_analytics.int_irr_calculations: Close
[0m19:31:23.888206 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b681c8a7-b3f4-41ea-b625-4a93cae2ea4b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ad796a0>]}
[0m19:31:23.888724 [info ] [Thread-2  ]: 34 of 57 OK created sql view model public.int_irr_calculations ................. [[32mCREATE VIEW[0m in 0.09s]
[0m19:31:23.889170 [debug] [Thread-2  ]: Finished running node model.bain_capital_analytics.int_irr_calculations
[0m19:31:23.889491 [debug] [Thread-2  ]: Began running node test.bain_capital_analytics.not_null_int_benchmark_returns_benchmark_id.fa96f53b44
[0m19:31:23.889801 [info ] [Thread-2  ]: 38 of 57 START test not_null_int_benchmark_returns_benchmark_id ................ [RUN]
[0m19:31:23.890209 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly model.bain_capital_analytics.int_irr_calculations, now test.bain_capital_analytics.not_null_int_benchmark_returns_benchmark_id.fa96f53b44)
[0m19:31:23.890573 [debug] [Thread-2  ]: Began compiling node test.bain_capital_analytics.not_null_int_benchmark_returns_benchmark_id.fa96f53b44
[0m19:31:23.894267 [debug] [Thread-2  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_int_benchmark_returns_benchmark_id.fa96f53b44"
[0m19:31:23.894850 [debug] [Thread-2  ]: Began executing node test.bain_capital_analytics.not_null_int_benchmark_returns_benchmark_id.fa96f53b44
[0m19:31:23.897112 [debug] [Thread-2  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_int_benchmark_returns_benchmark_id.fa96f53b44"
[0m19:31:23.897450 [debug] [Thread-1  ]: SQL status: BEGIN in 0.012 seconds
[0m19:31:23.897768 [debug] [Thread-3  ]: SQL status: BEGIN in 0.017 seconds
[0m19:31:23.898101 [debug] [Thread-4  ]: SQL status: BEGIN in 0.016 seconds
[0m19:31:23.898415 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.int_portfolio_attribution"
[0m19:31:23.898730 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.int_valuation_enriched"
[0m19:31:23.899074 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.fact_portfolio_summary"
[0m19:31:23.899449 [debug] [Thread-2  ]: Using postgres connection "test.bain_capital_analytics.not_null_int_benchmark_returns_benchmark_id.fa96f53b44"
[0m19:31:23.899848 [debug] [Thread-1  ]: On model.bain_capital_analytics.int_portfolio_attribution: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.int_portfolio_attribution"} */

  create view "bain_analytics"."public"."int_portfolio_attribution__dbt_tmp"
    
    
  as (
    -- Pipeline C: Portfolio performance attribution by sector and instrument type
-- Anti-pattern: deep CTE chain, repeated joins, late aggregation
-- Anti-pattern: same position-instrument-portfolio joins as int_daily_positions

with positions_enriched as (
    -- Anti-pattern: repeating the same 3-way join as int_daily_positions
    select
        pos.position_id,
        pos.portfolio_id,
        pos.instrument_id,
        pos.position_date,
        pos.quantity,
        pos.market_value,
        pos.cost_basis,
        pos.unrealized_gain_loss,
        i.instrument_name,
        i.instrument_type,
        i.sector,
        p.portfolio_name,
        p.strategy,
        p.fund_id
    from "bain_analytics"."public"."stg_positions" pos
    inner join "bain_analytics"."public"."stg_instruments" i
        on pos.instrument_id = i.instrument_id
    inner join "bain_analytics"."public"."stg_portfolios" p
        on pos.portfolio_id = p.portfolio_id
),

-- Anti-pattern: compute portfolio totals in a separate CTE instead of a single pass
portfolio_totals as (
    select
        portfolio_id,
        position_date,
        sum(market_value) as total_portfolio_mv,
        sum(unrealized_gain_loss) as total_portfolio_ugl
    from positions_enriched
    group by portfolio_id, position_date
),

-- Anti-pattern: sector aggregation in yet another CTE
sector_attribution as (
    select
        pe.portfolio_id,
        pe.portfolio_name,
        pe.strategy,
        pe.fund_id,
        pe.position_date,
        pe.sector,
        sum(pe.market_value) as sector_mv,
        sum(pe.unrealized_gain_loss) as sector_ugl,
        count(distinct pe.instrument_id) as num_instruments
    from positions_enriched pe
    group by
        pe.portfolio_id, pe.portfolio_name, pe.strategy,
        pe.fund_id, pe.position_date, pe.sector
),

-- Anti-pattern: joining back to get weights instead of computing in one pass
attribution_with_weights as (
    select
        sa.*,
        pt.total_portfolio_mv,
        pt.total_portfolio_ugl,
        case
            when pt.total_portfolio_mv != 0
            then sa.sector_mv / pt.total_portfolio_mv
            else 0
        end as sector_weight,
        case
            when pt.total_portfolio_ugl != 0
            then sa.sector_ugl / pt.total_portfolio_ugl
            else 0
        end as sector_contribution
    from sector_attribution sa
    inner join portfolio_totals pt
        on sa.portfolio_id = pt.portfolio_id
        and sa.position_date = pt.position_date
)

select * from attribution_with_weights
  );
[0m19:31:23.900307 [debug] [Thread-3  ]: On model.bain_capital_analytics.int_valuation_enriched: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.int_valuation_enriched"} */

  create view "bain_analytics"."public"."int_valuation_enriched__dbt_tmp"
    
    
  as (
    -- Pipeline C: Enriched valuation data
-- Anti-pattern: subquery for dedup instead of QUALIFY
-- Anti-pattern: repeated portfolio join
-- Anti-pattern: PostgreSQL-specific date functions

with valuation_ranked as (
    select *
    from (
        select
            v.*,
            p.portfolio_name,
            p.strategy,
            p.fund_id,
            p.manager_name,
            -- Anti-pattern: subquery dedup instead of QUALIFY
            row_number() over (
                partition by v.portfolio_id, v.valuation_date
                order by v.valuation_id desc
            ) as rn
        from "bain_analytics"."public"."stg_valuations" v
        inner join "bain_analytics"."public"."stg_portfolios" p
            on v.portfolio_id = p.portfolio_id
    ) sub
    where rn = 1
),

valuation_with_changes as (
    select
        vr.*,
        lag(vr.net_asset_value) over (
            partition by vr.portfolio_id order by vr.valuation_date
        ) as prev_nav,
        case
            when lag(vr.net_asset_value) over (
                partition by vr.portfolio_id order by vr.valuation_date
            ) is not null
            and lag(vr.net_asset_value) over (
                partition by vr.portfolio_id order by vr.valuation_date
            ) != 0
            then (vr.net_asset_value - lag(vr.net_asset_value) over (
                partition by vr.portfolio_id order by vr.valuation_date
            )) / lag(vr.net_asset_value) over (
                partition by vr.portfolio_id order by vr.valuation_date
            )
            else null
        end as nav_return_pct,
        -- Anti-pattern: PostgreSQL date subtraction
        vr.valuation_date - lag(vr.valuation_date) over (
            partition by vr.portfolio_id order by vr.valuation_date
        ) as days_between_valuations
    from valuation_ranked vr
)

select * from valuation_with_changes
  );
[0m19:31:23.900728 [debug] [Thread-4  ]: On model.bain_capital_analytics.fact_portfolio_summary: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.fact_portfolio_summary"} */

  create view "bain_analytics"."public"."fact_portfolio_summary__dbt_tmp"
    
    
  as (
    -- Pipeline A: FACT table - Portfolio summary with positions
-- Anti-pattern: unnecessary DISTINCT on already-unique aggregation
-- Anti-pattern: late filtering (filters at the end instead of upstream)
-- Anti-pattern: materialized as view (should be table)

select distinct
    p.portfolio_id,
    p.portfolio_name,
    p.strategy,
    p.fund_id,
    p.manager_name,
    pos.position_date,
    count(distinct pos.instrument_id) as num_positions,
    sum(pos.market_value) as total_market_value,
    sum(pos.cost_basis) as total_cost_basis,
    sum(pos.unrealized_gain_loss) as total_unrealized_pnl,
    case
        when sum(pos.cost_basis) != 0
        then sum(pos.unrealized_gain_loss) / abs(sum(pos.cost_basis))
        else 0
    end as portfolio_return_pct,
    max(pos.market_value) as largest_position_mv,
    min(pos.market_value) as smallest_position_mv
from "bain_analytics"."public"."stg_portfolios" p
inner join "bain_analytics"."public"."stg_positions" pos
    on p.portfolio_id = pos.portfolio_id
-- Anti-pattern: filter at the end instead of in staging
where p.is_active = true
group by
    p.portfolio_id,
    p.portfolio_name,
    p.strategy,
    p.fund_id,
    p.manager_name,
    pos.position_date
  );
[0m19:31:23.901064 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_int_benchmark_returns_benchmark_id.fa96f53b44: BEGIN
[0m19:31:23.901446 [debug] [Thread-2  ]: Opening a new connection, currently in state closed
[0m19:31:23.907477 [debug] [Thread-4  ]: SQL status: CREATE VIEW in 0.006 seconds
[0m19:31:23.907770 [debug] [Thread-3  ]: SQL status: CREATE VIEW in 0.006 seconds
[0m19:31:23.911375 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.fact_portfolio_summary"
[0m19:31:23.911703 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.010 seconds
[0m19:31:23.914228 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.int_valuation_enriched"
[0m19:31:23.914563 [debug] [Thread-4  ]: On model.bain_capital_analytics.fact_portfolio_summary: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.fact_portfolio_summary"} */
alter table "bain_analytics"."public"."fact_portfolio_summary__dbt_tmp" rename to "fact_portfolio_summary"
[0m19:31:23.917233 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.int_portfolio_attribution"
[0m19:31:23.917544 [debug] [Thread-2  ]: SQL status: BEGIN in 0.016 seconds
[0m19:31:23.917834 [debug] [Thread-3  ]: On model.bain_capital_analytics.int_valuation_enriched: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.int_valuation_enriched"} */
alter table "bain_analytics"."public"."int_valuation_enriched__dbt_tmp" rename to "int_valuation_enriched"
[0m19:31:23.918174 [debug] [Thread-1  ]: On model.bain_capital_analytics.int_portfolio_attribution: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.int_portfolio_attribution"} */
alter table "bain_analytics"."public"."int_portfolio_attribution__dbt_tmp" rename to "int_portfolio_attribution"
[0m19:31:23.918483 [debug] [Thread-2  ]: Using postgres connection "test.bain_capital_analytics.not_null_int_benchmark_returns_benchmark_id.fa96f53b44"
[0m19:31:23.918854 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_int_benchmark_returns_benchmark_id.fa96f53b44: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_int_benchmark_returns_benchmark_id.fa96f53b44"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select benchmark_id
from "bain_analytics"."public"."int_benchmark_returns"
where benchmark_id is null



  
  
      
    ) dbt_internal_test
[0m19:31:23.919166 [debug] [Thread-4  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m19:31:23.920117 [debug] [Thread-4  ]: On model.bain_capital_analytics.fact_portfolio_summary: COMMIT
[0m19:31:23.920422 [debug] [Thread-3  ]: SQL status: ALTER TABLE in 0.002 seconds
[0m19:31:23.920700 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.002 seconds
[0m19:31:23.920978 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.fact_portfolio_summary"
[0m19:31:23.921933 [debug] [Thread-3  ]: On model.bain_capital_analytics.int_valuation_enriched: COMMIT
[0m19:31:23.922859 [debug] [Thread-1  ]: On model.bain_capital_analytics.int_portfolio_attribution: COMMIT
[0m19:31:23.923173 [debug] [Thread-2  ]: SQL status: SELECT 1 in 0.004 seconds
[0m19:31:23.923456 [debug] [Thread-4  ]: On model.bain_capital_analytics.fact_portfolio_summary: COMMIT
[0m19:31:23.923747 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.int_valuation_enriched"
[0m19:31:23.924035 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.int_portfolio_attribution"
[0m19:31:23.925246 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_int_benchmark_returns_benchmark_id.fa96f53b44: ROLLBACK
[0m19:31:23.925595 [debug] [Thread-3  ]: On model.bain_capital_analytics.int_valuation_enriched: COMMIT
[0m19:31:23.925894 [debug] [Thread-1  ]: On model.bain_capital_analytics.int_portfolio_attribution: COMMIT
[0m19:31:23.926539 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_int_benchmark_returns_benchmark_id.fa96f53b44: Close
[0m19:31:23.926851 [debug] [Thread-3  ]: SQL status: COMMIT in 0.001 seconds
[0m19:31:23.927183 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m19:31:23.927651 [info ] [Thread-2  ]: 38 of 57 PASS not_null_int_benchmark_returns_benchmark_id ...................... [[32mPASS[0m in 0.04s]
[0m19:31:23.929938 [debug] [Thread-3  ]: Applying DROP to: "bain_analytics"."public"."int_valuation_enriched__dbt_backup"
[0m19:31:23.930232 [debug] [Thread-4  ]: SQL status: COMMIT in 0.005 seconds
[0m19:31:23.932412 [debug] [Thread-1  ]: Applying DROP to: "bain_analytics"."public"."int_portfolio_attribution__dbt_backup"
[0m19:31:23.932878 [debug] [Thread-2  ]: Finished running node test.bain_capital_analytics.not_null_int_benchmark_returns_benchmark_id.fa96f53b44
[0m19:31:23.933344 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.int_valuation_enriched"
[0m19:31:23.935433 [debug] [Thread-4  ]: Applying DROP to: "bain_analytics"."public"."fact_portfolio_summary__dbt_backup"
[0m19:31:23.935886 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.int_portfolio_attribution"
[0m19:31:23.936231 [debug] [Thread-2  ]: Began running node test.bain_capital_analytics.not_null_int_cashflow_enriched_cashflow_id.8460e9066d
[0m19:31:23.936599 [debug] [Thread-3  ]: On model.bain_capital_analytics.int_valuation_enriched: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.int_valuation_enriched"} */
drop view if exists "bain_analytics"."public"."int_valuation_enriched__dbt_backup" cascade
[0m19:31:23.937074 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.fact_portfolio_summary"
[0m19:31:23.937389 [debug] [Thread-1  ]: On model.bain_capital_analytics.int_portfolio_attribution: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.int_portfolio_attribution"} */
drop view if exists "bain_analytics"."public"."int_portfolio_attribution__dbt_backup" cascade
[0m19:31:23.937711 [info ] [Thread-2  ]: 39 of 57 START test not_null_int_cashflow_enriched_cashflow_id ................. [RUN]
[0m19:31:23.938082 [debug] [Thread-4  ]: On model.bain_capital_analytics.fact_portfolio_summary: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.fact_portfolio_summary"} */
drop view if exists "bain_analytics"."public"."fact_portfolio_summary__dbt_backup" cascade
[0m19:31:23.938464 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.not_null_int_benchmark_returns_benchmark_id.fa96f53b44, now test.bain_capital_analytics.not_null_int_cashflow_enriched_cashflow_id.8460e9066d)
[0m19:31:23.938781 [debug] [Thread-3  ]: SQL status: DROP VIEW in 0.001 seconds
[0m19:31:23.939079 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.001 seconds
[0m19:31:23.939370 [debug] [Thread-2  ]: Began compiling node test.bain_capital_analytics.not_null_int_cashflow_enriched_cashflow_id.8460e9066d
[0m19:31:23.941281 [debug] [Thread-3  ]: On model.bain_capital_analytics.int_valuation_enriched: Close
[0m19:31:23.941568 [debug] [Thread-4  ]: SQL status: DROP VIEW in 0.003 seconds
[0m19:31:23.942509 [debug] [Thread-1  ]: On model.bain_capital_analytics.int_portfolio_attribution: Close
[0m19:31:23.946119 [debug] [Thread-2  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_int_cashflow_enriched_cashflow_id.8460e9066d"
[0m19:31:23.946604 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b681c8a7-b3f4-41ea-b625-4a93cae2ea4b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10af58340>]}
[0m19:31:23.947523 [debug] [Thread-4  ]: On model.bain_capital_analytics.fact_portfolio_summary: Close
[0m19:31:23.947945 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b681c8a7-b3f4-41ea-b625-4a93cae2ea4b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10afcbe20>]}
[0m19:31:23.948536 [info ] [Thread-3  ]: 35 of 57 OK created sql view model public.int_valuation_enriched ............... [[32mCREATE VIEW[0m in 0.10s]
[0m19:31:23.948955 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b681c8a7-b3f4-41ea-b625-4a93cae2ea4b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ae03520>]}
[0m19:31:23.949538 [info ] [Thread-1  ]: 37 of 57 OK created sql view model public.int_portfolio_attribution ............ [[32mCREATE VIEW[0m in 0.09s]
[0m19:31:23.949868 [debug] [Thread-2  ]: Began executing node test.bain_capital_analytics.not_null_int_cashflow_enriched_cashflow_id.8460e9066d
[0m19:31:23.950286 [debug] [Thread-3  ]: Finished running node model.bain_capital_analytics.int_valuation_enriched
[0m19:31:23.950797 [info ] [Thread-4  ]: 36 of 57 OK created sql view model public.fact_portfolio_summary ............... [[32mCREATE VIEW[0m in 0.09s]
[0m19:31:23.951228 [debug] [Thread-1  ]: Finished running node model.bain_capital_analytics.int_portfolio_attribution
[0m19:31:23.953574 [debug] [Thread-2  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_int_cashflow_enriched_cashflow_id.8460e9066d"
[0m19:31:23.953916 [debug] [Thread-3  ]: Began running node test.bain_capital_analytics.unique_int_cashflow_enriched_cashflow_id.6944893c17
[0m19:31:23.954392 [debug] [Thread-4  ]: Finished running node model.bain_capital_analytics.fact_portfolio_summary
[0m19:31:23.954783 [debug] [Thread-1  ]: Began running node test.bain_capital_analytics.not_null_int_fund_nav_fund_id.ebf0b6cc99
[0m19:31:23.955242 [info ] [Thread-3  ]: 40 of 57 START test unique_int_cashflow_enriched_cashflow_id ................... [RUN]
[0m19:31:23.955606 [debug] [Thread-4  ]: Began running node test.bain_capital_analytics.not_null_int_irr_calculations_fund_id.35702f5be3
[0m19:31:23.956022 [info ] [Thread-1  ]: 41 of 57 START test not_null_int_fund_nav_fund_id .............................. [RUN]
[0m19:31:23.956365 [debug] [Thread-2  ]: Using postgres connection "test.bain_capital_analytics.not_null_int_cashflow_enriched_cashflow_id.8460e9066d"
[0m19:31:23.956707 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly model.bain_capital_analytics.int_valuation_enriched, now test.bain_capital_analytics.unique_int_cashflow_enriched_cashflow_id.6944893c17)
[0m19:31:23.957024 [info ] [Thread-4  ]: 42 of 57 START test not_null_int_irr_calculations_fund_id ...................... [RUN]
[0m19:31:23.957380 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.bain_capital_analytics.int_portfolio_attribution, now test.bain_capital_analytics.not_null_int_fund_nav_fund_id.ebf0b6cc99)
[0m19:31:23.957686 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_int_cashflow_enriched_cashflow_id.8460e9066d: BEGIN
[0m19:31:23.957979 [debug] [Thread-3  ]: Began compiling node test.bain_capital_analytics.unique_int_cashflow_enriched_cashflow_id.6944893c17
[0m19:31:23.958290 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly model.bain_capital_analytics.fact_portfolio_summary, now test.bain_capital_analytics.not_null_int_irr_calculations_fund_id.35702f5be3)
[0m19:31:23.958593 [debug] [Thread-1  ]: Began compiling node test.bain_capital_analytics.not_null_int_fund_nav_fund_id.ebf0b6cc99
[0m19:31:23.958885 [debug] [Thread-2  ]: Opening a new connection, currently in state closed
[0m19:31:23.962309 [debug] [Thread-3  ]: Writing injected SQL for node "test.bain_capital_analytics.unique_int_cashflow_enriched_cashflow_id.6944893c17"
[0m19:31:23.962637 [debug] [Thread-4  ]: Began compiling node test.bain_capital_analytics.not_null_int_irr_calculations_fund_id.35702f5be3
[0m19:31:23.966104 [debug] [Thread-1  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_int_fund_nav_fund_id.ebf0b6cc99"
[0m19:31:23.969547 [debug] [Thread-4  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_int_irr_calculations_fund_id.35702f5be3"
[0m19:31:23.970032 [debug] [Thread-3  ]: Began executing node test.bain_capital_analytics.unique_int_cashflow_enriched_cashflow_id.6944893c17
[0m19:31:23.973407 [debug] [Thread-3  ]: Writing runtime sql for node "test.bain_capital_analytics.unique_int_cashflow_enriched_cashflow_id.6944893c17"
[0m19:31:23.973845 [debug] [Thread-1  ]: Began executing node test.bain_capital_analytics.not_null_int_fund_nav_fund_id.ebf0b6cc99
[0m19:31:23.975995 [debug] [Thread-1  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_int_fund_nav_fund_id.ebf0b6cc99"
[0m19:31:23.976305 [debug] [Thread-4  ]: Began executing node test.bain_capital_analytics.not_null_int_irr_calculations_fund_id.35702f5be3
[0m19:31:23.978645 [debug] [Thread-4  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_int_irr_calculations_fund_id.35702f5be3"
[0m19:31:23.979003 [debug] [Thread-3  ]: Using postgres connection "test.bain_capital_analytics.unique_int_cashflow_enriched_cashflow_id.6944893c17"
[0m19:31:23.979348 [debug] [Thread-2  ]: SQL status: BEGIN in 0.020 seconds
[0m19:31:23.979677 [debug] [Thread-3  ]: On test.bain_capital_analytics.unique_int_cashflow_enriched_cashflow_id.6944893c17: BEGIN
[0m19:31:23.980009 [debug] [Thread-2  ]: Using postgres connection "test.bain_capital_analytics.not_null_int_cashflow_enriched_cashflow_id.8460e9066d"
[0m19:31:23.980338 [debug] [Thread-1  ]: Using postgres connection "test.bain_capital_analytics.not_null_int_fund_nav_fund_id.ebf0b6cc99"
[0m19:31:23.980649 [debug] [Thread-3  ]: Opening a new connection, currently in state closed
[0m19:31:23.980973 [debug] [Thread-4  ]: Using postgres connection "test.bain_capital_analytics.not_null_int_irr_calculations_fund_id.35702f5be3"
[0m19:31:23.981290 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_int_cashflow_enriched_cashflow_id.8460e9066d: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_int_cashflow_enriched_cashflow_id.8460e9066d"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select cashflow_id
from "bain_analytics"."public"."int_cashflow_enriched"
where cashflow_id is null



  
  
      
    ) dbt_internal_test
[0m19:31:23.981603 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_int_fund_nav_fund_id.ebf0b6cc99: BEGIN
[0m19:31:23.982004 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_int_irr_calculations_fund_id.35702f5be3: BEGIN
[0m19:31:23.982361 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m19:31:23.982730 [debug] [Thread-4  ]: Opening a new connection, currently in state closed
[0m19:31:23.987980 [debug] [Thread-2  ]: SQL status: SELECT 1 in 0.006 seconds
[0m19:31:23.989288 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_int_cashflow_enriched_cashflow_id.8460e9066d: ROLLBACK
[0m19:31:23.989866 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_int_cashflow_enriched_cashflow_id.8460e9066d: Close
[0m19:31:23.990338 [info ] [Thread-2  ]: 39 of 57 PASS not_null_int_cashflow_enriched_cashflow_id ....................... [[32mPASS[0m in 0.05s]
[0m19:31:23.990784 [debug] [Thread-2  ]: Finished running node test.bain_capital_analytics.not_null_int_cashflow_enriched_cashflow_id.8460e9066d
[0m19:31:23.991107 [debug] [Thread-2  ]: Began running node test.bain_capital_analytics.not_null_int_irr_calculations_portfolio_id.5530046e4d
[0m19:31:23.991469 [info ] [Thread-2  ]: 43 of 57 START test not_null_int_irr_calculations_portfolio_id ................. [RUN]
[0m19:31:23.991814 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.not_null_int_cashflow_enriched_cashflow_id.8460e9066d, now test.bain_capital_analytics.not_null_int_irr_calculations_portfolio_id.5530046e4d)
[0m19:31:23.992138 [debug] [Thread-2  ]: Began compiling node test.bain_capital_analytics.not_null_int_irr_calculations_portfolio_id.5530046e4d
[0m19:31:23.995721 [debug] [Thread-2  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_int_irr_calculations_portfolio_id.5530046e4d"
[0m19:31:23.996045 [debug] [Thread-3  ]: SQL status: BEGIN in 0.015 seconds
[0m19:31:23.996457 [debug] [Thread-3  ]: Using postgres connection "test.bain_capital_analytics.unique_int_cashflow_enriched_cashflow_id.6944893c17"
[0m19:31:23.996771 [debug] [Thread-3  ]: On test.bain_capital_analytics.unique_int_cashflow_enriched_cashflow_id.6944893c17: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.unique_int_cashflow_enriched_cashflow_id.6944893c17"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

select
    cashflow_id as unique_field,
    count(*) as n_records

from "bain_analytics"."public"."int_cashflow_enriched"
where cashflow_id is not null
group by cashflow_id
having count(*) > 1



  
  
      
    ) dbt_internal_test
[0m19:31:23.997099 [debug] [Thread-1  ]: SQL status: BEGIN in 0.015 seconds
[0m19:31:23.997379 [debug] [Thread-4  ]: SQL status: BEGIN in 0.015 seconds
[0m19:31:23.997707 [debug] [Thread-1  ]: Using postgres connection "test.bain_capital_analytics.not_null_int_fund_nav_fund_id.ebf0b6cc99"
[0m19:31:23.997994 [debug] [Thread-2  ]: Began executing node test.bain_capital_analytics.not_null_int_irr_calculations_portfolio_id.5530046e4d
[0m19:31:23.998303 [debug] [Thread-4  ]: Using postgres connection "test.bain_capital_analytics.not_null_int_irr_calculations_fund_id.35702f5be3"
[0m19:31:23.998631 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_int_fund_nav_fund_id.ebf0b6cc99: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_int_fund_nav_fund_id.ebf0b6cc99"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select fund_id
from "bain_analytics"."public"."int_fund_nav"
where fund_id is null



  
  
      
    ) dbt_internal_test
[0m19:31:24.001093 [debug] [Thread-2  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_int_irr_calculations_portfolio_id.5530046e4d"
[0m19:31:24.001513 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_int_irr_calculations_fund_id.35702f5be3: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_int_irr_calculations_fund_id.35702f5be3"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select fund_id
from "bain_analytics"."public"."int_irr_calculations"
where fund_id is null



  
  
      
    ) dbt_internal_test
[0m19:31:24.002208 [debug] [Thread-2  ]: Using postgres connection "test.bain_capital_analytics.not_null_int_irr_calculations_portfolio_id.5530046e4d"
[0m19:31:24.002551 [debug] [Thread-3  ]: SQL status: SELECT 1 in 0.005 seconds
[0m19:31:24.002831 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_int_irr_calculations_portfolio_id.5530046e4d: BEGIN
[0m19:31:24.003998 [debug] [Thread-3  ]: On test.bain_capital_analytics.unique_int_cashflow_enriched_cashflow_id.6944893c17: ROLLBACK
[0m19:31:24.004300 [debug] [Thread-2  ]: Opening a new connection, currently in state closed
[0m19:31:24.005002 [debug] [Thread-3  ]: On test.bain_capital_analytics.unique_int_cashflow_enriched_cashflow_id.6944893c17: Close
[0m19:31:24.005467 [info ] [Thread-3  ]: 40 of 57 PASS unique_int_cashflow_enriched_cashflow_id ......................... [[32mPASS[0m in 0.05s]
[0m19:31:24.005912 [debug] [Thread-3  ]: Finished running node test.bain_capital_analytics.unique_int_cashflow_enriched_cashflow_id.6944893c17
[0m19:31:24.006231 [debug] [Thread-3  ]: Began running node test.bain_capital_analytics.not_null_int_valuation_enriched_valuation_id.048a7ba03a
[0m19:31:24.006596 [info ] [Thread-3  ]: 44 of 57 START test not_null_int_valuation_enriched_valuation_id ............... [RUN]
[0m19:31:24.006943 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.unique_int_cashflow_enriched_cashflow_id.6944893c17, now test.bain_capital_analytics.not_null_int_valuation_enriched_valuation_id.048a7ba03a)
[0m19:31:24.007355 [debug] [Thread-3  ]: Began compiling node test.bain_capital_analytics.not_null_int_valuation_enriched_valuation_id.048a7ba03a
[0m19:31:24.007672 [debug] [Thread-1  ]: SQL status: SELECT 1 in 0.006 seconds
[0m19:31:24.011431 [debug] [Thread-3  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_int_valuation_enriched_valuation_id.048a7ba03a"
[0m19:31:24.011725 [debug] [Thread-4  ]: SQL status: SELECT 1 in 0.010 seconds
[0m19:31:24.012769 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_int_fund_nav_fund_id.ebf0b6cc99: ROLLBACK
[0m19:31:24.013928 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_int_irr_calculations_fund_id.35702f5be3: ROLLBACK
[0m19:31:24.014252 [debug] [Thread-2  ]: SQL status: BEGIN in 0.010 seconds
[0m19:31:24.014620 [debug] [Thread-2  ]: Using postgres connection "test.bain_capital_analytics.not_null_int_irr_calculations_portfolio_id.5530046e4d"
[0m19:31:24.014911 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_int_irr_calculations_fund_id.35702f5be3: Close
[0m19:31:24.015205 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_int_fund_nav_fund_id.ebf0b6cc99: Close
[0m19:31:24.015518 [debug] [Thread-3  ]: Began executing node test.bain_capital_analytics.not_null_int_valuation_enriched_valuation_id.048a7ba03a
[0m19:31:24.015852 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_int_irr_calculations_portfolio_id.5530046e4d: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_int_irr_calculations_portfolio_id.5530046e4d"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select portfolio_id
from "bain_analytics"."public"."int_irr_calculations"
where portfolio_id is null



  
  
      
    ) dbt_internal_test
[0m19:31:24.016404 [info ] [Thread-4  ]: 42 of 57 PASS not_null_int_irr_calculations_fund_id ............................ [[32mPASS[0m in 0.06s]
[0m19:31:24.016882 [info ] [Thread-1  ]: 41 of 57 PASS not_null_int_fund_nav_fund_id .................................... [[32mPASS[0m in 0.06s]
[0m19:31:24.020544 [debug] [Thread-3  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_int_valuation_enriched_valuation_id.048a7ba03a"
[0m19:31:24.021030 [debug] [Thread-4  ]: Finished running node test.bain_capital_analytics.not_null_int_irr_calculations_fund_id.35702f5be3
[0m19:31:24.021433 [debug] [Thread-1  ]: Finished running node test.bain_capital_analytics.not_null_int_fund_nav_fund_id.ebf0b6cc99
[0m19:31:24.021822 [debug] [Thread-4  ]: Began running node test.bain_capital_analytics.not_null_int_portfolio_attribution_portfolio_id.3e04b7c210
[0m19:31:24.022203 [debug] [Thread-1  ]: Began running node test.bain_capital_analytics.not_null_fact_portfolio_summary_portfolio_id.98891ba523
[0m19:31:24.022585 [info ] [Thread-4  ]: 45 of 57 START test not_null_int_portfolio_attribution_portfolio_id ............ [RUN]
[0m19:31:24.022932 [debug] [Thread-3  ]: Using postgres connection "test.bain_capital_analytics.not_null_int_valuation_enriched_valuation_id.048a7ba03a"
[0m19:31:24.023241 [info ] [Thread-1  ]: 46 of 57 START test not_null_fact_portfolio_summary_portfolio_id ............... [RUN]
[0m19:31:24.023585 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.not_null_int_irr_calculations_fund_id.35702f5be3, now test.bain_capital_analytics.not_null_int_portfolio_attribution_portfolio_id.3e04b7c210)
[0m19:31:24.023890 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_int_valuation_enriched_valuation_id.048a7ba03a: BEGIN
[0m19:31:24.024192 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.not_null_int_fund_nav_fund_id.ebf0b6cc99, now test.bain_capital_analytics.not_null_fact_portfolio_summary_portfolio_id.98891ba523)
[0m19:31:24.024490 [debug] [Thread-4  ]: Began compiling node test.bain_capital_analytics.not_null_int_portfolio_attribution_portfolio_id.3e04b7c210
[0m19:31:24.024769 [debug] [Thread-3  ]: Opening a new connection, currently in state closed
[0m19:31:24.025053 [debug] [Thread-1  ]: Began compiling node test.bain_capital_analytics.not_null_fact_portfolio_summary_portfolio_id.98891ba523
[0m19:31:24.028416 [debug] [Thread-4  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_int_portfolio_attribution_portfolio_id.3e04b7c210"
[0m19:31:24.028749 [debug] [Thread-2  ]: SQL status: SELECT 1 in 0.008 seconds
[0m19:31:24.032032 [debug] [Thread-1  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_fact_portfolio_summary_portfolio_id.98891ba523"
[0m19:31:24.033360 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_int_irr_calculations_portfolio_id.5530046e4d: ROLLBACK
[0m19:31:24.033821 [debug] [Thread-4  ]: Began executing node test.bain_capital_analytics.not_null_int_portfolio_attribution_portfolio_id.3e04b7c210
[0m19:31:24.034131 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_int_irr_calculations_portfolio_id.5530046e4d: Close
[0m19:31:24.036325 [debug] [Thread-4  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_int_portfolio_attribution_portfolio_id.3e04b7c210"
[0m19:31:24.036609 [debug] [Thread-1  ]: Began executing node test.bain_capital_analytics.not_null_fact_portfolio_summary_portfolio_id.98891ba523
[0m19:31:24.037067 [info ] [Thread-2  ]: 43 of 57 PASS not_null_int_irr_calculations_portfolio_id ....................... [[32mPASS[0m in 0.05s]
[0m19:31:24.037435 [debug] [Thread-3  ]: SQL status: BEGIN in 0.013 seconds
[0m19:31:24.039559 [debug] [Thread-1  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_fact_portfolio_summary_portfolio_id.98891ba523"
[0m19:31:24.040090 [debug] [Thread-2  ]: Finished running node test.bain_capital_analytics.not_null_int_irr_calculations_portfolio_id.5530046e4d
[0m19:31:24.040421 [debug] [Thread-3  ]: Using postgres connection "test.bain_capital_analytics.not_null_int_valuation_enriched_valuation_id.048a7ba03a"
[0m19:31:24.040827 [debug] [Thread-4  ]: Using postgres connection "test.bain_capital_analytics.not_null_int_portfolio_attribution_portfolio_id.3e04b7c210"
[0m19:31:24.041182 [debug] [Thread-2  ]: Began running node test.bain_capital_analytics.not_null_fact_portfolio_summary_position_date.f6861b4961
[0m19:31:24.041589 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_int_valuation_enriched_valuation_id.048a7ba03a: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_int_valuation_enriched_valuation_id.048a7ba03a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select valuation_id
from "bain_analytics"."public"."int_valuation_enriched"
where valuation_id is null



  
  
      
    ) dbt_internal_test
[0m19:31:24.042047 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_int_portfolio_attribution_portfolio_id.3e04b7c210: BEGIN
[0m19:31:24.042389 [debug] [Thread-1  ]: Using postgres connection "test.bain_capital_analytics.not_null_fact_portfolio_summary_portfolio_id.98891ba523"
[0m19:31:24.042693 [info ] [Thread-2  ]: 47 of 57 START test not_null_fact_portfolio_summary_position_date .............. [RUN]
[0m19:31:24.043047 [debug] [Thread-4  ]: Opening a new connection, currently in state closed
[0m19:31:24.043344 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_fact_portfolio_summary_portfolio_id.98891ba523: BEGIN
[0m19:31:24.043685 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.not_null_int_irr_calculations_portfolio_id.5530046e4d, now test.bain_capital_analytics.not_null_fact_portfolio_summary_position_date.f6861b4961)
[0m19:31:24.044072 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m19:31:24.044367 [debug] [Thread-2  ]: Began compiling node test.bain_capital_analytics.not_null_fact_portfolio_summary_position_date.f6861b4961
[0m19:31:24.049180 [debug] [Thread-2  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_fact_portfolio_summary_position_date.f6861b4961"
[0m19:31:24.049542 [debug] [Thread-3  ]: SQL status: SELECT 1 in 0.007 seconds
[0m19:31:24.050787 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_int_valuation_enriched_valuation_id.048a7ba03a: ROLLBACK
[0m19:31:24.051171 [debug] [Thread-2  ]: Began executing node test.bain_capital_analytics.not_null_fact_portfolio_summary_position_date.f6861b4961
[0m19:31:24.051454 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_int_valuation_enriched_valuation_id.048a7ba03a: Close
[0m19:31:24.053775 [debug] [Thread-2  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_fact_portfolio_summary_position_date.f6861b4961"
[0m19:31:24.054294 [info ] [Thread-3  ]: 44 of 57 PASS not_null_int_valuation_enriched_valuation_id ..................... [[32mPASS[0m in 0.05s]
[0m19:31:24.054799 [debug] [Thread-3  ]: Finished running node test.bain_capital_analytics.not_null_int_valuation_enriched_valuation_id.048a7ba03a
[0m19:31:24.055102 [debug] [Thread-1  ]: SQL status: BEGIN in 0.011 seconds
[0m19:31:24.055398 [debug] [Thread-4  ]: SQL status: BEGIN in 0.012 seconds
[0m19:31:24.055727 [debug] [Thread-3  ]: Began running node model.bain_capital_analytics.fact_cashflow_waterfall
[0m19:31:24.056104 [debug] [Thread-1  ]: Using postgres connection "test.bain_capital_analytics.not_null_fact_portfolio_summary_portfolio_id.98891ba523"
[0m19:31:24.056451 [debug] [Thread-2  ]: Using postgres connection "test.bain_capital_analytics.not_null_fact_portfolio_summary_position_date.f6861b4961"
[0m19:31:24.056739 [debug] [Thread-4  ]: Using postgres connection "test.bain_capital_analytics.not_null_int_portfolio_attribution_portfolio_id.3e04b7c210"
[0m19:31:24.057144 [info ] [Thread-3  ]: 48 of 57 START sql view model public.fact_cashflow_waterfall ................... [RUN]
[0m19:31:24.057485 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_fact_portfolio_summary_portfolio_id.98891ba523: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_fact_portfolio_summary_portfolio_id.98891ba523"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select portfolio_id
from "bain_analytics"."public"."fact_portfolio_summary"
where portfolio_id is null



  
  
      
    ) dbt_internal_test
[0m19:31:24.057801 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_fact_portfolio_summary_position_date.f6861b4961: BEGIN
[0m19:31:24.058101 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_int_portfolio_attribution_portfolio_id.3e04b7c210: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_int_portfolio_attribution_portfolio_id.3e04b7c210"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select portfolio_id
from "bain_analytics"."public"."int_portfolio_attribution"
where portfolio_id is null



  
  
      
    ) dbt_internal_test
[0m19:31:24.058438 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.not_null_int_valuation_enriched_valuation_id.048a7ba03a, now model.bain_capital_analytics.fact_cashflow_waterfall)
[0m19:31:24.058783 [debug] [Thread-2  ]: Opening a new connection, currently in state closed
[0m19:31:24.059117 [debug] [Thread-3  ]: Began compiling node model.bain_capital_analytics.fact_cashflow_waterfall
[0m19:31:24.062181 [debug] [Thread-3  ]: Writing injected SQL for node "model.bain_capital_analytics.fact_cashflow_waterfall"
[0m19:31:24.062538 [debug] [Thread-1  ]: SQL status: SELECT 1 in 0.004 seconds
[0m19:31:24.063618 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_fact_portfolio_summary_portfolio_id.98891ba523: ROLLBACK
[0m19:31:24.063943 [debug] [Thread-4  ]: SQL status: SELECT 1 in 0.005 seconds
[0m19:31:24.065086 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_int_portfolio_attribution_portfolio_id.3e04b7c210: ROLLBACK
[0m19:31:24.065456 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_fact_portfolio_summary_portfolio_id.98891ba523: Close
[0m19:31:24.065798 [debug] [Thread-3  ]: Began executing node model.bain_capital_analytics.fact_cashflow_waterfall
[0m19:31:24.066113 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_int_portfolio_attribution_portfolio_id.3e04b7c210: Close
[0m19:31:24.070019 [debug] [Thread-3  ]: Writing runtime sql for node "model.bain_capital_analytics.fact_cashflow_waterfall"
[0m19:31:24.066582 [info ] [Thread-1  ]: 46 of 57 PASS not_null_fact_portfolio_summary_portfolio_id ..................... [[32mPASS[0m in 0.04s]
[0m19:31:24.070643 [info ] [Thread-4  ]: 45 of 57 PASS not_null_int_portfolio_attribution_portfolio_id .................. [[32mPASS[0m in 0.05s]
[0m19:31:24.070976 [debug] [Thread-2  ]: SQL status: BEGIN in 0.012 seconds
[0m19:31:24.071460 [debug] [Thread-1  ]: Finished running node test.bain_capital_analytics.not_null_fact_portfolio_summary_portfolio_id.98891ba523
[0m19:31:24.071884 [debug] [Thread-4  ]: Finished running node test.bain_capital_analytics.not_null_int_portfolio_attribution_portfolio_id.3e04b7c210
[0m19:31:24.072216 [debug] [Thread-2  ]: Using postgres connection "test.bain_capital_analytics.not_null_fact_portfolio_summary_position_date.f6861b4961"
[0m19:31:24.072565 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.fact_cashflow_waterfall"
[0m19:31:24.072900 [debug] [Thread-1  ]: Began running node model.bain_capital_analytics.fact_fund_performance
[0m19:31:24.073287 [debug] [Thread-4  ]: Began running node model.bain_capital_analytics.report_lp_quarterly
[0m19:31:24.073641 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_fact_portfolio_summary_position_date.f6861b4961: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_fact_portfolio_summary_position_date.f6861b4961"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select position_date
from "bain_analytics"."public"."fact_portfolio_summary"
where position_date is null



  
  
      
    ) dbt_internal_test
[0m19:31:24.074030 [debug] [Thread-3  ]: On model.bain_capital_analytics.fact_cashflow_waterfall: BEGIN
[0m19:31:24.074419 [info ] [Thread-1  ]: 49 of 57 START sql view model public.fact_fund_performance ..................... [RUN]
[0m19:31:24.074834 [info ] [Thread-4  ]: 50 of 57 START sql view model public.report_lp_quarterly ....................... [RUN]
[0m19:31:24.075206 [debug] [Thread-3  ]: Opening a new connection, currently in state closed
[0m19:31:24.075540 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.not_null_fact_portfolio_summary_portfolio_id.98891ba523, now model.bain_capital_analytics.fact_fund_performance)
[0m19:31:24.075855 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.not_null_int_portfolio_attribution_portfolio_id.3e04b7c210, now model.bain_capital_analytics.report_lp_quarterly)
[0m19:31:24.076243 [debug] [Thread-1  ]: Began compiling node model.bain_capital_analytics.fact_fund_performance
[0m19:31:24.076539 [debug] [Thread-4  ]: Began compiling node model.bain_capital_analytics.report_lp_quarterly
[0m19:31:24.080079 [debug] [Thread-1  ]: Writing injected SQL for node "model.bain_capital_analytics.fact_fund_performance"
[0m19:31:24.080431 [debug] [Thread-2  ]: SQL status: SELECT 1 in 0.005 seconds
[0m19:31:24.084195 [debug] [Thread-4  ]: Writing injected SQL for node "model.bain_capital_analytics.report_lp_quarterly"
[0m19:31:24.085512 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_fact_portfolio_summary_position_date.f6861b4961: ROLLBACK
[0m19:31:24.085842 [debug] [Thread-3  ]: SQL status: BEGIN in 0.011 seconds
[0m19:31:24.086246 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.fact_cashflow_waterfall"
[0m19:31:24.086587 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_fact_portfolio_summary_position_date.f6861b4961: Close
[0m19:31:24.086994 [debug] [Thread-3  ]: On model.bain_capital_analytics.fact_cashflow_waterfall: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.fact_cashflow_waterfall"} */

  create view "bain_analytics"."public"."fact_cashflow_waterfall__dbt_tmp"
    
    
  as (
    -- Pipeline C: FACT table - Cashflow waterfall for PE/fund reporting
-- Anti-pattern: deep CTEs, repeated joins, late aggregation
-- Anti-pattern: PostgreSQL-specific date functions

with enriched_cashflows as (
    select
        ce.cashflow_id,
        ce.fund_id,
        ce.fund_name,
        ce.fund_type,
        ce.portfolio_id,
        ce.portfolio_name,
        ce.cashflow_date,
        ce.cashflow_type,
        ce.amount,
        ce.investor_id,
        ce.committed_capital,
        ce.management_fee_rate,
        ce.carry_rate,
        ce.hurdle_rate,
        ce.cumulative_called,
        ce.cumulative_distributed,
        ce.cumulative_net_cashflow,
        ce.pct_called,
        -- Anti-pattern: duplicated fiscal quarter logic
        case
            when extract(month from ce.cashflow_date) between 1 and 3 then 'Q3'
            when extract(month from ce.cashflow_date) between 4 and 6 then 'Q4'
            when extract(month from ce.cashflow_date) between 7 and 9 then 'Q1'
            when extract(month from ce.cashflow_date) between 10 and 12 then 'Q2'
        end as fiscal_quarter,
        -- Anti-pattern: PostgreSQL extract
        extract(year from ce.cashflow_date) as calendar_year
    from "bain_analytics"."public"."int_cashflow_enriched" ce
),

-- Anti-pattern: re-joining valuations when int_valuation_enriched already has this
waterfall_with_nav as (
    select
        ecf.*,
        v.net_asset_value,
        v.gross_asset_value,
        v.unrealized_pnl as nav_unrealized_pnl,
        v.realized_pnl as nav_realized_pnl
    from enriched_cashflows ecf
    left join "bain_analytics"."public"."stg_valuations" v
        on ecf.portfolio_id = v.portfolio_id
        and ecf.cashflow_date = v.valuation_date
),

-- Anti-pattern: computing carry/waterfall in a CTE chain instead of a macro
waterfall_calculations as (
    select
        wn.*,
        -- Simplified carry calculation
        case
            when wn.cumulative_distributed > wn.cumulative_called * (1 + wn.hurdle_rate)
            then (wn.cumulative_distributed - wn.cumulative_called * (1 + wn.hurdle_rate)) * wn.carry_rate
            else 0
        end as estimated_carry,
        wn.cumulative_called * wn.management_fee_rate as annual_mgmt_fee,
        case
            when wn.cumulative_called > 0
            then wn.cumulative_distributed / wn.cumulative_called
            else 0
        end as dpi,
        case
            when wn.cumulative_called > 0 and wn.net_asset_value is not null
            then (wn.cumulative_distributed + wn.net_asset_value) / wn.cumulative_called
            else null
        end as tvpi
    from waterfall_with_nav wn
)

select * from waterfall_calculations
  );
[0m19:31:24.087447 [debug] [Thread-1  ]: Began executing node model.bain_capital_analytics.fact_fund_performance
[0m19:31:24.088015 [info ] [Thread-2  ]: 47 of 57 PASS not_null_fact_portfolio_summary_position_date .................... [[32mPASS[0m in 0.04s]
[0m19:31:24.088334 [debug] [Thread-4  ]: Began executing node model.bain_capital_analytics.report_lp_quarterly
[0m19:31:24.093160 [debug] [Thread-1  ]: Writing runtime sql for node "model.bain_capital_analytics.fact_fund_performance"
[0m19:31:24.093499 [debug] [Thread-3  ]: SQL status: CREATE VIEW in 0.006 seconds
[0m19:31:24.093917 [debug] [Thread-2  ]: Finished running node test.bain_capital_analytics.not_null_fact_portfolio_summary_position_date.f6861b4961
[0m19:31:24.097210 [debug] [Thread-4  ]: Writing runtime sql for node "model.bain_capital_analytics.report_lp_quarterly"
[0m19:31:24.100094 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.fact_cashflow_waterfall"
[0m19:31:24.100492 [debug] [Thread-2  ]: Began running node model.bain_capital_analytics.fact_portfolio_attribution
[0m19:31:24.100959 [debug] [Thread-3  ]: On model.bain_capital_analytics.fact_cashflow_waterfall: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.fact_cashflow_waterfall"} */
alter table "bain_analytics"."public"."fact_cashflow_waterfall__dbt_tmp" rename to "fact_cashflow_waterfall"
[0m19:31:24.101408 [info ] [Thread-2  ]: 51 of 57 START sql view model public.fact_portfolio_attribution ................ [RUN]
[0m19:31:24.101832 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.fact_fund_performance"
[0m19:31:24.102182 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.not_null_fact_portfolio_summary_position_date.f6861b4961, now model.bain_capital_analytics.fact_portfolio_attribution)
[0m19:31:24.102509 [debug] [Thread-1  ]: On model.bain_capital_analytics.fact_fund_performance: BEGIN
[0m19:31:24.102795 [debug] [Thread-3  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m19:31:24.103138 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.report_lp_quarterly"
[0m19:31:24.103448 [debug] [Thread-2  ]: Began compiling node model.bain_capital_analytics.fact_portfolio_attribution
[0m19:31:24.103748 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m19:31:24.104789 [debug] [Thread-3  ]: On model.bain_capital_analytics.fact_cashflow_waterfall: COMMIT
[0m19:31:24.105101 [debug] [Thread-4  ]: On model.bain_capital_analytics.report_lp_quarterly: BEGIN
[0m19:31:24.108209 [debug] [Thread-2  ]: Writing injected SQL for node "model.bain_capital_analytics.fact_portfolio_attribution"
[0m19:31:24.108672 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.fact_cashflow_waterfall"
[0m19:31:24.108964 [debug] [Thread-4  ]: Opening a new connection, currently in state closed
[0m19:31:24.109318 [debug] [Thread-3  ]: On model.bain_capital_analytics.fact_cashflow_waterfall: COMMIT
[0m19:31:24.109808 [debug] [Thread-2  ]: Began executing node model.bain_capital_analytics.fact_portfolio_attribution
[0m19:31:24.113187 [debug] [Thread-2  ]: Writing runtime sql for node "model.bain_capital_analytics.fact_portfolio_attribution"
[0m19:31:24.113540 [debug] [Thread-3  ]: SQL status: COMMIT in 0.004 seconds
[0m19:31:24.116729 [debug] [Thread-3  ]: Applying DROP to: "bain_analytics"."public"."fact_cashflow_waterfall__dbt_backup"
[0m19:31:24.163287 [debug] [Thread-1  ]: SQL status: BEGIN in 0.059 seconds
[0m19:31:24.163759 [debug] [Thread-4  ]: SQL status: BEGIN in 0.055 seconds
[0m19:31:24.164205 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.fact_cashflow_waterfall"
[0m19:31:24.164545 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.fact_fund_performance"
[0m19:31:24.164922 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.fact_portfolio_attribution"
[0m19:31:24.165213 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.report_lp_quarterly"
[0m19:31:24.165522 [debug] [Thread-3  ]: On model.bain_capital_analytics.fact_cashflow_waterfall: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.fact_cashflow_waterfall"} */
drop view if exists "bain_analytics"."public"."fact_cashflow_waterfall__dbt_backup" cascade
[0m19:31:24.165996 [debug] [Thread-1  ]: On model.bain_capital_analytics.fact_fund_performance: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.fact_fund_performance"} */

  create view "bain_analytics"."public"."fact_fund_performance__dbt_tmp"
    
    
  as (
    -- Pipeline C: FACT table - Fund-level performance metrics
-- Anti-pattern: late aggregation - joins everything then aggregates
-- Anti-pattern: re-joins fund_structures (already in int_fund_nav, int_cashflow_enriched)
-- Anti-pattern: materialized as view (should be table)

with fund_nav_data as (
    select
        fn.fund_id,
        fn.fund_name,
        fn.fund_type,
        fn.committed_capital,
        fn.valuation_date,
        fn.fund_nav,
        fn.fund_gav,
        fn.fund_total_liabilities,
        fn.fund_unrealized_pnl,
        fn.fund_realized_pnl,
        fn.fund_nav_return,
        fn.tvpi_gross,
        fn.num_portfolios
    from "bain_analytics"."public"."int_fund_nav" fn
),

fund_cashflows as (
    -- Anti-pattern: re-aggregating cashflows that are already in int_cashflow_enriched
    select
        cf.fund_id,
        cf.cashflow_date,
        sum(case when cf.cashflow_type = 'capital_call' then cf.amount else 0 end) as period_calls,
        sum(case when cf.cashflow_type = 'distribution' then cf.amount else 0 end) as period_distributions,
        sum(case when cf.cashflow_type = 'management_fee' then cf.amount else 0 end) as period_fees,
        sum(cf.amount) as period_net_cashflow
    from "bain_analytics"."public"."stg_cashflows" cf
    group by cf.fund_id, cf.cashflow_date
),

fund_irr as (
    select
        irr.fund_id,
        sum(irr.total_invested) as fund_total_invested,
        sum(irr.total_distributed) as fund_total_distributed,
        sum(irr.terminal_value) as fund_terminal_value,
        -- Anti-pattern: averaging portfolio IRRs as proxy for fund IRR (incorrect but intentional)
        avg(irr.approx_irr) as fund_approx_irr,
        avg(irr.tvpi) as fund_tvpi,
        avg(irr.dpi) as fund_dpi
    from "bain_analytics"."public"."int_irr_calculations" irr
    group by irr.fund_id
),

-- Anti-pattern: joining everything together at the end
combined as (
    select
        fn.fund_id,
        fn.fund_name,
        fn.fund_type,
        fn.committed_capital,
        fn.valuation_date,
        fn.fund_nav,
        fn.fund_gav,
        fn.fund_total_liabilities,
        fn.fund_unrealized_pnl,
        fn.fund_realized_pnl,
        fn.fund_nav_return,
        fn.tvpi_gross,
        fn.num_portfolios,
        coalesce(fc.period_calls, 0) as period_calls,
        coalesce(fc.period_distributions, 0) as period_distributions,
        coalesce(fc.period_fees, 0) as period_fees,
        coalesce(fc.period_net_cashflow, 0) as period_net_cashflow,
        fi.fund_total_invested,
        fi.fund_total_distributed,
        fi.fund_approx_irr,
        fi.fund_tvpi,
        fi.fund_dpi
    from fund_nav_data fn
    left join fund_cashflows fc
        on fn.fund_id = fc.fund_id
        and fn.valuation_date = fc.cashflow_date
    left join fund_irr fi
        on fn.fund_id = fi.fund_id
)

select * from combined
  );
[0m19:31:24.166473 [debug] [Thread-2  ]: On model.bain_capital_analytics.fact_portfolio_attribution: BEGIN
[0m19:31:24.166908 [debug] [Thread-4  ]: On model.bain_capital_analytics.report_lp_quarterly: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.report_lp_quarterly"} */

  create view "bain_analytics"."public"."report_lp_quarterly__dbt_tmp"
    
    
  as (
    -- Pipeline C: REPORT table - LP quarterly reporting
-- Anti-pattern: massive query, duplicated logic, no reuse of intermediates
-- Anti-pattern: PostgreSQL-specific date_trunc
-- Anti-pattern: re-aggregation of data already aggregated upstream

with quarterly_cashflows as (
    -- Anti-pattern: re-aggregating cashflows by quarter (already in int_cashflow_enriched)
    select
        cf.fund_id,
        cf.portfolio_id,
        -- Anti-pattern: PostgreSQL-specific date_trunc
        date_trunc('quarter', cf.cashflow_date) as quarter_start,
        cf.cashflow_fiscal_quarter as fiscal_quarter,
        cf.cashflow_year,
        sum(case when cf.cashflow_type = 'capital_call' then cf.amount else 0 end) as quarter_calls,
        sum(case when cf.cashflow_type = 'distribution' then cf.amount else 0 end) as quarter_distributions,
        sum(case when cf.cashflow_type = 'management_fee' then cf.amount else 0 end) as quarter_fees,
        sum(cf.amount) as quarter_net
    from "bain_analytics"."public"."stg_cashflows" cf
    group by
        cf.fund_id, cf.portfolio_id,
        date_trunc('quarter', cf.cashflow_date),
        cf.cashflow_fiscal_quarter, cf.cashflow_year
),

quarterly_valuations as (
    -- Anti-pattern: re-querying valuations with subquery for quarter-end
    select *
    from (
        select
            v.portfolio_id,
            v.valuation_date,
            v.net_asset_value,
            v.gross_asset_value,
            v.unrealized_pnl,
            v.realized_pnl,
            v.valuation_method,
            -- Anti-pattern: subquery dedup instead of QUALIFY
            row_number() over (
                partition by v.portfolio_id, date_trunc('quarter', v.valuation_date)
                order by v.valuation_date desc
            ) as rn
        from "bain_analytics"."public"."stg_valuations" v
    ) sub
    where rn = 1
),

-- Anti-pattern: re-joining fund structures (done in multiple places)
fund_details as (
    select
        fs.fund_id,
        fs.fund_name,
        fs.fund_type,
        fs.committed_capital,
        fs.management_fee_rate,
        fs.carry_rate,
        fs.hurdle_rate,
        fs.vintage_year,
        fs.gp_commitment_pct
    from "bain_analytics"."public"."stg_fund_structures" fs
),

-- Anti-pattern: joining everything at the end
lp_report as (
    select
        fd.fund_id,
        fd.fund_name,
        fd.fund_type,
        fd.vintage_year,
        fd.committed_capital,
        fd.management_fee_rate,
        fd.carry_rate,
        fd.hurdle_rate,
        fd.gp_commitment_pct,
        qc.portfolio_id,
        p.portfolio_name,
        p.strategy,
        qc.quarter_start,
        qc.fiscal_quarter,
        qc.cashflow_year,
        qc.quarter_calls,
        qc.quarter_distributions,
        qc.quarter_fees,
        qc.quarter_net,
        qv.net_asset_value as quarter_end_nav,
        qv.gross_asset_value as quarter_end_gav,
        qv.unrealized_pnl,
        qv.realized_pnl,
        qv.valuation_method,
        -- Anti-pattern: IRR re-joined from separate calculation
        irr.approx_irr,
        irr.tvpi,
        irr.dpi,
        irr.rvpi
    from quarterly_cashflows qc
    inner join fund_details fd
        on qc.fund_id = fd.fund_id
    inner join "bain_analytics"."public"."stg_portfolios" p
        on qc.portfolio_id = p.portfolio_id
    left join quarterly_valuations qv
        on qc.portfolio_id = qv.portfolio_id
        and date_trunc('quarter', qv.valuation_date) = qc.quarter_start
    left join "bain_analytics"."public"."int_irr_calculations" irr
        on qc.fund_id = irr.fund_id
        and qc.portfolio_id = irr.portfolio_id
)

select
    *,
    -- Anti-pattern: computed columns in final select
    case
        when committed_capital > 0
        then quarter_calls / committed_capital
        else 0
    end as quarterly_drawdown_rate,
    case
        when quarter_end_nav is not null and committed_capital > 0
        then quarter_end_nav / committed_capital
        else null
    end as nav_to_commitment_ratio
from lp_report
order by fund_id, portfolio_id, quarter_start
  );
[0m19:31:24.167432 [debug] [Thread-2  ]: Opening a new connection, currently in state closed
[0m19:31:24.168424 [debug] [Thread-3  ]: SQL status: DROP VIEW in 0.001 seconds
[0m19:31:24.169585 [debug] [Thread-3  ]: On model.bain_capital_analytics.fact_cashflow_waterfall: Close
[0m19:31:24.170099 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b681c8a7-b3f4-41ea-b625-4a93cae2ea4b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10acd09d0>]}
[0m19:31:24.170646 [info ] [Thread-3  ]: 48 of 57 OK created sql view model public.fact_cashflow_waterfall .............. [[32mCREATE VIEW[0m in 0.11s]
[0m19:31:24.171094 [debug] [Thread-3  ]: Finished running node model.bain_capital_analytics.fact_cashflow_waterfall
[0m19:31:24.171565 [debug] [Thread-3  ]: Began running node test.bain_capital_analytics.not_null_fact_cashflow_waterfall_cashflow_id.7aafd60486
[0m19:31:24.171903 [info ] [Thread-3  ]: 52 of 57 START test not_null_fact_cashflow_waterfall_cashflow_id ............... [RUN]
[0m19:31:24.172267 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly model.bain_capital_analytics.fact_cashflow_waterfall, now test.bain_capital_analytics.not_null_fact_cashflow_waterfall_cashflow_id.7aafd60486)
[0m19:31:24.172575 [debug] [Thread-3  ]: Began compiling node test.bain_capital_analytics.not_null_fact_cashflow_waterfall_cashflow_id.7aafd60486
[0m19:31:24.176423 [debug] [Thread-3  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_fact_cashflow_waterfall_cashflow_id.7aafd60486"
[0m19:31:24.176767 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.009 seconds
[0m19:31:24.179642 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.fact_fund_performance"
[0m19:31:24.179972 [debug] [Thread-2  ]: SQL status: BEGIN in 0.013 seconds
[0m19:31:24.180255 [debug] [Thread-4  ]: SQL status: CREATE VIEW in 0.013 seconds
[0m19:31:24.180536 [debug] [Thread-1  ]: On model.bain_capital_analytics.fact_fund_performance: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.fact_fund_performance"} */
alter table "bain_analytics"."public"."fact_fund_performance__dbt_tmp" rename to "fact_fund_performance"
[0m19:31:24.180862 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.fact_portfolio_attribution"
[0m19:31:24.183590 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.report_lp_quarterly"
[0m19:31:24.184039 [debug] [Thread-2  ]: On model.bain_capital_analytics.fact_portfolio_attribution: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.fact_portfolio_attribution"} */

  create view "bain_analytics"."public"."fact_portfolio_attribution__dbt_tmp"
    
    
  as (
    -- Pipeline C: FACT table - Portfolio attribution with benchmark comparison
-- Anti-pattern: re-joins data that's already in intermediate models
-- Anti-pattern: repeated computation of sector weights

with attribution as (
    select
        pa.portfolio_id,
        pa.portfolio_name,
        pa.strategy,
        pa.fund_id,
        pa.position_date,
        pa.sector,
        pa.sector_mv,
        pa.sector_ugl,
        pa.num_instruments,
        pa.total_portfolio_mv,
        pa.total_portfolio_ugl,
        pa.sector_weight,
        pa.sector_contribution
    from "bain_analytics"."public"."int_portfolio_attribution" pa
),

-- Anti-pattern: re-joining benchmarks (could be done in intermediate)
attribution_with_benchmark as (
    select
        a.*,
        bm.benchmark_name,
        bm.return_mtd as benchmark_return,
        bm.rolling_3m_return as benchmark_3m_return,
        bm.rolling_12m_return as benchmark_12m_return
    from attribution a
    left join "bain_analytics"."public"."int_benchmark_returns" bm
        on a.position_date = bm.benchmark_date
        and bm.benchmark_id = 'BM_SP500'
),

-- Anti-pattern: computing alpha in yet another CTE
attribution_with_alpha as (
    select
        ab.*,
        -- Simplified active return
        case
            when ab.total_portfolio_mv != 0
            then (ab.sector_ugl / ab.total_portfolio_mv) - coalesce(ab.benchmark_return, 0) * ab.sector_weight
            else 0
        end as sector_active_return,
        -- Anti-pattern: re-computing portfolio-level return here
        case
            when ab.total_portfolio_mv != 0
            then ab.total_portfolio_ugl / ab.total_portfolio_mv
            else 0
        end as portfolio_return
    from attribution_with_benchmark ab
)

select * from attribution_with_alpha
  );
[0m19:31:24.184409 [debug] [Thread-3  ]: Began executing node test.bain_capital_analytics.not_null_fact_cashflow_waterfall_cashflow_id.7aafd60486
[0m19:31:24.184712 [debug] [Thread-4  ]: On model.bain_capital_analytics.report_lp_quarterly: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.report_lp_quarterly"} */
alter table "bain_analytics"."public"."report_lp_quarterly__dbt_tmp" rename to "report_lp_quarterly"
[0m19:31:24.185031 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m19:31:24.187275 [debug] [Thread-3  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_fact_cashflow_waterfall_cashflow_id.7aafd60486"
[0m19:31:24.188285 [debug] [Thread-1  ]: On model.bain_capital_analytics.fact_fund_performance: COMMIT
[0m19:31:24.188667 [debug] [Thread-4  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m19:31:24.189005 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.fact_fund_performance"
[0m19:31:24.189927 [debug] [Thread-4  ]: On model.bain_capital_analytics.report_lp_quarterly: COMMIT
[0m19:31:24.190237 [debug] [Thread-2  ]: SQL status: CREATE VIEW in 0.005 seconds
[0m19:31:24.190546 [debug] [Thread-1  ]: On model.bain_capital_analytics.fact_fund_performance: COMMIT
[0m19:31:24.190886 [debug] [Thread-3  ]: Using postgres connection "test.bain_capital_analytics.not_null_fact_cashflow_waterfall_cashflow_id.7aafd60486"
[0m19:31:24.191276 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.report_lp_quarterly"
[0m19:31:24.193875 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.fact_portfolio_attribution"
[0m19:31:24.194219 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_fact_cashflow_waterfall_cashflow_id.7aafd60486: BEGIN
[0m19:31:24.194511 [debug] [Thread-4  ]: On model.bain_capital_analytics.report_lp_quarterly: COMMIT
[0m19:31:24.194813 [debug] [Thread-2  ]: On model.bain_capital_analytics.fact_portfolio_attribution: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.fact_portfolio_attribution"} */
alter table "bain_analytics"."public"."fact_portfolio_attribution__dbt_tmp" rename to "fact_portfolio_attribution"
[0m19:31:24.195126 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m19:31:24.195388 [debug] [Thread-3  ]: Opening a new connection, currently in state closed
[0m19:31:24.198485 [debug] [Thread-1  ]: Applying DROP to: "bain_analytics"."public"."fact_fund_performance__dbt_backup"
[0m19:31:24.198787 [debug] [Thread-4  ]: SQL status: COMMIT in 0.003 seconds
[0m19:31:24.199259 [debug] [Thread-2  ]: SQL status: ALTER TABLE in 0.004 seconds
[0m19:31:24.199705 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.fact_fund_performance"
[0m19:31:24.201851 [debug] [Thread-4  ]: Applying DROP to: "bain_analytics"."public"."report_lp_quarterly__dbt_backup"
[0m19:31:24.202823 [debug] [Thread-2  ]: On model.bain_capital_analytics.fact_portfolio_attribution: COMMIT
[0m19:31:24.203135 [debug] [Thread-1  ]: On model.bain_capital_analytics.fact_fund_performance: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.fact_fund_performance"} */
drop view if exists "bain_analytics"."public"."fact_fund_performance__dbt_backup" cascade
[0m19:31:24.203587 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.report_lp_quarterly"
[0m19:31:24.203894 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.fact_portfolio_attribution"
[0m19:31:24.204218 [debug] [Thread-4  ]: On model.bain_capital_analytics.report_lp_quarterly: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.report_lp_quarterly"} */
drop view if exists "bain_analytics"."public"."report_lp_quarterly__dbt_backup" cascade
[0m19:31:24.204510 [debug] [Thread-2  ]: On model.bain_capital_analytics.fact_portfolio_attribution: COMMIT
[0m19:31:24.204795 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.001 seconds
[0m19:31:24.205787 [debug] [Thread-1  ]: On model.bain_capital_analytics.fact_fund_performance: Close
[0m19:31:24.206083 [debug] [Thread-4  ]: SQL status: DROP VIEW in 0.001 seconds
[0m19:31:24.206361 [debug] [Thread-2  ]: SQL status: COMMIT in 0.001 seconds
[0m19:31:24.207289 [debug] [Thread-4  ]: On model.bain_capital_analytics.report_lp_quarterly: Close
[0m19:31:24.209638 [debug] [Thread-2  ]: Applying DROP to: "bain_analytics"."public"."fact_portfolio_attribution__dbt_backup"
[0m19:31:24.209958 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b681c8a7-b3f4-41ea-b625-4a93cae2ea4b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10af7ebb0>]}
[0m19:31:24.210266 [debug] [Thread-3  ]: SQL status: BEGIN in 0.015 seconds
[0m19:31:24.210836 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.fact_portfolio_attribution"
[0m19:31:24.211115 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b681c8a7-b3f4-41ea-b625-4a93cae2ea4b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10add5730>]}
[0m19:31:24.211629 [info ] [Thread-1  ]: 49 of 57 OK created sql view model public.fact_fund_performance ................ [[32mCREATE VIEW[0m in 0.13s]
[0m19:31:24.211953 [debug] [Thread-3  ]: Using postgres connection "test.bain_capital_analytics.not_null_fact_cashflow_waterfall_cashflow_id.7aafd60486"
[0m19:31:24.212249 [debug] [Thread-2  ]: On model.bain_capital_analytics.fact_portfolio_attribution: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.fact_portfolio_attribution"} */
drop view if exists "bain_analytics"."public"."fact_portfolio_attribution__dbt_backup" cascade
[0m19:31:24.212713 [info ] [Thread-4  ]: 50 of 57 OK created sql view model public.report_lp_quarterly .................. [[32mCREATE VIEW[0m in 0.13s]
[0m19:31:24.213165 [debug] [Thread-1  ]: Finished running node model.bain_capital_analytics.fact_fund_performance
[0m19:31:24.213472 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_fact_cashflow_waterfall_cashflow_id.7aafd60486: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_fact_cashflow_waterfall_cashflow_id.7aafd60486"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select cashflow_id
from "bain_analytics"."public"."fact_cashflow_waterfall"
where cashflow_id is null



  
  
      
    ) dbt_internal_test
[0m19:31:24.213940 [debug] [Thread-4  ]: Finished running node model.bain_capital_analytics.report_lp_quarterly
[0m19:31:24.214231 [debug] [Thread-2  ]: SQL status: DROP VIEW in 0.000 seconds
[0m19:31:24.214731 [debug] [Thread-1  ]: Began running node test.bain_capital_analytics.not_null_fact_fund_performance_fund_id.738d6489c4
[0m19:31:24.215125 [debug] [Thread-4  ]: Began running node test.bain_capital_analytics.not_null_report_lp_quarterly_fund_id.aa355f6583
[0m19:31:24.216088 [debug] [Thread-2  ]: On model.bain_capital_analytics.fact_portfolio_attribution: Close
[0m19:31:24.216407 [info ] [Thread-1  ]: 53 of 57 START test not_null_fact_fund_performance_fund_id ..................... [RUN]
[0m19:31:24.216724 [info ] [Thread-4  ]: 54 of 57 START test not_null_report_lp_quarterly_fund_id ....................... [RUN]
[0m19:31:24.217103 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.bain_capital_analytics.fact_fund_performance, now test.bain_capital_analytics.not_null_fact_fund_performance_fund_id.738d6489c4)
[0m19:31:24.217504 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b681c8a7-b3f4-41ea-b625-4a93cae2ea4b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10aeb1910>]}
[0m19:31:24.217826 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly model.bain_capital_analytics.report_lp_quarterly, now test.bain_capital_analytics.not_null_report_lp_quarterly_fund_id.aa355f6583)
[0m19:31:24.218127 [debug] [Thread-1  ]: Began compiling node test.bain_capital_analytics.not_null_fact_fund_performance_fund_id.738d6489c4
[0m19:31:24.218617 [info ] [Thread-2  ]: 51 of 57 OK created sql view model public.fact_portfolio_attribution ........... [[32mCREATE VIEW[0m in 0.12s]
[0m19:31:24.218924 [debug] [Thread-4  ]: Began compiling node test.bain_capital_analytics.not_null_report_lp_quarterly_fund_id.aa355f6583
[0m19:31:24.222492 [debug] [Thread-1  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_fact_fund_performance_fund_id.738d6489c4"
[0m19:31:24.222824 [debug] [Thread-3  ]: SQL status: SELECT 1 in 0.008 seconds
[0m19:31:24.223220 [debug] [Thread-2  ]: Finished running node model.bain_capital_analytics.fact_portfolio_attribution
[0m19:31:24.226618 [debug] [Thread-4  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_report_lp_quarterly_fund_id.aa355f6583"
[0m19:31:24.227883 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_fact_cashflow_waterfall_cashflow_id.7aafd60486: ROLLBACK
[0m19:31:24.228423 [debug] [Thread-2  ]: Began running node test.bain_capital_analytics.not_null_fact_portfolio_attribution_portfolio_id.f676c7df62
[0m19:31:24.228827 [info ] [Thread-2  ]: 55 of 57 START test not_null_fact_portfolio_attribution_portfolio_id ........... [RUN]
[0m19:31:24.229154 [debug] [Thread-1  ]: Began executing node test.bain_capital_analytics.not_null_fact_fund_performance_fund_id.738d6489c4
[0m19:31:24.229489 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly model.bain_capital_analytics.fact_portfolio_attribution, now test.bain_capital_analytics.not_null_fact_portfolio_attribution_portfolio_id.f676c7df62)
[0m19:31:24.229791 [debug] [Thread-3  ]: On test.bain_capital_analytics.not_null_fact_cashflow_waterfall_cashflow_id.7aafd60486: Close
[0m19:31:24.232157 [debug] [Thread-1  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_fact_fund_performance_fund_id.738d6489c4"
[0m19:31:24.232493 [debug] [Thread-4  ]: Began executing node test.bain_capital_analytics.not_null_report_lp_quarterly_fund_id.aa355f6583
[0m19:31:24.232782 [debug] [Thread-2  ]: Began compiling node test.bain_capital_analytics.not_null_fact_portfolio_attribution_portfolio_id.f676c7df62
[0m19:31:24.233262 [info ] [Thread-3  ]: 52 of 57 PASS not_null_fact_cashflow_waterfall_cashflow_id ..................... [[32mPASS[0m in 0.06s]
[0m19:31:24.237046 [debug] [Thread-4  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_report_lp_quarterly_fund_id.aa355f6583"
[0m19:31:24.240583 [debug] [Thread-2  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_fact_portfolio_attribution_portfolio_id.f676c7df62"
[0m19:31:24.241107 [debug] [Thread-3  ]: Finished running node test.bain_capital_analytics.not_null_fact_cashflow_waterfall_cashflow_id.7aafd60486
[0m19:31:24.241499 [debug] [Thread-1  ]: Using postgres connection "test.bain_capital_analytics.not_null_fact_fund_performance_fund_id.738d6489c4"
[0m19:31:24.242003 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_fact_fund_performance_fund_id.738d6489c4: BEGIN
[0m19:31:24.242338 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m19:31:24.242796 [debug] [Thread-2  ]: Began executing node test.bain_capital_analytics.not_null_fact_portfolio_attribution_portfolio_id.f676c7df62
[0m19:31:24.243126 [debug] [Thread-4  ]: Using postgres connection "test.bain_capital_analytics.not_null_report_lp_quarterly_fund_id.aa355f6583"
[0m19:31:24.245393 [debug] [Thread-2  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_fact_portfolio_attribution_portfolio_id.f676c7df62"
[0m19:31:24.245700 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_report_lp_quarterly_fund_id.aa355f6583: BEGIN
[0m19:31:24.246057 [debug] [Thread-4  ]: Opening a new connection, currently in state closed
[0m19:31:24.246508 [debug] [Thread-2  ]: Using postgres connection "test.bain_capital_analytics.not_null_fact_portfolio_attribution_portfolio_id.f676c7df62"
[0m19:31:24.246805 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_fact_portfolio_attribution_portfolio_id.f676c7df62: BEGIN
[0m19:31:24.247076 [debug] [Thread-2  ]: Opening a new connection, currently in state closed
[0m19:31:24.251346 [debug] [Thread-1  ]: SQL status: BEGIN in 0.009 seconds
[0m19:31:24.251646 [debug] [Thread-1  ]: Using postgres connection "test.bain_capital_analytics.not_null_fact_fund_performance_fund_id.738d6489c4"
[0m19:31:24.251949 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_fact_fund_performance_fund_id.738d6489c4: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_fact_fund_performance_fund_id.738d6489c4"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select fund_id
from "bain_analytics"."public"."fact_fund_performance"
where fund_id is null



  
  
      
    ) dbt_internal_test
[0m19:31:24.254316 [debug] [Thread-4  ]: SQL status: BEGIN in 0.008 seconds
[0m19:31:24.254631 [debug] [Thread-4  ]: Using postgres connection "test.bain_capital_analytics.not_null_report_lp_quarterly_fund_id.aa355f6583"
[0m19:31:24.254926 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_report_lp_quarterly_fund_id.aa355f6583: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_report_lp_quarterly_fund_id.aa355f6583"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select fund_id
from "bain_analytics"."public"."report_lp_quarterly"
where fund_id is null



  
  
      
    ) dbt_internal_test
[0m19:31:24.255249 [debug] [Thread-2  ]: SQL status: BEGIN in 0.008 seconds
[0m19:31:24.255598 [debug] [Thread-2  ]: Using postgres connection "test.bain_capital_analytics.not_null_fact_portfolio_attribution_portfolio_id.f676c7df62"
[0m19:31:24.255912 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_fact_portfolio_attribution_portfolio_id.f676c7df62: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_fact_portfolio_attribution_portfolio_id.f676c7df62"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select portfolio_id
from "bain_analytics"."public"."fact_portfolio_attribution"
where portfolio_id is null



  
  
      
    ) dbt_internal_test
[0m19:31:24.260171 [debug] [Thread-1  ]: SQL status: SELECT 1 in 0.008 seconds
[0m19:31:24.261387 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_fact_fund_performance_fund_id.738d6489c4: ROLLBACK
[0m19:31:24.262207 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_fact_fund_performance_fund_id.738d6489c4: Close
[0m19:31:24.262680 [info ] [Thread-1  ]: 53 of 57 PASS not_null_fact_fund_performance_fund_id ........................... [[32mPASS[0m in 0.05s]
[0m19:31:24.263127 [debug] [Thread-1  ]: Finished running node test.bain_capital_analytics.not_null_fact_fund_performance_fund_id.738d6489c4
[0m19:31:24.263595 [debug] [Thread-3  ]: Began running node model.bain_capital_analytics.report_ic_dashboard
[0m19:31:24.263919 [debug] [Thread-2  ]: SQL status: SELECT 1 in 0.008 seconds
[0m19:31:24.264341 [info ] [Thread-3  ]: 56 of 57 START sql view model public.report_ic_dashboard ....................... [RUN]
[0m19:31:24.264685 [debug] [Thread-4  ]: SQL status: SELECT 1 in 0.009 seconds
[0m19:31:24.265794 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_fact_portfolio_attribution_portfolio_id.f676c7df62: ROLLBACK
[0m19:31:24.266207 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.not_null_fact_cashflow_waterfall_cashflow_id.7aafd60486, now model.bain_capital_analytics.report_ic_dashboard)
[0m19:31:24.267240 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_report_lp_quarterly_fund_id.aa355f6583: ROLLBACK
[0m19:31:24.267580 [debug] [Thread-3  ]: Began compiling node model.bain_capital_analytics.report_ic_dashboard
[0m19:31:24.267886 [debug] [Thread-2  ]: On test.bain_capital_analytics.not_null_fact_portfolio_attribution_portfolio_id.f676c7df62: Close
[0m19:31:24.271489 [debug] [Thread-3  ]: Writing injected SQL for node "model.bain_capital_analytics.report_ic_dashboard"
[0m19:31:24.271813 [debug] [Thread-4  ]: On test.bain_capital_analytics.not_null_report_lp_quarterly_fund_id.aa355f6583: Close
[0m19:31:24.272381 [info ] [Thread-2  ]: 55 of 57 PASS not_null_fact_portfolio_attribution_portfolio_id ................. [[32mPASS[0m in 0.04s]
[0m19:31:24.272862 [info ] [Thread-4  ]: 54 of 57 PASS not_null_report_lp_quarterly_fund_id ............................. [[32mPASS[0m in 0.05s]
[0m19:31:24.273313 [debug] [Thread-2  ]: Finished running node test.bain_capital_analytics.not_null_fact_portfolio_attribution_portfolio_id.f676c7df62
[0m19:31:24.273747 [debug] [Thread-4  ]: Finished running node test.bain_capital_analytics.not_null_report_lp_quarterly_fund_id.aa355f6583
[0m19:31:24.274182 [debug] [Thread-3  ]: Began executing node model.bain_capital_analytics.report_ic_dashboard
[0m19:31:24.277750 [debug] [Thread-3  ]: Writing runtime sql for node "model.bain_capital_analytics.report_ic_dashboard"
[0m19:31:24.278272 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.report_ic_dashboard"
[0m19:31:24.278562 [debug] [Thread-3  ]: On model.bain_capital_analytics.report_ic_dashboard: BEGIN
[0m19:31:24.278836 [debug] [Thread-3  ]: Opening a new connection, currently in state closed
[0m19:31:24.287877 [debug] [Thread-3  ]: SQL status: BEGIN in 0.009 seconds
[0m19:31:24.288169 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.report_ic_dashboard"
[0m19:31:24.288569 [debug] [Thread-3  ]: On model.bain_capital_analytics.report_ic_dashboard: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.report_ic_dashboard"} */

  create view "bain_analytics"."public"."report_ic_dashboard__dbt_tmp"
    
    
  as (
    -- Pipeline C: REPORT table - Investment Committee dashboard
-- Anti-pattern: massive query joining many sources, no intermediate reuse
-- Anti-pattern: subquery for latest records instead of QUALIFY
-- Anti-pattern: duplicated logic from other reports

with latest_fund_performance as (
    select *
    from (
        select
            fp.*,
            -- Anti-pattern: subquery dedup instead of QUALIFY
            row_number() over (
                partition by fp.fund_id
                order by fp.valuation_date desc
            ) as rn
        from "bain_analytics"."public"."fact_fund_performance" fp
    ) sub
    where rn = 1
),

latest_portfolio_summary as (
    select *
    from (
        select
            ps.*,
            row_number() over (
                partition by ps.portfolio_id
                order by ps.position_date desc
            ) as rn
        from "bain_analytics"."public"."fact_portfolio_summary" ps
    ) sub
    where rn = 1
),

-- Anti-pattern: re-joining fund structures (already in fact_fund_performance)
fund_overview as (
    select
        lfp.fund_id,
        lfp.fund_name,
        lfp.fund_type,
        lfp.committed_capital,
        lfp.valuation_date as latest_valuation_date,
        lfp.fund_nav,
        lfp.fund_gav,
        lfp.fund_nav_return as latest_nav_return,
        lfp.tvpi_gross,
        lfp.fund_approx_irr,
        lfp.fund_tvpi,
        lfp.fund_dpi,
        lfp.num_portfolios,
        lfp.fund_total_invested,
        lfp.fund_total_distributed,
        -- Anti-pattern: re-joining fund structures
        fs.management_fee_rate,
        fs.carry_rate,
        fs.hurdle_rate,
        fs.vintage_year
    from latest_fund_performance lfp
    inner join "bain_analytics"."public"."stg_fund_structures" fs
        on lfp.fund_id = fs.fund_id
),

portfolio_details as (
    select
        lps.portfolio_id,
        lps.portfolio_name,
        lps.strategy,
        lps.fund_id,
        lps.total_market_value,
        lps.total_unrealized_pnl,
        lps.portfolio_return_pct,
        lps.num_positions,
        -- Anti-pattern: re-computing fiscal quarter
        case
            when extract(month from lps.position_date) between 1 and 3 then 'Q3'
            when extract(month from lps.position_date) between 4 and 6 then 'Q4'
            when extract(month from lps.position_date) between 7 and 9 then 'Q1'
            when extract(month from lps.position_date) between 10 and 12 then 'Q2'
        end as reporting_fiscal_quarter
    from latest_portfolio_summary lps
)

select
    fo.fund_id,
    fo.fund_name,
    fo.fund_type,
    fo.vintage_year,
    fo.committed_capital,
    fo.latest_valuation_date,
    fo.fund_nav,
    fo.fund_gav,
    fo.latest_nav_return,
    fo.tvpi_gross,
    fo.fund_approx_irr,
    fo.fund_tvpi,
    fo.fund_dpi,
    fo.num_portfolios,
    fo.fund_total_invested,
    fo.fund_total_distributed,
    fo.management_fee_rate,
    fo.carry_rate,
    fo.hurdle_rate,
    pd.portfolio_id,
    pd.portfolio_name,
    pd.strategy,
    pd.total_market_value as portfolio_mv,
    pd.total_unrealized_pnl as portfolio_unrealized_pnl,
    pd.portfolio_return_pct,
    pd.num_positions as portfolio_num_positions,
    pd.reporting_fiscal_quarter
from fund_overview fo
inner join portfolio_details pd
    on fo.fund_id = pd.fund_id
order by fo.fund_nav desc, pd.total_market_value desc
  );
[0m19:31:24.297108 [debug] [Thread-3  ]: SQL status: CREATE VIEW in 0.008 seconds
[0m19:31:24.301208 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.report_ic_dashboard"
[0m19:31:24.301551 [debug] [Thread-3  ]: On model.bain_capital_analytics.report_ic_dashboard: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.report_ic_dashboard"} */
alter table "bain_analytics"."public"."report_ic_dashboard__dbt_tmp" rename to "report_ic_dashboard"
[0m19:31:24.302844 [debug] [Thread-3  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m19:31:24.303834 [debug] [Thread-3  ]: On model.bain_capital_analytics.report_ic_dashboard: COMMIT
[0m19:31:24.304146 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.report_ic_dashboard"
[0m19:31:24.304426 [debug] [Thread-3  ]: On model.bain_capital_analytics.report_ic_dashboard: COMMIT
[0m19:31:24.305510 [debug] [Thread-3  ]: SQL status: COMMIT in 0.001 seconds
[0m19:31:24.307696 [debug] [Thread-3  ]: Applying DROP to: "bain_analytics"."public"."report_ic_dashboard__dbt_backup"
[0m19:31:24.308174 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.report_ic_dashboard"
[0m19:31:24.308492 [debug] [Thread-3  ]: On model.bain_capital_analytics.report_ic_dashboard: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.report_ic_dashboard"} */
drop view if exists "bain_analytics"."public"."report_ic_dashboard__dbt_backup" cascade
[0m19:31:24.309133 [debug] [Thread-3  ]: SQL status: DROP VIEW in 0.000 seconds
[0m19:31:24.310138 [debug] [Thread-3  ]: On model.bain_capital_analytics.report_ic_dashboard: Close
[0m19:31:24.310633 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b681c8a7-b3f4-41ea-b625-4a93cae2ea4b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10abd8a00>]}
[0m19:31:24.311169 [info ] [Thread-3  ]: 56 of 57 OK created sql view model public.report_ic_dashboard .................. [[32mCREATE VIEW[0m in 0.04s]
[0m19:31:24.311610 [debug] [Thread-3  ]: Finished running node model.bain_capital_analytics.report_ic_dashboard
[0m19:31:24.312179 [debug] [Thread-1  ]: Began running node test.bain_capital_analytics.not_null_report_ic_dashboard_fund_id.e430aafd84
[0m19:31:24.312555 [info ] [Thread-1  ]: 57 of 57 START test not_null_report_ic_dashboard_fund_id ....................... [RUN]
[0m19:31:24.312926 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly test.bain_capital_analytics.not_null_fact_fund_performance_fund_id.738d6489c4, now test.bain_capital_analytics.not_null_report_ic_dashboard_fund_id.e430aafd84)
[0m19:31:24.313227 [debug] [Thread-1  ]: Began compiling node test.bain_capital_analytics.not_null_report_ic_dashboard_fund_id.e430aafd84
[0m19:31:24.317010 [debug] [Thread-1  ]: Writing injected SQL for node "test.bain_capital_analytics.not_null_report_ic_dashboard_fund_id.e430aafd84"
[0m19:31:24.317592 [debug] [Thread-1  ]: Began executing node test.bain_capital_analytics.not_null_report_ic_dashboard_fund_id.e430aafd84
[0m19:31:24.319822 [debug] [Thread-1  ]: Writing runtime sql for node "test.bain_capital_analytics.not_null_report_ic_dashboard_fund_id.e430aafd84"
[0m19:31:24.320331 [debug] [Thread-1  ]: Using postgres connection "test.bain_capital_analytics.not_null_report_ic_dashboard_fund_id.e430aafd84"
[0m19:31:24.320614 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_report_ic_dashboard_fund_id.e430aafd84: BEGIN
[0m19:31:24.320886 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m19:31:24.330429 [debug] [Thread-1  ]: SQL status: BEGIN in 0.010 seconds
[0m19:31:24.330727 [debug] [Thread-1  ]: Using postgres connection "test.bain_capital_analytics.not_null_report_ic_dashboard_fund_id.e430aafd84"
[0m19:31:24.331027 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_report_ic_dashboard_fund_id.e430aafd84: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "test.bain_capital_analytics.not_null_report_ic_dashboard_fund_id.e430aafd84"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select fund_id
from "bain_analytics"."public"."report_ic_dashboard"
where fund_id is null



  
  
      
    ) dbt_internal_test
[0m19:31:24.342461 [debug] [Thread-1  ]: SQL status: SELECT 1 in 0.011 seconds
[0m19:31:24.343797 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_report_ic_dashboard_fund_id.e430aafd84: ROLLBACK
[0m19:31:24.344446 [debug] [Thread-1  ]: On test.bain_capital_analytics.not_null_report_ic_dashboard_fund_id.e430aafd84: Close
[0m19:31:24.344984 [info ] [Thread-1  ]: 57 of 57 PASS not_null_report_ic_dashboard_fund_id ............................. [[32mPASS[0m in 0.03s]
[0m19:31:24.345459 [debug] [Thread-1  ]: Finished running node test.bain_capital_analytics.not_null_report_ic_dashboard_fund_id.e430aafd84
[0m19:31:24.346609 [debug] [MainThread]: Using postgres connection "master"
[0m19:31:24.346890 [debug] [MainThread]: On master: BEGIN
[0m19:31:24.347135 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m19:31:24.355845 [debug] [MainThread]: SQL status: BEGIN in 0.009 seconds
[0m19:31:24.356139 [debug] [MainThread]: On master: COMMIT
[0m19:31:24.356396 [debug] [MainThread]: Using postgres connection "master"
[0m19:31:24.356651 [debug] [MainThread]: On master: COMMIT
[0m19:31:24.357144 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m19:31:24.357431 [debug] [MainThread]: On master: Close
[0m19:31:24.357775 [debug] [MainThread]: Connection 'master' was properly closed.
[0m19:31:24.358023 [debug] [MainThread]: Connection 'test.bain_capital_analytics.not_null_report_ic_dashboard_fund_id.e430aafd84' was properly closed.
[0m19:31:24.358254 [debug] [MainThread]: Connection 'test.bain_capital_analytics.not_null_fact_portfolio_attribution_portfolio_id.f676c7df62' was properly closed.
[0m19:31:24.358493 [debug] [MainThread]: Connection 'model.bain_capital_analytics.report_ic_dashboard' was properly closed.
[0m19:31:24.358729 [debug] [MainThread]: Connection 'test.bain_capital_analytics.not_null_report_lp_quarterly_fund_id.aa355f6583' was properly closed.
[0m19:31:24.359140 [info ] [MainThread]: 
[0m19:31:24.359422 [info ] [MainThread]: Finished running 37 data tests, 20 view models in 0 hours 0 minutes and 1.49 seconds (1.49s).
[0m19:31:24.365400 [debug] [MainThread]: Command end result
[0m19:31:24.410147 [debug] [MainThread]: Wrote artifact WritableManifest to ./target/manifest.json
[0m19:31:24.412098 [debug] [MainThread]: Wrote artifact SemanticManifest to ./target/semantic_manifest.json
[0m19:31:24.420587 [debug] [MainThread]: Wrote artifact RunExecutionResult to ./target/run_results.json
[0m19:31:24.420909 [info ] [MainThread]: 
[0m19:31:24.421243 [info ] [MainThread]: [32mCompleted successfully[0m
[0m19:31:24.421552 [info ] [MainThread]: 
[0m19:31:24.421832 [info ] [MainThread]: Done. PASS=57 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=57
[0m19:31:24.424629 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 2.4726615, "process_in_blocks": "0", "process_kernel_time": 0.349219, "process_mem_max_rss": "142819328", "process_out_blocks": "0", "process_user_time": 3.591388}
[0m19:31:24.425003 [debug] [MainThread]: Command `dbt build` succeeded at 19:31:24.424934 after 2.47 seconds
[0m19:31:24.425371 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10823e160>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1084e0220>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109a22190>]}
[0m19:31:24.425714 [debug] [MainThread]: Flushing usage events
[0m19:31:28.444011 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m18:19:21.109876 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a2ef220>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b39ea60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b39e880>]}


============================== 18:19:21.113948 | e447ab2e-53e5-4f07-aee7-42ceb7c15488 ==============================
[0m18:19:21.113948 [info ] [MainThread]: Running with dbt=1.11.0-b3
[0m18:19:21.114527 [debug] [MainThread]: running dbt with arguments {'use_colors': 'True', 'write_json': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'partial_parse': 'True', 'empty': 'False', 'send_anonymous_usage_stats': 'True', 'warn_error': 'None', 'no_print': 'None', 'fail_fast': 'False', 'introspect': 'True', 'log_cache_events': 'False', 'indirect_selection': 'eager', 'version_check': 'True', 'invocation_command': 'dbt run', 'quiet': 'False', 'printer_width': '80', 'static_parser': 'True', 'log_path': '/Users/nedazarei/Documents/turintech/sample-dbt/postgres/logs', 'cache_selected_only': 'False', 'log_format': 'default', 'debug': 'False', 'use_experimental_parser': 'False', 'profiles_dir': '/Users/nedazarei/Documents/turintech/sample-dbt/postgres', 'target_path': 'None'}
[0m18:19:21.709315 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'e447ab2e-53e5-4f07-aee7-42ceb7c15488', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b7e9df0>]}
[0m18:19:21.784128 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'e447ab2e-53e5-4f07-aee7-42ceb7c15488', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ac20b20>]}
[0m18:19:21.785974 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m18:19:21.894510 [debug] [MainThread]: checksum: e63134dccc1251cfb572caf0e4aa952f030c125ee3634f3bf2c0a2e1bb6ae349, vars: {}, profile: , target: , version: 1.11.0b3
[0m18:19:22.130199 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m18:19:22.130676 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m18:19:22.194295 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'e447ab2e-53e5-4f07-aee7-42ceb7c15488', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c577130>]}
[0m18:19:22.320022 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/nedazarei/Documents/turintech/sample-dbt/postgres/target/manifest.json
[0m18:19:22.322439 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/nedazarei/Documents/turintech/sample-dbt/postgres/target/semantic_manifest.json
[0m18:19:22.345999 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'e447ab2e-53e5-4f07-aee7-42ceb7c15488', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c594880>]}
[0m18:19:22.346532 [info ] [MainThread]: Found 28 models, 53 data tests, 10 seeds, 569 macros
[0m18:19:22.346874 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e447ab2e-53e5-4f07-aee7-42ceb7c15488', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c5b9b80>]}
[0m18:19:22.349597 [info ] [MainThread]: 
[0m18:19:22.349933 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m18:19:22.350193 [info ] [MainThread]: 
[0m18:19:22.350654 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m18:19:22.356278 [debug] [ThreadPool]: Acquiring new postgres connection 'list_bain_analytics'
[0m18:19:22.411166 [debug] [ThreadPool]: Using postgres connection "list_bain_analytics"
[0m18:19:22.411548 [debug] [ThreadPool]: On list_bain_analytics: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "connection_name": "list_bain_analytics"} */

    select distinct nspname from pg_namespace
  
[0m18:19:22.411812 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m18:19:22.432442 [debug] [ThreadPool]: Postgres adapter: Got a retryable error when attempting to open a postgres connection.
1 attempts remaining. Retrying in 0 seconds.
Error:
connection to server at "localhost" (::1), port 5433 failed: Connection refused
	Is the server running on that host and accepting TCP/IP connections?
connection to server at "localhost" (127.0.0.1), port 5433 failed: Connection refused
	Is the server running on that host and accepting TCP/IP connections?

[0m18:19:22.434896 [debug] [ThreadPool]: Postgres adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "connection_name": "list_bain_analytics"} */

    select distinct nspname from pg_namespace
  
[0m18:19:22.435227 [debug] [ThreadPool]: Postgres adapter: Rolling back transaction.
[0m18:19:22.435546 [debug] [ThreadPool]: Postgres adapter: Error running SQL: macro list_schemas
[0m18:19:22.435806 [debug] [ThreadPool]: Postgres adapter: Rolling back transaction.
[0m18:19:22.436079 [debug] [ThreadPool]: On list_bain_analytics: No close available on handle
[0m18:19:22.436630 [debug] [MainThread]: Connection 'master' was properly closed.
[0m18:19:22.436927 [debug] [MainThread]: Connection 'list_bain_analytics' was properly closed.
[0m18:19:22.437203 [info ] [MainThread]: 
[0m18:19:22.437501 [info ] [MainThread]: Finished running  in 0 hours 0 minutes and 0.09 seconds (0.09s).
[0m18:19:22.437937 [error] [MainThread]: Encountered an error:
Database Error
  connection to server at "localhost" (::1), port 5433 failed: Connection refused
  	Is the server running on that host and accepting TCP/IP connections?
  connection to server at "localhost" (127.0.0.1), port 5433 failed: Connection refused
  	Is the server running on that host and accepting TCP/IP connections?
  
[0m18:19:22.440160 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 1.4108762, "process_in_blocks": "0", "process_kernel_time": 0.286151, "process_mem_max_rss": "131153920", "process_out_blocks": "0", "process_user_time": 2.036581}
[0m18:19:22.441623 [debug] [MainThread]: Command `dbt run` failed at 18:19:22.441534 after 1.41 seconds
[0m18:19:22.442021 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a2ef220>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c6efdc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c584880>]}
[0m18:19:22.442420 [debug] [MainThread]: Flushing usage events
[0m18:19:23.427304 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m18:24:32.261360 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10bdb20a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ce5d460>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ce5d280>]}


============================== 18:24:32.265878 | 3ea10db0-8f10-4b76-8f84-40eb6aafd034 ==============================
[0m18:24:32.265878 [info ] [MainThread]: Running with dbt=1.11.0-b3
[0m18:24:32.266466 [debug] [MainThread]: running dbt with arguments {'fail_fast': 'False', 'empty': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'log_format': 'default', 'invocation_command': 'dbt seed --profiles-dir .', 'printer_width': '80', 'debug': 'False', 'profiles_dir': '.', 'no_print': 'None', 'version_check': 'True', 'log_cache_events': 'False', 'static_parser': 'True', 'write_json': 'True', 'introspect': 'True', 'indirect_selection': 'eager', 'log_path': '/Users/nedazarei/Documents/turintech/sample-dbt/postgres/logs', 'use_colors': 'True', 'warn_error': 'None', 'target_path': 'None', 'cache_selected_only': 'False', 'send_anonymous_usage_stats': 'True', 'partial_parse': 'True', 'use_experimental_parser': 'False', 'quiet': 'False'}
[0m18:24:32.498311 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '3ea10db0-8f10-4b76-8f84-40eb6aafd034', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d413430>]}
[0m18:24:32.572516 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '3ea10db0-8f10-4b76-8f84-40eb6aafd034', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d34f4c0>]}
[0m18:24:32.574365 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m18:24:32.682239 [debug] [MainThread]: checksum: e63134dccc1251cfb572caf0e4aa952f030c125ee3634f3bf2c0a2e1bb6ae349, vars: {}, profile: , target: , version: 1.11.0b3
[0m18:24:32.926686 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m18:24:32.927134 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m18:24:32.992165 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '3ea10db0-8f10-4b76-8f84-40eb6aafd034', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e036130>]}
[0m18:24:33.118278 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/nedazarei/Documents/turintech/sample-dbt/postgres/target/manifest.json
[0m18:24:33.120714 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/nedazarei/Documents/turintech/sample-dbt/postgres/target/semantic_manifest.json
[0m18:24:33.143947 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '3ea10db0-8f10-4b76-8f84-40eb6aafd034', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e07f4c0>]}
[0m18:24:33.144461 [info ] [MainThread]: Found 28 models, 53 data tests, 10 seeds, 569 macros
[0m18:24:33.144783 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '3ea10db0-8f10-4b76-8f84-40eb6aafd034', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10dd1b8e0>]}
[0m18:24:33.147339 [info ] [MainThread]: 
[0m18:24:33.147713 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m18:24:33.147984 [info ] [MainThread]: 
[0m18:24:33.148413 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m18:24:33.153263 [debug] [ThreadPool]: Acquiring new postgres connection 'list_bain_analytics'
[0m18:24:33.211621 [debug] [ThreadPool]: Using postgres connection "list_bain_analytics"
[0m18:24:33.212140 [debug] [ThreadPool]: On list_bain_analytics: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "connection_name": "list_bain_analytics"} */

    select distinct nspname from pg_namespace
  
[0m18:24:33.212430 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m18:24:33.269863 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.057 seconds
[0m18:24:33.271283 [debug] [ThreadPool]: On list_bain_analytics: Close
[0m18:24:33.271985 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_bain_analytics, now create_bain_analytics_public_raw)
[0m18:24:33.272413 [debug] [ThreadPool]: Creating schema "database: "bain_analytics"
schema: "public_raw"
"
[0m18:24:33.277960 [debug] [ThreadPool]: Using postgres connection "create_bain_analytics_public_raw"
[0m18:24:33.278282 [debug] [ThreadPool]: On create_bain_analytics_public_raw: BEGIN
[0m18:24:33.278545 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m18:24:33.289278 [debug] [ThreadPool]: SQL status: BEGIN in 0.011 seconds
[0m18:24:33.289606 [debug] [ThreadPool]: Using postgres connection "create_bain_analytics_public_raw"
[0m18:24:33.289876 [debug] [ThreadPool]: On create_bain_analytics_public_raw: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "connection_name": "create_bain_analytics_public_raw"} */
create schema if not exists "public_raw"
[0m18:24:33.291114 [debug] [ThreadPool]: SQL status: CREATE SCHEMA in 0.001 seconds
[0m18:24:33.291858 [debug] [ThreadPool]: On create_bain_analytics_public_raw: COMMIT
[0m18:24:33.292131 [debug] [ThreadPool]: Using postgres connection "create_bain_analytics_public_raw"
[0m18:24:33.292379 [debug] [ThreadPool]: On create_bain_analytics_public_raw: COMMIT
[0m18:24:33.293448 [debug] [ThreadPool]: SQL status: COMMIT in 0.001 seconds
[0m18:24:33.293718 [debug] [ThreadPool]: On create_bain_analytics_public_raw: Close
[0m18:24:33.297066 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly create_bain_analytics_public_raw, now list_bain_analytics_public_raw)
[0m18:24:33.302503 [debug] [ThreadPool]: Using postgres connection "list_bain_analytics_public_raw"
[0m18:24:33.302905 [debug] [ThreadPool]: Acquiring new postgres connection 'list_bain_analytics_public'
[0m18:24:33.303158 [debug] [ThreadPool]: On list_bain_analytics_public_raw: BEGIN
[0m18:24:33.305705 [debug] [ThreadPool]: Using postgres connection "list_bain_analytics_public"
[0m18:24:33.305972 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m18:24:33.306221 [debug] [ThreadPool]: On list_bain_analytics_public: BEGIN
[0m18:24:33.306565 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m18:24:33.319006 [debug] [ThreadPool]: SQL status: BEGIN in 0.013 seconds
[0m18:24:33.319378 [debug] [ThreadPool]: SQL status: BEGIN in 0.013 seconds
[0m18:24:33.319674 [debug] [ThreadPool]: Using postgres connection "list_bain_analytics_public_raw"
[0m18:24:33.319962 [debug] [ThreadPool]: Using postgres connection "list_bain_analytics_public"
[0m18:24:33.320262 [debug] [ThreadPool]: On list_bain_analytics_public_raw: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "connection_name": "list_bain_analytics_public_raw"} */
select
      'bain_analytics' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_raw'
    union all
    select
      'bain_analytics' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_raw'
    union all
    select
      'bain_analytics' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_raw'
  
[0m18:24:33.320567 [debug] [ThreadPool]: On list_bain_analytics_public: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "connection_name": "list_bain_analytics_public"} */
select
      'bain_analytics' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'bain_analytics' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'bain_analytics' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m18:24:33.327321 [debug] [ThreadPool]: SQL status: SELECT 0 in 0.006 seconds
[0m18:24:33.327598 [debug] [ThreadPool]: SQL status: SELECT 0 in 0.007 seconds
[0m18:24:33.328584 [debug] [ThreadPool]: On list_bain_analytics_public: ROLLBACK
[0m18:24:33.329596 [debug] [ThreadPool]: On list_bain_analytics_public_raw: ROLLBACK
[0m18:24:33.330354 [debug] [ThreadPool]: On list_bain_analytics_public_raw: Close
[0m18:24:33.330641 [debug] [ThreadPool]: On list_bain_analytics_public: Close
[0m18:24:33.336872 [debug] [MainThread]: Using postgres connection "master"
[0m18:24:33.337155 [debug] [MainThread]: On master: BEGIN
[0m18:24:33.337406 [debug] [MainThread]: Opening a new connection, currently in state init
[0m18:24:33.346820 [debug] [MainThread]: SQL status: BEGIN in 0.009 seconds
[0m18:24:33.347079 [debug] [MainThread]: Using postgres connection "master"
[0m18:24:33.347387 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "connection_name": "master"} */
select distinct
        dependent_namespace.nspname as dependent_schema,
        dependent_class.relname as dependent_name,
        referenced_namespace.nspname as referenced_schema,
        referenced_class.relname as referenced_name

    -- Query for views: views are entries in pg_class with an entry in pg_rewrite, but we avoid
    -- a seq scan on pg_rewrite by leveraging the fact there is an "internal" row in pg_depend for
    -- the view...
    from pg_class as dependent_class
    join pg_namespace as dependent_namespace on dependent_namespace.oid = dependent_class.relnamespace
    join pg_depend as dependent_depend on dependent_depend.refobjid = dependent_class.oid
        and dependent_depend.classid = 'pg_rewrite'::regclass
        and dependent_depend.refclassid = 'pg_class'::regclass
        and dependent_depend.deptype = 'i'

    -- ... and via pg_depend (that has a row per column, hence the need for "distinct" above, and
    -- making sure to exclude the internal row to avoid a view appearing to depend on itself)...
    join pg_depend as joining_depend on joining_depend.objid = dependent_depend.objid
        and joining_depend.classid = 'pg_rewrite'::regclass
        and joining_depend.refclassid = 'pg_class'::regclass
        and joining_depend.refobjid != dependent_depend.refobjid

    -- ... we can find the tables they query from in pg_class, but excluding system tables. Note we
    -- don't need need to exclude _dependent_ system tables, because they only query from other
    -- system tables, and so are automatically excluded by excluding _referenced_ system tables
    join pg_class as referenced_class on referenced_class.oid = joining_depend.refobjid
    join pg_namespace as referenced_namespace on referenced_namespace.oid = referenced_class.relnamespace
        and referenced_namespace.nspname != 'information_schema'
        and referenced_namespace.nspname not like 'pg\_%'

    order by
        dependent_schema, dependent_name, referenced_schema, referenced_name;
[0m18:24:33.353737 [debug] [MainThread]: SQL status: SELECT 0 in 0.006 seconds
[0m18:24:33.354638 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '3ea10db0-8f10-4b76-8f84-40eb6aafd034', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b7a7400>]}
[0m18:24:33.355059 [debug] [MainThread]: On master: ROLLBACK
[0m18:24:33.355715 [debug] [MainThread]: Using postgres connection "master"
[0m18:24:33.355962 [debug] [MainThread]: On master: BEGIN
[0m18:24:33.356747 [debug] [MainThread]: SQL status: BEGIN in 0.001 seconds
[0m18:24:33.357000 [debug] [MainThread]: On master: COMMIT
[0m18:24:33.357249 [debug] [MainThread]: Using postgres connection "master"
[0m18:24:33.357487 [debug] [MainThread]: On master: COMMIT
[0m18:24:33.358015 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m18:24:33.358271 [debug] [MainThread]: On master: Close
[0m18:24:33.361310 [debug] [Thread-1  ]: Began running node seed.bain_capital_analytics.raw_benchmarks
[0m18:24:33.361676 [debug] [Thread-2  ]: Began running node seed.bain_capital_analytics.raw_cashflows
[0m18:24:33.362448 [debug] [Thread-3  ]: Began running node seed.bain_capital_analytics.raw_counterparties
[0m18:24:33.362156 [info ] [Thread-1  ]: 1 of 10 START seed file public_raw.raw_benchmarks .............................. [RUN]
[0m18:24:33.362910 [debug] [Thread-4  ]: Began running node seed.bain_capital_analytics.raw_dates
[0m18:24:33.363294 [info ] [Thread-2  ]: 2 of 10 START seed file public_raw.raw_cashflows ............................... [RUN]
[0m18:24:33.363702 [info ] [Thread-3  ]: 3 of 10 START seed file public_raw.raw_counterparties .......................... [RUN]
[0m18:24:33.364092 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_bain_analytics_public_raw, now seed.bain_capital_analytics.raw_benchmarks)
[0m18:24:33.364476 [info ] [Thread-4  ]: 4 of 10 START seed file public_raw.raw_dates ................................... [RUN]
[0m18:24:33.364943 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly list_bain_analytics_public, now seed.bain_capital_analytics.raw_cashflows)
[0m18:24:33.365338 [debug] [Thread-3  ]: Acquiring new postgres connection 'seed.bain_capital_analytics.raw_counterparties'
[0m18:24:33.365650 [debug] [Thread-1  ]: Began compiling node seed.bain_capital_analytics.raw_benchmarks
[0m18:24:33.366032 [debug] [Thread-4  ]: Acquiring new postgres connection 'seed.bain_capital_analytics.raw_dates'
[0m18:24:33.366334 [debug] [Thread-2  ]: Began compiling node seed.bain_capital_analytics.raw_cashflows
[0m18:24:33.366632 [debug] [Thread-3  ]: Began compiling node seed.bain_capital_analytics.raw_counterparties
[0m18:24:33.366948 [debug] [Thread-1  ]: Began executing node seed.bain_capital_analytics.raw_benchmarks
[0m18:24:33.367242 [debug] [Thread-4  ]: Began compiling node seed.bain_capital_analytics.raw_dates
[0m18:24:33.367543 [debug] [Thread-2  ]: Began executing node seed.bain_capital_analytics.raw_cashflows
[0m18:24:33.367840 [debug] [Thread-3  ]: Began executing node seed.bain_capital_analytics.raw_counterparties
[0m18:24:33.380708 [debug] [Thread-4  ]: Began executing node seed.bain_capital_analytics.raw_dates
[0m18:24:33.398542 [debug] [Thread-1  ]: Using postgres connection "seed.bain_capital_analytics.raw_benchmarks"
[0m18:24:33.404417 [debug] [Thread-2  ]: Using postgres connection "seed.bain_capital_analytics.raw_cashflows"
[0m18:24:33.404801 [debug] [Thread-1  ]: On seed.bain_capital_analytics.raw_benchmarks: BEGIN
[0m18:24:33.406234 [debug] [Thread-4  ]: Using postgres connection "seed.bain_capital_analytics.raw_dates"
[0m18:24:33.407307 [debug] [Thread-3  ]: Using postgres connection "seed.bain_capital_analytics.raw_counterparties"
[0m18:24:33.407639 [debug] [Thread-2  ]: On seed.bain_capital_analytics.raw_cashflows: BEGIN
[0m18:24:33.407963 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m18:24:33.408263 [debug] [Thread-4  ]: On seed.bain_capital_analytics.raw_dates: BEGIN
[0m18:24:33.408558 [debug] [Thread-3  ]: On seed.bain_capital_analytics.raw_counterparties: BEGIN
[0m18:24:33.408846 [debug] [Thread-2  ]: Opening a new connection, currently in state closed
[0m18:24:33.409274 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m18:24:33.409589 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m18:24:33.426851 [debug] [Thread-1  ]: SQL status: BEGIN in 0.019 seconds
[0m18:24:33.427202 [debug] [Thread-3  ]: SQL status: BEGIN in 0.018 seconds
[0m18:24:33.427492 [debug] [Thread-2  ]: SQL status: BEGIN in 0.019 seconds
[0m18:24:33.427770 [debug] [Thread-4  ]: SQL status: BEGIN in 0.018 seconds
[0m18:24:33.428046 [debug] [Thread-1  ]: Using postgres connection "seed.bain_capital_analytics.raw_benchmarks"
[0m18:24:33.428343 [debug] [Thread-3  ]: Using postgres connection "seed.bain_capital_analytics.raw_counterparties"
[0m18:24:33.428711 [debug] [Thread-2  ]: Using postgres connection "seed.bain_capital_analytics.raw_cashflows"
[0m18:24:33.429043 [debug] [Thread-4  ]: Using postgres connection "seed.bain_capital_analytics.raw_dates"
[0m18:24:33.429369 [debug] [Thread-1  ]: On seed.bain_capital_analytics.raw_benchmarks: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "seed.bain_capital_analytics.raw_benchmarks"} */

    create table "bain_analytics"."public_raw"."raw_benchmarks" ("benchmark_id" text,"benchmark_name" text,"benchmark_date" date,"return_daily" float8,"return_mtd" float8,"return_ytd" float8,"benchmark_level" float8)
  
[0m18:24:33.429696 [debug] [Thread-3  ]: On seed.bain_capital_analytics.raw_counterparties: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "seed.bain_capital_analytics.raw_counterparties"} */

    create table "bain_analytics"."public_raw"."raw_counterparties" ("counterparty_id" text,"counterparty_name" text,"counterparty_type" text,"country" text,"credit_rating" text,"is_active" boolean)
  
[0m18:24:33.430018 [debug] [Thread-2  ]: On seed.bain_capital_analytics.raw_cashflows: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "seed.bain_capital_analytics.raw_cashflows"} */

    create table "bain_analytics"."public_raw"."raw_cashflows" ("cashflow_id" text,"fund_id" text,"portfolio_id" text,"cashflow_date" date,"cashflow_type" text,"amount" integer,"currency" text,"description" text,"investor_id" text)
  
[0m18:24:33.430335 [debug] [Thread-4  ]: On seed.bain_capital_analytics.raw_dates: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "seed.bain_capital_analytics.raw_dates"} */

    create table "bain_analytics"."public_raw"."raw_dates" ("date_day" date,"is_business_day" boolean,"is_month_end" boolean,"is_quarter_end" boolean,"is_year_end" boolean,"fiscal_quarter" text,"fiscal_year" text)
  
[0m18:24:33.439147 [debug] [Thread-2  ]: SQL status: CREATE TABLE in 0.008 seconds
[0m18:24:33.439453 [debug] [Thread-3  ]: SQL status: CREATE TABLE in 0.009 seconds
[0m18:24:33.439735 [debug] [Thread-1  ]: SQL status: CREATE TABLE in 0.009 seconds
[0m18:24:33.445337 [debug] [Thread-4  ]: SQL status: CREATE TABLE in 0.015 seconds
[0m18:24:33.467928 [debug] [Thread-3  ]: Using postgres connection "seed.bain_capital_analytics.raw_counterparties"
[0m18:24:33.471236 [debug] [Thread-2  ]: Using postgres connection "seed.bain_capital_analytics.raw_cashflows"
[0m18:24:33.486761 [debug] [Thread-1  ]: Using postgres connection "seed.bain_capital_analytics.raw_benchmarks"
[0m18:24:33.532112 [debug] [Thread-4  ]: Using postgres connection "seed.bain_capital_analytics.raw_dates"
[0m18:24:33.532526 [debug] [Thread-3  ]: On seed.bain_capital_analytics.raw_counterparties: 
          insert into "bain_analytics"."public_raw"."raw_counterparties" ("counterparty_id", "counterparty_name", "counterparty_type", "country", "credit_rating", "is_active") values
          (%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s)
      ...
[0m18:24:33.532881 [debug] [Thread-2  ]: On seed.bain_capital_analytics.raw_cashflows: 
          insert into "bain_analytics"."public_raw"."raw_cashflows" ("cashflow_id", "fund_id", "portfolio_id", "cashflow_date", "cashflow_type", "amount", "currency", "description", "investor_id") values
          (%s,%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,...
[0m18:24:33.533218 [debug] [Thread-1  ]: On seed.bain_capital_analytics.raw_benchmarks: 
          insert into "bain_analytics"."public_raw"."raw_benchmarks" ("benchmark_id", "benchmark_name", "benchmark_date", "return_daily", "return_mtd", "return_ytd", "benchmark_level") values
          (%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,...
[0m18:24:33.533550 [debug] [Thread-4  ]: On seed.bain_capital_analytics.raw_dates: 
          insert into "bain_analytics"."public_raw"."raw_dates" ("date_day", "is_business_day", "is_month_end", "is_quarter_end", "is_year_end", "fiscal_quarter", "fiscal_year") values
          (%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%...
[0m18:24:33.535978 [debug] [Thread-3  ]: SQL status: INSERT 0 10 in 0.002 seconds
[0m18:24:33.536305 [debug] [Thread-4  ]: SQL status: INSERT 0 15 in 0.002 seconds
[0m18:24:33.541313 [debug] [Thread-3  ]: Writing runtime SQL for node "seed.bain_capital_analytics.raw_counterparties"
[0m18:24:33.541652 [debug] [Thread-2  ]: SQL status: INSERT 0 25 in 0.008 seconds
[0m18:24:33.541938 [debug] [Thread-1  ]: SQL status: INSERT 0 35 in 0.008 seconds
[0m18:24:33.542420 [debug] [Thread-4  ]: Writing runtime SQL for node "seed.bain_capital_analytics.raw_dates"
[0m18:24:33.542981 [debug] [Thread-2  ]: Writing runtime SQL for node "seed.bain_capital_analytics.raw_cashflows"
[0m18:24:33.543466 [debug] [Thread-1  ]: Writing runtime SQL for node "seed.bain_capital_analytics.raw_benchmarks"
[0m18:24:33.560289 [debug] [Thread-1  ]: On seed.bain_capital_analytics.raw_benchmarks: COMMIT
[0m18:24:33.561493 [debug] [Thread-3  ]: On seed.bain_capital_analytics.raw_counterparties: COMMIT
[0m18:24:33.562787 [debug] [Thread-4  ]: On seed.bain_capital_analytics.raw_dates: COMMIT
[0m18:24:33.563144 [debug] [Thread-1  ]: Using postgres connection "seed.bain_capital_analytics.raw_benchmarks"
[0m18:24:33.564258 [debug] [Thread-2  ]: On seed.bain_capital_analytics.raw_cashflows: COMMIT
[0m18:24:33.564568 [debug] [Thread-3  ]: Using postgres connection "seed.bain_capital_analytics.raw_counterparties"
[0m18:24:33.564877 [debug] [Thread-4  ]: Using postgres connection "seed.bain_capital_analytics.raw_dates"
[0m18:24:33.565173 [debug] [Thread-1  ]: On seed.bain_capital_analytics.raw_benchmarks: COMMIT
[0m18:24:33.565479 [debug] [Thread-2  ]: Using postgres connection "seed.bain_capital_analytics.raw_cashflows"
[0m18:24:33.565774 [debug] [Thread-3  ]: On seed.bain_capital_analytics.raw_counterparties: COMMIT
[0m18:24:33.566068 [debug] [Thread-4  ]: On seed.bain_capital_analytics.raw_dates: COMMIT
[0m18:24:33.566408 [debug] [Thread-2  ]: On seed.bain_capital_analytics.raw_cashflows: COMMIT
[0m18:24:33.568612 [debug] [Thread-1  ]: SQL status: COMMIT in 0.002 seconds
[0m18:24:33.570328 [debug] [Thread-1  ]: On seed.bain_capital_analytics.raw_benchmarks: Close
[0m18:24:33.570652 [debug] [Thread-3  ]: SQL status: COMMIT in 0.004 seconds
[0m18:24:33.570939 [debug] [Thread-2  ]: SQL status: COMMIT in 0.004 seconds
[0m18:24:33.571210 [debug] [Thread-4  ]: SQL status: COMMIT in 0.004 seconds
[0m18:24:33.571786 [debug] [Thread-3  ]: On seed.bain_capital_analytics.raw_counterparties: Close
[0m18:24:33.572925 [debug] [Thread-2  ]: On seed.bain_capital_analytics.raw_cashflows: Close
[0m18:24:33.574026 [debug] [Thread-4  ]: On seed.bain_capital_analytics.raw_dates: Close
[0m18:24:33.575129 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3ea10db0-8f10-4b76-8f84-40eb6aafd034', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b83eee0>]}
[0m18:24:33.575450 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3ea10db0-8f10-4b76-8f84-40eb6aafd034', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e662490>]}
[0m18:24:33.575825 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3ea10db0-8f10-4b76-8f84-40eb6aafd034', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e65cf70>]}
[0m18:24:33.576598 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3ea10db0-8f10-4b76-8f84-40eb6aafd034', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e45ed60>]}
[0m18:24:33.576207 [info ] [Thread-1  ]: 1 of 10 OK loaded seed file public_raw.raw_benchmarks .......................... [[32mINSERT 35[0m in 0.21s]
[0m18:24:33.577092 [info ] [Thread-3  ]: 3 of 10 OK loaded seed file public_raw.raw_counterparties ...................... [[32mINSERT 10[0m in 0.21s]
[0m18:24:33.577628 [info ] [Thread-2  ]: 2 of 10 OK loaded seed file public_raw.raw_cashflows ........................... [[32mINSERT 25[0m in 0.21s]
[0m18:24:33.578030 [info ] [Thread-4  ]: 4 of 10 OK loaded seed file public_raw.raw_dates ............................... [[32mINSERT 15[0m in 0.21s]
[0m18:24:33.578511 [debug] [Thread-1  ]: Finished running node seed.bain_capital_analytics.raw_benchmarks
[0m18:24:33.579002 [debug] [Thread-3  ]: Finished running node seed.bain_capital_analytics.raw_counterparties
[0m18:24:33.579446 [debug] [Thread-2  ]: Finished running node seed.bain_capital_analytics.raw_cashflows
[0m18:24:33.579867 [debug] [Thread-4  ]: Finished running node seed.bain_capital_analytics.raw_dates
[0m18:24:33.580231 [debug] [Thread-1  ]: Began running node seed.bain_capital_analytics.raw_fund_structures
[0m18:24:33.580628 [debug] [Thread-3  ]: Began running node seed.bain_capital_analytics.raw_instruments
[0m18:24:33.580984 [debug] [Thread-2  ]: Began running node seed.bain_capital_analytics.raw_portfolios
[0m18:24:33.581324 [debug] [Thread-4  ]: Began running node seed.bain_capital_analytics.raw_positions
[0m18:24:33.581781 [info ] [Thread-1  ]: 5 of 10 START seed file public_raw.raw_fund_structures ......................... [RUN]
[0m18:24:33.582213 [info ] [Thread-3  ]: 6 of 10 START seed file public_raw.raw_instruments ............................. [RUN]
[0m18:24:33.582631 [info ] [Thread-2  ]: 7 of 10 START seed file public_raw.raw_portfolios .............................. [RUN]
[0m18:24:33.583043 [info ] [Thread-4  ]: 8 of 10 START seed file public_raw.raw_positions ............................... [RUN]
[0m18:24:33.583450 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly seed.bain_capital_analytics.raw_benchmarks, now seed.bain_capital_analytics.raw_fund_structures)
[0m18:24:33.583789 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly seed.bain_capital_analytics.raw_counterparties, now seed.bain_capital_analytics.raw_instruments)
[0m18:24:33.584113 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly seed.bain_capital_analytics.raw_cashflows, now seed.bain_capital_analytics.raw_portfolios)
[0m18:24:33.584431 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly seed.bain_capital_analytics.raw_dates, now seed.bain_capital_analytics.raw_positions)
[0m18:24:33.584750 [debug] [Thread-1  ]: Began compiling node seed.bain_capital_analytics.raw_fund_structures
[0m18:24:33.585048 [debug] [Thread-3  ]: Began compiling node seed.bain_capital_analytics.raw_instruments
[0m18:24:33.585343 [debug] [Thread-2  ]: Began compiling node seed.bain_capital_analytics.raw_portfolios
[0m18:24:33.585638 [debug] [Thread-4  ]: Began compiling node seed.bain_capital_analytics.raw_positions
[0m18:24:33.585947 [debug] [Thread-1  ]: Began executing node seed.bain_capital_analytics.raw_fund_structures
[0m18:24:33.586263 [debug] [Thread-3  ]: Began executing node seed.bain_capital_analytics.raw_instruments
[0m18:24:33.586557 [debug] [Thread-2  ]: Began executing node seed.bain_capital_analytics.raw_portfolios
[0m18:24:33.586852 [debug] [Thread-4  ]: Began executing node seed.bain_capital_analytics.raw_positions
[0m18:24:33.595545 [debug] [Thread-3  ]: Using postgres connection "seed.bain_capital_analytics.raw_instruments"
[0m18:24:33.600374 [debug] [Thread-1  ]: Using postgres connection "seed.bain_capital_analytics.raw_fund_structures"
[0m18:24:33.601338 [debug] [Thread-3  ]: On seed.bain_capital_analytics.raw_instruments: BEGIN
[0m18:24:33.602404 [debug] [Thread-2  ]: Using postgres connection "seed.bain_capital_analytics.raw_portfolios"
[0m18:24:33.604614 [debug] [Thread-4  ]: Using postgres connection "seed.bain_capital_analytics.raw_positions"
[0m18:24:33.604952 [debug] [Thread-1  ]: On seed.bain_capital_analytics.raw_fund_structures: BEGIN
[0m18:24:33.605345 [debug] [Thread-3  ]: Opening a new connection, currently in state closed
[0m18:24:33.605650 [debug] [Thread-2  ]: On seed.bain_capital_analytics.raw_portfolios: BEGIN
[0m18:24:33.605941 [debug] [Thread-4  ]: On seed.bain_capital_analytics.raw_positions: BEGIN
[0m18:24:33.606230 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m18:24:33.606656 [debug] [Thread-2  ]: Opening a new connection, currently in state closed
[0m18:24:33.606969 [debug] [Thread-4  ]: Opening a new connection, currently in state closed
[0m18:24:33.622115 [debug] [Thread-4  ]: SQL status: BEGIN in 0.015 seconds
[0m18:24:33.622508 [debug] [Thread-3  ]: SQL status: BEGIN in 0.017 seconds
[0m18:24:33.622818 [debug] [Thread-1  ]: SQL status: BEGIN in 0.017 seconds
[0m18:24:33.623161 [debug] [Thread-4  ]: Using postgres connection "seed.bain_capital_analytics.raw_positions"
[0m18:24:33.623483 [debug] [Thread-3  ]: Using postgres connection "seed.bain_capital_analytics.raw_instruments"
[0m18:24:33.623781 [debug] [Thread-2  ]: SQL status: BEGIN in 0.017 seconds
[0m18:24:33.624075 [debug] [Thread-1  ]: Using postgres connection "seed.bain_capital_analytics.raw_fund_structures"
[0m18:24:33.624388 [debug] [Thread-4  ]: On seed.bain_capital_analytics.raw_positions: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "seed.bain_capital_analytics.raw_positions"} */

    create table "bain_analytics"."public_raw"."raw_positions" ("position_id" text,"portfolio_id" text,"instrument_id" text,"position_date" date,"quantity" integer,"market_value" integer,"cost_basis" integer,"currency" text)
  
[0m18:24:33.624704 [debug] [Thread-3  ]: On seed.bain_capital_analytics.raw_instruments: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "seed.bain_capital_analytics.raw_instruments"} */

    create table "bain_analytics"."public_raw"."raw_instruments" ("instrument_id" text,"instrument_name" text,"instrument_type" text,"sector" text,"currency" text,"exchange" text,"issuer" text,"maturity_date" date)
  
[0m18:24:33.625002 [debug] [Thread-2  ]: Using postgres connection "seed.bain_capital_analytics.raw_portfolios"
[0m18:24:33.625299 [debug] [Thread-1  ]: On seed.bain_capital_analytics.raw_fund_structures: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "seed.bain_capital_analytics.raw_fund_structures"} */

    create table "bain_analytics"."public_raw"."raw_fund_structures" ("fund_id" text,"fund_name" text,"fund_type" text,"vintage_year" integer,"committed_capital" integer,"management_fee_rate" float8,"carry_rate" float8,"hurdle_rate" float8,"gp_commitment_pct" float8,"fund_currency" text,"fund_status" text)
  
[0m18:24:33.625685 [debug] [Thread-2  ]: On seed.bain_capital_analytics.raw_portfolios: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "seed.bain_capital_analytics.raw_portfolios"} */

    create table "bain_analytics"."public_raw"."raw_portfolios" ("portfolio_id" text,"portfolio_name" text,"strategy" text,"inception_date" date,"fund_id" text,"manager_name" text,"is_active" boolean)
  
[0m18:24:33.632220 [debug] [Thread-3  ]: SQL status: CREATE TABLE in 0.007 seconds
[0m18:24:33.638992 [debug] [Thread-1  ]: SQL status: CREATE TABLE in 0.013 seconds
[0m18:24:33.643173 [debug] [Thread-3  ]: Using postgres connection "seed.bain_capital_analytics.raw_instruments"
[0m18:24:33.643477 [debug] [Thread-2  ]: SQL status: CREATE TABLE in 0.017 seconds
[0m18:24:33.646744 [debug] [Thread-1  ]: Using postgres connection "seed.bain_capital_analytics.raw_fund_structures"
[0m18:24:33.647070 [debug] [Thread-4  ]: SQL status: CREATE TABLE in 0.021 seconds
[0m18:24:33.647414 [debug] [Thread-3  ]: On seed.bain_capital_analytics.raw_instruments: 
          insert into "bain_analytics"."public_raw"."raw_instruments" ("instrument_id", "instrument_name", "instrument_type", "sector", "currency", "exchange", "issuer", "maturity_date") values
          (%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s...
[0m18:24:33.650580 [debug] [Thread-2  ]: Using postgres connection "seed.bain_capital_analytics.raw_portfolios"
[0m18:24:33.650918 [debug] [Thread-1  ]: On seed.bain_capital_analytics.raw_fund_structures: 
          insert into "bain_analytics"."public_raw"."raw_fund_structures" ("fund_id", "fund_name", "fund_type", "vintage_year", "committed_capital", "management_fee_rate", "carry_rate", "hurdle_rate", "gp_commitment_pct", "fund_currency", "fund_status") values
          (%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s)
      ...
[0m18:24:33.665881 [debug] [Thread-4  ]: Using postgres connection "seed.bain_capital_analytics.raw_positions"
[0m18:24:33.666214 [debug] [Thread-3  ]: SQL status: INSERT 0 20 in 0.003 seconds
[0m18:24:33.666533 [debug] [Thread-2  ]: On seed.bain_capital_analytics.raw_portfolios: 
          insert into "bain_analytics"."public_raw"."raw_portfolios" ("portfolio_id", "portfolio_name", "strategy", "inception_date", "fund_id", "manager_name", "is_active") values
          (%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s)
      ...
[0m18:24:33.666937 [debug] [Thread-4  ]: On seed.bain_capital_analytics.raw_positions: 
          insert into "bain_analytics"."public_raw"."raw_positions" ("position_id", "portfolio_id", "instrument_id", "position_date", "quantity", "market_value", "cost_basis", "currency") values
          (%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%...
[0m18:24:33.667434 [debug] [Thread-3  ]: Writing runtime SQL for node "seed.bain_capital_analytics.raw_instruments"
[0m18:24:33.669235 [debug] [Thread-3  ]: On seed.bain_capital_analytics.raw_instruments: COMMIT
[0m18:24:33.669561 [debug] [Thread-4  ]: SQL status: INSERT 0 30 in 0.002 seconds
[0m18:24:33.669861 [debug] [Thread-2  ]: SQL status: INSERT 0 5 in 0.002 seconds
[0m18:24:33.670151 [debug] [Thread-3  ]: Using postgres connection "seed.bain_capital_analytics.raw_instruments"
[0m18:24:33.670425 [debug] [Thread-1  ]: SQL status: INSERT 0 3 in 0.004 seconds
[0m18:24:33.670915 [debug] [Thread-4  ]: Writing runtime SQL for node "seed.bain_capital_analytics.raw_positions"
[0m18:24:33.671382 [debug] [Thread-2  ]: Writing runtime SQL for node "seed.bain_capital_analytics.raw_portfolios"
[0m18:24:33.671694 [debug] [Thread-3  ]: On seed.bain_capital_analytics.raw_instruments: COMMIT
[0m18:24:33.672145 [debug] [Thread-1  ]: Writing runtime SQL for node "seed.bain_capital_analytics.raw_fund_structures"
[0m18:24:33.673513 [debug] [Thread-4  ]: On seed.bain_capital_analytics.raw_positions: COMMIT
[0m18:24:33.673830 [debug] [Thread-3  ]: SQL status: COMMIT in 0.001 seconds
[0m18:24:33.674851 [debug] [Thread-2  ]: On seed.bain_capital_analytics.raw_portfolios: COMMIT
[0m18:24:33.675145 [debug] [Thread-4  ]: Using postgres connection "seed.bain_capital_analytics.raw_positions"
[0m18:24:33.675796 [debug] [Thread-3  ]: On seed.bain_capital_analytics.raw_instruments: Close
[0m18:24:33.676831 [debug] [Thread-1  ]: On seed.bain_capital_analytics.raw_fund_structures: COMMIT
[0m18:24:33.677121 [debug] [Thread-2  ]: Using postgres connection "seed.bain_capital_analytics.raw_portfolios"
[0m18:24:33.677417 [debug] [Thread-4  ]: On seed.bain_capital_analytics.raw_positions: COMMIT
[0m18:24:33.677940 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3ea10db0-8f10-4b76-8f84-40eb6aafd034', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e1d5fa0>]}
[0m18:24:33.678247 [debug] [Thread-1  ]: Using postgres connection "seed.bain_capital_analytics.raw_fund_structures"
[0m18:24:33.678555 [debug] [Thread-2  ]: On seed.bain_capital_analytics.raw_portfolios: COMMIT
[0m18:24:33.679364 [debug] [Thread-1  ]: On seed.bain_capital_analytics.raw_fund_structures: COMMIT
[0m18:24:33.679110 [info ] [Thread-3  ]: 6 of 10 OK loaded seed file public_raw.raw_instruments ......................... [[32mINSERT 20[0m in 0.09s]
[0m18:24:33.679932 [debug] [Thread-4  ]: SQL status: COMMIT in 0.001 seconds
[0m18:24:33.680356 [debug] [Thread-3  ]: Finished running node seed.bain_capital_analytics.raw_instruments
[0m18:24:33.680933 [debug] [Thread-4  ]: On seed.bain_capital_analytics.raw_positions: Close
[0m18:24:33.681240 [debug] [Thread-2  ]: SQL status: COMMIT in 0.001 seconds
[0m18:24:33.681572 [debug] [Thread-3  ]: Began running node seed.bain_capital_analytics.raw_trades
[0m18:24:33.681859 [debug] [Thread-1  ]: SQL status: COMMIT in 0.002 seconds
[0m18:24:33.682367 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3ea10db0-8f10-4b76-8f84-40eb6aafd034', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d66aac0>]}
[0m18:24:33.682943 [debug] [Thread-2  ]: On seed.bain_capital_analytics.raw_portfolios: Close
[0m18:24:33.683359 [info ] [Thread-3  ]: 9 of 10 START seed file public_raw.raw_trades .................................. [RUN]
[0m18:24:33.683967 [debug] [Thread-1  ]: On seed.bain_capital_analytics.raw_fund_structures: Close
[0m18:24:33.684403 [info ] [Thread-4  ]: 8 of 10 OK loaded seed file public_raw.raw_positions ........................... [[32mINSERT 30[0m in 0.10s]
[0m18:24:33.684851 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3ea10db0-8f10-4b76-8f84-40eb6aafd034', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d633b50>]}
[0m18:24:33.685315 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly seed.bain_capital_analytics.raw_instruments, now seed.bain_capital_analytics.raw_trades)
[0m18:24:33.685753 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3ea10db0-8f10-4b76-8f84-40eb6aafd034', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d66a3d0>]}
[0m18:24:33.686165 [debug] [Thread-4  ]: Finished running node seed.bain_capital_analytics.raw_positions
[0m18:24:33.686564 [info ] [Thread-2  ]: 7 of 10 OK loaded seed file public_raw.raw_portfolios .......................... [[32mINSERT 5[0m in 0.10s]
[0m18:24:33.686901 [debug] [Thread-3  ]: Began compiling node seed.bain_capital_analytics.raw_trades
[0m18:24:33.687298 [info ] [Thread-1  ]: 5 of 10 OK loaded seed file public_raw.raw_fund_structures ..................... [[32mINSERT 3[0m in 0.10s]
[0m18:24:33.687670 [debug] [Thread-4  ]: Began running node seed.bain_capital_analytics.raw_valuations
[0m18:24:33.688117 [debug] [Thread-2  ]: Finished running node seed.bain_capital_analytics.raw_portfolios
[0m18:24:33.688426 [debug] [Thread-3  ]: Began executing node seed.bain_capital_analytics.raw_trades
[0m18:24:33.688859 [debug] [Thread-1  ]: Finished running node seed.bain_capital_analytics.raw_fund_structures
[0m18:24:33.689254 [info ] [Thread-4  ]: 10 of 10 START seed file public_raw.raw_valuations ............................. [RUN]
[0m18:24:33.692460 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly seed.bain_capital_analytics.raw_positions, now seed.bain_capital_analytics.raw_valuations)
[0m18:24:33.692787 [debug] [Thread-4  ]: Began compiling node seed.bain_capital_analytics.raw_valuations
[0m18:24:33.697831 [debug] [Thread-3  ]: Using postgres connection "seed.bain_capital_analytics.raw_trades"
[0m18:24:33.698138 [debug] [Thread-4  ]: Began executing node seed.bain_capital_analytics.raw_valuations
[0m18:24:33.698435 [debug] [Thread-3  ]: On seed.bain_capital_analytics.raw_trades: BEGIN
[0m18:24:33.701339 [debug] [Thread-3  ]: Opening a new connection, currently in state closed
[0m18:24:33.703774 [debug] [Thread-4  ]: Using postgres connection "seed.bain_capital_analytics.raw_valuations"
[0m18:24:33.704094 [debug] [Thread-4  ]: On seed.bain_capital_analytics.raw_valuations: BEGIN
[0m18:24:33.704378 [debug] [Thread-4  ]: Opening a new connection, currently in state closed
[0m18:24:33.710961 [debug] [Thread-3  ]: SQL status: BEGIN in 0.010 seconds
[0m18:24:33.711414 [debug] [Thread-3  ]: Using postgres connection "seed.bain_capital_analytics.raw_trades"
[0m18:24:33.711804 [debug] [Thread-3  ]: On seed.bain_capital_analytics.raw_trades: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "seed.bain_capital_analytics.raw_trades"} */

    create table "bain_analytics"."public_raw"."raw_trades" ("trade_id" text,"portfolio_id" text,"instrument_id" text,"counterparty_id" text,"trade_date" date,"settlement_date" date,"trade_type" text,"quantity" integer,"price" float8,"notional_amount" integer,"commission" float8,"currency" text,"status" text)
  
[0m18:24:33.713261 [debug] [Thread-4  ]: SQL status: BEGIN in 0.009 seconds
[0m18:24:33.713592 [debug] [Thread-4  ]: Using postgres connection "seed.bain_capital_analytics.raw_valuations"
[0m18:24:33.713902 [debug] [Thread-4  ]: On seed.bain_capital_analytics.raw_valuations: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "seed.bain_capital_analytics.raw_valuations"} */

    create table "bain_analytics"."public_raw"."raw_valuations" ("valuation_id" text,"portfolio_id" text,"valuation_date" date,"gross_asset_value" integer,"net_asset_value" integer,"total_liabilities" integer,"unrealized_pnl" integer,"realized_pnl" integer,"valuation_method" text)
  
[0m18:24:33.714943 [debug] [Thread-3  ]: SQL status: CREATE TABLE in 0.003 seconds
[0m18:24:33.723458 [debug] [Thread-4  ]: SQL status: CREATE TABLE in 0.009 seconds
[0m18:24:33.747601 [debug] [Thread-4  ]: Using postgres connection "seed.bain_capital_analytics.raw_valuations"
[0m18:24:33.754324 [debug] [Thread-4  ]: On seed.bain_capital_analytics.raw_valuations: 
          insert into "bain_analytics"."public_raw"."raw_valuations" ("valuation_id", "portfolio_id", "valuation_date", "gross_asset_value", "net_asset_value", "total_liabilities", "unrealized_pnl", "realized_pnl", "valuation_method") values
          (%s,%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s,%s...
[0m18:24:33.758580 [debug] [Thread-3  ]: Using postgres connection "seed.bain_capital_analytics.raw_trades"
[0m18:24:33.759150 [debug] [Thread-3  ]: On seed.bain_capital_analytics.raw_trades: 
          insert into "bain_analytics"."public_raw"."raw_trades" ("trade_id", "portfolio_id", "instrument_id", "counterparty_id", "trade_date", "settlement_date", "trade_type", "quantity", "price", "notional_amount", "commission", "currency", "status") values
          (%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s...
[0m18:24:33.760294 [debug] [Thread-4  ]: SQL status: INSERT 0 21 in 0.001 seconds
[0m18:24:33.760835 [debug] [Thread-4  ]: Writing runtime SQL for node "seed.bain_capital_analytics.raw_valuations"
[0m18:24:33.761221 [debug] [Thread-3  ]: SQL status: INSERT 0 40 in 0.002 seconds
[0m18:24:33.761818 [debug] [Thread-3  ]: Writing runtime SQL for node "seed.bain_capital_analytics.raw_trades"
[0m18:24:33.763258 [debug] [Thread-4  ]: On seed.bain_capital_analytics.raw_valuations: COMMIT
[0m18:24:33.763628 [debug] [Thread-4  ]: Using postgres connection "seed.bain_capital_analytics.raw_valuations"
[0m18:24:33.764831 [debug] [Thread-3  ]: On seed.bain_capital_analytics.raw_trades: COMMIT
[0m18:24:33.765143 [debug] [Thread-4  ]: On seed.bain_capital_analytics.raw_valuations: COMMIT
[0m18:24:33.765448 [debug] [Thread-3  ]: Using postgres connection "seed.bain_capital_analytics.raw_trades"
[0m18:24:33.765791 [debug] [Thread-3  ]: On seed.bain_capital_analytics.raw_trades: COMMIT
[0m18:24:33.766457 [debug] [Thread-4  ]: SQL status: COMMIT in 0.001 seconds
[0m18:24:33.766776 [debug] [Thread-3  ]: SQL status: COMMIT in 0.001 seconds
[0m18:24:33.767383 [debug] [Thread-4  ]: On seed.bain_capital_analytics.raw_valuations: Close
[0m18:24:33.767971 [debug] [Thread-3  ]: On seed.bain_capital_analytics.raw_trades: Close
[0m18:24:33.768479 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3ea10db0-8f10-4b76-8f84-40eb6aafd034', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e6cecd0>]}
[0m18:24:33.768962 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3ea10db0-8f10-4b76-8f84-40eb6aafd034', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e5ab0d0>]}
[0m18:24:33.769481 [info ] [Thread-4  ]: 10 of 10 OK loaded seed file public_raw.raw_valuations ......................... [[32mINSERT 21[0m in 0.08s]
[0m18:24:33.770405 [debug] [Thread-4  ]: Finished running node seed.bain_capital_analytics.raw_valuations
[0m18:24:33.769864 [info ] [Thread-3  ]: 9 of 10 OK loaded seed file public_raw.raw_trades .............................. [[32mINSERT 40[0m in 0.08s]
[0m18:24:33.771058 [debug] [Thread-3  ]: Finished running node seed.bain_capital_analytics.raw_trades
[0m18:24:33.772375 [debug] [MainThread]: Using postgres connection "master"
[0m18:24:33.772691 [debug] [MainThread]: On master: BEGIN
[0m18:24:33.772952 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m18:24:33.781526 [debug] [MainThread]: SQL status: BEGIN in 0.009 seconds
[0m18:24:33.781851 [debug] [MainThread]: On master: COMMIT
[0m18:24:33.782114 [debug] [MainThread]: Using postgres connection "master"
[0m18:24:33.782366 [debug] [MainThread]: On master: COMMIT
[0m18:24:33.782830 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m18:24:33.783094 [debug] [MainThread]: On master: Close
[0m18:24:33.783452 [debug] [MainThread]: Connection 'master' was properly closed.
[0m18:24:33.783697 [debug] [MainThread]: Connection 'seed.bain_capital_analytics.raw_fund_structures' was properly closed.
[0m18:24:33.783926 [debug] [MainThread]: Connection 'seed.bain_capital_analytics.raw_portfolios' was properly closed.
[0m18:24:33.784150 [debug] [MainThread]: Connection 'seed.bain_capital_analytics.raw_trades' was properly closed.
[0m18:24:33.784371 [debug] [MainThread]: Connection 'seed.bain_capital_analytics.raw_valuations' was properly closed.
[0m18:24:33.784666 [info ] [MainThread]: 
[0m18:24:33.784949 [info ] [MainThread]: Finished running 10 seeds in 0 hours 0 minutes and 0.64 seconds (0.64s).
[0m18:24:33.786479 [debug] [MainThread]: Command end result
[0m18:24:33.828190 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/nedazarei/Documents/turintech/sample-dbt/postgres/target/manifest.json
[0m18:24:33.830360 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/nedazarei/Documents/turintech/sample-dbt/postgres/target/semantic_manifest.json
[0m18:24:33.836809 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/nedazarei/Documents/turintech/sample-dbt/postgres/target/run_results.json
[0m18:24:33.837128 [info ] [MainThread]: 
[0m18:24:33.837488 [info ] [MainThread]: [32mCompleted successfully[0m
[0m18:24:33.837779 [info ] [MainThread]: 
[0m18:24:33.838066 [info ] [MainThread]: Done. PASS=10 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=10
[0m18:24:33.841224 [debug] [MainThread]: Resource report: {"command_name": "seed", "command_success": true, "command_wall_clock_time": 1.667666, "process_in_blocks": "0", "process_kernel_time": 0.370061, "process_mem_max_rss": "137068544", "process_out_blocks": "0", "process_user_time": 2.582955}
[0m18:24:33.841581 [debug] [MainThread]: Command `dbt seed` succeeded at 18:24:33.841508 after 1.67 seconds
[0m18:24:33.841918 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10bdb20a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a668310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d5618e0>]}
[0m18:24:33.842254 [debug] [MainThread]: Flushing usage events
[0m18:24:35.014596 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m18:24:47.129562 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c9a11c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10da4ea90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10da4e8b0>]}


============================== 18:24:47.133884 | a133ca29-1656-4fd8-ac3b-1ffaa0897334 ==============================
[0m18:24:47.133884 [info ] [MainThread]: Running with dbt=1.11.0-b3
[0m18:24:47.134431 [debug] [MainThread]: running dbt with arguments {'quiet': 'False', 'send_anonymous_usage_stats': 'True', 'partial_parse': 'True', 'debug': 'False', 'profiles_dir': '.', 'use_colors': 'True', 'introspect': 'True', 'log_path': '/Users/nedazarei/Documents/turintech/sample-dbt/postgres/logs', 'invocation_command': 'dbt run --profiles-dir .', 'use_experimental_parser': 'False', 'printer_width': '80', 'fail_fast': 'False', 'version_check': 'True', 'indirect_selection': 'eager', 'cache_selected_only': 'False', 'warn_error': 'None', 'write_json': 'True', 'target_path': 'None', 'static_parser': 'True', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'log_format': 'default', 'empty': 'False', 'log_cache_events': 'False'}
[0m18:24:47.349743 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'a133ca29-1656-4fd8-ac3b-1ffaa0897334', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10da1d550>]}
[0m18:24:47.423721 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'a133ca29-1656-4fd8-ac3b-1ffaa0897334', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10da0b3a0>]}
[0m18:24:47.425156 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m18:24:47.532617 [debug] [MainThread]: checksum: e63134dccc1251cfb572caf0e4aa952f030c125ee3634f3bf2c0a2e1bb6ae349, vars: {}, profile: , target: , version: 1.11.0b3
[0m18:24:47.761588 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m18:24:47.762162 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m18:24:47.827383 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'a133ca29-1656-4fd8-ac3b-1ffaa0897334', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ec25130>]}
[0m18:24:47.955117 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/nedazarei/Documents/turintech/sample-dbt/postgres/target/manifest.json
[0m18:24:47.957521 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/nedazarei/Documents/turintech/sample-dbt/postgres/target/semantic_manifest.json
[0m18:24:47.979832 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'a133ca29-1656-4fd8-ac3b-1ffaa0897334', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ec40880>]}
[0m18:24:47.980351 [info ] [MainThread]: Found 28 models, 53 data tests, 10 seeds, 569 macros
[0m18:24:47.980678 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a133ca29-1656-4fd8-ac3b-1ffaa0897334', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ec68520>]}
[0m18:24:47.983320 [info ] [MainThread]: 
[0m18:24:47.983630 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m18:24:47.983882 [info ] [MainThread]: 
[0m18:24:47.984317 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m18:24:47.989728 [debug] [ThreadPool]: Acquiring new postgres connection 'list_bain_analytics'
[0m18:24:48.048921 [debug] [ThreadPool]: Using postgres connection "list_bain_analytics"
[0m18:24:48.049460 [debug] [ThreadPool]: On list_bain_analytics: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "connection_name": "list_bain_analytics"} */

    select distinct nspname from pg_namespace
  
[0m18:24:48.049738 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m18:24:48.095146 [debug] [ThreadPool]: SQL status: SELECT 5 in 0.045 seconds
[0m18:24:48.096737 [debug] [ThreadPool]: On list_bain_analytics: Close
[0m18:24:48.100586 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_bain_analytics, now list_bain_analytics_public_raw)
[0m18:24:48.106913 [debug] [ThreadPool]: Using postgres connection "list_bain_analytics_public_raw"
[0m18:24:48.107376 [debug] [ThreadPool]: Acquiring new postgres connection 'list_bain_analytics_public'
[0m18:24:48.107661 [debug] [ThreadPool]: On list_bain_analytics_public_raw: BEGIN
[0m18:24:48.109723 [debug] [ThreadPool]: Using postgres connection "list_bain_analytics_public"
[0m18:24:48.110054 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m18:24:48.110307 [debug] [ThreadPool]: On list_bain_analytics_public: BEGIN
[0m18:24:48.110680 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m18:24:48.125480 [debug] [ThreadPool]: SQL status: BEGIN in 0.015 seconds
[0m18:24:48.125853 [debug] [ThreadPool]: SQL status: BEGIN in 0.016 seconds
[0m18:24:48.126117 [debug] [ThreadPool]: Using postgres connection "list_bain_analytics_public"
[0m18:24:48.126374 [debug] [ThreadPool]: Using postgres connection "list_bain_analytics_public_raw"
[0m18:24:48.126652 [debug] [ThreadPool]: On list_bain_analytics_public: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "connection_name": "list_bain_analytics_public"} */
select
      'bain_analytics' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'bain_analytics' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'bain_analytics' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m18:24:48.126951 [debug] [ThreadPool]: On list_bain_analytics_public_raw: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "connection_name": "list_bain_analytics_public_raw"} */
select
      'bain_analytics' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_raw'
    union all
    select
      'bain_analytics' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_raw'
    union all
    select
      'bain_analytics' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_raw'
  
[0m18:24:48.132269 [debug] [ThreadPool]: SQL status: SELECT 10 in 0.005 seconds
[0m18:24:48.132585 [debug] [ThreadPool]: SQL status: SELECT 0 in 0.005 seconds
[0m18:24:48.133885 [debug] [ThreadPool]: On list_bain_analytics_public_raw: ROLLBACK
[0m18:24:48.134751 [debug] [ThreadPool]: On list_bain_analytics_public: ROLLBACK
[0m18:24:48.135460 [debug] [ThreadPool]: On list_bain_analytics_public: Close
[0m18:24:48.135717 [debug] [ThreadPool]: On list_bain_analytics_public_raw: Close
[0m18:24:48.144635 [debug] [MainThread]: Using postgres connection "master"
[0m18:24:48.144968 [debug] [MainThread]: On master: BEGIN
[0m18:24:48.145230 [debug] [MainThread]: Opening a new connection, currently in state init
[0m18:24:48.156931 [debug] [MainThread]: SQL status: BEGIN in 0.012 seconds
[0m18:24:48.157294 [debug] [MainThread]: Using postgres connection "master"
[0m18:24:48.157629 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "connection_name": "master"} */
select distinct
        dependent_namespace.nspname as dependent_schema,
        dependent_class.relname as dependent_name,
        referenced_namespace.nspname as referenced_schema,
        referenced_class.relname as referenced_name

    -- Query for views: views are entries in pg_class with an entry in pg_rewrite, but we avoid
    -- a seq scan on pg_rewrite by leveraging the fact there is an "internal" row in pg_depend for
    -- the view...
    from pg_class as dependent_class
    join pg_namespace as dependent_namespace on dependent_namespace.oid = dependent_class.relnamespace
    join pg_depend as dependent_depend on dependent_depend.refobjid = dependent_class.oid
        and dependent_depend.classid = 'pg_rewrite'::regclass
        and dependent_depend.refclassid = 'pg_class'::regclass
        and dependent_depend.deptype = 'i'

    -- ... and via pg_depend (that has a row per column, hence the need for "distinct" above, and
    -- making sure to exclude the internal row to avoid a view appearing to depend on itself)...
    join pg_depend as joining_depend on joining_depend.objid = dependent_depend.objid
        and joining_depend.classid = 'pg_rewrite'::regclass
        and joining_depend.refclassid = 'pg_class'::regclass
        and joining_depend.refobjid != dependent_depend.refobjid

    -- ... we can find the tables they query from in pg_class, but excluding system tables. Note we
    -- don't need need to exclude _dependent_ system tables, because they only query from other
    -- system tables, and so are automatically excluded by excluding _referenced_ system tables
    join pg_class as referenced_class on referenced_class.oid = joining_depend.refobjid
    join pg_namespace as referenced_namespace on referenced_namespace.oid = referenced_class.relnamespace
        and referenced_namespace.nspname != 'information_schema'
        and referenced_namespace.nspname not like 'pg\_%'

    order by
        dependent_schema, dependent_name, referenced_schema, referenced_name;
[0m18:24:48.163900 [debug] [MainThread]: SQL status: SELECT 0 in 0.006 seconds
[0m18:24:48.164974 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a133ca29-1656-4fd8-ac3b-1ffaa0897334', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ec0fd90>]}
[0m18:24:48.165444 [debug] [MainThread]: On master: ROLLBACK
[0m18:24:48.166062 [debug] [MainThread]: Using postgres connection "master"
[0m18:24:48.166320 [debug] [MainThread]: On master: BEGIN
[0m18:24:48.167088 [debug] [MainThread]: SQL status: BEGIN in 0.001 seconds
[0m18:24:48.167354 [debug] [MainThread]: On master: COMMIT
[0m18:24:48.167604 [debug] [MainThread]: Using postgres connection "master"
[0m18:24:48.167840 [debug] [MainThread]: On master: COMMIT
[0m18:24:48.168353 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m18:24:48.168618 [debug] [MainThread]: On master: Close
[0m18:24:48.171945 [debug] [Thread-1  ]: Began running node model.bain_capital_analytics.stg_benchmarks
[0m18:24:48.172324 [debug] [Thread-2  ]: Began running node model.bain_capital_analytics.stg_cashflows
[0m18:24:48.173098 [debug] [Thread-3  ]: Began running node model.bain_capital_analytics.stg_counterparties
[0m18:24:48.173461 [debug] [Thread-4  ]: Began running node model.bain_capital_analytics.stg_dates
[0m18:24:48.172829 [info ] [Thread-1  ]: 1 of 28 START sql view model public.stg_benchmarks ............................. [RUN]
[0m18:24:48.173961 [info ] [Thread-2  ]: 2 of 28 START sql view model public.stg_cashflows .............................. [RUN]
[0m18:24:48.174517 [info ] [Thread-3  ]: 3 of 28 START sql view model public.stg_counterparties ......................... [RUN]
[0m18:24:48.174925 [info ] [Thread-4  ]: 4 of 28 START sql view model public.stg_dates .................................. [RUN]
[0m18:24:48.175347 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_bain_analytics_public_raw, now model.bain_capital_analytics.stg_benchmarks)
[0m18:24:48.175690 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly list_bain_analytics_public, now model.bain_capital_analytics.stg_cashflows)
[0m18:24:48.176103 [debug] [Thread-3  ]: Acquiring new postgres connection 'model.bain_capital_analytics.stg_counterparties'
[0m18:24:48.176479 [debug] [Thread-4  ]: Acquiring new postgres connection 'model.bain_capital_analytics.stg_dates'
[0m18:24:48.176792 [debug] [Thread-1  ]: Began compiling node model.bain_capital_analytics.stg_benchmarks
[0m18:24:48.177099 [debug] [Thread-2  ]: Began compiling node model.bain_capital_analytics.stg_cashflows
[0m18:24:48.177401 [debug] [Thread-3  ]: Began compiling node model.bain_capital_analytics.stg_counterparties
[0m18:24:48.177692 [debug] [Thread-4  ]: Began compiling node model.bain_capital_analytics.stg_dates
[0m18:24:48.187098 [debug] [Thread-2  ]: Writing injected SQL for node "model.bain_capital_analytics.stg_cashflows"
[0m18:24:48.188609 [debug] [Thread-1  ]: Writing injected SQL for node "model.bain_capital_analytics.stg_benchmarks"
[0m18:24:48.191126 [debug] [Thread-3  ]: Writing injected SQL for node "model.bain_capital_analytics.stg_counterparties"
[0m18:24:48.193530 [debug] [Thread-4  ]: Writing injected SQL for node "model.bain_capital_analytics.stg_dates"
[0m18:24:48.194442 [debug] [Thread-1  ]: Began executing node model.bain_capital_analytics.stg_benchmarks
[0m18:24:48.194767 [debug] [Thread-2  ]: Began executing node model.bain_capital_analytics.stg_cashflows
[0m18:24:48.195057 [debug] [Thread-3  ]: Began executing node model.bain_capital_analytics.stg_counterparties
[0m18:24:48.201658 [debug] [Thread-4  ]: Began executing node model.bain_capital_analytics.stg_dates
[0m18:24:48.237931 [debug] [Thread-2  ]: Writing runtime sql for node "model.bain_capital_analytics.stg_cashflows"
[0m18:24:48.241144 [debug] [Thread-3  ]: Writing runtime sql for node "model.bain_capital_analytics.stg_counterparties"
[0m18:24:48.241679 [debug] [Thread-1  ]: Writing runtime sql for node "model.bain_capital_analytics.stg_benchmarks"
[0m18:24:48.244734 [debug] [Thread-4  ]: Writing runtime sql for node "model.bain_capital_analytics.stg_dates"
[0m18:24:48.245876 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.stg_cashflows"
[0m18:24:48.246210 [debug] [Thread-2  ]: On model.bain_capital_analytics.stg_cashflows: BEGIN
[0m18:24:48.246565 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.stg_counterparties"
[0m18:24:48.246852 [debug] [Thread-2  ]: Opening a new connection, currently in state closed
[0m18:24:48.247152 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.stg_dates"
[0m18:24:48.247460 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.stg_benchmarks"
[0m18:24:48.247755 [debug] [Thread-3  ]: On model.bain_capital_analytics.stg_counterparties: BEGIN
[0m18:24:48.248180 [debug] [Thread-4  ]: On model.bain_capital_analytics.stg_dates: BEGIN
[0m18:24:48.248512 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_benchmarks: BEGIN
[0m18:24:48.248825 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m18:24:48.249150 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m18:24:48.249472 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m18:24:48.261014 [debug] [Thread-2  ]: SQL status: BEGIN in 0.014 seconds
[0m18:24:48.261332 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.stg_cashflows"
[0m18:24:48.261663 [debug] [Thread-2  ]: On model.bain_capital_analytics.stg_cashflows: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_cashflows"} */

  create view "bain_analytics"."public"."stg_cashflows__dbt_tmp"
    
    
  as (
    -- Anti-pattern: unnecessary DISTINCT
-- Anti-pattern: duplicated fiscal quarter logic
select distinct
    cashflow_id,
    fund_id,
    portfolio_id,
    cast(cashflow_date as date) as cashflow_date,
    cashflow_type,
    cast(amount as numeric(18,2)) as amount,
    currency,
    description,
    investor_id,
    -- Anti-pattern: duplicated fiscal quarter logic (same as stg_trades, stg_portfolios)
    case
        when extract(month from cast(cashflow_date as date)) between 1 and 3 then 'Q3'
        when extract(month from cast(cashflow_date as date)) between 4 and 6 then 'Q4'
        when extract(month from cast(cashflow_date as date)) between 7 and 9 then 'Q1'
        when extract(month from cast(cashflow_date as date)) between 10 and 12 then 'Q2'
    end as cashflow_fiscal_quarter,
    -- Anti-pattern: PostgreSQL-specific extract
    extract(year from cast(cashflow_date as date)) as cashflow_year
from "bain_analytics"."public_raw"."raw_cashflows"
  );
[0m18:24:48.262635 [debug] [Thread-3  ]: SQL status: BEGIN in 0.014 seconds
[0m18:24:48.262942 [debug] [Thread-4  ]: SQL status: BEGIN in 0.014 seconds
[0m18:24:48.263266 [debug] [Thread-1  ]: SQL status: BEGIN in 0.014 seconds
[0m18:24:48.263560 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.stg_counterparties"
[0m18:24:48.263867 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.stg_dates"
[0m18:24:48.264178 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.stg_benchmarks"
[0m18:24:48.264500 [debug] [Thread-3  ]: On model.bain_capital_analytics.stg_counterparties: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_counterparties"} */

  create view "bain_analytics"."public"."stg_counterparties__dbt_tmp"
    
    
  as (
    select distinct
    counterparty_id,
    counterparty_name,
    counterparty_type,
    country,
    credit_rating,
    cast(is_active as boolean) as is_active
from "bain_analytics"."public_raw"."raw_counterparties"
where cast(is_active as boolean) = true
  );
[0m18:24:48.264850 [debug] [Thread-4  ]: On model.bain_capital_analytics.stg_dates: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_dates"} */

  create view "bain_analytics"."public"."stg_dates__dbt_tmp"
    
    
  as (
    select
    cast(date_day as date) as date_day,
    cast(is_business_day as boolean) as is_business_day,
    cast(is_month_end as boolean) as is_month_end,
    cast(is_quarter_end as boolean) as is_quarter_end,
    cast(is_year_end as boolean) as is_year_end,
    fiscal_quarter,
    fiscal_year,
    -- Anti-pattern: PostgreSQL-specific date_trunc
    date_trunc('month', cast(date_day as date)) as month_start,
    date_trunc('quarter', cast(date_day as date)) as quarter_start,
    extract(month from cast(date_day as date)) as calendar_month,
    extract(year from cast(date_day as date)) as calendar_year
from "bain_analytics"."public_raw"."raw_dates"
  );
[0m18:24:48.265209 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_benchmarks: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_benchmarks"} */

  create view "bain_analytics"."public"."stg_benchmarks__dbt_tmp"
    
    
  as (
    select distinct
    benchmark_id,
    benchmark_name,
    cast(benchmark_date as date) as benchmark_date,
    cast(return_daily as numeric(18,8)) as return_daily,
    cast(return_mtd as numeric(18,8)) as return_mtd,
    cast(return_ytd as numeric(18,8)) as return_ytd,
    cast(benchmark_level as numeric(18,4)) as benchmark_level,
    -- Anti-pattern: duplicated fiscal quarter logic
    case
        when extract(month from cast(benchmark_date as date)) between 1 and 3 then 'Q3'
        when extract(month from cast(benchmark_date as date)) between 4 and 6 then 'Q4'
        when extract(month from cast(benchmark_date as date)) between 7 and 9 then 'Q1'
        when extract(month from cast(benchmark_date as date)) between 10 and 12 then 'Q2'
    end as benchmark_fiscal_quarter
from "bain_analytics"."public_raw"."raw_benchmarks"
  );
[0m18:24:48.267098 [debug] [Thread-2  ]: SQL status: CREATE VIEW in 0.005 seconds
[0m18:24:48.273580 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.stg_cashflows"
[0m18:24:48.273922 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.008 seconds
[0m18:24:48.274203 [debug] [Thread-3  ]: SQL status: CREATE VIEW in 0.009 seconds
[0m18:24:48.274471 [debug] [Thread-4  ]: SQL status: CREATE VIEW in 0.009 seconds
[0m18:24:48.274758 [debug] [Thread-2  ]: On model.bain_capital_analytics.stg_cashflows: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_cashflows"} */
alter table "bain_analytics"."public"."stg_cashflows__dbt_tmp" rename to "stg_cashflows"
[0m18:24:48.277450 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.stg_benchmarks"
[0m18:24:48.280199 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.stg_counterparties"
[0m18:24:48.282861 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.stg_dates"
[0m18:24:48.283230 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_benchmarks: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_benchmarks"} */
alter table "bain_analytics"."public"."stg_benchmarks__dbt_tmp" rename to "stg_benchmarks"
[0m18:24:48.283603 [debug] [Thread-3  ]: On model.bain_capital_analytics.stg_counterparties: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_counterparties"} */
alter table "bain_analytics"."public"."stg_counterparties__dbt_tmp" rename to "stg_counterparties"
[0m18:24:48.283906 [debug] [Thread-4  ]: On model.bain_capital_analytics.stg_dates: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_dates"} */
alter table "bain_analytics"."public"."stg_dates__dbt_tmp" rename to "stg_dates"
[0m18:24:48.284403 [debug] [Thread-2  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:24:48.290197 [debug] [Thread-4  ]: SQL status: ALTER TABLE in 0.006 seconds
[0m18:24:48.296808 [debug] [Thread-3  ]: SQL status: ALTER TABLE in 0.013 seconds
[0m18:24:48.297143 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.013 seconds
[0m18:24:48.300361 [debug] [Thread-4  ]: On model.bain_capital_analytics.stg_dates: COMMIT
[0m18:24:48.303425 [debug] [Thread-2  ]: On model.bain_capital_analytics.stg_cashflows: COMMIT
[0m18:24:48.304406 [debug] [Thread-3  ]: On model.bain_capital_analytics.stg_counterparties: COMMIT
[0m18:24:48.305354 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_benchmarks: COMMIT
[0m18:24:48.305666 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.stg_dates"
[0m18:24:48.305962 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.stg_cashflows"
[0m18:24:48.306253 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.stg_counterparties"
[0m18:24:48.306543 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.stg_benchmarks"
[0m18:24:48.306832 [debug] [Thread-4  ]: On model.bain_capital_analytics.stg_dates: COMMIT
[0m18:24:48.307111 [debug] [Thread-2  ]: On model.bain_capital_analytics.stg_cashflows: COMMIT
[0m18:24:48.307406 [debug] [Thread-3  ]: On model.bain_capital_analytics.stg_counterparties: COMMIT
[0m18:24:48.307683 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_benchmarks: COMMIT
[0m18:24:48.310471 [debug] [Thread-3  ]: SQL status: COMMIT in 0.002 seconds
[0m18:24:48.310778 [debug] [Thread-4  ]: SQL status: COMMIT in 0.003 seconds
[0m18:24:48.311064 [debug] [Thread-1  ]: SQL status: COMMIT in 0.003 seconds
[0m18:24:48.316454 [debug] [Thread-3  ]: Applying DROP to: "bain_analytics"."public"."stg_counterparties__dbt_backup"
[0m18:24:48.316765 [debug] [Thread-2  ]: SQL status: COMMIT in 0.009 seconds
[0m18:24:48.319681 [debug] [Thread-4  ]: Applying DROP to: "bain_analytics"."public"."stg_dates__dbt_backup"
[0m18:24:48.321829 [debug] [Thread-1  ]: Applying DROP to: "bain_analytics"."public"."stg_benchmarks__dbt_backup"
[0m18:24:48.325256 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.stg_counterparties"
[0m18:24:48.327366 [debug] [Thread-2  ]: Applying DROP to: "bain_analytics"."public"."stg_cashflows__dbt_backup"
[0m18:24:48.327824 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.stg_dates"
[0m18:24:48.328273 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.stg_benchmarks"
[0m18:24:48.328583 [debug] [Thread-3  ]: On model.bain_capital_analytics.stg_counterparties: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_counterparties"} */
drop view if exists "bain_analytics"."public"."stg_counterparties__dbt_backup" cascade
[0m18:24:48.329068 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.stg_cashflows"
[0m18:24:48.329374 [debug] [Thread-4  ]: On model.bain_capital_analytics.stg_dates: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_dates"} */
drop view if exists "bain_analytics"."public"."stg_dates__dbt_backup" cascade
[0m18:24:48.329679 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_benchmarks: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_benchmarks"} */
drop view if exists "bain_analytics"."public"."stg_benchmarks__dbt_backup" cascade
[0m18:24:48.330024 [debug] [Thread-2  ]: On model.bain_capital_analytics.stg_cashflows: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_cashflows"} */
drop view if exists "bain_analytics"."public"."stg_cashflows__dbt_backup" cascade
[0m18:24:48.331117 [debug] [Thread-3  ]: SQL status: DROP VIEW in 0.001 seconds
[0m18:24:48.331425 [debug] [Thread-2  ]: SQL status: DROP VIEW in 0.001 seconds
[0m18:24:48.331706 [debug] [Thread-4  ]: SQL status: DROP VIEW in 0.001 seconds
[0m18:24:48.331974 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.002 seconds
[0m18:24:48.334046 [debug] [Thread-3  ]: On model.bain_capital_analytics.stg_counterparties: Close
[0m18:24:48.335044 [debug] [Thread-2  ]: On model.bain_capital_analytics.stg_cashflows: Close
[0m18:24:48.335977 [debug] [Thread-4  ]: On model.bain_capital_analytics.stg_dates: Close
[0m18:24:48.336912 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_benchmarks: Close
[0m18:24:48.339890 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a133ca29-1656-4fd8-ac3b-1ffaa0897334', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ec233a0>]}
[0m18:24:48.340245 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a133ca29-1656-4fd8-ac3b-1ffaa0897334', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10f1a1be0>]}
[0m18:24:48.340616 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a133ca29-1656-4fd8-ac3b-1ffaa0897334', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c42e940>]}
[0m18:24:48.341089 [info ] [Thread-2  ]: 2 of 28 OK created sql view model public.stg_cashflows ......................... [[32mCREATE VIEW[0m in 0.16s]
[0m18:24:48.341392 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a133ca29-1656-4fd8-ac3b-1ffaa0897334', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10f0c01f0>]}
[0m18:24:48.341874 [info ] [Thread-4  ]: 4 of 28 OK created sql view model public.stg_dates ............................. [[32mCREATE VIEW[0m in 0.16s]
[0m18:24:48.342361 [info ] [Thread-3  ]: 3 of 28 OK created sql view model public.stg_counterparties .................... [[32mCREATE VIEW[0m in 0.16s]
[0m18:24:48.342838 [debug] [Thread-2  ]: Finished running node model.bain_capital_analytics.stg_cashflows
[0m18:24:48.343304 [info ] [Thread-1  ]: 1 of 28 OK created sql view model public.stg_benchmarks ........................ [[32mCREATE VIEW[0m in 0.16s]
[0m18:24:48.343780 [debug] [Thread-4  ]: Finished running node model.bain_capital_analytics.stg_dates
[0m18:24:48.344207 [debug] [Thread-3  ]: Finished running node model.bain_capital_analytics.stg_counterparties
[0m18:24:48.344543 [debug] [Thread-2  ]: Began running node model.bain_capital_analytics.stg_fund_structures
[0m18:24:48.345045 [debug] [Thread-1  ]: Finished running node model.bain_capital_analytics.stg_benchmarks
[0m18:24:48.345435 [debug] [Thread-4  ]: Began running node model.bain_capital_analytics.stg_instruments
[0m18:24:48.345818 [debug] [Thread-3  ]: Began running node model.bain_capital_analytics.stg_portfolios
[0m18:24:48.346251 [info ] [Thread-2  ]: 5 of 28 START sql view model public.stg_fund_structures ........................ [RUN]
[0m18:24:48.346617 [debug] [Thread-1  ]: Began running node model.bain_capital_analytics.stg_positions
[0m18:24:48.347046 [info ] [Thread-4  ]: 6 of 28 START sql view model public.stg_instruments ............................ [RUN]
[0m18:24:48.347522 [info ] [Thread-3  ]: 7 of 28 START sql view model public.stg_portfolios ............................. [RUN]
[0m18:24:48.347932 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly model.bain_capital_analytics.stg_cashflows, now model.bain_capital_analytics.stg_fund_structures)
[0m18:24:48.348348 [info ] [Thread-1  ]: 8 of 28 START sql view model public.stg_positions .............................. [RUN]
[0m18:24:48.348702 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly model.bain_capital_analytics.stg_dates, now model.bain_capital_analytics.stg_instruments)
[0m18:24:48.349029 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly model.bain_capital_analytics.stg_counterparties, now model.bain_capital_analytics.stg_portfolios)
[0m18:24:48.349342 [debug] [Thread-2  ]: Began compiling node model.bain_capital_analytics.stg_fund_structures
[0m18:24:48.349656 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.bain_capital_analytics.stg_benchmarks, now model.bain_capital_analytics.stg_positions)
[0m18:24:48.349968 [debug] [Thread-4  ]: Began compiling node model.bain_capital_analytics.stg_instruments
[0m18:24:48.350252 [debug] [Thread-3  ]: Began compiling node model.bain_capital_analytics.stg_portfolios
[0m18:24:48.353077 [debug] [Thread-2  ]: Writing injected SQL for node "model.bain_capital_analytics.stg_fund_structures"
[0m18:24:48.353386 [debug] [Thread-1  ]: Began compiling node model.bain_capital_analytics.stg_positions
[0m18:24:48.355899 [debug] [Thread-4  ]: Writing injected SQL for node "model.bain_capital_analytics.stg_instruments"
[0m18:24:48.358383 [debug] [Thread-3  ]: Writing injected SQL for node "model.bain_capital_analytics.stg_portfolios"
[0m18:24:48.362031 [debug] [Thread-1  ]: Writing injected SQL for node "model.bain_capital_analytics.stg_positions"
[0m18:24:48.362835 [debug] [Thread-4  ]: Began executing node model.bain_capital_analytics.stg_instruments
[0m18:24:48.404854 [debug] [Thread-3  ]: Began executing node model.bain_capital_analytics.stg_portfolios
[0m18:24:48.408306 [debug] [Thread-4  ]: Writing runtime sql for node "model.bain_capital_analytics.stg_instruments"
[0m18:24:48.408659 [debug] [Thread-2  ]: Began executing node model.bain_capital_analytics.stg_fund_structures
[0m18:24:48.408942 [debug] [Thread-1  ]: Began executing node model.bain_capital_analytics.stg_positions
[0m18:24:48.412058 [debug] [Thread-3  ]: Writing runtime sql for node "model.bain_capital_analytics.stg_portfolios"
[0m18:24:48.415286 [debug] [Thread-2  ]: Writing runtime sql for node "model.bain_capital_analytics.stg_fund_structures"
[0m18:24:48.418306 [debug] [Thread-1  ]: Writing runtime sql for node "model.bain_capital_analytics.stg_positions"
[0m18:24:48.418965 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.stg_instruments"
[0m18:24:48.419317 [debug] [Thread-4  ]: On model.bain_capital_analytics.stg_instruments: BEGIN
[0m18:24:48.419692 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.stg_portfolios"
[0m18:24:48.420019 [debug] [Thread-4  ]: Opening a new connection, currently in state closed
[0m18:24:48.420348 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.stg_fund_structures"
[0m18:24:48.420652 [debug] [Thread-3  ]: On model.bain_capital_analytics.stg_portfolios: BEGIN
[0m18:24:48.420993 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.stg_positions"
[0m18:24:48.421405 [debug] [Thread-2  ]: On model.bain_capital_analytics.stg_fund_structures: BEGIN
[0m18:24:48.421711 [debug] [Thread-3  ]: Opening a new connection, currently in state closed
[0m18:24:48.422028 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_positions: BEGIN
[0m18:24:48.422331 [debug] [Thread-2  ]: Opening a new connection, currently in state closed
[0m18:24:48.422712 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m18:24:48.435581 [debug] [Thread-3  ]: SQL status: BEGIN in 0.014 seconds
[0m18:24:48.435912 [debug] [Thread-2  ]: SQL status: BEGIN in 0.014 seconds
[0m18:24:48.436219 [debug] [Thread-1  ]: SQL status: BEGIN in 0.013 seconds
[0m18:24:48.436516 [debug] [Thread-4  ]: SQL status: BEGIN in 0.017 seconds
[0m18:24:48.436803 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.stg_portfolios"
[0m18:24:48.437102 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.stg_fund_structures"
[0m18:24:48.437388 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.stg_positions"
[0m18:24:48.437684 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.stg_instruments"
[0m18:24:48.438029 [debug] [Thread-3  ]: On model.bain_capital_analytics.stg_portfolios: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_portfolios"} */

  create view "bain_analytics"."public"."stg_portfolios__dbt_tmp"
    
    
  as (
    -- Anti-pattern: unnecessary DISTINCT when source data is already unique
-- Anti-pattern: casting in every model instead of once upstream

select distinct
    cast(portfolio_id as varchar(10)) as portfolio_id,
    cast(portfolio_name as varchar(100)) as portfolio_name,
    cast(strategy as varchar(50)) as strategy,
    cast(inception_date as date) as inception_date,
    cast(fund_id as varchar(10)) as fund_id,
    cast(manager_name as varchar(100)) as manager_name,
    cast(is_active as boolean) as is_active,
    -- Anti-pattern: duplicated fiscal quarter logic (repeated in many models)
    case
        when extract(month from cast(inception_date as date)) between 1 and 3 then 'Q3'
        when extract(month from cast(inception_date as date)) between 4 and 6 then 'Q4'
        when extract(month from cast(inception_date as date)) between 7 and 9 then 'Q1'
        when extract(month from cast(inception_date as date)) between 10 and 12 then 'Q2'
    end as inception_fiscal_quarter
from "bain_analytics"."public_raw"."raw_portfolios"
where cast(is_active as boolean) = true
  );
[0m18:24:48.438394 [debug] [Thread-2  ]: On model.bain_capital_analytics.stg_fund_structures: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_fund_structures"} */

  create view "bain_analytics"."public"."stg_fund_structures__dbt_tmp"
    
    
  as (
    select distinct
    fund_id,
    fund_name,
    fund_type,
    cast(vintage_year as integer) as vintage_year,
    cast(committed_capital as numeric(18,2)) as committed_capital,
    cast(management_fee_rate as numeric(8,4)) as management_fee_rate,
    cast(carry_rate as numeric(8,4)) as carry_rate,
    cast(hurdle_rate as numeric(8,4)) as hurdle_rate,
    cast(gp_commitment_pct as numeric(8,4)) as gp_commitment_pct,
    fund_currency,
    fund_status
from "bain_analytics"."public_raw"."raw_fund_structures"
  );
[0m18:24:48.438775 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_positions: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_positions"} */

  create view "bain_analytics"."public"."stg_positions__dbt_tmp"
    
    
  as (
    -- Anti-pattern: unnecessary DISTINCT
-- Anti-pattern: no filtering or partitioning strategy

select distinct
    position_id,
    portfolio_id,
    instrument_id,
    cast(position_date as date) as position_date,
    cast(quantity as numeric(18,4)) as quantity,
    cast(market_value as numeric(18,2)) as market_value,
    cast(cost_basis as numeric(18,2)) as cost_basis,
    currency,
    -- Anti-pattern: computed column that could be done downstream
    cast(market_value as numeric(18,2)) - cast(cost_basis as numeric(18,2)) as unrealized_gain_loss,
    case
        when cast(cost_basis as numeric(18,2)) != 0
        then (cast(market_value as numeric(18,2)) - cast(cost_basis as numeric(18,2))) / abs(cast(cost_basis as numeric(18,2)))
        else 0
    end as unrealized_return_pct
from "bain_analytics"."public_raw"."raw_positions"
  );
[0m18:24:48.439131 [debug] [Thread-4  ]: On model.bain_capital_analytics.stg_instruments: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_instruments"} */

  create view "bain_analytics"."public"."stg_instruments__dbt_tmp"
    
    
  as (
    -- Anti-pattern: unnecessary DISTINCT
select distinct
    instrument_id,
    instrument_name,
    instrument_type,
    sector,
    currency,
    exchange,
    issuer,
    cast(maturity_date as date) as maturity_date,
    -- Anti-pattern: PostgreSQL-specific date subtraction
    case
        when maturity_date is not null
        then cast(maturity_date as date) - current_date
        else null
    end as days_to_maturity,
    case
        when instrument_type in ('equity', 'futures') then 'liquid'
        when instrument_type in ('corporate_bond', 'government_bond', 'sovereign_bond', 'leveraged_loan') then 'semi_liquid'
        when instrument_type in ('private_equity', 'venture_capital', 'real_estate', 'real_estate_debt', 'infrastructure') then 'illiquid'
        else 'other'
    end as liquidity_class
from "bain_analytics"."public_raw"."raw_instruments"
  );
[0m18:24:48.444092 [debug] [Thread-2  ]: SQL status: CREATE VIEW in 0.005 seconds
[0m18:24:48.447613 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.stg_fund_structures"
[0m18:24:48.447954 [debug] [Thread-3  ]: SQL status: CREATE VIEW in 0.008 seconds
[0m18:24:48.448265 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.009 seconds
[0m18:24:48.448544 [debug] [Thread-4  ]: SQL status: CREATE VIEW in 0.009 seconds
[0m18:24:48.448838 [debug] [Thread-2  ]: On model.bain_capital_analytics.stg_fund_structures: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_fund_structures"} */
alter table "bain_analytics"."public"."stg_fund_structures__dbt_tmp" rename to "stg_fund_structures"
[0m18:24:48.451553 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.stg_portfolios"
[0m18:24:48.454121 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.stg_positions"
[0m18:24:48.456690 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.stg_instruments"
[0m18:24:48.457048 [debug] [Thread-3  ]: On model.bain_capital_analytics.stg_portfolios: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_portfolios"} */
alter table "bain_analytics"."public"."stg_portfolios__dbt_tmp" rename to "stg_portfolios"
[0m18:24:48.457356 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_positions: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_positions"} */
alter table "bain_analytics"."public"."stg_positions__dbt_tmp" rename to "stg_positions"
[0m18:24:48.457661 [debug] [Thread-4  ]: On model.bain_capital_analytics.stg_instruments: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_instruments"} */
alter table "bain_analytics"."public"."stg_instruments__dbt_tmp" rename to "stg_instruments"
[0m18:24:48.458156 [debug] [Thread-2  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:24:48.459117 [debug] [Thread-2  ]: On model.bain_capital_analytics.stg_fund_structures: COMMIT
[0m18:24:48.459448 [debug] [Thread-3  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:24:48.459730 [debug] [Thread-4  ]: SQL status: ALTER TABLE in 0.002 seconds
[0m18:24:48.459998 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.002 seconds
[0m18:24:48.460279 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.stg_fund_structures"
[0m18:24:48.461249 [debug] [Thread-3  ]: On model.bain_capital_analytics.stg_portfolios: COMMIT
[0m18:24:48.462362 [debug] [Thread-4  ]: On model.bain_capital_analytics.stg_instruments: COMMIT
[0m18:24:48.463376 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_positions: COMMIT
[0m18:24:48.463686 [debug] [Thread-2  ]: On model.bain_capital_analytics.stg_fund_structures: COMMIT
[0m18:24:48.463993 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.stg_portfolios"
[0m18:24:48.464300 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.stg_instruments"
[0m18:24:48.464605 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.stg_positions"
[0m18:24:48.464938 [debug] [Thread-3  ]: On model.bain_capital_analytics.stg_portfolios: COMMIT
[0m18:24:48.465234 [debug] [Thread-4  ]: On model.bain_capital_analytics.stg_instruments: COMMIT
[0m18:24:48.465523 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_positions: COMMIT
[0m18:24:48.466616 [debug] [Thread-2  ]: SQL status: COMMIT in 0.002 seconds
[0m18:24:48.468865 [debug] [Thread-2  ]: Applying DROP to: "bain_analytics"."public"."stg_fund_structures__dbt_backup"
[0m18:24:48.469197 [debug] [Thread-3  ]: SQL status: COMMIT in 0.003 seconds
[0m18:24:48.469473 [debug] [Thread-4  ]: SQL status: COMMIT in 0.004 seconds
[0m18:24:48.469912 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.stg_fund_structures"
[0m18:24:48.470195 [debug] [Thread-1  ]: SQL status: COMMIT in 0.004 seconds
[0m18:24:48.473208 [debug] [Thread-3  ]: Applying DROP to: "bain_analytics"."public"."stg_portfolios__dbt_backup"
[0m18:24:48.475292 [debug] [Thread-4  ]: Applying DROP to: "bain_analytics"."public"."stg_instruments__dbt_backup"
[0m18:24:48.475612 [debug] [Thread-2  ]: On model.bain_capital_analytics.stg_fund_structures: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_fund_structures"} */
drop view if exists "bain_analytics"."public"."stg_fund_structures__dbt_backup" cascade
[0m18:24:48.477667 [debug] [Thread-1  ]: Applying DROP to: "bain_analytics"."public"."stg_positions__dbt_backup"
[0m18:24:48.478181 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.stg_portfolios"
[0m18:24:48.478636 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.stg_instruments"
[0m18:24:48.479171 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.stg_positions"
[0m18:24:48.479494 [debug] [Thread-2  ]: SQL status: DROP VIEW in 0.001 seconds
[0m18:24:48.479795 [debug] [Thread-3  ]: On model.bain_capital_analytics.stg_portfolios: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_portfolios"} */
drop view if exists "bain_analytics"."public"."stg_portfolios__dbt_backup" cascade
[0m18:24:48.480137 [debug] [Thread-4  ]: On model.bain_capital_analytics.stg_instruments: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_instruments"} */
drop view if exists "bain_analytics"."public"."stg_instruments__dbt_backup" cascade
[0m18:24:48.480448 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_positions: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_positions"} */
drop view if exists "bain_analytics"."public"."stg_positions__dbt_backup" cascade
[0m18:24:48.481466 [debug] [Thread-2  ]: On model.bain_capital_analytics.stg_fund_structures: Close
[0m18:24:48.482108 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a133ca29-1656-4fd8-ac3b-1ffaa0897334', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ec0f310>]}
[0m18:24:48.482680 [info ] [Thread-2  ]: 5 of 28 OK created sql view model public.stg_fund_structures ................... [[32mCREATE VIEW[0m in 0.13s]
[0m18:24:48.483043 [debug] [Thread-3  ]: SQL status: DROP VIEW in 0.001 seconds
[0m18:24:48.483329 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.001 seconds
[0m18:24:48.483602 [debug] [Thread-4  ]: SQL status: DROP VIEW in 0.002 seconds
[0m18:24:48.484014 [debug] [Thread-2  ]: Finished running node model.bain_capital_analytics.stg_fund_structures
[0m18:24:48.485003 [debug] [Thread-3  ]: On model.bain_capital_analytics.stg_portfolios: Close
[0m18:24:48.485958 [debug] [Thread-1  ]: On model.bain_capital_analytics.stg_positions: Close
[0m18:24:48.486904 [debug] [Thread-4  ]: On model.bain_capital_analytics.stg_instruments: Close
[0m18:24:48.487249 [debug] [Thread-2  ]: Began running node model.bain_capital_analytics.stg_trades
[0m18:24:48.487799 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a133ca29-1656-4fd8-ac3b-1ffaa0897334', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c42e940>]}
[0m18:24:48.488269 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a133ca29-1656-4fd8-ac3b-1ffaa0897334', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10f0e4cd0>]}
[0m18:24:48.488698 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a133ca29-1656-4fd8-ac3b-1ffaa0897334', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10f1a1be0>]}
[0m18:24:48.489099 [info ] [Thread-2  ]: 9 of 28 START sql view model public.stg_trades ................................. [RUN]
[0m18:24:48.489719 [info ] [Thread-3  ]: 7 of 28 OK created sql view model public.stg_portfolios ........................ [[32mCREATE VIEW[0m in 0.14s]
[0m18:24:48.490188 [info ] [Thread-1  ]: 8 of 28 OK created sql view model public.stg_positions ......................... [[32mCREATE VIEW[0m in 0.14s]
[0m18:24:48.490662 [info ] [Thread-4  ]: 6 of 28 OK created sql view model public.stg_instruments ....................... [[32mCREATE VIEW[0m in 0.14s]
[0m18:24:48.491032 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly model.bain_capital_analytics.stg_fund_structures, now model.bain_capital_analytics.stg_trades)
[0m18:24:48.491457 [debug] [Thread-3  ]: Finished running node model.bain_capital_analytics.stg_portfolios
[0m18:24:48.491863 [debug] [Thread-1  ]: Finished running node model.bain_capital_analytics.stg_positions
[0m18:24:48.492259 [debug] [Thread-4  ]: Finished running node model.bain_capital_analytics.stg_instruments
[0m18:24:48.492550 [debug] [Thread-2  ]: Began compiling node model.bain_capital_analytics.stg_trades
[0m18:24:48.492867 [debug] [Thread-3  ]: Began running node model.bain_capital_analytics.stg_valuations
[0m18:24:48.493261 [debug] [Thread-1  ]: Began running node model.bain_capital_analytics.int_benchmark_returns
[0m18:24:48.493708 [debug] [Thread-4  ]: Began running node model.bain_capital_analytics.int_cashflow_enriched
[0m18:24:48.496843 [debug] [Thread-2  ]: Writing injected SQL for node "model.bain_capital_analytics.stg_trades"
[0m18:24:48.497321 [info ] [Thread-3  ]: 10 of 28 START sql view model public.stg_valuations ............................ [RUN]
[0m18:24:48.497741 [info ] [Thread-1  ]: 11 of 28 START sql view model public.int_benchmark_returns ..................... [RUN]
[0m18:24:48.498131 [info ] [Thread-4  ]: 12 of 28 START sql view model public.int_cashflow_enriched ..................... [RUN]
[0m18:24:48.498546 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly model.bain_capital_analytics.stg_portfolios, now model.bain_capital_analytics.stg_valuations)
[0m18:24:48.498884 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.bain_capital_analytics.stg_positions, now model.bain_capital_analytics.int_benchmark_returns)
[0m18:24:48.499332 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly model.bain_capital_analytics.stg_instruments, now model.bain_capital_analytics.int_cashflow_enriched)
[0m18:24:48.499651 [debug] [Thread-3  ]: Began compiling node model.bain_capital_analytics.stg_valuations
[0m18:24:48.499971 [debug] [Thread-1  ]: Began compiling node model.bain_capital_analytics.int_benchmark_returns
[0m18:24:48.500293 [debug] [Thread-4  ]: Began compiling node model.bain_capital_analytics.int_cashflow_enriched
[0m18:24:48.502955 [debug] [Thread-3  ]: Writing injected SQL for node "model.bain_capital_analytics.stg_valuations"
[0m18:24:48.503294 [debug] [Thread-2  ]: Began executing node model.bain_capital_analytics.stg_trades
[0m18:24:48.506270 [debug] [Thread-1  ]: Writing injected SQL for node "model.bain_capital_analytics.int_benchmark_returns"
[0m18:24:48.510817 [debug] [Thread-4  ]: Writing injected SQL for node "model.bain_capital_analytics.int_cashflow_enriched"
[0m18:24:48.514251 [debug] [Thread-2  ]: Writing runtime sql for node "model.bain_capital_analytics.stg_trades"
[0m18:24:48.514861 [debug] [Thread-3  ]: Began executing node model.bain_capital_analytics.stg_valuations
[0m18:24:48.518003 [debug] [Thread-3  ]: Writing runtime sql for node "model.bain_capital_analytics.stg_valuations"
[0m18:24:48.518498 [debug] [Thread-1  ]: Began executing node model.bain_capital_analytics.int_benchmark_returns
[0m18:24:48.518821 [debug] [Thread-4  ]: Began executing node model.bain_capital_analytics.int_cashflow_enriched
[0m18:24:48.521873 [debug] [Thread-1  ]: Writing runtime sql for node "model.bain_capital_analytics.int_benchmark_returns"
[0m18:24:48.522269 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.stg_trades"
[0m18:24:48.525362 [debug] [Thread-4  ]: Writing runtime sql for node "model.bain_capital_analytics.int_cashflow_enriched"
[0m18:24:48.525701 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.stg_valuations"
[0m18:24:48.526090 [debug] [Thread-2  ]: On model.bain_capital_analytics.stg_trades: BEGIN
[0m18:24:48.526474 [debug] [Thread-3  ]: On model.bain_capital_analytics.stg_valuations: BEGIN
[0m18:24:48.526836 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.int_benchmark_returns"
[0m18:24:48.527121 [debug] [Thread-2  ]: Opening a new connection, currently in state closed
[0m18:24:48.527426 [debug] [Thread-3  ]: Opening a new connection, currently in state closed
[0m18:24:48.527764 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.int_cashflow_enriched"
[0m18:24:48.528050 [debug] [Thread-1  ]: On model.bain_capital_analytics.int_benchmark_returns: BEGIN
[0m18:24:48.528558 [debug] [Thread-4  ]: On model.bain_capital_analytics.int_cashflow_enriched: BEGIN
[0m18:24:48.528965 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m18:24:48.529292 [debug] [Thread-4  ]: Opening a new connection, currently in state closed
[0m18:24:48.545428 [debug] [Thread-1  ]: SQL status: BEGIN in 0.016 seconds
[0m18:24:48.545778 [debug] [Thread-4  ]: SQL status: BEGIN in 0.016 seconds
[0m18:24:48.546077 [debug] [Thread-2  ]: SQL status: BEGIN in 0.019 seconds
[0m18:24:48.546357 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.int_benchmark_returns"
[0m18:24:48.546640 [debug] [Thread-3  ]: SQL status: BEGIN in 0.019 seconds
[0m18:24:48.546932 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.int_cashflow_enriched"
[0m18:24:48.547222 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.stg_trades"
[0m18:24:48.547592 [debug] [Thread-1  ]: On model.bain_capital_analytics.int_benchmark_returns: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.int_benchmark_returns"} */

  create view "bain_analytics"."public"."int_benchmark_returns__dbt_tmp"
    
    
  as (
    -- Pipeline C: Benchmark returns with rolling calculations
-- Anti-pattern: heavy window functions that could be pre-computed

with benchmark_base as (
    select
        b.benchmark_id,
        b.benchmark_name,
        b.benchmark_date,
        b.return_daily,
        b.return_mtd,
        b.return_ytd,
        b.benchmark_level,
        b.benchmark_fiscal_quarter,
        d.fiscal_year,
        d.is_quarter_end,
        d.is_year_end
    from "bain_analytics"."public"."stg_benchmarks" b
    inner join "bain_analytics"."public"."stg_dates" d
        on b.benchmark_date = d.date_day
),

-- Anti-pattern: compute many overlapping windows
benchmark_with_rolling as (
    select
        bb.*,
        -- rolling 3-month return
        exp(sum(ln(1 + bb.return_mtd)) over (
            partition by bb.benchmark_id
            order by bb.benchmark_date
            rows between 2 preceding and current row
        )) - 1 as rolling_3m_return,
        -- rolling 6-month return
        exp(sum(ln(1 + bb.return_mtd)) over (
            partition by bb.benchmark_id
            order by bb.benchmark_date
            rows between 5 preceding and current row
        )) - 1 as rolling_6m_return,
        -- rolling 12-month return
        exp(sum(ln(1 + bb.return_mtd)) over (
            partition by bb.benchmark_id
            order by bb.benchmark_date
            rows between 11 preceding and current row
        )) - 1 as rolling_12m_return,
        -- Anti-pattern: volatility via window (expensive)
        stddev(bb.return_mtd) over (
            partition by bb.benchmark_id
            order by bb.benchmark_date
            rows between 11 preceding and current row
        ) as rolling_12m_volatility,
        avg(bb.return_mtd) over (
            partition by bb.benchmark_id
            order by bb.benchmark_date
            rows between 11 preceding and current row
        ) as rolling_12m_avg_return,
        lag(bb.benchmark_level) over (
            partition by bb.benchmark_id
            order by bb.benchmark_date
        ) as prev_benchmark_level
    from benchmark_base bb
)

select * from benchmark_with_rolling
  );
[0m18:24:48.547967 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.stg_valuations"
[0m18:24:48.548358 [debug] [Thread-4  ]: On model.bain_capital_analytics.int_cashflow_enriched: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.int_cashflow_enriched"} */

  create view "bain_analytics"."public"."int_cashflow_enriched__dbt_tmp"
    
    
  as (
    -- Pipeline C: Enriched cashflow data with fund and portfolio details
-- Anti-pattern: subquery for dedup instead of QUALIFY
-- Anti-pattern: joins repeated from other intermediate models

with cashflow_with_details as (
    select *
    from (
        select
            cf.*,
            p.portfolio_name,
            p.strategy,
            p.manager_name,
            fs.fund_name,
            fs.fund_type,
            fs.committed_capital,
            fs.management_fee_rate,
            fs.carry_rate,
            fs.hurdle_rate,
            -- Anti-pattern: subquery filter instead of QUALIFY
            row_number() over (
                partition by cf.cashflow_id
                order by cf.cashflow_date desc
            ) as rn
        from "bain_analytics"."public"."stg_cashflows" cf
        inner join "bain_analytics"."public"."stg_portfolios" p
            on cf.portfolio_id = p.portfolio_id
        inner join "bain_analytics"."public"."stg_fund_structures" fs
            on cf.fund_id = fs.fund_id
    ) sub
    where rn = 1
),

-- Anti-pattern: running totals computed here AND again downstream
cashflow_cumulative as (
    select
        *,
        sum(case when cashflow_type = 'capital_call' then amount else 0 end) over (
            partition by fund_id, portfolio_id
            order by cashflow_date
            rows between unbounded preceding and current row
        ) as cumulative_called,
        sum(case when cashflow_type = 'distribution' then amount else 0 end) over (
            partition by fund_id, portfolio_id
            order by cashflow_date
            rows between unbounded preceding and current row
        ) as cumulative_distributed,
        sum(amount) over (
            partition by fund_id, portfolio_id
            order by cashflow_date
            rows between unbounded preceding and current row
        ) as cumulative_net_cashflow
    from cashflow_with_details
)

select
    cashflow_id,
    fund_id,
    fund_name,
    fund_type,
    portfolio_id,
    portfolio_name,
    strategy,
    manager_name,
    cashflow_date,
    cashflow_type,
    amount,
    currency,
    description,
    investor_id,
    cashflow_fiscal_quarter,
    cashflow_year,
    committed_capital,
    management_fee_rate,
    carry_rate,
    hurdle_rate,
    cumulative_called,
    cumulative_distributed,
    cumulative_net_cashflow,
    case
        when committed_capital > 0
        then cumulative_called / committed_capital
        else 0
    end as pct_called
from cashflow_cumulative
  );
[0m18:24:48.548789 [debug] [Thread-2  ]: On model.bain_capital_analytics.stg_trades: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_trades"} */

  create view "bain_analytics"."public"."stg_trades__dbt_tmp"
    
    
  as (
    -- Anti-pattern: unnecessary DISTINCT on already-unique trade_id
-- Anti-pattern: heavy casting repeated everywhere

select distinct
    trade_id,
    portfolio_id,
    instrument_id,
    counterparty_id,
    cast(trade_date as date) as trade_date,
    cast(settlement_date as date) as settlement_date,
    trade_type,
    cast(quantity as numeric(18,4)) as quantity,
    cast(price as numeric(18,6)) as price,
    cast(notional_amount as numeric(18,2)) as notional_amount,
    cast(commission as numeric(18,2)) as commission,
    currency,
    status,
    -- Anti-pattern: duplicated fiscal quarter logic
    case
        when extract(month from cast(trade_date as date)) between 1 and 3 then 'Q3'
        when extract(month from cast(trade_date as date)) between 4 and 6 then 'Q4'
        when extract(month from cast(trade_date as date)) between 7 and 9 then 'Q1'
        when extract(month from cast(trade_date as date)) between 10 and 12 then 'Q2'
    end as trade_fiscal_quarter,
    -- Anti-pattern: PostgreSQL-specific date arithmetic
    cast(settlement_date as date) - cast(trade_date as date) as settlement_days
from "bain_analytics"."public_raw"."raw_trades"
where status = 'settled'
  );
[0m18:24:48.549227 [debug] [Thread-3  ]: On model.bain_capital_analytics.stg_valuations: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_valuations"} */

  create view "bain_analytics"."public"."stg_valuations__dbt_tmp"
    
    
  as (
    -- Anti-pattern: unnecessary DISTINCT
select distinct
    valuation_id,
    portfolio_id,
    cast(valuation_date as date) as valuation_date,
    cast(gross_asset_value as numeric(18,2)) as gross_asset_value,
    cast(net_asset_value as numeric(18,2)) as net_asset_value,
    cast(total_liabilities as numeric(18,2)) as total_liabilities,
    cast(unrealized_pnl as numeric(18,2)) as unrealized_pnl,
    cast(realized_pnl as numeric(18,2)) as realized_pnl,
    valuation_method,
    -- Anti-pattern: duplicated fiscal quarter logic
    case
        when extract(month from cast(valuation_date as date)) between 1 and 3 then 'Q3'
        when extract(month from cast(valuation_date as date)) between 4 and 6 then 'Q4'
        when extract(month from cast(valuation_date as date)) between 7 and 9 then 'Q1'
        when extract(month from cast(valuation_date as date)) between 10 and 12 then 'Q2'
    end as valuation_fiscal_quarter
from "bain_analytics"."public_raw"."raw_valuations"
  );
[0m18:24:48.556179 [debug] [Thread-3  ]: SQL status: CREATE VIEW in 0.007 seconds
[0m18:24:48.559867 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.stg_valuations"
[0m18:24:48.560195 [debug] [Thread-4  ]: SQL status: CREATE VIEW in 0.011 seconds
[0m18:24:48.560489 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.011 seconds
[0m18:24:48.560768 [debug] [Thread-2  ]: SQL status: CREATE VIEW in 0.011 seconds
[0m18:24:48.561054 [debug] [Thread-3  ]: On model.bain_capital_analytics.stg_valuations: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_valuations"} */
alter table "bain_analytics"."public"."stg_valuations__dbt_tmp" rename to "stg_valuations"
[0m18:24:48.563751 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.int_cashflow_enriched"
[0m18:24:48.566415 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.int_benchmark_returns"
[0m18:24:48.568957 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.stg_trades"
[0m18:24:48.569323 [debug] [Thread-4  ]: On model.bain_capital_analytics.int_cashflow_enriched: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.int_cashflow_enriched"} */
alter table "bain_analytics"."public"."int_cashflow_enriched__dbt_tmp" rename to "int_cashflow_enriched"
[0m18:24:48.569640 [debug] [Thread-1  ]: On model.bain_capital_analytics.int_benchmark_returns: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.int_benchmark_returns"} */
alter table "bain_analytics"."public"."int_benchmark_returns__dbt_tmp" rename to "int_benchmark_returns"
[0m18:24:48.569940 [debug] [Thread-2  ]: On model.bain_capital_analytics.stg_trades: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_trades"} */
alter table "bain_analytics"."public"."stg_trades__dbt_tmp" rename to "stg_trades"
[0m18:24:48.570306 [debug] [Thread-3  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:24:48.571336 [debug] [Thread-3  ]: On model.bain_capital_analytics.stg_valuations: COMMIT
[0m18:24:48.571655 [debug] [Thread-2  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:24:48.571933 [debug] [Thread-4  ]: SQL status: ALTER TABLE in 0.002 seconds
[0m18:24:48.572201 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.002 seconds
[0m18:24:48.572476 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.stg_valuations"
[0m18:24:48.573410 [debug] [Thread-2  ]: On model.bain_capital_analytics.stg_trades: COMMIT
[0m18:24:48.574325 [debug] [Thread-4  ]: On model.bain_capital_analytics.int_cashflow_enriched: COMMIT
[0m18:24:48.575332 [debug] [Thread-1  ]: On model.bain_capital_analytics.int_benchmark_returns: COMMIT
[0m18:24:48.575640 [debug] [Thread-3  ]: On model.bain_capital_analytics.stg_valuations: COMMIT
[0m18:24:48.575933 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.stg_trades"
[0m18:24:48.576229 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.int_cashflow_enriched"
[0m18:24:48.576519 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.int_benchmark_returns"
[0m18:24:48.576837 [debug] [Thread-2  ]: On model.bain_capital_analytics.stg_trades: COMMIT
[0m18:24:48.577130 [debug] [Thread-4  ]: On model.bain_capital_analytics.int_cashflow_enriched: COMMIT
[0m18:24:48.577410 [debug] [Thread-1  ]: On model.bain_capital_analytics.int_benchmark_returns: COMMIT
[0m18:24:48.578372 [debug] [Thread-3  ]: SQL status: COMMIT in 0.002 seconds
[0m18:24:48.580606 [debug] [Thread-3  ]: Applying DROP to: "bain_analytics"."public"."stg_valuations__dbt_backup"
[0m18:24:48.580914 [debug] [Thread-4  ]: SQL status: COMMIT in 0.003 seconds
[0m18:24:48.581188 [debug] [Thread-2  ]: SQL status: COMMIT in 0.003 seconds
[0m18:24:48.581626 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.stg_valuations"
[0m18:24:48.581908 [debug] [Thread-1  ]: SQL status: COMMIT in 0.004 seconds
[0m18:24:48.584824 [debug] [Thread-4  ]: Applying DROP to: "bain_analytics"."public"."int_cashflow_enriched__dbt_backup"
[0m18:24:48.586893 [debug] [Thread-2  ]: Applying DROP to: "bain_analytics"."public"."stg_trades__dbt_backup"
[0m18:24:48.587204 [debug] [Thread-3  ]: On model.bain_capital_analytics.stg_valuations: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_valuations"} */
drop view if exists "bain_analytics"."public"."stg_valuations__dbt_backup" cascade
[0m18:24:48.589218 [debug] [Thread-1  ]: Applying DROP to: "bain_analytics"."public"."int_benchmark_returns__dbt_backup"
[0m18:24:48.589729 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.int_cashflow_enriched"
[0m18:24:48.590168 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.stg_trades"
[0m18:24:48.590652 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.int_benchmark_returns"
[0m18:24:48.590961 [debug] [Thread-4  ]: On model.bain_capital_analytics.int_cashflow_enriched: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.int_cashflow_enriched"} */
drop view if exists "bain_analytics"."public"."int_cashflow_enriched__dbt_backup" cascade
[0m18:24:48.591266 [debug] [Thread-2  ]: On model.bain_capital_analytics.stg_trades: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.stg_trades"} */
drop view if exists "bain_analytics"."public"."stg_trades__dbt_backup" cascade
[0m18:24:48.591577 [debug] [Thread-3  ]: SQL status: DROP VIEW in 0.001 seconds
[0m18:24:48.591866 [debug] [Thread-1  ]: On model.bain_capital_analytics.int_benchmark_returns: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.int_benchmark_returns"} */
drop view if exists "bain_analytics"."public"."int_benchmark_returns__dbt_backup" cascade
[0m18:24:48.592943 [debug] [Thread-3  ]: On model.bain_capital_analytics.stg_valuations: Close
[0m18:24:48.593257 [debug] [Thread-4  ]: SQL status: DROP VIEW in 0.001 seconds
[0m18:24:48.593537 [debug] [Thread-2  ]: SQL status: DROP VIEW in 0.001 seconds
[0m18:24:48.594055 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a133ca29-1656-4fd8-ac3b-1ffaa0897334', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10f0eae80>]}
[0m18:24:48.595042 [debug] [Thread-4  ]: On model.bain_capital_analytics.int_cashflow_enriched: Close
[0m18:24:48.595357 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.002 seconds
[0m18:24:48.596287 [debug] [Thread-2  ]: On model.bain_capital_analytics.stg_trades: Close
[0m18:24:48.597132 [info ] [Thread-3  ]: 10 of 28 OK created sql view model public.stg_valuations ....................... [[32mCREATE VIEW[0m in 0.10s]
[0m18:24:48.597467 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a133ca29-1656-4fd8-ac3b-1ffaa0897334', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10f1c9fa0>]}
[0m18:24:48.598394 [debug] [Thread-1  ]: On model.bain_capital_analytics.int_benchmark_returns: Close
[0m18:24:48.598826 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a133ca29-1656-4fd8-ac3b-1ffaa0897334', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10f34bca0>]}
[0m18:24:48.599251 [debug] [Thread-3  ]: Finished running node model.bain_capital_analytics.stg_valuations
[0m18:24:48.599769 [info ] [Thread-4  ]: 12 of 28 OK created sql view model public.int_cashflow_enriched ................ [[32mCREATE VIEW[0m in 0.10s]
[0m18:24:48.600181 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a133ca29-1656-4fd8-ac3b-1ffaa0897334', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10f25a5e0>]}
[0m18:24:48.600639 [info ] [Thread-2  ]: 9 of 28 OK created sql view model public.stg_trades ............................ [[32mCREATE VIEW[0m in 0.11s]
[0m18:24:48.601007 [debug] [Thread-3  ]: Began running node model.bain_capital_analytics.fact_portfolio_summary
[0m18:24:48.601514 [debug] [Thread-4  ]: Finished running node model.bain_capital_analytics.int_cashflow_enriched
[0m18:24:48.602069 [info ] [Thread-1  ]: 11 of 28 OK created sql view model public.int_benchmark_returns ................ [[32mCREATE VIEW[0m in 0.10s]
[0m18:24:48.602515 [debug] [Thread-2  ]: Finished running node model.bain_capital_analytics.stg_trades
[0m18:24:48.602894 [info ] [Thread-3  ]: 13 of 28 START sql view model public.fact_portfolio_summary .................... [RUN]
[0m18:24:48.603249 [debug] [Thread-4  ]: Began running node model.bain_capital_analytics.int_daily_positions
[0m18:24:48.603705 [debug] [Thread-1  ]: Finished running node model.bain_capital_analytics.int_benchmark_returns
[0m18:24:48.604078 [debug] [Thread-2  ]: Began running node model.bain_capital_analytics.int_portfolio_attribution
[0m18:24:48.604460 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly model.bain_capital_analytics.stg_valuations, now model.bain_capital_analytics.fact_portfolio_summary)
[0m18:24:48.604922 [info ] [Thread-4  ]: 14 of 28 START sql view model public.int_daily_positions ....................... [RUN]
[0m18:24:48.605288 [debug] [Thread-1  ]: Began running node model.bain_capital_analytics.int_fund_nav
[0m18:24:48.605707 [info ] [Thread-2  ]: 15 of 28 START sql view model public.int_portfolio_attribution ................. [RUN]
[0m18:24:48.606047 [debug] [Thread-3  ]: Began compiling node model.bain_capital_analytics.fact_portfolio_summary
[0m18:24:48.606376 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly model.bain_capital_analytics.int_cashflow_enriched, now model.bain_capital_analytics.int_daily_positions)
[0m18:24:48.606764 [info ] [Thread-1  ]: 16 of 28 START sql view model public.int_fund_nav .............................. [RUN]
[0m18:24:48.607106 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly model.bain_capital_analytics.stg_trades, now model.bain_capital_analytics.int_portfolio_attribution)
[0m18:24:48.610420 [debug] [Thread-3  ]: Writing injected SQL for node "model.bain_capital_analytics.fact_portfolio_summary"
[0m18:24:48.610738 [debug] [Thread-4  ]: Began compiling node model.bain_capital_analytics.int_daily_positions
[0m18:24:48.611058 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.bain_capital_analytics.int_benchmark_returns, now model.bain_capital_analytics.int_fund_nav)
[0m18:24:48.611358 [debug] [Thread-2  ]: Began compiling node model.bain_capital_analytics.int_portfolio_attribution
[0m18:24:48.614833 [debug] [Thread-4  ]: Writing injected SQL for node "model.bain_capital_analytics.int_daily_positions"
[0m18:24:48.615158 [debug] [Thread-1  ]: Began compiling node model.bain_capital_analytics.int_fund_nav
[0m18:24:48.618241 [debug] [Thread-2  ]: Writing injected SQL for node "model.bain_capital_analytics.int_portfolio_attribution"
[0m18:24:48.622770 [debug] [Thread-1  ]: Writing injected SQL for node "model.bain_capital_analytics.int_fund_nav"
[0m18:24:48.623112 [debug] [Thread-3  ]: Began executing node model.bain_capital_analytics.fact_portfolio_summary
[0m18:24:48.623566 [debug] [Thread-4  ]: Began executing node model.bain_capital_analytics.int_daily_positions
[0m18:24:48.626821 [debug] [Thread-3  ]: Writing runtime sql for node "model.bain_capital_analytics.fact_portfolio_summary"
[0m18:24:48.630109 [debug] [Thread-4  ]: Writing runtime sql for node "model.bain_capital_analytics.int_daily_positions"
[0m18:24:48.630439 [debug] [Thread-2  ]: Began executing node model.bain_capital_analytics.int_portfolio_attribution
[0m18:24:48.630751 [debug] [Thread-1  ]: Began executing node model.bain_capital_analytics.int_fund_nav
[0m18:24:48.633896 [debug] [Thread-2  ]: Writing runtime sql for node "model.bain_capital_analytics.int_portfolio_attribution"
[0m18:24:48.636944 [debug] [Thread-1  ]: Writing runtime sql for node "model.bain_capital_analytics.int_fund_nav"
[0m18:24:48.637441 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.int_daily_positions"
[0m18:24:48.637854 [debug] [Thread-4  ]: On model.bain_capital_analytics.int_daily_positions: BEGIN
[0m18:24:48.638193 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.fact_portfolio_summary"
[0m18:24:48.638505 [debug] [Thread-4  ]: Opening a new connection, currently in state closed
[0m18:24:48.638842 [debug] [Thread-3  ]: On model.bain_capital_analytics.fact_portfolio_summary: BEGIN
[0m18:24:48.639172 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.int_portfolio_attribution"
[0m18:24:48.639493 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.int_fund_nav"
[0m18:24:48.639891 [debug] [Thread-3  ]: Opening a new connection, currently in state closed
[0m18:24:48.640197 [debug] [Thread-2  ]: On model.bain_capital_analytics.int_portfolio_attribution: BEGIN
[0m18:24:48.640505 [debug] [Thread-1  ]: On model.bain_capital_analytics.int_fund_nav: BEGIN
[0m18:24:48.640899 [debug] [Thread-2  ]: Opening a new connection, currently in state closed
[0m18:24:48.641192 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m18:24:48.656150 [debug] [Thread-3  ]: SQL status: BEGIN in 0.016 seconds
[0m18:24:48.656488 [debug] [Thread-1  ]: SQL status: BEGIN in 0.015 seconds
[0m18:24:48.656782 [debug] [Thread-2  ]: SQL status: BEGIN in 0.016 seconds
[0m18:24:48.657066 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.fact_portfolio_summary"
[0m18:24:48.657352 [debug] [Thread-4  ]: SQL status: BEGIN in 0.019 seconds
[0m18:24:48.657647 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.int_fund_nav"
[0m18:24:48.657953 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.int_portfolio_attribution"
[0m18:24:48.658299 [debug] [Thread-3  ]: On model.bain_capital_analytics.fact_portfolio_summary: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.fact_portfolio_summary"} */

  create view "bain_analytics"."public"."fact_portfolio_summary__dbt_tmp"
    
    
  as (
    -- Pipeline A: FACT table - Portfolio summary with positions
-- Anti-pattern: unnecessary DISTINCT on already-unique aggregation
-- Anti-pattern: late filtering (filters at the end instead of upstream)
-- Anti-pattern: materialized as view (should be table)

select distinct
    p.portfolio_id,
    p.portfolio_name,
    p.strategy,
    p.fund_id,
    p.manager_name,
    pos.position_date,
    count(distinct pos.instrument_id) as num_positions,
    sum(pos.market_value) as total_market_value,
    sum(pos.cost_basis) as total_cost_basis,
    sum(pos.unrealized_gain_loss) as total_unrealized_pnl,
    case
        when sum(pos.cost_basis) != 0
        then sum(pos.unrealized_gain_loss) / abs(sum(pos.cost_basis))
        else 0
    end as portfolio_return_pct,
    max(pos.market_value) as largest_position_mv,
    min(pos.market_value) as smallest_position_mv
from "bain_analytics"."public"."stg_portfolios" p
inner join "bain_analytics"."public"."stg_positions" pos
    on p.portfolio_id = pos.portfolio_id
-- Anti-pattern: filter at the end instead of in staging
where p.is_active = true
group by
    p.portfolio_id,
    p.portfolio_name,
    p.strategy,
    p.fund_id,
    p.manager_name,
    pos.position_date
  );
[0m18:24:48.658654 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.int_daily_positions"
[0m18:24:48.659047 [debug] [Thread-1  ]: On model.bain_capital_analytics.int_fund_nav: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.int_fund_nav"} */

  create view "bain_analytics"."public"."int_fund_nav__dbt_tmp"
    
    
  as (
    -- Pipeline C: Fund-level NAV calculation from portfolio valuations
-- Anti-pattern: late aggregation - joins everything then aggregates at the end
-- Anti-pattern: repeated joins to fund_structures and portfolios

with portfolio_valuations as (
    select
        v.portfolio_id,
        v.valuation_date,
        v.net_asset_value,
        v.gross_asset_value,
        v.total_liabilities,
        v.unrealized_pnl,
        v.realized_pnl,
        v.valuation_method,
        p.fund_id,
        p.portfolio_name,
        p.strategy,
        -- Anti-pattern: joining fund_structures again (already done in int_cashflow_enriched)
        fs.fund_name,
        fs.fund_type,
        fs.committed_capital,
        fs.management_fee_rate
    from "bain_analytics"."public"."stg_valuations" v
    inner join "bain_analytics"."public"."stg_portfolios" p
        on v.portfolio_id = p.portfolio_id
    inner join "bain_analytics"."public"."stg_fund_structures" fs
        on p.fund_id = fs.fund_id
),

-- Anti-pattern: aggregation happens here at the end after all joins
fund_level_nav as (
    select
        fund_id,
        fund_name,
        fund_type,
        committed_capital,
        management_fee_rate,
        valuation_date,
        sum(net_asset_value) as fund_nav,
        sum(gross_asset_value) as fund_gav,
        sum(total_liabilities) as fund_total_liabilities,
        sum(unrealized_pnl) as fund_unrealized_pnl,
        sum(realized_pnl) as fund_realized_pnl,
        count(distinct portfolio_id) as num_portfolios
    from portfolio_valuations
    group by
        fund_id, fund_name, fund_type, committed_capital,
        management_fee_rate, valuation_date
),

fund_nav_with_changes as (
    select
        fn.*,
        lag(fn.fund_nav) over (
            partition by fn.fund_id order by fn.valuation_date
        ) as prev_fund_nav,
        case
            when lag(fn.fund_nav) over (
                partition by fn.fund_id order by fn.valuation_date
            ) is not null
            and lag(fn.fund_nav) over (
                partition by fn.fund_id order by fn.valuation_date
            ) != 0
            then (fn.fund_nav - lag(fn.fund_nav) over (
                partition by fn.fund_id order by fn.valuation_date
            )) / lag(fn.fund_nav) over (
                partition by fn.fund_id order by fn.valuation_date
            )
            else null
        end as fund_nav_return,
        fn.fund_nav / nullif(fn.committed_capital, 0) as tvpi_gross
    from fund_level_nav fn
)

select * from fund_nav_with_changes
  );
[0m18:24:48.659554 [debug] [Thread-2  ]: On model.bain_capital_analytics.int_portfolio_attribution: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.int_portfolio_attribution"} */

  create view "bain_analytics"."public"."int_portfolio_attribution__dbt_tmp"
    
    
  as (
    -- Pipeline C: Portfolio performance attribution by sector and instrument type
-- Anti-pattern: deep CTE chain, repeated joins, late aggregation
-- Anti-pattern: same position-instrument-portfolio joins as int_daily_positions

with positions_enriched as (
    -- Anti-pattern: repeating the same 3-way join as int_daily_positions
    select
        pos.position_id,
        pos.portfolio_id,
        pos.instrument_id,
        pos.position_date,
        pos.quantity,
        pos.market_value,
        pos.cost_basis,
        pos.unrealized_gain_loss,
        i.instrument_name,
        i.instrument_type,
        i.sector,
        p.portfolio_name,
        p.strategy,
        p.fund_id
    from "bain_analytics"."public"."stg_positions" pos
    inner join "bain_analytics"."public"."stg_instruments" i
        on pos.instrument_id = i.instrument_id
    inner join "bain_analytics"."public"."stg_portfolios" p
        on pos.portfolio_id = p.portfolio_id
),

-- Anti-pattern: compute portfolio totals in a separate CTE instead of a single pass
portfolio_totals as (
    select
        portfolio_id,
        position_date,
        sum(market_value) as total_portfolio_mv,
        sum(unrealized_gain_loss) as total_portfolio_ugl
    from positions_enriched
    group by portfolio_id, position_date
),

-- Anti-pattern: sector aggregation in yet another CTE
sector_attribution as (
    select
        pe.portfolio_id,
        pe.portfolio_name,
        pe.strategy,
        pe.fund_id,
        pe.position_date,
        pe.sector,
        sum(pe.market_value) as sector_mv,
        sum(pe.unrealized_gain_loss) as sector_ugl,
        count(distinct pe.instrument_id) as num_instruments
    from positions_enriched pe
    group by
        pe.portfolio_id, pe.portfolio_name, pe.strategy,
        pe.fund_id, pe.position_date, pe.sector
),

-- Anti-pattern: joining back to get weights instead of computing in one pass
attribution_with_weights as (
    select
        sa.*,
        pt.total_portfolio_mv,
        pt.total_portfolio_ugl,
        case
            when pt.total_portfolio_mv != 0
            then sa.sector_mv / pt.total_portfolio_mv
            else 0
        end as sector_weight,
        case
            when pt.total_portfolio_ugl != 0
            then sa.sector_ugl / pt.total_portfolio_ugl
            else 0
        end as sector_contribution
    from sector_attribution sa
    inner join portfolio_totals pt
        on sa.portfolio_id = pt.portfolio_id
        and sa.position_date = pt.position_date
)

select * from attribution_with_weights
  );
[0m18:24:48.660103 [debug] [Thread-4  ]: On model.bain_capital_analytics.int_daily_positions: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.int_daily_positions"} */

  create view "bain_analytics"."public"."int_daily_positions__dbt_tmp"
    
    
  as (
    -- Pipeline B: Daily position snapshots with PnL calculations
-- Anti-pattern: deep CTE nesting
-- Anti-pattern: repeated joins to same dimension tables

with position_base as (
    select
        pos.position_id,
        pos.portfolio_id,
        pos.instrument_id,
        pos.position_date,
        pos.quantity,
        pos.market_value,
        pos.cost_basis,
        pos.unrealized_gain_loss,
        pos.unrealized_return_pct,
        pos.currency
    from "bain_analytics"."public"."stg_positions" pos
),

-- Anti-pattern: CTE level 2 - join instruments (same join as int_trade_enriched)
position_with_instruments as (
    select
        pb.*,
        i.instrument_name,
        i.instrument_type,
        i.sector,
        i.liquidity_class
    from position_base pb
    inner join "bain_analytics"."public"."stg_instruments" i
        on pb.instrument_id = i.instrument_id
),

-- Anti-pattern: CTE level 3 - join portfolios (same join as int_trade_enriched)
position_with_portfolio as (
    select
        pwi.*,
        p.portfolio_name,
        p.strategy,
        p.fund_id
    from position_with_instruments pwi
    inner join "bain_analytics"."public"."stg_portfolios" p
        on pwi.portfolio_id = p.portfolio_id
),

-- Anti-pattern: CTE level 4 - join dates
position_with_dates as (
    select
        pwp.*,
        d.is_business_day,
        d.is_month_end,
        d.is_quarter_end,
        d.fiscal_quarter,
        d.fiscal_year
    from position_with_portfolio pwp
    inner join "bain_analytics"."public"."stg_dates" d
        on pwp.position_date = d.date_day
),

-- Anti-pattern: CTE level 5 - compute window functions
position_with_analytics as (
    select
        pwd.*,
        -- Anti-pattern: multiple window functions on same partition
        lag(pwd.market_value) over (
            partition by pwd.portfolio_id, pwd.instrument_id
            order by pwd.position_date
        ) as prev_market_value,
        pwd.market_value - coalesce(
            lag(pwd.market_value) over (
                partition by pwd.portfolio_id, pwd.instrument_id
                order by pwd.position_date
            ), pwd.cost_basis
        ) as daily_pnl,
        sum(pwd.market_value) over (
            partition by pwd.portfolio_id, pwd.position_date
        ) as portfolio_total_mv,
        case
            when sum(pwd.market_value) over (partition by pwd.portfolio_id, pwd.position_date) != 0
            then pwd.market_value / sum(pwd.market_value) over (partition by pwd.portfolio_id, pwd.position_date)
            else 0
        end as weight_in_portfolio
    from position_with_dates pwd
)

select * from position_with_analytics
  );
[0m18:24:48.668305 [debug] [Thread-3  ]: SQL status: CREATE VIEW in 0.008 seconds
[0m18:24:48.672203 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.fact_portfolio_summary"
[0m18:24:48.672555 [debug] [Thread-4  ]: SQL status: CREATE VIEW in 0.012 seconds
[0m18:24:48.672847 [debug] [Thread-2  ]: SQL status: CREATE VIEW in 0.012 seconds
[0m18:24:48.673124 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.013 seconds
[0m18:24:48.673412 [debug] [Thread-3  ]: On model.bain_capital_analytics.fact_portfolio_summary: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.fact_portfolio_summary"} */
alter table "bain_analytics"."public"."fact_portfolio_summary__dbt_tmp" rename to "fact_portfolio_summary"
[0m18:24:48.676148 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.int_daily_positions"
[0m18:24:48.678718 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.int_portfolio_attribution"
[0m18:24:48.681390 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.int_fund_nav"
[0m18:24:48.681760 [debug] [Thread-4  ]: On model.bain_capital_analytics.int_daily_positions: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.int_daily_positions"} */
alter table "bain_analytics"."public"."int_daily_positions__dbt_tmp" rename to "int_daily_positions"
[0m18:24:48.682080 [debug] [Thread-2  ]: On model.bain_capital_analytics.int_portfolio_attribution: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.int_portfolio_attribution"} */
alter table "bain_analytics"."public"."int_portfolio_attribution__dbt_tmp" rename to "int_portfolio_attribution"
[0m18:24:48.682378 [debug] [Thread-1  ]: On model.bain_capital_analytics.int_fund_nav: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.int_fund_nav"} */
alter table "bain_analytics"."public"."int_fund_nav__dbt_tmp" rename to "int_fund_nav"
[0m18:24:48.682835 [debug] [Thread-3  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:24:48.683803 [debug] [Thread-3  ]: On model.bain_capital_analytics.fact_portfolio_summary: COMMIT
[0m18:24:48.684140 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.fact_portfolio_summary"
[0m18:24:48.684438 [debug] [Thread-4  ]: SQL status: ALTER TABLE in 0.002 seconds
[0m18:24:48.684720 [debug] [Thread-2  ]: SQL status: ALTER TABLE in 0.002 seconds
[0m18:24:48.684993 [debug] [Thread-3  ]: On model.bain_capital_analytics.fact_portfolio_summary: COMMIT
[0m18:24:48.685257 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.003 seconds
[0m18:24:48.686164 [debug] [Thread-4  ]: On model.bain_capital_analytics.int_daily_positions: COMMIT
[0m18:24:48.687066 [debug] [Thread-2  ]: On model.bain_capital_analytics.int_portfolio_attribution: COMMIT
[0m18:24:48.688064 [debug] [Thread-1  ]: On model.bain_capital_analytics.int_fund_nav: COMMIT
[0m18:24:48.688403 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.int_daily_positions"
[0m18:24:48.688814 [debug] [Thread-3  ]: SQL status: COMMIT in 0.001 seconds
[0m18:24:48.689097 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.int_portfolio_attribution"
[0m18:24:48.689397 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.int_fund_nav"
[0m18:24:48.689685 [debug] [Thread-4  ]: On model.bain_capital_analytics.int_daily_positions: COMMIT
[0m18:24:48.691822 [debug] [Thread-3  ]: Applying DROP to: "bain_analytics"."public"."fact_portfolio_summary__dbt_backup"
[0m18:24:48.692133 [debug] [Thread-2  ]: On model.bain_capital_analytics.int_portfolio_attribution: COMMIT
[0m18:24:48.692417 [debug] [Thread-1  ]: On model.bain_capital_analytics.int_fund_nav: COMMIT
[0m18:24:48.692898 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.fact_portfolio_summary"
[0m18:24:48.693281 [debug] [Thread-3  ]: On model.bain_capital_analytics.fact_portfolio_summary: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.fact_portfolio_summary"} */
drop view if exists "bain_analytics"."public"."fact_portfolio_summary__dbt_backup" cascade
[0m18:24:48.693885 [debug] [Thread-4  ]: SQL status: COMMIT in 0.001 seconds
[0m18:24:48.696713 [debug] [Thread-4  ]: Applying DROP to: "bain_analytics"."public"."int_daily_positions__dbt_backup"
[0m18:24:48.697033 [debug] [Thread-2  ]: SQL status: COMMIT in 0.004 seconds
[0m18:24:48.697312 [debug] [Thread-1  ]: SQL status: COMMIT in 0.004 seconds
[0m18:24:48.697749 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.int_daily_positions"
[0m18:24:48.698035 [debug] [Thread-3  ]: SQL status: DROP VIEW in 0.004 seconds
[0m18:24:48.700156 [debug] [Thread-2  ]: Applying DROP to: "bain_analytics"."public"."int_portfolio_attribution__dbt_backup"
[0m18:24:48.702233 [debug] [Thread-1  ]: Applying DROP to: "bain_analytics"."public"."int_fund_nav__dbt_backup"
[0m18:24:48.702546 [debug] [Thread-4  ]: On model.bain_capital_analytics.int_daily_positions: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.int_daily_positions"} */
drop view if exists "bain_analytics"."public"."int_daily_positions__dbt_backup" cascade
[0m18:24:48.703542 [debug] [Thread-3  ]: On model.bain_capital_analytics.fact_portfolio_summary: Close
[0m18:24:48.704003 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.int_portfolio_attribution"
[0m18:24:48.704461 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.int_fund_nav"
[0m18:24:48.705000 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a133ca29-1656-4fd8-ac3b-1ffaa0897334', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10f235b20>]}
[0m18:24:48.705313 [debug] [Thread-2  ]: On model.bain_capital_analytics.int_portfolio_attribution: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.int_portfolio_attribution"} */
drop view if exists "bain_analytics"."public"."int_portfolio_attribution__dbt_backup" cascade
[0m18:24:48.705625 [debug] [Thread-4  ]: SQL status: DROP VIEW in 0.001 seconds
[0m18:24:48.705916 [debug] [Thread-1  ]: On model.bain_capital_analytics.int_fund_nav: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.int_fund_nav"} */
drop view if exists "bain_analytics"."public"."int_fund_nav__dbt_backup" cascade
[0m18:24:48.706464 [info ] [Thread-3  ]: 13 of 28 OK created sql view model public.fact_portfolio_summary ............... [[32mCREATE VIEW[0m in 0.10s]
[0m18:24:48.707501 [debug] [Thread-4  ]: On model.bain_capital_analytics.int_daily_positions: Close
[0m18:24:48.707829 [debug] [Thread-2  ]: SQL status: DROP VIEW in 0.001 seconds
[0m18:24:48.708300 [debug] [Thread-3  ]: Finished running node model.bain_capital_analytics.fact_portfolio_summary
[0m18:24:48.708751 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a133ca29-1656-4fd8-ac3b-1ffaa0897334', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10f0c0250>]}
[0m18:24:48.709041 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.001 seconds
[0m18:24:48.709940 [debug] [Thread-2  ]: On model.bain_capital_analytics.int_portfolio_attribution: Close
[0m18:24:48.710274 [debug] [Thread-3  ]: Began running node model.bain_capital_analytics.int_irr_calculations
[0m18:24:48.710894 [info ] [Thread-4  ]: 14 of 28 OK created sql view model public.int_daily_positions .................. [[32mCREATE VIEW[0m in 0.10s]
[0m18:24:48.711937 [debug] [Thread-1  ]: On model.bain_capital_analytics.int_fund_nav: Close
[0m18:24:48.712428 [info ] [Thread-3  ]: 17 of 28 START sql view model public.int_irr_calculations ...................... [RUN]
[0m18:24:48.712999 [debug] [Thread-4  ]: Finished running node model.bain_capital_analytics.int_daily_positions
[0m18:24:48.713279 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a133ca29-1656-4fd8-ac3b-1ffaa0897334', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10f1c9280>]}
[0m18:24:48.713752 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly model.bain_capital_analytics.fact_portfolio_summary, now model.bain_capital_analytics.int_irr_calculations)
[0m18:24:48.714042 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a133ca29-1656-4fd8-ac3b-1ffaa0897334', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10f4861c0>]}
[0m18:24:48.714369 [debug] [Thread-4  ]: Began running node model.bain_capital_analytics.int_valuation_enriched
[0m18:24:48.714921 [info ] [Thread-2  ]: 15 of 28 OK created sql view model public.int_portfolio_attribution ............ [[32mCREATE VIEW[0m in 0.11s]
[0m18:24:48.715257 [debug] [Thread-3  ]: Began compiling node model.bain_capital_analytics.int_irr_calculations
[0m18:24:48.715697 [info ] [Thread-1  ]: 16 of 28 OK created sql view model public.int_fund_nav ......................... [[32mCREATE VIEW[0m in 0.10s]
[0m18:24:48.716096 [info ] [Thread-4  ]: 18 of 28 START sql view model public.int_valuation_enriched .................... [RUN]
[0m18:24:48.716534 [debug] [Thread-2  ]: Finished running node model.bain_capital_analytics.int_portfolio_attribution
[0m18:24:48.720340 [debug] [Thread-3  ]: Writing injected SQL for node "model.bain_capital_analytics.int_irr_calculations"
[0m18:24:48.720773 [debug] [Thread-1  ]: Finished running node model.bain_capital_analytics.int_fund_nav
[0m18:24:48.721109 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly model.bain_capital_analytics.int_daily_positions, now model.bain_capital_analytics.int_valuation_enriched)
[0m18:24:48.721447 [debug] [Thread-2  ]: Began running node model.bain_capital_analytics.fact_cashflow_waterfall
[0m18:24:48.721946 [debug] [Thread-1  ]: Began running node model.bain_capital_analytics.fact_trade_activity
[0m18:24:48.722308 [debug] [Thread-4  ]: Began compiling node model.bain_capital_analytics.int_valuation_enriched
[0m18:24:48.722729 [info ] [Thread-2  ]: 19 of 28 START sql view model public.fact_cashflow_waterfall ................... [RUN]
[0m18:24:48.723057 [debug] [Thread-3  ]: Began executing node model.bain_capital_analytics.int_irr_calculations
[0m18:24:48.723424 [info ] [Thread-1  ]: 20 of 28 START sql view model public.fact_trade_activity ....................... [RUN]
[0m18:24:48.726375 [debug] [Thread-4  ]: Writing injected SQL for node "model.bain_capital_analytics.int_valuation_enriched"
[0m18:24:48.726739 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly model.bain_capital_analytics.int_portfolio_attribution, now model.bain_capital_analytics.fact_cashflow_waterfall)
[0m18:24:48.730186 [debug] [Thread-3  ]: Writing runtime sql for node "model.bain_capital_analytics.int_irr_calculations"
[0m18:24:48.730569 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.bain_capital_analytics.int_fund_nav, now model.bain_capital_analytics.fact_trade_activity)
[0m18:24:48.730995 [debug] [Thread-2  ]: Began compiling node model.bain_capital_analytics.fact_cashflow_waterfall
[0m18:24:48.731429 [debug] [Thread-1  ]: Began compiling node model.bain_capital_analytics.fact_trade_activity
[0m18:24:48.731745 [debug] [Thread-4  ]: Began executing node model.bain_capital_analytics.int_valuation_enriched
[0m18:24:48.735773 [debug] [Thread-2  ]: Writing injected SQL for node "model.bain_capital_analytics.fact_cashflow_waterfall"
[0m18:24:48.739328 [debug] [Thread-1  ]: Writing injected SQL for node "model.bain_capital_analytics.fact_trade_activity"
[0m18:24:48.739703 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.int_irr_calculations"
[0m18:24:48.742929 [debug] [Thread-4  ]: Writing runtime sql for node "model.bain_capital_analytics.int_valuation_enriched"
[0m18:24:48.743363 [debug] [Thread-3  ]: On model.bain_capital_analytics.int_irr_calculations: BEGIN
[0m18:24:48.743754 [debug] [Thread-3  ]: Opening a new connection, currently in state closed
[0m18:24:48.744233 [debug] [Thread-2  ]: Began executing node model.bain_capital_analytics.fact_cashflow_waterfall
[0m18:24:48.744730 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.int_valuation_enriched"
[0m18:24:48.745066 [debug] [Thread-1  ]: Began executing node model.bain_capital_analytics.fact_trade_activity
[0m18:24:48.748391 [debug] [Thread-2  ]: Writing runtime sql for node "model.bain_capital_analytics.fact_cashflow_waterfall"
[0m18:24:48.748721 [debug] [Thread-4  ]: On model.bain_capital_analytics.int_valuation_enriched: BEGIN
[0m18:24:48.751862 [debug] [Thread-1  ]: Writing runtime sql for node "model.bain_capital_analytics.fact_trade_activity"
[0m18:24:48.752233 [debug] [Thread-4  ]: Opening a new connection, currently in state closed
[0m18:24:48.752949 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.fact_cashflow_waterfall"
[0m18:24:48.753288 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.fact_trade_activity"
[0m18:24:48.753577 [debug] [Thread-2  ]: On model.bain_capital_analytics.fact_cashflow_waterfall: BEGIN
[0m18:24:48.753878 [debug] [Thread-1  ]: On model.bain_capital_analytics.fact_trade_activity: BEGIN
[0m18:24:48.754205 [debug] [Thread-2  ]: Opening a new connection, currently in state closed
[0m18:24:48.754491 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m18:24:48.755049 [debug] [Thread-3  ]: SQL status: BEGIN in 0.011 seconds
[0m18:24:48.755358 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.int_irr_calculations"
[0m18:24:48.755791 [debug] [Thread-3  ]: On model.bain_capital_analytics.int_irr_calculations: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.int_irr_calculations"} */

  create view "bain_analytics"."public"."int_irr_calculations__dbt_tmp"
    
    
  as (
    -- Pipeline C: Approximate IRR calculation per fund/portfolio
-- Anti-pattern: extremely deep CTE nesting (6 levels)
-- Anti-pattern: PostgreSQL-specific date arithmetic
-- Anti-pattern: complex logic that should be a macro

with cashflow_series as (
    -- CTE level 1: get all cashflows with proper signs
    select
        cf.fund_id,
        cf.portfolio_id,
        cf.cashflow_date,
        cf.cashflow_type,
        case
            when cf.cashflow_type = 'capital_call' then -1 * abs(cf.amount)
            when cf.cashflow_type = 'distribution' then abs(cf.amount)
            when cf.cashflow_type = 'management_fee' then -1 * abs(cf.amount)
            else cf.amount
        end as signed_amount
    from "bain_analytics"."public"."stg_cashflows" cf
),

terminal_values as (
    -- CTE level 2: get latest NAV as terminal cashflow
    select
        v.portfolio_id,
        p.fund_id,
        v.valuation_date as cashflow_date,
        'terminal_value' as cashflow_type,
        v.net_asset_value as signed_amount
    from "bain_analytics"."public"."stg_valuations" v
    inner join "bain_analytics"."public"."stg_portfolios" p
        on v.portfolio_id = p.portfolio_id
    where v.valuation_date = (
        -- Anti-pattern: correlated subquery instead of window function
        select max(v2.valuation_date)
        from "bain_analytics"."public"."stg_valuations" v2
        where v2.portfolio_id = v.portfolio_id
    )
),

all_cashflows as (
    -- CTE level 3: union cashflows and terminal values
    select fund_id, portfolio_id, cashflow_date, cashflow_type, signed_amount
    from cashflow_series
    union all
    select fund_id, portfolio_id, cashflow_date, cashflow_type, signed_amount
    from terminal_values
),

cashflow_with_timing as (
    -- CTE level 4: compute time fractions
    -- Anti-pattern: PostgreSQL date subtraction
    select
        ac.*,
        min(ac.cashflow_date) over (partition by ac.fund_id, ac.portfolio_id) as first_cf_date,
        (ac.cashflow_date - min(ac.cashflow_date) over (partition by ac.fund_id, ac.portfolio_id))::numeric / 365.25 as year_fraction
    from all_cashflows ac
),

-- CTE level 5: compute simple multiples as IRR proxy
portfolio_multiples as (
    select
        fund_id,
        portfolio_id,
        min(cashflow_date) as first_cashflow_date,
        max(cashflow_date) as last_cashflow_date,
        -- Anti-pattern: PostgreSQL date subtraction
        max(cashflow_date) - min(cashflow_date) as investment_days,
        (max(cashflow_date) - min(cashflow_date))::numeric / 365.25 as investment_years,
        sum(case when cashflow_type = 'capital_call' then abs(signed_amount) else 0 end) as total_invested,
        sum(case when cashflow_type = 'distribution' then signed_amount else 0 end) as total_distributed,
        sum(case when cashflow_type = 'terminal_value' then signed_amount else 0 end) as terminal_value,
        sum(signed_amount) as net_cashflow
    from cashflow_with_timing
    group by fund_id, portfolio_id
),

-- CTE level 6: compute IRR approximation
irr_approximation as (
    select
        pm.*,
        case
            when pm.total_invested > 0
            then (pm.total_distributed + pm.terminal_value) / pm.total_invested
            else null
        end as tvpi,
        case
            when pm.total_invested > 0
            then pm.total_distributed / pm.total_invested
            else null
        end as dpi,
        case
            when pm.total_invested > 0
            then pm.terminal_value / pm.total_invested
            else null
        end as rvpi,
        -- Simplified IRR approximation: (TVPI^(1/years)) - 1
        case
            when pm.total_invested > 0 and pm.investment_years > 0
            then power(
                (pm.total_distributed + pm.terminal_value) / pm.total_invested,
                1.0 / pm.investment_years
            ) - 1
            else null
        end as approx_irr
    from portfolio_multiples pm
)

select * from irr_approximation
  );
[0m18:24:48.761772 [debug] [Thread-4  ]: SQL status: BEGIN in 0.010 seconds
[0m18:24:48.762153 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.int_valuation_enriched"
[0m18:24:48.762554 [debug] [Thread-4  ]: On model.bain_capital_analytics.int_valuation_enriched: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.int_valuation_enriched"} */

  create view "bain_analytics"."public"."int_valuation_enriched__dbt_tmp"
    
    
  as (
    -- Pipeline C: Enriched valuation data
-- Anti-pattern: subquery for dedup instead of QUALIFY
-- Anti-pattern: repeated portfolio join
-- Anti-pattern: PostgreSQL-specific date functions

with valuation_ranked as (
    select *
    from (
        select
            v.*,
            p.portfolio_name,
            p.strategy,
            p.fund_id,
            p.manager_name,
            -- Anti-pattern: subquery dedup instead of QUALIFY
            row_number() over (
                partition by v.portfolio_id, v.valuation_date
                order by v.valuation_id desc
            ) as rn
        from "bain_analytics"."public"."stg_valuations" v
        inner join "bain_analytics"."public"."stg_portfolios" p
            on v.portfolio_id = p.portfolio_id
    ) sub
    where rn = 1
),

valuation_with_changes as (
    select
        vr.*,
        lag(vr.net_asset_value) over (
            partition by vr.portfolio_id order by vr.valuation_date
        ) as prev_nav,
        case
            when lag(vr.net_asset_value) over (
                partition by vr.portfolio_id order by vr.valuation_date
            ) is not null
            and lag(vr.net_asset_value) over (
                partition by vr.portfolio_id order by vr.valuation_date
            ) != 0
            then (vr.net_asset_value - lag(vr.net_asset_value) over (
                partition by vr.portfolio_id order by vr.valuation_date
            )) / lag(vr.net_asset_value) over (
                partition by vr.portfolio_id order by vr.valuation_date
            )
            else null
        end as nav_return_pct,
        -- Anti-pattern: PostgreSQL date subtraction
        vr.valuation_date - lag(vr.valuation_date) over (
            partition by vr.portfolio_id order by vr.valuation_date
        ) as days_between_valuations
    from valuation_ranked vr
)

select * from valuation_with_changes
  );
[0m18:24:48.763345 [debug] [Thread-3  ]: SQL status: CREATE VIEW in 0.007 seconds
[0m18:24:48.767001 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.int_irr_calculations"
[0m18:24:48.767323 [debug] [Thread-2  ]: SQL status: BEGIN in 0.013 seconds
[0m18:24:48.767602 [debug] [Thread-1  ]: SQL status: BEGIN in 0.013 seconds
[0m18:24:48.767878 [debug] [Thread-3  ]: On model.bain_capital_analytics.int_irr_calculations: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.int_irr_calculations"} */
alter table "bain_analytics"."public"."int_irr_calculations__dbt_tmp" rename to "int_irr_calculations"
[0m18:24:48.768191 [debug] [Thread-4  ]: SQL status: CREATE VIEW in 0.005 seconds
[0m18:24:48.768475 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.fact_cashflow_waterfall"
[0m18:24:48.768765 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.fact_trade_activity"
[0m18:24:48.771414 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.int_valuation_enriched"
[0m18:24:48.771723 [debug] [Thread-3  ]: SQL status: ALTER TABLE in 0.003 seconds
[0m18:24:48.772094 [debug] [Thread-2  ]: On model.bain_capital_analytics.fact_cashflow_waterfall: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.fact_cashflow_waterfall"} */

  create view "bain_analytics"."public"."fact_cashflow_waterfall__dbt_tmp"
    
    
  as (
    -- Pipeline C: FACT table - Cashflow waterfall for PE/fund reporting
-- Anti-pattern: deep CTEs, repeated joins, late aggregation
-- Anti-pattern: PostgreSQL-specific date functions

with enriched_cashflows as (
    select
        ce.cashflow_id,
        ce.fund_id,
        ce.fund_name,
        ce.fund_type,
        ce.portfolio_id,
        ce.portfolio_name,
        ce.cashflow_date,
        ce.cashflow_type,
        ce.amount,
        ce.investor_id,
        ce.committed_capital,
        ce.management_fee_rate,
        ce.carry_rate,
        ce.hurdle_rate,
        ce.cumulative_called,
        ce.cumulative_distributed,
        ce.cumulative_net_cashflow,
        ce.pct_called,
        -- Anti-pattern: duplicated fiscal quarter logic
        case
            when extract(month from ce.cashflow_date) between 1 and 3 then 'Q3'
            when extract(month from ce.cashflow_date) between 4 and 6 then 'Q4'
            when extract(month from ce.cashflow_date) between 7 and 9 then 'Q1'
            when extract(month from ce.cashflow_date) between 10 and 12 then 'Q2'
        end as fiscal_quarter,
        -- Anti-pattern: PostgreSQL extract
        extract(year from ce.cashflow_date) as calendar_year
    from "bain_analytics"."public"."int_cashflow_enriched" ce
),

-- Anti-pattern: re-joining valuations when int_valuation_enriched already has this
waterfall_with_nav as (
    select
        ecf.*,
        v.net_asset_value,
        v.gross_asset_value,
        v.unrealized_pnl as nav_unrealized_pnl,
        v.realized_pnl as nav_realized_pnl
    from enriched_cashflows ecf
    left join "bain_analytics"."public"."stg_valuations" v
        on ecf.portfolio_id = v.portfolio_id
        and ecf.cashflow_date = v.valuation_date
),

-- Anti-pattern: computing carry/waterfall in a CTE chain instead of a macro
waterfall_calculations as (
    select
        wn.*,
        -- Simplified carry calculation
        case
            when wn.cumulative_distributed > wn.cumulative_called * (1 + wn.hurdle_rate)
            then (wn.cumulative_distributed - wn.cumulative_called * (1 + wn.hurdle_rate)) * wn.carry_rate
            else 0
        end as estimated_carry,
        wn.cumulative_called * wn.management_fee_rate as annual_mgmt_fee,
        case
            when wn.cumulative_called > 0
            then wn.cumulative_distributed / wn.cumulative_called
            else 0
        end as dpi,
        case
            when wn.cumulative_called > 0 and wn.net_asset_value is not null
            then (wn.cumulative_distributed + wn.net_asset_value) / wn.cumulative_called
            else null
        end as tvpi
    from waterfall_with_nav wn
)

select * from waterfall_calculations
  );
[0m18:24:48.772572 [debug] [Thread-1  ]: On model.bain_capital_analytics.fact_trade_activity: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.fact_trade_activity"} */

  create view "bain_analytics"."public"."fact_trade_activity__dbt_tmp"
    
    
  as (
    -- Pipeline B: FACT table - Trade activity detail
-- Anti-pattern: repeats the SAME 3-table join as fact_portfolio_pnl and int_trade_enriched
-- Anti-pattern: could use int_trade_enriched but re-does everything

select
    t.trade_id,
    t.portfolio_id,
    t.instrument_id,
    t.counterparty_id,
    t.trade_date,
    t.settlement_date,
    t.trade_type,
    t.quantity,
    t.price,
    t.notional_amount,
    t.commission,
    t.currency,
    t.settlement_days,
    -- Anti-pattern: re-joining instruments (done in int_trade_enriched)
    i.instrument_name,
    i.instrument_type,
    i.sector,
    i.liquidity_class,
    -- Anti-pattern: re-joining counterparties (done in int_trade_enriched)
    c.counterparty_name,
    c.counterparty_type,
    c.credit_rating,
    -- Anti-pattern: re-joining portfolios (done in int_trade_enriched)
    p.portfolio_name,
    p.strategy,
    p.fund_id,
    p.manager_name,
    -- Anti-pattern: re-joining dates
    d.fiscal_quarter,
    d.fiscal_year,
    d.is_month_end,
    -- Anti-pattern: duplicated fiscal quarter logic
    case
        when extract(month from t.trade_date) between 1 and 3 then 'Q3'
        when extract(month from t.trade_date) between 4 and 6 then 'Q4'
        when extract(month from t.trade_date) between 7 and 9 then 'Q1'
        when extract(month from t.trade_date) between 10 and 12 then 'Q2'
    end as computed_fiscal_quarter,
    -- Anti-pattern: window functions recomputed (already in int_trade_enriched)
    sum(t.notional_amount) over (
        partition by t.portfolio_id
        order by t.trade_date
        rows between unbounded preceding and current row
    ) as running_notional,
    count(*) over (
        partition by t.portfolio_id, date_trunc('month', t.trade_date)
    ) as monthly_trade_count,
    sum(t.commission) over (
        partition by t.portfolio_id, date_trunc('month', t.trade_date)
    ) as monthly_commissions
from "bain_analytics"."public"."stg_trades" t
inner join "bain_analytics"."public"."stg_instruments" i
    on t.instrument_id = i.instrument_id
inner join "bain_analytics"."public"."stg_counterparties" c
    on t.counterparty_id = c.counterparty_id
inner join "bain_analytics"."public"."stg_portfolios" p
    on t.portfolio_id = p.portfolio_id
inner join "bain_analytics"."public"."stg_dates" d
    on t.trade_date = d.date_day
  );
[0m18:24:48.772947 [debug] [Thread-4  ]: On model.bain_capital_analytics.int_valuation_enriched: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.int_valuation_enriched"} */
alter table "bain_analytics"."public"."int_valuation_enriched__dbt_tmp" rename to "int_valuation_enriched"
[0m18:24:48.773945 [debug] [Thread-3  ]: On model.bain_capital_analytics.int_irr_calculations: COMMIT
[0m18:24:48.774366 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.int_irr_calculations"
[0m18:24:48.774659 [debug] [Thread-3  ]: On model.bain_capital_analytics.int_irr_calculations: COMMIT
[0m18:24:48.775166 [debug] [Thread-4  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:24:48.776093 [debug] [Thread-4  ]: On model.bain_capital_analytics.int_valuation_enriched: COMMIT
[0m18:24:48.776401 [debug] [Thread-3  ]: SQL status: COMMIT in 0.001 seconds
[0m18:24:48.776683 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.int_valuation_enriched"
[0m18:24:48.778886 [debug] [Thread-3  ]: Applying DROP to: "bain_analytics"."public"."int_irr_calculations__dbt_backup"
[0m18:24:48.779196 [debug] [Thread-4  ]: On model.bain_capital_analytics.int_valuation_enriched: COMMIT
[0m18:24:48.779704 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.int_irr_calculations"
[0m18:24:48.780012 [debug] [Thread-2  ]: SQL status: CREATE VIEW in 0.006 seconds
[0m18:24:48.780336 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.006 seconds
[0m18:24:48.780656 [debug] [Thread-3  ]: On model.bain_capital_analytics.int_irr_calculations: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.int_irr_calculations"} */
drop view if exists "bain_analytics"."public"."int_irr_calculations__dbt_backup" cascade
[0m18:24:48.781020 [debug] [Thread-4  ]: SQL status: COMMIT in 0.001 seconds
[0m18:24:48.783738 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.fact_cashflow_waterfall"
[0m18:24:48.786327 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.fact_trade_activity"
[0m18:24:48.788496 [debug] [Thread-4  ]: Applying DROP to: "bain_analytics"."public"."int_valuation_enriched__dbt_backup"
[0m18:24:48.788846 [debug] [Thread-3  ]: SQL status: DROP VIEW in 0.002 seconds
[0m18:24:48.789195 [debug] [Thread-2  ]: On model.bain_capital_analytics.fact_cashflow_waterfall: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.fact_cashflow_waterfall"} */
alter table "bain_analytics"."public"."fact_cashflow_waterfall__dbt_tmp" rename to "fact_cashflow_waterfall"
[0m18:24:48.789544 [debug] [Thread-1  ]: On model.bain_capital_analytics.fact_trade_activity: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.fact_trade_activity"} */
alter table "bain_analytics"."public"."fact_trade_activity__dbt_tmp" rename to "fact_trade_activity"
[0m18:24:48.790057 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.int_valuation_enriched"
[0m18:24:48.791158 [debug] [Thread-3  ]: On model.bain_capital_analytics.int_irr_calculations: Close
[0m18:24:48.791567 [debug] [Thread-4  ]: On model.bain_capital_analytics.int_valuation_enriched: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.int_valuation_enriched"} */
drop view if exists "bain_analytics"."public"."int_valuation_enriched__dbt_backup" cascade
[0m18:24:48.792144 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a133ca29-1656-4fd8-ac3b-1ffaa0897334', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10f5a2670>]}
[0m18:24:48.792561 [debug] [Thread-2  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:24:48.792895 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:24:48.793879 [debug] [Thread-2  ]: On model.bain_capital_analytics.fact_cashflow_waterfall: COMMIT
[0m18:24:48.794175 [debug] [Thread-4  ]: SQL status: DROP VIEW in 0.002 seconds
[0m18:24:48.794628 [info ] [Thread-3  ]: 17 of 28 OK created sql view model public.int_irr_calculations ................. [[32mCREATE VIEW[0m in 0.08s]
[0m18:24:48.795699 [debug] [Thread-1  ]: On model.bain_capital_analytics.fact_trade_activity: COMMIT
[0m18:24:48.796013 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.fact_cashflow_waterfall"
[0m18:24:48.796946 [debug] [Thread-4  ]: On model.bain_capital_analytics.int_valuation_enriched: Close
[0m18:24:48.797395 [debug] [Thread-3  ]: Finished running node model.bain_capital_analytics.int_irr_calculations
[0m18:24:48.797697 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.fact_trade_activity"
[0m18:24:48.797988 [debug] [Thread-2  ]: On model.bain_capital_analytics.fact_cashflow_waterfall: COMMIT
[0m18:24:48.798434 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a133ca29-1656-4fd8-ac3b-1ffaa0897334', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10f385430>]}
[0m18:24:48.798765 [debug] [Thread-3  ]: Began running node model.bain_capital_analytics.int_trade_enriched
[0m18:24:48.799139 [debug] [Thread-1  ]: On model.bain_capital_analytics.fact_trade_activity: COMMIT
[0m18:24:48.799761 [info ] [Thread-3  ]: 21 of 28 START sql view model public.int_trade_enriched ........................ [RUN]
[0m18:24:48.800497 [debug] [Thread-2  ]: SQL status: COMMIT in 0.001 seconds
[0m18:24:48.800227 [info ] [Thread-4  ]: 18 of 28 OK created sql view model public.int_valuation_enriched ............... [[32mCREATE VIEW[0m in 0.08s]
[0m18:24:48.800930 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly model.bain_capital_analytics.int_irr_calculations, now model.bain_capital_analytics.int_trade_enriched)
[0m18:24:48.801253 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m18:24:48.851500 [debug] [Thread-2  ]: Applying DROP to: "bain_analytics"."public"."fact_cashflow_waterfall__dbt_backup"
[0m18:24:48.852036 [debug] [Thread-4  ]: Finished running node model.bain_capital_analytics.int_valuation_enriched
[0m18:24:48.852366 [debug] [Thread-3  ]: Began compiling node model.bain_capital_analytics.int_trade_enriched
[0m18:24:48.854609 [debug] [Thread-1  ]: Applying DROP to: "bain_analytics"."public"."fact_trade_activity__dbt_backup"
[0m18:24:48.855118 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.fact_cashflow_waterfall"
[0m18:24:48.855483 [debug] [Thread-4  ]: Began running node model.bain_capital_analytics.report_portfolio_overview
[0m18:24:48.859237 [debug] [Thread-3  ]: Writing injected SQL for node "model.bain_capital_analytics.int_trade_enriched"
[0m18:24:48.859791 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.fact_trade_activity"
[0m18:24:48.860121 [debug] [Thread-2  ]: On model.bain_capital_analytics.fact_cashflow_waterfall: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.fact_cashflow_waterfall"} */
drop view if exists "bain_analytics"."public"."fact_cashflow_waterfall__dbt_backup" cascade
[0m18:24:48.860546 [info ] [Thread-4  ]: 22 of 28 START sql view model public.report_portfolio_overview ................. [RUN]
[0m18:24:48.860998 [debug] [Thread-1  ]: On model.bain_capital_analytics.fact_trade_activity: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.fact_trade_activity"} */
drop view if exists "bain_analytics"."public"."fact_trade_activity__dbt_backup" cascade
[0m18:24:48.861461 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly model.bain_capital_analytics.int_valuation_enriched, now model.bain_capital_analytics.report_portfolio_overview)
[0m18:24:48.861858 [debug] [Thread-4  ]: Began compiling node model.bain_capital_analytics.report_portfolio_overview
[0m18:24:48.865104 [debug] [Thread-4  ]: Writing injected SQL for node "model.bain_capital_analytics.report_portfolio_overview"
[0m18:24:48.865462 [debug] [Thread-3  ]: Began executing node model.bain_capital_analytics.int_trade_enriched
[0m18:24:48.865782 [debug] [Thread-2  ]: SQL status: DROP VIEW in 0.004 seconds
[0m18:24:48.866109 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.004 seconds
[0m18:24:48.869573 [debug] [Thread-3  ]: Writing runtime sql for node "model.bain_capital_analytics.int_trade_enriched"
[0m18:24:48.870738 [debug] [Thread-2  ]: On model.bain_capital_analytics.fact_cashflow_waterfall: Close
[0m18:24:48.871768 [debug] [Thread-1  ]: On model.bain_capital_analytics.fact_trade_activity: Close
[0m18:24:48.872080 [debug] [Thread-4  ]: Began executing node model.bain_capital_analytics.report_portfolio_overview
[0m18:24:48.876663 [debug] [Thread-4  ]: Writing runtime sql for node "model.bain_capital_analytics.report_portfolio_overview"
[0m18:24:48.877302 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a133ca29-1656-4fd8-ac3b-1ffaa0897334', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10f5239d0>]}
[0m18:24:48.877600 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a133ca29-1656-4fd8-ac3b-1ffaa0897334', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10f1c6340>]}
[0m18:24:48.878122 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.int_trade_enriched"
[0m18:24:48.879314 [debug] [Thread-3  ]: On model.bain_capital_analytics.int_trade_enriched: BEGIN
[0m18:24:48.878970 [info ] [Thread-1  ]: 20 of 28 OK created sql view model public.fact_trade_activity .................. [[32mCREATE VIEW[0m in 0.15s]
[0m18:24:48.879818 [info ] [Thread-2  ]: 19 of 28 OK created sql view model public.fact_cashflow_waterfall .............. [[32mCREATE VIEW[0m in 0.15s]
[0m18:24:48.880172 [debug] [Thread-3  ]: Opening a new connection, currently in state closed
[0m18:24:48.880535 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.report_portfolio_overview"
[0m18:24:48.880970 [debug] [Thread-1  ]: Finished running node model.bain_capital_analytics.fact_trade_activity
[0m18:24:48.881383 [debug] [Thread-2  ]: Finished running node model.bain_capital_analytics.fact_cashflow_waterfall
[0m18:24:48.881800 [debug] [Thread-4  ]: On model.bain_capital_analytics.report_portfolio_overview: BEGIN
[0m18:24:48.882157 [debug] [Thread-1  ]: Began running node model.bain_capital_analytics.fact_portfolio_pnl
[0m18:24:48.882566 [debug] [Thread-2  ]: Began running node model.bain_capital_analytics.fact_portfolio_attribution
[0m18:24:48.882881 [debug] [Thread-4  ]: Opening a new connection, currently in state closed
[0m18:24:48.883276 [info ] [Thread-1  ]: 23 of 28 START sql view model public.fact_portfolio_pnl ........................ [RUN]
[0m18:24:48.883709 [info ] [Thread-2  ]: 24 of 28 START sql view model public.fact_portfolio_attribution ................ [RUN]
[0m18:24:48.884236 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.bain_capital_analytics.fact_trade_activity, now model.bain_capital_analytics.fact_portfolio_pnl)
[0m18:24:48.884595 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly model.bain_capital_analytics.fact_cashflow_waterfall, now model.bain_capital_analytics.fact_portfolio_attribution)
[0m18:24:48.884918 [debug] [Thread-1  ]: Began compiling node model.bain_capital_analytics.fact_portfolio_pnl
[0m18:24:48.885226 [debug] [Thread-2  ]: Began compiling node model.bain_capital_analytics.fact_portfolio_attribution
[0m18:24:48.889191 [debug] [Thread-1  ]: Writing injected SQL for node "model.bain_capital_analytics.fact_portfolio_pnl"
[0m18:24:48.892010 [debug] [Thread-2  ]: Writing injected SQL for node "model.bain_capital_analytics.fact_portfolio_attribution"
[0m18:24:48.892585 [debug] [Thread-2  ]: Began executing node model.bain_capital_analytics.fact_portfolio_attribution
[0m18:24:48.892895 [debug] [Thread-1  ]: Began executing node model.bain_capital_analytics.fact_portfolio_pnl
[0m18:24:48.896585 [debug] [Thread-2  ]: Writing runtime sql for node "model.bain_capital_analytics.fact_portfolio_attribution"
[0m18:24:48.897002 [debug] [Thread-3  ]: SQL status: BEGIN in 0.017 seconds
[0m18:24:48.900428 [debug] [Thread-1  ]: Writing runtime sql for node "model.bain_capital_analytics.fact_portfolio_pnl"
[0m18:24:48.900781 [debug] [Thread-4  ]: SQL status: BEGIN in 0.018 seconds
[0m18:24:48.901150 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.int_trade_enriched"
[0m18:24:48.901574 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.report_portfolio_overview"
[0m18:24:48.901936 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.fact_portfolio_attribution"
[0m18:24:48.902330 [debug] [Thread-3  ]: On model.bain_capital_analytics.int_trade_enriched: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.int_trade_enriched"} */

  create view "bain_analytics"."public"."int_trade_enriched__dbt_tmp"
    
    
  as (
    -- Pipeline B: Enriched trade data with instrument and counterparty details
-- Anti-pattern: subquery for dedup instead of QUALIFY (Snowflake)
-- Anti-pattern: heavy join that will be repeated in multiple downstream models

with latest_trades as (
    -- Anti-pattern: subquery to filter row_number instead of QUALIFY
    select *
    from (
        select
            t.*,
            i.instrument_name,
            i.instrument_type,
            i.sector,
            i.liquidity_class,
            c.counterparty_name,
            c.counterparty_type,
            c.credit_rating,
            p.portfolio_name,
            p.strategy,
            p.manager_name,
            -- Anti-pattern: duplicated fiscal quarter logic AGAIN
            case
                when extract(month from t.trade_date) between 1 and 3 then 'Q3'
                when extract(month from t.trade_date) between 4 and 6 then 'Q4'
                when extract(month from t.trade_date) between 7 and 9 then 'Q1'
                when extract(month from t.trade_date) between 10 and 12 then 'Q2'
            end as fiscal_quarter,
            row_number() over (
                partition by t.portfolio_id, t.instrument_id, t.trade_date
                order by t.trade_id desc
            ) as rn
        from "bain_analytics"."public"."stg_trades" t
        -- Anti-pattern: these 3 joins are repeated in fact_portfolio_pnl and fact_trade_activity
        inner join "bain_analytics"."public"."stg_instruments" i
            on t.instrument_id = i.instrument_id
        inner join "bain_analytics"."public"."stg_counterparties" c
            on t.counterparty_id = c.counterparty_id
        inner join "bain_analytics"."public"."stg_portfolios" p
            on t.portfolio_id = p.portfolio_id
    ) sub
    where rn = 1
)

select
    trade_id,
    portfolio_id,
    portfolio_name,
    strategy,
    manager_name,
    instrument_id,
    instrument_name,
    instrument_type,
    sector,
    liquidity_class,
    counterparty_id,
    counterparty_name,
    counterparty_type,
    credit_rating,
    trade_date,
    settlement_date,
    trade_type,
    quantity,
    price,
    notional_amount,
    commission,
    currency,
    fiscal_quarter,
    settlement_days,
    -- Anti-pattern: running total computed here AND again in downstream models
    sum(notional_amount) over (
        partition by portfolio_id
        order by trade_date
        rows between unbounded preceding and current row
    ) as cumulative_notional
from latest_trades
  );
[0m18:24:48.902812 [debug] [Thread-4  ]: On model.bain_capital_analytics.report_portfolio_overview: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.report_portfolio_overview"} */

  create view "bain_analytics"."public"."report_portfolio_overview__dbt_tmp"
    
    
  as (
    -- Pipeline A: REPORT table - Portfolio overview for management reporting
-- Anti-pattern: re-aggregates from fact instead of using fact directly in some cases
-- Anti-pattern: subquery instead of QUALIFY for latest date

select
    fps.portfolio_id,
    fps.portfolio_name,
    fps.strategy,
    fps.manager_name,
    fps.position_date as reporting_date,
    fps.num_positions,
    fps.total_market_value,
    fps.total_cost_basis,
    fps.total_unrealized_pnl,
    fps.portfolio_return_pct,
    fps.largest_position_mv,
    fps.smallest_position_mv,
    -- Anti-pattern: duplicated fiscal quarter logic AGAIN
    case
        when extract(month from fps.position_date) between 1 and 3 then 'Q3'
        when extract(month from fps.position_date) between 4 and 6 then 'Q4'
        when extract(month from fps.position_date) between 7 and 9 then 'Q1'
        when extract(month from fps.position_date) between 10 and 12 then 'Q2'
    end as fiscal_quarter,
    case
        when extract(month from fps.position_date) >= 7
        then extract(year from fps.position_date) + 1
        else extract(year from fps.position_date)
    end as fiscal_year
from "bain_analytics"."public"."fact_portfolio_summary" fps
where fps.position_date = (
    -- Anti-pattern: correlated subquery instead of window function / QUALIFY
    select max(fps2.position_date)
    from "bain_analytics"."public"."fact_portfolio_summary" fps2
    where fps2.portfolio_id = fps.portfolio_id
)
order by fps.total_market_value desc
  );
[0m18:24:48.903213 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.fact_portfolio_pnl"
[0m18:24:48.903497 [debug] [Thread-2  ]: On model.bain_capital_analytics.fact_portfolio_attribution: BEGIN
[0m18:24:48.903862 [debug] [Thread-1  ]: On model.bain_capital_analytics.fact_portfolio_pnl: BEGIN
[0m18:24:48.904154 [debug] [Thread-2  ]: Opening a new connection, currently in state closed
[0m18:24:48.904447 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m18:24:48.911396 [debug] [Thread-4  ]: SQL status: CREATE VIEW in 0.008 seconds
[0m18:24:48.914437 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.report_portfolio_overview"
[0m18:24:48.914786 [debug] [Thread-3  ]: SQL status: CREATE VIEW in 0.011 seconds
[0m18:24:48.915094 [debug] [Thread-4  ]: On model.bain_capital_analytics.report_portfolio_overview: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.report_portfolio_overview"} */
alter table "bain_analytics"."public"."report_portfolio_overview__dbt_tmp" rename to "report_portfolio_overview"
[0m18:24:48.918685 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.int_trade_enriched"
[0m18:24:48.919021 [debug] [Thread-2  ]: SQL status: BEGIN in 0.015 seconds
[0m18:24:48.919378 [debug] [Thread-3  ]: On model.bain_capital_analytics.int_trade_enriched: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.int_trade_enriched"} */
alter table "bain_analytics"."public"."int_trade_enriched__dbt_tmp" rename to "int_trade_enriched"
[0m18:24:48.919690 [debug] [Thread-1  ]: SQL status: BEGIN in 0.015 seconds
[0m18:24:48.919970 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.fact_portfolio_attribution"
[0m18:24:48.920259 [debug] [Thread-4  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:24:48.920573 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.fact_portfolio_pnl"
[0m18:24:48.920935 [debug] [Thread-2  ]: On model.bain_capital_analytics.fact_portfolio_attribution: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.fact_portfolio_attribution"} */

  create view "bain_analytics"."public"."fact_portfolio_attribution__dbt_tmp"
    
    
  as (
    -- Pipeline C: FACT table - Portfolio attribution with benchmark comparison
-- Anti-pattern: re-joins data that's already in intermediate models
-- Anti-pattern: repeated computation of sector weights

with attribution as (
    select
        pa.portfolio_id,
        pa.portfolio_name,
        pa.strategy,
        pa.fund_id,
        pa.position_date,
        pa.sector,
        pa.sector_mv,
        pa.sector_ugl,
        pa.num_instruments,
        pa.total_portfolio_mv,
        pa.total_portfolio_ugl,
        pa.sector_weight,
        pa.sector_contribution
    from "bain_analytics"."public"."int_portfolio_attribution" pa
),

-- Anti-pattern: re-joining benchmarks (could be done in intermediate)
attribution_with_benchmark as (
    select
        a.*,
        bm.benchmark_name,
        bm.return_mtd as benchmark_return,
        bm.rolling_3m_return as benchmark_3m_return,
        bm.rolling_12m_return as benchmark_12m_return
    from attribution a
    left join "bain_analytics"."public"."int_benchmark_returns" bm
        on a.position_date = bm.benchmark_date
        and bm.benchmark_id = 'BM_SP500'
),

-- Anti-pattern: computing alpha in yet another CTE
attribution_with_alpha as (
    select
        ab.*,
        -- Simplified active return
        case
            when ab.total_portfolio_mv != 0
            then (ab.sector_ugl / ab.total_portfolio_mv) - coalesce(ab.benchmark_return, 0) * ab.sector_weight
            else 0
        end as sector_active_return,
        -- Anti-pattern: re-computing portfolio-level return here
        case
            when ab.total_portfolio_mv != 0
            then ab.total_portfolio_ugl / ab.total_portfolio_mv
            else 0
        end as portfolio_return
    from attribution_with_benchmark ab
)

select * from attribution_with_alpha
  );
[0m18:24:48.922025 [debug] [Thread-4  ]: On model.bain_capital_analytics.report_portfolio_overview: COMMIT
[0m18:24:48.922333 [debug] [Thread-3  ]: SQL status: ALTER TABLE in 0.002 seconds
[0m18:24:48.922719 [debug] [Thread-1  ]: On model.bain_capital_analytics.fact_portfolio_pnl: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.fact_portfolio_pnl"} */

  create view "bain_analytics"."public"."fact_portfolio_pnl__dbt_tmp"
    
    
  as (
    -- Pipeline B: FACT table - Portfolio PnL by date
-- Anti-pattern: repeats the same heavy 3-table join as int_trade_enriched
-- Anti-pattern: late aggregation after expensive joins
-- Anti-pattern: materialized as view (should be table/incremental)

with trade_pnl as (
    -- Anti-pattern: re-joining trades to instruments and portfolios
    -- (same join already done in int_trade_enriched)
    select
        t.portfolio_id,
        t.trade_date,
        t.instrument_id,
        t.trade_type,
        t.notional_amount,
        t.commission,
        i.instrument_name,
        i.instrument_type,
        i.sector,
        p.portfolio_name,
        p.strategy,
        p.fund_id,
        d.fiscal_quarter,
        d.fiscal_year,
        d.is_month_end,
        d.is_quarter_end
    from "bain_analytics"."public"."stg_trades" t
    inner join "bain_analytics"."public"."stg_instruments" i
        on t.instrument_id = i.instrument_id
    inner join "bain_analytics"."public"."stg_portfolios" p
        on t.portfolio_id = p.portfolio_id
    inner join "bain_analytics"."public"."stg_dates" d
        on t.trade_date = d.date_day
),

position_pnl as (
    select
        dp.portfolio_id,
        dp.position_date,
        dp.portfolio_name,
        dp.strategy,
        dp.fund_id,
        dp.fiscal_quarter,
        dp.fiscal_year,
        sum(dp.daily_pnl) as position_daily_pnl,
        sum(dp.market_value) as total_market_value,
        count(distinct dp.instrument_id) as num_positions
    from "bain_analytics"."public"."int_daily_positions" dp
    group by
        dp.portfolio_id, dp.position_date, dp.portfolio_name,
        dp.strategy, dp.fund_id, dp.fiscal_quarter, dp.fiscal_year
),

-- Anti-pattern: aggregating trades separately then joining back
trade_activity as (
    select
        portfolio_id,
        trade_date,
        sum(notional_amount) as total_traded_notional,
        sum(commission) as total_commissions,
        count(*) as num_trades
    from trade_pnl
    group by portfolio_id, trade_date
)

select
    pp.portfolio_id,
    pp.portfolio_name,
    pp.strategy,
    pp.fund_id,
    pp.position_date as pnl_date,
    pp.fiscal_quarter,
    pp.fiscal_year,
    pp.position_daily_pnl,
    pp.total_market_value,
    pp.num_positions,
    coalesce(ta.total_traded_notional, 0) as total_traded_notional,
    coalesce(ta.total_commissions, 0) as total_commissions,
    coalesce(ta.num_trades, 0) as num_trades,
    -- Anti-pattern: running total recomputed here (already in int_trade_enriched)
    sum(pp.position_daily_pnl) over (
        partition by pp.portfolio_id
        order by pp.position_date
        rows between unbounded preceding and current row
    ) as cumulative_pnl
from position_pnl pp
left join trade_activity ta
    on pp.portfolio_id = ta.portfolio_id
    and pp.position_date = ta.trade_date
  );
[0m18:24:48.923161 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.report_portfolio_overview"
[0m18:24:48.924161 [debug] [Thread-3  ]: On model.bain_capital_analytics.int_trade_enriched: COMMIT
[0m18:24:48.924503 [debug] [Thread-4  ]: On model.bain_capital_analytics.report_portfolio_overview: COMMIT
[0m18:24:48.924804 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.int_trade_enriched"
[0m18:24:48.925133 [debug] [Thread-3  ]: On model.bain_capital_analytics.int_trade_enriched: COMMIT
[0m18:24:48.926157 [debug] [Thread-4  ]: SQL status: COMMIT in 0.001 seconds
[0m18:24:48.926451 [debug] [Thread-3  ]: SQL status: COMMIT in 0.001 seconds
[0m18:24:48.928563 [debug] [Thread-4  ]: Applying DROP to: "bain_analytics"."public"."report_portfolio_overview__dbt_backup"
[0m18:24:48.930849 [debug] [Thread-3  ]: Applying DROP to: "bain_analytics"."public"."int_trade_enriched__dbt_backup"
[0m18:24:48.931150 [debug] [Thread-2  ]: SQL status: CREATE VIEW in 0.008 seconds
[0m18:24:48.931424 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.007 seconds
[0m18:24:48.931900 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.report_portfolio_overview"
[0m18:24:48.932352 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.int_trade_enriched"
[0m18:24:48.935022 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.fact_portfolio_attribution"
[0m18:24:48.937583 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.fact_portfolio_pnl"
[0m18:24:48.937919 [debug] [Thread-4  ]: On model.bain_capital_analytics.report_portfolio_overview: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.report_portfolio_overview"} */
drop view if exists "bain_analytics"."public"."report_portfolio_overview__dbt_backup" cascade
[0m18:24:48.938246 [debug] [Thread-3  ]: On model.bain_capital_analytics.int_trade_enriched: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.int_trade_enriched"} */
drop view if exists "bain_analytics"."public"."int_trade_enriched__dbt_backup" cascade
[0m18:24:48.938574 [debug] [Thread-2  ]: On model.bain_capital_analytics.fact_portfolio_attribution: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.fact_portfolio_attribution"} */
alter table "bain_analytics"."public"."fact_portfolio_attribution__dbt_tmp" rename to "fact_portfolio_attribution"
[0m18:24:48.938890 [debug] [Thread-1  ]: On model.bain_capital_analytics.fact_portfolio_pnl: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.fact_portfolio_pnl"} */
alter table "bain_analytics"."public"."fact_portfolio_pnl__dbt_tmp" rename to "fact_portfolio_pnl"
[0m18:24:48.939942 [debug] [Thread-4  ]: SQL status: DROP VIEW in 0.001 seconds
[0m18:24:48.940243 [debug] [Thread-3  ]: SQL status: DROP VIEW in 0.001 seconds
[0m18:24:48.941231 [debug] [Thread-4  ]: On model.bain_capital_analytics.report_portfolio_overview: Close
[0m18:24:48.941524 [debug] [Thread-2  ]: SQL status: ALTER TABLE in 0.002 seconds
[0m18:24:48.941826 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.003 seconds
[0m18:24:48.942749 [debug] [Thread-3  ]: On model.bain_capital_analytics.int_trade_enriched: Close
[0m18:24:48.943250 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a133ca29-1656-4fd8-ac3b-1ffaa0897334', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10f530130>]}
[0m18:24:48.944160 [debug] [Thread-2  ]: On model.bain_capital_analytics.fact_portfolio_attribution: COMMIT
[0m18:24:48.945048 [debug] [Thread-1  ]: On model.bain_capital_analytics.fact_portfolio_pnl: COMMIT
[0m18:24:48.945562 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a133ca29-1656-4fd8-ac3b-1ffaa0897334', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10f4fa7f0>]}
[0m18:24:48.946006 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.fact_portfolio_attribution"
[0m18:24:48.946448 [info ] [Thread-4  ]: 22 of 28 OK created sql view model public.report_portfolio_overview ............ [[32mCREATE VIEW[0m in 0.08s]
[0m18:24:48.946791 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.fact_portfolio_pnl"
[0m18:24:48.947253 [info ] [Thread-3  ]: 21 of 28 OK created sql view model public.int_trade_enriched ................... [[32mCREATE VIEW[0m in 0.14s]
[0m18:24:48.947584 [debug] [Thread-2  ]: On model.bain_capital_analytics.fact_portfolio_attribution: COMMIT
[0m18:24:48.948013 [debug] [Thread-4  ]: Finished running node model.bain_capital_analytics.report_portfolio_overview
[0m18:24:48.948311 [debug] [Thread-1  ]: On model.bain_capital_analytics.fact_portfolio_pnl: COMMIT
[0m18:24:48.948706 [debug] [Thread-3  ]: Finished running node model.bain_capital_analytics.int_trade_enriched
[0m18:24:48.949072 [debug] [Thread-4  ]: Began running node model.bain_capital_analytics.fact_fund_performance
[0m18:24:48.949489 [debug] [Thread-3  ]: Began running node model.bain_capital_analytics.report_lp_quarterly
[0m18:24:48.950173 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m18:24:48.950482 [debug] [Thread-2  ]: SQL status: COMMIT in 0.001 seconds
[0m18:24:48.949921 [info ] [Thread-4  ]: 25 of 28 START sql view model public.fact_fund_performance ..................... [RUN]
[0m18:24:48.950945 [info ] [Thread-3  ]: 26 of 28 START sql view model public.report_lp_quarterly ....................... [RUN]
[0m18:24:48.954503 [debug] [Thread-1  ]: Applying DROP to: "bain_analytics"."public"."fact_portfolio_pnl__dbt_backup"
[0m18:24:48.956644 [debug] [Thread-2  ]: Applying DROP to: "bain_analytics"."public"."fact_portfolio_attribution__dbt_backup"
[0m18:24:48.957001 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly model.bain_capital_analytics.report_portfolio_overview, now model.bain_capital_analytics.fact_fund_performance)
[0m18:24:48.957328 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly model.bain_capital_analytics.int_trade_enriched, now model.bain_capital_analytics.report_lp_quarterly)
[0m18:24:48.957860 [debug] [Thread-1  ]: Using postgres connection "model.bain_capital_analytics.fact_portfolio_pnl"
[0m18:24:48.958312 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.fact_portfolio_attribution"
[0m18:24:48.958621 [debug] [Thread-4  ]: Began compiling node model.bain_capital_analytics.fact_fund_performance
[0m18:24:48.958919 [debug] [Thread-3  ]: Began compiling node model.bain_capital_analytics.report_lp_quarterly
[0m18:24:48.959222 [debug] [Thread-1  ]: On model.bain_capital_analytics.fact_portfolio_pnl: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.fact_portfolio_pnl"} */
drop view if exists "bain_analytics"."public"."fact_portfolio_pnl__dbt_backup" cascade
[0m18:24:48.959528 [debug] [Thread-2  ]: On model.bain_capital_analytics.fact_portfolio_attribution: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.fact_portfolio_attribution"} */
drop view if exists "bain_analytics"."public"."fact_portfolio_attribution__dbt_backup" cascade
[0m18:24:48.962970 [debug] [Thread-4  ]: Writing injected SQL for node "model.bain_capital_analytics.fact_fund_performance"
[0m18:24:48.966784 [debug] [Thread-3  ]: Writing injected SQL for node "model.bain_capital_analytics.report_lp_quarterly"
[0m18:24:48.967822 [debug] [Thread-3  ]: Began executing node model.bain_capital_analytics.report_lp_quarterly
[0m18:24:48.968161 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.001 seconds
[0m18:24:48.968455 [debug] [Thread-2  ]: SQL status: DROP VIEW in 0.001 seconds
[0m18:24:48.968738 [debug] [Thread-4  ]: Began executing node model.bain_capital_analytics.fact_fund_performance
[0m18:24:48.972259 [debug] [Thread-3  ]: Writing runtime sql for node "model.bain_capital_analytics.report_lp_quarterly"
[0m18:24:48.973323 [debug] [Thread-1  ]: On model.bain_capital_analytics.fact_portfolio_pnl: Close
[0m18:24:48.974299 [debug] [Thread-2  ]: On model.bain_capital_analytics.fact_portfolio_attribution: Close
[0m18:24:48.978924 [debug] [Thread-4  ]: Writing runtime sql for node "model.bain_capital_analytics.fact_fund_performance"
[0m18:24:48.979555 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a133ca29-1656-4fd8-ac3b-1ffaa0897334', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10f4cb040>]}
[0m18:24:48.980002 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a133ca29-1656-4fd8-ac3b-1ffaa0897334', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10f2639a0>]}
[0m18:24:48.981040 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.report_lp_quarterly"
[0m18:24:48.981369 [debug] [Thread-3  ]: On model.bain_capital_analytics.report_lp_quarterly: BEGIN
[0m18:24:48.981707 [debug] [Thread-3  ]: Opening a new connection, currently in state closed
[0m18:24:48.982272 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.fact_fund_performance"
[0m18:24:48.982613 [debug] [Thread-4  ]: On model.bain_capital_analytics.fact_fund_performance: BEGIN
[0m18:24:48.983013 [debug] [Thread-4  ]: Opening a new connection, currently in state closed
[0m18:24:48.992682 [debug] [Thread-4  ]: SQL status: BEGIN in 0.010 seconds
[0m18:24:48.993073 [debug] [Thread-3  ]: SQL status: BEGIN in 0.011 seconds
[0m18:24:48.993380 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.fact_fund_performance"
[0m18:24:48.993685 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.report_lp_quarterly"
[0m18:24:48.994087 [debug] [Thread-4  ]: On model.bain_capital_analytics.fact_fund_performance: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.fact_fund_performance"} */

  create view "bain_analytics"."public"."fact_fund_performance__dbt_tmp"
    
    
  as (
    -- Pipeline C: FACT table - Fund-level performance metrics
-- Anti-pattern: late aggregation - joins everything then aggregates
-- Anti-pattern: re-joins fund_structures (already in int_fund_nav, int_cashflow_enriched)
-- Anti-pattern: materialized as view (should be table)

with fund_nav_data as (
    select
        fn.fund_id,
        fn.fund_name,
        fn.fund_type,
        fn.committed_capital,
        fn.valuation_date,
        fn.fund_nav,
        fn.fund_gav,
        fn.fund_total_liabilities,
        fn.fund_unrealized_pnl,
        fn.fund_realized_pnl,
        fn.fund_nav_return,
        fn.tvpi_gross,
        fn.num_portfolios
    from "bain_analytics"."public"."int_fund_nav" fn
),

fund_cashflows as (
    -- Anti-pattern: re-aggregating cashflows that are already in int_cashflow_enriched
    select
        cf.fund_id,
        cf.cashflow_date,
        sum(case when cf.cashflow_type = 'capital_call' then cf.amount else 0 end) as period_calls,
        sum(case when cf.cashflow_type = 'distribution' then cf.amount else 0 end) as period_distributions,
        sum(case when cf.cashflow_type = 'management_fee' then cf.amount else 0 end) as period_fees,
        sum(cf.amount) as period_net_cashflow
    from "bain_analytics"."public"."stg_cashflows" cf
    group by cf.fund_id, cf.cashflow_date
),

fund_irr as (
    select
        irr.fund_id,
        sum(irr.total_invested) as fund_total_invested,
        sum(irr.total_distributed) as fund_total_distributed,
        sum(irr.terminal_value) as fund_terminal_value,
        -- Anti-pattern: averaging portfolio IRRs as proxy for fund IRR (incorrect but intentional)
        avg(irr.approx_irr) as fund_approx_irr,
        avg(irr.tvpi) as fund_tvpi,
        avg(irr.dpi) as fund_dpi
    from "bain_analytics"."public"."int_irr_calculations" irr
    group by irr.fund_id
),

-- Anti-pattern: joining everything together at the end
combined as (
    select
        fn.fund_id,
        fn.fund_name,
        fn.fund_type,
        fn.committed_capital,
        fn.valuation_date,
        fn.fund_nav,
        fn.fund_gav,
        fn.fund_total_liabilities,
        fn.fund_unrealized_pnl,
        fn.fund_realized_pnl,
        fn.fund_nav_return,
        fn.tvpi_gross,
        fn.num_portfolios,
        coalesce(fc.period_calls, 0) as period_calls,
        coalesce(fc.period_distributions, 0) as period_distributions,
        coalesce(fc.period_fees, 0) as period_fees,
        coalesce(fc.period_net_cashflow, 0) as period_net_cashflow,
        fi.fund_total_invested,
        fi.fund_total_distributed,
        fi.fund_approx_irr,
        fi.fund_tvpi,
        fi.fund_dpi
    from fund_nav_data fn
    left join fund_cashflows fc
        on fn.fund_id = fc.fund_id
        and fn.valuation_date = fc.cashflow_date
    left join fund_irr fi
        on fn.fund_id = fi.fund_id
)

select * from combined
  );
[0m18:24:48.994628 [debug] [Thread-3  ]: On model.bain_capital_analytics.report_lp_quarterly: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.report_lp_quarterly"} */

  create view "bain_analytics"."public"."report_lp_quarterly__dbt_tmp"
    
    
  as (
    -- Pipeline C: REPORT table - LP quarterly reporting
-- Anti-pattern: massive query, duplicated logic, no reuse of intermediates
-- Anti-pattern: PostgreSQL-specific date_trunc
-- Anti-pattern: re-aggregation of data already aggregated upstream

with quarterly_cashflows as (
    -- Anti-pattern: re-aggregating cashflows by quarter (already in int_cashflow_enriched)
    select
        cf.fund_id,
        cf.portfolio_id,
        -- Anti-pattern: PostgreSQL-specific date_trunc
        date_trunc('quarter', cf.cashflow_date) as quarter_start,
        cf.cashflow_fiscal_quarter as fiscal_quarter,
        cf.cashflow_year,
        sum(case when cf.cashflow_type = 'capital_call' then cf.amount else 0 end) as quarter_calls,
        sum(case when cf.cashflow_type = 'distribution' then cf.amount else 0 end) as quarter_distributions,
        sum(case when cf.cashflow_type = 'management_fee' then cf.amount else 0 end) as quarter_fees,
        sum(cf.amount) as quarter_net
    from "bain_analytics"."public"."stg_cashflows" cf
    group by
        cf.fund_id, cf.portfolio_id,
        date_trunc('quarter', cf.cashflow_date),
        cf.cashflow_fiscal_quarter, cf.cashflow_year
),

quarterly_valuations as (
    -- Anti-pattern: re-querying valuations with subquery for quarter-end
    select *
    from (
        select
            v.portfolio_id,
            v.valuation_date,
            v.net_asset_value,
            v.gross_asset_value,
            v.unrealized_pnl,
            v.realized_pnl,
            v.valuation_method,
            -- Anti-pattern: subquery dedup instead of QUALIFY
            row_number() over (
                partition by v.portfolio_id, date_trunc('quarter', v.valuation_date)
                order by v.valuation_date desc
            ) as rn
        from "bain_analytics"."public"."stg_valuations" v
    ) sub
    where rn = 1
),

-- Anti-pattern: re-joining fund structures (done in multiple places)
fund_details as (
    select
        fs.fund_id,
        fs.fund_name,
        fs.fund_type,
        fs.committed_capital,
        fs.management_fee_rate,
        fs.carry_rate,
        fs.hurdle_rate,
        fs.vintage_year,
        fs.gp_commitment_pct
    from "bain_analytics"."public"."stg_fund_structures" fs
),

-- Anti-pattern: joining everything at the end
lp_report as (
    select
        fd.fund_id,
        fd.fund_name,
        fd.fund_type,
        fd.vintage_year,
        fd.committed_capital,
        fd.management_fee_rate,
        fd.carry_rate,
        fd.hurdle_rate,
        fd.gp_commitment_pct,
        qc.portfolio_id,
        p.portfolio_name,
        p.strategy,
        qc.quarter_start,
        qc.fiscal_quarter,
        qc.cashflow_year,
        qc.quarter_calls,
        qc.quarter_distributions,
        qc.quarter_fees,
        qc.quarter_net,
        qv.net_asset_value as quarter_end_nav,
        qv.gross_asset_value as quarter_end_gav,
        qv.unrealized_pnl,
        qv.realized_pnl,
        qv.valuation_method,
        -- Anti-pattern: IRR re-joined from separate calculation
        irr.approx_irr,
        irr.tvpi,
        irr.dpi,
        irr.rvpi
    from quarterly_cashflows qc
    inner join fund_details fd
        on qc.fund_id = fd.fund_id
    inner join "bain_analytics"."public"."stg_portfolios" p
        on qc.portfolio_id = p.portfolio_id
    left join quarterly_valuations qv
        on qc.portfolio_id = qv.portfolio_id
        and date_trunc('quarter', qv.valuation_date) = qc.quarter_start
    left join "bain_analytics"."public"."int_irr_calculations" irr
        on qc.fund_id = irr.fund_id
        and qc.portfolio_id = irr.portfolio_id
)

select
    *,
    -- Anti-pattern: computed columns in final select
    case
        when committed_capital > 0
        then quarter_calls / committed_capital
        else 0
    end as quarterly_drawdown_rate,
    case
        when quarter_end_nav is not null and committed_capital > 0
        then quarter_end_nav / committed_capital
        else null
    end as nav_to_commitment_ratio
from lp_report
order by fund_id, portfolio_id, quarter_start
  );
[0m18:24:49.001694 [debug] [Thread-4  ]: SQL status: CREATE VIEW in 0.007 seconds
[0m18:24:49.004984 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.fact_fund_performance"
[0m18:24:49.005360 [debug] [Thread-3  ]: SQL status: CREATE VIEW in 0.010 seconds
[0m18:24:49.005711 [debug] [Thread-4  ]: On model.bain_capital_analytics.fact_fund_performance: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.fact_fund_performance"} */
alter table "bain_analytics"."public"."fact_fund_performance__dbt_tmp" rename to "fact_fund_performance"
[0m18:24:49.008518 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.report_lp_quarterly"
[0m18:24:49.008905 [debug] [Thread-3  ]: On model.bain_capital_analytics.report_lp_quarterly: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.report_lp_quarterly"} */
alter table "bain_analytics"."public"."report_lp_quarterly__dbt_tmp" rename to "report_lp_quarterly"
[0m18:24:49.010115 [debug] [Thread-4  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:24:49.010430 [debug] [Thread-3  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:24:49.011435 [debug] [Thread-4  ]: On model.bain_capital_analytics.fact_fund_performance: COMMIT
[0m18:24:49.012506 [debug] [Thread-3  ]: On model.bain_capital_analytics.report_lp_quarterly: COMMIT
[0m18:24:49.012826 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.fact_fund_performance"
[0m18:24:49.013129 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.report_lp_quarterly"
[0m18:24:49.013426 [debug] [Thread-4  ]: On model.bain_capital_analytics.fact_fund_performance: COMMIT
[0m18:24:49.013715 [debug] [Thread-3  ]: On model.bain_capital_analytics.report_lp_quarterly: COMMIT
[0m18:24:49.015043 [debug] [Thread-4  ]: SQL status: COMMIT in 0.001 seconds
[0m18:24:49.015346 [debug] [Thread-3  ]: SQL status: COMMIT in 0.001 seconds
[0m18:24:49.017590 [debug] [Thread-4  ]: Applying DROP to: "bain_analytics"."public"."fact_fund_performance__dbt_backup"
[0m18:24:49.019697 [debug] [Thread-3  ]: Applying DROP to: "bain_analytics"."public"."report_lp_quarterly__dbt_backup"
[0m18:24:49.020165 [debug] [Thread-4  ]: Using postgres connection "model.bain_capital_analytics.fact_fund_performance"
[0m18:24:49.020606 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.report_lp_quarterly"
[0m18:24:49.020910 [debug] [Thread-4  ]: On model.bain_capital_analytics.fact_fund_performance: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.fact_fund_performance"} */
drop view if exists "bain_analytics"."public"."fact_fund_performance__dbt_backup" cascade
[0m18:24:49.021216 [debug] [Thread-3  ]: On model.bain_capital_analytics.report_lp_quarterly: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.report_lp_quarterly"} */
drop view if exists "bain_analytics"."public"."report_lp_quarterly__dbt_backup" cascade
[0m18:24:49.022181 [debug] [Thread-4  ]: SQL status: DROP VIEW in 0.001 seconds
[0m18:24:49.022484 [debug] [Thread-3  ]: SQL status: DROP VIEW in 0.001 seconds
[0m18:24:49.023468 [debug] [Thread-4  ]: On model.bain_capital_analytics.fact_fund_performance: Close
[0m18:24:49.024406 [debug] [Thread-3  ]: On model.bain_capital_analytics.report_lp_quarterly: Close
[0m18:24:49.024928 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a133ca29-1656-4fd8-ac3b-1ffaa0897334', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10f1c4520>]}
[0m18:24:49.025443 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a133ca29-1656-4fd8-ac3b-1ffaa0897334', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10f268e80>]}
[0m18:24:50.224311 [debug] [Thread-1  ]: An error was encountered while trying to send an event
[0m18:24:50.224995 [info ] [Thread-2  ]: 24 of 28 OK created sql view model public.fact_portfolio_attribution ........... [[32mCREATE VIEW[0m in 0.10s]
[0m18:24:50.225510 [info ] [Thread-4  ]: 25 of 28 OK created sql view model public.fact_fund_performance ................ [[32mCREATE VIEW[0m in 0.07s]
[0m18:24:50.226113 [info ] [Thread-3  ]: 26 of 28 OK created sql view model public.report_lp_quarterly .................. [[32mCREATE VIEW[0m in 0.07s]
[0m18:24:50.227696 [debug] [Thread-2  ]: Finished running node model.bain_capital_analytics.fact_portfolio_attribution
[0m18:24:50.227134 [info ] [Thread-1  ]: 23 of 28 OK created sql view model public.fact_portfolio_pnl ................... [[32mCREATE VIEW[0m in 0.10s]
[0m18:24:50.228233 [debug] [Thread-4  ]: Finished running node model.bain_capital_analytics.fact_fund_performance
[0m18:24:50.228644 [debug] [Thread-3  ]: Finished running node model.bain_capital_analytics.report_lp_quarterly
[0m18:24:50.229242 [debug] [Thread-1  ]: Finished running node model.bain_capital_analytics.fact_portfolio_pnl
[0m18:24:50.229840 [debug] [Thread-2  ]: Began running node model.bain_capital_analytics.report_ic_dashboard
[0m18:24:50.230286 [debug] [Thread-3  ]: Began running node model.bain_capital_analytics.report_daily_pnl
[0m18:24:50.230673 [info ] [Thread-2  ]: 27 of 28 START sql view model public.report_ic_dashboard ....................... [RUN]
[0m18:24:50.231071 [info ] [Thread-3  ]: 28 of 28 START sql view model public.report_daily_pnl .......................... [RUN]
[0m18:24:50.231494 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly model.bain_capital_analytics.fact_portfolio_attribution, now model.bain_capital_analytics.report_ic_dashboard)
[0m18:24:50.231831 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly model.bain_capital_analytics.report_lp_quarterly, now model.bain_capital_analytics.report_daily_pnl)
[0m18:24:50.232136 [debug] [Thread-2  ]: Began compiling node model.bain_capital_analytics.report_ic_dashboard
[0m18:24:50.232425 [debug] [Thread-3  ]: Began compiling node model.bain_capital_analytics.report_daily_pnl
[0m18:24:50.236175 [debug] [Thread-2  ]: Writing injected SQL for node "model.bain_capital_analytics.report_ic_dashboard"
[0m18:24:50.240381 [debug] [Thread-3  ]: Writing injected SQL for node "model.bain_capital_analytics.report_daily_pnl"
[0m18:24:50.241090 [debug] [Thread-2  ]: Began executing node model.bain_capital_analytics.report_ic_dashboard
[0m18:24:50.241412 [debug] [Thread-3  ]: Began executing node model.bain_capital_analytics.report_daily_pnl
[0m18:24:50.244994 [debug] [Thread-2  ]: Writing runtime sql for node "model.bain_capital_analytics.report_ic_dashboard"
[0m18:24:50.248518 [debug] [Thread-3  ]: Writing runtime sql for node "model.bain_capital_analytics.report_daily_pnl"
[0m18:24:50.249182 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.report_daily_pnl"
[0m18:24:50.249503 [debug] [Thread-3  ]: On model.bain_capital_analytics.report_daily_pnl: BEGIN
[0m18:24:50.249835 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.report_ic_dashboard"
[0m18:24:50.250130 [debug] [Thread-3  ]: Opening a new connection, currently in state closed
[0m18:24:50.250426 [debug] [Thread-2  ]: On model.bain_capital_analytics.report_ic_dashboard: BEGIN
[0m18:24:50.250812 [debug] [Thread-2  ]: Opening a new connection, currently in state closed
[0m18:24:50.263115 [debug] [Thread-3  ]: SQL status: BEGIN in 0.013 seconds
[0m18:24:50.263470 [debug] [Thread-2  ]: SQL status: BEGIN in 0.013 seconds
[0m18:24:50.263814 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.report_daily_pnl"
[0m18:24:50.264135 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.report_ic_dashboard"
[0m18:24:50.264504 [debug] [Thread-3  ]: On model.bain_capital_analytics.report_daily_pnl: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.report_daily_pnl"} */

  create view "bain_analytics"."public"."report_daily_pnl__dbt_tmp"
    
    
  as (
    -- Pipeline B: REPORT table - Daily PnL report for portfolio managers
-- Anti-pattern: subquery for latest-only instead of QUALIFY
-- Anti-pattern: re-aggregation from fact that's already aggregated

with latest_pnl as (
    select *
    from (
        select
            fpnl.*,
            -- Anti-pattern: subquery dedup instead of QUALIFY
            row_number() over (
                partition by fpnl.portfolio_id
                order by fpnl.pnl_date desc
            ) as rn
        from "bain_analytics"."public"."fact_portfolio_pnl" fpnl
    ) sub
    where rn <= 5  -- last 5 dates per portfolio
),

-- Anti-pattern: re-joining to get benchmark data that should be part of the pipeline
pnl_with_benchmark as (
    select
        lp.*,
        bm.return_mtd as benchmark_return_mtd,
        bm.return_ytd as benchmark_return_ytd,
        bm.benchmark_name
    from latest_pnl lp
    left join "bain_analytics"."public"."stg_benchmarks" bm
        on lp.pnl_date = bm.benchmark_date
        and bm.benchmark_id = 'BM_SP500'
)

select
    portfolio_id,
    portfolio_name,
    strategy,
    pnl_date,
    fiscal_quarter,
    position_daily_pnl,
    cumulative_pnl,
    total_market_value,
    num_positions,
    total_traded_notional,
    total_commissions,
    num_trades,
    benchmark_name,
    benchmark_return_mtd,
    benchmark_return_ytd,
    -- Anti-pattern: computing return inline instead of upstream
    case
        when total_market_value != 0
        then position_daily_pnl / total_market_value
        else 0
    end as daily_return_pct
from pnl_with_benchmark
order by portfolio_id, pnl_date desc
  );
[0m18:24:50.264976 [debug] [Thread-2  ]: On model.bain_capital_analytics.report_ic_dashboard: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.report_ic_dashboard"} */

  create view "bain_analytics"."public"."report_ic_dashboard__dbt_tmp"
    
    
  as (
    -- Pipeline C: REPORT table - Investment Committee dashboard
-- Anti-pattern: massive query joining many sources, no intermediate reuse
-- Anti-pattern: subquery for latest records instead of QUALIFY
-- Anti-pattern: duplicated logic from other reports

with latest_fund_performance as (
    select *
    from (
        select
            fp.*,
            -- Anti-pattern: subquery dedup instead of QUALIFY
            row_number() over (
                partition by fp.fund_id
                order by fp.valuation_date desc
            ) as rn
        from "bain_analytics"."public"."fact_fund_performance" fp
    ) sub
    where rn = 1
),

latest_portfolio_summary as (
    select *
    from (
        select
            ps.*,
            row_number() over (
                partition by ps.portfolio_id
                order by ps.position_date desc
            ) as rn
        from "bain_analytics"."public"."fact_portfolio_summary" ps
    ) sub
    where rn = 1
),

-- Anti-pattern: re-joining fund structures (already in fact_fund_performance)
fund_overview as (
    select
        lfp.fund_id,
        lfp.fund_name,
        lfp.fund_type,
        lfp.committed_capital,
        lfp.valuation_date as latest_valuation_date,
        lfp.fund_nav,
        lfp.fund_gav,
        lfp.fund_nav_return as latest_nav_return,
        lfp.tvpi_gross,
        lfp.fund_approx_irr,
        lfp.fund_tvpi,
        lfp.fund_dpi,
        lfp.num_portfolios,
        lfp.fund_total_invested,
        lfp.fund_total_distributed,
        -- Anti-pattern: re-joining fund structures
        fs.management_fee_rate,
        fs.carry_rate,
        fs.hurdle_rate,
        fs.vintage_year
    from latest_fund_performance lfp
    inner join "bain_analytics"."public"."stg_fund_structures" fs
        on lfp.fund_id = fs.fund_id
),

portfolio_details as (
    select
        lps.portfolio_id,
        lps.portfolio_name,
        lps.strategy,
        lps.fund_id,
        lps.total_market_value,
        lps.total_unrealized_pnl,
        lps.portfolio_return_pct,
        lps.num_positions,
        -- Anti-pattern: re-computing fiscal quarter
        case
            when extract(month from lps.position_date) between 1 and 3 then 'Q3'
            when extract(month from lps.position_date) between 4 and 6 then 'Q4'
            when extract(month from lps.position_date) between 7 and 9 then 'Q1'
            when extract(month from lps.position_date) between 10 and 12 then 'Q2'
        end as reporting_fiscal_quarter
    from latest_portfolio_summary lps
)

select
    fo.fund_id,
    fo.fund_name,
    fo.fund_type,
    fo.vintage_year,
    fo.committed_capital,
    fo.latest_valuation_date,
    fo.fund_nav,
    fo.fund_gav,
    fo.latest_nav_return,
    fo.tvpi_gross,
    fo.fund_approx_irr,
    fo.fund_tvpi,
    fo.fund_dpi,
    fo.num_portfolios,
    fo.fund_total_invested,
    fo.fund_total_distributed,
    fo.management_fee_rate,
    fo.carry_rate,
    fo.hurdle_rate,
    pd.portfolio_id,
    pd.portfolio_name,
    pd.strategy,
    pd.total_market_value as portfolio_mv,
    pd.total_unrealized_pnl as portfolio_unrealized_pnl,
    pd.portfolio_return_pct,
    pd.num_positions as portfolio_num_positions,
    pd.reporting_fiscal_quarter
from fund_overview fo
inner join portfolio_details pd
    on fo.fund_id = pd.fund_id
order by fo.fund_nav desc, pd.total_market_value desc
  );
[0m18:24:50.273448 [debug] [Thread-3  ]: SQL status: CREATE VIEW in 0.008 seconds
[0m18:24:50.276407 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.report_daily_pnl"
[0m18:24:50.276741 [debug] [Thread-3  ]: On model.bain_capital_analytics.report_daily_pnl: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.report_daily_pnl"} */
alter table "bain_analytics"."public"."report_daily_pnl__dbt_tmp" rename to "report_daily_pnl"
[0m18:24:50.277060 [debug] [Thread-2  ]: SQL status: CREATE VIEW in 0.012 seconds
[0m18:24:50.279923 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.report_ic_dashboard"
[0m18:24:50.280294 [debug] [Thread-3  ]: SQL status: ALTER TABLE in 0.003 seconds
[0m18:24:50.280642 [debug] [Thread-2  ]: On model.bain_capital_analytics.report_ic_dashboard: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.report_ic_dashboard"} */
alter table "bain_analytics"."public"."report_ic_dashboard__dbt_tmp" rename to "report_ic_dashboard"
[0m18:24:50.281715 [debug] [Thread-3  ]: On model.bain_capital_analytics.report_daily_pnl: COMMIT
[0m18:24:50.282078 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.report_daily_pnl"
[0m18:24:50.282370 [debug] [Thread-3  ]: On model.bain_capital_analytics.report_daily_pnl: COMMIT
[0m18:24:50.283129 [debug] [Thread-2  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:24:50.284071 [debug] [Thread-2  ]: On model.bain_capital_analytics.report_ic_dashboard: COMMIT
[0m18:24:50.284376 [debug] [Thread-3  ]: SQL status: COMMIT in 0.002 seconds
[0m18:24:50.284660 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.report_ic_dashboard"
[0m18:24:50.287736 [debug] [Thread-3  ]: Applying DROP to: "bain_analytics"."public"."report_daily_pnl__dbt_backup"
[0m18:24:50.288042 [debug] [Thread-2  ]: On model.bain_capital_analytics.report_ic_dashboard: COMMIT
[0m18:24:50.288488 [debug] [Thread-3  ]: Using postgres connection "model.bain_capital_analytics.report_daily_pnl"
[0m18:24:50.288830 [debug] [Thread-3  ]: On model.bain_capital_analytics.report_daily_pnl: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.report_daily_pnl"} */
drop view if exists "bain_analytics"."public"."report_daily_pnl__dbt_backup" cascade
[0m18:24:50.289399 [debug] [Thread-2  ]: SQL status: COMMIT in 0.001 seconds
[0m18:24:50.289695 [debug] [Thread-3  ]: SQL status: DROP VIEW in 0.001 seconds
[0m18:24:50.291811 [debug] [Thread-2  ]: Applying DROP to: "bain_analytics"."public"."report_ic_dashboard__dbt_backup"
[0m18:24:50.292804 [debug] [Thread-3  ]: On model.bain_capital_analytics.report_daily_pnl: Close
[0m18:24:50.293264 [debug] [Thread-2  ]: Using postgres connection "model.bain_capital_analytics.report_ic_dashboard"
[0m18:24:50.293760 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a133ca29-1656-4fd8-ac3b-1ffaa0897334', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10f268e80>]}
[0m18:24:50.294063 [debug] [Thread-2  ]: On model.bain_capital_analytics.report_ic_dashboard: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "bain_capital_analytics", "target_name": "dev", "node_id": "model.bain_capital_analytics.report_ic_dashboard"} */
drop view if exists "bain_analytics"."public"."report_ic_dashboard__dbt_backup" cascade
[0m18:24:50.294620 [info ] [Thread-3  ]: 28 of 28 OK created sql view model public.report_daily_pnl ..................... [[32mCREATE VIEW[0m in 0.06s]
[0m18:24:50.294973 [debug] [Thread-2  ]: SQL status: DROP VIEW in 0.001 seconds
[0m18:24:50.295569 [debug] [Thread-3  ]: Finished running node model.bain_capital_analytics.report_daily_pnl
[0m18:24:50.296889 [debug] [Thread-2  ]: On model.bain_capital_analytics.report_ic_dashboard: Close
[0m18:24:50.297461 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a133ca29-1656-4fd8-ac3b-1ffaa0897334', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10f1c4520>]}
[0m18:24:50.297996 [info ] [Thread-2  ]: 27 of 28 OK created sql view model public.report_ic_dashboard .................. [[32mCREATE VIEW[0m in 0.07s]
[0m18:24:50.298452 [debug] [Thread-2  ]: Finished running node model.bain_capital_analytics.report_ic_dashboard
[0m18:24:50.299353 [debug] [MainThread]: Using postgres connection "master"
[0m18:24:50.299618 [debug] [MainThread]: On master: BEGIN
[0m18:24:50.299854 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m18:24:50.310695 [debug] [MainThread]: SQL status: BEGIN in 0.011 seconds
[0m18:24:50.310954 [debug] [MainThread]: On master: COMMIT
[0m18:24:50.311201 [debug] [MainThread]: Using postgres connection "master"
[0m18:24:50.311434 [debug] [MainThread]: On master: COMMIT
[0m18:24:50.311991 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m18:24:50.312279 [debug] [MainThread]: On master: Close
[0m18:24:50.312769 [debug] [MainThread]: Connection 'master' was properly closed.
[0m18:24:50.313046 [debug] [MainThread]: Connection 'model.bain_capital_analytics.fact_portfolio_pnl' was properly closed.
[0m18:24:50.313290 [debug] [MainThread]: Connection 'model.bain_capital_analytics.report_ic_dashboard' was properly closed.
[0m18:24:50.313520 [debug] [MainThread]: Connection 'model.bain_capital_analytics.report_daily_pnl' was properly closed.
[0m18:24:50.313744 [debug] [MainThread]: Connection 'model.bain_capital_analytics.fact_fund_performance' was properly closed.
[0m18:24:50.314116 [info ] [MainThread]: 
[0m18:24:50.314406 [info ] [MainThread]: Finished running 28 view models in 0 hours 0 minutes and 2.33 seconds (2.33s).
[0m18:24:50.317552 [debug] [MainThread]: Command end result
[0m18:24:50.358567 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/nedazarei/Documents/turintech/sample-dbt/postgres/target/manifest.json
[0m18:24:50.360328 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/nedazarei/Documents/turintech/sample-dbt/postgres/target/semantic_manifest.json
[0m18:24:50.367896 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/nedazarei/Documents/turintech/sample-dbt/postgres/target/run_results.json
[0m18:24:50.368194 [info ] [MainThread]: 
[0m18:24:50.368530 [info ] [MainThread]: [32mCompleted successfully[0m
[0m18:24:50.368820 [info ] [MainThread]: 
[0m18:24:50.369101 [info ] [MainThread]: Done. PASS=28 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=28
[0m18:24:50.371816 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 3.3290155, "process_in_blocks": "0", "process_kernel_time": 0.370414, "process_mem_max_rss": "141672448", "process_out_blocks": "0", "process_user_time": 3.118357}
[0m18:24:50.372179 [debug] [MainThread]: Command `dbt run` succeeded at 18:24:50.372113 after 3.33 seconds
[0m18:24:50.372493 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c9a11c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ec40880>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10df62c70>]}
[0m18:24:50.372819 [debug] [MainThread]: Flushing usage events
[0m18:24:51.200374 [debug] [MainThread]: An error was encountered while trying to flush usage events
