{"metadata": {"dbt_schema_version": "https://schemas.getdbt.com/dbt/run-results/v6.json", "dbt_version": "1.11.0b3", "generated_at": "2026-02-05T14:54:50.314638Z", "invocation_id": "a133ca29-1656-4fd8-ac3b-1ffaa0897334", "invocation_started_at": "2026-02-05T14:54:47.106433Z", "env": {}}, "results": [{"status": "success", "timing": [{"name": "compile", "started_at": "2026-02-05T14:54:48.184212Z", "completed_at": "2026-02-05T14:54:48.194678Z"}, {"name": "execute", "started_at": "2026-02-05T14:54:48.208205Z", "completed_at": "2026-02-05T14:54:48.334958Z"}], "thread_id": "Thread-2", "execution_time": 0.16220378875732422, "adapter_response": {"_message": "CREATE VIEW", "code": "CREATE VIEW", "rows_affected": -1}, "message": "CREATE VIEW", "failures": null, "unique_id": "model.bain_capital_analytics.stg_cashflows", "compiled": true, "compiled_code": "-- Anti-pattern: unnecessary DISTINCT\n-- Anti-pattern: duplicated fiscal quarter logic\nselect distinct\n    cashflow_id,\n    fund_id,\n    portfolio_id,\n    cast(cashflow_date as date) as cashflow_date,\n    cashflow_type,\n    cast(amount as numeric(18,2)) as amount,\n    currency,\n    description,\n    investor_id,\n    -- Anti-pattern: duplicated fiscal quarter logic (same as stg_trades, stg_portfolios)\n    case\n        when extract(month from cast(cashflow_date as date)) between 1 and 3 then 'Q3'\n        when extract(month from cast(cashflow_date as date)) between 4 and 6 then 'Q4'\n        when extract(month from cast(cashflow_date as date)) between 7 and 9 then 'Q1'\n        when extract(month from cast(cashflow_date as date)) between 10 and 12 then 'Q2'\n    end as cashflow_fiscal_quarter,\n    -- Anti-pattern: PostgreSQL-specific extract\n    extract(year from cast(cashflow_date as date)) as cashflow_year\nfrom \"bain_analytics\".\"public_raw\".\"raw_cashflows\"", "relation_name": "\"bain_analytics\".\"public\".\"stg_cashflows\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-02-05T14:54:48.191363Z", "completed_at": "2026-02-05T14:54:48.201547Z"}, {"name": "execute", "started_at": "2026-02-05T14:54:48.241928Z", "completed_at": "2026-02-05T14:54:48.335897Z"}], "thread_id": "Thread-4", "execution_time": 0.1629490852355957, "adapter_response": {"_message": "CREATE VIEW", "code": "CREATE VIEW", "rows_affected": -1}, "message": "CREATE VIEW", "failures": null, "unique_id": "model.bain_capital_analytics.stg_dates", "compiled": true, "compiled_code": "select\n    cast(date_day as date) as date_day,\n    cast(is_business_day as boolean) as is_business_day,\n    cast(is_month_end as boolean) as is_month_end,\n    cast(is_quarter_end as boolean) as is_quarter_end,\n    cast(is_year_end as boolean) as is_year_end,\n    fiscal_quarter,\n    fiscal_year,\n    -- Anti-pattern: PostgreSQL-specific date_trunc\n    date_trunc('month', cast(date_day as date)) as month_start,\n    date_trunc('quarter', cast(date_day as date)) as quarter_start,\n    extract(month from cast(date_day as date)) as calendar_month,\n    extract(year from cast(date_day as date)) as calendar_year\nfrom \"bain_analytics\".\"public_raw\".\"raw_dates\"", "relation_name": "\"bain_analytics\".\"public\".\"stg_dates\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-02-05T14:54:48.188859Z", "completed_at": "2026-02-05T14:54:48.194974Z"}, {"name": "execute", "started_at": "2026-02-05T14:54:48.238234Z", "completed_at": "2026-02-05T14:54:48.333937Z"}], "thread_id": "Thread-3", "execution_time": 0.16132521629333496, "adapter_response": {"_message": "CREATE VIEW", "code": "CREATE VIEW", "rows_affected": -1}, "message": "CREATE VIEW", "failures": null, "unique_id": "model.bain_capital_analytics.stg_counterparties", "compiled": true, "compiled_code": "select distinct\n    counterparty_id,\n    counterparty_name,\n    counterparty_type,\n    country,\n    credit_rating,\n    cast(is_active as boolean) as is_active\nfrom \"bain_analytics\".\"public_raw\".\"raw_counterparties\"\nwhere cast(is_active as boolean) = true", "relation_name": "\"bain_analytics\".\"public\".\"stg_counterparties\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-02-05T14:54:48.177909Z", "completed_at": "2026-02-05T14:54:48.194319Z"}, {"name": "execute", "started_at": "2026-02-05T14:54:48.195272Z", "completed_at": "2026-02-05T14:54:48.336828Z"}], "thread_id": "Thread-1", "execution_time": 0.16426491737365723, "adapter_response": {"_message": "CREATE VIEW", "code": "CREATE VIEW", "rows_affected": -1}, "message": "CREATE VIEW", "failures": null, "unique_id": "model.bain_capital_analytics.stg_benchmarks", "compiled": true, "compiled_code": "select distinct\n    benchmark_id,\n    benchmark_name,\n    cast(benchmark_date as date) as benchmark_date,\n    cast(return_daily as numeric(18,8)) as return_daily,\n    cast(return_mtd as numeric(18,8)) as return_mtd,\n    cast(return_ytd as numeric(18,8)) as return_ytd,\n    cast(benchmark_level as numeric(18,4)) as benchmark_level,\n    -- Anti-pattern: duplicated fiscal quarter logic\n    case\n        when extract(month from cast(benchmark_date as date)) between 1 and 3 then 'Q3'\n        when extract(month from cast(benchmark_date as date)) between 4 and 6 then 'Q4'\n        when extract(month from cast(benchmark_date as date)) between 7 and 9 then 'Q1'\n        when extract(month from cast(benchmark_date as date)) between 10 and 12 then 'Q2'\n    end as benchmark_fiscal_quarter\nfrom \"bain_analytics\".\"public_raw\".\"raw_benchmarks\"", "relation_name": "\"bain_analytics\".\"public\".\"stg_benchmarks\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-02-05T14:54:48.350471Z", "completed_at": "2026-02-05T14:54:48.408564Z"}, {"name": "execute", "started_at": "2026-02-05T14:54:48.412403Z", "completed_at": "2026-02-05T14:54:48.481372Z"}], "thread_id": "Thread-2", "execution_time": 0.13414406776428223, "adapter_response": {"_message": "CREATE VIEW", "code": "CREATE VIEW", "rows_affected": -1}, "message": "CREATE VIEW", "failures": null, "unique_id": "model.bain_capital_analytics.stg_fund_structures", "compiled": true, "compiled_code": "select distinct\n    fund_id,\n    fund_name,\n    fund_type,\n    cast(vintage_year as integer) as vintage_year,\n    cast(committed_capital as numeric(18,2)) as committed_capital,\n    cast(management_fee_rate as numeric(8,4)) as management_fee_rate,\n    cast(carry_rate as numeric(8,4)) as carry_rate,\n    cast(hurdle_rate as numeric(8,4)) as hurdle_rate,\n    cast(gp_commitment_pct as numeric(8,4)) as gp_commitment_pct,\n    fund_currency,\n    fund_status\nfrom \"bain_analytics\".\"public_raw\".\"raw_fund_structures\"", "relation_name": "\"bain_analytics\".\"public\".\"stg_fund_structures\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-02-05T14:54:48.356129Z", "completed_at": "2026-02-05T14:54:48.404693Z"}, {"name": "execute", "started_at": "2026-02-05T14:54:48.409150Z", "completed_at": "2026-02-05T14:54:48.484915Z"}], "thread_id": "Thread-3", "execution_time": 0.13872408866882324, "adapter_response": {"_message": "CREATE VIEW", "code": "CREATE VIEW", "rows_affected": -1}, "message": "CREATE VIEW", "failures": null, "unique_id": "model.bain_capital_analytics.stg_portfolios", "compiled": true, "compiled_code": "-- Anti-pattern: unnecessary DISTINCT when source data is already unique\n-- Anti-pattern: casting in every model instead of once upstream\n\nselect distinct\n    cast(portfolio_id as varchar(10)) as portfolio_id,\n    cast(portfolio_name as varchar(100)) as portfolio_name,\n    cast(strategy as varchar(50)) as strategy,\n    cast(inception_date as date) as inception_date,\n    cast(fund_id as varchar(10)) as fund_id,\n    cast(manager_name as varchar(100)) as manager_name,\n    cast(is_active as boolean) as is_active,\n    -- Anti-pattern: duplicated fiscal quarter logic (repeated in many models)\n    case\n        when extract(month from cast(inception_date as date)) between 1 and 3 then 'Q3'\n        when extract(month from cast(inception_date as date)) between 4 and 6 then 'Q4'\n        when extract(month from cast(inception_date as date)) between 7 and 9 then 'Q1'\n        when extract(month from cast(inception_date as date)) between 10 and 12 then 'Q2'\n    end as inception_fiscal_quarter\nfrom \"bain_analytics\".\"public_raw\".\"raw_portfolios\"\nwhere cast(is_active as boolean) = true", "relation_name": "\"bain_analytics\".\"public\".\"stg_portfolios\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-02-05T14:54:48.358679Z", "completed_at": "2026-02-05T14:54:48.408865Z"}, {"name": "execute", "started_at": "2026-02-05T14:54:48.415551Z", "completed_at": "2026-02-05T14:54:48.485875Z"}], "thread_id": "Thread-1", "execution_time": 0.13859009742736816, "adapter_response": {"_message": "CREATE VIEW", "code": "CREATE VIEW", "rows_affected": -1}, "message": "CREATE VIEW", "failures": null, "unique_id": "model.bain_capital_analytics.stg_positions", "compiled": true, "compiled_code": "-- Anti-pattern: unnecessary DISTINCT\n-- Anti-pattern: no filtering or partitioning strategy\n\nselect distinct\n    position_id,\n    portfolio_id,\n    instrument_id,\n    cast(position_date as date) as position_date,\n    cast(quantity as numeric(18,4)) as quantity,\n    cast(market_value as numeric(18,2)) as market_value,\n    cast(cost_basis as numeric(18,2)) as cost_basis,\n    currency,\n    -- Anti-pattern: computed column that could be done downstream\n    cast(market_value as numeric(18,2)) - cast(cost_basis as numeric(18,2)) as unrealized_gain_loss,\n    case\n        when cast(cost_basis as numeric(18,2)) != 0\n        then (cast(market_value as numeric(18,2)) - cast(cost_basis as numeric(18,2))) / abs(cast(cost_basis as numeric(18,2)))\n        else 0\n    end as unrealized_return_pct\nfrom \"bain_analytics\".\"public_raw\".\"raw_positions\"", "relation_name": "\"bain_analytics\".\"public\".\"stg_positions\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-02-05T14:54:48.353605Z", "completed_at": "2026-02-05T14:54:48.362732Z"}, {"name": "execute", "started_at": "2026-02-05T14:54:48.363075Z", "completed_at": "2026-02-05T14:54:48.486822Z"}], "thread_id": "Thread-4", "execution_time": 0.13999176025390625, "adapter_response": {"_message": "CREATE VIEW", "code": "CREATE VIEW", "rows_affected": -1}, "message": "CREATE VIEW", "failures": null, "unique_id": "model.bain_capital_analytics.stg_instruments", "compiled": true, "compiled_code": "-- Anti-pattern: unnecessary DISTINCT\nselect distinct\n    instrument_id,\n    instrument_name,\n    instrument_type,\n    sector,\n    currency,\n    exchange,\n    issuer,\n    cast(maturity_date as date) as maturity_date,\n    -- Anti-pattern: PostgreSQL-specific date subtraction\n    case\n        when maturity_date is not null\n        then cast(maturity_date as date) - current_date\n        else null\n    end as days_to_maturity,\n    case\n        when instrument_type in ('equity', 'futures') then 'liquid'\n        when instrument_type in ('corporate_bond', 'government_bond', 'sovereign_bond', 'leveraged_loan') then 'semi_liquid'\n        when instrument_type in ('private_equity', 'venture_capital', 'real_estate', 'real_estate_debt', 'infrastructure') then 'illiquid'\n        else 'other'\n    end as liquidity_class\nfrom \"bain_analytics\".\"public_raw\".\"raw_instruments\"", "relation_name": "\"bain_analytics\".\"public\".\"stg_instruments\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-02-05T14:54:48.500542Z", "completed_at": "2026-02-05T14:54:48.514764Z"}, {"name": "execute", "started_at": "2026-02-05T14:54:48.515101Z", "completed_at": "2026-02-05T14:54:48.592851Z"}], "thread_id": "Thread-3", "execution_time": 0.09545397758483887, "adapter_response": {"_message": "CREATE VIEW", "code": "CREATE VIEW", "rows_affected": -1}, "message": "CREATE VIEW", "failures": null, "unique_id": "model.bain_capital_analytics.stg_valuations", "compiled": true, "compiled_code": "-- Anti-pattern: unnecessary DISTINCT\nselect distinct\n    valuation_id,\n    portfolio_id,\n    cast(valuation_date as date) as valuation_date,\n    cast(gross_asset_value as numeric(18,2)) as gross_asset_value,\n    cast(net_asset_value as numeric(18,2)) as net_asset_value,\n    cast(total_liabilities as numeric(18,2)) as total_liabilities,\n    cast(unrealized_pnl as numeric(18,2)) as unrealized_pnl,\n    cast(realized_pnl as numeric(18,2)) as realized_pnl,\n    valuation_method,\n    -- Anti-pattern: duplicated fiscal quarter logic\n    case\n        when extract(month from cast(valuation_date as date)) between 1 and 3 then 'Q3'\n        when extract(month from cast(valuation_date as date)) between 4 and 6 then 'Q4'\n        when extract(month from cast(valuation_date as date)) between 7 and 9 then 'Q1'\n        when extract(month from cast(valuation_date as date)) between 10 and 12 then 'Q2'\n    end as valuation_fiscal_quarter\nfrom \"bain_analytics\".\"public_raw\".\"raw_valuations\"", "relation_name": "\"bain_analytics\".\"public\".\"stg_valuations\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-02-05T14:54:48.506528Z", "completed_at": "2026-02-05T14:54:48.518726Z"}, {"name": "execute", "started_at": "2026-02-05T14:54:48.522493Z", "completed_at": "2026-02-05T14:54:48.594906Z"}], "thread_id": "Thread-4", "execution_time": 0.0976099967956543, "adapter_response": {"_message": "CREATE VIEW", "code": "CREATE VIEW", "rows_affected": -1}, "message": "CREATE VIEW", "failures": null, "unique_id": "model.bain_capital_analytics.int_cashflow_enriched", "compiled": true, "compiled_code": "-- Pipeline C: Enriched cashflow data with fund and portfolio details\n-- Anti-pattern: subquery for dedup instead of QUALIFY\n-- Anti-pattern: joins repeated from other intermediate models\n\nwith cashflow_with_details as (\n    select *\n    from (\n        select\n            cf.*,\n            p.portfolio_name,\n            p.strategy,\n            p.manager_name,\n            fs.fund_name,\n            fs.fund_type,\n            fs.committed_capital,\n            fs.management_fee_rate,\n            fs.carry_rate,\n            fs.hurdle_rate,\n            -- Anti-pattern: subquery filter instead of QUALIFY\n            row_number() over (\n                partition by cf.cashflow_id\n                order by cf.cashflow_date desc\n            ) as rn\n        from \"bain_analytics\".\"public\".\"stg_cashflows\" cf\n        inner join \"bain_analytics\".\"public\".\"stg_portfolios\" p\n            on cf.portfolio_id = p.portfolio_id\n        inner join \"bain_analytics\".\"public\".\"stg_fund_structures\" fs\n            on cf.fund_id = fs.fund_id\n    ) sub\n    where rn = 1\n),\n\n-- Anti-pattern: running totals computed here AND again downstream\ncashflow_cumulative as (\n    select\n        *,\n        sum(case when cashflow_type = 'capital_call' then amount else 0 end) over (\n            partition by fund_id, portfolio_id\n            order by cashflow_date\n            rows between unbounded preceding and current row\n        ) as cumulative_called,\n        sum(case when cashflow_type = 'distribution' then amount else 0 end) over (\n            partition by fund_id, portfolio_id\n            order by cashflow_date\n            rows between unbounded preceding and current row\n        ) as cumulative_distributed,\n        sum(amount) over (\n            partition by fund_id, portfolio_id\n            order by cashflow_date\n            rows between unbounded preceding and current row\n        ) as cumulative_net_cashflow\n    from cashflow_with_details\n)\n\nselect\n    cashflow_id,\n    fund_id,\n    fund_name,\n    fund_type,\n    portfolio_id,\n    portfolio_name,\n    strategy,\n    manager_name,\n    cashflow_date,\n    cashflow_type,\n    amount,\n    currency,\n    description,\n    investor_id,\n    cashflow_fiscal_quarter,\n    cashflow_year,\n    committed_capital,\n    management_fee_rate,\n    carry_rate,\n    hurdle_rate,\n    cumulative_called,\n    cumulative_distributed,\n    cumulative_net_cashflow,\n    case\n        when committed_capital > 0\n        then cumulative_called / committed_capital\n        else 0\n    end as pct_called\nfrom cashflow_cumulative", "relation_name": "\"bain_analytics\".\"public\".\"int_cashflow_enriched\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-02-05T14:54:48.494030Z", "completed_at": "2026-02-05T14:54:48.503200Z"}, {"name": "execute", "started_at": "2026-02-05T14:54:48.511144Z", "completed_at": "2026-02-05T14:54:48.596202Z"}], "thread_id": "Thread-2", "execution_time": 0.1078028678894043, "adapter_response": {"_message": "CREATE VIEW", "code": "CREATE VIEW", "rows_affected": -1}, "message": "CREATE VIEW", "failures": null, "unique_id": "model.bain_capital_analytics.stg_trades", "compiled": true, "compiled_code": "-- Anti-pattern: unnecessary DISTINCT on already-unique trade_id\n-- Anti-pattern: heavy casting repeated everywhere\n\nselect distinct\n    trade_id,\n    portfolio_id,\n    instrument_id,\n    counterparty_id,\n    cast(trade_date as date) as trade_date,\n    cast(settlement_date as date) as settlement_date,\n    trade_type,\n    cast(quantity as numeric(18,4)) as quantity,\n    cast(price as numeric(18,6)) as price,\n    cast(notional_amount as numeric(18,2)) as notional_amount,\n    cast(commission as numeric(18,2)) as commission,\n    currency,\n    status,\n    -- Anti-pattern: duplicated fiscal quarter logic\n    case\n        when extract(month from cast(trade_date as date)) between 1 and 3 then 'Q3'\n        when extract(month from cast(trade_date as date)) between 4 and 6 then 'Q4'\n        when extract(month from cast(trade_date as date)) between 7 and 9 then 'Q1'\n        when extract(month from cast(trade_date as date)) between 10 and 12 then 'Q2'\n    end as trade_fiscal_quarter,\n    -- Anti-pattern: PostgreSQL-specific date arithmetic\n    cast(settlement_date as date) - cast(trade_date as date) as settlement_days\nfrom \"bain_analytics\".\"public_raw\".\"raw_trades\"\nwhere status = 'settled'", "relation_name": "\"bain_analytics\".\"public\".\"stg_trades\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-02-05T14:54:48.503505Z", "completed_at": "2026-02-05T14:54:48.518400Z"}, {"name": "execute", "started_at": "2026-02-05T14:54:48.519078Z", "completed_at": "2026-02-05T14:54:48.598310Z"}], "thread_id": "Thread-1", "execution_time": 0.10128474235534668, "adapter_response": {"_message": "CREATE VIEW", "code": "CREATE VIEW", "rows_affected": -1}, "message": "CREATE VIEW", "failures": null, "unique_id": "model.bain_capital_analytics.int_benchmark_returns", "compiled": true, "compiled_code": "-- Pipeline C: Benchmark returns with rolling calculations\n-- Anti-pattern: heavy window functions that could be pre-computed\n\nwith benchmark_base as (\n    select\n        b.benchmark_id,\n        b.benchmark_name,\n        b.benchmark_date,\n        b.return_daily,\n        b.return_mtd,\n        b.return_ytd,\n        b.benchmark_level,\n        b.benchmark_fiscal_quarter,\n        d.fiscal_year,\n        d.is_quarter_end,\n        d.is_year_end\n    from \"bain_analytics\".\"public\".\"stg_benchmarks\" b\n    inner join \"bain_analytics\".\"public\".\"stg_dates\" d\n        on b.benchmark_date = d.date_day\n),\n\n-- Anti-pattern: compute many overlapping windows\nbenchmark_with_rolling as (\n    select\n        bb.*,\n        -- rolling 3-month return\n        exp(sum(ln(1 + bb.return_mtd)) over (\n            partition by bb.benchmark_id\n            order by bb.benchmark_date\n            rows between 2 preceding and current row\n        )) - 1 as rolling_3m_return,\n        -- rolling 6-month return\n        exp(sum(ln(1 + bb.return_mtd)) over (\n            partition by bb.benchmark_id\n            order by bb.benchmark_date\n            rows between 5 preceding and current row\n        )) - 1 as rolling_6m_return,\n        -- rolling 12-month return\n        exp(sum(ln(1 + bb.return_mtd)) over (\n            partition by bb.benchmark_id\n            order by bb.benchmark_date\n            rows between 11 preceding and current row\n        )) - 1 as rolling_12m_return,\n        -- Anti-pattern: volatility via window (expensive)\n        stddev(bb.return_mtd) over (\n            partition by bb.benchmark_id\n            order by bb.benchmark_date\n            rows between 11 preceding and current row\n        ) as rolling_12m_volatility,\n        avg(bb.return_mtd) over (\n            partition by bb.benchmark_id\n            order by bb.benchmark_date\n            rows between 11 preceding and current row\n        ) as rolling_12m_avg_return,\n        lag(bb.benchmark_level) over (\n            partition by bb.benchmark_id\n            order by bb.benchmark_date\n        ) as prev_benchmark_level\n    from benchmark_base bb\n)\n\nselect * from benchmark_with_rolling", "relation_name": "\"bain_analytics\".\"public\".\"int_benchmark_returns\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-02-05T14:54:48.607334Z", "completed_at": "2026-02-05T14:54:48.623019Z"}, {"name": "execute", "started_at": "2026-02-05T14:54:48.623770Z", "completed_at": "2026-02-05T14:54:48.703448Z"}], "thread_id": "Thread-3", "execution_time": 0.10048675537109375, "adapter_response": {"_message": "CREATE VIEW", "code": "CREATE VIEW", "rows_affected": -1}, "message": "CREATE VIEW", "failures": null, "unique_id": "model.bain_capital_analytics.fact_portfolio_summary", "compiled": true, "compiled_code": "-- Pipeline A: FACT table - Portfolio summary with positions\n-- Anti-pattern: unnecessary DISTINCT on already-unique aggregation\n-- Anti-pattern: late filtering (filters at the end instead of upstream)\n-- Anti-pattern: materialized as view (should be table)\n\nselect distinct\n    p.portfolio_id,\n    p.portfolio_name,\n    p.strategy,\n    p.fund_id,\n    p.manager_name,\n    pos.position_date,\n    count(distinct pos.instrument_id) as num_positions,\n    sum(pos.market_value) as total_market_value,\n    sum(pos.cost_basis) as total_cost_basis,\n    sum(pos.unrealized_gain_loss) as total_unrealized_pnl,\n    case\n        when sum(pos.cost_basis) != 0\n        then sum(pos.unrealized_gain_loss) / abs(sum(pos.cost_basis))\n        else 0\n    end as portfolio_return_pct,\n    max(pos.market_value) as largest_position_mv,\n    min(pos.market_value) as smallest_position_mv\nfrom \"bain_analytics\".\"public\".\"stg_portfolios\" p\ninner join \"bain_analytics\".\"public\".\"stg_positions\" pos\n    on p.portfolio_id = pos.portfolio_id\n-- Anti-pattern: filter at the end instead of in staging\nwhere p.is_active = true\ngroup by\n    p.portfolio_id,\n    p.portfolio_name,\n    p.strategy,\n    p.fund_id,\n    p.manager_name,\n    pos.position_date", "relation_name": "\"bain_analytics\".\"public\".\"fact_portfolio_summary\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-02-05T14:54:48.611625Z", "completed_at": "2026-02-05T14:54:48.623485Z"}, {"name": "execute", "started_at": "2026-02-05T14:54:48.627122Z", "completed_at": "2026-02-05T14:54:48.707415Z"}], "thread_id": "Thread-4", "execution_time": 0.10234904289245605, "adapter_response": {"_message": "CREATE VIEW", "code": "CREATE VIEW", "rows_affected": -1}, "message": "CREATE VIEW", "failures": null, "unique_id": "model.bain_capital_analytics.int_daily_positions", "compiled": true, "compiled_code": "-- Pipeline B: Daily position snapshots with PnL calculations\n-- Anti-pattern: deep CTE nesting\n-- Anti-pattern: repeated joins to same dimension tables\n\nwith position_base as (\n    select\n        pos.position_id,\n        pos.portfolio_id,\n        pos.instrument_id,\n        pos.position_date,\n        pos.quantity,\n        pos.market_value,\n        pos.cost_basis,\n        pos.unrealized_gain_loss,\n        pos.unrealized_return_pct,\n        pos.currency\n    from \"bain_analytics\".\"public\".\"stg_positions\" pos\n),\n\n-- Anti-pattern: CTE level 2 - join instruments (same join as int_trade_enriched)\nposition_with_instruments as (\n    select\n        pb.*,\n        i.instrument_name,\n        i.instrument_type,\n        i.sector,\n        i.liquidity_class\n    from position_base pb\n    inner join \"bain_analytics\".\"public\".\"stg_instruments\" i\n        on pb.instrument_id = i.instrument_id\n),\n\n-- Anti-pattern: CTE level 3 - join portfolios (same join as int_trade_enriched)\nposition_with_portfolio as (\n    select\n        pwi.*,\n        p.portfolio_name,\n        p.strategy,\n        p.fund_id\n    from position_with_instruments pwi\n    inner join \"bain_analytics\".\"public\".\"stg_portfolios\" p\n        on pwi.portfolio_id = p.portfolio_id\n),\n\n-- Anti-pattern: CTE level 4 - join dates\nposition_with_dates as (\n    select\n        pwp.*,\n        d.is_business_day,\n        d.is_month_end,\n        d.is_quarter_end,\n        d.fiscal_quarter,\n        d.fiscal_year\n    from position_with_portfolio pwp\n    inner join \"bain_analytics\".\"public\".\"stg_dates\" d\n        on pwp.position_date = d.date_day\n),\n\n-- Anti-pattern: CTE level 5 - compute window functions\nposition_with_analytics as (\n    select\n        pwd.*,\n        -- Anti-pattern: multiple window functions on same partition\n        lag(pwd.market_value) over (\n            partition by pwd.portfolio_id, pwd.instrument_id\n            order by pwd.position_date\n        ) as prev_market_value,\n        pwd.market_value - coalesce(\n            lag(pwd.market_value) over (\n                partition by pwd.portfolio_id, pwd.instrument_id\n                order by pwd.position_date\n            ), pwd.cost_basis\n        ) as daily_pnl,\n        sum(pwd.market_value) over (\n            partition by pwd.portfolio_id, pwd.position_date\n        ) as portfolio_total_mv,\n        case\n            when sum(pwd.market_value) over (partition by pwd.portfolio_id, pwd.position_date) != 0\n            then pwd.market_value / sum(pwd.market_value) over (partition by pwd.portfolio_id, pwd.position_date)\n            else 0\n        end as weight_in_portfolio\n    from position_with_dates pwd\n)\n\nselect * from position_with_analytics", "relation_name": "\"bain_analytics\".\"public\".\"int_daily_positions\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-02-05T14:54:48.615381Z", "completed_at": "2026-02-05T14:54:48.630351Z"}, {"name": "execute", "started_at": "2026-02-05T14:54:48.631104Z", "completed_at": "2026-02-05T14:54:48.709859Z"}], "thread_id": "Thread-2", "execution_time": 0.10574007034301758, "adapter_response": {"_message": "CREATE VIEW", "code": "CREATE VIEW", "rows_affected": -1}, "message": "CREATE VIEW", "failures": null, "unique_id": "model.bain_capital_analytics.int_portfolio_attribution", "compiled": true, "compiled_code": "-- Pipeline C: Portfolio performance attribution by sector and instrument type\n-- Anti-pattern: deep CTE chain, repeated joins, late aggregation\n-- Anti-pattern: same position-instrument-portfolio joins as int_daily_positions\n\nwith positions_enriched as (\n    -- Anti-pattern: repeating the same 3-way join as int_daily_positions\n    select\n        pos.position_id,\n        pos.portfolio_id,\n        pos.instrument_id,\n        pos.position_date,\n        pos.quantity,\n        pos.market_value,\n        pos.cost_basis,\n        pos.unrealized_gain_loss,\n        i.instrument_name,\n        i.instrument_type,\n        i.sector,\n        p.portfolio_name,\n        p.strategy,\n        p.fund_id\n    from \"bain_analytics\".\"public\".\"stg_positions\" pos\n    inner join \"bain_analytics\".\"public\".\"stg_instruments\" i\n        on pos.instrument_id = i.instrument_id\n    inner join \"bain_analytics\".\"public\".\"stg_portfolios\" p\n        on pos.portfolio_id = p.portfolio_id\n),\n\n-- Anti-pattern: compute portfolio totals in a separate CTE instead of a single pass\nportfolio_totals as (\n    select\n        portfolio_id,\n        position_date,\n        sum(market_value) as total_portfolio_mv,\n        sum(unrealized_gain_loss) as total_portfolio_ugl\n    from positions_enriched\n    group by portfolio_id, position_date\n),\n\n-- Anti-pattern: sector aggregation in yet another CTE\nsector_attribution as (\n    select\n        pe.portfolio_id,\n        pe.portfolio_name,\n        pe.strategy,\n        pe.fund_id,\n        pe.position_date,\n        pe.sector,\n        sum(pe.market_value) as sector_mv,\n        sum(pe.unrealized_gain_loss) as sector_ugl,\n        count(distinct pe.instrument_id) as num_instruments\n    from positions_enriched pe\n    group by\n        pe.portfolio_id, pe.portfolio_name, pe.strategy,\n        pe.fund_id, pe.position_date, pe.sector\n),\n\n-- Anti-pattern: joining back to get weights instead of computing in one pass\nattribution_with_weights as (\n    select\n        sa.*,\n        pt.total_portfolio_mv,\n        pt.total_portfolio_ugl,\n        case\n            when pt.total_portfolio_mv != 0\n            then sa.sector_mv / pt.total_portfolio_mv\n            else 0\n        end as sector_weight,\n        case\n            when pt.total_portfolio_ugl != 0\n            then sa.sector_ugl / pt.total_portfolio_ugl\n            else 0\n        end as sector_contribution\n    from sector_attribution sa\n    inner join portfolio_totals pt\n        on sa.portfolio_id = pt.portfolio_id\n        and sa.position_date = pt.position_date\n)\n\nselect * from attribution_with_weights", "relation_name": "\"bain_analytics\".\"public\".\"int_portfolio_attribution\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-02-05T14:54:48.618598Z", "completed_at": "2026-02-05T14:54:48.630655Z"}, {"name": "execute", "started_at": "2026-02-05T14:54:48.634142Z", "completed_at": "2026-02-05T14:54:48.711849Z"}], "thread_id": "Thread-1", "execution_time": 0.10264825820922852, "adapter_response": {"_message": "CREATE VIEW", "code": "CREATE VIEW", "rows_affected": -1}, "message": "CREATE VIEW", "failures": null, "unique_id": "model.bain_capital_analytics.int_fund_nav", "compiled": true, "compiled_code": "-- Pipeline C: Fund-level NAV calculation from portfolio valuations\n-- Anti-pattern: late aggregation - joins everything then aggregates at the end\n-- Anti-pattern: repeated joins to fund_structures and portfolios\n\nwith portfolio_valuations as (\n    select\n        v.portfolio_id,\n        v.valuation_date,\n        v.net_asset_value,\n        v.gross_asset_value,\n        v.total_liabilities,\n        v.unrealized_pnl,\n        v.realized_pnl,\n        v.valuation_method,\n        p.fund_id,\n        p.portfolio_name,\n        p.strategy,\n        -- Anti-pattern: joining fund_structures again (already done in int_cashflow_enriched)\n        fs.fund_name,\n        fs.fund_type,\n        fs.committed_capital,\n        fs.management_fee_rate\n    from \"bain_analytics\".\"public\".\"stg_valuations\" v\n    inner join \"bain_analytics\".\"public\".\"stg_portfolios\" p\n        on v.portfolio_id = p.portfolio_id\n    inner join \"bain_analytics\".\"public\".\"stg_fund_structures\" fs\n        on p.fund_id = fs.fund_id\n),\n\n-- Anti-pattern: aggregation happens here at the end after all joins\nfund_level_nav as (\n    select\n        fund_id,\n        fund_name,\n        fund_type,\n        committed_capital,\n        management_fee_rate,\n        valuation_date,\n        sum(net_asset_value) as fund_nav,\n        sum(gross_asset_value) as fund_gav,\n        sum(total_liabilities) as fund_total_liabilities,\n        sum(unrealized_pnl) as fund_unrealized_pnl,\n        sum(realized_pnl) as fund_realized_pnl,\n        count(distinct portfolio_id) as num_portfolios\n    from portfolio_valuations\n    group by\n        fund_id, fund_name, fund_type, committed_capital,\n        management_fee_rate, valuation_date\n),\n\nfund_nav_with_changes as (\n    select\n        fn.*,\n        lag(fn.fund_nav) over (\n            partition by fn.fund_id order by fn.valuation_date\n        ) as prev_fund_nav,\n        case\n            when lag(fn.fund_nav) over (\n                partition by fn.fund_id order by fn.valuation_date\n            ) is not null\n            and lag(fn.fund_nav) over (\n                partition by fn.fund_id order by fn.valuation_date\n            ) != 0\n            then (fn.fund_nav - lag(fn.fund_nav) over (\n                partition by fn.fund_id order by fn.valuation_date\n            )) / lag(fn.fund_nav) over (\n                partition by fn.fund_id order by fn.valuation_date\n            )\n            else null\n        end as fund_nav_return,\n        fn.fund_nav / nullif(fn.committed_capital, 0) as tvpi_gross\n    from fund_level_nav fn\n)\n\nselect * from fund_nav_with_changes", "relation_name": "\"bain_analytics\".\"public\".\"int_fund_nav\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-02-05T14:54:48.716754Z", "completed_at": "2026-02-05T14:54:48.722968Z"}, {"name": "execute", "started_at": "2026-02-05T14:54:48.726969Z", "completed_at": "2026-02-05T14:54:48.791057Z"}], "thread_id": "Thread-3", "execution_time": 0.07827210426330566, "adapter_response": {"_message": "CREATE VIEW", "code": "CREATE VIEW", "rows_affected": -1}, "message": "CREATE VIEW", "failures": null, "unique_id": "model.bain_capital_analytics.int_irr_calculations", "compiled": true, "compiled_code": "-- Pipeline C: Approximate IRR calculation per fund/portfolio\n-- Anti-pattern: extremely deep CTE nesting (6 levels)\n-- Anti-pattern: PostgreSQL-specific date arithmetic\n-- Anti-pattern: complex logic that should be a macro\n\nwith cashflow_series as (\n    -- CTE level 1: get all cashflows with proper signs\n    select\n        cf.fund_id,\n        cf.portfolio_id,\n        cf.cashflow_date,\n        cf.cashflow_type,\n        case\n            when cf.cashflow_type = 'capital_call' then -1 * abs(cf.amount)\n            when cf.cashflow_type = 'distribution' then abs(cf.amount)\n            when cf.cashflow_type = 'management_fee' then -1 * abs(cf.amount)\n            else cf.amount\n        end as signed_amount\n    from \"bain_analytics\".\"public\".\"stg_cashflows\" cf\n),\n\nterminal_values as (\n    -- CTE level 2: get latest NAV as terminal cashflow\n    select\n        v.portfolio_id,\n        p.fund_id,\n        v.valuation_date as cashflow_date,\n        'terminal_value' as cashflow_type,\n        v.net_asset_value as signed_amount\n    from \"bain_analytics\".\"public\".\"stg_valuations\" v\n    inner join \"bain_analytics\".\"public\".\"stg_portfolios\" p\n        on v.portfolio_id = p.portfolio_id\n    where v.valuation_date = (\n        -- Anti-pattern: correlated subquery instead of window function\n        select max(v2.valuation_date)\n        from \"bain_analytics\".\"public\".\"stg_valuations\" v2\n        where v2.portfolio_id = v.portfolio_id\n    )\n),\n\nall_cashflows as (\n    -- CTE level 3: union cashflows and terminal values\n    select fund_id, portfolio_id, cashflow_date, cashflow_type, signed_amount\n    from cashflow_series\n    union all\n    select fund_id, portfolio_id, cashflow_date, cashflow_type, signed_amount\n    from terminal_values\n),\n\ncashflow_with_timing as (\n    -- CTE level 4: compute time fractions\n    -- Anti-pattern: PostgreSQL date subtraction\n    select\n        ac.*,\n        min(ac.cashflow_date) over (partition by ac.fund_id, ac.portfolio_id) as first_cf_date,\n        (ac.cashflow_date - min(ac.cashflow_date) over (partition by ac.fund_id, ac.portfolio_id))::numeric / 365.25 as year_fraction\n    from all_cashflows ac\n),\n\n-- CTE level 5: compute simple multiples as IRR proxy\nportfolio_multiples as (\n    select\n        fund_id,\n        portfolio_id,\n        min(cashflow_date) as first_cashflow_date,\n        max(cashflow_date) as last_cashflow_date,\n        -- Anti-pattern: PostgreSQL date subtraction\n        max(cashflow_date) - min(cashflow_date) as investment_days,\n        (max(cashflow_date) - min(cashflow_date))::numeric / 365.25 as investment_years,\n        sum(case when cashflow_type = 'capital_call' then abs(signed_amount) else 0 end) as total_invested,\n        sum(case when cashflow_type = 'distribution' then signed_amount else 0 end) as total_distributed,\n        sum(case when cashflow_type = 'terminal_value' then signed_amount else 0 end) as terminal_value,\n        sum(signed_amount) as net_cashflow\n    from cashflow_with_timing\n    group by fund_id, portfolio_id\n),\n\n-- CTE level 6: compute IRR approximation\nirr_approximation as (\n    select\n        pm.*,\n        case\n            when pm.total_invested > 0\n            then (pm.total_distributed + pm.terminal_value) / pm.total_invested\n            else null\n        end as tvpi,\n        case\n            when pm.total_invested > 0\n            then pm.total_distributed / pm.total_invested\n            else null\n        end as dpi,\n        case\n            when pm.total_invested > 0\n            then pm.terminal_value / pm.total_invested\n            else null\n        end as rvpi,\n        -- Simplified IRR approximation: (TVPI^(1/years)) - 1\n        case\n            when pm.total_invested > 0 and pm.investment_years > 0\n            then power(\n                (pm.total_distributed + pm.terminal_value) / pm.total_invested,\n                1.0 / pm.investment_years\n            ) - 1\n            else null\n        end as approx_irr\n    from portfolio_multiples pm\n)\n\nselect * from irr_approximation", "relation_name": "\"bain_analytics\".\"public\".\"int_irr_calculations\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-02-05T14:54:48.723672Z", "completed_at": "2026-02-05T14:54:48.731653Z"}, {"name": "execute", "started_at": "2026-02-05T14:54:48.739921Z", "completed_at": "2026-02-05T14:54:48.796858Z"}], "thread_id": "Thread-4", "execution_time": 0.07732582092285156, "adapter_response": {"_message": "CREATE VIEW", "code": "CREATE VIEW", "rows_affected": -1}, "message": "CREATE VIEW", "failures": null, "unique_id": "model.bain_capital_analytics.int_valuation_enriched", "compiled": true, "compiled_code": "-- Pipeline C: Enriched valuation data\n-- Anti-pattern: subquery for dedup instead of QUALIFY\n-- Anti-pattern: repeated portfolio join\n-- Anti-pattern: PostgreSQL-specific date functions\n\nwith valuation_ranked as (\n    select *\n    from (\n        select\n            v.*,\n            p.portfolio_name,\n            p.strategy,\n            p.fund_id,\n            p.manager_name,\n            -- Anti-pattern: subquery dedup instead of QUALIFY\n            row_number() over (\n                partition by v.portfolio_id, v.valuation_date\n                order by v.valuation_id desc\n            ) as rn\n        from \"bain_analytics\".\"public\".\"stg_valuations\" v\n        inner join \"bain_analytics\".\"public\".\"stg_portfolios\" p\n            on v.portfolio_id = p.portfolio_id\n    ) sub\n    where rn = 1\n),\n\nvaluation_with_changes as (\n    select\n        vr.*,\n        lag(vr.net_asset_value) over (\n            partition by vr.portfolio_id order by vr.valuation_date\n        ) as prev_nav,\n        case\n            when lag(vr.net_asset_value) over (\n                partition by vr.portfolio_id order by vr.valuation_date\n            ) is not null\n            and lag(vr.net_asset_value) over (\n                partition by vr.portfolio_id order by vr.valuation_date\n            ) != 0\n            then (vr.net_asset_value - lag(vr.net_asset_value) over (\n                partition by vr.portfolio_id order by vr.valuation_date\n            )) / lag(vr.net_asset_value) over (\n                partition by vr.portfolio_id order by vr.valuation_date\n            )\n            else null\n        end as nav_return_pct,\n        -- Anti-pattern: PostgreSQL date subtraction\n        vr.valuation_date - lag(vr.valuation_date) over (\n            partition by vr.portfolio_id order by vr.valuation_date\n        ) as days_between_valuations\n    from valuation_ranked vr\n)\n\nselect * from valuation_with_changes", "relation_name": "\"bain_analytics\".\"public\".\"int_valuation_enriched\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-02-05T14:54:48.736030Z", "completed_at": "2026-02-05T14:54:48.744978Z"}, {"name": "execute", "started_at": "2026-02-05T14:54:48.748940Z", "completed_at": "2026-02-05T14:54:48.871684Z"}], "thread_id": "Thread-1", "execution_time": 0.14667820930480957, "adapter_response": {"_message": "CREATE VIEW", "code": "CREATE VIEW", "rows_affected": -1}, "message": "CREATE VIEW", "failures": null, "unique_id": "model.bain_capital_analytics.fact_trade_activity", "compiled": true, "compiled_code": "-- Pipeline B: FACT table - Trade activity detail\n-- Anti-pattern: repeats the SAME 3-table join as fact_portfolio_pnl and int_trade_enriched\n-- Anti-pattern: could use int_trade_enriched but re-does everything\n\nselect\n    t.trade_id,\n    t.portfolio_id,\n    t.instrument_id,\n    t.counterparty_id,\n    t.trade_date,\n    t.settlement_date,\n    t.trade_type,\n    t.quantity,\n    t.price,\n    t.notional_amount,\n    t.commission,\n    t.currency,\n    t.settlement_days,\n    -- Anti-pattern: re-joining instruments (done in int_trade_enriched)\n    i.instrument_name,\n    i.instrument_type,\n    i.sector,\n    i.liquidity_class,\n    -- Anti-pattern: re-joining counterparties (done in int_trade_enriched)\n    c.counterparty_name,\n    c.counterparty_type,\n    c.credit_rating,\n    -- Anti-pattern: re-joining portfolios (done in int_trade_enriched)\n    p.portfolio_name,\n    p.strategy,\n    p.fund_id,\n    p.manager_name,\n    -- Anti-pattern: re-joining dates\n    d.fiscal_quarter,\n    d.fiscal_year,\n    d.is_month_end,\n    -- Anti-pattern: duplicated fiscal quarter logic\n    case\n        when extract(month from t.trade_date) between 1 and 3 then 'Q3'\n        when extract(month from t.trade_date) between 4 and 6 then 'Q4'\n        when extract(month from t.trade_date) between 7 and 9 then 'Q1'\n        when extract(month from t.trade_date) between 10 and 12 then 'Q2'\n    end as computed_fiscal_quarter,\n    -- Anti-pattern: window functions recomputed (already in int_trade_enriched)\n    sum(t.notional_amount) over (\n        partition by t.portfolio_id\n        order by t.trade_date\n        rows between unbounded preceding and current row\n    ) as running_notional,\n    count(*) over (\n        partition by t.portfolio_id, date_trunc('month', t.trade_date)\n    ) as monthly_trade_count,\n    sum(t.commission) over (\n        partition by t.portfolio_id, date_trunc('month', t.trade_date)\n    ) as monthly_commissions\nfrom \"bain_analytics\".\"public\".\"stg_trades\" t\ninner join \"bain_analytics\".\"public\".\"stg_instruments\" i\n    on t.instrument_id = i.instrument_id\ninner join \"bain_analytics\".\"public\".\"stg_counterparties\" c\n    on t.counterparty_id = c.counterparty_id\ninner join \"bain_analytics\".\"public\".\"stg_portfolios\" p\n    on t.portfolio_id = p.portfolio_id\ninner join \"bain_analytics\".\"public\".\"stg_dates\" d\n    on t.trade_date = d.date_day", "relation_name": "\"bain_analytics\".\"public\".\"fact_trade_activity\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-02-05T14:54:48.731991Z", "completed_at": "2026-02-05T14:54:48.744144Z"}, {"name": "execute", "started_at": "2026-02-05T14:54:48.745275Z", "completed_at": "2026-02-05T14:54:48.870640Z"}], "thread_id": "Thread-2", "execution_time": 0.15038323402404785, "adapter_response": {"_message": "CREATE VIEW", "code": "CREATE VIEW", "rows_affected": -1}, "message": "CREATE VIEW", "failures": null, "unique_id": "model.bain_capital_analytics.fact_cashflow_waterfall", "compiled": true, "compiled_code": "-- Pipeline C: FACT table - Cashflow waterfall for PE/fund reporting\n-- Anti-pattern: deep CTEs, repeated joins, late aggregation\n-- Anti-pattern: PostgreSQL-specific date functions\n\nwith enriched_cashflows as (\n    select\n        ce.cashflow_id,\n        ce.fund_id,\n        ce.fund_name,\n        ce.fund_type,\n        ce.portfolio_id,\n        ce.portfolio_name,\n        ce.cashflow_date,\n        ce.cashflow_type,\n        ce.amount,\n        ce.investor_id,\n        ce.committed_capital,\n        ce.management_fee_rate,\n        ce.carry_rate,\n        ce.hurdle_rate,\n        ce.cumulative_called,\n        ce.cumulative_distributed,\n        ce.cumulative_net_cashflow,\n        ce.pct_called,\n        -- Anti-pattern: duplicated fiscal quarter logic\n        case\n            when extract(month from ce.cashflow_date) between 1 and 3 then 'Q3'\n            when extract(month from ce.cashflow_date) between 4 and 6 then 'Q4'\n            when extract(month from ce.cashflow_date) between 7 and 9 then 'Q1'\n            when extract(month from ce.cashflow_date) between 10 and 12 then 'Q2'\n        end as fiscal_quarter,\n        -- Anti-pattern: PostgreSQL extract\n        extract(year from ce.cashflow_date) as calendar_year\n    from \"bain_analytics\".\"public\".\"int_cashflow_enriched\" ce\n),\n\n-- Anti-pattern: re-joining valuations when int_valuation_enriched already has this\nwaterfall_with_nav as (\n    select\n        ecf.*,\n        v.net_asset_value,\n        v.gross_asset_value,\n        v.unrealized_pnl as nav_unrealized_pnl,\n        v.realized_pnl as nav_realized_pnl\n    from enriched_cashflows ecf\n    left join \"bain_analytics\".\"public\".\"stg_valuations\" v\n        on ecf.portfolio_id = v.portfolio_id\n        and ecf.cashflow_date = v.valuation_date\n),\n\n-- Anti-pattern: computing carry/waterfall in a CTE chain instead of a macro\nwaterfall_calculations as (\n    select\n        wn.*,\n        -- Simplified carry calculation\n        case\n            when wn.cumulative_distributed > wn.cumulative_called * (1 + wn.hurdle_rate)\n            then (wn.cumulative_distributed - wn.cumulative_called * (1 + wn.hurdle_rate)) * wn.carry_rate\n            else 0\n        end as estimated_carry,\n        wn.cumulative_called * wn.management_fee_rate as annual_mgmt_fee,\n        case\n            when wn.cumulative_called > 0\n            then wn.cumulative_distributed / wn.cumulative_called\n            else 0\n        end as dpi,\n        case\n            when wn.cumulative_called > 0 and wn.net_asset_value is not null\n            then (wn.cumulative_distributed + wn.net_asset_value) / wn.cumulative_called\n            else null\n        end as tvpi\n    from waterfall_with_nav wn\n)\n\nselect * from waterfall_calculations", "relation_name": "\"bain_analytics\".\"public\".\"fact_cashflow_waterfall\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-02-05T14:54:48.862106Z", "completed_at": "2026-02-05T14:54:48.871989Z"}, {"name": "execute", "started_at": "2026-02-05T14:54:48.872451Z", "completed_at": "2026-02-05T14:54:48.941135Z"}], "thread_id": "Thread-4", "execution_time": 0.08178472518920898, "adapter_response": {"_message": "CREATE VIEW", "code": "CREATE VIEW", "rows_affected": -1}, "message": "CREATE VIEW", "failures": null, "unique_id": "model.bain_capital_analytics.report_portfolio_overview", "compiled": true, "compiled_code": "-- Pipeline A: REPORT table - Portfolio overview for management reporting\n-- Anti-pattern: re-aggregates from fact instead of using fact directly in some cases\n-- Anti-pattern: subquery instead of QUALIFY for latest date\n\nselect\n    fps.portfolio_id,\n    fps.portfolio_name,\n    fps.strategy,\n    fps.manager_name,\n    fps.position_date as reporting_date,\n    fps.num_positions,\n    fps.total_market_value,\n    fps.total_cost_basis,\n    fps.total_unrealized_pnl,\n    fps.portfolio_return_pct,\n    fps.largest_position_mv,\n    fps.smallest_position_mv,\n    -- Anti-pattern: duplicated fiscal quarter logic AGAIN\n    case\n        when extract(month from fps.position_date) between 1 and 3 then 'Q3'\n        when extract(month from fps.position_date) between 4 and 6 then 'Q4'\n        when extract(month from fps.position_date) between 7 and 9 then 'Q1'\n        when extract(month from fps.position_date) between 10 and 12 then 'Q2'\n    end as fiscal_quarter,\n    case\n        when extract(month from fps.position_date) >= 7\n        then extract(year from fps.position_date) + 1\n        else extract(year from fps.position_date)\n    end as fiscal_year\nfrom \"bain_analytics\".\"public\".\"fact_portfolio_summary\" fps\nwhere fps.position_date = (\n    -- Anti-pattern: correlated subquery instead of window function / QUALIFY\n    select max(fps2.position_date)\n    from \"bain_analytics\".\"public\".\"fact_portfolio_summary\" fps2\n    where fps2.portfolio_id = fps.portfolio_id\n)\norder by fps.total_market_value desc", "relation_name": "\"bain_analytics\".\"public\".\"report_portfolio_overview\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-02-05T14:54:48.855754Z", "completed_at": "2026-02-05T14:54:48.865364Z"}, {"name": "execute", "started_at": "2026-02-05T14:54:48.866336Z", "completed_at": "2026-02-05T14:54:48.942666Z"}], "thread_id": "Thread-3", "execution_time": 0.1445779800415039, "adapter_response": {"_message": "CREATE VIEW", "code": "CREATE VIEW", "rows_affected": -1}, "message": "CREATE VIEW", "failures": null, "unique_id": "model.bain_capital_analytics.int_trade_enriched", "compiled": true, "compiled_code": "-- Pipeline B: Enriched trade data with instrument and counterparty details\n-- Anti-pattern: subquery for dedup instead of QUALIFY (Snowflake)\n-- Anti-pattern: heavy join that will be repeated in multiple downstream models\n\nwith latest_trades as (\n    -- Anti-pattern: subquery to filter row_number instead of QUALIFY\n    select *\n    from (\n        select\n            t.*,\n            i.instrument_name,\n            i.instrument_type,\n            i.sector,\n            i.liquidity_class,\n            c.counterparty_name,\n            c.counterparty_type,\n            c.credit_rating,\n            p.portfolio_name,\n            p.strategy,\n            p.manager_name,\n            -- Anti-pattern: duplicated fiscal quarter logic AGAIN\n            case\n                when extract(month from t.trade_date) between 1 and 3 then 'Q3'\n                when extract(month from t.trade_date) between 4 and 6 then 'Q4'\n                when extract(month from t.trade_date) between 7 and 9 then 'Q1'\n                when extract(month from t.trade_date) between 10 and 12 then 'Q2'\n            end as fiscal_quarter,\n            row_number() over (\n                partition by t.portfolio_id, t.instrument_id, t.trade_date\n                order by t.trade_id desc\n            ) as rn\n        from \"bain_analytics\".\"public\".\"stg_trades\" t\n        -- Anti-pattern: these 3 joins are repeated in fact_portfolio_pnl and fact_trade_activity\n        inner join \"bain_analytics\".\"public\".\"stg_instruments\" i\n            on t.instrument_id = i.instrument_id\n        inner join \"bain_analytics\".\"public\".\"stg_counterparties\" c\n            on t.counterparty_id = c.counterparty_id\n        inner join \"bain_analytics\".\"public\".\"stg_portfolios\" p\n            on t.portfolio_id = p.portfolio_id\n    ) sub\n    where rn = 1\n)\n\nselect\n    trade_id,\n    portfolio_id,\n    portfolio_name,\n    strategy,\n    manager_name,\n    instrument_id,\n    instrument_name,\n    instrument_type,\n    sector,\n    liquidity_class,\n    counterparty_id,\n    counterparty_name,\n    counterparty_type,\n    credit_rating,\n    trade_date,\n    settlement_date,\n    trade_type,\n    quantity,\n    price,\n    notional_amount,\n    commission,\n    currency,\n    fiscal_quarter,\n    settlement_days,\n    -- Anti-pattern: running total computed here AND again in downstream models\n    sum(notional_amount) over (\n        partition by portfolio_id\n        order by trade_date\n        rows between unbounded preceding and current row\n    ) as cumulative_notional\nfrom latest_trades", "relation_name": "\"bain_analytics\".\"public\".\"int_trade_enriched\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-02-05T14:54:48.889427Z", "completed_at": "2026-02-05T14:54:48.892490Z"}, {"name": "execute", "started_at": "2026-02-05T14:54:48.893128Z", "completed_at": "2026-02-05T14:54:48.974210Z"}], "thread_id": "Thread-2", "execution_time": 0.09539508819580078, "adapter_response": {"_message": "CREATE VIEW", "code": "CREATE VIEW", "rows_affected": -1}, "message": "CREATE VIEW", "failures": null, "unique_id": "model.bain_capital_analytics.fact_portfolio_attribution", "compiled": true, "compiled_code": "-- Pipeline C: FACT table - Portfolio attribution with benchmark comparison\n-- Anti-pattern: re-joins data that's already in intermediate models\n-- Anti-pattern: repeated computation of sector weights\n\nwith attribution as (\n    select\n        pa.portfolio_id,\n        pa.portfolio_name,\n        pa.strategy,\n        pa.fund_id,\n        pa.position_date,\n        pa.sector,\n        pa.sector_mv,\n        pa.sector_ugl,\n        pa.num_instruments,\n        pa.total_portfolio_mv,\n        pa.total_portfolio_ugl,\n        pa.sector_weight,\n        pa.sector_contribution\n    from \"bain_analytics\".\"public\".\"int_portfolio_attribution\" pa\n),\n\n-- Anti-pattern: re-joining benchmarks (could be done in intermediate)\nattribution_with_benchmark as (\n    select\n        a.*,\n        bm.benchmark_name,\n        bm.return_mtd as benchmark_return,\n        bm.rolling_3m_return as benchmark_3m_return,\n        bm.rolling_12m_return as benchmark_12m_return\n    from attribution a\n    left join \"bain_analytics\".\"public\".\"int_benchmark_returns\" bm\n        on a.position_date = bm.benchmark_date\n        and bm.benchmark_id = 'BM_SP500'\n),\n\n-- Anti-pattern: computing alpha in yet another CTE\nattribution_with_alpha as (\n    select\n        ab.*,\n        -- Simplified active return\n        case\n            when ab.total_portfolio_mv != 0\n            then (ab.sector_ugl / ab.total_portfolio_mv) - coalesce(ab.benchmark_return, 0) * ab.sector_weight\n            else 0\n        end as sector_active_return,\n        -- Anti-pattern: re-computing portfolio-level return here\n        case\n            when ab.total_portfolio_mv != 0\n            then ab.total_portfolio_ugl / ab.total_portfolio_mv\n            else 0\n        end as portfolio_return\n    from attribution_with_benchmark ab\n)\n\nselect * from attribution_with_alpha", "relation_name": "\"bain_analytics\".\"public\".\"fact_portfolio_attribution\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-02-05T14:54:48.959755Z", "completed_at": "2026-02-05T14:54:48.968656Z"}, {"name": "execute", "started_at": "2026-02-05T14:54:48.974527Z", "completed_at": "2026-02-05T14:54:49.023371Z"}], "thread_id": "Thread-4", "execution_time": 0.06786513328552246, "adapter_response": {"_message": "CREATE VIEW", "code": "CREATE VIEW", "rows_affected": -1}, "message": "CREATE VIEW", "failures": null, "unique_id": "model.bain_capital_analytics.fact_fund_performance", "compiled": true, "compiled_code": "-- Pipeline C: FACT table - Fund-level performance metrics\n-- Anti-pattern: late aggregation - joins everything then aggregates\n-- Anti-pattern: re-joins fund_structures (already in int_fund_nav, int_cashflow_enriched)\n-- Anti-pattern: materialized as view (should be table)\n\nwith fund_nav_data as (\n    select\n        fn.fund_id,\n        fn.fund_name,\n        fn.fund_type,\n        fn.committed_capital,\n        fn.valuation_date,\n        fn.fund_nav,\n        fn.fund_gav,\n        fn.fund_total_liabilities,\n        fn.fund_unrealized_pnl,\n        fn.fund_realized_pnl,\n        fn.fund_nav_return,\n        fn.tvpi_gross,\n        fn.num_portfolios\n    from \"bain_analytics\".\"public\".\"int_fund_nav\" fn\n),\n\nfund_cashflows as (\n    -- Anti-pattern: re-aggregating cashflows that are already in int_cashflow_enriched\n    select\n        cf.fund_id,\n        cf.cashflow_date,\n        sum(case when cf.cashflow_type = 'capital_call' then cf.amount else 0 end) as period_calls,\n        sum(case when cf.cashflow_type = 'distribution' then cf.amount else 0 end) as period_distributions,\n        sum(case when cf.cashflow_type = 'management_fee' then cf.amount else 0 end) as period_fees,\n        sum(cf.amount) as period_net_cashflow\n    from \"bain_analytics\".\"public\".\"stg_cashflows\" cf\n    group by cf.fund_id, cf.cashflow_date\n),\n\nfund_irr as (\n    select\n        irr.fund_id,\n        sum(irr.total_invested) as fund_total_invested,\n        sum(irr.total_distributed) as fund_total_distributed,\n        sum(irr.terminal_value) as fund_terminal_value,\n        -- Anti-pattern: averaging portfolio IRRs as proxy for fund IRR (incorrect but intentional)\n        avg(irr.approx_irr) as fund_approx_irr,\n        avg(irr.tvpi) as fund_tvpi,\n        avg(irr.dpi) as fund_dpi\n    from \"bain_analytics\".\"public\".\"int_irr_calculations\" irr\n    group by irr.fund_id\n),\n\n-- Anti-pattern: joining everything together at the end\ncombined as (\n    select\n        fn.fund_id,\n        fn.fund_name,\n        fn.fund_type,\n        fn.committed_capital,\n        fn.valuation_date,\n        fn.fund_nav,\n        fn.fund_gav,\n        fn.fund_total_liabilities,\n        fn.fund_unrealized_pnl,\n        fn.fund_realized_pnl,\n        fn.fund_nav_return,\n        fn.tvpi_gross,\n        fn.num_portfolios,\n        coalesce(fc.period_calls, 0) as period_calls,\n        coalesce(fc.period_distributions, 0) as period_distributions,\n        coalesce(fc.period_fees, 0) as period_fees,\n        coalesce(fc.period_net_cashflow, 0) as period_net_cashflow,\n        fi.fund_total_invested,\n        fi.fund_total_distributed,\n        fi.fund_approx_irr,\n        fi.fund_tvpi,\n        fi.fund_dpi\n    from fund_nav_data fn\n    left join fund_cashflows fc\n        on fn.fund_id = fc.fund_id\n        and fn.valuation_date = fc.cashflow_date\n    left join fund_irr fi\n        on fn.fund_id = fi.fund_id\n)\n\nselect * from combined", "relation_name": "\"bain_analytics\".\"public\".\"fact_fund_performance\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-02-05T14:54:48.963214Z", "completed_at": "2026-02-05T14:54:48.967726Z"}, {"name": "execute", "started_at": "2026-02-05T14:54:48.968938Z", "completed_at": "2026-02-05T14:54:49.024321Z"}], "thread_id": "Thread-3", "execution_time": 0.06800317764282227, "adapter_response": {"_message": "CREATE VIEW", "code": "CREATE VIEW", "rows_affected": -1}, "message": "CREATE VIEW", "failures": null, "unique_id": "model.bain_capital_analytics.report_lp_quarterly", "compiled": true, "compiled_code": "-- Pipeline C: REPORT table - LP quarterly reporting\n-- Anti-pattern: massive query, duplicated logic, no reuse of intermediates\n-- Anti-pattern: PostgreSQL-specific date_trunc\n-- Anti-pattern: re-aggregation of data already aggregated upstream\n\nwith quarterly_cashflows as (\n    -- Anti-pattern: re-aggregating cashflows by quarter (already in int_cashflow_enriched)\n    select\n        cf.fund_id,\n        cf.portfolio_id,\n        -- Anti-pattern: PostgreSQL-specific date_trunc\n        date_trunc('quarter', cf.cashflow_date) as quarter_start,\n        cf.cashflow_fiscal_quarter as fiscal_quarter,\n        cf.cashflow_year,\n        sum(case when cf.cashflow_type = 'capital_call' then cf.amount else 0 end) as quarter_calls,\n        sum(case when cf.cashflow_type = 'distribution' then cf.amount else 0 end) as quarter_distributions,\n        sum(case when cf.cashflow_type = 'management_fee' then cf.amount else 0 end) as quarter_fees,\n        sum(cf.amount) as quarter_net\n    from \"bain_analytics\".\"public\".\"stg_cashflows\" cf\n    group by\n        cf.fund_id, cf.portfolio_id,\n        date_trunc('quarter', cf.cashflow_date),\n        cf.cashflow_fiscal_quarter, cf.cashflow_year\n),\n\nquarterly_valuations as (\n    -- Anti-pattern: re-querying valuations with subquery for quarter-end\n    select *\n    from (\n        select\n            v.portfolio_id,\n            v.valuation_date,\n            v.net_asset_value,\n            v.gross_asset_value,\n            v.unrealized_pnl,\n            v.realized_pnl,\n            v.valuation_method,\n            -- Anti-pattern: subquery dedup instead of QUALIFY\n            row_number() over (\n                partition by v.portfolio_id, date_trunc('quarter', v.valuation_date)\n                order by v.valuation_date desc\n            ) as rn\n        from \"bain_analytics\".\"public\".\"stg_valuations\" v\n    ) sub\n    where rn = 1\n),\n\n-- Anti-pattern: re-joining fund structures (done in multiple places)\nfund_details as (\n    select\n        fs.fund_id,\n        fs.fund_name,\n        fs.fund_type,\n        fs.committed_capital,\n        fs.management_fee_rate,\n        fs.carry_rate,\n        fs.hurdle_rate,\n        fs.vintage_year,\n        fs.gp_commitment_pct\n    from \"bain_analytics\".\"public\".\"stg_fund_structures\" fs\n),\n\n-- Anti-pattern: joining everything at the end\nlp_report as (\n    select\n        fd.fund_id,\n        fd.fund_name,\n        fd.fund_type,\n        fd.vintage_year,\n        fd.committed_capital,\n        fd.management_fee_rate,\n        fd.carry_rate,\n        fd.hurdle_rate,\n        fd.gp_commitment_pct,\n        qc.portfolio_id,\n        p.portfolio_name,\n        p.strategy,\n        qc.quarter_start,\n        qc.fiscal_quarter,\n        qc.cashflow_year,\n        qc.quarter_calls,\n        qc.quarter_distributions,\n        qc.quarter_fees,\n        qc.quarter_net,\n        qv.net_asset_value as quarter_end_nav,\n        qv.gross_asset_value as quarter_end_gav,\n        qv.unrealized_pnl,\n        qv.realized_pnl,\n        qv.valuation_method,\n        -- Anti-pattern: IRR re-joined from separate calculation\n        irr.approx_irr,\n        irr.tvpi,\n        irr.dpi,\n        irr.rvpi\n    from quarterly_cashflows qc\n    inner join fund_details fd\n        on qc.fund_id = fd.fund_id\n    inner join \"bain_analytics\".\"public\".\"stg_portfolios\" p\n        on qc.portfolio_id = p.portfolio_id\n    left join quarterly_valuations qv\n        on qc.portfolio_id = qv.portfolio_id\n        and date_trunc('quarter', qv.valuation_date) = qc.quarter_start\n    left join \"bain_analytics\".\"public\".\"int_irr_calculations\" irr\n        on qc.fund_id = irr.fund_id\n        and qc.portfolio_id = irr.portfolio_id\n)\n\nselect\n    *,\n    -- Anti-pattern: computed columns in final select\n    case\n        when committed_capital > 0\n        then quarter_calls / committed_capital\n        else 0\n    end as quarterly_drawdown_rate,\n    case\n        when quarter_end_nav is not null and committed_capital > 0\n        then quarter_end_nav / committed_capital\n        else null\n    end as nav_to_commitment_ratio\nfrom lp_report\norder by fund_id, portfolio_id, quarter_start", "relation_name": "\"bain_analytics\".\"public\".\"report_lp_quarterly\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-02-05T14:54:48.885455Z", "completed_at": "2026-02-05T14:54:48.892813Z"}, {"name": "execute", "started_at": "2026-02-05T14:54:48.897252Z", "completed_at": "2026-02-05T14:54:48.973222Z"}], "thread_id": "Thread-1", "execution_time": 0.09528803825378418, "adapter_response": {"_message": "CREATE VIEW", "code": "CREATE VIEW", "rows_affected": -1}, "message": "CREATE VIEW", "failures": null, "unique_id": "model.bain_capital_analytics.fact_portfolio_pnl", "compiled": true, "compiled_code": "-- Pipeline B: FACT table - Portfolio PnL by date\n-- Anti-pattern: repeats the same heavy 3-table join as int_trade_enriched\n-- Anti-pattern: late aggregation after expensive joins\n-- Anti-pattern: materialized as view (should be table/incremental)\n\nwith trade_pnl as (\n    -- Anti-pattern: re-joining trades to instruments and portfolios\n    -- (same join already done in int_trade_enriched)\n    select\n        t.portfolio_id,\n        t.trade_date,\n        t.instrument_id,\n        t.trade_type,\n        t.notional_amount,\n        t.commission,\n        i.instrument_name,\n        i.instrument_type,\n        i.sector,\n        p.portfolio_name,\n        p.strategy,\n        p.fund_id,\n        d.fiscal_quarter,\n        d.fiscal_year,\n        d.is_month_end,\n        d.is_quarter_end\n    from \"bain_analytics\".\"public\".\"stg_trades\" t\n    inner join \"bain_analytics\".\"public\".\"stg_instruments\" i\n        on t.instrument_id = i.instrument_id\n    inner join \"bain_analytics\".\"public\".\"stg_portfolios\" p\n        on t.portfolio_id = p.portfolio_id\n    inner join \"bain_analytics\".\"public\".\"stg_dates\" d\n        on t.trade_date = d.date_day\n),\n\nposition_pnl as (\n    select\n        dp.portfolio_id,\n        dp.position_date,\n        dp.portfolio_name,\n        dp.strategy,\n        dp.fund_id,\n        dp.fiscal_quarter,\n        dp.fiscal_year,\n        sum(dp.daily_pnl) as position_daily_pnl,\n        sum(dp.market_value) as total_market_value,\n        count(distinct dp.instrument_id) as num_positions\n    from \"bain_analytics\".\"public\".\"int_daily_positions\" dp\n    group by\n        dp.portfolio_id, dp.position_date, dp.portfolio_name,\n        dp.strategy, dp.fund_id, dp.fiscal_quarter, dp.fiscal_year\n),\n\n-- Anti-pattern: aggregating trades separately then joining back\ntrade_activity as (\n    select\n        portfolio_id,\n        trade_date,\n        sum(notional_amount) as total_traded_notional,\n        sum(commission) as total_commissions,\n        count(*) as num_trades\n    from trade_pnl\n    group by portfolio_id, trade_date\n)\n\nselect\n    pp.portfolio_id,\n    pp.portfolio_name,\n    pp.strategy,\n    pp.fund_id,\n    pp.position_date as pnl_date,\n    pp.fiscal_quarter,\n    pp.fiscal_year,\n    pp.position_daily_pnl,\n    pp.total_market_value,\n    pp.num_positions,\n    coalesce(ta.total_traded_notional, 0) as total_traded_notional,\n    coalesce(ta.total_commissions, 0) as total_commissions,\n    coalesce(ta.num_trades, 0) as num_trades,\n    -- Anti-pattern: running total recomputed here (already in int_trade_enriched)\n    sum(pp.position_daily_pnl) over (\n        partition by pp.portfolio_id\n        order by pp.position_date\n        rows between unbounded preceding and current row\n    ) as cumulative_pnl\nfrom position_pnl pp\nleft join trade_activity ta\n    on pp.portfolio_id = ta.portfolio_id\n    and pp.position_date = ta.trade_date", "relation_name": "\"bain_analytics\".\"public\".\"fact_portfolio_pnl\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-02-05T14:54:50.236433Z", "completed_at": "2026-02-05T14:54:50.241321Z"}, {"name": "execute", "started_at": "2026-02-05T14:54:50.245243Z", "completed_at": "2026-02-05T14:54:50.292713Z"}], "thread_id": "Thread-3", "execution_time": 0.06187081336975098, "adapter_response": {"_message": "CREATE VIEW", "code": "CREATE VIEW", "rows_affected": -1}, "message": "CREATE VIEW", "failures": null, "unique_id": "model.bain_capital_analytics.report_daily_pnl", "compiled": true, "compiled_code": "-- Pipeline B: REPORT table - Daily PnL report for portfolio managers\n-- Anti-pattern: subquery for latest-only instead of QUALIFY\n-- Anti-pattern: re-aggregation from fact that's already aggregated\n\nwith latest_pnl as (\n    select *\n    from (\n        select\n            fpnl.*,\n            -- Anti-pattern: subquery dedup instead of QUALIFY\n            row_number() over (\n                partition by fpnl.portfolio_id\n                order by fpnl.pnl_date desc\n            ) as rn\n        from \"bain_analytics\".\"public\".\"fact_portfolio_pnl\" fpnl\n    ) sub\n    where rn <= 5  -- last 5 dates per portfolio\n),\n\n-- Anti-pattern: re-joining to get benchmark data that should be part of the pipeline\npnl_with_benchmark as (\n    select\n        lp.*,\n        bm.return_mtd as benchmark_return_mtd,\n        bm.return_ytd as benchmark_return_ytd,\n        bm.benchmark_name\n    from latest_pnl lp\n    left join \"bain_analytics\".\"public\".\"stg_benchmarks\" bm\n        on lp.pnl_date = bm.benchmark_date\n        and bm.benchmark_id = 'BM_SP500'\n)\n\nselect\n    portfolio_id,\n    portfolio_name,\n    strategy,\n    pnl_date,\n    fiscal_quarter,\n    position_daily_pnl,\n    cumulative_pnl,\n    total_market_value,\n    num_positions,\n    total_traded_notional,\n    total_commissions,\n    num_trades,\n    benchmark_name,\n    benchmark_return_mtd,\n    benchmark_return_ytd,\n    -- Anti-pattern: computing return inline instead of upstream\n    case\n        when total_market_value != 0\n        then position_daily_pnl / total_market_value\n        else 0\n    end as daily_return_pct\nfrom pnl_with_benchmark\norder by portfolio_id, pnl_date desc", "relation_name": "\"bain_analytics\".\"public\".\"report_daily_pnl\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-02-05T14:54:50.232634Z", "completed_at": "2026-02-05T14:54:50.240997Z"}, {"name": "execute", "started_at": "2026-02-05T14:54:50.241631Z", "completed_at": "2026-02-05T14:54:50.296791Z"}], "thread_id": "Thread-2", "execution_time": 0.06600117683410645, "adapter_response": {"_message": "CREATE VIEW", "code": "CREATE VIEW", "rows_affected": -1}, "message": "CREATE VIEW", "failures": null, "unique_id": "model.bain_capital_analytics.report_ic_dashboard", "compiled": true, "compiled_code": "-- Pipeline C: REPORT table - Investment Committee dashboard\n-- Anti-pattern: massive query joining many sources, no intermediate reuse\n-- Anti-pattern: subquery for latest records instead of QUALIFY\n-- Anti-pattern: duplicated logic from other reports\n\nwith latest_fund_performance as (\n    select *\n    from (\n        select\n            fp.*,\n            -- Anti-pattern: subquery dedup instead of QUALIFY\n            row_number() over (\n                partition by fp.fund_id\n                order by fp.valuation_date desc\n            ) as rn\n        from \"bain_analytics\".\"public\".\"fact_fund_performance\" fp\n    ) sub\n    where rn = 1\n),\n\nlatest_portfolio_summary as (\n    select *\n    from (\n        select\n            ps.*,\n            row_number() over (\n                partition by ps.portfolio_id\n                order by ps.position_date desc\n            ) as rn\n        from \"bain_analytics\".\"public\".\"fact_portfolio_summary\" ps\n    ) sub\n    where rn = 1\n),\n\n-- Anti-pattern: re-joining fund structures (already in fact_fund_performance)\nfund_overview as (\n    select\n        lfp.fund_id,\n        lfp.fund_name,\n        lfp.fund_type,\n        lfp.committed_capital,\n        lfp.valuation_date as latest_valuation_date,\n        lfp.fund_nav,\n        lfp.fund_gav,\n        lfp.fund_nav_return as latest_nav_return,\n        lfp.tvpi_gross,\n        lfp.fund_approx_irr,\n        lfp.fund_tvpi,\n        lfp.fund_dpi,\n        lfp.num_portfolios,\n        lfp.fund_total_invested,\n        lfp.fund_total_distributed,\n        -- Anti-pattern: re-joining fund structures\n        fs.management_fee_rate,\n        fs.carry_rate,\n        fs.hurdle_rate,\n        fs.vintage_year\n    from latest_fund_performance lfp\n    inner join \"bain_analytics\".\"public\".\"stg_fund_structures\" fs\n        on lfp.fund_id = fs.fund_id\n),\n\nportfolio_details as (\n    select\n        lps.portfolio_id,\n        lps.portfolio_name,\n        lps.strategy,\n        lps.fund_id,\n        lps.total_market_value,\n        lps.total_unrealized_pnl,\n        lps.portfolio_return_pct,\n        lps.num_positions,\n        -- Anti-pattern: re-computing fiscal quarter\n        case\n            when extract(month from lps.position_date) between 1 and 3 then 'Q3'\n            when extract(month from lps.position_date) between 4 and 6 then 'Q4'\n            when extract(month from lps.position_date) between 7 and 9 then 'Q1'\n            when extract(month from lps.position_date) between 10 and 12 then 'Q2'\n        end as reporting_fiscal_quarter\n    from latest_portfolio_summary lps\n)\n\nselect\n    fo.fund_id,\n    fo.fund_name,\n    fo.fund_type,\n    fo.vintage_year,\n    fo.committed_capital,\n    fo.latest_valuation_date,\n    fo.fund_nav,\n    fo.fund_gav,\n    fo.latest_nav_return,\n    fo.tvpi_gross,\n    fo.fund_approx_irr,\n    fo.fund_tvpi,\n    fo.fund_dpi,\n    fo.num_portfolios,\n    fo.fund_total_invested,\n    fo.fund_total_distributed,\n    fo.management_fee_rate,\n    fo.carry_rate,\n    fo.hurdle_rate,\n    pd.portfolio_id,\n    pd.portfolio_name,\n    pd.strategy,\n    pd.total_market_value as portfolio_mv,\n    pd.total_unrealized_pnl as portfolio_unrealized_pnl,\n    pd.portfolio_return_pct,\n    pd.num_positions as portfolio_num_positions,\n    pd.reporting_fiscal_quarter\nfrom fund_overview fo\ninner join portfolio_details pd\n    on fo.fund_id = pd.fund_id\norder by fo.fund_nav desc, pd.total_market_value desc", "relation_name": "\"bain_analytics\".\"public\".\"report_ic_dashboard\"", "batch_results": null}], "elapsed_time": 2.3298468589782715, "args": {"quiet": false, "favor_state": false, "upload_to_artifacts_ingest_api": false, "state_modified_compare_vars": false, "use_colors": true, "send_anonymous_usage_stats": true, "require_all_warnings_handled_by_warn_error": false, "log_level": "info", "indirect_selection": "eager", "show_resource_report": false, "introspect": true, "warn_error_options": {"error": [], "warn": [], "silence": []}, "partial_parse_file_diff": true, "show_all_deprecations": false, "require_batched_execution_for_custom_microbatch_strategy": false, "log_level_file": "debug", "profiles_dir": ".", "require_explicit_package_overrides_for_builtin_materializations": true, "require_yaml_configuration_for_mf_time_spines": false, "validate_macro_args": false, "select": [], "partial_parse": true, "defer": false, "skip_nodes_if_on_run_start_fails": false, "vars": {}, "print": true, "macro_debugging": false, "cache_selected_only": false, "log_file_max_bytes": 10485760, "require_resource_names_without_spaces": true, "use_fast_test_edges": false, "source_freshness_run_project_hooks": true, "write_json": true, "invocation_command": "dbt run --profiles-dir .", "strict_mode": false, "printer_width": 80, "static_parser": true, "log_format": "default", "require_generic_test_arguments_property": true, "log_format_file": "debug", "project_dir": "/Users/nedazarei/Documents/turintech/sample-dbt/postgres", "populate_cache": true, "require_nested_cumulative_type_params": false, "use_colors_file": true, "log_path": "/Users/nedazarei/Documents/turintech/sample-dbt/postgres/logs", "empty": false, "exclude": [], "which": "run", "state_modified_compare_more_unrendered_values": false, "version_check": true}}